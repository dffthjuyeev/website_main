IE.fModule({f:function(exports,require,module,global){const{ObjetInvocateur,Invocateur}=require('Invocateur.js');const GHtml=require('GHtml.js');const Identite=require('ObjetIdentite.js');const GTraductions=require('ObjetTraduction.js');const ObjetDonneesCentraleNotifications=require('ObjetDonneesCentraleNotifications.js');const GChaine=require('GChaine.js');require('mobile/css/ObjetEntete_mobile.css');const EGenreCommandeMobile={SeDeconnecter:0,Retour:1,Valider:2,Accueil:3,MenuOnglets:4};class _ObjetEnteteMobile extends Identite{constructor(...aParams){super(...aParams);this.idTitre=this.Nom+'_Titre';this.idPageAccueil=this.Nom+'_Btn_Accueil';this.idMenuOnglets=this.Nom+'_Btn_MenuOnglets';this.idLienMenuOnglets=this.Nom+'_Lien_MenuOnglets';this.idValider=this.Nom+'_Btn_Valider';Invocateur.abonner(ObjetInvocateur.events.etatSaisie,this._setEtatSaisie.bind(this),this);Invocateur.abonner(ObjetDonneesCentraleNotifications.typeNotif.surModification,function(){$("#"+this.idLienMenuOnglets.escapeJQ()).find('.new-badge').remove();const lNb=_getNbNotifs();if(lNb>0){$("#"+this.idLienMenuOnglets.escapeJQ()).append(_getHtmlNotifs(lNb));}},this);}
ConstruireAffichage(){const lHTML=[];const lClasseCssNoImg='no-img';let lBaliseImg='';const lUtilisateur=GEtatUtilisateur.getUtilisateur();if(!!lUtilisateur&&!!lUtilisateur.avecPhoto){const lUrlPhoto=GChaine.creerUrlBruteLienExterne(lUtilisateur,{libelle:'photo.jpg'});lBaliseImg='<img src="'+lUrlPhoto+'" onerror="$(this).closest().addClass(\''+lClasseCssNoImg+'\'); $(this).remove(); " />';}
const lClasses=['photo-circle'];if(!lBaliseImg){lClasses.push(lClasseCssNoImg);}
const lDivPhoto=[];lDivPhoto.push('<div class="',lClasses.join(' '),'">');if(!!lBaliseImg){lDivPhoto.push(lBaliseImg);}
lDivPhoto.push('</div>');lHTML.push('<nav>','<div class="nav-wrapper design-2021">','<div class="header-gauche">',lDivPhoto.join(''),'</div>','<div class="header-droit">','<div class="infos-container" tabIndex="0" role="heading" id="',this.idTitre,'" ie-node="getNodeTitre"></div>','<ul class="btn-container">','<li id="'+this.idValider+'">','<a class="btn-menu icon_ok" role="button" onclick="'+this.Nom+'.surClickBouton('+EGenreCommandeMobile.Valider+')">','<span  class="WAI_hidden">'+GTraductions.getValeur('Commande.Validation.Actif')+'</span>','</a>','</li>');if(GEtatUtilisateur.avecPageAccueil()){lHTML.push('<li id="'+this.idPageAccueil+'">','<a onclick="'+this.Nom+'.surClickBouton('+EGenreCommandeMobile.Accueil+')" class="btn-menu icon_home" aria-label="',GTraductions.getValeur('Commande.Accueil.Actif'),'">','<span class="WAI_hidden">',GTraductions.getValeur('Commande.Accueil.Actif'),'</span></a>','</li>');}
if(!!this.idPanel){const libelleBtnMenuOnglets=(this.nEstPasMobileAppariteurHP()&&!!this.idPanel?GTraductions.getValeur('accueil.menuPrincipal'):'');const lNbNotifs=_getNbNotifs();lHTML.push('<li id="',this.idMenuOnglets,'">','<a class="btn-menu icon_menu_burger" id="'+this.idLienMenuOnglets+'" role="button" onclick="'+this.Nom+'.surClickBouton('+EGenreCommandeMobile.MenuOnglets+')">','<span class="WAI_hidden">'+(!!libelleBtnMenuOnglets?libelleBtnMenuOnglets:'')+'</span>',lNbNotifs>0?_getHtmlNotifs(lNbNotifs):'','</a></li>');}
lHTML.push('</ul>','</div>','</div>','</nav>');return lHTML.join('');}
getControleur(){return $.extend(true,super.getControleur(this),{getNodeTitre:function(){$(this.node).on('click',function(){Invocateur.evenement(ObjetInvocateur.events.toucheDEBUG);});}});}
nEstPasMobileAppariteurHP(){return true;}
SetParametres(aParam){this.idPanel=aParam.idPanel;}
actualiserTitre(){}
focusTitre(){$('#'+this.idTitre.escapeJQ()).focus();}
_setEtatSaisie(aVisible){GHtml.setDisplay(this.idValider,aVisible);}
setBoutonAccueil(aBoolean){GHtml.setDisplay(this.idPageAccueil,aBoolean&&GEtatUtilisateur.avecPageAccueil()&&!GApplication.acces.estConnexionDirect());}
surClickBouton(i){if(GApplication.getCommunication().requeteEnCours()){return;}
this.callback.appel(i);}
composeNotificationsApplicatives(){return'';}}
function _getNbNotifs(){const lDonnees=GApplication.donneesCentraleNotifications.getDonnees();return lDonnees.nbNotifs+(lDonnees.nbConversationEnCours||0);}
function _getHtmlNotifs(aNb){return'<span class="new-badge">'+(aNb>999?'999+':aNb)+'</span>';}
module.exports={EGenreCommandeMobile:EGenreCommandeMobile,_ObjetEnteteMobile:_ObjetEnteteMobile};},fn:"_objetentete.js"});;
IE.fModule({f:function(exports,require,module,global){const MethodesTableau=require('MethodesTableau.js');const _ObjetEnteteMobile=require('_ObjetEntete.js')._ObjetEnteteMobile;const GHtml=require('GHtml.js');const EGenreEspace=require('Enumere_Espace.js');const EGenreOnglet=require('Enumere_Onglet.js');class ObjetEnteteMobile extends _ObjetEnteteMobile{constructor(...aParams){super(...aParams);}
actualiserTitre(){const lTitre={titre:'',sousTitre:'',avecImage:false};const lGenreOnglet=GEtatUtilisateur.getGenreOnglet(),lOnglet=GEtatUtilisateur.listeOnglets.GetElementParGenre(lGenreOnglet);if(!!lOnglet){lTitre.titre=lOnglet.GetLibelle();}
if(lGenreOnglet===EGenreOnglet.Accueil||MethodesTableau.existe(lGenreOnglet,GInterface.OngletsAvecRessourceParent)||MethodesTableau.existe(lGenreOnglet,GInterface.OngletsAvecRessourceEtablissement)){lTitre.sousTitre=GEtatUtilisateur.getMembre().GetLibelle();let lLibelleClasse='';if(MethodesTableau.existe(GEtatUtilisateur.GenreEspace,[EGenreEspace.PrimParent,EGenreEspace.Mobile_PrimParent,EGenreEspace.PrimEleve,EGenreEspace.Mobile_PrimEleve,EGenreEspace.PrimAccompagnant,EGenreEspace.Mobile_PrimAccompagnant])){lLibelleClasse=GEtatUtilisateur.Identification.GetLibelleClasse();}
lTitre.sousTitre+=(lLibelleClasse?' ('+lLibelleClasse+')':'');}
const lStrTitre=(lTitre.sousTitre?'<h1>'+lTitre.sousTitre+'</h1>':'')+'<h2>'+lTitre.titre+'</h2>';GHtml.setHtml(this.idTitre,lStrTitre);}}
module.exports=ObjetEnteteMobile;},fn:"mobile/script/objetentete.js"});;
IE.fModule({f:function(exports,require,module,global){const TypeEtatExecutionQCMPourRepondant={EQR_EnCours:0,EQR_Termine:1,EQR_DureeMaxDepassee:2,EQR_ARefaire:3};module.exports.TypeEtatExecutionQCMPourRepondant=TypeEtatExecutionQCMPourRepondant;},fn:"typeetatexecutionqcmpourrepondant.js"});;
IE.fModule({f:function(exports,require,module,global){const TypeNumerotation={n123:0,nABC:1,NRoman:2};module.exports.TypeNumerotation=TypeNumerotation;},fn:"typenumerotation.js"});;
IE.fModule({f:function(exports,require,module,global){const TypeGenreElementAssociation={GEA_Texte:0,GEA_Image:1,GEA_Son:2};module.exports.TypeGenreElementAssociation=TypeGenreElementAssociation;},fn:"typegenreassociationquestionqcm.js"});;
IE.fModule({f:function(exports,require,module,global){require('IEHtml.Chips.js');const GChaine=require('GChaine.js');const tag=require('tag.js');const UtilitaireAudio={IconeLecture:'icon_play_sign',IconePause:'icon_pause',IconeStop:'icon_pause',ExceptionFichierNonValide:0,construitChipsAudio:function(aInfoChips){const H=[];const lInfosChips=Object.assign({base64Audio:'',url:'',libelle:'',idChips:'',idAudio:'',ieModel:'',argsIEModel:[],classes:[]},aInfoChips)
;H.push('<ie-chips');if(!!lInfosChips.idChips){H.push(' id="',lInfosChips.idChips,'"');}
if(!!lInfosChips.ieModel){H.push(' ',tag.composeAttr('ie-model',lInfosChips.ieModel,lInfosChips.argsIEModel));}
lInfosChips.classes.push('ChipsAudio');lInfosChips.classes.push('iconic',this.IconeLecture);if(!lInfosChips.libelle){lInfosChips.classes.push('no-label');}
if(!lInfosChips.ieModel){lInfosChips.classes.push('avec-event');}
H.push(' class="',lInfosChips.classes.join(' '),'">');let lSrc;let lType;if(!!lInfosChips.url){lSrc=lInfosChips.url;let lExt=GChaine.extraireExtensionFichier(lInfosChips.url);if(!!lExt){const lTab=lExt.split('?');if(lTab.length>1){lExt=lTab[0];}
lType=UtilitaireAudio.getTypeFromExtension(lExt);}} else{lSrc='data:audio/mp3;base64,'+lInfosChips.base64Audio;}
H.push('<audio><source src="',lSrc,'"',(lType?' type="'+lType+'"':''));if(!!lInfosChips.idAudio){H.push(' id="',lInfosChips.idAudio,'"');}
H.push('></audio>');H.push('<span>',lInfosChips.libelle,'</span>');H.push('</ie-chips>');return H.join('');},jouerAudio:function(aElementAudio){if(!!aElementAudio&&aElementAudio.duration>0){if(aElementAudio.paused){aElementAudio.play();}} else{throw this.ExceptionFichierNonValide;}},pauseAudio:function(aElementAudio){if(!!aElementAudio&&aElementAudio.duration>0){aElementAudio.pause();}},stopAudio:function(aElementAudio){if(!!aElementAudio&&aElementAudio.duration>0){aElementAudio.currentTime=0;this.pauseAudio(aElementAudio);}},estEnCoursDeLecture:function(aElementAudio){let lEstEnCoursDeLecture=false;if(!!aElementAudio&&aElementAudio.duration>0){lEstEnCoursDeLecture=!aElementAudio.paused;}
return lEstEnCoursDeLecture;},getTypeMimeAudio:function(aAvecPlusieursFormatsAudio){const lAudios=['audio/mp3'];if(!!aAvecPlusieursFormatsAudio){lAudios.push('audio/mp4','audio/ogg','audio/webm');}
return lAudios.join(',');},getTypeFromExtension:function(aExtension){switch(aExtension){case'mp4':return'audio/m4a';case'oga':case'ogg':return'audio/ogg';case'weba':case'webm':return'audio/webm';default:return'';}}};module.exports=UtilitaireAudio;},fn:"utilitaireaudio.js"});;
IE.fModule({f:function(exports,require,module,global){const TypeEtatExecutionQCMPourRepondant=require('TypeEtatExecutionQCMPourRepondant.js').TypeEtatExecutionQCMPourRepondant;const TypeNumerotation=require('TypeNumerotation.js').TypeNumerotation;const GTraductions=require('ObjetTraduction.js');const TUtilitaireDuree=require('UtilitaireDuree.js');const TypeGenreElementAssociation=require('TypeGenreAssociationQuestionQCM.js').TypeGenreElementAssociation;const GChaine=require('GChaine.js');const UtilitaireAudio=require('UtilitaireAudio.js');class ObjetUtilitaireQCM{constructor(){this.couleurBonneReponse='green';this.couleurFausseReponse='red';}
composeNumerotation(aTypeNum,aNum){if(aTypeNum===TypeNumerotation.n123){return aNum;} else if(aTypeNum===TypeNumerotation.nABC){return this.aphabetize(aNum).toUpperCase();} else if(aTypeNum===TypeNumerotation.NRoman){return this.romanize(aNum);}}
aphabetize(aNum){let lResult='';while(aNum>0){aNum--;const lRemain=aNum%26;lResult=String.fromCharCode(lRemain+97)+lResult;aNum=(aNum-lRemain)/26;}
return lResult;}
romanize(aNum){const lLookup={M:1000,CM:900,D:500,CD:400,C:100,XC:90,L:50,XL:40,X:10,IX:9,V:5,IV:4,I:1};let lRoman='';for(const i in lLookup){while(aNum>=lLookup[i]){lRoman+=i;aNum-=lLookup[i];}}
return lRoman;}
estCliquable(aExecutionQCM,aIgnorerTestCorrige){return aExecutionQCM.fichierDispo&&(GEtatUtilisateur.estEspacePourEleve()?this.estJouable(aExecutionQCM)||(aIgnorerTestCorrige?true:this.estCorrige(aExecutionQCM)):(GEtatUtilisateur.estEspacePourProf()?true:false));}
estJouable(aExecutionQCM){return aExecutionQCM.estEnPublication===true&&((aExecutionQCM.etatCloture!==TypeEtatExecutionQCMPourRepondant.EQR_DureeMaxDepassee&&
aExecutionQCM.etatCloture!==TypeEtatExecutionQCMPourRepondant.EQR_Termine)||
aExecutionQCM.estRejouable);}
estCorrige(aExecutionQCM){return aExecutionQCM.publierCorrige===true;}
getValeurContenuReponseMatching(aElementAssociation){let lStrContenu;if(!!aElementAssociation){switch(aElementAssociation.GetGenre()){case TypeGenreElementAssociation.GEA_Texte:lStrContenu=aElementAssociation.strTexte;break;case TypeGenreElementAssociation.GEA_Image:lStrContenu=GChaine.ajouterEntites(aElementAssociation.strImage);break;case TypeGenreElementAssociation.GEA_Son:lStrContenu=GChaine.ajouterEntites(aElementAssociation.strSon);break;}}
return lStrContenu;}
getStringAffichageReponseMatching(aElementAssociation,aPourVisuEleve,aIndexReponse){const H=[];if(!!aElementAssociation){const lStrContenu=this.getValeurContenuReponseMatching(aElementAssociation);let lDataContenuAttribut='';if(!!aPourVisuEleve){lDataContenuAttribut=' data-contenu="'+aElementAssociation.hashContenu+'"';}
switch(aElementAssociation.GetGenre()){case TypeGenreElementAssociation.GEA_Texte:H.push('<span',(!!lDataContenuAttribut?lDataContenuAttribut:''),'>',lStrContenu,'</span>');break;case TypeGenreElementAssociation.GEA_Image:{const lMaxWidthImage=200;H.push('<div ',(!!lDataContenuAttribut?lDataContenuAttribut:''),' style="display:inline-block; max-width:',lMaxWidthImage,'px;">','<img style="width:100%;" src="data:image/png;base64,',lStrContenu,'" onerror="" onload="" />','</div>');break;}
case TypeGenreElementAssociation.GEA_Son:H.push('<span ',(!!lDataContenuAttribut?lDataContenuAttribut:''),'>');if(!!aPourVisuEleve){if(aIndexReponse===null||aIndexReponse===undefined){aIndexReponse=0;}
aIndexReponse++;const lLibelleSon=aElementAssociation.strLibelleSon||(GTraductions.getValeur('ExecutionQCM.FichierSonCache')+' '+aIndexReponse);const lChips=UtilitaireAudio.construitChipsAudio({base64Audio:aElementAssociation.strSon,libelle:lLibelleSon});H.push(lChips);} else{H.push(aElementAssociation.strNomFichier);}
H.push('</span>');break;}}
return H.join('');}
getStrResumeModalites(aExec,aSansDuree){const H=[];let lNbQuestions=aExec.nombreQuestionsSoumises>0?aExec.nombreQuestionsSoumises:aExec.QCM.nbQuestionsTotal;if(aExec.nombreQuestionsEnMoins){lNbQuestions-=aExec.nombreQuestionsEnMoins;}
lNbQuestions=Math.max(lNbQuestions,1);if(lNbQuestions===1){H.push(GTraductions.getValeur('SaisieQCM.NbUneQuestion'));} else{H.push(GTraductions.getValeur('SaisieQCM.NbQuestions',[lNbQuestions]));}
if(aExec.dureeMaxQCM>0&&aSansDuree!==true){let lDureeMax=aExec.dureeMaxQCM;if(aExec.dureeSupplementaire){lDureeMax+=aExec.dureeSupplementaire;}
H.push(' - ',GTraductions.getValeur('SaisieQCM.DureeExec',[TUtilitaireDuree.dureeEnMin(lDureeMax)]));}
return H.join('');}}
module.exports={ObjetUtilitaireQCM:ObjetUtilitaireQCM,UtilitaireQCM:null};},fn:"utilitaireqcm.js"});;
IE.fModule({f:function(exports,require,module,global){const ObjetUtilitaireQCM=require('UtilitaireQCM.js').ObjetUtilitaireQCM
;class ObjetUtilitaireQCM_Mobile extends ObjetUtilitaireQCM{constructor(...aParams){super(...aParams);}}
require('UtilitaireQCM.js').UtilitaireQCM=new ObjetUtilitaireQCM_Mobile();module.exports={ObjetUtilitaireQCM_Mobile:ObjetUtilitaireQCM_Mobile,UtilitaireQCM:require('UtilitaireQCM.js').UtilitaireQCM};},fn:"utilitaireqcm_mobile.js"});;
IE.fModule({f:function(exports,require,module,global){const ObjetElement=require('ObjetElement.js');const ObjetListeElements=require('ObjetListeElements.js');const EGenreEtat=require('Enumere_Etat.js');const GChaine=require('GChaine.js');const GTraductions=require('ObjetTraduction.js');const UtilitaireTraitementImage=require('UtilitaireTraitementImage.js');const EGenreDocumentJoint=require('Enumere_DocumentJoint.js');let uIdFichier=0;const UtilitaireSelecFile={C_MaxSize:500*1024*1024,addFileDansListe:function(aFile,aListeFichiers,aGenrePJ){const lElement=new ObjetElement('',null,aGenrePJ);lElement.SetEtat(EGenreEtat.Creation);lElement.Libelle=GChaine.ajouterEntites(GChaine.enleverChemin(aFile.name));lElement.nomOriginal=aFile.name;lElement.file=aFile;try{if(aFile.lastModified){lElement.lastModified=aFile.lastModified;}} catch(error){}
uIdFichier+=1;lElement.idFichier='selecfile_'+uIdFichier+'_'+Date.now();aListeFichiers.AddElement(lElement);},controleTailleFichiers:function(aListeFichiers,aMessagesErreur,aMaxSize){const lListe=new ObjetListeElements();aListeFichiers.parcourir(function(aFichier){if(aMaxSize>0&&aFichier.file.size>aMaxSize){let lVal=Math.floor(aMaxSize/1024);let lUnite=GTraductions.getValeur('unite.Ko');if(lVal>1024*10||(lVal>1024&&Math.floor(lVal/1024)===lVal/1024)){lVal=Math.floor(lVal/1024);lUnite=GTraductions.getValeur('unite.Mo');}
aMessagesErreur.push(GChaine.Format('%s (%s)',[
GTraductions.getValeur('inputFile.msgEchecTailleFichier',[lVal,lUnite]),aFichier.GetLibelle()
]));} else{lListe.AddElement(aFichier);}});return lListe;},estFichierCloudPartage(aFichier){return aFichier&&aFichier.idPartage&&aFichier.GetGenre&&aFichier.GetGenre()===EGenreDocumentJoint.Cloud;},extraireListeFichiersCloudsPartage(aListeFichiers){const lListeFichiersClouds=new ObjetListeElements();if(aListeFichiers&&aListeFichiers.parcourir){const lTabFichiers=[...aListeFichiers.GetListeElements()];lTabFichiers.forEach((aFichier,aIndex) =>{if(UtilitaireSelecFile.estFichierCloudPartage(aFichier)){lListeFichiersClouds.add(aFichier);aListeFichiers.remove(aIndex);}});}
return lListeFichiersClouds;},genererPdfPromise:function(aListeFichiers,aMessagesErreur,aNomPDFaGenerer,aGenrePDF){return UtilitaireTraitementImage.genererPdfPromise(aListeFichiers).then(function(aParamPDF){aListeFichiers.vider();if(aParamPDF&&aParamPDF.file){if(aNomPDFaGenerer){aParamPDF.file.name=aNomPDFaGenerer;}
UtilitaireSelecFile.addFileDansListe(aParamPDF.file,aListeFichiers,aGenrePDF);}}).catch(function(aParamsReject){aListeFichiers.vider();if(aMessagesErreur.length>0){aMessagesErreur.push('');}
aMessagesErreur.push(GChaine.Format(GTraductions.getValeur('inputFile.echecImagePDF_S'),[(aParamsReject?aParamsReject.nom:'')||'']));});}};module.exports=UtilitaireSelecFile;},fn:"utilitaireselecfile.js"});;
IE.fModule({f:function(exports,require,module,global){require('Produit/Css/IEHtml.SelecFile.css');const IEHtml=require('IEHtml.js');const GUID=require('GUID.js');const GLog=require('IELog.js');const{ObjetInvocateur,Invocateur}=require('Invocateur.js');const MethodesObjet=require('MethodesObjet.js');const GChaine=require('GChaine.js');const GHtml=require('GHtml.js');const EGenreDocumentJoint=require('Enumere_DocumentJoint.js');const ZoneFenetre=require('IEZoneFenetre.js');const ObjetListeElements=require('ObjetListeElements.js');const ObjetTri=require('ObjetTri.js');const GTraductions=require('ObjetTraduction.js');const GestionnaireModale=require('GestionnaireModale.js');const UtilitaireTraitementImage=require('UtilitaireTraitementImage.js');const UtilitaireSelecFile=require('UtilitaireSelecFile.js');let uIdConteneurInputFile=GUID.getId(),uInvocateurSelecFile=new ObjetInvocateur();IEHtml.addAttribut('ie-selecfile',function(aContexteCourant,aNodeName,aAttributValue,aOutils){const lModele=aOutils.getModel(aContexteCourant);let lJInput=null;let lDisabled=false;let lExisteInput=false;let lOptions={};let lDesactiverClick_openFileManuel=false;let lTimeoutDrag;let lTimeoutDragSurvol;const lDureeTimeoutDrag=10;let lDragEnCours=false;let lDragHoverEnCours=false;let lTimeoutDestroy=null;if(!lModele||!aContexteCourant.data.$modeleParsed){return true;}
const lJElement=$(aContexteCourant.node),lInfosOptions=aOutils.getAccesParametresModel('getOptionsSelecFile',aContexteCourant),lInfosAdd=aOutils.getAccesParametresModel('addFiles',aContexteCourant),lInfosGetDisabled=aOutils.getAccesParametresModel('getDisabled',aContexteCourant);if(!lInfosAdd.estFonction){return true;}
if(!lInfosOptions.estFonction){return true;}
const lOuvrirSelecteur=function(){if(!lDisabled&&lExisteInput){if(lOptions.surOuvertureSelecteur){lOptions.surOuvertureSelecteur();}
lJInput.click();}};function _surDrag(aParams){clearTimeout(lTimeoutDrag);if(aParams.start&&!lDisabled&&lExisteInput&&lOptions.acceptDragDrop){if(!lDragEnCours&&!GestionnaireModale.estJElementBloque(lJElement)){lDragEnCours=true;if(lOptions.classDrag){aContexteCourant.node.classList.add(lOptions.classDrag);}
if(lOptions.eventSurDrag){lOptions.eventSurDrag({surDrag:true});}}} else if(lDragEnCours){lTimeoutDrag=setTimeout(function(){lDragEnCours=false;lDragHoverEnCours=false;if(lOptions.classDrag){aContexteCourant.node.classList.remove(lOptions.classDrag);}
if(lOptions.classDragHoverSelec){aContexteCourant.node.classList.remove(lOptions.classDragHoverSelec);}
if(lOptions.eventSurDrag){lOptions.eventSurDrag({surDrag:false});}},lDureeTimeoutDrag);}
if(lOptions.bloquerDropHorsZoneDrop){aParams.avecSelecAbonne=true;}}
function _createInput(){if(lExisteInput){return;}
if(lTimeoutDestroy){clearTimeout(lTimeoutDestroy);}
lTimeoutDestroy=null;lOptions={accept:'',extensions:null,maxSize:null,multiple:false,acceptDragDrop:true,eventClick:true,maxFiles:0,title:'',getClass:function(aDisabled){return aDisabled||!lOptions.eventClick?'':'AvecMain';},interrompreClick:false,click_surEventCapture:true,dragEnCoursVisible:true,genrePJ:EGenreDocumentJoint.Fichier,bloquerDropHorsZoneDrop:true,classDrag:'SelecFile_DragEnCours',classDragHoverSelec:'SelecFile_DragEnCours_survol',eventSurDrag:null,avecResizeImage:true,hauteurMaxImageResize:1500,largeurMaxImageResize:1500,compressionImage:0.88,avecTransformationFlux:true,avecTransformationFlux_versCloud:false,genererPDFImages:false,nomPDFaGenerer:'',accept_genererPDFImages:UtilitaireTraitementImage.getTabMIME_PDFImage().join(', '),capture:''};if(lInfosOptions.estFonction){const lResultOptions=lInfosOptions.callback()
;Object.assign(lOptions,lResultOptions);if(!MethodesObjet.isNumber(lOptions.maxSize)||lOptions.maxSize<0){lOptions.maxSize=0
;}
if(lOptions.maxSize<=0){lOptions.maxSize=50*1024*1024;}}
if(!GHtml.getElement(uIdConteneurInputFile)){ZoneFenetre.ajouterFenetre(uIdConteneurInputFile,-1);}
const lAccept=(lOptions.genererPDFImages?lOptions.accept_genererPDFImages:'')||lOptions.accept;lJInput=$(aOutils.injectHTML({element:GHtml.getElement(uIdConteneurInputFile),html:'<input type="file" style="display:none;" '+(lOptions.multiple?' multiple ':'')+(lAccept?' accept="'+lAccept+'"':'')+(lOptions.capture?' capture="'+lOptions.capture+'"':'')+' />',ignorerScroll:true}));lExisteInput=true;lJInput.on({'change':function(aEvent){_addFiles({files:this.files,event:aEvent,nodeInput:this});}});if(lOptions.dragEnCoursVisible){uInvocateurSelecFile.abonner('drag',_surDrag);}}
const _avecTransformationFlux=() =>{return lOptions.avecTransformationFlux&&!!(global.GApplication&&GApplication.transformationFlux&&GApplication.transformationFlux.getActif&&GApplication.transformationFlux.getActif())&&!['image/*','application/zip'].includes(lOptions.accept);};function _removeInput(){if(lTimeoutDestroy){clearTimeout(lTimeoutDestroy);}
lTimeoutDestroy=null;if(lJInput){lJInput.remove();}
uInvocateurSelecFile.desabonner('drag',_surDrag);clearTimeout(lTimeoutDrag);clearTimeout(lTimeoutDragSurvol);lDragEnCours=false;lDragHoverEnCours=false;if(lOptions.classDrag){aContexteCourant.node.classList.remove(lOptions.classDrag);}
if(lOptions.classDragHoverSelec){aContexteCourant.node.classList.remove(lOptions.classDragHoverSelec);}
if(lOptions.eventSurDrag){lOptions.eventSurDrag({surDrag:false});}
if($('#'+uIdConteneurInputFile).length>0&&$('#'+uIdConteneurInputFile).children().length===0){ZoneFenetre.enleverFenetre(uIdConteneurInputFile);}
lJInput=null;lExisteInput=false;}
aContexteCourant.getOpenSelecFile=function(){lDesactiverClick_openFileManuel=true;return lOuvrirSelecteur;};function _scaleImage(aParams,aFichier,aMessagesErreur){return UtilitaireTraitementImage.resizeFilePromise(aFichier.file,lOptions.largeurMaxImageResize,lOptions.hauteurMaxImageResize,lOptions.compressionImage).then(function(aParamsTraitement){if(aParamsTraitement&&aParamsTraitement.avecResize&&aParamsTraitement.file&&aParamsTraitement.file.size<aFichier.file.size){const lAncienFichier=aFichier.file;aFichier.file=aParamsTraitement.file;aFichier.estResize=true;aMessagesErreur.push(GChaine.Format(GTraductions.getValeur('inputFile.reductionTailleImage_SDDDDDD'),[
aFichier.Libelle,aParamsTraitement.widthOriginal,aParamsTraitement.heightOriginal,lAncienFichier.size/1024,Math.round(aParamsTraitement.width),Math.round(aParamsTraitement.height),aFichier.file.size/1024
]));}}).catch(function(e){return null;});}
function _construireListeFichiers(aParams,aMessagesErreur){let lNbMax=lOptions.maxFiles;if(!lOptions.multiple){lNbMax=1;}
[].slice.call(aParams.files).forEach(function(aFile,aIndex){const lFichierRefuse=lNbMax>0&&
MethodesObjet.isNumber(lNbMax)&&
aIndex>=lNbMax;GLog.addLog('Fichier '+(lFichierRefuse?'refusé (max atteint)':'ajouté')+' : '+aFile.name+' - Taille : '+Math.ceil(aFile.size/1024)+'ko');if(lFichierRefuse){return;}
if(aFile.size===0){aMessagesErreur.push(GTraductions.getValeur('inputFile.msgDocJointVide',[aFile.name]));} else if(lOptions.extensions&&
lOptions.extensions.length>0&&
$.inArray(aFile.name.replace(/(.*)\.([^./]+)$/,'$2').toLowerCase(),lOptions.extensions)=== -1){aMessagesErreur.push(GTraductions.getValeur('inputFile.echecSelection',[lOptions.extensions.join(', ')]));} else{UtilitaireSelecFile.addFileDansListe(aFile,aParams.listeFichiers,lOptions.genrePJ);}});if(aParams.listeFichiers){aParams.listeFichiers.setTri([ObjetTri.init('lastModified'),ObjetTri.init('Libelle')]);aParams.listeFichiers.trier();}}
function _addFiles(aParams){if(lDisabled||!lExisteInput){return;}
const lMessagesErreur=[];aParams.listeFichiers=new ObjetListeElements();_construireListeFichiers(aParams,lMessagesErreur);let lAvecBlocageInterface=false;Promise.resolve().then(function(){if(aParams.listeFichiers.GetNbrElements()>0){Invocateur.evenement(ObjetInvocateur.events.patience,true,{delai:500});lAvecBlocageInterface=true;}}).then(function(){const lPromises=[];aParams.listeFichiers.parcourir(function(aFichier){if(lOptions.avecResizeImage&&UtilitaireTraitementImage.avecResizePossible(aFichier.file)){lPromises.push(_scaleImage(aParams,aFichier,lMessagesErreur));}});return Promise.all(lPromises);}).then(function(){if(!_avecTransformationFlux()){aParams.listeFichiers=UtilitaireSelecFile.controleTailleFichiers(aParams.listeFichiers,lMessagesErreur,lOptions.maxSize);}}).then(function(){if(lOptions.genererPDFImages&&aParams.listeFichiers.GetNbrElements()>0){return UtilitaireSelecFile.genererPdfPromise(aParams.listeFichiers,lMessagesErreur,lOptions.nomPDFaGenerer,lOptions.genrePJ).then(function(){if(!_avecTransformationFlux()){aParams.listeFichiers=UtilitaireSelecFile.controleTailleFichiers(aParams.listeFichiers,lMessagesErreur,lOptions.maxSize);}});}}).finally(function(){if(lAvecBlocageInterface){Invocateur.evenement(ObjetInvocateur.events.patience,false);}}).then(function(){if(lMessagesErreur.length>0){return GApplication.getMessage().afficher({message:lMessagesErreur.join('<br>')});}}).then(() =>{if(_avecTransformationFlux()){return GApplication.transformationFlux.transformationFlux_promise(aParams.listeFichiers,lOptions).catch(() =>{aParams.listeFichiers=UtilitaireSelecFile.controleTailleFichiers(aParams.listeFichiers,lMessagesErreur,lOptions.maxSize);});}}).then(function(){if(aParams.listeFichiers.GetNbrElements()>0){aParams.eltFichier=aParams.listeFichiers.GetElement(0);lInfosAdd.callback([aParams]);aContexteCourant.controleur.$refresh();}}).catch(function(e){GApplication.getMessage().afficher({message:GTraductions.getValeur('inputFile.EchecAjoutFichier')});}).then(function(){_removeInput();if(!lDisabled){_createInput();}});}
function _listenerClick(aEvent){if(lDisabled||!lExisteInput||!lOptions.eventClick||lDesactiverClick_openFileManuel){return;}
lOuvrirSelecteur();if(lOptions.interrompreClick){aEvent.stopImmediatePropagation();aEvent.preventDefault();return false;}}
function _listenerClickCapture(aEvent){if(lOptions.click_surEventCapture){_listenerClick(aEvent);}}
function _listenerClickBubbling(aEvent){if(!lOptions.click_surEventCapture){_listenerClick(aEvent);}}
aContexteCourant.node.addEventListener('click',_listenerClickCapture,true);aContexteCourant.node.addEventListener('click',_listenerClickBubbling,false);lJElement.on({'destroyed':function(){if(lJInput){lJInput.addClass('__destroyed__');}
lTimeoutDestroy=setTimeout(function(){_removeInput();},100);aContexteCourant.node.removeEventListener('click',_listenerClickCapture,true);aContexteCourant.node.removeEventListener('click',_listenerClickBubbling,false);},'dragenter.selecfile dragover.selecfile':function(aEvent){if(!lOptions.acceptDragDrop||lDisabled||!lExisteInput||!_eventDragAvecFiles(aEvent)){return;}
aEvent.originalEvent.__dropAccepted__=true;aEvent.preventDefault();if(lOptions.dragEnCoursVisible){clearTimeout(lTimeoutDragSurvol);if(lOptions.classDragHoverSelec&&!lDragHoverEnCours){lDragHoverEnCours=true;aContexteCourant.node.classList.add(lOptions.classDragHoverSelec);}}},'dragexit.selecfile dragleave.selecfile dragend.selecfile':function(){clearTimeout(lTimeoutDrag);clearTimeout(lTimeoutDragSurvol);if(lOptions.classDragHoverSelec&&lDragHoverEnCours){lTimeoutDragSurvol=setTimeout(function(){lDragHoverEnCours=false;aContexteCourant.node.classList.remove(lOptions.classDragHoverSelec);},lDureeTimeoutDrag);}},'drop.selecfile':function(aEvent){uInvocateurSelecFile.evenement('drag',{start:false});if(!lOptions.acceptDragDrop||lDisabled||!lExisteInput){return;}
aEvent.stopPropagation();aEvent.preventDefault();const lDataTransfert=aEvent.originalEvent.dataTransfer;if(lDataTransfert){const lFiles=Array.prototype.concat.apply([],lDataTransfert.files);if(lFiles.length>0){_addFiles({files:lFiles,event:aEvent,nodeInput:lJInput.get(0)});}}}});const lTitleOrigine=aContexteCourant.node.title;const lMAJDisabled=function(aDisabled){if(aDisabled){_removeInput();} else{_createInput();}
if(aDisabled&&lTitleOrigine&&lOptions.title){GHtml.setTitle(aContexteCourant.node,lTitleOrigine||'');} else if(!aDisabled&&lOptions.title){GHtml.setTitle(aContexteCourant.node,lOptions.title);}
if(lOptions.getClass){lJElement.removeClass(lOptions.getClass(!aDisabled)).addClass(lOptions.getClass(aDisabled));}};if(lInfosGetDisabled.valide){const lGetter=function(){return!!lInfosGetDisabled.callback([lJElement.get(0),aContexteCourant.data]);};if(lInfosGetDisabled.estFonction||!lGetter()||lGetter()===true){lDisabled=!!lGetter();aOutils.abonnerRefresh(function(){const lNewDisabled=!!lGetter();if(lNewDisabled!==lDisabled){lDisabled=lNewDisabled;lMAJDisabled(lDisabled);}},lJElement.get(0),aContexteCourant);} else{GLog.addLog('echec getDisabled de ie-selecfile, propriété incorrecte du model "'+lModele+'"');}}
lMAJDisabled(lDisabled);aOutils.addCommentaireDebug(aContexteCourant.node,'ie-selecfile');return true;});function _eventDragAvecFiles(aEvent){if(aEvent.originalEvent&&aEvent.originalEvent.dataTransfer&&aEvent.originalEvent.dataTransfer.items&&aEvent.originalEvent.dataTransfer.items.length>0){let lAvecFile=false;try{for(let i=0;i<aEvent.originalEvent.dataTransfer.items.length;i++){const lData=aEvent.originalEvent.dataTransfer.items[i];if(!lData||lData.kind!=='string'){lAvecFile=true;break;}}} catch(e){lAvecFile=true;}
return lAvecFile;}
return true;}
$(document).on({'dragenter.selecfile dragover.selecfile':function(aEvent){const lParams={start:true,avecSelecAbonne:false};if(_eventDragAvecFiles(aEvent)){uInvocateurSelecFile.evenement('drag',lParams);} else{lParams.avecSelecAbonne=false;}
if(lParams.avecSelecAbonne&&!aEvent.originalEvent.__dropAccepted__){aEvent.originalEvent.dataTransfer.dropEffect="none";return false;}},'dragexit.selecfile dragleave.selecfile dragend.selecfile drop.selecfile':function(){uInvocateurSelecFile.evenement('drag',{start:false});}});module.exports=IEHtml;},fn:"iehtml.selecfile.js"});;
IE.fModule({f:function(exports,require,module,global){const ObjetAbstraitInterface=require('ObjetInterface.js');const GHtml=require('GHtml.js');const GUID=require('GUID.js');class _InterfacePageProduit extends ObjetAbstraitInterface{constructor(...aParams){super(...aParams);this.contexte={niveauCourant:0,selection:[],guidRef:GUID.getId()};}
setOptionsEcrans(aOptions){this.optionsEcrans=aOptions;}
getIdDeNiveau(aParam){return this.contexte.guidRef+'_'+aParam.niveauEcran;}
setCtxEcran(aParam){this.contexte.ecran[aParam.niveauEcran]=aParam.genreEcran;}
getCtxEcran(aParam){return this.contexte.ecran[aParam.niveauEcran];}
setCtxSelection(aParam){this.contexte.selection[aParam.niveauEcran]=aParam.dataEcran;}
getCtxSelection(aParam){const lContexte=(aParam.contexte!==null)&&(aParam.contexte!==undefined)?aParam.contexte:this.contexte;return lContexte.selection[aParam.niveauEcran];}
getNiveauDeGenreEcran(aParam){for(let i=0,lNbr=this.optionsEcrans.nbNiveaux;i<lNbr;i++){if(this.contexte.ecran[i]===aParam.genreEcran){return i;}}
return null;}
basculerVisibiliteEcran(aParam){if(this.optionsEcrans.avecBascule){for(let i=0,lNbr=this.optionsEcrans.nbNiveaux;i<lNbr;i++){const lGuid=this.getIdDeNiveau({niveauEcran:i});$('#'+lGuid.escapeJQ()).css('display',i===aParam.niveauEcran?'':'none');}}
this.contexte.niveauCourant=aParam.niveauEcran;}
basculerVisibiliteSurGenreEcran(aGenreEcran){const lNiveauEcran=this.getNiveauDeGenreEcran({genreEcran:aGenreEcran})
;if(lNiveauEcran!==null){this.basculerVisibiliteEcran({niveauEcran:lNiveauEcran});}}
basculerEcran(aEcranPrec,aEcranSuiv){if((aEcranSuiv!==null)&&(aEcranSuiv!==undefined)){this.setCtxEcran({niveauEcran:aEcranSuiv.niveauEcran,genreEcran:aEcranSuiv.genreEcran});}
if((aEcranPrec!==null)&&(aEcranPrec!==undefined)){this.setCtxSelection({niveauEcran:aEcranPrec.niveauEcran,dataEcran:aEcranPrec.dataEcran});}
this.basculerVisibiliteSurGenreEcran(aEcranSuiv.genreEcran);return this.construireEcran(aEcranSuiv);}
revenirSurEcranPrecedent(){const lEcranSrc={niveauEcran:this.contexte.niveauCourant,genreEcran:this.getCtxEcran({niveauEcran:this.contexte.niveauCourant})};const lEcranDest={niveauEcran:this.contexte.niveauCourant-1,genreEcran:this.getCtxEcran({niveauEcran:this.contexte.niveauCourant-1})};this.basculerEcran(lEcranSrc,lEcranDest);}
setHtmlStructureAffichageBandeau(aHtml){GHtml.setHtml(GInterface.idZoneSelection,aHtml,{controleur:this.controleur,instance:this});}
construireBandeauEcran(aHtmlMetier,aParam){const H=[];H.push('<header class="nav-page-profonde-container',(aParam&&aParam.bgWhite?' bg-white':''),(aParam&&aParam.class?` ${aParam.class}`:''),'">');H.push('<ie-btnimage ie-model="btnRetourEcranPrec" class="fleche-nav btnImageIcon icon_retour_mobile"></ie-btnimage>');H.push('<div ',(aParam&&(aParam.avecRetourSurContenuBandeau===true)?' ie-node="retourEcranPrecSurContenu" ':''),' class="nav-container">',aHtmlMetier,'</div>');H.push('</header>');return H.join('');}}
module.exports=_InterfacePageProduit;},fn:"_interfacepageproduit.js"});;
IE.fModule({f:function(exports,require,module,global){const GHtml=require('GHtml.js');const EStructureAffichage=require('Enumere_StructureAffichage.js');const _InterfacePageProduit=require('_InterfacePageProduit.js');const GUID=require('GUID.js');class InterfacePage_Mobile extends _InterfacePageProduit{constructor(...aParams){super(...aParams);this.GenreStructure=EStructureAffichage.Verticale;this.avecBandeau=true;this._idAddZoneBandeau=GUID.getId();}
SetParametresGeneraux(){this.AvecCadre=false;this.IdentZoneAlClient=this.identPage;}
setGenreAffichage(aGenreAffichage){this.genreAffichage=aGenreAffichage;}
afficherMessage(aMessage){GHtml.setHtml(this.GetInstance(this.IdentZoneAlClient).GetNom(),this.composeAucuneDonnee(aMessage));}
composeAucuneDonnee(aHtml){return GHtml.composeFondAucuneDonnee(aHtml);}
ConstruireStructureAffichageVerticale(){const H=[];let lInfo;if(this.AddSurZone.length){H.push(this.ConstruireStructureAffichageBandeau());} else{$('#'+GInterface.idZoneSelection.escapeJQ()).html('').hide();}
const lTabAffichages=[];for(let I=0;I<this.NombreGenreAffichage;I++){if(!this.AppartientAZone(I)&&!GApplication.getObjetGraphique(this.GenreAffichage[I]).estFenetre){if(GApplication.getObjetGraphique(this.GenreAffichage[I])){lInfo={estZoneClient:this.IdentZoneAlClient===I,indice:I};}
lTabAffichages.push(lInfo);}}
for(let I=0;I<lTabAffichages.length;I++){lInfo=lTabAffichages[I];H.push('<div ');if(lInfo.estZoneClient){this._infoPourResize={id:this.GetZoneId(lInfo.indice),padding:0};}
H.push('id="'+this.GetZoneId(lInfo.indice)+'">');H.push('</div>');}
return H.join('');}
ConstruireStructureAffichageBandeau(){const H=[];let lInfo;const lTabAffichages=[];for(let I=0;I<this.NombreGenreAffichage;I++){if(this.AppartientAZone(I)&&!GApplication.getObjetGraphique(this.GenreAffichage[I]).estFenetre){lInfo={estZoneClient:this.IdentZoneAlClient===I,indice:I};lTabAffichages.push(lInfo);}}
for(let I=0;I<lTabAffichages.length;I++){lInfo=lTabAffichages[I];H.push('<div ');if(lInfo.estZoneClient){this._infoPourResize={id:this.GetZoneId(lInfo.indice),padding:0};}
H.push('id="'+this.GetZoneId(lInfo.indice)+'">');H.push('</div>');}
for(let I=0,lNbr=this.AddSurZone.length;I<lNbr;I++){lInfo=_getInfosSurZone.call(this,I);if(lInfo&&lInfo.html){H.push('<div ');H.push('id="'+this._idAddZoneBandeau+I+'" ',(lInfo.getDisplay?' ie-display="'+lInfo.getDisplay+'"':''),' >');H.push(lInfo.html&&!lInfo.controleur?lInfo.html:'');H.push('</div>');}}
GHtml.setHtml(GInterface.idZoneSelection,H.join(''),{controleur:this.controleur,instance:this});$('#'+GInterface.idZoneSelection.escapeJQ()).show();for(let I=0,lNbr=this.AddSurZone.length;I<lNbr;I++){lInfo=_getInfosSurZone.call(this,I);if(lInfo.controleur){GHtml.setHtml(this._idAddZoneBandeau+I,lInfo.html,{controleur:lInfo.controleur});}}}}
function _getInfosSurZone(aIndice){const lElement=this.AddSurZone[aIndice];return $.extend({ident:lElement&&(lElement.html||lElement.separateur)?null:lElement,html:null,controleur:null,getDisplay:null,alignementDroite:false,separateur:false},lElement);}
module.exports=InterfacePage_Mobile;},fn:"interfacepage_mobile.js"});;
IE.fModule({f:function(exports,require,module,global){const GUID=require('GUID.js');const{ObjetInvocateur,Invocateur}=require('Invocateur.js');const MethodesObjet=require('MethodesObjet.js');const ObjetAbstraitInterface=require('ObjetInterface.js');const EGenreAction=require('Enumere_Action.js');const EGenreBoiteMessage=require('Enumere_BoiteMessage.js');const FenetreModale_Patience=require('FenetreModale_Patience.js');const InterfacePage_Mobile=require('InterfacePage_Mobile.js');const Support=require('ObjetSupport.js');const GTraductions=require('ObjetTraduction.js');const ControleSaisieEvenement=require('ControleSaisieEvenement.js');const ObjetFenetre=require('ObjetFenetre.js');class _ObjetInterfaceMobile extends ObjetAbstraitInterface{constructor(...aParams){super(...aParams);this.largeur='100%';this.hauteur='100%';this.idZoneSelection=this.Nom+'_zoneSelection';this.idZonePrincipale=this.Nom+'_zonePrincipale';this.idPanel=this.Nom+'_panel';if(Support.supportEventOnPopState){$(window).off('popstate').on('popstate',{instance:this},_surPopState);}
Invocateur.abonner('OuvrirFenetreLienPDF',this._surOuvrirLienPDF.bind(this));Invocateur.abonner(ObjetInvocateur.events.fermerFenetres,function(){$(document).find('.modal:not(.fermerFenetreEventInterne)').each(function(){const lInstance=M.Modal.getInstance(this);if(lInstance&&lInstance.isOpen){lInstance.close();}});const lInstancePanel=M.Sidenav.getInstance($('#'+this.idPanel.escapeJQ()));if(lInstancePanel&&lInstancePanel.isOpen){lInstancePanel.close();}},this);Invocateur.abonner(ObjetInvocateur.events.navigationOnglet,function(aOnglet,aParams){const lParams=Object.assign({fermerMenu:false,ajouterHistorique:true,genreAffichage:undefined},aParams);this.evenementSurOnglet(aOnglet,lParams.fermerMenu,lParams.ajouterHistorique,lParams.genreAffichage);},this);}
DetruireInstances(){$(window).off('popstate');}
SetParametresGeneraux(){this.AvecCadre=false;}
_construireInstances(aParam){this.fenetreModalePatience=new FenetreModale_Patience();this.identPageMobile=this.Add(InterfacePage_Mobile);if((!aParam||!aParam.sansMenuOnglet)&&this.options.InterfacePageMenuOnglets){this.idMenuOnglets=this.Add(this.options.InterfacePageMenuOnglets,this.evenementSurOnglet,this.initMenuOnglet);}
if(this.options.ObjetEnteteMobile){this.identEnteteMobile=this.Add(this.options.ObjetEnteteMobile,this.evenementEnteteMobile,this.initEntete);}
this.IdentBandeauPied=this.AjouterBandeauPied();}
getControleur(aInstance){return $.extend(true,super.getControleur(this),{afficherMasquerFooter:function(){return aInstance.GenreOnglet===null||aInstance.GenreOnglet===aInstance.getGenreOngletAccueil();}});}
initMenuOnglet(aInstance){aInstance.SetParametres({avecListeRessources:this.avecChangementRessource()});}
changementRessource(){}
avecChangementRessource(){}
getListeRessources(){}
AjouterBandeauPied(){return null;}
ConstruireStructureAffichage(){const lZones=[];lZones.push(this.fenetreModalePatience.composerConteneur());if(this.idMenuOnglets!==undefined){lZones.push('<div id="',this.GetInstance(this.idMenuOnglets).GetNom(),'" class=" sidenav aside-nav-right"></div>');}
const lAfficherFooter=(!GNavigateur.isAndroid&&!GNavigateur.isIOS)||(GNavigateur.isIOS&&GNavigateur.versionIOS&&(GNavigateur.versionIOS[0]>10||(GNavigateur.versionIOS[0]===10&&GNavigateur.versionIOS[1]>3)))||(GNavigateur.isAndroid&&GNavigateur.versionAndroid&&GNavigateur.versionAndroid[0]>=6);lZones.push('<div id="',this.GetInstance(this.identEnteteMobile).GetNom(),'" class="navbar-fixed "></div>','<div class="content-mobile-wrapper">','<div id="',this.idZoneSelection,'" style="display:none;" class="objetInterfaceMobile_zoneSelection"></div>','<div id="',this.idZonePrincipale,'" role="main" class="objetInterfaceMobile_zonePrincipale">','<div id="',this.GetInstance(this.identPageMobile).GetNom(),'" class="objetInterfaceMobile_identPage"></div>','<div id="',this.idPanel,'" class="sidenav side-panel"></div>','</div>',this.IdentBandeauPied>=0&&lAfficherFooter?'<div class="footer-mobile" ie-display="afficherMasquerFooter" id="'+this.GetInstance(this.IdentBandeauPied).GetNom()+'" ></div>':'');lZones.push('</div>');return lZones.join('');}
RecupererDonnees(){this.actionSurRecupererDonnees();}
getEtatSaisie(){return GEtatUtilisateur.EtatSaisie;}
getGenreOnglet(){}
getGenreOngletAccueil(){}
CreerPage(aGenreOnglet){const lConstructeur=this._getConstructeurOnglet(aGenreOnglet)
;const lObjetPageMobile=this.ConstruireObjetGraphique(lConstructeur,this.identPageMobile,this.evenementPageMobile);return lObjetPageMobile;}
_ajouterHistorique(aOnglet,aGenreAffichage){if(!!aOnglet&&Support.supportEventOnPopState){try{window.history.pushState({onglet:aOnglet,genreAffichage:aGenreAffichage,numeroSession:GApplication.getCommunication().NumeroDeSession},'');} catch(e){}}}
evenementPageMobile(){}
evenementEnteteMobile(){}
getPageCourante(){return this.GetInstance(this.identPageMobile);}
traiterEvenementConfirmationSortie(){if(this.genreOngletSuivant){this.SetEtatSaisie(false);this.evenementSurOnglet(this.genreOngletSuivant,true,true,this.genreAffichageSuivant);this.genreOngletSuivant=null;this.genreAffichageSuivant=null;}}
initEntete(aInstance){if(this.idMenuOnglets!==undefined){aInstance.SetParametres({idPanel:this.GetInstance(this.idMenuOnglets).GetNom()});}}
openPanel(aHtml,aParametresHtml,aParametresSideNav){const lSideNav=_getInstanceSideNavPanel.call(this,aParametresSideNav);const lParamsSideNav=Object.assign({inDuration:250,outDuration:200,onOpenStart:null,onOpenEnd:null,onCloseStart:null,onCloseEnd:null},aParametresSideNav||{});if(lSideNav.isOpen){lParamsSideNav.inDuration=0;lSideNav.options.outDuration=0;lSideNav.close();}
const $panel=$('#'+this.idPanel.escapeJQ());$panel.IEHtml(aHtml,aParametresHtml);Object.assign(lSideNav.options,lParamsSideNav);lSideNav.open();}
closePanel(){_getInstanceSideNavPanel.call(this).close();}
isPanelOpened(){return _getInstanceSideNavPanel.call(this).isOpen;}
updatePanelContent(aHtml,aParametres){const $panel=$('#'+this.idPanel.escapeJQ());$panel.IEHtml(aHtml,aParametres);}
evenementSurOnglet(aGenreOnglet,aFermerMenu,aAjouterHistorique,aGenreAffichage){if(this.getEtatSaisie()===true&&!GApplication.getModeExclusif()){this.genreOngletSuivant=$.isNumeric(aGenreOnglet)?parseInt(aGenreOnglet):aGenreOnglet;this.genreAffichageSuivant=aGenreAffichage;ControleSaisieEvenement(this.traiterEvenementConfirmationSortie.bind(this));} else{this.SetEtatSaisie(false);const lFermerMenu=(aFermerMenu!==null&&aFermerMenu!==undefined)?aFermerMenu:true,lAjouterHistorique=(aAjouterHistorique!==null&&aAjouterHistorique!==undefined)?aAjouterHistorique:true;this.genreOngletSuivant=null;this.genreAffichageSuivant=null;this.genreOngletPrecedent=this.GenreOnglet;this.GenreOnglet=$.isNumeric(aGenreOnglet)?parseInt(aGenreOnglet):aGenreOnglet;if(aGenreAffichage){this.genreAffichage=aGenreAffichage;} else{this.genreAffichage=null;}
if(GEtatUtilisateur.setGenreAffichage){GEtatUtilisateur.setGenreAffichage(this.genreAffichage);}
if(!!this.idMenuOnglets){this.GetInstance(this.idMenuOnglets).setOnglet(aGenreOnglet);}
this.actionSurEvenementOnglet(lFermerMenu);if(lAjouterHistorique){this._ajouterHistorique(aGenreOnglet,aGenreAffichage);}}}
evenementAvantAffichageOnglet(){}
actionSurEvenementOnglet(aFermerMenu){if(aFermerMenu){this.fermerMenuOnglet();}
Invocateur.evenement(ObjetInvocateur.events.fermerFenetres);if(this.GetInstance(this.identPageMobile)&&this.GetInstance(this.identPageMobile).free){this.GetInstance(this.identPageMobile).free();}
this.Instances[this.identPageMobile]=null;if(GApplication.estAppliMobile){window.messageData.push({action:'actionOnglet'});}
$('body > [id^="select-options"]').remove();this.evenementAvantAffichageOnglet(this.GenreOnglet);const lInstancePage=this.Instances[this.identPageMobile]=this.CreerPage(this.GenreOnglet);lInstancePage.setGenreAffichage(this.genreAffichage);GEtatUtilisateur.setGenreOnglet(this.GenreOnglet);this.GetInstance(this.identEnteteMobile).setBoutonAccueil(true);this.GetInstance(this.identEnteteMobile).actualiserTitre();lInstancePage.Initialiser();if((this.genreAffichage!==null&&this.genreAffichage!==undefined)){GEtatUtilisateur.resetPage();}
this.GetInstance(this.identEnteteMobile).focusTitre();const lJSelec=$('#'+this.idZoneSelection.escapeJQ()+', #'+this.idZonePrincipale.escapeJQ());if(lInstancePage.avecPageFondBlanc){lJSelec.addClass('fond-blanc');} else{lJSelec.removeClass('fond-blanc');}
this.$refreshSelf();}
ouvrirMenuOnglet(){if(!!this.GetInstance(this.idMenuOnglets)){$('#'+this.GetInstance(this.idMenuOnglets).GetNom().escapeJQ()).sidenav('open');}}
fermerMenuOnglet(){if(!!this.GetInstance(this.idMenuOnglets)){$('#'+this.GetInstance(this.idMenuOnglets).GetNom().escapeJQ()).sidenav('close');}}
actionSurRecupererDonnees(){}
_surOuvrirLienPDF(aUrl){const T=[];const lId=GUID.getId();T.push('<a href="'+aUrl+'" id="',lId,'" class="link" target="_blank">'+GTraductions.getValeur('GenerationPDF.Lien.CliquerIci')+'</a>');const lFenetre=ObjetFenetre.creerInstance(ObjetFenetre,{pere:this,initialiser:function(aInstance){aInstance.setOptionsFenetre({titre:GTraductions.getValeur('GenerationPDF.Lien.TitreLienPDF')});}});lFenetre.Afficher(T.join(''));$('#'+lId).click(function(){if(!!lFenetre){lFenetre.Fermer();}});}
_getConstructeurOnglet(){}}
function _surPopState(event){const lEtat=event.originalEvent.state,lInstance=event.data.instance;if(!lEtat||lEtat.onglet===undefined||lEtat.numeroSession!==GApplication.getCommunication().NumeroDeSession){event.stopImmediatePropagation();if(!GApplication.estAppliMobile){setTimeout(function(){GApplication.getMessage().afficher({type:EGenreBoiteMessage.Confirmation,message:GTraductions.getValeur('mobile.confirmDeco'),callback:_evenementPrecedentSuivantDeconnexion});},10);} else{event.preventDefault();}} else{if(lInstance._surForward){delete lInstance._surForward;return;}
ControleSaisieEvenement(function(){lInstance.evenementSurOnglet(lEtat.onglet,null,false,lEtat.genreAffichage);});}}
function _evenementPrecedentSuivantDeconnexion(aAccepte){if(aAccepte===EGenreAction.Valider){window.location.reload();} else{this._surForward=true;window.history.forward();}}
function _getInstanceSideNavPanel(aParametresSideNav){const $panel=$('#'+this.idPanel.escapeJQ());let lInstancePanel=M.Sidenav.getInstance($panel);if(!lInstancePanel){M.Sidenav.init($panel,Object.assign({edge:'right',draggable:false},aParametresSideNav));lInstancePanel=M.Sidenav.getInstance($panel);}
return lInstancePanel;}
module.exports=_ObjetInterfaceMobile;},fn:"_interfacemobile.js"});;
IE.fModule({f:function(exports,require,module,global){const TypeGenreDiscussion={GD_Discussion:0,GD_ContactVS:1,GD_Conversation:2,GD_Alerte:3};module.exports.TypeGenreDiscussion=TypeGenreDiscussion;},fn:"typegenrediscussion.js"});;
IE.fModule({f:function(exports,require,module,global){const TypeOrigineCreationModeleAlerte={OCMA_Utilisateur:0,OCMA_Pre_Incendie:1,OCMA_Pre_Confinement:2,OCMA_Pre_Inondation:3,OCMA_Pre_Nucleaire:4,OCMA_Pre_Defaut:5,OCMA_Pre_Tsunami:6};module.exports.TypeOrigineCreationModeleAlerte=TypeOrigineCreationModeleAlerte;},fn:"typeoriginecreationmodelealerte.js"});;
IE.fModule({f:function(exports,require,module,global){require('espace/css/ObjetFenetre_SplashAlerte.css');const GChaine=require('GChaine.js');const{GDate}=require('ObjetDate.js');const ObjetFenetre=require('ObjetFenetre.js');const GTraductions=require('ObjetTraduction.js');const TypeOrigineCreationModeleAlerte=require('TypeOrigineCreationModeleAlerte.js').TypeOrigineCreationModeleAlerte;class ObjetFenetre_SplashAlerte extends ObjetFenetre{constructor(...aParams){super(...aParams);this.classExercice='color-danger';this.setOptionsFenetre({modale:true,fermerFenetreSurClicHorsFenetre:true,largeur:null,largeurMin:450,hauteurBandeau:25,couleurFond:'white',listeBoutons:[GTraductions.getValeur('Fermer'),GTraductions.getValeur('SplashAlerte.OuvrirDiscussion')]});}
ComposeContenu(){const T=[];if(!this.message){return'';}
T.push('<div class="ofsa_contenu">','<div>','<div class="',this.optionsFenetre.classImageAlerte,'"></div>',(this.message.exercice?`<div class="AlignementMilieu Texte12 PetitEspaceHaut Gras ${this.classExercice}">`+GTraductions.getValeur('SplashAlerte.Exercice').toUpperCase()+'</div>':''),'</div>','<div>',this.message.contenu,'</div>','</div>');return T.join('');}
ComposeBas(){return this.message?'<div class="ofsa_lancerPar">'+
_strLanceePar.call(this)+'</div>':'';}
setMessage(aMessage,aTitre){this.message=aMessage;let lClassImage='';switch(this.message.genreAlerte){case TypeOrigineCreationModeleAlerte.OCMA_Pre_Incendie:lClassImage='Image_AlerteIncendie';this.classExercice='color-incendie';break;case TypeOrigineCreationModeleAlerte.OCMA_Pre_Confinement:lClassImage='Image_AlerteConfinement';this.classExercice='color-confinement';break;case TypeOrigineCreationModeleAlerte.OCMA_Pre_Inondation:lClassImage='Image_AlerteInondation';this.classExercice='color-inondation';break;case TypeOrigineCreationModeleAlerte.OCMA_Pre_Nucleaire:lClassImage='Image_AlerteNucleaire';this.classExercice='color-nucleaire';break;case TypeOrigineCreationModeleAlerte.OCMA_Pre_Tsunami:lClassImage='Image_AlerteTsunami';this.classExercice='color-tsunami';break;case TypeOrigineCreationModeleAlerte.OCMA_Pre_Defaut:case TypeOrigineCreationModeleAlerte.OCMA_Utilisateur:lClassImage='Image_AlerteDanger';this.classExercice='color-danger';break;default:;}
this.setOptionsFenetre({titre:aTitre.toUpperCase(),classImageAlerte:lClassImage});}}
function _strLanceePar(){return this.message?GChaine.Format(GTraductions.getValeur('SplashAlerte.LanceeLeAPar'),[
GDate.FormatDate(this.message.dateSplash,'%JJ/%MM'),GDate.FormatDate(this.message.dateSplash,'%hh%sh%mm'),this.message.emetteur
]):'';}
module.exports=ObjetFenetre_SplashAlerte;},fn:"objetfenetre_splashalerte.js"});;
IE.fModule({f:function(exports,require,module,global){const{ObjetRequeteSaisie,EGenreReponseSaisie}=require('ObjetRequeteJSON.js');const{Invocateur}=require('Invocateur.js');const MethodesObjet=require('MethodesObjet.js');const Requetes=require('CollectionRequetes.js');const ObjetFenetre=require('ObjetFenetre.js');const ObjetElement=require('ObjetElement.js');const ObjetListeElements=require('ObjetListeElements.js');const GTraductions=require('ObjetTraduction.js');const ObjetTri=require('ObjetTri.js');const TypeGenreDiscussion=require('TypeGenreDiscussion.js').TypeGenreDiscussion;const EGenreRessource=require('Enumere_Ressource.js');const ObjetFenetre_SplashAlerte=require('ObjetFenetre_SplashAlerte.js');const TypeOrigineCreationModeleAlerte=require('TypeOrigineCreationModeleAlerte.js').TypeOrigineCreationModeleAlerte;const GChaine=require('GChaine.js');const TypeGenreStatutConnexion=require('TypeStatutConnexion.js').TypeGenreStatutConnexion;Requetes.inscrire('SaisieContactVieScolaire',ObjetRequeteSaisie)
;let uFenetreAlerteSplash_Visible=false;let uCacheListeModelesAlerte=null;class UtilitaireContactVieScolaire{constructor(){this.listeAlertePPMSEnCours=new ObjetListeElements();this.compteurFenetreAlertePPMS=0;}
demarrerMessageInstantane(){Requetes('SaisieContactVieScolaire',{}).setOptions({messageDetail:''}).lancerRequete({pourContactVS:false}).then(function(aReponse){if(aReponse.genreReponse!==EGenreReponseSaisie.succes){return;}
const lListeContacts=aReponse.JSONReponse.listeContacts;if(!lListeContacts||!aReponse.JSONRapportSaisie.listeDestinataires){return GApplication.getMessage().afficher({titre:GTraductions.getValeur('ModeExclusif.UsageExclusif'),message:GTraductions.getValeur('ModeExclusif.SaisieImpossibleConsultation')});}
this.afficher_destMessageInstantane({listeContacts:lListeContacts,listeDestinataires:aReponse.JSONRapportSaisie.listeDestinataires,statutConnexion:aReponse.JSONReponse.statutConnexion,creerDiscussionContactVS:this.creerDiscussionVieScolaire.bind(this),creerMessageInstantane:function(aListeConnectes,aListeNonConnectes){if(aListeConnectes.GetNbrElements()>0){this.creerChat({genreDiscussion:TypeGenreDiscussion.GD_Conversation,listeContacts:lListeContacts,listeDestinataires:new ObjetListeElements().add(aListeConnectes).add(aListeNonConnectes),objet:GTraductions.getValeur('Messagerie.Conversation')});} else{this.creerNouvelleDiscussion({genreDiscussion:TypeGenreDiscussion.GD_Discussion,listeContacts:lListeContacts,listeDestinataires:aListeNonConnectes});}}.bind(this)});}.bind(this),function(){});}
afficher_destMessageInstantane(){}
creerDiscussionVieScolaire(){Requetes('SaisieContactVieScolaire',{}).setOptions({messageDetail:''}).lancerRequete({pourContactVS:true}).then(function(aReponse){if(aReponse.genreReponse!==EGenreReponseSaisie.succes){return;}
if(!aReponse.JSONRapportSaisie.listeDestinataires||aReponse.JSONRapportSaisie.listeDestinataires.GetNbrElements()===0){GApplication.getMessage().afficher({message:GTraductions.getValeur('Messagerie.AucunPersonnelConnecte')});return;}
const lListeContacts=aReponse.JSONReponse.listeContacts;lListeContacts.trier();aReponse.JSONRapportSaisie.listeDestinataires.trier();const lListeSelectionnables=MethodesObjet.dupliquer(aReponse.JSONRapportSaisie.listeDestinataires);lListeContacts.parcourir(function(aRessource){const lRessourceTrouve=lListeSelectionnables.GetElementParElement(aRessource);if(!lRessourceTrouve){aRessource.nonEditable=true;}});this.creerChat({genreDiscussion:TypeGenreDiscussion.GD_ContactVS,estContactVS:true,listeContacts:lListeContacts,listeDestinataires:aReponse.JSONRapportSaisie.listeDestinataires,listeSelectionnables:lListeSelectionnables,objet:GTraductions.getValeur('Messagerie.ContacterVS')});}.bind(this),function(){});}
creerAlertePPMS(){Requetes('SaisieContactVieScolaire',{}).setOptions({messageDetail:''}).lancerRequete({pourContactVS:false,pourAlerte:true,avecListeModelesAlerte:!uCacheListeModelesAlerte}).then(function(aReponse){if(aReponse.genreReponse!==EGenreReponseSaisie.succes){return;}
if(!aReponse.JSONReponse.listeContacts){GApplication.getMessage().afficher({titre:GTraductions.getValeur('ModeExclusif.UsageExclusif'),message:GTraductions.getValeur('ModeExclusif.SaisieImpossibleConsultation')});return;}
if(aReponse.JSONReponse.listeModelesAlerte){uCacheListeModelesAlerte=aReponse.JSONReponse.listeModelesAlerte;}
if(!uCacheListeModelesAlerte){return;}
const lAlerte={estExercice:false,modeleAlerte:uCacheListeModelesAlerte.GetElement(0),listeModelesAlerte:uCacheListeModelesAlerte};const lListeContacts=aReponse.JSONReponse.listeContacts;const lListeDestinataires=new ObjetListeElements().add(lListeContacts).trier();const lHashParents={};lListeContacts.parcourir(function(aElement){const lGenre=aElement.GetGenre();if(!lHashParents[lGenre]){const lParent=new ObjetElement(lGenre===EGenreRessource.Personnel?GTraductions.getValeur('Messagerie.Personnels'):GTraductions.getValeur('Messagerie.Profs'),0,lGenre);lHashParents[lGenre]=lParent;lParent.estUnDeploiement=true;lParent.estDeploye=true;}
aElement.pere=lHashParents[lGenre];});for(const lKey in lHashParents){lListeContacts.AddElement(lHashParents[lKey]);}
this.creerChat({genreDiscussion:TypeGenreDiscussion.GD_Alerte,listeContacts:lListeContacts,listeDestinataires:lListeDestinataires,alerte:lAlerte,objet:GTraductions.getValeur('Messagerie.AlerteEnseignantsPersonnels')});}.bind(this),function(){});}
_getTitreAlerteDeMessage(aMessage){if(aMessage.genreAlerte===TypeOrigineCreationModeleAlerte.OCMA_Pre_Defaut){return aMessage.libelleAlerte||GTraductions.getValeur('SplashAlerte.AlerteDefaut');}
return GTraductions.getValeur('SplashAlerte.AlerteDefaut')+(aMessage.libelleAlerte?' '+aMessage.libelleAlerte:'');}
_getInfosChatMessage(aMessage){const lResult={titre:GTraductions.getValeur('Messagerie.ContacterVS'),contenuInitial:''};if(aMessage.estAlerte){lResult.titre=GChaine.Format(aMessage.perso?GTraductions.getValeur('Messagerie.AlerteTypeeEnseignantsPersonnels'):GTraductions.getValeur('Messagerie.AlerteTypeeLanceePar'),[this._getTitreAlerteDeMessage(aMessage),aMessage.emetteur]);} else if(aMessage.emetteur&&aMessage.GetGenre()===TypeGenreDiscussion.GD_ContactVS){lResult.titre=GChaine.Format(GTraductions.getValeur('Messagerie.AppelDe'),[aMessage.emetteur]);} else if(aMessage.GetGenre()===TypeGenreDiscussion.GD_Conversation){if(aMessage.contenu){lResult.titre=aMessage.contenu;} else if(aMessage.emetteur){lResult.titre=GChaine.Format('%s - %s',[GTraductions.getValeur('Messagerie.Conversation'),aMessage.emetteur]);}} else if(aMessage.objet){lResult.titre=aMessage.objet+(aMessage.public?' - '+aMessage.public:'');}
if(!aMessage.estAlerte&&aMessage.GetGenre()===TypeGenreDiscussion.GD_ContactVS&&aMessage.listePossessionsMessages&&aMessage.listePossessionsMessages.GetNbrElements()===1){lResult.contenuInitial=GTraductions.getValeur('Messagerie.DemandePriseEnCompte');}
return lResult;}
afficherAlertePPMS(){_afficherChatVS.call(this,this.listeAlertePPMSEnCours,{ignorerAlertePPMSSpalsh:true,filtre:function(aMessage){if(aMessage.estFenetreAffichee){return false;}}});}
_avecConversationsEnPopup(){return GApplication.donneesCentraleNotifications.statutConnexionCommunication!==TypeGenreStatutConnexion.GSC_Disponible;}
declarer(){const lInstance=this;Invocateur.abonner('notification_chatVS',function(aListe){Invocateur.evenement('traiter_notifications_chatVS',aListe);_afficherChatVS.call(lInstance,aListe,{filtre:function traiterMessage(aMessage){if(aMessage.estAlerte){const lIndice=_getIndiceMessageDansListe(aMessage,lInstance.listeAlertePPMSEnCours),lMessageTrouve=lInstance.listeAlertePPMSEnCours.GetElement(lIndice);if(lIndice>=0&&lMessageTrouve){if(aMessage.cloture){lInstance.listeAlertePPMSEnCours.remove(lIndice);if(uFenetreAlerteSplash_Visible){uFenetreAlerteSplash_Visible.fermerSiEstAlerte(aMessage);}} else{Object.assign(lMessageTrouve,aMessage);aMessage.estAlerteSplash=false;}
if(lMessageTrouve.estFenetreAffichee){return false;}} else if(!aMessage.cloture){lInstance.listeAlertePPMSEnCours.AddElement(aMessage);}
if(!aMessage.estAlerteSplash&&
lInstance.compteurFenetreAlertePPMS===0){return false;}}
switch(aMessage.GetGenre()){case TypeGenreDiscussion.GD_Discussion:return false;}
if(aMessage.perso){return false;}
return true;}});});lInstance.listeAlertePPMSEnCours=GApplication.donneesCentraleNotifications.listeNotifsChatVS||new ObjetListeElements();_afficherChatVS.call(lInstance,lInstance.listeAlertePPMSEnCours,{filtre:function(aMessage){if(!aMessage.estAlerteSplash){return false;}
if(uFenetreAlerteSplash_Visible){return false;}}});}}
function _afficherChatVS(aListe,aOptions){const lOptions=Object.assign({filtre:null,ignorerAlertePPMSSpalsh:false},aOptions);if(!aListe){return;}
const lListePourFenetre=new ObjetListeElements();const lInstance=this;aListe.parcourir(function(aMessage){if(aMessage.messageDejaTraite&&!aMessage.estAlerte){return;}
if(MethodesObjet.isFunction(lOptions.filtre)&&lOptions.filtre(aMessage)===false){return;}
if(aMessage.estAlerteSplash){aMessage.estAlerteSplash=false;if(!uFenetreAlerteSplash_Visible&&
lOptions.ignorerAlertePPMSSpalsh!==true&&
lInstance.compteurFenetreAlertePPMS===0){const lFenetre=ObjetFenetre.creerInstance(ObjetFenetre_SplashAlerte,{pere:GInterface,evenement:function(aNumeroBouton){if(aNumeroBouton===1){lInstance.afficherAlertePPMS();}},initialiser:function(aInstance){aInstance.setMessage(aMessage,lInstance._getTitreAlerteDeMessage(aMessage));aInstance.setOptionsFenetre({callbackFermer:function(){uFenetreAlerteSplash_Visible=null;}});}});lFenetre.Afficher();try{new Audio('sons/AlertePPMS.mp3').addEventListener('canplaythrough',function(){this.loop=true;this.play();const lTimer=setInterval(() =>{if(!lFenetre.EnAffichage){this.loop=false;clearInterval(lTimer);}},500);setTimeout(() =>{this.loop=false;clearInterval(lTimer);},60000);});} catch(error){}
uFenetreAlerteSplash_Visible={fermerSiEstAlerte:function(aMessageAlerteCloturee){if(_getIndiceMessageDansListe(aMessageAlerteCloturee,new ObjetListeElements().add(aMessage))>=0){lFenetre.Fermer();return true;}
return false;}};return;}}
lListePourFenetre.AddElement(aMessage);});lListePourFenetre.setTri([ObjetTri.init('date')]).trier();this.creerChatDeListe(lListePourFenetre);}
function _getIndiceMessageDansListe(aMessageModele,aListe){let lIndice= -1;if(aMessageModele&&aMessageModele.listePossessionsMessages&&aMessageModele.listePossessionsMessages.GetNbrElements()){aListe.parcourir(function(aMessage,aIndice){if(aMessage.listePossessionsMessages){aMessage.listePossessionsMessages.parcourir(function(aPossession){if(aMessageModele.listePossessionsMessages.GetElementParElement(aPossession)){lIndice=aIndice;return false;}});}
if(lIndice>=0){return false;}});}
return lIndice;}
module.exports=UtilitaireContactVieScolaire;},fn:"utilitairecontactviescolaire.js"});;
IE.fModule({f:function(exports,require,module,global){const EGenreDirectionSlide={Aucune:0,Droite:1,Gauche:2};module.exports=EGenreDirectionSlide;},fn:"egenredirectionslide.js"});;
IE.fModule({f:function(exports,require,module,global){const Identite=require('ObjetIdentite.js');const Support=require('ObjetSupport.js');const EGenreDirectionSlide=require('EGenreDirectionSlide.js');const GHtml=require('GHtml.js')
;class ObjetIdentite_Mobile extends Identite{constructor(...aParams){super(...aParams);this.avecSlide=false;this.enSlide=false;this.swipeTabActif=false;}
Afficher(aHtml,aDirectionSlide){const lElementActuel=$('#'+this.Nom.escapeJQ()),lElementAvecContenu=!!lElementActuel.html();let lClassSlide='';let lNouveauContainer;if(!this.enSlide&&this.avecSlide&&$.isNumeric(aDirectionSlide)&&aDirectionSlide!==EGenreDirectionSlide.Aucune&&lElementAvecContenu){lNouveauContainer=lElementActuel.clone();lElementActuel.attr('id','').css({position:'absolute',width:'100%',height:lElementActuel.height()+'px'});if(aDirectionSlide===EGenreDirectionSlide.Droite){lClassSlide='slide-to-right';} else if(aDirectionSlide===EGenreDirectionSlide.Gauche){lClassSlide='slide-to-left';}
lElementActuel.wrap('<div class="slide-wrapper"><div class="slide-container"></div></div>').after(lNouveauContainer.addClass(lClassSlide));}
super.Afficher(aHtml);if(!this.enSlide&&this.avecSlide&&$.isNumeric(aDirectionSlide)&&aDirectionSlide!==EGenreDirectionSlide.Aucune&&lElementAvecContenu){this.enSlide=true;lElementActuel.parent().one(Support.transitionEndEvent,(function(){lNouveauContainer.siblings().remove();lNouveauContainer.removeClass(lClassSlide);lNouveauContainer.unwrap('.slide-container').unwrap('.slide-wrapper');this.enSlide=false;}).bind(this)).addClass(lClassSlide);}}
composeAucuneDonnee(aHtml){return GHtml.composeFondAucuneDonnee(aHtml);}}
module.exports=ObjetIdentite_Mobile;},fn:"objetidentite_mobile.js"});;
IE.fModule({f:function(exports,require,module,global){const TypeOrigineCreationEtiquetteMessage={OCEM_Utilisateur:0,OCEM_Pre_Reception:1,OCEM_Pre_Archive:2,OCEM_Pre_Envoye:3,OCEM_Pre_Brouillon:4,OCEM_Pre_Poubelle:5,OCEM_Pre_Signalement:6,OCEM_Expl_Bleu:7,OCEM_Expl_Vert:8,OCEM_Expl_Rouge:9,OCEM_Pre_CarnetLiaison:10,OCEM_Pre_Alerte:11,OCEM_Pre_ContactVS:12,OCEM_Pre_Conversation:13,OCEM_Pre_InvisiblePlageDesactivee:14};module.exports.TypeOrigineCreationEtiquetteMessage=TypeOrigineCreationEtiquetteMessage;TypeOrigineCreationEtiquetteMessage.estEtiquettePerso=function(aGenreEtiquette){return[TypeOrigineCreationEtiquetteMessage.OCEM_Utilisateur,TypeOrigineCreationEtiquetteMessage.OCEM_Expl_Bleu,TypeOrigineCreationEtiquetteMessage.OCEM_Expl_Vert,TypeOrigineCreationEtiquetteMessage.OCEM_Expl_Rouge].indexOf(aGenreEtiquette)>=0;};},fn:"typeoriginecreationetiquettemessage.js"});;
IE.fModule({f:function(exports,require,module,global){const TypeHttpReponseMessage={rm_Envoi:0,rm_EnvoiATous:1,rm_Relance:2,rm_EnvoiATousSaufParentEleve:3,rm_RelanceATousSaufParentEleve:4,rm_ClotureAlerte:5};module.exports.TypeHttpReponseMessage=TypeHttpReponseMessage;},fn:"typehttpreponsemessage.js"});;
IE.fModule({f:function(exports,require,module,global){require('produit/css/UtilitaireMessagerie.css');const GChaine=require('GChaine.js');const GStyle=require('GStyle.js');const GHtml=require('GHtml.js');const GTraductions=require('ObjetTraduction.js');const EGenreRessource=require('Enumere_Ressource.js');const ObjetElement=require('ObjetElement.js');const{ObjetRequeteSaisie,EGenreReponseSaisie}=require('ObjetRequeteJSON.js');const Requetes=require('CollectionRequetes.js');const ObjetTri=require('ObjetTri.js');const TypeGenreDiscussion=require('TypeGenreDiscussion.js').TypeGenreDiscussion;const EGenreEspace=require('Enumere_Espace.js');const TypeOrigineCreationEtiquetteMessage=require('TypeOrigineCreationEtiquetteMessage.js').TypeOrigineCreationEtiquetteMessage;const{TypeDroits}=require('ObjetDroitsPN.js');const ObjetListeElements=require('ObjetListeElements.js');const EGenreAction=require('Enumere_Action.js');const EGenreBoiteMessage=require('Enumere_BoiteMessage.js');const TypeHttpReponseMessage=require('TypeHttpReponseMessage.js').TypeHttpReponseMessage;const MethodesTableau=require('MethodesTableau.js');const Support=require('ObjetSupport.js');const TypeGenreStatutConnexion=require('TypeStatutConnexion.js').TypeGenreStatutConnexion;const tag=require('tag.js');const TypeThemeBouton=require('Type_ThemeBouton.js');const UtilitaireUrl=require('UtilitaireUrl.js');const C_TailleObjetMessage=200;Requetes.inscrire('SaisiePublicMessage',ObjetRequeteSaisie);function TUtilitaireMessagerie(){}
TUtilitaireMessagerie.palierNbMessages=20;TUtilitaireMessagerie.C_TailleObjetMessage=C_TailleObjetMessage;TUtilitaireMessagerie.getDiscussion=function(aParam){const H=[];let J;const lParams=Object.assign({listeMessages:null,controleur:null,callbackCommandesMessage:null,callbackBtnSignalantPourSupp:null,callbackAfficherSuivants:null},aParam);const lControleur={};let lAvecCommandes=false;if(lParams.callbackCommandesMessage&&lParams.controleur&&!GApplication.droits.get(TypeDroits.communication.discussionInterdit)){lAvecCommandes=true;Object.assign(lControleur,{nodeCommande:function(aIndice){$(this.node).on('contextmenu',function(aEvent){const lNodeCopie=$(this).find('.visu_contenu').get(0);lParams.callbackCommandesMessage({indice:aIndice,messageVisu:lParams.listeMessages.GetElement(aIndice),event:aEvent,elementCibleCopie:lNodeCopie,surMenuContextuel:true});});},btnCommande:{event:function(aIndice,aEvent){const lNodeCopie=$(this.node).closest('li.message').find('.visu_contenu').get(0);lParams.callbackCommandesMessage({node:this.node,indice:aIndice,messageVisu:lParams.listeMessages.GetElement(aIndice),event:aEvent,elementCibleCopie:lNodeCopie});}}});}
if(lParams.callbackBtnSignalantPourSupp&&lParams.controleur){Object.assign(lControleur,{btnSignalantSupp:{event:function(aIndice){const lMessageVisu=lParams.listeMessages.GetElement(aIndice);if(lMessageVisu&&lMessageVisu.messConfirmSupp){GApplication.getMessage().afficher({type:EGenreBoiteMessage.Confirmation,message:lMessageVisu.messConfirmSupp}).then(function(aGenreAction){if(aGenreAction===EGenreAction.Valider){lParams.callbackBtnSignalantPourSupp({commande:'supprimerMessageGraphe',message:lMessageVisu});}});}},getDisabled:function(){return GApplication.droits.get(TypeDroits.estEnConsultation);}}});}
if(lParams.callbackAfficherSuivants){Object.assign(lControleur,{onview:function(aNbMessages,aVisible){if(aVisible){lParams.callbackAfficherSuivants(aNbMessages);return false;}},lienAfficherSuivants:function(aNbMessages){$(this.node).eventValidation(function(){lParams.callbackAfficherSuivants(aNbMessages);});}});}
if(lParams.controleur){lParams.controleur.__visuMessage__=lControleur;}
const lNbMessages=aParam.listeMessages.GetNbrElements();if(lParams.callbackAfficherSuivants&&aParam.nbMessagesTotal>0&&lNbMessages<aParam.nbMessagesTotal){H.push('<div style="padding-top:5px;"',GHtml.composeAttr('ie-visibility-observer','__visuMessage__.onview',[lNbMessages+TUtilitaireMessagerie.palierNbMessages]),'>');if(lNbMessages+TUtilitaireMessagerie.palierNbMessages<aParam.nbMessagesTotal){H.push('<div style="padding-top:5px; text-align:center;">','<a tabindex="-1"',GHtml.composeAttr('ie-node','__visuMessage__.lienAfficherSuivants',[lNbMessages+TUtilitaireMessagerie.palierNbMessages]),' class="LienAccueil AvecMain">',GChaine.Format(GTraductions.getValeur('Messagerie.AfficherMessagesSuivants_D'),[Math.min(TUtilitaireMessagerie.palierNbMessages,aParam.nbMessagesTotal-lNbMessages)]),'</a>','</div>');}
H.push('</div>');}
H.push(tag('ul',{class:'utilMess_visu_messages'},function(H){for(let I=lNbMessages-1;I>=0;I--){const lMessage=aParam.listeMessages.GetElement(I);H.push(tag('li',{class:['AvecSelectionTexte','OmbreFocus','message',(lMessage.brouillon?'brouillon':''),(lMessage.emetteur?'emetteur':''),(lMessage.estUnAparte?'aparte':'')],'tabindex':0,'ie-node':lAvecCommandes?tag.funcAttr('__visuMessage__.nodeCommande',I):''},function(H){if(lMessage.estUnAparte){H.push(tag('i',{class:'aparte icon_sous_discussion',title:GTraductions.getValeur('Messagerie.HintSousDiscussion')}));}
H.push(tag('div',{class:'message_titre'},TUtilitaireMessagerie.getLibelleParticipants(lMessage,false,aParam.ieHint),tag('div',{class:'message_titre_droite'},lMessage.libelleDate,tag('div',TUtilitaireMessagerie.dessinListeEtiquettes(lMessage.listeEtiquettes,true))),lAvecCommandes?tag('ie-btnicon',{'ie-model':tag.funcAttr('__visuMessage__.btnCommande',I),class:'icon_ellipsis_vertical',title:GTraductions.getValeur('liste.BtnAction')}):''));H.push(tag('div',{class:"visu_contenu"},lMessage.messageSignale?tag('div',{class:"visu_signale"},lMessage.messageSignale):'',lMessage.estHTML?lMessage.contenu:GChaine.ToHTML(lMessage.contenu),lMessage.estSignalantPourSuppr&&lParams.callbackBtnSignalantPourSupp&&lParams.controleur?tag('ie-bouton',{'ie-model':tag.funcAttr('__visuMessage__.btnSignalantSupp',I),class:TypeThemeBouton.neutre},GTraductions.getValeur('Messagerie.BoutonSupprimerGraphe')):''));if(lMessage.listeDocumentsJoints&&lMessage.listeDocumentsJoints.GetNbrElements()>0){H.push(_construirePJs(lMessage));}
if(lMessage.listeMessagesPourContexte){const lNbMessagsContexte=lMessage.listeMessagesPourContexte.GetNbrElements();H.push(tag('hr'));for(J=lNbMessagsContexte-1;J>=0;J--){const lMessagePourContexte=lMessage.listeMessagesPourContexte.GetElement(J);H.push(tag('div',{class:"visu_transfert"},function(H){H.push(TUtilitaireMessagerie.getLibelleParticipants(lMessagePourContexte,true,aParam.ieHint));const lClass=lMessage.estMessageTransferant||lMessage.estSignalantPourSuppr||!lMessagePourContexte.emetteur?'visu_transfert_indent':'';H.push(tag('div',{class:lClass},lMessagePourContexte.contenu));if(lMessagePourContexte.listeDocumentsJoints&&lMessagePourContexte.listeDocumentsJoints.GetNbrElements()>0){H.push(tag('div',{class:lClass},_construirePJs(lMessagePourContexte)));}
if(J>0){H.push(tag('hr'));}}));}}
let lLibelleSupplementaireDuMessage=null;if(!!lMessage.estCarnetLiaison&&!!lMessage.avecDirecteur){lLibelleSupplementaireDuMessage='<span class="Image_CocheVerte as-icon InlineBlock AlignementHaut"></span><span class="PetitEspaceGauche">'+GTraductions.getValeur('MessagerieCarnetLiaison.DirecteurAjoute')+'</span>';}
if(!!lLibelleSupplementaireDuMessage){const lStyles=['position: absolute;','right: 5px;','bottom: 0;','background-color: #FFF;','border: solid 1px #E4E4E4;','border-radius: 1em;','padding: 0 5px;','transform: translateY(50%);','height: 1.5em;','line-height: 1.5em;'
];H.push('<div style="',lStyles.join(''),'">',lLibelleSupplementaireDuMessage,'</div>');}}));}}));return H.join('');};TUtilitaireMessagerie.estMessageNonEditable=function(aMessage){return!aMessage||aMessage.ferme||aMessage.estSorti||aMessage.estSignalantContenu||aMessage.estSignalantPourSuppr||(!aMessage.estUneDiscussion&&aMessage.pere&&TUtilitaireMessagerie.estMessageNonEditable(TUtilitaireMessagerie.getDiscussionRacine(aMessage)));};function _construirePJs(aMessage){return UtilitaireUrl.construireListeUrls(aMessage.listeDocumentsJoints);}
TUtilitaireMessagerie.getLibelleObjetDiscussion=function(aDiscussion){const H=[];if((aDiscussion!==null)&&(aDiscussion!==undefined)){H.push((aDiscussion.profondeur?'':aDiscussion.objet+'&nbsp;')+'('+aDiscussion.nombreMessages+')');}
return H.join('');};TUtilitaireMessagerie.getLibelleDiscussionAccessible=function(aDiscussion){const H=[];if(aDiscussion){H.push(TUtilitaireMessagerie.getLibelleObjetDiscussion(aDiscussion));H.push('&nbsp;-&nbsp;'+aDiscussion.libelleDate);}
return H.join('');};TUtilitaireMessagerie.getDetailDiscussionAccessible=function(aDiscussion){const H=[];if(aDiscussion){if(aDiscussion.public){H.push('<div>',aDiscussion.public,'</div>');} else{}
if(aDiscussion.documentsJoints){H.push('<div>',aDiscussion.documentsJoints,'</div>');}}
return H.join('');};TUtilitaireMessagerie.getLibelleParticipants=function(aMessage,aPourVisuTransfert,aIEHint){const H=[];if(aMessage.estMessageTransferant){H.push('<div>',aMessage.nbTransfert>1?GChaine.Format(GTraductions.getValeur('Messagerie.NMessagestransferes'),[aMessage.nbTransfert]):GTraductions.getValeur('Messagerie.1Messagetransfere'),'</div>');} else{H.push('<div class="utilMessParticipants',(aPourVisuTransfert?' transfert':''),'">');if(aMessage.brouillon){H.push('<div style="',GStyle.composeCouleurTexte('red'),'">[',GTraductions.getValeur('Messagerie.Brouillon'),']</div>');if(aPourVisuTransfert){H.push('<div>&nbsp;'+aMessage.libelleDate+'</div>');}} else{if(aMessage.estCarnetLiaison){H.push('<div ie-ellipsis style="max-width:250px;">',aMessage.public_gauche,'</div>');} else{H.push(aMessage.public_gauche?'<span class="participants_public" '+(aMessage.hint_gauche&&!IE.estMobile?GHtml.composeAttr('ie-hint',GChaine.ToHTML(aMessage.hint_gauche)):'')+' ie-ellipsis >'+aMessage.public_gauche+'</span>':tag('i',{class:'icon_intervenants','ie-event':IE.estMobile&&aIEHint&&aMessage.nbPublic>1?tag.funcAttr('ie-click->'+aIEHint,[aMessage.GetNumero(),true]):false,'ie-hint':!IE.estMobile&&aIEHint&&aMessage.nbPublic>1?tag.funcAttr(aIEHint,[aMessage.GetNumero(),true]):false}));H.push(tag('i',{class:['icone','icon_fleche_droite'],'aria-label':GTraductions.getValeur('A')}));if(aMessage.public_droite){H.push('<span class="participants_public"'+(aMessage.hint_droite&&!IE.estMobile?GHtml.composeAttr('ie-hint',GChaine.ToHTML(aMessage.hint_droite)):'')+' ie-ellipsis >'+aMessage.public_droite+'</span>');} else{if(!aMessage.brouillon&&aMessage.nbPublic>1){H.push(tag('i',{class:'icon_intervenants','ie-event':IE.estMobile&&aIEHint&&aMessage.nbPublic>1?tag.funcAttr('ie-click->'+aIEHint,[aMessage.GetNumero(),false]):false,'ie-hint':!IE.estMobile&&aIEHint&&aMessage.nbPublic>1?tag.funcAttr(aIEHint,[aMessage.GetNumero(),false]):false}));}}}
if(aPourVisuTransfert){H.push('<div class="Maigre" style="margin-left: 10px;">'+aMessage.libelleDate+'</div>');}}
if(aPourVisuTransfert){H.push(TUtilitaireMessagerie.dessinListeEtiquettes(aMessage.listeEtiquettes,true));}
H.push('</div>');}
return H.join('');};TUtilitaireMessagerie.getListePublicMessage_promise=function(aInstance,aNumeroMessage,aEstPublicParticipant,aEstDestinatairesReponse){const lParams={message:new ObjetElement('',aNumeroMessage),estPublicParticipant:aEstPublicParticipant,estDestinatairesReponse:aEstDestinatairesReponse};return Requetes('SaisiePublicMessage',aInstance).setOptions({avecControleModeExclusif:false,messageDetail:''}).lancerRequete(lParams).then(function(aReponse){if(aReponse.genreReponse!==EGenreReponseSaisie.succes){return;}
let lListeDest=aReponse.JSONReponse.listeDest;if(!lListeDest&&aReponse.JSONRapportSaisie&&aReponse.JSONRapportSaisie.listeDest){lListeDest=aReponse.JSONRapportSaisie.listeDest;lListeDest.avecConnection=true;}
if(lListeDest){lListeDest.setTri([ObjetTri.init('Genre'),ObjetTri.init('Position')]).trier();}
return lListeDest;});};TUtilitaireMessagerie.getStrHintPublicMessage_promise=function(aInstance,aNumeroMessage,aEstPublicParticipant,aEstDestinatairesReponse,aNode){const lKey='strHint'+!!aEstPublicParticipant;if(aNode){const lData=$(aNode).data(lKey);if(lData){return lData;}}
return TUtilitaireMessagerie.getListePublicMessage_promise(aInstance,aNumeroMessage,aEstPublicParticipant,aEstDestinatairesReponse).then(function(aListe){let lStr='&nbsp;';if(aListe){const lTab=[];aListe.parcourir(function(aPublic){let lLibelleSupp=TUtilitaireMessagerie.getStrHintDetailDePublic(aPublic);if(aListe.avecConnection){lTab.push(TUtilitaireMessagerie.contruirePublicConnecte(aPublic,lLibelleSupp));} else{lTab.push(aPublic.GetLibelle()+lLibelleSupp);}});lStr=lTab.join(aListe.avecConnection?'':'<br>');const lNb=aListe.GetNbrElements();if(lNb>0){lStr=tag('b',aEstPublicParticipant?GTraductions.getValeur('Messagerie.NParticipants',[lNb]):lNb>1?GTraductions.getValeur('Messagerie.NDestinataires',[lNb]):GTraductions.getValeur('Messagerie.NDestinataire',[lNb]))+tag('br')+lStr;}}
if(aNode){$(aNode).data(lKey,lStr);}
return lStr;});};TUtilitaireMessagerie.getStrHintDetailDePublic=function(aPublic){let lLibelle='';if(aPublic.estSorti){lLibelle+='&nbsp;<i class="icon_sortir_reintegrer_conversation" style="font-size:1.1em;"></i>&nbsp;'+GTraductions.getValeur('Messagerie.Retire');}
if(aPublic.refusMess){lLibelle=` - ${GTraductions.getValeur('Messagerie.RefuseDiscussions')}`;}
return lLibelle;};TUtilitaireMessagerie.getIndiceDiscussion=function(aListeMessagerie,aMessage){if(aMessage&&aMessage.listePossessionsMessages){for(let I=0;I<aMessage.listePossessionsMessages.GetNbrElements();I++){const lPossessionMessage=aMessage.listePossessionsMessages.GetElement(I);for(let J=0;J<aListeMessagerie.GetNbrElements();J++){const lDiscussion=aListeMessagerie.GetElement(J);for(let K=0;K<lDiscussion.listePossessionsMessages.GetNbrElements();K++){if((lPossessionMessage.GetNumero()===lDiscussion.listePossessionsMessages.GetNumero(K))&&(aMessage.estUneDiscussion===lDiscussion.estUneDiscussion)&&((aMessage.pere&&lDiscussion.pere)||(!aMessage.pere&&!lDiscussion.pere))){return J;}}}}}
return null;};TUtilitaireMessagerie.getIndiceDiscussionDeMessageVisu=function(aListeMessagerie,aMessageVisu){if(!aMessageVisu||!aMessageVisu.possessionMessage||!aListeMessagerie){return;}
const lNumeroPossessionMessage=aMessageVisu.possessionMessage.existeNumero()?aMessageVisu.possessionMessage:new ObjetElement('',aMessageVisu.GetNumero());const lMessage=new ObjetElement();lMessage.listePossessionsMessages=new ObjetListeElements();lMessage.listePossessionsMessages.AddElement(lNumeroPossessionMessage);lMessage.estUneDiscussion=false;lMessage.pere=true;return TUtilitaireMessagerie.getIndiceDiscussion(aListeMessagerie,lMessage);};TUtilitaireMessagerie.getIndicePere=function(aListeMessagerie,aMessage){if(aMessage.indicePere>=0){return this.getIndicePere(aListeMessagerie,aListeMessagerie.GetElement(aMessage.indicePere));} else{return aMessage.indice;}};TUtilitaireMessagerie.getDiscussionRacine=function(aMessage){if(aMessage.pere){return TUtilitaireMessagerie.getDiscussionRacine(aMessage.pere);} else{return aMessage;}};TUtilitaireMessagerie.estEgal=function(aMessage1,aMessage2){if(aMessage1&&aMessage2){if(aMessage1.estUneDiscussion&&aMessage2.estUneDiscussion){return aMessage1.profondeur===aMessage2.profondeur&&aMessage1.objet===aMessage2.objet&&aMessage1.listePossessionsMessages.GetNbrElements()===aMessage2.listePossessionsMessages.GetNbrElements()&&(aMessage1.listePossessionsMessages.GetNbrElements()===0||aMessage1.listePossessionsMessages.GetNumero(0)===aMessage2.listePossessionsMessages.GetNumero(0));} else if(!aMessage1.estUneDiscussion&&!aMessage2.estUneDiscussion){return aMessage1.GetNumero()===aMessage2.GetNumero();}}
return false;};TUtilitaireMessagerie.avecPossessionPartageeEntreMessages=function(aMessage1,aMessage2){let lResult=false;if(aMessage1&&aMessage2&&aMessage1.listePossessionsMessages&&aMessage2.listePossessionsMessages){aMessage1.listePossessionsMessages.parcourir(function(aPossession){if(aMessage2.listePossessionsMessages.GetElementParElement(aPossession)){lResult=true;return false;}});}
return lResult;};TUtilitaireMessagerie.dessinCouleurEtiquette=function(aEtiquette){if(!aEtiquette.couleur){return'';}
return['<div class="utilMess_etiquette" style="',GStyle.composeCouleur(aEtiquette.couleur,GCouleur.getCouleurCorrespondance(aEtiquette.couleur)),'"',' title="',GChaine.toTitle(aEtiquette.GetLibelle()),'">',aEtiquette.abr||'','</div>'
].join('');};TUtilitaireMessagerie.dessinListeEtiquettes=function(aListeEtiquettes,aAvecEspaceGaucheDebut){if(!aListeEtiquettes||!aListeEtiquettes.parcourir){return'';}
const H=[];aListeEtiquettes.parcourir(function(aEtiquette,aIndex){const lHtml=TUtilitaireMessagerie.dessinCouleurEtiquette(aEtiquette);if(lHtml){H.push('<div class="InlineBlock AlignementMilieuVertical Maigre',(aAvecEspaceGaucheDebut&&aIndex===0?' PetitEspaceGauche':''),(aIndex<aListeEtiquettes.GetNbrElements()-1?' PetitEspaceDroit':''),'">',lHtml,'</div>');}});return H.join('');};TUtilitaireMessagerie.estMessageVisuChat=function(aMessageVisu){if(aMessageVisu){if(aMessageVisu.estChat){return true;}
switch(aMessageVisu.GetGenre()){case TypeGenreDiscussion.GD_ContactVS:case TypeGenreDiscussion.GD_Conversation:case TypeGenreDiscussion.GD_Alerte:return true;}}
return false;};TUtilitaireMessagerie.contruirePublicConnecte=function(aPublic,aLibelleSupp){if(!aPublic){return'';}
return['<div class="utilMess_dest',(aPublic.refusMess?' dest-refus':''),'">',(aPublic.refusMess?'':'<i class="'+TypeGenreStatutConnexion.getClassIcon(aPublic.statutConnexion)+'"></i>'),'<div class="utilMess_texte" ie-ellipsis>',aPublic.GetLibelle(),'<label>&nbsp;-&nbsp;',(aPublic.refusMess?GTraductions.getValeur('Messagerie.RefuseDiscussions'):TypeGenreStatutConnexion.toLibelle(aPublic.statutConnexion)),'</label>',aLibelleSupp||'','</div>','</div>'
].join('');};TUtilitaireMessagerie.getIconeDEtiquette=function(aEtiquette){if(!aEtiquette||!aEtiquette.GetGenre){return'';}
const lPrimParent=GEtatUtilisateur.GenreEspace===EGenreEspace.PrimParent||GEtatUtilisateur.GenreEspace===EGenreEspace.Mobile_PrimParent;if(aEtiquette.toutes){return lPrimParent?'icon_discussion_cours':'icon_inbox';}
if(aEtiquette.enCours){return'icon_discussion_cours';}
switch(aEtiquette.GetGenre()){case TypeOrigineCreationEtiquetteMessage.OCEM_Pre_Archive:return'icon_archiver_discussion';case TypeOrigineCreationEtiquetteMessage.OCEM_Pre_Alerte:return'icon_alerte_ppms';case TypeOrigineCreationEtiquetteMessage.OCEM_Pre_ContactVS:return'icon_conversation_contact_vie_sco';case TypeOrigineCreationEtiquetteMessage.OCEM_Pre_Conversation:return'icon_conversation_cours';case TypeOrigineCreationEtiquetteMessage.OCEM_Pre_Brouillon:return'icon_brouillon_discussion';case TypeOrigineCreationEtiquetteMessage.OCEM_Pre_Poubelle:return'icon_trash';case TypeOrigineCreationEtiquetteMessage.OCEM_Pre_CarnetLiaison:return'icon_carnet_liaison';}
return'';};TUtilitaireMessagerie.contruireImageEtiquette=function(aEtiquette){const lResult={icone:'',avecCompteurNonLu:true};const lIcone=TUtilitaireMessagerie.getIconeDEtiquette(aEtiquette);if(lIcone){lResult.icone=tag('i',{class:lIcone});}
if(TypeOrigineCreationEtiquetteMessage.estEtiquettePerso(aEtiquette.GetGenre())){lResult.icone=tag('div',{class:'utilMess_etiquette utilMess_etiquette_liste',style:[tag.styleToStr('background-color',aEtiquette.couleur),tag.styleToStr('color',GCouleur.getCouleurCorrespondance(aEtiquette.couleur))]},aEtiquette.abr||'');lResult.estImage=true;}
if(aEtiquette.GetGenre()===TypeOrigineCreationEtiquetteMessage.OCEM_Pre_Brouillon||aEtiquette.GetGenre()===TypeOrigineCreationEtiquetteMessage.OCEM_Pre_Poubelle){lResult.avecCompteurNonLu=false;}
return lResult;};TUtilitaireMessagerie.getNbNonlusDEtiquette=function(aEtiquette,aListeMessagerie){let lNb=0;if(aListeMessagerie&&aEtiquette){aListeMessagerie.parcourir(function(D){if(TUtilitaireMessagerie.estDiscussionVisibleSelonEtiquette(D,aEtiquette)){if(D.estUneDiscussion&&D.profondeur===0){lNb+=D.nbNonLus||0;}}});}
return lNb;};TUtilitaireMessagerie.getIconeMessage=function(aMessage){const lMessage=TUtilitaireMessagerie.getDiscussionRacine(aMessage);let lResult='icon_discussion_cours';if(lMessage&&lMessage.listeEtiquettes&&lMessage.listeEtiquettes.GetNbrElements()>0){lMessage.listeEtiquettes.parcourir(function(aEtiquette){const lIcone=TUtilitaireMessagerie.getIconeDEtiquette(aEtiquette);if(lIcone){lResult=lIcone;return false;}});}
return lResult;};TUtilitaireMessagerie.estDiscussionVisibleSelonEtiquette=function(aDiscussion,aEtiquette){if(!aEtiquette){return true;}
if(aEtiquette.nonSelectionnable){return false;}
let lExclusions=[];let lAvecEtiquettes=[];let lEtiquetteFiltre=null;let lVisible=true;const lEstPrimParent=GEtatUtilisateur.GenreEspace===EGenreEspace.PrimParent||GEtatUtilisateur.GenreEspace===EGenreEspace.Mobile_PrimParent;if(aEtiquette.toutes){lExclusions=[TypeOrigineCreationEtiquetteMessage.OCEM_Pre_Poubelle];if(lEstPrimParent){lExclusions.push(TypeOrigineCreationEtiquetteMessage.OCEM_Pre_CarnetLiaison);}} else if(aEtiquette.enCours){lExclusions=[
TypeOrigineCreationEtiquetteMessage.OCEM_Pre_Poubelle,TypeOrigineCreationEtiquetteMessage.OCEM_Pre_Archive,TypeOrigineCreationEtiquetteMessage.OCEM_Pre_Alerte,TypeOrigineCreationEtiquetteMessage.OCEM_Pre_ContactVS,TypeOrigineCreationEtiquetteMessage.OCEM_Pre_Conversation
];} else if(TypeOrigineCreationEtiquetteMessage.estEtiquettePerso(aEtiquette.GetGenre())){lExclusions=[TypeOrigineCreationEtiquetteMessage.OCEM_Pre_Poubelle];lEtiquetteFiltre=aEtiquette;} else{switch(aEtiquette.GetGenre()){case TypeOrigineCreationEtiquetteMessage.OCEM_Pre_CarnetLiaison:case TypeOrigineCreationEtiquetteMessage.OCEM_Pre_Archive:case TypeOrigineCreationEtiquetteMessage.OCEM_Pre_Conversation:case TypeOrigineCreationEtiquetteMessage.OCEM_Pre_Alerte:case TypeOrigineCreationEtiquetteMessage.OCEM_Pre_ContactVS:lExclusions=[TypeOrigineCreationEtiquetteMessage.OCEM_Pre_Poubelle];lEtiquetteFiltre=aEtiquette;break;case TypeOrigineCreationEtiquetteMessage.OCEM_Pre_Brouillon:lAvecEtiquettes=[TypeOrigineCreationEtiquetteMessage.OCEM_Pre_Brouillon];lExclusions=[TypeOrigineCreationEtiquetteMessage.OCEM_Pre_Poubelle];break;case TypeOrigineCreationEtiquetteMessage.OCEM_Pre_Poubelle:lExclusions=[];lAvecEtiquettes=[TypeOrigineCreationEtiquetteMessage.OCEM_Pre_Poubelle];break;default:;}}
lExclusions.forEach(function(aGenreExclu){aDiscussion.listeEtiquettes.parcourir(function(D){if(D.GetGenre()===aGenreExclu){lVisible=false;return false;}});});if(lVisible&&lEtiquetteFiltre){lVisible=false;aDiscussion.listeEtiquettes.parcourir(function(D){if(lEtiquetteFiltre.GetNumero()===D.GetNumero()){lVisible=true;return false;}});if(lVisible&&lEstPrimParent&&lEtiquetteFiltre.GetGenre()===TypeOrigineCreationEtiquetteMessage.OCEM_Pre_CarnetLiaison){if(!!aDiscussion.contexte&&!!lEtiquetteFiltre.contexte){lVisible=aDiscussion.contexte.GetNumero()===lEtiquetteFiltre.contexte.GetNumero();}}}
if(lVisible){lAvecEtiquettes.forEach(function(aGenreEtiquette){lVisible=false;aDiscussion.listeEtiquettes.parcourir(function(D){if(D.GetGenre()===aGenreEtiquette){lVisible=true;return false;}});});}
if(lVisible&&aDiscussion.pere){lVisible=TUtilitaireMessagerie.estDiscussionVisibleSelonEtiquette(aDiscussion.pere,aEtiquette);}
return lVisible;};TUtilitaireMessagerie.getEtiquetteInitSelonMessage=function(aListeEtiquettes,aEtiquetteOriginal,aAvecSelecteurEtiquette,aMessageSelectionne){let lEtiquette=aEtiquetteOriginal;if(!aListeEtiquettes){return lEtiquette;}
let lEtiquetteToutes=null;aListeEtiquettes.parcourir(function(D){if(D.toutes){lEtiquetteToutes=D;return false;}});if(!lEtiquette||!aListeEtiquettes.GetElementParNumero(lEtiquette.GetNumero())){lEtiquette=lEtiquetteToutes;if(aAvecSelecteurEtiquette&&GApplication.droits.get(TypeDroits.communication.avecDiscussionAvancee)){aListeEtiquettes.parcourir(function(D){if(D.enCours){lEtiquette=D;return false;}});}}
if(lEtiquette&&aAvecSelecteurEtiquette&&lEtiquette.enCours&&aMessageSelectionne&&lEtiquetteToutes&&!TUtilitaireMessagerie.estDiscussionVisibleSelonEtiquette(aMessageSelectionne,lEtiquette)){lEtiquette=lEtiquetteToutes;}
if(lEtiquette&&aAvecSelecteurEtiquette&&aMessageSelectionne&&!TUtilitaireMessagerie.estDiscussionVisibleSelonEtiquette(aMessageSelectionne,lEtiquette)){aListeEtiquettes.parcourir(function(D){if(!D.enCours&&!D.toutes&&TUtilitaireMessagerie.estDiscussionVisibleSelonEtiquette(aMessageSelectionne,D)){lEtiquette=D;return false;}});}
return lEtiquette;};TUtilitaireMessagerie.getGenreReponse=function(aGenre,aAvecInclureParentsEleves){if(aGenre===TypeHttpReponseMessage.rm_EnvoiATousSaufParentEleve&&aAvecInclureParentsEleves){return TypeHttpReponseMessage.rm_EnvoiATous;}
if(aGenre===TypeHttpReponseMessage.rm_RelanceATousSaufParentEleve&&aAvecInclureParentsEleves){return TypeHttpReponseMessage.rm_Relance;}
return aGenre;};TUtilitaireMessagerie.estGenreDestinataireAutorise=function(aGenreRessource){switch(aGenreRessource){case EGenreRessource.Eleve:return GApplication.droits.get(TypeDroits.communication.avecDiscussionEleves);case EGenreRessource.Responsable:return GApplication.droits.get(TypeDroits.communication.avecDiscussionParents);case EGenreRessource.Enseignant:return GApplication.droits.get(TypeDroits.communication.avecDiscussionProfesseurs);case EGenreRessource.Personnel:return GApplication.droits.get(TypeDroits.communication.avecDiscussionPersonnels);default:;}
return false;};TUtilitaireMessagerie.unMessageContientLeDirecteur=function(aListeMessages){let result=false;if(!!aListeMessages){aListeMessages.parcourir(function(D){if(D.avecDirecteur){result=true;return false;}});}
return result;};TUtilitaireMessagerie.avecEditionHtmlMessage=function(){return GApplication.droits.get(TypeDroits.communication.avecDiscussionAvancee);};TUtilitaireMessagerie.avecEditeurTiny=function(){return GNavigateur.withContentEditable&&Support.contentEditable&&!IE.estMobile&&TUtilitaireMessagerie.avecEditionHtmlMessage();};TUtilitaireMessagerie.avecAjoutPieceJointeMessage=function(){return Support.avecSupportFileUpload&&!MethodesTableau.existe(GEtatUtilisateur.GenreEspace,[
EGenreEspace.Eleve,EGenreEspace.Mobile_Eleve,EGenreEspace.Parent,EGenreEspace.Mobile_Parent,EGenreEspace.PrimParent,EGenreEspace.Mobile_PrimParent,EGenreEspace.PrimEleve,EGenreEspace.Mobile_PrimEleve
]);};TUtilitaireMessagerie.getListeDestCarnetLiaisonDEleve_PrimParent=function(aNumeroEleve){const lEleve=GEtatUtilisateur.Identification.ListeRessources.GetElementParNumero(aNumeroEleve);if(!lEleve||!lEleve.destinatairesCarnetLiaison){return new ObjetListeElements();}
return lEleve.destinatairesCarnetLiaison;};TUtilitaireMessagerie.getBrouillonDefaut=function(){const lBrouillon=new ObjetElement();lBrouillon.contenu='';lBrouillon.objet='';lBrouillon.listeFichiers=new ObjetListeElements();return lBrouillon;};TUtilitaireMessagerie.avecListeDiffusionSelonEspace=function(){return[
EGenreEspace.Professeur,EGenreEspace.Mobile_Professeur,EGenreEspace.PrimProfesseur,EGenreEspace.Mobile_PrimProfesseur,EGenreEspace.Etablissement,EGenreEspace.Mobile_Etablissement
].indexOf(GEtatUtilisateur.GenreEspace)>=0;};TUtilitaireMessagerie.getLibelleSuppListePublics=function(aArticle){if(aArticle){switch(aArticle.GetGenre()){case EGenreRessource.Enseignant:return aArticle.listeRessources?aArticle.listeRessources.getTableauLibelles().join('<br>'):'';case EGenreRessource.Personnel:return aArticle.fonction?aArticle.fonction.GetLibelle():'';}}
return'';};module.exports=TUtilitaireMessagerie;},fn:"utilitairemessagerie.js"});;
IE.fModule({f:function(exports,require,module,global){
const GLog=require('IELog.js');const GHtml=require('GHtml.js');const GStyle=require('GStyle.js');const UtilitaireCss=require('UtilitaireCss.js');class ObjetImage{constructor(){}
compose(aClass,aLargeur){return'<div'+(aClass?' class="'+aClass+'"':'')+' style="margin-left:auto; margin-right:auto; width:'+(aLargeur?aLargeur+'px':'100%;')+'">&nbsp;</div>';}
composeImage(aClass,aLargeur,aPourImpression){if(!aClass){GLog.addLog('ObjetImage.composeImage : aClass non definie');return'';}
if(aPourImpression){const lRegleCss='.'+aClass;const lUrl=UtilitaireCss.extraireUrlReglesCss(lRegleCss);if(!lUrl){GLog.addLog('ObjetImage.composeImage : lUrl non trouvé dans la regle Css : '+aClass);return'';}
let lPosition=UtilitaireCss.chercherAttributReglesCss(lRegleCss,'position');const lHeight=UtilitaireCss.chercherAttributReglesCss(lRegleCss,'height');if(!lPosition){lPosition='relative';}
let lLargeur=aLargeur;if(!lLargeur){lLargeur=parseInt(UtilitaireCss.chercherAttributReglesCss(lRegleCss,'width'));}
let lLeft,lTop=0;const lBackGroundPosition=UtilitaireCss.chercherAttributReglesCss(lRegleCss,'backgroundPosition');if(lBackGroundPosition){const lTab=lBackGroundPosition.split(' ');if(lTab.length===2){lLeft=lTab[0];lTop=lTab[1];}} else{lLeft=UtilitaireCss.chercherAttributReglesCss(lRegleCss,'left');lTop=UtilitaireCss.chercherAttributReglesCss(lRegleCss,'top');}
let lStyle='';if(lPosition){lStyle+='position:'+lPosition+';';}
if(lHeight){lStyle+='height:'+lHeight+';';}
if(lLeft){lStyle+='left:'+lLeft+';';}
if(lTop){lStyle+='top:'+lTop+';';}
return'<div style="'+GStyle.composeWidth(lLargeur)+'margin-left:auto; margin-right:auto; overflow: hidden">'+'<img src="'+lUrl+'" style="'+lStyle+'" /></div>';} else{return'<div class="'+aClass+'" style="'+(aLargeur?GStyle.composeWidth(aLargeur):'')+'margin-left:auto; margin-right:auto;">&nbsp;</div>';}}
setImage(aId,aClass){GHtml.setHtml(aId,this.compose(aClass));}
retailler(aId,aWidth,aHeight){if(document.images[aId].width>document.images[aId].height){document.images[aId].width=aWidth;} else{document.images[aId].height=aHeight;}}}
module.exports=new ObjetImage();},fn:"objetimage.js"});;
IE.fModule({f:function(exports,require,module,global){const ETypeAffEnModeMixte={ellipsis:1,icon:2,bouton:3};module.exports.ETypeAffEnModeMixte=ETypeAffEnModeMixte;},fn:"enumere_menuctxmodemixte.js"});;
IE.fModule({f:function(exports,require,module,global){require('Produit/Css/ObjetMenuContextuel.css');const GLog=require('IELog.js');const MethodesObjet=require('MethodesObjet.js');const MethodesTableau=require('MethodesTableau.js');const GHtml=require('GHtml.js');const GPosition=require('GPosition.js');const GStyle=require('GStyle.js');const EGenreDirection=require('Enumere_Direction.js');const EEvent=require('Enumere_Event.js');require('IEHtml.SelecFile.js');const ZoneFenetre=require('IEZoneFenetre.js');const Identite=require('ObjetIdentite.js');const GImage=require('ObjetImage.js');const ObjetElement=require('ObjetElement.js');const ObjetListeElements=require('ObjetListeElements.js');const GestionnaireModale=require('GestionnaireModale.js');const GChaine=require('GChaine.js');const ToucheClavier=require('ToucheClavier.js');const ETypeAffEnModeMixte=require('Enumere_MenuCtxModeMixte.js').ETypeAffEnModeMixte;const tag=require('tag.js');const EGenreLigneMenu={Separateur:0,Commande:1,Deploiement:2,Titre:3};const c_delaiFermetureSousMenu=300;const c_delaiOuvertureSousMenu=200;class ObjetMenuContextuel extends Identite{constructor(...aParams){super(...aParams);this.ListeLignes=new ObjetListeElements();this._callbacksAfficherLignes=[];this.IdNomMenuContextuel=this.Nom+'_MenuContextuel';this.IdPremierElement=this.IdNomMenuContextuel;this.IdPrecedent='';this.couleurBarre=GCouleur.themeNeutre.legere;this.ajouterEvenementGlobal(EEvent.SurPreResize,this.Fermer);this.options={largeurMin:null,largeurMaxLibelle:400,largeurColonneGauche:25,imageFormate:false,couleurFond:GCouleur.blanc,couleurBordureDroiteImage:GCouleur.bordure,heightLigne:16,preventScrollSurRestaurationFocus:false,estModeMixte:false};}
static afficher(aParametres){const lParametres={pere:null,evenement:null,initCommandes:null,affichageSurInitCommandes:false,id:null,options:null};$.extend(lParametres,aParametres);if(!lParametres.pere){return null;}
if(!lParametres.initCommandes){return null;}
const lInstance=Identite.creerInstance(ObjetMenuContextuel,{pere:lParametres.pere,evenement:lParametres.evenement});lInstance.destructionSurFermeture=true;lInstance.setOptionsMenuContextuel(lParametres.options);ZoneFenetre.ajouterFenetre(lInstance.GetNom());$('#'+lInstance.GetNom().escapeJQ()).on('destroyed',function(){lInstance.free();});lParametres.initCommandes.call(lParametres.pere,lInstance);if(!lInstance.contientAuMoinsUneLigne()){return;}
lInstance.surKeyUp=lParametres.surKeyUp;lInstance.surKeyPress=lParametres.surKeyPress;if(!lParametres.affichageSurInitCommandes){lInstance.SetDonnees(lParametres.id);}
return lInstance;}
setOptionsMenuContextuel(aOptions){$.extend(this.options,aOptions);return this;}
add(aLibelle,aActif,aCallback,aExtend){const lElement=this.AddCommande(0,aLibelle,aActif)
;lElement.setCallback(aCallback);if(aExtend){$.extend(lElement,aExtend);}
return this;}
addTitre(aLibelle){const lElement=new ObjetElement(aLibelle,null,EGenreLigneMenu.Titre);_addElement.call(this,lElement);return lElement;}
addSousMenu(aLibelle,aInitialisationSousMenu,aParametres){const lElement=new ObjetElement(aLibelle,null,EGenreLigneMenu.Deploiement);lElement._initSousMenu=aInitialisationSousMenu;lElement.parametresSousMenu=$.extend({callback:null,options:null},aParametres);_addElement.call(this,lElement);return lElement;}
AddCommande(ANumeroCommande,ALibelle,AActif,aData,aCallbackAfficher){const LElement=new ObjetElement(ALibelle,ANumeroCommande,EGenreLigneMenu.Commande);LElement.actif=((AActif!==null&&AActif!==undefined)?AActif:true);LElement.data=aData;LElement.callbackAfficher=aCallbackAfficher;LElement.callbackValidation=null;LElement.setCallback=function(aCallback){this.callbackValidation=aCallback;return this;};_addElement.call(this,LElement);return LElement;}
addSelecFile(aLibelle,aExtend,aActif){if(!aExtend||!aExtend.getOptionsSelecFile||!aExtend.addFiles){}
return this.add(aLibelle,aActif!==false?true:false,null,$.extend({estSelecFile:true},aExtend));}
AddSeparateur(){delete this._prochaineCommandeAvecSeparateur;if(this.ListeLignes.GetNbrElements()>0){this.ListeLignes.AddElement(new ObjetElement('',-1,EGenreLigneMenu.Separateur));}}
getControleur(aInstance){return $.extend(true,super.getControleur(this),{menuEventOut:function(){const lNodesExclus=[];let lCpt=0;let lSousMenu=aInstance._instanceSousMenu;while(lSousMenu&&lCpt<20){lNodesExclus.push(GHtml.getElement(lSousMenu.Nom));lSousMenu=lSousMenu._instanceSousMenu;lCpt+=1;}
lCpt=0;let lPereMenu=aInstance._pereMenu;while(lPereMenu&&lCpt<20){lNodesExclus.push(GHtml.getElement(lPereMenu.Nom));lPereMenu=lPereMenu._pereMenu;lCpt+=1;}
return{nodesExclus:lNodesExclus,callback:function(){aInstance.Fermer();}};},nodeMenuContextuel:function(){const lInstance=this.instance;$(this.node).on({'mouseout':function(){if(lInstance.ligne){lInstance.selectionnerLigne(false,lInstance.ligne);}},'keydown':function(aEvent){if(aEvent.which===ToucheClavier.Tab){aEvent.preventDefault();}},'keypress':function(aEvent){if(aInstance.surKeyPress&&aInstance.surKeyPress(aEvent)===true){lInstance.Fermer(true);}},'keyup':function(aEvent){const lEstToucheFleche=ToucheClavier.estToucheFleche(aEvent.which);const lEstToucheEchap=aEvent.which===ToucheClavier.Echap;if(lEstToucheFleche||lEstToucheEchap){if(lInstance.estSousMenu&&lInstance._pereMenu&&(lEstToucheEchap||aEvent.which===ToucheClavier.FlecheGauche)){_stopperTimeoutsSousMenus(lInstance._pereMenu);lInstance.Fermer();delete lInstance._pereMenu._instanceSousMenu;} else{if(lEstToucheEchap){lInstance.Fermer(true);lInstance.callback.appel();}
if(lEstToucheFleche){lInstance.NavigationClavier(this.id);}}
GNavigateur.StopperEvenement(aEvent.originalEvent);} else if(aInstance.surKeyUp){if(aInstance.surKeyUp(aEvent)===true){lInstance.Fermer(true);}}}});},getNodeWAI:function(){$(this.node).on('focus',function(){aInstance.FocusSurPremierElement();});},getNodeLigne:function(aPositionLigne,aActif){const lElement=this.instance.ListeLignes.GetElement(aPositionLigne),lInstance=this.instance;const lMap={'mousedown':function(aEvent){if(lElement.GetGenre()===EGenreLigneMenu.Deploiement){aEvent.stopPropagation();return false;}},'pointerdown':function(aEvent){if(aEvent.pointerype==='touch'){lInstance.SurSelection(this.id,aActif,aPositionLigne);}
if(_avecSousMenu.call(lInstance,lElement)){lInstance.SurSelection(this.id,aActif,aPositionLigne);_ouvertureSousMenu.call(lInstance,lElement,false);aEvent.stopPropagation();return false;}},'mouseenter':function(){_ouvertureSousMenu.call(lInstance,lElement,true);},'mouseover':function(){if(lInstance.estSousMenu){if(lInstance._timeoutFermetureSousMenu){clearTimeout(lInstance._timeoutFermetureSousMenu);}
lInstance._timeoutFermetureSousMenu=null;}},'mouseleave':function(){_stopperTimeoutsSousMenus(lInstance);if(lInstance._instanceSousMenu){lInstance._instanceSousMenu._timeoutFermetureSousMenu=setTimeout(function(){lInstance._instanceSousMenu.Fermer();delete lInstance._instanceSousMenu;},c_delaiFermetureSousMenu);}
if(lInstance.estSousMenu){lInstance._timeoutFermetureSousMenu=setTimeout(function(){let lRacineSousMenu=lInstance;let i=0;while(lRacineSousMenu._pereMenu&&lRacineSousMenu._pereMenu.estSousMenu&&i<100){lRacineSousMenu=lRacineSousMenu._pereMenu;i++;}
lRacineSousMenu.Fermer();},c_delaiFermetureSousMenu);}}};$.extend(lMap,{click:function(){if(aActif&&lElement.GetGenre()!==EGenreLigneMenu.Deploiement){if(lElement.surValidationElement){lElement.surValidationElement();} else{lInstance.SurValidation(aPositionLigne);}}},keyup:function(aEvent){const lPourSousMenu=_avecSousMenu.call(lInstance,lElement)&&!lInstance._instanceSousMenu;if(ToucheClavier.estEventRetourChariot(aEvent)||ToucheClavier.estEventEspace(aEvent)){if(lPourSousMenu){_ouvertureSousMenu.call(lInstance,lElement,false);} else if(aActif){if(lElement.surValidationElement){lElement.surValidationElement();} else{lInstance.SurValidation(aPositionLigne);}}} else if(aEvent.which===ToucheClavier.FlecheDroite){if(lPourSousMenu){_ouvertureSousMenu.call(lInstance,lElement,false);}} else if(aEvent.which===ToucheClavier.FlecheGauche){_stopperTimeoutsSousMenus(lInstance._pereMenu);lInstance.Fermer();delete lInstance._pereMenu._instanceSousMenu;}}});$(this.node).on(lMap);},modelSelecFile:{getOptionsSelecFile:function(aPositionLigne){const lElement=aInstance.ListeLignes.GetElement(aPositionLigne);if(lElement){lElement.surValidationElement=this.getOpenSelecFile();return Object.assign({surOuvertureSelecteur:function(){_stopperTimeoutsSousMenus(aInstance);setTimeout(function(){_stopperTimeoutsSousMenus(aInstance);},c_delaiFermetureSousMenu);}},lElement.getOptionsSelecFile());}},addFiles:function(aPositionLigne,aActif,aParams){const lElement=aInstance.ListeLignes.GetElement(aPositionLigne);const lResult=lElement&&aActif?lElement.addFiles(aParams,lElement,aPositionLigne):false;aInstance.SurValidation(aPositionLigne);return lResult;},getDisabled:function(aPositionLigne,aActif){return!aActif;}}});}
free(){if(!this.isDestroyed()){super.free();this.Fermer();}}
ConstruireAffichage(){_calculerPremiereDerniereLigne.call(this);this._callbacksAfficherLignes=[];const lInfosMenu={nbColonnesTexte:1,nbColonnes:1,avecDeploiement:false};this.ListeLignes.parcourir(function(D){if(D.GetGenre()!==EGenreLigneMenu.Separateur){const lLibelle=D.GetLibelle();if(Array.isArray(lLibelle)){lInfosMenu.nbColonnesTexte=Math.max(lInfosMenu.nbColonnesTexte,lLibelle.length);}}
if(D.GetGenre()===EGenreLigneMenu.Deploiement){lInfosMenu.avecDeploiement=true;}
if(this.options.estModeMixte===true){if(D.GetGenre()===EGenreLigneMenu.Commande&&D.typeAffEnModeMixte===ETypeAffEnModeMixte.bouton){D.Afficher=false;}}}.bind(this));lInfosMenu.nbColonnes=lInfosMenu.nbColonnesTexte+(lInfosMenu.avecDeploiement?1:0);const H=[];H.push('<div id="'+this.IdNomMenuContextuel+'" ',' role="menu"',' ie-node="nodeMenuContextuel"',' ie-eventout="menuEventOut"',' class="ObjetMenuContexutel" tabIndex="-1">');H.push('<ul role="presentation">');this.ListeLignes.parcourir(function(aLigne,aIndex){if(aLigne&&aLigne.Afficher!==false){H.push(_composeLigne.call(this,aLigne,aIndex,lInfosMenu));}}.bind(this));H.push('</ul>');H.push('</div>');return H.join('');}
getIdCelluleTexteParCommande(aGenreCommande){const lIndice=this.ListeLignes.GetIndiceParNumeroEtGenre(aGenreCommande,EGenreLigneMenu.Commande);return lIndice>=0?_getIdCelluleTexte.call(this,lIndice):false;}
RecupererDonnees(){GStyle.setDisplay(this.Nom,false);}
SetParametres(aMinLargeur,aAfficherAbbreviation){this.setOptionsMenuContextuel({largeurMin:aMinLargeur,largeurColonneGauche:aAfficherAbbreviation?30:undefined,imageFormate:aAfficherAbbreviation?true:undefined});}
SetDonnees(aID,aListeElements,aGenre,aAfficher){if(aAfficher!==false){this.Afficher(aID);}}
contientAuMoinsUneLigne(){return(!!this.ListeLignes&&this.ListeLignes.GetNbrElements()>0);}
vider(){this.ListeLignes=new ObjetListeElements();delete this._prochaineCommandeAvecSeparateur;if(this.EstAffiche){this.Fermer();}}
avecSeparateurSurSuivant(aAnnuler){if(aAnnuler===true){delete this._prochaineCommandeAvecSeparateur;} else{this._prochaineCommandeAvecSeparateur=true;}
return this;}
ActiverCommande(ANumeroCommande,AActiver){const LElement=this.ListeLignes.GetElementParNumeroEtGenre(ANumeroCommande,EGenreLigneMenu.Commande);if(LElement){LElement.actif=AActiver;GHtml.setHtml(this.Nom,this.ConstruireAffichage(),{controleur:this.controleur});}}
setLibelleCommande(ANumeroCommande,ALibelle){const LElement=this.ListeLignes.GetElementParNumeroEtGenre(ANumeroCommande,EGenreLigneMenu.Commande);if(LElement){LElement.Libelle=ALibelle;GHtml.setHtml(this.Nom,this.ConstruireAffichage(),{controleur:this.controleur});}}
AfficherCommande(aNumeroCommande,aAfficher){_afficherLigne.call(this,aNumeroCommande,EGenreLigneMenu.Commande,aAfficher);}
Afficher(AId,aEstUnSousMenu){if(!this.EstAffiche){this.ligne=null;if(!this.contientAuMoinsUneLigne()){GLog.addLog('Afficher : aucun élément à afficher');return;}
GHtml.setHtml(this.Nom,this.ConstruireAffichage(),{controleur:this.controleur});GStyle.setDisplay(this.Nom,true);if(AId){if(MethodesObjet.isNumber(AId.x)&&MethodesObjet.isNumber(AId.y)){GPosition.placer(this.Nom,AId.x,AId.y);} else if(aEstUnSousMenu){GPosition.placerFiche(this.Nom,AId,null,{x:0,y:0});} else{GPosition.placerFiche(this.Nom,AId);}} else{GPosition.placer(this.Nom,GNavigateur.pointerX+5,GNavigateur.pointerY+5);}
this.EstAffiche=true;GestionnaireModale.abonnementPremierPlan(true,this.Nom);GestionnaireModale.enPremierPlan(this.Nom);GestionnaireModale.abonnementBlocageInterface(true,this.Nom);this._focusPrecedent=document.activeElement;this.FocusSurPremierElement();if(this._callbacksAfficherLignes){MethodesTableau.parcourir(this._callbacksAfficherLignes,function(aCallback){if(aCallback){aCallback();}});}}}
Fermer(aToutFermer){if(this.EstAffiche){this.EstAffiche=false;_stopperTimeoutsSousMenus(this);if(this._instanceSousMenu){this._instanceSousMenu.Fermer();delete this._instanceSousMenu;}
try{if(this._focusPrecedent&&this._focusPrecedent.focus&&$(this._focusPrecedent).length===1){this._focusPrecedent.focus({preventScroll:this.options.preventScrollSurRestaurationFocus});this._focusPrecedent=null;}} catch(e){}
GStyle.setDisplay(this.Nom,false);this.effacer();this.ResetTableauxNavigation();this.IdPrecedent='';GestionnaireModale.abonnementPremierPlan(false,this.Nom);GestionnaireModale.abonnementBlocageInterface(false,this.Nom);if(this.destructionSurFermeture){this.free();}
if(aToutFermer&&this._pereMenu){this._pereMenu.Fermer(true);}}}
SurSelection(aId,aActif,aPositionLigne){if(this.ligne){this.selectionnerLigne(false,this.ligne);}
this.ligne=this.ListeLignes.GetElement(aPositionLigne);this.ligne.id=aId;this.ligne.actif=aActif;this.selectionnerLigne(true,this.ligne);}
selectionnerLigne(aSelectionner,aLigne){if(!aLigne){return;}
GHtml.modifierClass(aLigne.id,aSelectionner?'no-focus':'on-focus',aSelectionner?'on-focus':'no-focus');}
selectionnerLigneParPosition(aId,aSelectionner,aPosition){const lLigne=this.ListeLignes.GetElement(aPosition);lLigne.id=aId;lLigne.actif=true;this.selectionnerLigne(aSelectionner,lLigne);}
SurValidation(aPositionLigne){this.ligne=this.ListeLignes.GetElement(aPositionLigne);this.ligne.id=_getIdCelluleTexte.call(this,aPositionLigne);if(this.ligne.GetGenre()!==EGenreLigneMenu.Deploiement){this.Fermer(true);if(this.ligne&&MethodesObjet.isFunction(this.ligne.callbackValidation)){this.ligne.callbackValidation.call(this.Pere||this,this.ligne);} else{this.callback.appel(this.ligne);}}}}
ZoneFenetre.etendreEnFenetre(ObjetMenuContextuel,{zIndex:1200});function _afficherLigne(aNumeroCommande,aGenreCommande,aAfficher){const lElement=this.ListeLignes.GetElementParNumeroEtGenre(aNumeroCommande,aGenreCommande);lElement.Afficher=aAfficher;GHtml.setHtml(this.Nom,this.ConstruireAffichage(),{controleur:this.controleur});}
function _ouvertureSousMenu(aElement,aAvecDelai){if(aElement&&this._instanceSousMenu){clearTimeout(this._instanceSousMenu._timeoutFermetureSousMenu);this._instanceSousMenu.Fermer();delete this._instanceSousMenu;}
_stopperTimeoutsSousMenus(this);const lThis=this;if(_avecSousMenu.call(this,aElement)){this._timeoutOuvertureSousMenu=setTimeout(function(){_afficherSousMenu.call(lThis,aElement);},aAvecDelai?c_delaiOuvertureSousMenu:0);}}
function _stopperTimeoutsSousMenus(aInstance){if(aInstance._timeoutFermetureSousMenu){clearTimeout(aInstance._timeoutFermetureSousMenu);}
if(aInstance._timeoutOuvertureSousMenu){clearTimeout(aInstance._timeoutOuvertureSousMenu);}
aInstance._timeoutFermetureSousMenu=null;aInstance._timeoutOuvertureSousMenu=null;if(aInstance._pereMenu){_stopperTimeoutsSousMenus(aInstance._pereMenu);}}
function _avecSousMenu(aElement){return aElement&&aElement.GetGenre()===EGenreLigneMenu.Deploiement&&aElement._initSousMenu;}
function _afficherSousMenu(aElementSousMenu){const lThis=this;this._instanceSousMenu=ObjetMenuContextuel.afficher({pere:this,evenement:function(aLigne,aElement){if(MethodesObjet.isFunction(aElementSousMenu.parametresSousMenu.callback)){aElementSousMenu.parametresSousMenu.callback.call(this.Pere||this,aLigne,aElement);} else{lThis.callback.appel(aLigne,aElement);}},initCommandes:aElementSousMenu._initSousMenu,affichageSurInitCommandes:true,options:aElementSousMenu.parametresSousMenu.options||this.options,surKeyUp:this.surKeyUp,surKeyPress:this.surKeyPress})
;if(this._instanceSousMenu){this._instanceSousMenu._pereMenu=this;this._instanceSousMenu.estSousMenu=true;this._instanceSousMenu.Afficher(aElementSousMenu.id,true);}}
function _composeLigne(aLigne,aPositionLigne,aInfosMenu){switch(aLigne.GetGenre()){case EGenreLigneMenu.Separateur:return _ComposeSeparateur.call(this,aInfosMenu);case EGenreLigneMenu.Commande:case EGenreLigneMenu.Deploiement:return _ComposeTexte.call(this,aLigne,aPositionLigne,aInfosMenu);case EGenreLigneMenu.Titre:return _composeTitre.call(this,aLigne,aInfosMenu);}}
function _getIdCelluleTexte(aPositionLigne){return this.Nom+'_'+aPositionLigne;}
function _composeTitre(aLigne){const H=[];H.push('<li class="titre" role="presentation">','<h5>',aLigne.GetLibelle(),'</h5>','</li>');return H.join('');}
function _ComposeSeparateur(){const H=[];H.push('<li class="separateur" role="separator"></li>');return H.join('');}
function _ComposeTexte(aLigne,aPositionLigne,aInfosMenu){const H=[];const lId=_getIdCelluleTexte.call(this,aPositionLigne);const lEstDeploiement=aLigne.GetGenre()===EGenreLigneMenu.Deploiement;const lLibelles=Array.isArray(aLigne.GetLibelle())?aLigne.GetLibelle():[aLigne.GetLibelle()];const lNbColonnes=Math.max(lLibelles.length,aInfosMenu.nbColonnesTexte);let lNumeroColonne;let lInfoLibelle;let lActif=aLigne.actif;if(lActif===null||lActif===undefined){lActif=true;}
lActif=!!lActif;if(aLigne.callbackAfficher){this._callbacksAfficherLignes.push(function(){aLigne.callbackAfficher.call(this.Pere||this,lId,lActif,aLigne);}.bind(this));}
const lOnKeyNav=this.Nom+'.NavigationClavier (id); if (GNavigateur.IsToucheFleche ()) GNavigateur.StopperEvenement (event);';const lOnFocus=lActif===true?this.Nom+'.selectionnerLigneParPosition (\''+lId+'\', true , '+aPositionLigne+')':'';const lOnBlur=lActif===true?this.Nom+'.selectionnerLigneParPosition (\''+lId+'\', false , '+aPositionLigne+')':'';H.push('<li id="'+lId+'" ',GHtml.composeAttr('ie-node','getNodeLigne',[aPositionLigne,lActif]),` role="menuitem" tabindex="-1" onkeyup="${lOnKeyNav}" onfocus="${lOnFocus}" onblur="${lOnBlur}"`,lActif===true?'':' aria-disabled="true"',aInfosMenu.avecDeploiement&&lEstDeploiement?' aria-haspopup="true"':'',' class="',(lActif&&!aLigne.visuInactif?'active-color':' inactive-color'),'" ',aLigne.title?' title="'+GChaine.toTitle(aLigne.title)+'"':'',aLigne.estSelecFile&&lActif?GHtml.composeAttr('ie-model','modelSelecFile',[aPositionLigne,lActif])+' ie-selecfile ':'',' onmousemove="'+this.Nom+'.SurSelection (id, '+lActif+', '+aPositionLigne+')">');H.push((this.options.imageFormate||aLigne.composeImage===false?'<div class="img-contain" aria-hidden="true">'+(aLigne.image?aLigne.image:'')+'</div>':'<div class="mc-icon-contain"" aria-hidden="true">'+(aLigne.icon?'<i class="'+aLigne.icon+'"></i>':''+(aLigne.image?GImage.compose(aLigne.image,aLigne.largeurImage?aLigne.largeurImage:16):''))+'</div>'));for(lNumeroColonne=0;lNumeroColonne<lNbColonnes;lNumeroColonne++){lInfoLibelle=[];if(lNumeroColonne<lLibelles.length){lInfoLibelle=['<div style="',(this.options.largeurMaxLibelle?'max-width: '+this.options.largeurMaxLibelle+'px;':'')+'" class="libelle" '+(this.options.largeurMaxLibelle&&!IE.estMobile?' ie-ellipsis':'')+'>'+lLibelles[lNumeroColonne]+'</div>'];}
H.push('<div class="libelle-contain">');if(lNumeroColonne===0){H.push(tag('div',{id:lId+'_',class:'libelle'},lInfoLibelle.join('')));} else{H.push(lInfoLibelle.join(''));}
if(aInfosMenu.avecDeploiement){H.push(lEstDeploiement?'<i id="'+lId+'_flechedroite" class="btn-deploiement icon_fleche_num" aria-hidden="true"></i>':'');}
H.push('</div>');}
H.push('</li>');if(this.IdPrecedent===''){this.AjouterAuTableaux(this.IdPremierElement,lId,null,EGenreDirection.SensNormal);} else{this.AjouterAuTableaux(this.IdPrecedent,lId,null,EGenreDirection.DeuxSenses);}
this.IdPrecedent=lId;return H.join('');}
function _addElement(aElement){if(this._prochaineCommandeAvecSeparateur){this.AddSeparateur();}
this.ListeLignes.AddElement(aElement);}
function _calculerPremiereDerniereLigne(){delete this._premiereLigne;for(let I=0;I<this.ListeLignes.GetNbrElements();I++){let lLigne=this.ListeLignes.GetElement(I);if(lLigne&&lLigne.Afficher!==false){this._derniereLigne={positionLigne:I,positionElement:null};if(!this._premiereLigne){this._premiereLigne={positionLigne:I,positionElement:null};}}}}
module.exports=ObjetMenuContextuel;},fn:"objetmenucontextuel.js"});;
IE.fModule({f:function(exports,require,module,global){const TypeCommandeMessagerie={lu:'lu',nonLu:'nonLu',supprimer:'supprimer',archiver:'archiver',desarchiver:'desarchiver',transferer:'transferer',signaler:'signaler',modifierCategories:'modifierCategories',fermerDiscussion:'fermerDiscussion',ouvrirDiscussion:'ouvrirDiscussion',signalerSuppression:'signalerSuppression',corbeille:'corbeille',restaurer:'restaurer',plus:'plus',purger:'purger',discussionEnFenetre:'discussionEnFenetre',entrerSortirDiscussion:'entrerSortirDiscussion',modificationObjetDiscussion:'modificationObjetDiscussion',afficherDestinataires:'afficherDestinataires',copierContenuVisu:'copierContenuVisu',repondreMessage:'repondreMessage',afficherDiscussion:'afficherDiscussion'};module.exports.TypeCommandeMessagerie=TypeCommandeMessagerie;},fn:"typecommandemessagerie.js"});;
IE.fModule({f:function(exports,require,module,global){const{ObjetRequeteConsultation}=require('ObjetRequeteJSON.js');const Requetes=require('CollectionRequetes.js');const ObjetListeElements=require('ObjetListeElements.js');const ObjetTri=require('ObjetTri.js');const TypeOrigineCreationEtiquetteMessage=require('TypeOrigineCreationEtiquetteMessage.js').TypeOrigineCreationEtiquetteMessage;const EGenreEspace=require('Enumere_Espace.js');class ObjetRequeteListeMessagerie extends ObjetRequeteConsultation{constructor(...aParams){super(...aParams);}
lancerRequete(aParametres){const lParametres=$.extend({},aParametres);$.extend(this.JSON,lParametres);if(!!this.JSON.listeRessources){this.JSON.listeRessources.setSerialisateurJSON({ignorerEtatsElements:true});}
return this.appelAsynchrone();}
actionApresRequete(){const lTriEtiquette=[
ObjetTri.init(function(D){switch(D.GetGenre()){case 1000:return-1;case TypeOrigineCreationEtiquetteMessage.OCEM_Pre_Archive:return 1;case TypeOrigineCreationEtiquetteMessage.OCEM_Pre_Brouillon:return 2;default:return 100;}}),ObjetTri.init('Libelle')
];this.JSONReponse.listeEtiquettes.setTri(lTriEtiquette).trier();for(let I=0;I<this.JSONReponse.listeMessagerie.GetNbrElements();I++){const lLigne=this.JSONReponse.listeMessagerie.GetElement(I);lLigne.indice=I;lLigne.estUneDiscussion=!!lLigne.estUneDiscussion;if(lLigne.indicePere>=0){lLigne.pere=this.JSONReponse.listeMessagerie.GetElement(lLigne.indicePere);if(lLigne.estUneDiscussion){lLigne.pere.estUnDeploiement=true;lLigne.pere.estDeploye=true;}
if(!!lLigne.contexte&&(!!lLigne.pere&&!lLigne.pere.contexte)){lLigne.pere.contexte=lLigne.contexte;}}
if(this.JSONReponse.listeEtiquettes){if(!lLigne.listeEtiquettes){lLigne.listeEtiquettes=new ObjetListeElements();} else{lLigne.listeEtiquettes.parcourir(function(aEtiquette){const lTrouve=this.JSONReponse.listeEtiquettes.GetElementParNumero(aEtiquette.GetNumero())
;Object.assign(aEtiquette,lTrouve);if(aEtiquette.GetGenre()===TypeOrigineCreationEtiquetteMessage.OCEM_Pre_Archive){lLigne.archive=true;} else if(aEtiquette.GetGenre()===TypeOrigineCreationEtiquetteMessage.OCEM_Pre_Poubelle){lLigne.poubelle=true;}}.bind(this));}
lLigne.listeEtiquettes.setTri(lTriEtiquette).trier();}}
if(GEtatUtilisateur.GenreEspace===EGenreEspace.PrimParent||GEtatUtilisateur.GenreEspace===EGenreEspace.Mobile_PrimParent){const lFuncChangerNumero=function(aEtiquette,aContexte){if(!!aContexte){aEtiquette.Numero=aEtiquette.Numero+'_'+aContexte.GetNumero();}};this.JSONReponse.listeEtiquettes.parcourir(function(D){if(D.GetGenre()===TypeOrigineCreationEtiquetteMessage.OCEM_Pre_CarnetLiaison){lFuncChangerNumero(D,D.contexte);}});this.JSONReponse.listeMessagerie.parcourir(function(aMessage){if(!!aMessage.listeEtiquettes){aMessage.listeEtiquettes.parcourir(function(D){if(D.GetGenre()===TypeOrigineCreationEtiquetteMessage.OCEM_Pre_CarnetLiaison){lFuncChangerNumero(D,aMessage.contexte);}});}});}
this.callbackReussite.appel(this.JSONReponse);}}
Requetes.inscrire('ListeMessagerie',ObjetRequeteListeMessagerie);module.exports=ObjetRequeteListeMessagerie;},fn:"objetrequetelistemessagerie.js"});;
IE.fModule({f:function(exports,require,module,global){const{ObjetRequeteConsultation}=require('ObjetRequeteJSON.js');const Requetes=require('CollectionRequetes.js');const EGenreOnglet=require('Enumere_Onglet.js');const{Invocateur}=require('Invocateur.js');class ObjetRequeteListeMessages extends ObjetRequeteConsultation{constructor(...aParams){super(...aParams);}
lancerRequete(aParametres){const lParametres=$.extend({},aParametres);Object.assign(this.JSON,lParametres);this.JSON.marquerCommeLu=aParametres.marquerCommeLu;this.JSON.estNonPossede=lParametres.message.estNonPossede;lParametres.message.listePossessionsMessages.setSerialisateurJSON({ignorerEtatsElements:true,nePasTrierPourValidation:true,methodeSerialisation:function(aElement){if(aElement.ignorerSerialisation===true){return false;}}});this.JSON.listePossessionsMessages=lParametres.message.listePossessionsMessages;if(lParametres.message.estUneDiscussion&&lParametres.message.profondeur>0){this.JSON.estSousDiscussion=true;}
return this.appelAsynchrone();}
actionApresRequete(){this.callbackReussite.appel(this.JSONReponse);if(this.JSONReponse.nbMarquerLu>0){Invocateur.evenement('modifier_notification_communication',EGenreOnglet.Messagerie,-this.JSONReponse.nbMarquerLu);}}}
Requetes.inscrire('ListeMessages',ObjetRequeteListeMessages);module.exports=ObjetRequeteListeMessages;},fn:"objetrequetelistemessages.js"});;
IE.fModule({f:function(exports,require,module,global){
const MethodesObjet=require('MethodesObjet.js');const TypeChampsJSON=require('Enumere_ChampsJSON.js');const TypeHttpVariable=require('TypeHttpVariable.js').TypeHttpVariable;class TypeChaineHtml{constructor(aChaineHtml){this.chaineHtml=MethodesObjet.isString(aChaineHtml)?aChaineHtml:'';}
toJSON(){const lJSON={};lJSON[TypeChampsJSON.type]=TypeHttpVariable.TypeHttpHtml;lJSON[TypeChampsJSON.valeur]=this.chaineHtml;return lJSON;}}
module.exports=TypeChaineHtml;},fn:"typechainehtml.js"});;
IE.fModule({f:function(exports,require,module,global){require('produit/css/Toast.css');const GHtml=require('GHtml.js');const GUID=require('GUID.js');const GChaine=require('GChaine.js');const ETypeToast={info:'info',alerte:'alerte',succes:'succes',erreur:'erreur',message:'message'};ETypeToast.getClasseCss=function(aType){switch(aType){case this.info:return'info';case this.alerte:return'alert';case this.succes:return'success';case this.erreur:return'error';case this.message:return'message';}};ETypeToast.getClasseIcon=function(aType){switch(aType){case this.info:return'icon_diffuser_information';case this.alerte:return'icon_exclamation';case this.succes:return'icon_ok';case this.erreur:return'icon_punition';case this.message:return'icon_diffuser_information';}};ETypeToast.getClassePosition=function(aType){switch(aType){case this.erreur:return'top';default:return IE.estMobile?'':'to-right';}};function Toast(){}
const uIdConteneurToast=GUID.getId();let uTimeoutFermeture=null;Toast.getHtmlToast=function(aParam){const H=[];const lClassTypeToast=ETypeToast.getClasseCss(aParam.type);const lClassPosition=ETypeToast.getClassePosition(aParam.type);const lIconToast=(aParam.icon!==null)&&(aParam.icon!==undefined)?aParam.icon:ETypeToast.getClasseIcon(aParam.type);H.push('<div class="toast ',lClassTypeToast,' ',lClassPosition,' ',lIconToast,'">');H.push('<p>',GChaine.ToHTML(aParam.msg),'</p>');H.push('</div>');return H.join('');};Toast.afficher=function(aParam){const lParams=Object.assign({msg:'',type:ETypeToast.succes,dureeAffichage:4500},aParam);Toast.fermer();const lIdPere=GApplication.getIdConteneur();const lConteneurPere=GHtml.getElement(lIdPere);if(lConteneurPere){const lConteneurToast=document.createElement('div');lConteneurToast.innerHTML=Toast.getHtmlToast(lParams);lConteneurToast.id=uIdConteneurToast;lConteneurPere.appendChild(lConteneurToast);}
return Toast.showToast(lParams).then(function(){Toast.fermer();});};Toast.showToast=function(aParam){return new Promise(function(aResolve){const _target=$('.toast');_target.siblings('.toast').removeClass('shown');(!_target.hasClass('shown'))?_target.addClass('shown'):_target.removeClass('shown');uTimeoutFermeture=setTimeout(function(){uTimeoutFermeture=null;_target.removeClass('shown');aResolve();},aParam.dureeAffichage);});};Toast.fermer=function(){const lIdPere=GApplication.getIdConteneur();const lConteneurPere=GHtml.getElement(lIdPere);if((lConteneurPere!==null)&&(lConteneurPere!==undefined)){const lConteneurToast=GHtml.getElement(uIdConteneurToast);if(lConteneurToast){lConteneurPere.removeChild(lConteneurToast);GHtml.supprimerElementDOM(uIdConteneurToast);if(uTimeoutFermeture){clearTimeout(uTimeoutFermeture);uTimeoutFermeture=null;}}}};module.exports={Toast:Toast,ETypeToast:ETypeToast};},fn:"toast.js"});;
IE.fModule({f:function(exports,require,module,global){const{ObjetRequeteSaisie,EGenreReponseSaisie}=require('ObjetRequeteJSON.js');const{Invocateur}=require('Invocateur.js');const Requetes=require('CollectionRequetes.js');const TypeChaineHtml=require('TypeChaineHtml.js');const TypeGenreDiscussion=require('TypeGenreDiscussion.js').TypeGenreDiscussion;const Toast=require('Toast.js').Toast;const GTraductions=require('ObjetTraduction.js');const tag=require('tag.js');class ObjetRequeteSaisieMessage extends ObjetRequeteSaisie{constructor(...aParams){super(...aParams);}
lancerRequete(aParam){const lParam={avecHtml:false};$.extend(lParam,aParam);this.JSON.commande=aParam.commande;switch(aParam.commande){case'viderCorbeille':case'recupererMessageDesactivation':break;case'signalement':case'supprimerMessageGraphe':this.JSON.message=aParam.message;break;case'purger':this.JSON.listeMessagesPurge=aParam.listeMessagesPurge.setSerialisateurJSON({ignorerEtatsElements:true});this.JSON.nbMaxMessages=aParam.nbMaxMessages;break;case'corbeille':_serialiserlistePossessions.call(this,aParam.listePossessionsMessages);break;case'entrerSortirConversation':this.JSON.possessionMessage=aParam.possessionMessage;this.JSON.entrer=aParam.entrer;break;case'entrerSortirDiscussion':this.JSON.possessionMessage=aParam.possessionMessage;this.JSON.estSorti=aParam.estSorti;break;case'modificationObjetDiscussion':this.JSON.possessionMessage=aParam.possessionMessage;this.JSON.objet=aParam.objet;break;case'signalementSuppression':case'suppression':case'restauration':case'pourLu':case'archive':case'pourOuvrirFermer':this.JSON.lu=aParam.lu;this.JSON.archiver=aParam.archiver;this.JSON.ouvrir=aParam.ouvrir;_serialiserlistePossessions.call(this,lParam.message.listePossessionsMessages);break;default:if(aParam.commande==='brouillon'){this.JSON.brouillon=lParam.brouillon;if(lParam.brouillon&&lParam.brouillon.ignorerPJ){this.JSON.ignorerPJBrouillon=true;}
_serialiserTransferts(this.JSON,aParam);} else if(aParam.commande==='transfert'){_serialiserTransferts(this.JSON,aParam);} else{this.JSON.bouton=lParam.bouton;this.JSON.estCreationCarnetLiaison=lParam.estCreationCarnetLiaison;this.JSON.genreDiscussion=lParam.genreDiscussion;if(lParam.estCreationCarnetLiaison){this.JSON.eleveCarnetLiaison=lParam.eleveCarnetLiaison;}
if(lParam.genreDiscussion===TypeGenreDiscussion.GD_Alerte){this.JSON.modeleAlerte=lParam.modeleAlerte;this.JSON.estExercice=lParam.estExercice;}
if(lParam.brouillon&&lParam.brouillon.existeNumero()){this.JSON.brouillon=lParam.brouillon;if(lParam.brouillon.ignorerPJ){this.JSON.ignorerPJBrouillon=true;}}}
this.JSON.messagePourReponse=lParam.messagePourReponse;this.JSON.objet=lParam.objet;if(lParam.avecHtml){this.JSON.contenu=new TypeChaineHtml(lParam.contenu);} else{this.JSON.contenu=lParam.contenu;}
this.JSON.listeDestinataires=lParam.listeDestinataires;if(lParam.listeEtiquettes){this.JSON.listeEtiquettes=lParam.listeEtiquettes.setSerialisateurJSON({ignorerEtatsElements:true});}
if(lParam.listeFichiers){this.JSON.listeFichiers=lParam.listeFichiers.setSerialisateurJSON({methodeSerialisation:_surValidation_Fichier});}}
Invocateur.evenement('requeteSaisieMessage',false,this.callbackReussite.pere);return this.appelAsynchrone().then(_afficherMessagesSaisie);}
actionApresRequete(aXml,aGenreReponse){super.actionApresRequete(aXml,aGenreReponse);if(aGenreReponse===EGenreReponseSaisie.succes&&this.JSON){const lMessage=_getMessageToast(this.JSON);if(lMessage){Toast.afficher({msg:lMessage});}}}
apresReponseRequete(){Invocateur.evenement('requeteSaisieMessage',true,this.callbackReussite.pere,this.JSONRapportSaisie);}}
Requetes.inscrire('SaisieMessage',ObjetRequeteSaisieMessage);function _serialiserlistePossessions(aListe){aListe.setSerialisateurJSON({ignorerEtatsElements:true,nePasTrierPourValidation:true});this.JSON.listePossessionsMessages=aListe;}
function _getMessageToast(aJSONEnvoi){switch(aJSONEnvoi.commande){case'corbeille':return GTraductions.getValeur('Messagerie.ToastCorbeille');case'viderCorbeille':case'suppression':return GTraductions.getValeur('Messagerie.ToastSuppression');case'archive':return aJSONEnvoi.archiver?GTraductions.getValeur('Messagerie.ToastArchivage'):GTraductions.getValeur('Messagerie.ToastDesarchivage');case'pourOuvrirFermer':return aJSONEnvoi.ouvrir?GTraductions.getValeur('Messagerie.ToastReouverture'):GTraductions.getValeur('Messagerie.ToastFermeture');case'signalement':return GTraductions.getValeur('Messagerie.ToastSignalement');case'signalementSuppression':return GTraductions.getValeur('Messagerie.ToastDemandeSuppression');}
return'';}
function _afficherMessagesSaisie(aParams){return Promise.resolve().then(function(){if(aParams.JSONRapportSaisie&&aParams.JSONRapportSaisie.EDTMessage){return GApplication.getMessage().afficher({message:aParams.JSONRapportSaisie.EDTMessage});}}).then(function(){if(aParams.JSONRapportSaisie&&aParams.JSONRapportSaisie.listeMessagesDesactivation&&aParams.JSONRapportSaisie.listeMessagesDesactivation.length>0){const H=[];aParams.JSONRapportSaisie.listeMessagesDesactivation.forEach(function(aMess){H.push('<div style="font-weight:600">'+aMess.titre+'</div>','<div style="padding: 5px; font-style: italic">«'+aMess.message+'»</div>');});return GApplication.getMessage().afficher({message:H.join('<br>')});}}).then(() =>{if(aParams.JSONRapportSaisie&&aParams.JSONRapportSaisie.messageRefusDest){return GApplication.getMessage().afficher({message:tag('div',aParams.JSONRapportSaisie.messageRefusDest.titre)+tag('br')+tag('div',aParams.JSONRapportSaisie.messageRefusDest.message)});}}).then(function(){return aParams;});}
function _serialiserTransferts(aJSON,aParam){aJSON.listeMessagesTransfert=aParam.listeMessagesTransfert;if(aJSON.listeMessagesTransfert){aJSON.listeMessagesTransfert.setSerialisateurJSON({ignorerEtatsElements:true,nePasTrierPourValidation:true});}}
function _surValidation_Fichier(aElement,aJSON){const lIdFichier=aElement.idFichier!==undefined?aElement.idFichier:(aElement.Fichier!==undefined?aElement.Fichier.idFichier:null);if(lIdFichier!==null){aJSON.idFichier=''+lIdFichier;}
aJSON.nomFichier=aElement.nomFichier;aJSON.url=aElement.url;}
module.exports=ObjetRequeteSaisieMessage;},fn:"objetrequetesaisiemessage.js"});;
IE.fModule({f:function(exports,require,module,global){require('Produit/Css/ObjetMenuCtxMixte.css');const MethodesObjet=require('MethodesObjet.js');const Identite=require('ObjetIdentite.js');const ObjetMenuContextuel=require('ObjetMenuContextuel.js');const ETypeAffEnModeMixte=require('Enumere_MenuCtxModeMixte.js').ETypeAffEnModeMixte;const GHtml=require('GHtml.js');const ZoneFenetre=require('IEZoneFenetre.js');const GPosition=require('GPosition.js');const tag=require('tag.js');const GTraductions=require('ObjetTraduction.js');class ObjetMenuCtxMixte extends Identite{constructor(...aParams){super(...aParams);this.menuContextuel=Identite.creerInstance(ObjetMenuContextuel,{pere:this});ZoneFenetre.ajouterFenetre(this.menuContextuel.GetNom());this.menuContextuel.setOptionsMenuContextuel({estModeMixte:true});this.setOptions({callbackAddCommandes:null});}
getControleur(aInstance){return $.extend(true,super.getControleur(this),{cmdMenuCtxMixte:{event:function(aGenre,aIndex){const lCmd=_getListeCmdDeGenre.call(this,aGenre).GetElement(aIndex);if(lCmd&&MethodesObjet.isFunction(lCmd.callbackValidation)){lCmd.callbackValidation.call(this.Pere||this,lCmd);} else{this.callback.appel(lCmd);}}.bind(aInstance),getDisabled:function(aGenre,aIndex){const lCmd=_getListeCmdDeGenre.call(this,aGenre).GetElement(aIndex);return!lCmd.actif;}.bind(aInstance)},cmdEllipsis:{event:function(){const lPosBtn=GPosition.getClientRect(this.node);aInstance.menuContextuel.Afficher({x:lPosBtn.left,y:lPosBtn.bottom+10});},getDisabled:function(){return false;}}});}
ConstruireAffichage(){if(this.options.callbackAddCommandes&&MethodesObjet.isFunction(this.options.callbackAddCommandes)){this.menuContextuel.vider();this.options.callbackAddCommandes(this.menuContextuel);}
const lListeBtn=_getListeCmdDeGenre.call(this,ETypeAffEnModeMixte.bouton);const lListeIcones=_getListeCmdDeGenre.call(this,ETypeAffEnModeMixte.icon);const lListeEllipsis=_getListeCmdDeGenre.call(this,ETypeAffEnModeMixte.ellipsis);const H=[];H.push('<div class="ObjetMenuCtxMixte">');lListeBtn.parcourir(function(D,aIndex){H.push('<ie-bouton ',GHtml.composeAttr('ie-model','cmdMenuCtxMixte',[ETypeAffEnModeMixte.bouton,aIndex]),' class="eltBouton themeBoutonPrimaire">',D.GetLibelle(),'</ie-bouton>');}.bind(this));lListeIcones.parcourir(function(D,aIndex){H.push('<ie-btnicon ',GHtml.composeAttr('ie-model','cmdMenuCtxMixte',[ETypeAffEnModeMixte.icon,aIndex]),' class="avecFond ',D.icon,'" title="',D.GetLibelle(),'"></ie-btnicon>');}.bind(this));if(lListeEllipsis.GetNbrElements()>0){H.push(tag('ie-btnicon',{'ie-model':'cmdEllipsis',class:'icon_ellipsis_vertical',title:GTraductions.getValeur('liste.BtnAction')}));}
H.push('</div>');return H.join('');}
actualiser(){return this.Afficher();}}
function _getListeCmdDeGenre(aGenre){return this.menuContextuel.ListeLignes.getListeElements(function(D){if(aGenre===ETypeAffEnModeMixte.ellipsis){return D.typeAffEnModeMixte!==ETypeAffEnModeMixte.bouton;}
return D.typeAffEnModeMixte===aGenre;}.bind(this));}
module.exports=ObjetMenuCtxMixte;},fn:"objetmenuctxmixte.js"});;
IE.fModule({f:function(exports,require,module,global){const TypeFusionTitreListe={FusionGauche:1,FusionHaute:2};module.exports=TypeFusionTitreListe;},fn:"typefusiontitreliste.js"});;
IE.fModule({f:function(exports,require,module,global){const EGenreEvenementListe={Selection:0,ModificationSelection:'ModificationSelection',Creation:1,Edition:2,Suppression:3,Deploiement:4,ApresCreation:5,ApresEdition:6,ApresSuppression:7,SelectionClick:8,ApresErreurCreation:9,SelectionDblClick:10,KeyPressListe:11,KeyUpListe:12,SelectionClickTotal:13,ModificationCBLigne:14};module.exports=EGenreEvenementListe;},fn:"enumere_evenementliste.js"});;
IE.fModule({f:function(exports,require,module,global){const IEHtml=require('IEHtml.js');require('DeclarationJQueryUI.js');const GUID=require('GUID.js');const GPosition=require('GPosition.js');const GTraductions=require('ObjetTraduction.js');require('Produit/Css/IEHtml.DraggableDroppable.css');IEHtml.addAttribut('ie-draggable',function(aContexteCourant,aNodeName,aAttributValue,aOutils){const lNom=aAttributValue,lInfos=aOutils.getAccesParametres(lNom,aContexteCourant);if(!lNom||!aContexteCourant.controleur||!lInfos.estFonction){return true;}
$(aContexteCourant.node).draggable(lInfos.callback());aOutils.addCommentaireDebug(aContexteCourant.node,'ie-draggable="'+lNom+'"');return true;});IEHtml.addAttribut('ie-droppable',function(aContexteCourant,aNodeName,aAttributValue,aOutils){const lNom=aAttributValue,lInfos=aOutils.getAccesParametres(lNom,aContexteCourant);if(!lNom||!aContexteCourant.controleur||!lInfos.estFonction){return true;}
$(aContexteCourant.node).droppable(lInfos.callback());aOutils.addCommentaireDebug(aContexteCourant.node,'ie-droppable="'+lNom+'"');return true;});const uGUIDFantome=GUID.getId();IEHtml.addAttribut('ie-draggablefantome',function(aContexteCourant,aNodeName,aAttributValue,aOutils){const lNom=aAttributValue,lInfos=aOutils.getAccesParametres(lNom,aContexteCourant);if(!lNom||!aContexteCourant.controleur||!lInfos.estFonction){return true;}
const lParams=lInfos.callback();const lIdData='data_'+uGUIDFantome;if(!lParams||!lParams.start||!lParams.stop||!lParams.drag){return true;}
let lContainment='document';if(lParams.containment!==null&&lParams.containment!==undefined){lContainment=lParams.containment;}
const lOptions={helper:function(){return $('<div id="'+uGUIDFantome+'" class="drag-row FantomeDraggable"></div>');},appendTo:'#'+GApplication.getIdConteneur(),containment:lContainment,zIndex:1000000,cursorAt:{top:10,left:15},scroll:true,distance:5,start:function(){const lJFantome=$('#'+uGUIDFantome.escapeJQ());const lData={drag:true,jDraggable:lJFantome,droppableOverOut:function(aSurOver,aDroppable){if(aSurOver){lData.droppableCourant=aDroppable;} else if(lData.droppableCourant===aDroppable){lData.droppableCourant=null;lData.getHtmlDetailsDraggable=null;}
lData.controleurDraggable.$refreshSelf();},libelle:''};lJFantome.data(lIdData,lData);lParams.start({node:this,idFantome:uGUIDFantome,jFantome:lJFantome,data:lData});const lControleur={getHtmlFantome:function(){const lHtml=lData.libelle||'';let lSupp='';if(lData.getHtmlDetailsDraggable){lSupp=lData.getHtmlDetailsDraggable(lData);} else if(lData.horsZoneSuppression){lSupp='<i class="icon_remove" style="font-size:15px; color:red;"></i><label>'+GTraductions.getValeur('Supprimer')+'</label>';}
return lHtml+(lSupp?'<div class="draggable_details">'+lSupp+'</div>':'');}};lData.controleurDraggable=lControleur;lJFantome.IEHtml('<div ie-html="getHtmlFantome"></div>',{controleur:lControleur});lData.controleurDraggable.$refreshSelf();},stop:function(aEvent){const lIdZone=lParams.getIdZone?lParams.getIdZone():null;const lJFantome=$('#'+uGUIDFantome.escapeJQ());const lData=lJFantome.data(lIdData);lParams.stop({node:this,idFantome:uGUIDFantome,jFantome:lJFantome,horsZone:lIdZone?!GPosition.positionDansZone({x:aEvent.pageX,y:aEvent.pageY},lIdZone):false,data:lData});lData.controleurDraggable.$refreshSelf();},drag:function(aEvent){const lJFantome=$('#'+uGUIDFantome.escapeJQ()).css({height:'auto',width:'auto'});const lIdZone=lParams.getIdZone?lParams.getIdZone():null;const lData=lJFantome.data(lIdData);lParams.drag({node:this,idFantome:uGUIDFantome,jFantome:lJFantome,horsZone:lIdZone?!GPosition.positionDansZone({x:aEvent.pageX,y:aEvent.pageY},lIdZone):false,data:lData});lData.controleurDraggable.$refreshSelf();}};$(aContexteCourant.node).draggable(lOptions);aOutils.addCommentaireDebug(aContexteCourant.node,'ie-draggablefantome="'+lNom+'"');return true;});module.exports=IEHtml;},fn:"iehtml.draggabledroppable.js"});;
IE.fModule({f:function(exports,require,module,global){const MethodesObjet=require('MethodesObjet.js');const Identite=require('ObjetIdentite.js');const GUID=require('GUID.js');const GHtml=require('_ObjetHtml.js').GHtml;class ModaleBottomSheet extends Identite{constructor(...aParams){super(...aParams);this.paramParDefaut={evntSurClose:null,evntSurCloseStart:null};this.param=this.paramParDefaut;this.ids={modale:GUID.getId()};}
setOptions(aParam){this.param=$.extend(true ,{},this.paramParDefaut,aParam);this.evntSurClose=aParam.evntSurClose;}
fermer(){delete ModaleBottomSheet.idsEnCours[this.ids.modale];const $modale=$('#'+this.ids.modale.escapeJQ());$modale.remove();if((this.evntSurClose!==null)&&(this.evntSurClose!==undefined)){this.evntSurClose();}}
afficher(aParam){const lMaxHeight=(aParam!==null)&&(aParam!==undefined)&&(aParam.maxHeight!==null)&&(aParam.maxHeight!==undefined)?aParam.maxHeight:'100%';const lHtml='<div id="'+this.ids.modale+'" class="modal bottom-sheet" style="max-height:'+lMaxHeight+'; background-color:transparent; overflow:hidden;">'+this.getHtmlContenu()+'</div>';const lDivPere=GHtml.getElement(GApplication.getIdConteneur());const lScrollTop=lDivPere.scrollTop;GHtml.addHtml(lDivPere,lHtml,{instance:this});if((aParam&&aParam.restaurerScroll===true)&&(lScrollTop>0)){lDivPere.scrollTop=lScrollTop;}
this.openModale();}
openModale(){const lIdsEnCours=Object.keys(ModaleBottomSheet.idsEnCours);lIdsEnCours.forEach(function(aId){const lInstanceObjetModaleCombo=M.Modal.getInstance($("#"+aId.escapeJQ()));if(lInstanceObjetModaleCombo&&lInstanceObjetModaleCombo.isOpen){lInstanceObjetModaleCombo.options.outDuration=0;lInstanceObjetModaleCombo.close();}});const $objetModaleCombo=$("#"+this.ids.modale.escapeJQ());let lInstanceObjetModaleCombo=M.Modal.getInstance($objetModaleCombo);if(!lInstanceObjetModaleCombo){M.Modal.init($objetModaleCombo,{onOpenEnd:function(){if(MethodesObjet.isFunction(this.param.evntSurOpenEnd)){this.param.evntSurOpenEnd();}}.bind(this),onCloseStart:function(){if(MethodesObjet.isFunction(this.param.evntSurCloseStart)){this.param.evntSurCloseStart();}}.bind(this),onCloseEnd:function(){this.fermer();}.bind(this)});lInstanceObjetModaleCombo=M.Modal.getInstance($objetModaleCombo);}
ModaleBottomSheet.idsEnCours[this.ids.modale]=true;if(lIdsEnCours.length>0){lInstanceObjetModaleCombo.options.inDuration=0;}
lInstanceObjetModaleCombo.open();}
closeModale(){const lInstanceModale=M.Modal.getInstance($("#"+this.ids.modale.escapeJQ()));if(lInstanceModale&&lInstanceModale.isOpen){lInstanceModale.close();}}
getHtmlContenu(){const H=[];return H.join('');}}
ModaleBottomSheet.idsEnCours={};module.exports=ModaleBottomSheet;},fn:"modalebottomsheet.js"});;
IE.fModule({f:function(exports,require,module,global){const Identite=require('ObjetIdentite.js');const EGenreOrientationAffichage=require('enumere_orientationaffichage.js');const GUID=require('GUID.js');const GHtml=require('_ObjetHtml.js').GHtml;const{GObjetWAI,EGenreAttribut}=require('ObjetWAI.js');const ModaleBottomSheet=require('ModaleBottomSheet.js');require('produit/css/ClavierVirtuel.css');const ETypeToucheClavier={texte:'texte',image:'image'};const EGenreCurseurClavier={selection:'selection',fin:'fin'};class Clavier extends ModaleBottomSheet{constructor(...aParams){super(...aParams);this.paramParDefaut=$.extend(this.paramParDefaut,{orientation:EGenreOrientationAffichage.Horizontal,contexte:{avec:true,couleurFond:GCouleur.themeNeutre.moyen1},paveSaisie:{couleurFond:GCouleur.themeNeutre.claire}});this.param=this.paramParDefaut;this.ids=$.extend(this.ids,{panelClavier:GUID.getId(),panelContexte:GUID.getId(),panelVisu:GUID.getId(),msgErreur:GUID.getId()});this.dimensions={hauteurContexte:60,largeurZoneVisu:80};this.strSaisieCourante='';this.strValeurInit='';this.indiceEcran=0;this.curseur=EGenreCurseurClavier.selection;}
estCurseurClavier(aGenreCurseurClavier){return(this.curseur===aGenreCurseurClavier);}
setCurseurClavier(aGenreCurseurClavier){this.curseur=aGenreCurseurClavier;}
setOptions(aParam){super.setOptions(aParam);this.strValeurInit=aParam.valeurInit;this.strSaisieCourante=aParam.valeurInit;}
getValeurInit(){return this.strValeurInit;}
reIntialiserValeur(){this.setStrSaisieCourante(this.getValeurInit());this.actualiserVisuSaisie();this.setCurseurClavier(EGenreCurseurClavier.selection);}
definirTouches(){return[];}
definirGrille(){return{nbLignes:0,nbColonnes:0,cells:[]};}
dessinerContexte(){return'';}
surEvntTouche(){}
estToucheDouble(){return false;}
definirClavier(){this.listeTouches=this.definirTouches();this.grille=this.definirGrille();}
getHtmlContenu(){const H=[];const lHauteurContexte=this.dimensions.hauteurContexte;H.push('<div class="clavierVirtuel SansSelectionTexte">');H.push('<div class="TexteRouge EspaceGauche EspaceDroit" style="height:10px; background-color:',this.param.contexte.couleurFond,';" id="',this.ids.msgErreur,'"></div>');H.push('<div class="NoWrap Espace" style="height:',lHauteurContexte,'px; background-color:',this.param.contexte.couleurFond,';"  >');H.push('<div style="height:100%; width:calc(100% - ',this.dimensions.largeurZoneVisu,'px);" class="InlineBlock AlignementBas NoWrap" id="',this.ids.panelContexte,'">');H.push(this.dessinerContexte());H.push('</div>');H.push('<div style="height:100%; width:',this.dimensions.largeurZoneVisu,'px; border-bottom-color: ',GCouleur.themeCouleur.foncee,';" class="zoneVisuSaisie InlineBlock AlignementBas AlignementDroit NoWrap" id="',this.ids.panelVisu,'">');H.push(this.dessinerVisuSaisie());H.push('</div>');H.push('</div>');H.push('<div style="height:calc(100% - ',lHauteurContexte,'px)" id="',this.ids.panelClavier,'">');H.push(this.dessinerClavier());H.push('</div>');H.push('</div>');return H.join('');}
dessinerClavier(){const H=[];const lMarge=5;H.push('<div class="paveNum" style="display:flex; flex-direction:column; justify-content:space-around; height:100%; background-color:',this.param.paveSaisie.couleurFond,'; padding:',lMarge,'px;">');for(let lLigne=0,lNbr=this.grille.nbLignes;lLigne<lNbr;lLigne++){H.push('<div class="ligneClavierVirtuel" style="display:flex; flex-direction:row; justify-content:space-around; height:calc(100% / ',this.grille.nbLignes,');">');for(let lCol=0,lNbr2=this.grille.nbColonnes;lCol<lNbr2;lCol++){const lTouche=_getToucheDeCell.call(this,{ligne:lLigne,col:lCol,ecran:this.indiceEcran});if(lTouche!==null&&lTouche!==undefined){H.push(lTouche.dessinerTouche({estToucheDouble:this.estToucheDouble(lTouche),nbColonnes:this.grille.nbColonnes,marge:lMarge}));} else{if(lTouche===null){H.push('<div style="background-color:transparent; margin:',lMarge,'px; width:calc(100% / ',this.grille.nbColonnes,');">&nbsp;</div>');}}}
H.push('</div>');}
H.push('</div>');return H.join('');}
actualiserMsgErreur(aMsg){GHtml.setHtml(this.ids.msgErreur,aMsg,{instance:this});}
actualiserClavier(){GHtml.setHtml(this.ids.panelClavier,this.dessinerClavier(),{instance:this});}
getStrSaisieCourante(){return this.strSaisieCourante;}
setStrSaisieCourante(aValeur){this.strSaisieCourante=''+aValeur;}
viderSaisieCourante(){this.setStrSaisieCourante('');}
concatSaisieCourante(aValeur){this.setStrSaisieCourante(this.strSaisieCourante+aValeur);}
dessinerVisuSaisie(){const H=[];H.push('<div class="InlineBlock AlignementBas SansSelectionTexte">');H.push(this.getStrSaisieCourante());H.push('</div>');H.push('<div style="height:100%" class="InlineBlock AlignementBas">&nbsp;</div>');return H.join('');}
actualiserVisuSaisie(){GHtml.setHtml(this.ids.panelVisu,this.dessinerVisuSaisie(),{instance:this});}
getIndiceEcran(){return this.indiceEcran;}
nbEcrans(){return 1;}
getLibelleToucheBascule(){return(this.indiceEcran+1)+'/'+this.nbEcrans();}
basculerIndiceEcran(){this.indiceEcran++;const lNbrEcrans=this.nbEcrans();this.indiceEcran=this.indiceEcran%lNbrEcrans;}
basculerEcran(aParam){this.basculerIndiceEcran();aParam.toucheBascule.setContenuTouche(this.getLibelleToucheBascule());this.actualiserClavier();}}
function _getToucheDeCell(aParam){const lLigne=this.grille.cells[aParam.ligne];const lCell=lLigne[aParam.col];let lTouche=lCell;if(lCell!==null&&lCell!==undefined){if($.isArray(lCell)){lTouche=lCell[aParam.ecran];} else{lTouche=lCell;}}
return lTouche;}
class ToucheClavierVirtuel extends Identite{constructor(...aParams){super(...aParams);}
setDonnees(aParam){this.contenu={type:aParam.type,valeur:aParam.valeur,hint:aParam.hint||''};const lAff=aParam.affichage;this.affichage=lAff;this.id=aParam.id;this.genreTouche=aParam.genreTouche;}
getValeur(){return this.contenu.valeur;}
setValeur(aValeur){this.contenu.valeur=aValeur;}
getType(){return this.contenu.type;}
getHint(){return this.contenu.hint;}
evntSurTouche(){if(window.navigator&&window.navigator.vibrate){window.navigator.vibrate(20);}
this.callback.appel({touche:this});}
dessinerTouche(aParam){const H=[];const lMarge=aParam.marge;const lWitdh=aParam.estToucheDouble?'calc(((100% / '+aParam.nbColonnes+') + '+lMarge+'px) * 2 )':'calc(100% / '+aParam.nbColonnes+')';H.push('<div onclick="',this.Nom,'.evntSurTouche()" class="waves-effect NoWrap z-depth-1 toucheClavierVirtuel SansSelectionTexte ',this.affichage.css,' ligneClavierVirtuel" style="margin:',lMarge,'px; width:',lWitdh,';">');H.push('<div id="',this.id,'" style="width:100%;" class="InlineBlock AlignementMilieuVertical AlignementMilieu contenuToucheClavier">');H.push(this.dessinerContenu());H.push('</div>');H.push('<div class="InlineBlock AlignementMilieuVertical" style="height:100%; width:0px;">&nbsp;</div>');H.push('</div>');return H.join('');}
dessinerContenu(){const H=[];const lValeur=this.getValeur();if(this.getType()===ETypeToucheClavier.image){const lLabelWai=this.getHint();H.push('<ie-btnimage class="InlineBlock btnImageIcon ',lValeur,'" ',GObjetWAI.composeAttribut({genre:EGenreAttribut.label,valeur:lLabelWai}),'></ie-btnimage>');} else{H.push(lValeur);}
return H.join('');}
setContenuTouche(aValeurContenu){this.setValeur(aValeurContenu);GHtml.setHtml(this.id,this.dessinerContenu());}}
module.exports={Clavier,ToucheClavierVirtuel,ETypeToucheClavier,EGenreCurseurClavier};},fn:"claviervirtuel.js"});;
IE.fModule({f:function(exports,require,module,global){const Identite=require('ObjetIdentite.js');const GUID=require('GUID.js');const EGenreAnnotation=require('Enumere_Annotation.js');const TypeNote=require('TypeNote.js');const{Clavier,ToucheClavierVirtuel,ETypeToucheClavier,EGenreCurseurClavier}=require('ClavierVirtuel.js');const GTraductions=require('ObjetTraduction.js');class Clavier_SaisieNote extends Clavier{constructor(...aParams){super(...aParams);this.idTouche={valider:GUID.getId(),supprimer:GUID.getId(),chiffre:GUID.getId(),separateurDecimal:GUID.getId(),signeMoins:GUID.getId(),annotation:GUID.getId(),basculeEcran:GUID.getId()};this.options={avecAnnotations:false,avecSeparateurDecimal:false,avecSigneMoins:false,grille:{nbLignes:0},htmlContexte:''};this.param.evntSurCloseStart=function(){if(!this._surValidationNote){this.callback.appel(null);}}.bind(this);const lListeAnnotationsCompletes=getTabAnnotations();this.listeAnnotations=[];for(let i=0;i<lListeAnnotationsCompletes.length;i++){if(TypeNote.estAnnotationPermise(lListeAnnotationsCompletes[i])){this.listeAnnotations.push(lListeAnnotationsCompletes[i]);}}
this.erreurAffichee=false;}
setOptions(aOptions){super.setOptions(aOptions.clavier);this.options=$.extend(this.options,aOptions.metier);this.options.methodeValidationNote=aOptions.methodeValidationNote;this.options.grille=aOptions.grille;this.definirClavier();}
nbEcrans(){return this.options.avecAnnotations?Math.ceil(this.listeAnnotations.length/this.options.grille.nbLignes):1;}
afficherErreurNoteInvalide(aMsg){this.actualiserMsgErreur(aMsg);this.erreurAffichee=true;this.reIntialiserValeur();}
dessinerContexte(){const H=[];H.push('<div class="InlineBlock AlignementMilieuVertical">');H.push(this.options.htmlContexte);H.push('</div>');H.push('<div style="height:100%" class="InlineBlock AlignementMilieuVertical">&nbsp;</div>');return H.join('');}
definirTouches(){const lTabTouches=[];lTabTouches.push(_newTouche_Action.call(this,{id:this.idTouche.valider,valeur:'icon_ok',hint:GTraductions.getValeur('Valider')}));lTabTouches.push(_newTouche_Action.call(this,{id:this.idTouche.supprimer,valeur:'icon_delete_clavier_mobile',hint:GTraductions.getValeur('Supprimer')}));for(let i=0,lNbr=10;i<lNbr;i++){lTabTouches.push(_newTouche_Numerique.call(this,{id:_getIdToucheChiffre.call(this,i),valeur:i}));}
if(this.options.avecSeparateurDecimal){lTabTouches.push(_newTouche_Numerique.call(this,{id:this.idTouche.separateurDecimal,valeur:','}));}
if(this.options.avecSigneMoins){lTabTouches.push(_newTouche_Numerique.call(this,{id:this.idTouche.signeMoins,valeur:'-'}));}
if(this.options.avecAnnotations){for(let i=0,lNbr=this.listeAnnotations.length;i<lNbr;i++){const lGenreAnnotation=this.listeAnnotations[i];lTabTouches.push(_newTouche_Annotation.call(this,{id:_getIdToucheAnnotation.call(this,lGenreAnnotation),valeur:new TypeNote().getChaineAnnotationDeGenre(lGenreAnnotation)}));}}
if(this.nbEcrans()>1){lTabTouches.push(_newTouche_Annotation.call(this,{id:this.idTouche.basculeEcran,valeur:this.getLibelleToucheBascule()}));}
return lTabTouches;}
definirGrille(){const lGrille={nbLignes:this.options.grille.nbLignes,nbColonnes:this.options.avecAnnotations?5:4,nbEcrans:this.nbEcrans(),cells:[]};for(let i=0,lNbr=lGrille.nbLignes;i<lNbr;i++){lGrille.cells[i]=[];}
let lIndiceCol,lIndiceLigne,lTouche;if(this.options.avecAnnotations){lIndiceCol=0;lIndiceLigne=0;let lIndiceEcran=this.getIndiceEcran();for(let i=0,lNbr=this.listeAnnotations.length;i<lNbr;i++){const lAnnotation=this.listeAnnotations[i];if(lIndiceLigne>=lGrille.nbLignes){lIndiceLigne=0;lIndiceEcran++;}
if(!$.isArray(lGrille.cells[lIndiceLigne][lIndiceCol])){lGrille.cells[lIndiceLigne][lIndiceCol]=[];}
lTouche=_getToucheParId.call(this,{id:_getIdToucheAnnotation.call(this,lAnnotation)});lGrille.cells[lIndiceLigne][lIndiceCol][lIndiceEcran]=lTouche;lIndiceLigne++;}
for(let i=lIndiceLigne,lNbr=lGrille.nbLignes;i<lNbr;i++){if(!$.isArray(lGrille.cells[lIndiceLigne][lIndiceCol])){lGrille.cells[lIndiceLigne][lIndiceCol]=[];}
lGrille.cells[lIndiceLigne][lIndiceCol][lIndiceEcran]=null;lIndiceLigne++;}}
let lChiffre=0;lIndiceCol=this.options.avecAnnotations?2:1;lGrille.cells[3][lIndiceCol]=_getToucheParId.call(this,{id:_getIdToucheChiffre.call(this,lChiffre)});let lNbr=3;let lNbr2;const lDebCol=this.options.avecAnnotations?1:0;lChiffre=1;for(lIndiceLigne=0;lIndiceLigne<lNbr;lIndiceLigne++){for(lIndiceCol=lDebCol,lNbr2=3+lDebCol;lIndiceCol<lNbr2;lIndiceCol++){lTouche=_getToucheParId.call(this,{id:_getIdToucheChiffre.call(this,lChiffre)});lGrille.cells[lIndiceLigne][lIndiceCol]=lTouche;lChiffre++;}}
lIndiceCol=this.options.avecAnnotations?4:3;lGrille.cells[0][lIndiceCol]=this.options.avecSigneMoins?_getToucheParId.call(this,{id:this.idTouche.signeMoins}):null;lGrille.cells[1][lIndiceCol]=this.options.avecSeparateurDecimal?_getToucheParId.call(this,{id:this.idTouche.separateurDecimal}):null;lGrille.cells[2][lIndiceCol]=_getToucheParId.call(this,{id:this.idTouche.supprimer});const lToucheValider=_getToucheParId.call(this,{id:this.idTouche.valider});lGrille.cells[3][lIndiceCol-1]=lToucheValider;lGrille.cells[3][lIndiceCol]=undefined;lIndiceCol=this.options.avecAnnotations?1:0;lGrille.cells[3][lIndiceCol]=this.options.avecAnnotations?_getToucheParId.call(this,{id:this.idTouche.basculeEcran}):null;return lGrille;}
surEvntTouche(aParam){if(this.erreurAffichee){this.actualiserMsgErreur('');this.erreurAffichee=false;}
const lStrAvant=this.getStrSaisieCourante();let lGenreCurseur=EGenreCurseurClavier.fin;const lTouche=aParam.touche;switch(lTouche.id){case this.idTouche.basculeEcran:this.basculerEcran({toucheBascule:lTouche});break;case this.idTouche.supprimer:if(lStrAvant!==''){if(_estStrToucheAnnotation.call(this,lStrAvant)||this.estCurseurClavier(EGenreCurseurClavier.selection)){this.viderSaisieCourante();} else{this.setStrSaisieCourante(lStrAvant.substring(0,lStrAvant.length-1));}}
break;case this.idTouche.valider:{if(this.options.avecSeparateurDecimal){const lToucheSep=_getToucheParId.call(this,{id:this.idTouche.separateurDecimal});const lCharSep=lToucheSep.getValeur();if(new RegExp(lCharSep+'$').test(lStrAvant)){this.concatSaisieCourante('0');}}
if((this.options.avecSigneMoins)&&(lStrAvant.length===1)){const lToucheMoins=_getToucheParId.call(this,{id:this.idTouche.signeMoins});if(lStrAvant===lToucheMoins.getValeur()){this.viderSaisieCourante();}}
const lResult=this.options.methodeValidationNote(this.getStrSaisieCourante(),{min:this.options.min,max:this.options.max,sansNotePossible:this.options.sansNotePossible,avecAnnotation:this.options.avecAnnotations,avecVirgule:this.options.avecSeparateurDecimal});if(lResult.estValide){this._surValidationNote=true;try{this.callback.appel(lResult.note);this.closeModale();} finally{this._surValidationNote=false;}} else{this.afficherErreurNoteInvalide(lResult.message);lGenreCurseur=EGenreCurseurClavier.selection;}
break;}
case this.idTouche.separateurDecimal:if(this.options.avecSeparateurDecimal){if((lStrAvant==='')||this.estCurseurClavier(EGenreCurseurClavier.selection)){this.setStrSaisieCourante('0'+lTouche.getValeur());} else{if(!_estStrToucheAnnotation.call(this,lStrAvant)){const lExp=new RegExp('[0-9]$');if((lExp.test(lStrAvant))&&(lStrAvant.indexOf(lTouche.getValeur())=== -1)){this.concatSaisieCourante(lTouche.getValeur());}}}} else{}
break;case this.idTouche.signeMoins:if(this.options.avecSigneMoins){if((lStrAvant==='')||this.estCurseurClavier(EGenreCurseurClavier.selection)){this.setStrSaisieCourante(lTouche.getValeur());}} else{}
break;default:if(_estIdToucheChiffre.call(this,lTouche.id)){if((lStrAvant!=='')&&(_estStrToucheAnnotation.call(this,lStrAvant)||this.estCurseurClavier(EGenreCurseurClavier.selection))){this.setStrSaisieCourante(''+lTouche.getValeur());} else{this.concatSaisieCourante(''+lTouche.getValeur());}} else if(this.options.avecAnnotations&&_estIdToucheAnnotation.call(this,lTouche.id)){this.setStrSaisieCourante(lTouche.getValeur());}}
this.setCurseurClavier(lGenreCurseur);const lStrApres=this.getStrSaisieCourante();if(lStrAvant!==lStrApres){this.actualiserVisuSaisie();}}
estToucheDouble(aTouche){return(aTouche.id===this.idTouche.valider);}}
function _getIdToucheChiffre(aChiffre){return this.idTouche.chiffre+'_'+aChiffre;}
function _estIdToucheChiffre(aId){return aId.startsWith(this.idTouche.chiffre+'_');}
function _getIdToucheAnnotation(aGenreAnnotation){return this.idTouche.annotation+'_'+aGenreAnnotation;}
function _estIdToucheAnnotation(aId){return aId.startsWith(this.idTouche.annotation+'_');}
function _getToucheParId(aParam){for(let i=0,lNbr=this.listeTouches.length;i<lNbr;i++){const lTouche=this.listeTouches[i];if(lTouche.id===aParam.id){return lTouche;}}
return null;}
function _newTouche(aParam){const lTouche=Identite.creerInstance(ToucheClavierVirtuel,{pere:this,evenement:this.surEvntTouche.bind(this)});lTouche.setDonnees({type:Clavier_SaisieNote.EGenreTouche.getType(aParam.genreTouche),affichage:Clavier_SaisieNote.EGenreTouche.getInfosAffichage(aParam.genreTouche),valeur:aParam.valeur,hint:aParam.hint,genreTouche:aParam.genreTouche,id:aParam.id});return lTouche;}
function _newTouche_Annotation(aParam){const lParam={genreTouche:Clavier_SaisieNote.EGenreTouche.annotation};return _newTouche.call(this,$.extend({},lParam,aParam));}
function _newTouche_Numerique(aParam){const lParam={genreTouche:Clavier_SaisieNote.EGenreTouche.numerique};return _newTouche.call(this,$.extend({},lParam,aParam));}
function _newTouche_Action(aParam){const lParam={genreTouche:Clavier_SaisieNote.EGenreTouche.action};return _newTouche.call(this,$.extend({},lParam,aParam));}
Clavier_SaisieNote.EGenreTouche={annotation:'annotation',numerique:'numerique',action:'action'};Clavier_SaisieNote.EGenreTouche.getInfosAffichage=function(aGenreTouche){switch(aGenreTouche){case Clavier_SaisieNote.EGenreTouche.annotation:return{css:'toucheAnnot'};case Clavier_SaisieNote.EGenreTouche.numerique:return{css:'toucheNum'};case Clavier_SaisieNote.EGenreTouche.action:return{css:'toucheAction'};}};Clavier_SaisieNote.EGenreTouche.getType=function(aGenreTouche){switch(aGenreTouche){case Clavier_SaisieNote.EGenreTouche.action:return ETypeToucheClavier.image;default:return ETypeToucheClavier.texte;}};function getTabAnnotations(){return[
EGenreAnnotation.absent,EGenreAnnotation.dispense,EGenreAnnotation.nonNote,EGenreAnnotation.nonRendu,EGenreAnnotation.inapte,EGenreAnnotation.absentZero,EGenreAnnotation.nonRenduZero,EGenreAnnotation.felicitations
];}
function _estStrToucheAnnotation(aStr){if(this.options.avecAnnotations){const lNote=new TypeNote();for(let i=0,lNbr=this.listeAnnotations.length;i<lNbr;i++){const lGenreAnnotation=this.listeAnnotations[i];if(lNote.getChaineAnnotationDeGenre(lGenreAnnotation)===aStr){return true;}}}
return false;}
module.exports=Clavier_SaisieNote;},fn:"clavier_saisienote.js"});;
IE.fModule({f:function(exports,require,module,global){const IEHtml=require('IEHtml.js');const GHtml=require('GHtml.js');const GTraductions=require('ObjetTraduction.js');const Identite=require('ObjetIdentite.js');const Clavier_SaisieNote=require('Clavier_SaisieNote.js');const TypeNote=require('TypeNote.js');IEHtml.addBalise('ie-inputnote',function(aContexteCourant,aOutils){let lJInput,lRacine,lNomModele=aOutils.getModel(aContexteCourant),lOptions={avecVirgule:true,afficherAvecVirgule:true,avecAnnotation:true,listeAnnotations:null,sansNotePossible:true,min:0,max:100,selectionSurFocus:true,textAlign:'right',hintSurErreur:false,titreMessageMinMax:'',messageMinMax:GTraductions.getValeur('InputNote.MinMax'),maxLength:15,avecSigneMoins:false,htmlContexte:''};lJInput=$('<div></div>');lRacine=lJInput.get(0);const lSetHtmlNote=function(aNote){let lVal='';if(aNote){if(!lOptions.avecVirgule||!lOptions.afficherAvecVirgule){lVal=aNote.getNoteSansDecimaleForcee();} else{lVal=aNote.getNote();}}
GHtml.setHtml(lRacine,lVal||'&nbsp;');};aOutils.copyAttributs(aContexteCourant.node,lRacine);lRacine.classList.add('ie-inputnote');aOutils.replaceNode(aContexteCourant.node,lRacine);aOutils.addCommentaireDebug(lRacine,'ie-inputnote');if(lNomModele){aOutils.surNodeEtNodeAfter(aContexteCourant);const lGetOptions=aOutils.getAccesParametresModel('getOptionsNote',aContexteCourant),lGetNote=aOutils.getAccesParametresModel('getNote',aContexteCourant),lSetNote=aOutils.getAccesParametresModel('setNote',aContexteCourant),lGetDisabled=aOutils.getAccesParametresModel('getDisabled',aContexteCourant);if(lGetOptions.estFonction){Object.assign(lOptions,lGetOptions.callback());}
if(lOptions.textAlign){lJInput.css('text-align',lOptions.textAlign);}
if(lGetNote.estFonction&&lSetNote.estFonction){let lNote=lGetNote.callback();lSetHtmlNote(lNote);let lDisabled=false;if(lGetDisabled.estFonction){lDisabled=!!lGetDisabled.callback();if(lDisabled){lRacine.classList.add('disabled');}}
lJInput.on({'click':function(){if(lDisabled){return;}
lRacine.classList.add('active');const lClavierSaisieNote=Identite.creerInstance(Clavier_SaisieNote,{pere:this||{},evenement:function(aValeurSaisie){lSetNote.callback([aValeurSaisie]);const lNote=lGetNote.callback();lSetHtmlNote(lNote);lRacine.classList.remove('active');aContexteCourant.contexte.refresh();}});const lNote=lGetNote.callback();lClavierSaisieNote.setOptions({clavier:{valeurInit:lNote.getNote()},metier:{avecAnnotations:lOptions.avecAnnotation,avecSeparateurDecimal:lOptions.avecVirgule,avecSigneMoins:lOptions.avecSigneMoins,sansNotePossible:lOptions.sansNotePossible,min:lOptions.min,max:lOptions.max,htmlContexte:lOptions.htmlContexte},grille:{nbLignes:4},methodeValidationNote:TypeNote.validerNote});lClavierSaisieNote.afficher();}.bind(aContexteCourant.instance)});aOutils.abonnerRefresh(function(){const lNewNote=lGetNote.callback();if((lNewNote&&!lNote)||(!lNewNote&&lNote)||(lNewNote.egal&&!lNewNote.egal(lNote))){lNote=lNewNote;lSetHtmlNote(lNote);}
if(lGetDisabled.estFonction){const lNewDisabled=!!lGetDisabled.callback();if(lDisabled!==lNewDisabled){lDisabled=lNewDisabled;if(lDisabled){lRacine.classList.add('disabled');} else{lRacine.classList.remove('disabled');}}}},lRacine,aContexteCourant);} else{}} else{}});module.exports=IEHtml;},fn:"iehtml.inputnote_mobile.js"});;
IE.fModule({f:function(exports,require,module,global){if(IE.estMobile){module.exports=require('IEHtml.InputNote_Mobile.js');} else{module.exports=require('IEHtml.InputNote_Espace.js');}},fn:"iehtml.inputnote.js"});;
IE.fModule({f:function(exports,require,module,global){require('Produit/Css/IEHtml.TextareaMax.css');const EGenreBordure=require('_ObjetStyle.js').EGenreBordure;const IEHtml=require('IEHtml.js');const GHtml=require('GHtml.js');const GStyle=require('GStyle.js');const Support=require('ObjetSupport.js');const GTraductions=require('ObjetTraduction.js');const GChaine=require('GChaine.js');IEHtml.addBalise('ie-textareamax',function(aContexteCourant,aOutils){const lModele=aOutils.getModel(aContexteCourant);const lMap=aOutils.getMapDeNode(aContexteCourant.node);let llName;let lContexteCourant;let H;let lMaxLength=0;let lAvecMaxLength=false;const lOptions={heightCompteur:'1.4rem',pourcentageAvertissement:0.9,couleurFond:GCouleur.nonEditable.fond,couleurBordure:GCouleur.bordure,couleurTexte:GCouleur.themeNeutre.foncee,couleurTexteAvertissement:'red',borduresZoneMax:EGenreBordure.haut,longueurTexte:-1,libelleMax_dd:'%d/%d',getCompteur:null};let lSpeechRecognizer=null;let lInRecognition=false;let lJSpeechReco=null;let lJTextArea=null;let lAvecRefreshSelonTaille=null;const lFLogSpeech=function(aMsg){let lMsg=aMsg;switch(aMsg){case'no-speech':lMsg=GTraductions.getValeur('SaisieVocale.NoSpeech');break;case'aborted':lMsg=GTraductions.getValeur('SaisieVocale.Aborted');break;case'audio-capture':lMsg=GTraductions.getValeur('SaisieVocale.AudioCapture');break;case'network':lMsg=GTraductions.getValeur('SaisieVocale.Network');break;case'not-allowed':lMsg=GTraductions.getValeur('SaisieVocale.NotAllowed');break;case'service-not-allowed':lMsg=GTraductions.getValeur('SaisieVocale.ServiceNotAllowed');break;case'bad-grammar':lMsg=GTraductions.getValeur('SaisieVocale.BadGrammar');break;case'language-not-supported':lMsg=GTraductions.getValeur('SaisieVocale.LanguageNotSupported');break;default:lMsg=aMsg;}
if(!!lMsg){lJSpeechReco.children('i').attr('class','icon_microphone_off').before('<div style="position:absolute;top:-15px;right:0;">'+lMsg+'</div>').prev().delay(3000).queue(function(){$(this).remove();});}
lInRecognition=false;aContexteCourant.controleur.$refreshSelf();};if(!lModele){}
if(lModele&&aContexteCourant.data.$modeleParsed){const lInfosGetOptions=aOutils.getAccesParametresModel('getOptions',aContexteCourant);if(lInfosGetOptions&&lInfosGetOptions.estFonction){Object.assign(lOptions,lInfosGetOptions.callback([lOptions]));}}
let lAvecCompteur=false;if(lMap['ie-compteur']!==undefined){lAvecCompteur=true;aOutils.addCommentaireDebug(aContexteCourant.node,'ie-compteur');aContexteCourant.node.removeAttribute('ie-compteur');delete lMap['ie-compteur'];} else if(lMap.maxlength||lMap['ie-compteurmax']){lAvecCompteur=true;lAvecMaxLength=true;lMaxLength=parseInt(lMap.maxlength||lMap['ie-compteurmax'],10);if(lMap['ie-compteurmax']){aOutils.addCommentaireDebug(aContexteCourant.node,'ie-compteurmax:"'+lMap['ie-compteurmax']+'"');aContexteCourant.node.removeAttribute('ie-compteurmax');delete lMap['ie-compteurmax'];}}
if(lAvecCompteur){const lCouleur=aContexteCourant.node.style.borderColor;if(lCouleur!=='initial'&&
lCouleur!==''&&
lCouleur!=='-moz-use-text-color'&&
lCouleur!=='currentColor'){lOptions.couleurBordure=lCouleur;}}
if(!!Support.speechRecognition&&!IE.estMobile){try{lSpeechRecognizer=new Support.speechRecognition();lSpeechRecognizer.interimResults=true;lSpeechRecognizer.lang=GParametres.langue;lSpeechRecognizer.onresult=function(event){for(let i=event.resultIndex;i<event.results.length;i++){if(event.results[i].isFinal){lJTextArea.get(0).value+=(lJTextArea.get(0).value!==''?' ':'')+event.results[i][0].transcript;lInRecognition=false;lJTextArea.trigger('change');aContexteCourant.controleur.$refreshSelf();}}};lSpeechRecognizer.onerror=function(event){lFLogSpeech(event.error);aContexteCourant.controleur.$refreshSelf();};} catch(ex){lFLogSpeech(ex.error);aContexteCourant.controleur.$refreshSelf();}}
const lAvecWrapperCompteurMobile=lAvecCompteur&&!!IE.estMobile;const lAvecWrapperCompteurEspace=!lAvecWrapperCompteurMobile&&(lAvecCompteur||!!lSpeechRecognizer);const lEstAutoSize=lMap['ie-autoresize']!==undefined||(IE.estMobile&&!$(aContexteCourant.node).hasClass('ie-no-autoresize'));if(lAvecWrapperCompteurMobile){H=['<div tabIndex="-1" class="textareamax-wrapper">','<textarea class="textareamax"></textarea>','<span class="tam_counter character-counter"></span>','</div>'
];} else if(lAvecWrapperCompteurEspace){H=['<div tabIndex="-1" class="textareamax-wrapper">','<div class="textarea-style">','<textarea class="textareamax"></textarea>','</div>',lAvecCompteur?'<div class="tam_counter'+(lSpeechRecognizer?' tam_withspeech':'')+' textarea-counter"'+' style="display:none;'+(lEstAutoSize?'':GStyle.composeCouleurFond(lOptions.couleurFond)+
GStyle.composeCouleurBordure(lOptions.couleurBordure,1,lOptions.borduresZoneMax))+(lOptions.heightCompteur?'height:'+lOptions.heightCompteur+';':'')+'">'+'<span></span>'+'</div>':'',lSpeechRecognizer?'<div class="tam_speech textarea-counter"><i class="icon_microphone"></div>':'','</div>'];} else{H=['<textarea class="textareamax"></textarea>'];}
const lDivConteneur=GHtml.htmlToDOM(H.join(''));const lJConteneur=$(lDivConteneur);let lJConteneurTextarea=null;let lJConteneurMax=null;let lJLibelleMax=null;if(lAvecWrapperCompteurMobile){lJTextArea=lJConteneur.children().first();lJLibelleMax=lJConteneur.children().eq(1);lJConteneurMax=lJLibelleMax;} else if(lAvecWrapperCompteurEspace){lJConteneurTextarea=lJConteneur.children().first();lJTextArea=lJConteneurTextarea.children().first();if(lAvecCompteur){lJConteneurMax=lJConteneur.children().eq(1);lJLibelleMax=lJConteneurMax.children().first();}
lJSpeechReco=lJConteneur.children().eq(lAvecCompteur?2:1);} else{lJTextArea=lJConteneur;}
for(llName in lMap){try{switch(llName){case'ie-autoresize':break;case'id':case'readonly':case'disabled':case'placeholder':case'maxlength':case'ie-trim':case'ie-textbrut':lJTextArea.attr(llName,lMap[llName]);break;case'ie-idcont':if(lAvecWrapperCompteurEspace||lAvecWrapperCompteurMobile){lJConteneur.attr('id',lMap[llName]);}
break;default:if(llName.startsWith('aria-')){lJTextArea.attr(llName,lMap[llName]);} else{if(llName==='class'){lJConteneur.addClass(lMap[llName]);} else{lJConteneur.attr(llName,lMap[llName]);}}}} catch(e){}}
if(lEstAutoSize){lJConteneur.addClass('ie-autoresize');lJTextArea.attr('ie-autoresize','');}
if(lAvecWrapperCompteurEspace||lAvecWrapperCompteurMobile){if(aContexteCourant.data.$modeleValue){lContexteCourant=Object.assign({},aContexteCourant);lContexteCourant.node=lJTextArea.get(0);aOutils.gererInputText(lContexteCourant,'');}
if(lJLibelleMax&&lJLibelleMax.length===1){aOutils.surInjectionHtml(aContexteCourant,function(){aContexteCourant.controleur.$refreshSelf();});aOutils.abonnerRefresh(function(){const lValue=lJTextArea.get(0).value||'';const lLongueur=lOptions.getCompteur?lOptions.getCompteur(lValue):lValue.length;if(lLongueur!==lOptions.longueurTexte){lOptions.longueurTexte=lLongueur;if(lAvecMaxLength){lJLibelleMax.get(0).innerHTML=GChaine.Format(lOptions.libelleMax_dd,[lLongueur,lMaxLength]);lJConteneurMax.css('color',lLongueur>lMaxLength*lOptions.pourcentageAvertissement?lOptions.couleurTexteAvertissement:lOptions.couleurTexte);} else{lJLibelleMax.get(0).innerHTML=lLongueur;}}},lJLibelleMax.get(0),aContexteCourant);}}
const lFuncEstNonEditable=function(){return!!(lJTextArea.is(':disabled')||lJTextArea.prop('readonly'));};let lEstNonEditable=lFuncEstNonEditable();const lAppliquerDisabled=function(){if(lEstNonEditable){lJConteneur.addClass('disabled');} else{lJConteneur.removeClass('disabled');}};lAppliquerDisabled();if(lAvecWrapperCompteurEspace){lJConteneur.css({position:'relative'});let lTimeoutFocusOut;lJConteneur.on({'focusin':function(){clearTimeout(lTimeoutFocusOut);if(lFuncEstNonEditable()){return;}
if(lJConteneurMax){lJConteneurMax.show();}
if(lOptions.heightCompteur){lJConteneurTextarea.css('bottom',lOptions.heightCompteur);}
aContexteCourant.controleur.$refreshSelf();},'focus':function(){lJTextArea.focus();},'focusout':function(){if(lJConteneurMax){lJConteneurMax.hide();}
lJConteneurTextarea.css('bottom','0');lTimeoutFocusOut=setTimeout(function(){lJTextArea.trigger('focusout_TextareaMax');},0);}});} else{(lAvecWrapperCompteurEspace||lAvecWrapperCompteurMobile?lJConteneur:lJTextArea).on('focusout',function(){lJTextArea.trigger('focusout_TextareaMax');});}
aOutils.abonnerRefresh(function(){if(lEstNonEditable!==lFuncEstNonEditable()){lEstNonEditable=!lEstNonEditable;lAppliquerDisabled();}
if(lAvecRefreshSelonTaille){lAvecRefreshSelonTaille();}},lDivConteneur,aContexteCourant);if(lSpeechRecognizer&&lJSpeechReco.length>0){(lEstAutoSize?lJSpeechReco.children('i'):lJSpeechReco).on({'click':function(){if(!lFuncEstNonEditable()){if(!lInRecognition){try{lSpeechRecognizer.start();lInRecognition=true;lJSpeechReco.children('i').attr('class','icon_microphone');} catch(ex){lFLogSpeech(ex.error);}} else{try{lSpeechRecognizer.stop();lInRecognition=false;} catch(ex){lFLogSpeech(ex.error);}}
lJSpeechReco.children('i').css('color',lInRecognition?'red':'');aContexteCourant.controleur.$refreshSelf();}}});}
aOutils.replaceNode(aContexteCourant.node,lDivConteneur);aContexteCourant.node=lDivConteneur;aOutils.addCommentaireDebug(lDivConteneur,'ie-textareamax');return{node:aContexteCourant.node,avecCompileFils:lAvecWrapperCompteurMobile||lAvecWrapperCompteurEspace};});module.exports=IEHtml;},fn:"iehtml.textareamax.js"});;
IE.fModule({f:function(exports,require,module,global){const EGenreCommandeMenu={Creation:'cmdMenu_creation',Edition:'cmdMenu_edition',Suppression:'cmdMenu_suppression'};module.exports=EGenreCommandeMenu;},fn:"enumere_commandemenu.js"});;
IE.fModule({f:function(exports,require,module,global){const MethodesObjet=require('MethodesObjet.js');class ObjetIndexsUnique{constructor(){this._indexsUnique=[];}
ajouterIndex(aChamps){if(!MethodesObjet.isArray(aChamps)&&!MethodesObjet.isString(aChamps)){return this;}
if(!this._indexsUnique){this._indexsUnique=[];}
const lChamps=[];let lChampIndex;let lChampIndexCalcul;if(!MethodesObjet.isArray(aChamps)){aChamps=[aChamps];}
for(let i=0;i<aChamps.length;i++){lChampIndex=aChamps[i];if(lChampIndex.valeur){lChampIndexCalcul=lChampIndex;} else{lChampIndexCalcul=ObjetIndexsUnique.ajouterChamp(lChampIndex);}
lChamps.push(lChampIndexCalcul);}
this._indexsUnique.push(lChamps);return this;}
estDoublon(a,b){for(let i=0;i<this._indexsUnique.length;i++){if(_estDoublonComparaisonET(this._indexsUnique[i],a,b)){return true;}}
return false;}
estDoublonDansTableau(aElement,aTableau){for(const i in aTableau){if(this.estDoublon(aElement,aTableau[i])){return true;}}
return false;}
existeIndex(){return this._indexsUnique.length>0;}
static ajouterChamp(aValeur,aVideEstDoublon,aSensibleCasse){return{valeur:aValeur,videEstDoublon:!!aVideEstDoublon,sensibleCasse:!!aSensibleCasse,estFonction:MethodesObjet.isFunction(aValeur),estAccesseurChaine:MethodesObjet.isString(aValeur)&&aValeur.indexOf('.')>=0};}}
function _estDoublonComparaisonET(aIndexUnique,a,b){let lResult=false;for(let i=0;i<aIndexUnique.length;i++){if(aIndexUnique[i]){if(_comparateurChampIndex(aIndexUnique[i],a,b)){lResult=true;} else{return false;}}}
return lResult;}
function _comparateurChampIndex(aChampIndex,a,b){if(!aChampIndex||!aChampIndex.valeur){return false;}
if(!a||!b){return false;}
let lValeurA;let lValeurB;if(aChampIndex.estFonction){lValeurA=aChampIndex.valeur(a);lValeurB=aChampIndex.valeur(b);} else if(aChampIndex.estAccesseurChaine){lValeurA=MethodesObjet.get(a,aChampIndex.valeur);lValeurB=MethodesObjet.get(b,aChampIndex.valeur);} else{lValeurA=a[aChampIndex.valeur];lValeurB=b[aChampIndex.valeur];}
if(lValeurA&&lValeurA.getTime){lValeurA=lValeurA.getTime();}
if(lValeurB&&lValeurB.getTime){lValeurB=lValeurB.getTime();}
if(aChampIndex.sensibleCasse!==true){if(lValeurA&&lValeurA.toLowerCase){lValeurA=lValeurA.toLowerCase();}
if(lValeurB&&lValeurB.toLowerCase){lValeurB=lValeurB.toLowerCase();}}
if(lValeurA===lValeurB&&(lValeurA===''||lValeurA===undefined||lValeurA===null)){return!!aChampIndex.videEstDoublon;} else{return lValeurA===lValeurB;}}
module.exports=ObjetIndexsUnique;},fn:"objetindexsunique.js"});;
IE.fModule({f:function(exports,require,module,global){const MethodesObjet=require('MethodesObjet.js');const GChaine=require('GChaine.js');const GStyle=require('GStyle.js');const EGenreCommandeMenu=require('Enumere_CommandeMenu.js');const EGenreEtat=require('Enumere_Etat.js');const{GDate}=require('ObjetDate.js');const ObjetElement=require('ObjetElement.js');const ObjetListeElements=require('ObjetListeElements.js');const GTraductions=require('ObjetTraduction.js');const ObjetIndexsUnique=require('ObjetIndexsUnique.js');const TypeNote=require('TypeNote.js');class ObjetDonneesListe{constructor(aDonnees){this.Donnees=!aDonnees?new ObjetListeElements():aDonnees;this.enImpression=false;this.enConstruction_cacheRechercheTexte=false;this.__getIdsColonnes=null;this.__getParams=null;this.options={avecSelection:true,avecEdition:true,avecSuppression:true,editionApresSelection:true,editionSurSelectionApresFinEdition:false,avecEvnt_Selection:false,avecEvnt_ModificationSelection:false,avecEvnt_SelectionClick:false,avecEvnt_SelectionDblClick:false,avecEvnt_Edition:false,avecEvnt_ApresEdition:false,avecEvnt_ApresEditionValidationSansModification:false,avecEvnt_Creation:false,avecEvnt_ApresCreation:false,avecEvnt_Suppression:false,avecEvnt_ApresSuppression:false,avecEvnt_KeyPressListe:false,avecTimeoutEvent_KeyPressListe:true,avecEvnt_KeyUpListe:false,avecEvnt_Deploiement:false,avecVoileBleuHover:true,avecMultiSelection:false,selectionParCellule:false,avecMultiSelectionSurCtrl:true,avecMultiSelectionSurShift:true,avecMultiSelectionSurLigneFusion:true,avecSelectionSurNavigationClavier:false,avecNavigationClavierFlechesEnEdition:false,avecCelluleSuivanteSurFinEdition:false,avecRechercheSelectionMiroir:false,avecDeselectionSurNonSelectionnable:true,avecDeselectionMonoSelectionClick:false,avecDeselectionMonoSelectionClickCtrl:false,avecEtatSaisie:true,avecTri:true,avecContenuTronque:false,avecEllipsisContenuTronque:true,avecDeploiement:false,avecDeploiementSurColonne:true,avecImageSurColonneDeploiement:false,avecEventDeploiementSurCellule:true,avecInterruptionSuppression:false,avecTrimSurEdition:false,indentationCelluleEnfant:12,hauteurMinCellule:ObjetDonneesListe.hauteurMinCellule,hauteurMinContenuCellule:0,alignVCenter:false,avecLigneDraggable:false,avecLigneDroppable:false,dragNDropLigneInsertion:true,avecHtmlDetailsDraggableOver:true,getValeur:null,nonEditable:false,racineCss:MethodesObjet.getObjectClass(this)};}
setOptions(aOptions){$.extend(this.options,aOptions);return this;}
getControleur(aDonneeListe,aListe){return null;}
AvecSelection(I,D){return this.options.avecSelection;}
avecDeselection(aLigne,aColonne,aElement){return this.AvecMultiSelection()?true:(this.options.avecDeselectionMonoSelectionClickCtrl||this.options.avecDeselectionMonoSelectionClick);}
selectionParCellule(aColonne,aArticle){return this.options.selectionParCellule;}
AvecEdition(aColonne,aArticle,aParams){return this.options.avecEdition;}
avecEditionApresSelection(aParams){if(aParams.typeValeur===ObjetDonneesListe.ETypeCellule.Coche){return false;}
return this.options.editionApresSelection;}
getColonneTransfertEdition(aParams){return null;}
AvecSuppression(aArticle,aListeSelection,aParams){return this.options.avecSuppression;}
AvecEtatSaisie(aParamsCellule){return this.options.avecEtatSaisie;}
AvecTri(){return this.options.avecTri;}
AvecMenuContextuel(aParams){return aParams.article&&aParams.ligne>=0?this.options.avecContextMenuSansSelection||this.AvecSelection(aParams.colonne,aParams.article):false;}
avecContenuTronque(aParams){return this.options.avecContenuTronque;}
AvecDeploiement(){return this.options.avecDeploiement;}
AvecDeploiementSurColonne(aParams){return this.options.avecDeploiementSurColonne;}
avecImageSurColonneDeploiement(aParams){return this.options.avecImageSurColonneDeploiement;}
avecEventDeploiementSurCellule(aParams){return this.options.avecEventDeploiementSurCellule;}
getIndentationCelluleSelonParente(aParams){if(!aParams){return 0;}
let lIndent=0,lArticle=aParams.article;while(lArticle&&lArticle.pere){lIndent+=this.options.indentationCelluleEnfant||0;lArticle=lArticle.pere;}
return lIndent;}
getIndentationCellule(aParams){return 0;}
avecAlternanceCouleurLigne(aParamsCellule){if(this.estUnDeploiement(aParamsCellule)||(aParamsCellule.celluleLignePrecedente&&this.estUnDeploiement(aParamsCellule.celluleLignePrecedente))){return 0;}
return true;}
surDeploiement(I,J,D){D.estDeploye=!D.estDeploye;}
AvecEvenement_Selection(I,D,aParams){return this.options.avecEvnt_Selection;}
AvecEvenement_SelectionClick(I,D,aParams){return this.options.avecEvnt_SelectionClick;}
AvecEvenement_SelectionDblClick(I,D,aParams){return this.options.avecEvnt_SelectionDblClick;}
AvecEvenement_Creation(I){return this.options.avecEvnt_Creation;}
AvecEvenement_Edition(I,D,aParams){return this.options.avecEvnt_Edition;}
AvecEvenement_Suppression(D,aParams){return this.options.avecEvnt_Suppression;}
AvecEvenement_Deploiement(I,D,aParams){return this.options.avecEvnt_Deploiement;}
AvecEvenement_ApresCreation(){return this.options.avecEvnt_ApresCreation;}
AvecEvenement_ApresErreurCreation(){return false;}
AvecEvenement_ApresEdition(aLigne,aColonne,aDonnee,aParams){return this.options.avecEvnt_ApresEdition;}
AvecEvenement_ApresSuppression(){return this.options.avecEvnt_ApresSuppression;}
avecInterruptionSuppression(){return this.options.avecInterruptionSuppression;}
SurSelectionLigne(aLigne,aDonnee,aSelectionner){}
SurSelection(aColonne,aDonnee,aLigne,aSelectionner){}
SurCreation(D,V,J){}
avecCreationElementsDynamique(aListeValeurs,aLigneCreation){return false;}
SurEdition(aParams,I,D,V){}
forcerActualisationListeSurEdition(aParams){return true;}
SurSuppression(aArticle){aArticle.SetEtat(EGenreEtat.Suppression);}
avecSelecFile(aParams){return false;}
getOptionsSelecFile(aParams){return null;}
evenementSurSelecFile(aParams,aParamsSelecFile){}
avecLigneDraggable(aParams){return this.options.avecLigneDraggable;}
getLibelleDraggable(aParams){return'';}
getHtmlDetailsDraggableOver(aParams,aDataDrag){if(!this.options.avecHtmlDetailsDraggableOver){return'';}
return'<div class="draggable_details_Deplacer"></div><label>'+(this.options.dragNDropLigneInsertion?GTraductions.getValeur('liste.ChangerRang'):GTraductions.getValeur('liste.EchangerRang'))+'</label>';}
avecLigneDroppable(aParams){return this.options.avecLigneDroppable;}
autoriserDeplacementElementSurLigne(aParamsLigneDestination,aParamsSource){return aParamsSource.instance&&aParamsLigneDestination.instance&&aParamsSource.instance.Nom===aParamsLigneDestination.instance.Nom&&aParamsLigneDestination.article&&aParamsSource.article&&aParamsLigneDestination.ligne!==aParamsSource.ligne;}
surDeplacementElementSurLigne(aParamsLigneDestination,aParamsSource){}
GetEtatSurEdition(aParams,aArticle){return EGenreEtat.Modification;}
Edition_Confirmation(aParams){return false;}
Suppression_Impossible(D,aListeSelections){return false;}
Suppression_Confirmation(D,aListeSelections){return true;}
getTri(aColonneDeTri,aGenreTri){}
GetVisible(aDonnee){return true;}
GetValeur(I,D,aParams){if(MethodesObjet.isFunction(this.options.getValeur)){return this.options.getValeur(aParams);}
return D?D.GetLibelle():'';}
GetValeurParDefaut(aParams){return'';}
getValeurPourTri(aColonne,aArticle){return this.GetValeur(aColonne,aArticle,this.__getParams(aColonne,-1,{surTri:true,article:aArticle}));}
GetValeurPourAffichage(aParams){return this.GetValeur(aParams.colonne,aParams.article,aParams);}
getHintHtmlForce(aParams){return'';}
getHintForce(aParams,I,D){return'';}
GetTypeValeur(aParams,I,D){return ObjetDonneesListe.ETypeCellule.Texte;}
GetTailleTexteMax(aParams){return 0;}
avecTrimSurEdition(aParams){return this.options.avecTrimSurEdition;}
autoriserChaineVideSurEdition(aParams){return false;}
GetCouleurCellule(aParams,aColonne,aArticle,aCouleurCellule){}
getClassCelluleConteneur(aParams){return'';}
getClass(aParams,I,D){return'';}
getStyle(aParams,I,D){return'';}
alignVCenter(aParams){return this.options.alignVCenter;}
getPadding(aParams){return false;}
getNiveauDeploiement(aParams){return 1;}
getColonneDeFusion(aParamsCellule){return null;}
fusionCelluleAvecColonnePrecedente(aParams,aColonne,aArticle){return false;}
fusionCelluleAvecLignePrecedente(aParamsCellule){return false;}
avecBordureDroite(aParams){return true;}
avecBordureBas(aParamsLigne){return true;}
avecBordureHaut(aParams){return false;}
initialiserObjetGraphique(I,D,aInstance){return null;}
setDonneesObjetGraphique(I,D,aInstance){return null;}
AvecMultiSelection(){return this.options.avecMultiSelection;}
avecMultiSelectionSurCtrl(){return this.options.avecMultiSelectionSurCtrl;}
avecMultiSelectionSurShift(){return this.options.avecMultiSelectionSurShift;}
estSelectionCibleMiroirDeSelectionSource(aParamsCelluleSource,aParamsCelluleCible){return!!aParamsCelluleSource.article.GetNumero()&&aParamsCelluleSource.article.GetNumero()===aParamsCelluleCible.article.GetNumero();}
getListeLignesTotal(){return null;}
getContenuTotal(aParams){return'';}
getTypeCelluleTotal(aParams){return ObjetDonneesListe.typeCelluleTotal.defaut;}
getStyleTotal(aParams){switch(aParams.typeCellule){case ObjetDonneesListe.typeCelluleTotal.defaut:return GStyle.composeCouleurFond(GCouleur.liste.total.fond)+GStyle.composeCouleurTexte(GCouleur.liste.total.texte);case ObjetDonneesListe.typeCelluleTotal.fond:return GStyle.composeCouleurTexte(GCouleur.liste.texte);case ObjetDonneesListe.typeCelluleTotal.editable:return GStyle.composeCouleurFond(GCouleur.liste.editable.fond);default:;}
return'';}
getClassTotal(aParams){return'';}
avecBordureTotalVisible(aParams){return aParams.typeCellule!==ObjetDonneesListe.typeCelluleTotal.fond;}
getColonneDeFusionTotal(aParams){return null;}
AvecEvenement_SelectionClickTotal(aParams){return false;}
GetMessage_Doublon(aElement){return aElement&&aElement.GetLibelle()?GTraductions.getValeur('liste.doublonNom',[aElement.GetLibelle()]):GTraductions.getValeur('liste.doublon');}
GetMessage_Creation_Impossible(aErreur){return GTraductions.getValeur('liste.creationImpossible');}
GetMessage_Edition_Impossible(aColonne,aDonnee,aErreur){return GTraductions.getValeur('liste.editionImpossible');}
GetMessage_Edition_Confirmation(aColonne,aDonnee,aParams){return'';}
GetMessage_Suppression_Impossible(aDonnee,aListeSelections){return GTraductions.getValeur('liste.suppressionImpossible');}
GetMessage_Suppression_Confirmation(aDonnee,aListeSelections){return GTraductions.getValeur('liste.suppressionSelection');}
GetMessage_TailleMaximaleSaisie(aParams){return GTraductions.getValeur('liste.tailleMaxSaisie');}
editionRefusee(aParams){const lMessageRefus=this.getMessage_EditionRefusee(aParams.ligne,aParams.colonne,aParams.article);if(lMessageRefus){GApplication.getMessage().afficher({titre:lMessageRefus.titre||'',message:lMessageRefus.message||lMessageRefus});return true;}
return false;}
getMessage_EditionRefusee(aLigne,aColonne,aDonnee){return'';}
remplirMenuContextuel(aParametres){if(!aParametres.menuContextuel){return;}
if(aParametres.surFondListe){return;}
let lAvecCommandeActive=false,lCommande;if(aParametres.avecCreation){lCommande=aParametres.menuContextuel.AddCommande(EGenreCommandeMenu.Creation,GTraductions.getValeur('liste.creer'),!aParametres.nonEditable);if(lCommande.actif){lAvecCommandeActive=true;}}
lCommande=aParametres.menuContextuel.AddCommande(EGenreCommandeMenu.Edition,GTraductions.getValeur('liste.modifier'),!aParametres.nonEditable&&(!aParametres.listeSelection||aParametres.listeSelection.GetNbrElements()<=1)&&this.AvecEdition(aParametres.colonne,aParametres.article,aParametres));if(lCommande.actif){lAvecCommandeActive=true;}
lCommande=aParametres.menuContextuel.AddCommande(EGenreCommandeMenu.Suppression,GTraductions.getValeur('liste.supprimer'),!aParametres.nonEditable&&aParametres&&aParametres.avecSuppression&&this._AvecSuppression(aParametres));if(lCommande.actif){lAvecCommandeActive=true;}
return lAvecCommandeActive;}
getListeSupprimables(aListeSelections,aParamsCellule){const lListe=new ObjetListeElements();aListeSelections.parcourir(function(aElement){if(this.AvecSuppression(aElement,null,aParamsCellule)){lListe.AddElement(aElement);}},this);return lListe;}
initialisationObjetContextuel(aParametres){if(!aParametres.menuContextuel){return;}
const lAvecCommandeActive=this.remplirMenuContextuel(aParametres);if(lAvecCommandeActive!==false){aParametres.menuContextuel.SetDonnees(aParametres.id);}}
evenementMenuContextuel(aParametres){return false;}
EnModification(I){return true;}
getControleCaracteresInput(aParams){return null;}
_AvecSelection(aColonne,aLigne){return this.AvecSelection(aColonne,this.Donnees.GetElement(aLigne));}
_avecDeselection(aLigne,aColonne){return this.avecDeselection(aLigne,aColonne,this.Donnees.GetElement(aLigne));}
_AvecSuppression(aParams){if(aParams.listeSelection&&aParams.listeSelection.GetNbrElements()>0){let lAvecSuppression=false;aParams.listeSelection.parcourir(function(aElement){if(this.AvecSuppression(aElement,null,aParams)){lAvecSuppression=true;return false;}},this);return lAvecSuppression;}
return this.AvecSuppression(aParams.article,aParams.listeSelection,aParams);}
_SurSelectionLigne(aLigne,aSelectionner){return this.SurSelectionLigne(aLigne,this.Donnees.GetElement(aLigne),aSelectionner);}
_SurSelection(aColonne,aLigne,aSelectionner){return this.SurSelection(aColonne,this.Donnees.GetElement(aLigne),aColonne,aSelectionner);}
_GetTailleTexteMax(aParams){switch(this.GetTypeValeur(aParams,aParams.colonne,aParams.article)){case ObjetDonneesListe.ETypeCellule.Texte:case ObjetDonneesListe.ETypeCellule.ZoneTexte:return this.GetTailleTexteMax(aParams);default:return 0;}}
estUnDeploiement(aParams){return aParams&&aParams.article&&aParams.article.estUnDeploiement;}
_estDeploye(aLigne){return this.Donnees.GetElement(aLigne).estDeploye;}
_initialiserObjetGraphique(aColonne,aLigne,aInstance){return this.initialiserObjetGraphique(aColonne,this.Donnees.GetElement(aLigne),aInstance);}
_setDonneesObjetGraphique(aColonne,aLigne,aInstance){return this.setDonneesObjetGraphique(aColonne,this.Donnees.GetElement(aLigne),aInstance);}
GetIndice(aDonnee){for(let J=0;J<this.GetNbrLignes();J++){if(this.Donnees.GetElement(J)===aDonnee){return J;}}
return-1;}
GetMessage(){return this.Message;}
_GetValeur(aParams){const lDonnee=aParams.ligne===null||aParams.ligne===undefined?null:this.Donnees.GetElement(aParams.ligne);const lValeur=aParams.ligne===null||aParams.ligne===undefined?this.GetValeurParDefaut(aParams):this.GetValeur(aParams.colonne,lDonnee,aParams);switch(this.GetTypeValeur(aParams,aParams.colonne,lDonnee)){case ObjetDonneesListe.ETypeCellule.Texte:return lValeur;case ObjetDonneesListe.ETypeCellule.ZoneTexte:return lValeur;case ObjetDonneesListe.ETypeCellule.Html:return lValeur;case ObjetDonneesListe.ETypeCellule.Date:case ObjetDonneesListe.ETypeCellule.DateCalendrier:return this.getChaineDeDate(lValeur,aParams);case ObjetDonneesListe.ETypeCellule.Coche:return lValeur;case ObjetDonneesListe.ETypeCellule.CocheDeploiement:return'';case ObjetDonneesListe.ETypeCellule.Image:return lValeur;case ObjetDonneesListe.ETypeCellule.HeureMinute:if(MethodesObjet.isDate(lValeur)){return GDate.FormatDate(lValeur,'%hh%sh%mm');}
;return'';case ObjetDonneesListe.ETypeCellule.Note:{const lOptionsNote=this.getOptionsNote(aParams);if(!lValeur){return aParams.surEdition?null:lOptionsNote&&lOptionsNote.texteSiVide?lOptionsNote.texteSiVide:'';}
if(lValeur instanceof TypeNote){if(aParams.surEdition){return lValeur;}
let lLibelle=lOptionsNote&&!lOptionsNote.afficherAvecVirgule?lValeur.getNoteSansDecimaleForcee():lValeur.getNote();if(lOptionsNote&&lOptionsNote.avecParenthese){lLibelle='('+lLibelle+')';}
if(lOptionsNote&&!!lOptionsNote.suffixe){lLibelle=lLibelle+lOptionsNote.suffixe;}
if(lOptionsNote&&lOptionsNote.avecTiret){lLibelle='-';}
return lLibelle;}
;}}
return lValeur;}
_GetContenuAffichage(aParams){const lContenu={};lContenu.valeur=this._GetValeur(aParams);lContenu.title='';if(!this.enImpression){let lHintForce=this.getHintHtmlForce(aParams);if(lHintForce){lContenu.titleHtml=lHintForce;} else{lHintForce=this.getHintForce(aParams,aParams.colonne,aParams.article);if(lHintForce){lContenu.title=lHintForce;}}}
if(aParams.avecContenuTronque){switch(aParams.typeValeur){case ObjetDonneesListe.ETypeCellule.Texte:case ObjetDonneesListe.ETypeCellule.ZoneTexte:{const lChaineAffichage=this.GetValeurPourAffichage(aParams);lContenu.valeur=lChaineAffichage;if(!this.enImpression&&!lContenu.titleHtml&&!lContenu.title){lContenu.attrOverflow=this.options.avecEllipsisContenuTronque?'ie-ellipsis':'ie-hintoverflow';}}}}
lContenu.valeur=GChaine.AvecEspaceSiVide(lContenu.valeur+'');if(aParams.typeValeur!==ObjetDonneesListe.ETypeCellule.Html){lContenu.valeur=lContenu.valeur.replace(/\r\n/g,'<br>').replace(/\n/g,'<br>');}
return lContenu;}
getOptionsNote(aParams){return{afficherAvecVirgule:true,hintSurErreur:false};}
getValeurPourParsing(aParams){return this._GetValeur(aParams);}
getChaineDeDate(aDate,aParams){return(MethodesObjet.isDate(aDate))?GDate.FormatDate(aDate,'%JJ/%MM/%AA'):'';}
SetValeur(aParams){const lDonnee=this.Donnees.GetElement(aParams.ligne);switch(this.GetTypeValeur(aParams,aParams.colonne,lDonnee)){case ObjetDonneesListe.ETypeCellule.Texte:case ObjetDonneesListe.ETypeCellule.ZoneTexte:case ObjetDonneesListe.ETypeCellule.Html:return aParams.valeur;case ObjetDonneesListe.ETypeCellule.Date:case ObjetDonneesListe.ETypeCellule.DateCalendrier:{if(aParams.valeur===null||aParams.valeur===undefined){return'';}
const lValeur=aParams.valeur.split('/');if(lValeur[2].length===2){lValeur[2]='20'+lValeur[2];}
const lDate=new Date(lValeur[2],lValeur[1]-1,lValeur[0]);if(!isNaN(lDate)&&(lValeur[0].charAt(0)==='0')){lValeur[0]=lValeur[0].charAt(1);}
return isNaN(lDate)||!((lDate.getFullYear()===parseInt(lValeur[2]))&&(lDate.getMonth()===parseInt(lValeur[1]-1))&&(lDate.getDate()===parseInt(lValeur[0])))?null:lDate;}
case ObjetDonneesListe.ETypeCellule.Coche:{const lValeur=this.GetValeur(aParams.colonne,lDonnee,aParams);if(lValeur===ObjetDonneesListe.EGenreCoche.Verte){return ObjetDonneesListe.EGenreCoche.Aucune;}
if(lValeur===ObjetDonneesListe.EGenreCoche.Grise){return ObjetDonneesListe.EGenreCoche.Verte;}
if(lValeur===ObjetDonneesListe.EGenreCoche.Aucune||lValeur===undefined){return ObjetDonneesListe.EGenreCoche.Verte;}
return ObjetDonneesListe.EGenreCoche.Aucune;}
case ObjetDonneesListe.ETypeCellule.HeureMinute:{const lHeureMinute=GDate.parseHeureMinute(aParams.valeur);return lHeureMinute&&lHeureMinute.ok?lHeureMinute:null;}}
return aParams.valeur;}
GetMessage_Format(aParams){switch(this.GetTypeValeur(aParams,aParams.colonne,aParams.article)){case ObjetDonneesListe.ETypeCellule.Date:case ObjetDonneesListe.ETypeCellule.DateCalendrier:return GTraductions.getValeur('liste.erreurDate');case ObjetDonneesListe.ETypeCellule.HeureMinute:{const lBorneDebut='0'+GTraductions.getValeur('date.separateurHeure')+'00',lBorneFin='24'+GTraductions.getValeur('date.separateurHeure')+'00';return GChaine.Format(GTraductions.getValeur('liste.erreurHeureMinute'),[lBorneDebut,lBorneFin]);}}
return null;}
EstunDoublon(aDonnee){if(this._indexsUnique&&this._indexsUnique.existeIndex()){const lNb=this.GetNbrLignes();for(let J=0;J<lNb;J++){const lDonnee=this.Donnees.GetElement(J);if((lDonnee!==aDonnee)&&(lDonnee.Etat!==EGenreEtat.Suppression)){if(this._indexsUnique.estDoublon(aDonnee,lDonnee)){return true;}}}}
return false;}
_SurCreation(aListeValeurs,aLigneCreation,aParams){function _creerElement(){const lDonnee=new ObjetElement();lDonnee.Numero=ObjetElement.getNumeroCreation();return lDonnee;}
function _ajouterElement(aElement,aLigne){if(!this.EstunDoublon(aElement)){aElement.SetEtat(EGenreEtat.Creation);this.Donnees.AddElement(aElement);this.trier();aLigne=this.GetIndice(aElement);} else{this.Message=this.GetMessage_Doublon(aElement);}
return aLigne;}
this.Message=null;let lResult= -1;let lErreur_Format= -1;const lListeValeurs=[];let lParams;lListeValeurs[-1]=aListeValeurs[-1];lListeValeurs.data=aListeValeurs.data;for(let I=0;I<aListeValeurs.length;I++){if((aListeValeurs[I]!==null&&aListeValeurs[I]!==undefined)){lParams=Object.assign(aParams,{colonne:I,ligne:-1,valeur:aListeValeurs[I]});lListeValeurs[I]=this.SetValeur(lParams);if(lListeValeurs[I]===null||lListeValeurs[I]===undefined){lErreur_Format=I;}}}
if(lErreur_Format=== -1){const lAvecCreationDynamique=this.avecCreationElementsDynamique(lListeValeurs,aLigneCreation);let lDonneeCreation;if(lAvecCreationDynamique){lDonneeCreation=new ObjetListeElements();} else{lDonneeCreation=_creerElement();}
const lErreur=this.SurCreation(lDonneeCreation,lListeValeurs,aLigneCreation);if(lErreur===null||lErreur===undefined){if(lAvecCreationDynamique){if(lDonneeCreation.GetNbrElements()===0){this.Message=this.GetMessage_Creation_Impossible(lErreur);} else{lDonneeCreation.parcourir(function(aElement){lResult=_ajouterElement.call(this,aElement,lResult);},this);}} else{lResult=_ajouterElement.call(this,lDonneeCreation,lResult);}} else{this.Message=this.GetMessage_Creation_Impossible(lErreur);}} else{lParams=this.__getParams(lErreur_Format,lResult);this.Message=this.GetMessage_Format(Object.assign(aParams,lParams));}
return lResult;}
_SurEdition(aParams){this.Message=null;const lValeur=this.SetValeur(aParams);if((lValeur!==null&&lValeur!==undefined)){let lDonnee=this.Donnees.GetElement(aParams.ligne);const lValeurPrecedente=this.GetValeur(aParams.colonne,lDonnee,aParams);const lErreur=this.SurEdition(aParams,aParams.colonne,lDonnee,lValeur);const lSurEdition_after=(aParams,aArticle,aError) =>{if(aError===null||aError===undefined){if(!this.EstunDoublon(aArticle)){if(this.EnModification(aParams.colonne)){aArticle.SetEtat(this.GetEtatSurEdition(aParams,aArticle));}
this.trier();aParams.ligne=this.GetIndice(aArticle);} else{this.Message=this.GetMessage_Doublon(aArticle);aParams.valeur=lValeurPrecedente;aArticle=this.SurEdition(aParams,aParams.colonne,aArticle,lValeurPrecedente);}} else{this.Message=this.GetMessage_Edition_Impossible(aParams.colonne,aArticle,aError);aParams.valeur=lValeurPrecedente;this.SurEdition(aParams,aParams.colonne,aArticle,lValeurPrecedente);}};if(lErreur&&lErreur.then){return lErreur.then((aError) =>{if(aError&&aError.annulerEdition){aParams.valeur=lValeurPrecedente;return aError;}
lSurEdition_after(aParams,lDonnee,aError);});} else{lSurEdition_after(aParams,lDonnee,lErreur);}} else{this.Message=this.GetMessage_Format(aParams);}}
_Edition_Confirmation(aParams){this.Message=null;if(this.Edition_Confirmation(aParams)){this.Message=this.GetMessage_Edition_Confirmation(aParams.article,aParams);return true;}}
_SurSuppression(aLigne,aListeSuppressions){if(aListeSuppressions&&aListeSuppressions.parcourir){aListeSuppressions.parcourir(function(aElement){this.SurSuppression(aElement);}.bind(this));} else{const lDonnee=this.Donnees.GetElement(aLigne);this.SurSuppression(lDonnee);}
this.trier();return-1;}
_Suppression_Impossible(aLigne,aListeSelections){this.Message=null;const lDonnee=this.Donnees.GetElement(aLigne);if(this.Suppression_Impossible(lDonnee,aListeSelections)){this.Message=this.GetMessage_Suppression_Impossible(lDonnee,aListeSelections);return true;}}
_Suppression_Confirmation(aLigne,aListeSelections){this.Message=null;const lDonnee=this.Donnees.GetElement(aLigne);if(this.Suppression_Confirmation(lDonnee,aListeSelections)){this.Message=this.GetMessage_Suppression_Confirmation(lDonnee,aListeSelections);return!!this.Message;}}
estVisible(aLigne){return _estDonneesVisible.call(this,this.Donnees.GetElement(aLigne));}
trier(){if(this.AvecTri()&&this.Donnees){const lColonne=this.triCourant?this.triCourant.colonne.length===1?this.triCourant.colonne[0]:this.triCourant.colonne:null;const lGenre=this.triCourant?this.triCourant.genre.length===1?this.triCourant.genre[0]:this.triCourant.genre:null;const lTri=this.getTri(lColonne,lGenre);if(lTri){this.Donnees.setTri(lTri);}
this.Donnees.trier();}}
GetNbrLignes(){return this.Donnees?this.Donnees.GetNbrElements():0;}
creerIndexUnique(aChamps){if(!this._indexsUnique){this._indexsUnique=new ObjetIndexsUnique();}
this._indexsUnique.ajouterIndex(aChamps);}
getArrayFilsVisiblesDePere(aArticlePere){const lResult=[];this.Donnees.parcourir(function(aArticle,aIndex){if(((!aArticlePere&&!aArticle.pere)||aArticle.pere===aArticlePere)&&this.GetVisible(aArticle)){lResult.push({article:aArticle,ligne:aIndex});}}.bind(this));return lResult;}
_getEtatCocheSimple(aParams){return this._GetValeur(aParams);}
getEtatCocheSelonFils(aElementPere,aParams,aMethodeAvecEdition){if(aElementPere&&(!aElementPere.estUnDeploiement||!this.estCocheSelonFilsSurLigneDeploiement(aElementPere))){return this._getEtatCocheSimple(aParams);}
let lEtat=ObjetDonneesListe.EGenreCoche.Aucune,lInit=false;this.getArrayFilsVisiblesDePere(aElementPere).every(function(aElementParcours){const lParams=Object.assign({},aParams,aElementParcours);if((aMethodeAvecEdition&&MethodesObjet.isFunction(aMethodeAvecEdition)&&aMethodeAvecEdition(lParams))||this.AvecEdition(lParams.colonne,lParams.article,lParams)){if(this.estCocheSelonFilsSurLigneDeploiement(lParams.article)){const lEtatFils=this.getEtatCocheSelonFils(lParams.article,lParams,aMethodeAvecEdition);if(lEtatFils===ObjetDonneesListe.EGenreCoche.Verte&&lEtat===ObjetDonneesListe.EGenreCoche.Aucune){lEtat=lInit?ObjetDonneesListe.EGenreCoche.Grise:ObjetDonneesListe.EGenreCoche.Verte;} else if(lEtatFils===ObjetDonneesListe.EGenreCoche.Grise){lEtat=ObjetDonneesListe.EGenreCoche.Grise;} else if(lEtatFils===ObjetDonneesListe.EGenreCoche.Aucune&&lEtat===ObjetDonneesListe.EGenreCoche.Verte){lEtat=ObjetDonneesListe.EGenreCoche.Grise;}} else{const lValeur=this._getEtatCocheSimple(lParams);if((!lValeur||lValeur===ObjetDonneesListe.EGenreCoche.Aucune)&&lEtat===ObjetDonneesListe.EGenreCoche.Verte){lEtat=ObjetDonneesListe.EGenreCoche.Grise;}
if((lValeur===true||lValeur===ObjetDonneesListe.EGenreCoche.Verte)&&lEtat===ObjetDonneesListe.EGenreCoche.Aucune){lEtat=lInit?ObjetDonneesListe.EGenreCoche.Grise:ObjetDonneesListe.EGenreCoche.Verte;}}
if(lEtat===ObjetDonneesListe.EGenreCoche.Grise){return false;}
lInit=true;}
return true;}.bind(this));return lEtat;}
estCocheSelonFilsSurLigneDeploiement(aArticle){return true;}
getTableauLignesModifieesCocheTitre(aColonne,aValeur){const T=[];const lNb=this.Donnees.GetNbrElements();for(let i=0;i<lNb;i++){if(this.GetVisible(this.Donnees.GetElement(i))){T.push(i);}}
return T;}
surEditionCocheTitre(aListeParamsCellule,aValeur){if(!!aListeParamsCellule){for(let i=0;i<aListeParamsCellule.length;i++){const lErreur=this.SurEdition(aListeParamsCellule[i],aListeParamsCellule[i].colonne,aListeParamsCellule[i].article,aValeur);if(lErreur===null||lErreur===undefined){if(this.EnModification(aListeParamsCellule[i].colonne)){aListeParamsCellule[i].article.SetEtat(this.GetEtatSurEdition(aListeParamsCellule[i]));}}}}
return null;}
rechercheTexte_forcerLignePrecSuivVisible(aParamsLigneVisible,aParamsLignePrecSuivCachee){return false;}
getId(aNumeroColonne){return this.__getIdsColonnes()[aNumeroColonne];}
getNumeroColonneDId(aId){return this.__getIdsColonnes().indexOf(aId);}
avecVoileBleuHover(aParams){return this.options.avecVoileBleuHover;}
estConcerneParVoileBleuHover(aParams,aParamsCelluleHover){if(aParams.ligne<0){return false;}
if(this.selectionParCellule(aParamsCelluleHover.colonne,aParamsCelluleHover.article)){return aParamsCelluleHover.ligne===aParams.ligne&&aParamsCelluleHover.colonne===aParams.colonne;}
if(aParams.ligne>=0&&aParams.ligne===aParamsCelluleHover.ligne){return true;}
if(this.options.avecMultiSelectionSurLigneFusion&&aParams.ligne>=0&&aParamsCelluleHover.ligne>=0&&aParams.ligne!==aParamsCelluleHover.ligne){const lFusionHover=this.lignesFusionParColonne[aParamsCelluleHover.colonne+'_'+aParamsCelluleHover.ligne];if(lFusionHover&&lFusionHover.lignesCumuls&&lFusionHover.lignesCumuls[aParams.ligne]){return true;}
const lFusionCourant=this.lignesFusionParColonne[aParams.colonne+'_'+aParams.ligne];if(lFusionCourant&&lFusionCourant.lignesCumuls&&lFusionCourant.lignesCumuls[aParamsCelluleHover.ligne]){return true;}}
return false;}
avecDessinHover(aParams){return false;}
estConcerneParDessinHover(aParams,aParamsCelluleHover){return false;}
construireHtmlHover(aParams){if(!aParams.node){return'';}
const H=[];const lHeight=22;const lWidthCorpsFleche=10;const lWidthPointeFleche=11;const lHeightCorpsFleche=10;const lWidth=lWidthCorpsFleche+lWidthPointeFleche;const lCouleurBord='white';const lCouleur=GCouleur.selection.fond;let lStyle='';switch(aParams.direction){case ObjetDonneesListe.TypeDirectionElementSurvolCellule.droite:case ObjetDonneesListe.TypeDirectionElementSurvolCellule.gauche:lStyle+='top:'+Math.round(($(aParams.node).height()/2-lHeight/2))+'px;';break;case ObjetDonneesListe.TypeDirectionElementSurvolCellule.haut:lStyle+='top:0px;';break;case ObjetDonneesListe.TypeDirectionElementSurvolCellule.bas:lStyle+='bottom:0px;';break;}
switch(aParams.direction){case ObjetDonneesListe.TypeDirectionElementSurvolCellule.droite:lStyle+='left: -'+(lWidth+1)+'px;';break;case ObjetDonneesListe.TypeDirectionElementSurvolCellule.gauche:lStyle+='right: -'+(lWidth+1)+'px;';break;case ObjetDonneesListe.TypeDirectionElementSurvolCellule.haut:case ObjetDonneesListe.TypeDirectionElementSurvolCellule.bas:lStyle+='left:'+Math.round(($(aParams.node).width()/2-lWidth/2))+'px;';break;}
H.push('<div class="',aParams.classHover,' dessinHoverListe_',aParams.direction,'" style="',lStyle,'">');H.push('<svg xmlns="http://www.w3.org/2000/svg" width="',lWidth+1,'" height="',lHeight+1,'">',GChaine.Format('<line x1="0" y1="%0:s" x2="%1:s" y2="%0:s" stroke="%3:s" stroke-width="%2:s" />',[lHeight/2,lWidthCorpsFleche,lHeightCorpsFleche,lCouleurBord]),GChaine.Format('<polygon points="%2:s 0, %3:s %1:s, %2:s %0:s" fill="%4:s" stroke-width="1" stroke="%5:s"/>',[lHeight,lHeight/2,lWidthCorpsFleche,lWidth,lCouleur,lCouleurBord]),GChaine.Format('<line x1="1" y1="%0:s" x2="%1:s" y2="%0:s" stroke="%3:s" stroke-width="%2:s" />',[lHeight/2,lWidthCorpsFleche+1,lHeightCorpsFleche-2,lCouleur]),'</svg>');H.push('</div>');if(aParams.direction===ObjetDonneesListe.TypeDirectionElementSurvolCellule.droite||aParams.direction===ObjetDonneesListe.TypeDirectionElementSurvolCellule.gauche){H.push('<div class="'+aParams.classHover+' dessinHoverListe_cadre"></div>');}
return H.join('');}
estCelluleCopie(aParams){return false;}
surCopier(aParams){return false;}
surColler(aParams){return false;}
getHauteurMinCellule(aParams){return this.options.hauteurMinCellule;}
getHauteurMinContenuCellule(aParams){return this.options.hauteurMinContenuCellule;}
getParametresSelectionnerCelluleSuivanteFinEdition(aParams){return{orientationVerticale:true,avecCelluleEditable:true,entrerEdition:true,avecSelection:true};}
_getClassCelluleConteneur(aParams){return this.getClassCelluleConteneur(aParams);}}
ObjetDonneesListe.hauteurMinCellule=21;ObjetDonneesListe.ECouleurCellule={Blanc:0,Gris:1,Deploiement:2,Fixe:3,Total:4};ObjetDonneesListe.ETypeCellule={Texte:0,ZoneTexte:1,Html:2,Date:3,Note:4,Coche:5,CocheDeploiement:6,Image:7,DateCalendrier:8,HeureMinute:9};ObjetDonneesListe.EGenreCoche={Verte:true,Grise:null,Aucune:false};ObjetDonneesListe.typeCelluleTotal={defaut:'defaut',fond:'fond',editable:'editable'};ObjetDonneesListe.TypeDirectionElementSurvolCellule={haut:'haut',bas:'bas',gauche:'gauche',droite:'droite'};ObjetDonneesListe.typeInterTitre={h3:'h3',h4:'h4',h5:'h5',true:true};function _estDonneesVisible(aDonnees){if(!aDonnees){return false;}
if(aDonnees.pere&&this.AvecDeploiement()&&(aDonnees.pere.estDeploye===false||!_estDonneesVisible.call(this,aDonnees.pere))){return false;}
if(aDonnees.Etat===EGenreEtat.Suppression||!this.GetVisible(aDonnees)){return false;}
return true;}
module.exports=ObjetDonneesListe;},fn:"objetdonneesliste.js"});;
IE.fModule({f:function(exports,require,module,global){require('Produit/Css/ObjetListeEspaceMobile.css');require('DeclarationJQuery.js')
;const TypeFusionTitreListe=require('TypeFusionTitreListe.js');const IEHtml=require('IEHtml.js');const GPosition=require('GPosition.js');const GLog=require('IELog.js');const MethodesObjet=require('MethodesObjet.js');const MethodesTableau=require('MethodesTableau.js');const ObjectCouleurCellule=require('_ObjetCouleur.js').ObjectCouleurCellule;const GChaine=require('GChaine.js');const GHtml=require('GHtml.js');const GStyle=require('GStyle.js');const EGenreAction=require('Enumere_Action.js');const EGenreBoiteMessage=require('Enumere_BoiteMessage.js');const EGenreEvenementListe=require('Enumere_EvenementListe.js');const EGenreTriElement=require('Enumere_TriElement.js');require('IEHtml.DraggableDroppable.js');require('IEHtml.InputNote.js');require('IEHtml.SelecFile.js');require('IEHtml.TextareaMax.js');const ZoneFenetre=require('IEZoneFenetre.js');const ObjetDonneesListe=require('ObjetDonneesListe.js');const Identite=require('ObjetIdentite.js');const ObjetListeElements=require('ObjetListeElements.js');const Support=require('ObjetSupport.js');const GTraductions=require('ObjetTraduction.js');const ToucheClavier=require('ToucheClavier.js');const{ObjetInvocateur,Invocateur}=require('Invocateur.js');const ComparateurChaines=require('ComparateurChaines.js');const tag=require('tag.js');const EGenreCommandeMenu=require('Enumere_CommandeMenu.js');const ObjetMenuContextuel=require('ObjetMenuContextuel.js');class _ObjetListe extends Identite{constructor(...aParams){super(...aParams);this._init();}
resetOptions(){this._options={colonnes:null,gestionModificationColonnes:null,messageContenuVide:'',listeTailles:[],listeTitres:null,hintTitres:null,colonnesCachees:null,colonnesCacheesImpression:null,zoneScrollH:null,avecLigneCreation:false,listeCreations:[],titreCreation:GTraductions.getValeur('liste.nouveau'),iconeTitreCreation:false,avecCBToutCocher:false,avecToutSelectionner:true,nonEditable:false,nonEditableSurModeExclusif:false,AvecSuppression:true,parsingSurColonne:-1,scrollHorizontal:false,scrollHorizontalSurLargeurComplete:true,avecScrollEnTactileV:!GNavigateur.isLayoutTactile,avecScrollEnTactileH:!GNavigateur.isLayoutTactile,colonnesTriables:false,numeroColonneTriDefaut:undefined,evenementSurTri:null,avecModeAccessible:false,boutons:[],tailleBoutons:17,listeChipsFiltres:null,skin:_ObjetListe.skin.classique,avecListeNeutre:undefined,couleursListe:GCouleur.liste,avecReservationPlaceScrollHorizontal:false,hauteurAdapteContenu:false,getHauteurMaxAdapteListe:null,hauteurMaxAdapteContenu:null,avecLigneTotal:false,avecConstructionDynamiqueContenu:true,colonnesSansBordureDroit:[],avecCadreSelection:true,paddingCelluleLR:2,paddingCelluleTB:1,hauteurCelluleTitreStandard:20,widthTri:14,heightTri:8,avecRollover:true,hauteurZoneContenuListeMin:20,largeurZoneContenuListeMin:20,largeurImage:18,borduresTitre_couleur:null,borduresTitre_top:1,borduresTitre_bottom:0,borduresTitre_left:1,borduresTitre_right:1,borduresContenu_couleur:null,borduresContenu_top:1,borduresContenu_bottom:1,borduresContenu_left:1,borduresContenu_right:1,paddingContenu_LR:0,borduresCellule_couleur:null,borduresCellule_horizontal:1,borduresCellule_vertical:1,alternanceCouleurLigneContenu:false,avecCouleurAlternanceParDefaut:false,couleurAlternance0:new ObjectCouleurCellule(GCouleur.blanc,GCouleur.noir,null),couleurAlternance1:new ObjectCouleurCellule(GCouleur.fond,GCouleur.noir,null),avecTraitSeparationDeploiementAlternance:false,avecOmbreDroite:false,forcerOmbreScrollTop:false,forcerOmbreScrollBottom:false,avecSelectionLigneSurImpression:true,piedDeListe:null,maxLengthTextareaIgnore:1000000,delaiSurEditionRecherche:500,callbackResizeObserverContenu:null};return this;}
setOptionsListe(aOptions,aAvecActualisation){return _setOptionsListe.call(this,aOptions,aAvecActualisation);}
getDonneesListe(){return this.Donnees;}
SetDonnees(ADonnees,aLigneSelectionne,aParams){return _setDonnees.call(this,ADonnees,aLigneSelectionne,aParams);}
Actualiser(aObjetOuConserverSelection,aSansTriDonnees){const lParametres={ignorerFocusListe:false,ignorerCalculTri:true};if(MethodesObjet.isObject(aObjetOuConserverSelection)){Object.assign(lParametres,aObjetOuConserverSelection);} else{Object.assign(lParametres,{conserverSelection:!!aObjetOuConserverSelection,conserverFocusSelection:!!aObjetOuConserverSelection,sansTriDonnees:aSansTriDonnees});}
this._cache.calculsPreRenduAFaire=true;_actualiser.call(this,lParametres);}
effacer(aMessage){this._donneesRecus=false;GHtml.setHtml(this.Nom,aMessage||'&nbsp;',{ignorerScroll:true});return this;}
SurSelection(aNumeroColonne,aNumeroLigne,aParams){return _surSelection.call(this,aNumeroColonne,aNumeroLigne,aParams);}
SelectionnerLigne(aParametres){this._cache.lignesSelectionnees_prec=[...this._cache.lignesSelectionnees];_selectionner.call(this,Object.assign({colonne:-1,avecEvenementModificationSelection:true},aParametres));}
selectionnerCellule(aParametres){this._cache.lignesSelectionnees_prec=[...this._cache.lignesSelectionnees];_selectionner.call(this,Object.assign({avecEvenementModificationSelection:true},aParametres));}
GetSelection(){if(_getListeElementsSelection.call(this).GetNbrElements()===0){return-1;}
return this._cache.selectionCellule.ligne;}
getSelectionCellule(){return Object.assign({},this._cache.selectionCellule);}
getElementSelection(){const lListe=_getListeElementsSelection.call(this);return lListe.GetNbrElements()>0?lListe.GetElement(0):null;}
getListeElementsSelection(){return _getListeElementsSelection.call(this);}
setListeElementsSelection(aListeElements,aParams){return _setListeElementsSelection.call(this,aListeElements,aParams);}
getTableauCellulesSelection(){const lSelections=[];_getCellulesSelection.call(this).forEach((aElement) =>{aElement.colonnes.forEach((aNumeroColonne,aIndex) =>{lSelections.push({article:aElement.article,ligne:aElement.ligne,colonne:aNumeroColonne,idColonne:aElement.idsColonnes[aIndex],declarationColonne:this._cache.declColonnesByIds[aElement.idsColonnes[aIndex]]});});});return lSelections;}
setTableauCellulesSelection(aListe,aParams){return _setTableauCellulesSelection.call(this,aListe,aParams);}
selectionnerCelluleSuivante(aParametres){return _selectionnerCelluleSuivante.call(this,aParametres);}
getArticleDeLigne(aLigne){if(this.Donnees&&this.Donnees.Donnees){return this.Donnees.Donnees.GetElement(aLigne);}
return null;}
getListeArticles(){if(this.Donnees&&this.Donnees.Donnees){return this.Donnees.Donnees;}
return new ObjetListeElements();}
getListeArticlesCochees(){const lListe=new ObjetListeElements();if(this.Donnees&&this.Donnees.getValueCB){this.getListeArticles().parcourir((aArticle,aIndex) =>{const lParams=_getParamsCellule.call(this,-1,aIndex);if(this.Donnees.GetVisible(aArticle)&&this.Donnees.getValueCB(lParams)){lListe.add(aArticle);}});}
return lListe;}
demarrerEditionSurCellule(aLigne,aColonne){const lElement=GHtml.getElement(this.getIdCellule(aColonne,aLigne)+'_div');if(GHtml.elementExiste(lElement)){GHtml.setFocus(lElement);} else if(_estLigneDansRangeNonConstruitDyn.call(this,aLigne)){_scrollSurSelection.call(this,aColonne,aLigne);}
_SurEditionDeb.call(this,aColonne,aLigne);if(this._cache.timeout_ignorerScrollSortieEdition){clearTimeout(this._cache.timeout_ignorerScrollSortieEdition);delete this._cache.timeout_ignorerScrollSortieEdition;}
this._cache.timeout_ignorerScrollSortieEdition=setTimeout(() =>{delete this._cache.timeout_ignorerScrollSortieEdition;},100);return this;}
ajouterElementCreation(aLibelle,aValeurCreation){return _ajouterElementCreation.call(this,aLibelle,aValeurCreation);}
annulerCreation(){_annulerCreation.call(this);}
setCreationLigne(aCreationLigneBis){return _setCreationLigne.call(this,aCreationLigneBis);}
SurSuppression(){return _surSuppression.call(this);}
getIdCellule(aColonne,aLigne){return this.Nom+'_'+aColonne+(aLigne===null||aLigne===undefined?'':'_'+aLigne);}
getIdColonneDeNumeroColonne(aNumeroColonne){return this._cache.colonnes.listeIds[aNumeroColonne]||'';}
getNumeroColonneDIdColonne(aIdColonne){const lNumero=this._cache.colonnes.listeIds.indexOf(aIdColonne);return lNumero>=0?lNumero:-1;}
getRechercheTexte(){return this._cache.rechercheTexte.saisie;}
setRechercheTexte(aTexte,aSansTriDonnees){_setRechercheSaisie.call(this,aTexte);clearTimeout(this._cache.rechercheTexte.timerSaisie);let lParams;if(aSansTriDonnees){lParams={sansTriDonnees:true};}
if(this._options.delaiSurEditionRecherche>=0){this._cache.rechercheTexte.timerSaisie=setTimeout(() =>{_filtreRechercheTexte.call(this,lParams);},this._options.delaiSurEditionRecherche);} else{_filtreRechercheTexte.call(this,lParams);}
return this;}
composeImpression(){return'';}
construireCopieCSV(){}
Reset(){return _setDonnees.call(this,new ObjetDonneesListe(new ObjetListeElements()));}
resize(){}
SurPreResize(){}
SurPostResize(){}
setColonneTri(aColonne,aGenre,aNumeroTri){return _setColonneTri.call(this,aColonne,aGenre,aNumeroTri);}
FocusSuivant(AId,AOrientation,ADirection){return _focusSuivant.call(this,AId,AOrientation,ADirection);}
free(...aParams){super.free(...aParams);clearTimeout(this._cache.rechercheTexte.timerSaisie);clearTimeout(this._cache.timerKeyPress);clearTimeout(this._cache.timeoutResizeScroll);_desabonnementResizeObserver.call(this);}
_init(){this.IdEdition=this.Nom+'_Edition';this.idZone=this.Nom+'_Zone';this.IdZoneTexte=this.Nom+'_ZoneTexte';this.IdPremierElement=this.Nom+'_ObjetListe';this.idTotaux=this.Nom+'_totaux';this.idPiedDeListe=this.Nom+'_piedDeListe';this.ids={zoneFils:this.Nom+'_zone_fils',titre:this.Nom+'_titreTout',contenu:this.Nom+'_contenuListe_',colonneDeTri:this.Nom+'_triCol_',curseurTri:this.Nom+'_curseurTri_',curseurTriSurvol:this.Nom+'_curseurTriSurvol_',survolTitre:this.Nom+'_survolTitre_',cocheTitre:this.Nom+'_cocheT_',cadreSelection:this.Nom+'_cadreSel_',rolloverTitre:this.Nom+'_rolloverTitre_',rolloverContenuLigne:this.Nom+'_rolloverContenuLigne_',rolloverContenuColonne:this.Nom+'_rolloverContenuColonne_',rolloverContenuCellule:this.Nom+'_rolloverContenuCellule_',dragInsertion:this.Nom+'_dragInsertion',surligneur_edition:this.Nom+'_surligneuredition'};this.resetOptions();this._cache={taillesColonne:[],heightConteneur:0,largeurPage:null,avecPourcentage:false,largeurTotalFixe:0,largeurBlocFixe:0,infosZonesColonnes:[],listeCorrespondancesColonnes:[],declColonnesByIds:{},colonnes:{listeIds:[],listeTailles:[]},tableauColonnesCachees:[],nbColonnesCachees:0,reserverPlaceScrollHorizontal:false,calculsPreRenduAFaire:true,calculsTailleColonnesAFaire:true,calculTriAFaire:true,listeNonInitialisee:true,lignesFusionParColonne:{},declarationsColonnes:[],colonnesTri:null,colonnesSansBordureDroit:[],boutons:null,rolloverVisible:false,survoleTitreTriVisible:false,lignesVisibles:[],lignesVisiblesSansRechercheTexte:[],couleursAlternanceParLigne:[],selectionCellule:{ligne:-1,colonne:-1},celluleClicNonShift:{ligne:-1,colonne:-1},lignesSelectionnees:[],lignesSelectionnees_prec:[],editionEnCours:false,editionEnCoursEvenement:false,creationEnCours:false,creationEnCoursEvenement:false,positionCreation:0,listeValeursCreation:[],numeroColonneCreationEnCours:null,numeroLigneCreationDynamique:null,ouvrirSelecteurFileParLigne:{},positionsCelluleCadreSelection:{},keysControleurTitre:{},keysControleurDonneesListe:{},rechercheTexte:{saisie:'',textesParLigne:null,lignesCachees:[],timerSaisie:null},timerKeyPress:null,collectionFuncConstructCellule:{},refresh:{nbLignes:10,observer:new IntersectionObserver(_callbackObserverRefreshContenu.bind(this)),init:() =>{const lCacheRef=this._cache.refresh;lCacheRef.structure=[];lCacheRef.mapNodesObs=new WeakMap();lCacheRef.mapRangesExist=new Map();lCacheRef.mapRangesExist.min=Number.MAX_VALUE;lCacheRef.mapRangesExist.max= -1;lCacheRef.node_gab_start=null,lCacheRef.node_gab_end=null,lCacheRef.hauteurMoyenneLigne=20;lCacheRef.getHeightStructure=(aStructure) =>{return aStructure.height<0?lCacheRef.hauteurMoyenneLigne*aStructure.nbLignes:aStructure.height;};}}};this._cache.refresh.init();this.optionsInterne={avecActualisationParZone:true,versionMobile:false};Invocateur.abonner(ObjetInvocateur.events.modeExclusif,function(){if(this._options.nonEditableSurModeExclusif){_actualiser.call(this,{conserverSelection:true,sansTriDonnees:true});}},this);}
getControleur(aInstance){const lControleur={getClassListe:function(){const lClasses=['skin_'+aInstance._options.skin];if(!aInstance.Donnees||aInstance.Donnees.Donnees.GetNbrElements()===0){lClasses.push('vide');}
if(aInstance._options.avecOmbreDroite){lClasses.push('ombre-droite');}
if(aInstance.optionsInterne.getClassListe){lClasses.push(aInstance.optionsInterne.getClassListe(aInstance));}
if(aInstance.Donnees&&aInstance.Donnees.options.racineCss){lClasses.push(aInstance.Donnees.options.racineCss);}
if(!aInstance._options.avecCadreSelection){lClasses.push('background-selec');}
return lClasses.join(' ');},nodeBtnEnteteLibre:function(aIndex){const lElement=aInstance._cache.boutons[aIndex];if(lElement&&lElement.html){GHtml.setHtml(this.node,lElement.html,{controleur:lElement.controleur});}},boutonListe:{event:function(aIndex,aEvent){const lBouton=aInstance._cache.boutons[aIndex];const lParams={bouton:lBouton,event:aEvent,liste:aInstance,node:this.node,avecFocus:true};lBouton.event(lParams);if(lParams.avecFocus){GHtml.setFocus(this.node.id);}},getDisabled:function(aIndex){const lBouton=aInstance._cache.boutons[aIndex];return lBouton.getDisabled?lBouton.getDisabled({bouton:lBouton,node:this.node,liste:aInstance}):false;},getSelection:function(aIndex){const lBouton=aInstance._cache.boutons[aIndex];return lBouton.getSelection?lBouton.getSelection({bouton:lBouton,node:this.node,liste:aInstance}):false;}},chipsFiltre:{event(aIndex){const lChips=aInstance._cache.listeChipsFiltres[aIndex];if(lChips&&lChips.event){lChips.event({chips:lChips,liste:aInstance});}},eventBtn(aIndex){const lChips=aInstance._cache.listeChipsFiltres[aIndex];if(lChips&&lChips.eventBtn){lChips.eventBtn({chips:lChips,liste:aInstance});}},getLibelle(aIndex){const lChips=aInstance._cache.listeChipsFiltres[aIndex];if(lChips&&lChips.getLibelle){return lChips.getLibelle({chips:lChips,liste:aInstance});}
return GTraductions.getValeur('liste.ListeFiltree');}},rechercheTexte:{getValue:function(){return aInstance.getRechercheTexte();},setValue:function(aValue){aInstance.setRechercheTexte(aValue);},node:function(){$(this.node).on({'focusout':function(){if(aInstance._cache.rechercheTexte.saisie===''){_supprimerZoneRechercheTexte.call(aInstance);}},'keyup':function(aEvent){if(aEvent.which===ToucheClavier.Echap){_annulerRechercheTexte.call(aInstance);aEvent.stopPropagation();return;}}});}},btnRechercheTexte:{event:function(){_annulerRechercheTexte.call(aInstance);}},saisieTexte:{getValue:function(){return aInstance._valeurEnEdition;},setValue:function(aLigne,aColonne,aEnCreation,aEstNote,aEstTextareaMax,aIgnorerEventsNode,aValue){_setValueModel.call(aInstance,{ligne:aLigne,colonne:aColonne,surCreation:aEnCreation,node:this.node,value:aValue});},getNote:function(){return aInstance._valeurEnEdition;},setNote:function(aLigne,aColonne,aEnCreation,aEstNote,aEstTextareaMax,aIgnorerEventsNode,aNote){if(aInstance.optionsInterne.versionMobile&&aEstNote&&aNote===null&&aInstance._cache.finEditionCreation){aInstance._cache.finEditionCreation();return;}
_setValueModel.call(aInstance,{ligne:aLigne,colonne:aColonne,surCreation:aEnCreation,node:this.node,value:aNote,estNote:aEstNote});if(aInstance.optionsInterne.versionMobile&&aEstNote&&aInstance._cache.finEditionCreation){aInstance._cache.finEditionCreation();}},getOptionsNote:function(aLigne,aColonne,aEnCreation){if(aInstance.Donnees){return aInstance.Donnees.getOptionsNote(_getParamsCellule.call(aInstance,aColonne,aLigne,{surLigneCreation:aEnCreation}))||null;}},fromDisplay:function(aLigne,aColonne,aEnCreation,aEstNote,aEstTextareaMax,aIgnorerEventsNode,aValue){if(aEstNote){return aValue;}
const lControle=aInstance.Donnees?aInstance.Donnees.getControleCaracteresInput(_getParamsCellule.call(aInstance,aColonne,aLigne,{surLigneCreation:aEnCreation})):null;if(lControle&&lControle.fromDisplay){aValue=lControle.fromDisplay(aColonne,aLigne,aValue);}
return aValue;},toDisplay:function(aLigne,aColonne,aEnCreation,aEstNote,aEstTextareaMax,aIgnorerEventsNode,aValue){if(aEstNote){return aValue;}
const lControle=aInstance.Donnees?aInstance.Donnees.getControleCaracteresInput(_getParamsCellule.call(aInstance,aColonne,aLigne,{surLigneCreation:aEnCreation})):null;if(lControle&&lControle.toDisplay){aValue=lControle.toDisplay(aColonne,aLigne,aValue);}
return aValue;},node:function(aLigne,aColonne,aEnCreation,aEstNote,aEstTextareaMax,aIgnorerEventsNode){aInstance._cache.avecModificationSaisie=false;const lForceSetNote=aEstNote&&this.data.forceExitChange?function(){const lParamsExit={};this.data.forceExitChange(lParamsExit);if(lParamsExit.resultValidation&&!lParamsExit.resultValidation.estValide){if(aEnCreation){_annulerCreation.call(aInstance);} else{_surEditionFin.call(aInstance,aInstance._cache.selectionCellule.colonne,aInstance._cache.selectionCellule.ligne);if(lParamsExit.resultValidation.promiseMessageErreur){const lPromise=lParamsExit.resultValidation.promiseMessageErreur.then(() =>{aInstance.demarrerEditionSurCellule(aInstance._cache.selectionCellule.ligne,aInstance._cache.selectionCellule.colonne);});return{promiseMessageErreur:lPromise};}}
return true;}}.bind(this):null;aInstance._cache.finEditionCreation=function(){aInstance._cache.finEditionCreation=null;if(aEstNote&&lForceSetNote){const lResultSetNote=lForceSetNote();if(lResultSetNote){return lResultSetNote;}}
const lParams=_getParamsCellule.call(aInstance,aColonne,aLigne,{surEdition:true});if(aEnCreation){_SurCreation.call(aInstance,aInstance._valeurEnEdition);} else{return _SurEdition.call(aInstance,lParams,aInstance._valeurEnEdition,aInstance._cache.avecModificationSaisie);}};aInstance._cache.finEditionCreation.estCreation=aEnCreation;if(aIgnorerEventsNode){return;}
$(this.node).on({'keydown':function(aEvent){delete aInstance._cache._keyDownSansNavigationFleche;if(_isToucheRetourChariot(aEvent)||aEvent.which===ToucheClavier.Echap||aEvent.which===ToucheClavier.Tab){if(aEstNote&&lForceSetNote&&aEvent.which!==ToucheClavier.Echap){lForceSetNote();}
aEvent.stopPropagation();aEvent.preventDefault();return false;}
if(aInstance.Donnees.options.avecNavigationClavierFlechesEnEdition){const lNodeName=this.nodeName.toLowerCase();if((lNodeName==='input'||lNodeName==='textarea')&&((aEvent.which===ToucheClavier.FlecheGauche&&!_estCurseurEnBorneDeSelection(this,true))||(aEvent.which===ToucheClavier.FlecheDroite&&!_estCurseurEnBorneDeSelection(this,false)))){aInstance._cache._keyDownSansNavigationFleche=true;}}},'keyup':function(aEvent){if(_isToucheRetourChariot(aEvent)||aEvent.which===ToucheClavier.Echap||aEvent.which===ToucheClavier.Tab){if(aEvent.which===ToucheClavier.Echap){if(aEnCreation){_annulerCreation.call(aInstance);} else{_surEditionFin.call(aInstance,aInstance._cache.selectionCellule.colonne,aInstance._cache.selectionCellule.ligne);}} else{if(aEstNote&&lForceSetNote){if(lForceSetNote()){return;}}
const lParams=_getParamsCellule.call(aInstance,aColonne,aLigne,{surEdition:true});const lFuncSuite=() =>{if(aInstance.Donnees.options.avecCelluleSuivanteSurFinEdition){_selectionnerCelluleSuivante.call(aInstance,Object.assign(lParams,aInstance.Donnees.getParametresSelectionnerCelluleSuivanteFinEdition(lParams)));}};if(aEnCreation){_SurCreation.call(aInstance,aInstance._valeurEnEdition);lFuncSuite();} else{const lResult=_SurEdition.call(aInstance,lParams,aInstance._valeurEnEdition,aInstance._cache.avecModificationSaisie,aInstance.Donnees.options.avecEvnt_ApresEditionValidationSansModification);if(lResult&&lResult.then){lResult.then((aError) =>{if(aError&&aError.annulerEdition){} else{lFuncSuite();}});} else{lFuncSuite();}}}
aEvent.stopPropagation();return false;}
if(_estToucheNavigationFlechesClavier(aEvent)){if(aInstance.Donnees.options.avecNavigationClavierFlechesEnEdition&&!aInstance._cache._keyDownSansNavigationFleche){_navigationFlechesClavier.call(aInstance,aEvent,_getParamsCellule.call(aInstance,aColonne,aLigne,{surEdition:true,node:this,event:aEvent,avecCelluleEditable:true,avecSelection:true,entrerEdition:true}));}
aEvent.stopPropagation();}},'blur focusout':function(){if(!aEstTextareaMax&&aInstance._cache.finEditionCreation){aInstance._cache.finEditionCreation();}},'focusout_TextareaMax':function(){if(aEstTextareaMax&&aInstance._cache.finEditionCreation){aInstance._cache.finEditionCreation();}}});}},modeleSelecFileCellule:{getOptionsSelecFile:function(aLigne,aColonne,aSurCreation){const lParams=_getParamsCellule.call(aInstance,aColonne,aLigne,{surCreation:aSurCreation});const lOptions=Object.assign({classDrag:'selecfile_classDrag',classDragHoverSelec:'selecfile_classDrag_survol'},aInstance.Donnees.getOptionsSelecFile(lParams));if(lOptions.eventClick!==false&&!aInstance.optionsInterne.versionMobile){aInstance._cache.ouvrirSelecteurFileParLigne[aLigne+'_'+aColonne]=this.getOpenSelecFile();}
return lOptions;},addFiles:function(aLigne,aColonne,aSurCreation ,aParamsFiles){const lParamsCellule=_getParamsCellule.call(aInstance,aColonne,aLigne,{surCreation:aSurCreation});if(aSurCreation&&aInstance.ListeCreations.length===1){aParamsFiles.listeFichiers.parcourir((aFichier) =>{aInstance.ajouterElementCreation(aFichier.Libelle,aFichier);});return true;}
return aInstance.Donnees.evenementSurSelecFile(lParamsCellule,aParamsFiles);}},btnEllipsisLigne:{event:function(aNumeroLigne,aEvent){aEvent.stopPropagation();const lParams=_getParamsCellule.call(aInstance,-1,aNumeroLigne);if(aInstance.Donnees.AvecMenuContextuel(lParams)){lParams.node=this.node;aInstance._ouvrirMenuContextuel(lParams);}},node:function(){$(this.node).on('mousedown',(aEvent) =>{if(aEvent.originalEvent){aEvent.originalEvent.__cancelEventListe__=true;}});}},nodeDeploiementLigne:function(aLigne,aColonne){$(this.node).on('mousedown',(aEvent) =>{if(aEvent.originalEvent){aEvent.originalEvent.__cancelEventListe__=true;}}).eventValidation((aEvent) =>{_SurDeploiement.call(aInstance,aEvent,aColonne,aLigne,true);});},cb_ligne_flatDesign:{getValue:function(aLigne){const lResult=_getValueCB_flatDesign(aInstance,aLigne);return lResult===true;},getIndeterminate:function(aLigne){return _getValueCB_flatDesign(aInstance,aLigne)===ObjetDonneesListe.EGenreCoche.Grise;},setValue:function(aLigne,aValue){let lValue=aValue;if(_getValueCB_flatDesign(aInstance,aLigne)===ObjetDonneesListe.EGenreCoche.Grise){lValue=!_getValueCB_flatDesign(aInstance,aLigne,true);}
_setValueCB_flatDesign_event(aInstance,_getParamsCellule.call(aInstance,-1,aLigne),lValue);},getDisabled:function(aLigne){if(_getNonEditable.call(aInstance)){return true;}
if(aLigne<0&&(!aInstance._cache.lignesVisibles||aInstance._cache.lignesVisibles.length===0)){return true;}
if(aLigne>=0&&aInstance.Donnees.getDisabledCB(_getParamsCellule.call(aInstance,-1,aLigne))){return true;}
return false;},node:function(aLigne){if(aLigne>=0){$(this.node).closest('.iecb').on('mousedown mouseup click',(aEvent) =>{if(aEvent.originalEvent){aEvent.originalEvent.__cancelEventListe__=true;}});}}},surClickCocheTitre:function(aColonne){_clickSurCocheTitre.call(aInstance,aColonne);},getTitleCocheTitre:function(aColonne){if(aInstance.Donnees){const lEtatCoche=aInstance.Donnees.getEtatCocheSelonFils(null,_getParamsCellule.call(aInstance,aColonne));switch(lEtatCoche){case ObjetDonneesListe.EGenreCoche.Aucune:return GTraductions.getValeur('liste.toutCocher');case ObjetDonneesListe.EGenreCoche.Verte:return GTraductions.getValeur('liste.toutDecocher');}
return GTraductions.getValeur('liste.toutCocher');}
return'';},getStyleCocheTitre:function(aColonne){if(aInstance.Donnees){const lEtatCoche=aInstance.Donnees.getEtatCocheSelonFils(null,_getParamsCellule.call(aInstance,aColonne));return{'background-position':lEtatCoche===ObjetDonneesListe.EGenreCoche.Aucune?0:lEtatCoche===ObjetDonneesListe.EGenreCoche.Verte?-16:-32};}
return null;},getClassCocheTitre:function(aColonne){if(aInstance.Donnees){const lNode=$(this.node);const lEtatCoche=aInstance.Donnees.getEtatCocheSelonFils(null,_getParamsCellule.call(aInstance,aColonne));if(lEtatCoche===ObjetDonneesListe.EGenreCoche.Verte){return!lNode.hasClass('is-checked')?lNode.addClass('is-checked'):'';} else{return lNode.hasClass('is-checked')?lNode.removeClass('is-checked'):'';}}
return null;},nodeGabaritRefresh:function(aStart,aIndiceInfosColonne){const lCacheRef=aInstance._cache.refresh;const lNom=aStart?'node_gab_start':'node_gab_end';if(!lCacheRef[lNom]){lCacheRef[lNom]={};}
lCacheRef[lNom][aIndiceInfosColonne]=this.node;lCacheRef.observer.observe(this.node);lCacheRef.mapNodesObs.set(this.node,{gabarit:true});$(this.node).on('mousedown',() =>{_refreshContenuDynamique.call(aInstance);});},nodeObsRange:function(aStart,aIndiceRange,aIndiceInfosColonnees){const lCacheRef=aInstance._cache.refresh;lCacheRef.observer.observe(this.node);lCacheRef.mapNodesObs.set(this.node,{gabarit:false});let lRange=lCacheRef.mapRangesExist.get(aIndiceRange);if(!lRange){lRange={};lCacheRef.mapRangesExist.set(aIndiceRange,lRange);lCacheRef.mapRangesExist.min=Math.min(aIndiceRange,lCacheRef.mapRangesExist.min);lCacheRef.mapRangesExist.max=Math.max(aIndiceRange,lCacheRef.mapRangesExist.max);}
if(aIndiceInfosColonnees===0){lRange[aStart?'node_start':'node_end']=this.node;}
$(this.node).on('destroyed',function(){lCacheRef.mapNodesObs.delete(this);if(aIndiceInfosColonnees===0){lCacheRef.mapRangesExist.delete(aIndiceRange);let lMin=Number.MAX_VALUE;let lMax= -1;for(const lKey of lCacheRef.mapRangesExist.keys()){lMin=Math.min(lKey,lMin);lMax=Math.max(lKey,lMax);}
lCacheRef.mapRangesExist.min=lMin;lCacheRef.mapRangesExist.max=lMax;}});if(lCacheRef.structure[aIndiceRange].height<0){_actualiserHeightRanges.call(aInstance,aIndiceRange);}}};return $.extend(true,super.getControleur(this),{liste:lControleur});}
RecupererDonnees(){this._cache.listeNonInitialisee=true;}
_ouvrirFenetreParametrageColonnes(){}
_preparerBoutons(aParams){this._cache.boutons=[];if(this._options.boutons&&this._options.boutons.forEach){this._options.boutons.forEach((aBouton) =>{if(!aBouton){return;}
if(aBouton.html){this._cache.boutons.push(aBouton);return;}
const lBouton={event:null,getDisabled:null,getSelection:null,class:'',title:'',id:this.Nom+'_btnliste_'+this._cache.boutons.length};switch(aBouton.genre){case _ObjetListe.typeBouton.monter:lBouton.class='icon_chevron_up';lBouton.title=GTraductions.getValeur('liste.HintBoutonMonter');lBouton.getDisabled=function(){if(!this.Donnees||this.getListeElementsSelection().GetNbrElements()!==1||_getNonEditable.call(this)){return true;}
const lParamsCelluleSource=_getParamsCellule.call(this,-1,this.GetSelection());const lParamsCelluleDest=_rechercheDeplacementPrecedenteSuivant.call(this,lParamsCelluleSource,false);return!lParamsCelluleDest||!lParamsCelluleDest.article;}.bind(this);lBouton.event=function(){const lParamsCelluleSource=_getParamsCellule.call(this,-1,this.GetSelection());const lParamsCelluleDest=_rechercheDeplacementPrecedenteSuivant.call(this,lParamsCelluleSource,false);if(lParamsCelluleDest){_surDeplacementLigneSurAutreLigne.call(this,lParamsCelluleDest,lParamsCelluleSource);}}.bind(this);break;case _ObjetListe.typeBouton.descendre:lBouton.class='icon_chevron_down';lBouton.title=GTraductions.getValeur('liste.HintBoutonDescendre');lBouton.getDisabled=function(){if(!this.Donnees||this.getListeElementsSelection().GetNbrElements()!==1||_getNonEditable.call(this)){return true;}
const lParamsCelluleSource=_getParamsCellule.call(this,-1,this.GetSelection());const lParamsCelluleDest=_rechercheDeplacementPrecedenteSuivant.call(this,lParamsCelluleSource,true);return!lParamsCelluleDest||!lParamsCelluleDest.article;}.bind(this);lBouton.event=function(){const lParamsCelluleSource=_getParamsCellule.call(this,-1,this.GetSelection());const lParamsCelluleDest=_rechercheDeplacementPrecedenteSuivant.call(this,lParamsCelluleSource,true);if(lParamsCelluleDest){_surDeplacementLigneSurAutreLigne.call(this,lParamsCelluleDest,lParamsCelluleSource);}}.bind(this);break;case _ObjetListe.typeBouton.deployer:if(aBouton.cacherSansDeploiement===true&&!_existeDeploiementDansListe.call(this)){return false;}
lBouton.deploye=null;lBouton.class='btn_icone_deploiement';lBouton.title=GTraductions.getValeur('liste.HintBoutonDeploiement');lBouton.getDisabled=function(){return!_existeDeploiementDansListe.call(this);}.bind(this);lBouton.event=function(aParam){if(aParam.bouton.deploye===false||aParam.bouton.deploye===false){aParam.bouton.deploye=!aParam.bouton.deploye;} else{aParam.bouton.deploye=!_getBoutonDeploye.call(this);}
;if(this.Donnees&&this.Donnees.Donnees){let lAvecModif=false;this.Donnees.Donnees.parcourir((aElement,aLigne) =>{const lParams=_getParamsCellule.call(this,-1,aLigne);if(this.Donnees.estUnDeploiement(lParams)&&_estLigneVisible(this,aLigne)){if(this.Donnees._estDeploye(aLigne)===aParam.bouton.deploye){return;}
lAvecModif=true;this.Donnees.surDeploiement(-1,aLigne,aElement);if(this.Donnees.AvecEvenement_Deploiement(lParams.colonne,lParams.article,lParams)){this.Evenement.call(this.Pere,_getParamsCallback.call(this,EGenreEvenementListe.Deploiement,-1,aLigne),EGenreEvenementListe.Deploiement,-1,aLigne);_refreshSelf.call(this);}}});if(lAvecModif){_actualiser.call(this,{conserverSelection:true,sansTriDonnees:true});if(aParam.bouton.deploye===_getBoutonDeploye.call(this)){aParam.bouton.deploye=null;} else{}}}}.bind(this);lBouton.getSelection=function(aParam){if(aParam.bouton.deploye===false||aParam.bouton.deploye===true){return aParam.bouton.deploye;}
return _getBoutonDeploye.call(this);}.bind(this);break;case _ObjetListe.typeBouton.supprimer:lBouton.class='icon_trash';lBouton.title=GTraductions.getValeur('liste.supprimer');lBouton.getDisabled=function(aParam){return!_avecSuppressionSelectionCourante.call(aParam.liste,aParam.liste._cache.selectionCellule.ligne,aParam.liste._cache.selectionCellule.colonne);};lBouton.event=function(aParam){_surSuppression.call(aParam.liste);};break;case _ObjetListe.typeBouton.editer:lBouton.class='icon_pencil';lBouton.title=GTraductions.getValeur('liste.modifier');lBouton.getDisabled=function(){if(_getNonEditable.call(this)||this._cache.editionEnCours||!this.Donnees){return true;}
const lParams=_getParamsCellule.call(this,this._cache.selectionCellule.colonne,this._cache.selectionCellule.ligne,{surEdition:true});return!this.Donnees.AvecEdition(lParams.colonne,lParams.article,lParams);}.bind(this);lBouton.event=function(aParam){aParam.avecFocus=false;aParam.liste.demarrerEditionSurCellule(aParam.liste._cache.selectionCellule.ligne,aParam.liste._cache.selectionCellule.colonne);};break;case _ObjetListe.typeBouton.filtrer:{Object.assign(lBouton,{class:'icon_filtre',title:GTraductions.getValeur('liste.Filtrer'),getDisabled(){return false;}});break;}
case _ObjetListe.typeBouton.parametrer:lBouton.class='icon_wrench';lBouton.title=GTraductions.getValeur('liste.HintBoutonParametre');lBouton.event=function(aParam){aParam.liste._ouvrirFenetreParametrageColonnes();};lBouton.getDisabled=function(){return false;};break;case _ObjetListe.typeBouton.exportCSV:if(aParams&&aParams.createExportCSV){aParams.createExportCSV(lBouton);} else{return;}
break;case _ObjetListe.typeBouton.rechercher:lBouton.class='icon_search';lBouton.title=GTraductions.getValeur('liste.Rechercher');lBouton.widthInput=0;lBouton.getDisabled=() =>{return this._cache.lignesVisibles.length===0;};lBouton.event=() =>{_creerZoneRechercheTexte.call(this,true);};break;}
Object.assign(lBouton,aBouton);if(!lBouton.class){return;}
if(!lBouton.event){return;}
this._cache.boutons.push(lBouton);});}}
_getInfosZonesColonnes(){}
_construireAffichage(){}
ConstruireAffichage(aParamsActualiser){this._cache.survoleTitreTriVisible=false;this._cache.ouvrirSelecteurFileParLigne={};if(!GHtml.elementExiste(this.Nom)){return'';}
if(!this._cache.largeurPage&&this._cache.avecPourcentage){return'';}
if(!this.ListeTailles||this.ListeTailles.length===0){return'';}
if(this._options.avecListeNeutre===undefined){this._options.avecListeNeutre=$('#'+this.Nom.escapeJQ()).parents('#'+ZoneFenetre.idZoneFenetre.escapeJQ()).length>0;this._options.couleursListe=this._options.avecListeNeutre?GCouleur.listeNeutre:GCouleur.liste;}
_initCacheLignes.call(this,aParamsActualiser);return this._construireAffichage();}
_getDessinCurseurTri(){return'';}
_construireListeModeAccessible(){}
_gererModificationsColonnes(){this._cache.listeCorrespondancesColonnes=[];}
_backupScroll(){return null;}
_setScroll(){}
_construireContenu_range(){}
_controleHeightLigne(){}
_setStyleCellule(aId,aColonne,aLigne,aSelectionne){if(aId){const lJCellule=GHtml.estElement(aId)?$(aId):$('#'+aId.escapeJQ());if(aSelectionne){lJCellule.addClass('selected');} else{lJCellule.removeClass('selected');}
let lValueAriaSelected=null;if(aSelectionne){lValueAriaSelected='true';} else{const lParams=_getParamsCellule.call(this,aColonne,aLigne);if(lParams.article&&this.Donnees&&this.Donnees._AvecSelection(aColonne,aLigne)){lValueAriaSelected='false';}}
lJCellule.find('>article[role=gridcell]').attr('aria-selected',lValueAriaSelected);}}
_ouvrirMenuContextuel(aParams){let lId;let lRect;if(aParams.surLigneCreation){let lIdLigneCreation=_getIdCreation.call(this,this._cache.infosZonesColonnes[0]?this._cache.infosZonesColonnes[0].colonnesVisibles[0]:0,aParams.ligne);if(!GHtml.getElement(lIdLigneCreation)){lIdLigneCreation=_getIdCreation.call(this,this.ListeCreations[0],aParams.ligne);}
lRect=GPosition.getClientRect(lIdLigneCreation);lId={x:lRect.x,y:lRect.y};}
if(aParams.node){lRect=GPosition.getClientRect(aParams.node);lId={x:lRect.x,y:lRect.y+lRect.height+5};} else if(aParams.event&&aParams.event.type==='contextmenu'){lId={x:aParams.event.pageX+5,y:aParams.event.pageY+5};}
const lParametres=Object.assign({id:lId,avecCreation:this._options.avecLigneCreation,nonEditable:_getNonEditable.call(this),avecSuppression:this._options.AvecSuppression,listeSelection:_getListeElementsSelection.call(this),tableauSelection:this.getTableauCellulesSelection(),copier:this.optionsInterne.copierCellule,coller:this.optionsInterne.collerCellule,liste:this},aParams);ObjetMenuContextuel.afficher({pere:this,evenement:_evenementMenuContextuel.bind(this,lParametres),initCommandes:function(aInstance){this.Donnees.initialisationObjetContextuel(Object.assign({menuContextuel:aInstance},lParametres));},affichageSurInitCommandes:true,surKeyPress:function(aEvent){if(this.Pere&&
this.Evenement&&
this.Donnees&&
this.Donnees.options&&
this.Donnees.options.avecEvnt_KeyPressListe){const lResult=this.Evenement.call(this.Pere,{instance:this,event:aEvent,genreEvenement:EGenreEvenementListe.KeyPressListe});_refreshSelf.call(this);return lResult;}
return false;}.bind(this),surKeyUp:function(aEvent){if(this.Pere&&
this.Evenement&&
this.Donnees&&
this.Donnees.options&&
this.Donnees.options.avecEvnt_KeyUpListe){const lResult=this.Evenement.call(this.Pere,{instance:this,event:aEvent,genreEvenement:EGenreEvenementListe.KeyUpListe});_refreshSelf.call(this);return lResult;}
return false;}.bind(this),options:{preventScrollSurRestaurationFocus:true}});}
_Entrer_DateCalendrier(){}
_testUnitaire_GetIdCreation(I,J){return _getIdCreation.call(this,I,J);}
getIdCelluleTotal(aColonne,aLigne){return this.Nom+'CelluleTotal_'+aColonne+'_'+aLigne;}
static initColonne(aPourcentage,aMinPx,aMaxPx){return{valeur:aPourcentage,min:aMinPx,max:aMaxPx};}
static getTitreCreation(aTitre){const T=[];T.push(`<i class="icon_plus_cercle liste-creation"></i>`);T.push('<div class="PetitEspaceGauche InlineBlock AlignementMilieuVertical" style="',GStyle.composeCouleurTexte(GCouleur.texteListeCreation),'">',aTitre,'</div>');return T.join('');}}
_ObjetListe.typeBouton={monter:'monter',descendre:'descendre',deployer:'deployer',supprimer:'supprimer',editer:'editer',exportCSV:'exportCSV',parametrer:'parametrer',rechercher:'rechercher',filtrer:'filtrer'};_ObjetListe.skin={classique:'classique',alternance:'alternance',flatDesign:'flatDesign'};_ObjetListe.typeInterTitre=ObjetDonneesListe.typeInterTitre;const _CONST_largeurMinColonne=10;function _setRechercheSaisie(aVal){this._cache.rechercheTexte.saisie=aVal||'';if(this._cache.lignesVisiblesSansRechercheTexte){this._cache.lignesVisibles=[].concat(this._cache.lignesVisiblesSansRechercheTexte);}}
function _setOptionsListe(aOptions,aAvecActualisation){if(aOptions&&aOptions.skin){_affecterOptionsSkin.call(this,aOptions);}
if(aOptions.colonnesCachees){this._options.colonnesCachees=[];}
$.extend(this._options,aOptions);if(aOptions&&aOptions.colonnes){this._cache.declarationsColonnes=[].concat(aOptions.colonnes)
;this._cache.colonnes.listeIds=[];this._cache.colonnes.listeTailles=[];this._cache.declColonnesByIds={};const lControleIds={};let lIndex=0;MethodesTableau.parcourir(aOptions.colonnes,function(D,aIndex){if(!D){return;}
if(D.id===undefined){D.id=aIndex.toString();}
;lControleIds[D.id]=true;this._cache.colonnes.listeIds[lIndex]=D.id;this._cache.colonnes.listeTailles[lIndex]=D.taille||0;this._cache.declColonnesByIds[D.id]=D;lIndex+=1;},this);}
this._options.couleursListe=this._options.avecListeNeutre?GCouleur.listeNeutre:GCouleur.liste;this._cache.calculsPreRenduAFaire=true;this._cache.calculsTailleColonnesAFaire=true;if(aAvecActualisation===true){_actualiser.call(this,{conserverSelection:true,sansTriDonnees:true});}
return this;}
function _affecterOptionsSkin(aOptions){switch(aOptions.skin){case _ObjetListe.skin.classique:break;case _ObjetListe.skin.alternance:Object.assign(this._options,{alternanceCouleurLigneContenu:true,avecCouleurAlternanceParDefaut:true,avecTraitSeparationDeploiementAlternance:true,avecCadreSelection:false,ignorerCouleurInlineCellule:false,hauteurAdapteContenu:true,nonEditable:true,paddingCelluleLR:3,paddingCelluleTB:2});break;case _ObjetListe.skin.flatDesign:if(!aOptions.colonnes){aOptions.colonnes=[{taille:'100%'}];}
Object.assign(this._options,{nonEditable:false,avecCadreSelection:false,paddingCelluleLR:1,paddingCelluleTB:1,borduresCellule_horizontal:0,borduresCellule_vertical:0,borduresContenu_top:0,borduresContenu_bottom:0,borduresContenu_left:0,borduresContenu_right:0,paddingContenu_LR:this.optionsInterne.versionMobile?0:3,ignorerCouleurInlineCellule:true,avecCreationEnBouton:true,avecBoutonsDansEntete:true});break;default:;}}
function _getValueCB_flatDesign(aInstance,aLigne,aIgnorerCBDisabled){const lParams=_getParamsCellule.call(aInstance,-1,aLigne);return aInstance.Donnees.getEtatCocheSelonFils(lParams.article,lParams,(aParamsCellule) =>{return aInstance.Donnees.avecCB(aParamsCellule)&&(!aIgnorerCBDisabled||!aInstance.Donnees.getDisabledCB(aParamsCellule));});}
function _setValueCB_flatDesign(aInstance,aParams,aValue,aForcerTout){if(!aParams.article&&aParams.ligne>=0){return false;}
if(aParams.ligne>=0&&aInstance.Donnees.getDisabledCB(aParams)){return false;}
if(aParams.article&&(!aParams.article.estUnDeploiement||!aInstance.Donnees.estCocheSelonFilsSurLigneDeploiement(aParams.article))&&aInstance.Donnees.avecCB(aParams)){aInstance.Donnees.setValueCB(aParams,aValue);}
if(!aParams.article||aForcerTout||aInstance.Donnees.estCocheSelonFilsSurLigneDeploiement(aParams.article)){let lValue=aValue;aInstance.Donnees.getArrayFilsVisiblesDePere(aParams.article).forEach((aElementParcours) =>{const lParams=Object.assign({},aParams,aElementParcours);_setValueCB_flatDesign(aInstance,lParams,lValue,!aParams.article);});}}
function _setValueCB_flatDesign_event(aInstance,aParams,aValue){const lResult=_setValueCB_flatDesign(aInstance,aParams,aValue);if(aInstance.Donnees.options.avecEvnt_CB&&aInstance.Evenement&&lResult!==false){aInstance.Evenement.call(aInstance.Pere,_getParamsCallback.call(aInstance,EGenreEvenementListe.ModificationCBLigne,-1,aParams.ligne,{listeCochees:aInstance.getListeArticlesCochees()}),EGenreEvenementListe.ModificationCBLigne,-1,aParams.ligne);_refreshSelf.call(aInstance);}}
function _modifierCBLigne_flatDesign(aInstance,aParams){_setValueCB_flatDesign_event(aInstance,aParams,!_getValueCB_flatDesign(aInstance,aParams.ligne,true));_refreshSelf.call(aInstance);}
function _clickSurCocheTitre(aColonne){const lDonneesListe=this.Donnees;if(!lDonneesListe){return;}
if(_getNonEditable.call(this)||this._cache.editionEnCours){return;}
const lEtatCoche=lDonneesListe.getEtatCocheSelonFils(null,_getParamsCellule.call(this,aColonne)),lValeur=lEtatCoche!==ObjetDonneesListe.EGenreCoche.Verte,lLignes=lDonneesListe.getTableauLignesModifieesCocheTitre(aColonne,lValeur);let lParams;const lListeParamsCellules=[];for(let i=0;i<lLignes.length;i++){lParams=_getParamsCellule.call(this,aColonne,lLignes[i]);if(lParams.article&&lDonneesListe.AvecEdition(aColonne,lParams.article,lParams)&&!lDonneesListe.editionRefusee(lParams)){lListeParamsCellules.push(lParams);}}
const lPromise=lDonneesListe.surEditionCocheTitre(lListeParamsCellules,lValeur);Promise.resolve(lPromise).then(() =>{_actualiser.call(this,{conserverSelection:true,zonesActualisation:{contenu:true,total:true}});_SurApresEditionEvenement.call(this,_getParamsCellule.call(this,aColonne,-1,{avecModification:true}));},() =>{}).then(() =>{_refreshSelf.call(this);});}
function _getNonEditable(){return this._options.nonEditable||(this._options.nonEditableSurModeExclusif&&GApplication.getModeExclusif());}
function _isToucheRetourChariot(aEvent){return aEvent&&aEvent.which===ToucheClavier.RetourChariot&&!aEvent.shiftKey&&!aEvent.altKey&&!aEvent.ctrlKey;}
function _estCurseurEnBorneDeSelection(aElement,aDebut){if(aElement){if(document.selection){const LCurseurCourant=document.selection.createRange();const LCurseurElement=aElement.createTextRange();LCurseurElement.collapse(true);return(LCurseurCourant.boundingWidth===0)&&(LCurseurCourant.boundingLeft===LCurseurElement.boundingLeft);}
if(aElement.selectionStart!==null&&aElement.selectionStart!==undefined&&aElement.selectionStart===aElement.selectionEnd){return aDebut?aElement.selectionStart===0:aElement.selectionStart===aElement.value.length;}}
return false;}
function _navigationFlechesClavier(aEvent,aParams){if(!_estToucheNavigationFlechesClavier(aEvent)){return;}
const lParam=Object.assign({ligne:this._cache.selectionCellule.ligne,colonne:this._cache.selectionCellule.colonne,orientationVerticale:false,sensInverse:false,avecSelection:this.Donnees.options.avecSelectionSurNavigationClavier,entrerEdition:false},aParams);if(aEvent.which===ToucheClavier.FlecheGauche){lParam.sensInverse=true;} else if(aEvent.which===ToucheClavier.FlecheHaut){lParam.sensInverse=true;lParam.orientationVerticale=true;} else if(aEvent.which===ToucheClavier.FlecheBas){lParam.orientationVerticale=true;} else if(aEvent.which===ToucheClavier.Debut){if(aEvent.ctrlKey||this.ListeTailles.length===1){lParam.ligne= -1;lParam.sensInverse=false;lParam.orientationVerticale=true;} else{lParam.colonne= -1;lParam.sensInverse=false;lParam.orientationVerticale=false;}} else if(aEvent.which===ToucheClavier.Fin){if(aEvent.ctrlKey||this.ListeTailles.length===1){lParam.ligne=this.Donnees.Donnees.GetNbrElements();lParam.sensInverse=true;lParam.orientationVerticale=true;} else{lParam.colonne=this.ListeTailles.length;lParam.sensInverse=true;lParam.orientationVerticale=false;}} else if(aEvent.which===ToucheClavier.PageBas){const lIndexLigneVisible=this._cache.lignesVisibles.indexOf(lParam.ligne);let lLigne=this.Donnees.Donnees.GetNbrElements();if(lIndexLigneVisible>=0&&lIndexLigneVisible+11<this._cache.lignesVisibles.length){lLigne=this._cache.lignesVisibles[lIndexLigneVisible+11];}
Object.assign(lParam,{orientationVerticale:true,sensInverse:true,ligneEtColonneFixe:true,ligne:lLigne});} else if(aEvent.which===ToucheClavier.PageHaut){const lIndexLigneVisible=this._cache.lignesVisibles.indexOf(lParam.ligne);let lLigne= -1;if(lIndexLigneVisible>=0&&lIndexLigneVisible-11>=0){lLigne=this._cache.lignesVisibles[lIndexLigneVisible-11];}
Object.assign(lParam,{orientationVerticale:true,sensInverse:false,ligneEtColonneFixe:true,ligne:lLigne});}
if(lParam.entrerEdition){_selectionnerCelluleSuivante.call(this,lParam);} else{_navigationCelluleSuivante.call(this,lParam);}}
function _estToucheNavigationFlechesClavier(aEvent){return!!aEvent&&(ToucheClavier.estToucheFleche(aEvent.which)||aEvent.which===ToucheClavier.Fin||aEvent.which===ToucheClavier.Debut||aEvent.which===ToucheClavier.PageBas||aEvent.which===ToucheClavier.PageHaut);}
function _getLeftCurseurTri(aPositionColonne,aDerniereColonneDeBloc){return aPositionColonne.left+Math.round(aPositionColonne.width/2-this._options.widthTri/2)+(aDerniereColonneDeBloc?0:1);}
function _positionnerCurseurTri(aInfosZonesColonnes,aNode,aNumeroTri){const lNumeroColonne=this._triCourant.colonne[aNumeroTri],lPosition=aInfosZonesColonnes.gabaritColonnesTitre[lNumeroColonne],lDerniereColonne=lNumeroColonne===aInfosZonesColonnes.colonnesVisibles[aInfosZonesColonnes.colonnesVisibles.length-1];if(!lPosition){$(aNode).hide();} else{$(aNode).show().css('left',_getLeftCurseurTri.call(this,lPosition,lDerniereColonne)+'px');}}
function _avecBoutonsListeHautScroll(){return this._cache.boutons&&this._cache.boutons.length>0&&!this._options.avecBoutonsDansEntete;}
function _avecBoutonsListeEntete(){return this._cache.boutons&&this._cache.boutons.length>0&&this._options.avecBoutonsDansEntete;}
function _initCacheLignes(aParamsActualiser){this._cache.lignesFusionParColonne={};if(this.Donnees){this.Donnees.lignesFusionParColonne=this._cache.lignesFusionParColonne;}
if(!aParamsActualiser||!aParamsActualiser.estFiltreRechercheTexte){this._cache.rechercheTexte.textesParLigne=null;this._cache.rechercheTexte.lignesCachees=[];}
this._cache.lignesVisibles=[];this._cache.lignesVisiblesSansRechercheTexte=[];if(this.ListeTailles&&this.Donnees){for(let J=0,lNb=this.Donnees.GetNbrLignes();J<lNb;J++){if(this.Donnees.estVisible(J)){this._cache.lignesVisiblesSansRechercheTexte.push(J);this._cache.lignesVisibles.push(J);}}
if(aParamsActualiser&&aParamsActualiser.estFiltreRechercheTexte){this._cache.lignesVisibles=[];this._cache.lignesVisiblesSansRechercheTexte.forEach((aLigne) =>{if(!this._cache.rechercheTexte.lignesCachees[aLigne]){this._cache.lignesVisibles.push(aLigne);}});}}}
function _estLigneVisible(aListe,aNumeroLigne){return!aListe._cache.rechercheTexte.lignesCachees[aNumeroLigne]&&aListe.Donnees.estVisible(aNumeroLigne);}
function _estSelectionParCellule(aLigne,aColonne){if(aColonne<0){return false;}
return!!this.Donnees&&this.Donnees.selectionParCellule(aColonne,this.Donnees.Donnees.GetElement(aLigne));}
function _calculerTitres(){function _completerCelluleVide(aLigne,aColonne){return this.ListeTitres[aLigne-1]&&this.ListeTitres[aLigne-1][aColonne]===TypeFusionTitreListe.FusionGauche?TypeFusionTitreListe.FusionGauche:TypeFusionTitreListe.FusionHaute;}
let lNbLignes,iLigne,iColonne,lNumeroColonne,lValeur;const lHintTitres=[];if(this._options.colonnes&&
this._cache.declarationsColonnes&&
this._cache.declarationsColonnes.length>0){this.ListeTitres=null;lNbLignes=0;for(iColonne=0;iColonne<this._cache.declarationsColonnes.length;iColonne++){if(this._cache.declarationsColonnes[iColonne]){if(MethodesObjet.isArray(this._cache.declarationsColonnes[iColonne].titre)){lNbLignes=Math.max(lNbLignes,this._cache.declarationsColonnes[iColonne].titre.length);} else if(this._cache.declarationsColonnes[iColonne].titre){lNbLignes=Math.max(lNbLignes,1);}
if(this._cache.declarationsColonnes[iColonne].sansBordureDroite){if(!this._options.colonnesSansBordureDroit){this._options.colonnesSansBordureDroit=[];}
this._options.colonnesSansBordureDroit.push(this._cache.declarationsColonnes[iColonne].id);}}}
if(lNbLignes>0){this.ListeTitres=[];lNumeroColonne=0;for(iColonne=0;iColonne<this._cache.declarationsColonnes.length;iColonne++){if(this._cache.declarationsColonnes[iColonne]){for(iLigne=0;iLigne<lNbLignes;iLigne++){if(!this.ListeTitres[iLigne]){this.ListeTitres[iLigne]=[];}
if(!lHintTitres[iLigne]){lHintTitres[iLigne]=[];}
if(MethodesObjet.isArray(this._cache.declarationsColonnes[iColonne].titre)){lValeur=this._cache.declarationsColonnes[iColonne].titre[iLigne];if(lValeur!==undefined&&lValeur!==null){this.ListeTitres[iLigne][lNumeroColonne]=lValeur;} else{this.ListeTitres[iLigne][lNumeroColonne]=iLigne===0?lNumeroColonne===0?'':TypeFusionTitreListe.FusionGauche:_completerCelluleVide.call(this,iLigne,lNumeroColonne);}} else{lValeur=this._cache.declarationsColonnes[iColonne].titre;this.ListeTitres[iLigne][lNumeroColonne]=iLigne===0?lValeur!==undefined&&lValeur!==null?lValeur:lNumeroColonne===0?'':TypeFusionTitreListe.FusionGauche:_completerCelluleVide.call(this,iLigne,lNumeroColonne);}
if(MethodesObjet.isArray(this._cache.declarationsColonnes[iColonne].hint)){if(this._cache.declarationsColonnes[iColonne].hint[iLigne]){lHintTitres[iLigne][lNumeroColonne]=this._cache.declarationsColonnes[iColonne].hint[iLigne];}} else if(this._cache.declarationsColonnes[iColonne].hint){lHintTitres[iLigne][lNumeroColonne]=this._cache.declarationsColonnes[iColonne].hint;}}
lNumeroColonne+=1;}}}}
const lDescripteurSkin={getCouleurFond:null,getCouleurTexte:null,estCoche:false,largeurClasseCssImage:null};for(iLigne in this.ListeTitres){for(iColonne in this.ListeTitres[iLigne]){const lDescripteur=this.ListeTitres[iLigne][iColonne],lDescripteurModele=Object.assign({},lDescripteurSkin);if(!lDescripteur){lDescripteurModele.libelle='';} else if(MethodesObjet.isObject(lDescripteur)){Object.assign(lDescripteurModele,lDescripteur);if(MethodesObjet.nomProprieteDeValeur(TypeFusionTitreListe,lDescripteur.libelle)!==''){lDescripteurModele.fusion=lDescripteur.libelle;}
if(lDescripteurModele.couleurFond){lDescripteurModele.getCouleurFond=function(){return this.couleurFond;};}
if(lDescripteurModele.couleurTexte){lDescripteurModele.getCouleurTexte=function(){return this.couleurTexte;};}
if(lDescripteurModele.controleur&&MethodesObjet.isObject(lDescripteurModele.controleur)){Object.keys(lDescripteurModele.controleur).forEach((aKey) =>{if(!this._cache.keysControleurTitre[aKey]){if(this.controleur[aKey]||this._cache.keysControleurDonneesListe[aKey]){return;}
this._cache.keysControleurTitre[aKey]=true;}});$.extend(true,this.controleur,lDescripteurModele.controleur);}} else if(MethodesObjet.nomProprieteDeValeur(TypeFusionTitreListe,lDescripteur)!==''){lDescripteurModele.fusion=lDescripteur;} else if((lDescripteur.charAt(0)==='[')&&(lDescripteur.charAt(lDescripteur.length-1)===']')){lDescripteurModele.classeCssImage=lDescripteur.substr(1,lDescripteur.length-2);} else if((lDescripteur.charAt(0)==='{')&&(lDescripteur.charAt(lDescripteur.length-1)==='}')){lDescripteurModele.libelleHtml=lDescripteur.substr(1,lDescripteur.length-2);} else if(MethodesObjet.isString(lDescripteur)){lDescripteurModele.libelle=lDescripteur;} else{lDescripteurModele.libelle='';GLog.addLog('_ObjetListe.setOptionsListe : pas de descripteur de colonnes',null,GLog.genre.Avertissement);}
if(!lDescripteurModele.title&&lHintTitres&&lHintTitres[iLigne]&&lHintTitres[iLigne][iColonne]){lDescripteurModele.title=lHintTitres[iLigne][iColonne];}
this.ListeTitres[iLigne][iColonne]=lDescripteurModele;}}}
function _filtreRechercheTexte(aParamsActualiser){const lCache=this._cache;if(lCache.lignesVisiblesSansRechercheTexte){lCache.lignesVisibles=[].concat(lCache.lignesVisiblesSansRechercheTexte);}
const lOldCache=lCache.rechercheTexte.lignesCachees;lCache.rechercheTexte.lignesCachees=[];const lRechercheVide=lCache.rechercheTexte.saisie.trim()==='';if(!lRechercheVide&&!lCache.rechercheTexte.textesParLigne){lCache.rechercheTexte.textesParLigne=[];this.Donnees.enConstruction_cacheRechercheTexte=true;try{_construireCache_rechercheTextes.call(this);} finally{this.Donnees.enConstruction_cacheRechercheTexte=false;}}
if(!lRechercheVide){let lRecherche=lCache.rechercheTexte.saisie.trim().replace(/\s\s/g,'').replace(/[-[\]/{}()*+?.\\^$|']/g,'\\$&');lRecherche=ComparateurChaines.normalize(lRecherche);const lTabRecherches=lRecherche.split(' ');const lIndexsLignesVisibles=[];lCache.rechercheTexte.textesParLigne.forEach((aInfosLigne,aIndex) =>{const lLigneVisible=lTabRecherches.every((aRech) =>{if(!new RegExp(aRech,'i').test(aInfosLigne.texte)){lCache.rechercheTexte.lignesCachees[aInfosLigne.ligne]=true;return false;}
return true;});if(lLigneVisible){lIndexsLignesVisibles.push(aIndex);}});lCache.rechercheTexte.lignesCachees.forEach((aCachee,aLigne) =>{if(!aCachee){return;}
const lIndice=lCache.lignesVisiblesSansRechercheTexte.indexOf(aLigne);if(lIndice<=0){return;}
const lLignePrec=lCache.lignesVisiblesSansRechercheTexte[lIndice-1];lCache.infosZonesColonnes.forEach((aBloc) =>{if(lCache.rechercheTexte.lignesCachees[aLigne]){aBloc.colonnesVisibles.forEach((aNumeroColonne) =>{if(lCache.rechercheTexte.lignesCachees[aLigne]&&!lCache.rechercheTexte.lignesCachees[lLignePrec]&&this.Donnees.fusionCelluleAvecLignePrecedente(_getParamsCellule.call(this,aNumeroColonne,aLigne,{celluleLignePrecedente:_getParamsCellule.call(this,aNumeroColonne,lLignePrec)}))){lCache.rechercheTexte.lignesCachees[aLigne]=undefined;}});}});});lIndexsLignesVisibles.forEach((aIndex) =>{const lInfosLigneInitiale=lCache.rechercheTexte.textesParLigne[aIndex];if(!lInfosLigneInitiale){return;}
const lFuncBoucle=function(aInc){let lLigneVisible=lInfosLigneInitiale.ligne;let lIndex=aIndex+(aInc?1:-1);while(lIndex>=0&&lIndex<lCache.rechercheTexte.textesParLigne.length){const lInfosLigne=lCache.rechercheTexte.textesParLigne[lIndex];if(!lInfosLigne||!lCache.rechercheTexte.lignesCachees[lInfosLigne.ligne]){break;}
if(this.Donnees.rechercheTexte_forcerLignePrecSuivVisible(_getParamsCellule.call(this,-1,lLigneVisible),_getParamsCellule.call(this,-1,lInfosLigne.ligne))){lCache.rechercheTexte.lignesCachees[lInfosLigne.ligne]=undefined;lLigneVisible=lInfosLigne.ligne;} else{break;}
lIndex+=aInc?1:-1;}};lFuncBoucle.call(this,false);lFuncBoucle.call(this,true);});}
if(!MethodesObjet.objetsIdentiques(lCache.rechercheTexte.lignesCachees,lOldCache)){const lParams=Object.assign(aParamsActualiser||{},{conserverSelection:true,selections:null,zonesActualisation:{contenu:true},estFiltreRechercheTexte:true,conserverPositionScroll:false});_actualiser.call(this,lParams);this.$refreshSelf();const lInput=_getJConteneurInputRecherche(this).find('.liste_rechercheTexte input').get(0);if(lInput){GHtml.setFocusEdit(lInput);}}}
function _construireCache_rechercheTextes(){const lCache=this._cache;const lCacheRef=lCache.refresh;let lStructure=[];if(!lCache.refresh.avecConstructionDynamiqueContenu){lStructure.push({deb:0,fin:lCache.lignesVisibles.length-1});} else{lStructure=lCacheRef.structure;}
lStructure.forEach((aStructure,aIndiceRange) =>{let lIndiceLigne;let lInfos;let lFragment=IEHtml.outils.createSafeFragment();let lJFragment;try{lCache.infosZonesColonnes.forEach((aInfosZoneColonnes,aIndex) =>{let lDiv=document.createElement('div');lFragment.appendChild(lDiv);lDiv.id=`frag${aIndex}`;const lHtml=this._construireContenu_range(aInfosZoneColonnes,aIndiceRange);$(lDiv).IEHtmlAppend('<div>'+lHtml+'</div>',{controleur:this.controleur});lDiv=null;});lJFragment=$(lFragment);for(lIndiceLigne=aStructure.deb;lIndiceLigne<=aStructure.fin;lIndiceLigne++){lInfos={ligne:lCache.lignesVisibles[lIndiceLigne],texte:''};lCache.rechercheTexte.textesParLigne.push(lInfos);lCache.infosZonesColonnes.forEach((aInfosZoneColonnes,aIndex) =>{const lTab=[];lFragment.querySelectorAll(`#frag${aIndex} .liste_celluleGrid_${lIndiceLigne+1} :not(.wai_hidden)`).forEach((aNode) =>{if(aNode.childNodes&&aNode.childNodes.length>0){aNode.childNodes.forEach((aChildNode) =>{if(aChildNode.nodeType===Node.TEXT_NODE){const lValue=aChildNode.nodeValue||'';if(lValue){lTab.push(lValue);}}});}});lInfos.texte+=' '+ComparateurChaines.normalize(lTab.join(' '));});}} finally{lJFragment.children().remove();lJFragment.remove();lJFragment=null;lFragment=null;}});}
function _calculerTailles(){this.ListeTailles=this._cache.colonnes.listeTailles||[];let lElement,i,lValeur;for(i=0;i<this.ListeTailles.length;i++){lElement=this.ListeTailles[i];if(lElement&&lElement.search&&lElement.search(/%/)>=0){this.ListeTailles[i]=_ObjetListe.initColonne(parseInt(lElement,10));} else if(lElement&&lElement.endsWith&&lElement.toLowerCase().endsWith('rem')){let lTailleRem=parseFloat(lElement.toLowerCase().replace('rem',''));lTailleRem=isNaN(lTailleRem)?0:lTailleRem;this.ListeTailles[i]={estREM:true,valeurRem:lElement,valeurPx:Math.max(0,GPosition.remToPixels(lTailleRem))};} else if(lElement&&!MethodesObjet.isObject(lElement)){lValeur=parseInt(lElement,10);this.ListeTailles[i]=Math.max(0,isNaN(lValeur)?0:lValeur);}}}
function _trierDonnees(){this.Donnees.triCourant=this._triCourant;this.Donnees.trier();}
function _setDonnees(ADonnees,aLigneSelectionne,aParams){this._donneesRecus=true;this.Donnees=ADonnees;const lControleurDonnees=this.Donnees?this.Donnees.getControleur(this.Donnees,this):null;if(lControleurDonnees){Object.keys(lControleurDonnees).forEach((aKey) =>{if(!this._cache.keysControleurDonneesListe[aKey]){if(this.controleur[aKey]||this._cache.keysControleurTitre[aKey]){return;}
this._cache.keysControleurDonneesListe[aKey]=true;}});$.extend(true,this.controleur,lControleurDonnees);}
if(this._options.skin===_ObjetListe.skin.flatDesign&&this.Donnees){}
this._cache.listeNonInitialisee=false;_setRechercheSaisie.call(this,'');clearTimeout(this._cache.timerKeyPress);this._cache.selectionCellule={ligne:-1,colonne:-1};this._cache.celluleClicNonShift={ligne:-1,colonne:-1};if(this.Donnees){this._cache.lignesSelectionnees=new Array(this.Donnees.GetNbrLignes());this._cache.lignesSelectionnees_prec=[];}
_calculsPreRendu.call(this);if(this.Donnees){this.Donnees.__getIdsColonnes=function(){return this._cache.colonnes.listeIds;}.bind(this);this.Donnees.__getParams=_getParamsCellule.bind(this);}
let lSelections=null;if(this.Donnees&&this.Donnees.Donnees&&aLigneSelectionne>=0&&MethodesObjet.isNumber(aLigneSelectionne)){this._cache.selectionCellule.ligne=aLigneSelectionne;_trierDonnees.call(this);lSelections=[{article:this.Donnees.Donnees.GetElement(this._cache.selectionCellule.ligne)}];} else if(this.Donnees&&this.Donnees.Donnees&&aParams&&aParams.listeElementsSelection&&aParams.listeElementsSelection.GetNbrElements&&aParams.listeElementsSelection.GetNbrElements()>0){lSelections=[];aParams.listeElementsSelection.parcourir((aElement) =>{lSelections=[{article:aElement}];});aParams.listeElementsSelection=null;aParams.instancesIdentiquesSelections=false;_trierDonnees.call(this);}
_actualiser.call(this,Object.assign({selections:lSelections,sansTriDonnees:!!lSelections,avecEvenementSelection:!!lSelections&&lSelections.length>0,avecScrollSelection:!!lSelections&&lSelections.length>0,conserverPositionScroll:false},aParams));return this;}
function _getLargeurPage(){const lJElement=$('#'+this.Nom.escapeJQ());if(lJElement.html()===''){lJElement.html('&nbsp;');}
return lJElement.width();}
function _calculerColonnes(){this._cache.largeurPage=_getLargeurPage.call(this);this._cache.colonnesSansBordureDroit=[];if(this._options.colonnesSansBordureDroit){MethodesTableau.parcourir(this._options.colonnesSansBordureDroit,function(aElement,aIndex){if(aElement===true||aElement===false){this._cache.colonnesSansBordureDroit[aIndex]=aElement;} else if(MethodesObjet.isString(aElement)){this._cache.colonnesSansBordureDroit[_getNumeroColonneSelonNumeroOuId.call(this,aElement)]=true;}},this);}
this._cache.taillesColonne=_calculerTaillesColonnes.call(this,this._cache);this._cache.calculsTailleColonnesAFaire=!this._cache.largeurPage;}
function _getNumeroColonneSelonNumeroOuId(aColonne,aAccepteErreur){let lNumeroColonne=aColonne;if(MethodesObjet.isString(aColonne)&&this._cache.colonnes.listeIds){lNumeroColonne=this._cache.colonnes.listeIds.indexOf(aColonne);if(lNumeroColonne<0){lNumeroColonne=null;}}
return lNumeroColonne;}
function _calculerTri(){let lNombreTri=0,lOptionsTriParDefaut=null,lNumerosColonnesTriDefaut=[],lGenreTriColonneTriDefaut=[],lGenreColonne,lNumeroColonne,lErreurTriCorrigee=false,i;function _chercherColonneTriValide(aNumeroColonne,aNumerosColonnesTriDefaut){let lNumeroColonne=aNumeroColonne;if(!MethodesObjet.isNumber(lNumeroColonne)){lNumeroColonne=0;lErreurTriCorrigee=true;}
while(lNumeroColonne>=0&&(!_estColonneVisible.call(this,lNumeroColonne)||
this._cache.colonnesTri[lNumeroColonne]!==true||
MethodesTableau.existe(lNumeroColonne,aNumerosColonnesTriDefaut))){lNumeroColonne+= -1;lErreurTriCorrigee=true;}
if(lNumeroColonne<0){let lTrouve=false;this._cache.infosZonesColonnes.forEach((aBloc) =>{aBloc.colonnesVisibles.forEach((aNumeroColonne) =>{if(!lTrouve&&
this._cache.colonnesTri[aNumeroColonne]===true&&
!MethodesTableau.existe(aNumeroColonne,aNumerosColonnesTriDefaut)){lTrouve=true;lNumeroColonne=aNumeroColonne;lErreurTriCorrigee=true;}});});}
;return lNumeroColonne;}
if(this._options.colonnesTriables===true){this._cache.colonnesTri=[];for(i=0;i<this.ListeTailles.length;i++){this._cache.colonnesTri[i]=true;}} else{this._cache.colonnesTri=[];if(this._options.colonnesTriables){this._cache.listeCorrespondancesColonnes.forEach((aNumeroColonneReelle,aNumeroColonneInitiale) =>{if(this._options.colonnesTriables[aNumeroColonneInitiale]===true||this._options.colonnesTriables[aNumeroColonneInitiale]===false){if(aNumeroColonneReelle>=0){this._cache.colonnesTri[aNumeroColonneReelle]=this._options.colonnesTriables[aNumeroColonneInitiale];}} else if(MethodesObjet.isString(this._options.colonnesTriables[aNumeroColonneInitiale])){lNumeroColonne=_getNumeroColonneSelonNumeroOuId.call(this,this._options.colonnesTriables[aNumeroColonneInitiale],true);if(lNumeroColonne!==null){this._cache.colonnesTri[lNumeroColonne]=true;}}});}
if(this._cache.colonnesTri.length===0){this._cache.colonnesTri=null;}}
lOptionsTriParDefaut=this._options.numeroColonneTriDefaut;if(MethodesObjet.isFunction(lOptionsTriParDefaut)){lOptionsTriParDefaut=lOptionsTriParDefaut();}
if(this._cache.colonnesTri&&this._cache.colonnesTri.length>0){if(MethodesObjet.isArray(lOptionsTriParDefaut)&&lOptionsTriParDefaut.length>0){lNumerosColonnesTriDefaut=[];for(i=0;i<lOptionsTriParDefaut.length;i++){lNumeroColonne=null;if(MethodesObjet.isObject(lOptionsTriParDefaut[i])){if(lOptionsTriParDefaut[i].id){lNumeroColonne=_getNumeroColonneSelonNumeroOuId.call(this,lOptionsTriParDefaut[i].id,true);}
if(lNumeroColonne===null){lNumeroColonne=lOptionsTriParDefaut[i].numero||0;lErreurTriCorrigee=true;}
lNumeroColonne=lOptionsTriParDefaut[i].numero||0;lGenreColonne=lOptionsTriParDefaut[i].genre||EGenreTriElement.Croissant;} else{lNumeroColonne=_getNumeroColonneSelonNumeroOuId.call(this,lOptionsTriParDefaut[i],true)||0;lGenreColonne=EGenreTriElement.Croissant;}
lNumeroColonne=_chercherColonneTriValide.call(this,lNumeroColonne,lNumerosColonnesTriDefaut);if(lNumeroColonne>=0){lNumerosColonnesTriDefaut.push(lNumeroColonne);lGenreTriColonneTriDefaut.push(lGenreColonne);}}
lNombreTri=lNumerosColonnesTriDefaut.length;} else{lNombreTri=1;lNumeroColonne=null;if(MethodesObjet.isObject(lOptionsTriParDefaut)){if(lOptionsTriParDefaut.id){lNumeroColonne=_getNumeroColonneSelonNumeroOuId.call(this,lOptionsTriParDefaut.id,true)||0;}
if(lNumeroColonne===null){lNumeroColonne=lOptionsTriParDefaut.numero||0;lErreurTriCorrigee=true;}
lGenreColonne=lOptionsTriParDefaut.genre||EGenreTriElement.Croissant;} else{lNumeroColonne=_getNumeroColonneSelonNumeroOuId.call(this,lOptionsTriParDefaut,true)||0;lGenreColonne=EGenreTriElement.Croissant;}
lNumeroColonne=_chercherColonneTriValide.call(this,parseInt(lNumeroColonne||0,10),lNumerosColonnesTriDefaut);lNumerosColonnesTriDefaut=[lNumeroColonne];lGenreTriColonneTriDefaut=[lGenreColonne];}}
this._triCourant={colonne:[],genre:[],nombreTri:lNombreTri};for(i=0;i<lNombreTri;i++){this._triCourant.colonne[i]=lNumerosColonnesTriDefaut[i];this._triCourant.genre[i]=lGenreTriColonneTriDefaut[i];}
if(lErreurTriCorrigee){_setOptionEvenementSurTri.call(this);}}
function _calculerParametresCreation(){function _ajouterColonne(aColonne){const lNumeroColonne=_getNumeroColonneSelonNumeroOuId.call(this,aColonne);if(MethodesObjet.isNumber(lNumeroColonne)){if(this._cache.colonnes.listeTailles&&(lNumeroColonne<0||lNumeroColonne>=this._cache.colonnes.listeTailles.length)){require('IELog.js').addLog('options.listeCreations [_calculerParametresCreation], la colonne numero '+aColonne+' n\'existe pas !');}
this.ListeCreations.push(lNumeroColonne);}}
this.ListeCreations=[];if(Array.isArray(this._options.listeCreations)){MethodesTableau.parcourir(this._options.listeCreations,_ajouterColonne,this);} else{_ajouterColonne.call(this,this._options.listeCreations);}}
function _avecLigneCreationTitre(){let lAvecLigneCreation=!_getNonEditable.call(this)&&this._options.avecLigneCreation&&!!this.Donnees;if(lAvecLigneCreation&&this._cache.infosZonesColonnes.length>1){lAvecLigneCreation=false
;}
return lAvecLigneCreation;}
function _getLargeurPartieScrollV(){return Math.max(this.ScrollV?this.ScrollV.Largeur:0,_avecBoutonsListeHautScroll.call(this)?(this._options.tailleBoutons+1):0);}
function _calculerTaillesColonnes(aCache,aPourImpression){const lTaillesColonne=[];if(!this.ListeTailles){return lTaillesColonne;}
this.ListeTailles.forEach(() =>{lTaillesColonne.push({px:0});});let i,lTailleRestante,lTaille,lTotalValeurs=0,lElement,lNumeroColonne;const lColonnesPourcent=[];aCache.avecPourcentage=false;aCache.largeurTotalFixe=0;aCache.largeurTotalCalcule=0;for(i=0;i<this.ListeTailles.length;i++){if(_estColonneVisible.call(this,i)){if(this.ListeTailles[i]&&this.ListeTailles[i].valeur&&!this.ListeTailles[i].estREM){aCache.avecPourcentage=true;lTotalValeurs+=this.ListeTailles[i].valeur;lElement={indice:i,valeur:this.ListeTailles[i].valeur,min:Math.max(_CONST_largeurMinColonne,this.ListeTailles[i].min?parseInt(this.ListeTailles[i].min,10):0),max:this.ListeTailles[i].max?parseInt(this.ListeTailles[i].max,10):0};lColonnesPourcent.push(lElement);Object.assign(lTaillesColonne[i],lElement,{estPourcent:true});aCache.largeurTotalFixe+=lElement.min+2*this._options.paddingCelluleLR+1;} else if(this.ListeTailles[i]&&this.ListeTailles[i].estREM){lTaillesColonne[i].px=this.ListeTailles[i].valeurPx;Object.assign(lTaillesColonne[i],this.ListeTailles[i]);aCache.largeurTotalFixe+=this.ListeTailles[i].valeurPx+2*this._options.paddingCelluleLR+1;} else{lTaillesColonne[i].px=this.ListeTailles[i];aCache.largeurTotalFixe+=this.ListeTailles[i]+2*this._options.paddingCelluleLR+1;}}}
let lTotal=0;lTaillesColonne.forEach((aCol) =>{if(aCol.estPourcent){aCol.pourcent=Math.floor(aCol.valeur*100/lTotalValeurs);lTotal+=aCol.pourcent;}});if(lTotal<100){lTaillesColonne.forEach((aCol) =>{if(aCol.estPourcent){aCol.pourcent+=100-lTotal;return false;}
return true;});}
aCache.largeurTotalFixe=Math.max(0,aCache.largeurTotalFixe-1);aCache.largeurTotalCalcule=aCache.largeurTotalFixe;if(!aCache.largeurPage){return lTaillesColonne;}
if(aCache.avecPourcentage){lTailleRestante=aCache.largeurPage-aCache.largeurTotalFixe-_getDiffLargeurContenu(this,aPourImpression);lTailleRestante=Math.max(0,lTailleRestante);let lAvecMax=true;while(lAvecMax){lAvecMax=false;for(i in lColonnesPourcent){lElement=lColonnesPourcent[i];if(!lElement){continue;}
lTaille=lElement.min+Math.max(0,Math.round(lTailleRestante*lElement.valeur/lTotalValeurs));if(lElement.max&&lTaille>lElement.max){lTaillesColonne[lElement.indice].px=lTaille=lElement.max;lTailleRestante-=lTaille-lElement.min;lTotalValeurs-=lElement.valeur;aCache.largeurTotalCalcule+=lTaille-lElement.min;lAvecMax=true;delete lColonnesPourcent[i];break;}}}
for(i in lColonnesPourcent){lElement=lColonnesPourcent[i];if(!lElement){continue;}
lNumeroColonne=lElement.indice;lTaillesColonne[lNumeroColonne].px=lElement.min+
Math.max(0,Math.round(lTailleRestante*lElement.valeur/lTotalValeurs))
;lTailleRestante-=lTaillesColonne[lNumeroColonne].px-lElement.min;lTotalValeurs-=lElement.valeur;aCache.largeurTotalCalcule+=lTaillesColonne[lNumeroColonne].px-lElement.min;}}
aCache.largeurBlocFixe=0;aCache.infosZonesColonnes.forEach((aInfos) =>{aInfos.largeurBloc=0;aInfos.colonnesVisibles.forEach((aNumeroCol) =>{const lTaille=lTaillesColonne[aNumeroCol].px+2*this._options.paddingCelluleLR+1;aInfos.largeurBloc+=lTaille;if(aInfos.estBlocFixe){aCache.largeurBlocFixe+=lTaille;}});});return lTaillesColonne;}
function _getDiffLargeurContenu(aInstance,aPourImpression){return(aPourImpression?0:_getLargeurPartieScrollV.call(aInstance))+aInstance._options.borduresContenu_left+aInstance._options.borduresContenu_right+aInstance._options.paddingContenu_LR*2;}
function _calculsPreRendu(aIgnorerCalculTri){const lAvecCalculPreRendu=this._cache.calculsPreRenduAFaire;if(lAvecCalculPreRendu){this._cache.calculsPreRenduAFaire=false;this._gererModificationsColonnes();this._preparerBoutons();_calculerTailles.call(this);_calculColonnesCachees.call(this,this._cache);this._getInfosZonesColonnes(this._cache);_calculerTitres.call(this);_calculerParametresCreation.call(this);if(aIgnorerCalculTri!==true||this._cache.calculTriAFaire){this._cache.calculTriAFaire=false;_calculerTri.call(this);}}
if(this._cache.calculsTailleColonnesAFaire||lAvecCalculPreRendu){_calculerColonnes.call(this);}}
function _actualiser(aParams){const lParams=Object.assign({conserverSelection:false,conserverFocusSelection:false,ignorerFocusListe:true,sansTriDonnees:false,ignorerCalculTri:false,selections:null,instancesIdentiquesSelections:true,avecEvenementSelection:false,avecScrollSelection:false,avecSelectionSurLigneInvisible:false,conserverPositionScroll:true,avecEvenementModificationSelection:true,conserverPositionElement:null},aParams);let lZonesActualisation=this.optionsInterne.avecActualisationParZone?lParams.zonesActualisation:false;if(this._cache.creationEnCours){lZonesActualisation=false;}
this._cache.creationEnCours=false;this._cache.editionEnCours=false;this._cache.editionEnCoursEvenement=false;this._cache.positionCreation=0;this._cache.listeValeursCreation=[];this._cache.finEditionCreation=null;clearTimeout(this._cache.rechercheTexte.timerSaisie);this._cache.collectionFuncConstructCellule={};clearTimeout(this._cache.timeoutResizeScroll);this._cache.timeoutResizeScroll=null;this._cache.delayTimeoutResizeScroll=null;_nettoyerElementsEditionEnCours.call(this);if(!GHtml.elementExiste(this.Nom)){return;}
if(this._options.avecModeAccessible&&GEtatUtilisateur.getModeAccessible()){_calculsPreRendu.call(this,lParams.ignorerCalculTri);return this._construireListeModeAccessible();}
let lSelections=null,lIdFocusARestaurer='',lFocusSurListe;if(!lParams.ignorerFocusListe&&GHtml.focusEstDansElement&&GHtml.focusEstDansElement(this.Nom)){lFocusSurListe=true;lIdFocusARestaurer=this.IdPremierElement;}
let lSelectionsPrecedente=null;if(this.Donnees){this.Donnees.setOptions({versionMobile:this.optionsInterne.versionMobile,nonEditable:_getNonEditable.call(this)});if(lParams.selections){lSelections=lParams.selections;} else if(lParams.conserverSelection){lSelections=_getCellulesSelection.call(this);} else{if(lParams.avecEvenementModificationSelection){lSelectionsPrecedente=_getCellulesSelection.call(this,true);}
this._cache.selectionCellule.ligne= -1;this._cache.selectionCellule.colonne= -1;this._cache.lignesSelectionnees=new Array(this.Donnees.GetNbrLignes());this._cache.lignesSelectionnees_prec=[];}
if(lParams.sansTriDonnees!==true){_trierDonnees.call(this);}
if(lFocusSurListe&&
lParams.conserverFocusSelection&&
this._cache.selectionCellule.ligne>=0&&
this._cache.selectionCellule.colonne>=0){lIdFocusARestaurer=this.getIdCellule(this._cache.selectionCellule.colonne,this._cache.selectionCellule.ligne)+'_div';}}
const lBackupScroll=this._backupScroll(lParams);_desabonnementResizeObserver.call(this);if(!lZonesActualisation){GHtml.setHtml(this.Nom,'',{ignorerScroll:true});this._cache.heightConteneur=Math.floor(GPosition.getClientRect(this.Nom,true).innerHeight);const lForcerNouveauTri=this.Donnees&&this._cache.calculsPreRenduAFaire&&lParams.ignorerCalculTri!==true&&lParams.sansTriDonnees!==true;_calculsPreRendu.call(this,lParams.ignorerCalculTri);if(lForcerNouveauTri){_trierDonnees.call(this);}}
let lAvecFiltreRecherche=!lParams.estFiltreRechercheTexte;if(lZonesActualisation){this._actualiserZones(lZonesActualisation,lParams);lAvecFiltreRecherche=lAvecFiltreRecherche&&lZonesActualisation.contenu;} else{let lCommentaireDebug='';GHtml.setHtml(this.Nom,this.ConstruireAffichage(lParams),{controleur:this.controleur,ignorerScroll:true,commentaireHtmlDebug:lCommentaireDebug});this._controleHeightLigne();}
_refreshContenuDynamique.call(this,{surInitialisation:true});this._setScroll(lBackupScroll);_refreshContenuDynamique.call(this,{avecBackupScroll:true,refreshRecursif:true,conserverPositionElement:lParams.conserverPositionElement});_abonnementResizeObserver.call(this);if(lIdFocusARestaurer){if(!GHtml.elementExiste(lIdFocusARestaurer)){lIdFocusARestaurer=this.IdPremierElement;}
GHtml.setFocus(lIdFocusARestaurer);}
if(Array.isArray(lSelections)){_setCellulesSelection.call(this,lSelections,{instancesIdentiques:lParams.instancesIdentiquesSelections,avecEvenement:lParams.avecEvenementSelection,avecScroll:lParams.avecScrollSelection,avecSelectionSurLigneInvisible:lParams.avecSelectionSurLigneInvisible,avecEvenementModificationSelection:lParams.avecEvenementModificationSelection});} else if(lParams.avecEvenementModificationSelection&&lSelectionsPrecedente&&lSelectionsPrecedente.length>0){_surModificationSelectionEvenement.call(this,lSelectionsPrecedente);}
if(this._options.piedDeListe&&
this._options.piedDeListe.getContenu&&
!lZonesActualisation){GHtml.setHtml(this.idPiedDeListe,'<div style="'+GStyle.composeHeight(this._options.piedDeListe.height)+
GStyle.composeWidth(this._cache.largeurTotalCalcule+1)+'margin-top:5px;overflow:hidden;">'+
this._options.piedDeListe.getContenu()+'</div>',{controleur:this._options.piedDeListe.controleur||this.controleur,ignorerScroll:true});}
if(this._cache.rechercheTexte.saisie||(lParams.estFiltreRechercheTexte&&!lParams.annulerRechercheTexte&&!lZonesActualisation)){_creerZoneRechercheTexte.call(this,!lZonesActualisation);} else if(!lParams.estFiltreRechercheTexte||lParams.annulerRechercheTexte){_supprimerZoneRechercheTexte.call(this);}
if(lAvecFiltreRecherche){_filtreRechercheTexte.call(this,lParams);}
this.$refreshSelf();}
function _abonnementResizeObserver(){_desabonnementResizeObserver.call(this);const lListeIdsResizeObs=[];this._getTabElementsPourRsizeObserver().forEach((aElement) =>{if(aElement){lListeIdsResizeObs.push({element:aElement,height:GPosition.getClientRect(aElement).height});}});if(lListeIdsResizeObs.length>0){this._cache.resizeObserverContenu=new ResizeObserver((aObservers) =>{if(aObservers){const lAvecActualisation=!lListeIdsResizeObs.every((aElement,aIndex) =>{const lHeight=(aObservers[aIndex]&&aObservers[aIndex].contentRect?(aObservers[aIndex].contentRect.height||0):0);if(lHeight>0&&(Math.abs(lHeight-aElement.height)>1)){return false;}
return true;});this._cache.delayTimeoutResizeScroll=null;clearTimeout(this._cache.timeoutResizeScroll);if(lAvecActualisation||this.optionsInterne.versionMobile){this._cache.positionsCelluleCadreSelection={};_actualiserCadreSelection.call(this);}
if(lAvecActualisation){this._controleHeightLigne();const lFunc=() =>{this._cache.timeoutResizeScroll=null;this._cache.delayTimeoutResizeScroll=null;this._setScroll(this._backupScroll({conserverPositionScroll:true}));if(this._options.callbackResizeObserverContenu){this._options.callbackResizeObserverContenu(this);}};if(!this.optionsInterne.versionMobile&&this._cache.refresh.surRefreshContenu){this._cache.timeoutResizeScroll=setTimeout(() =>{lFunc();},50);this._cache.delayTimeoutResizeScroll=() =>{clearTimeout(this._cache.timeoutResizeScroll);this._cache.timeoutResizeScroll=setTimeout(() =>{lFunc();},200);};} else{lFunc();}}}});lListeIdsResizeObs.forEach((aElement) =>{this._cache.resizeObserverContenu.observe(aElement.element);});}}
function _desabonnementResizeObserver(){if(this._cache.resizeObserverContenu){this._cache.resizeObserverContenu.disconnect();this._cache.resizeObserverContenu=null;}}
function _getHeightCellule(aParamsCellule,aPourHauteurContenu){let lHeight=0;if(aPourHauteurContenu){lHeight=this.Donnees.getHauteurMinContenuCellule(aParamsCellule);}
if(!lHeight){lHeight=this.Donnees.getHauteurMinCellule(aParamsCellule)||ObjetDonneesListe.hauteurMinCellule;}
return lHeight+(Support.bordureExterneTD?0:-1);}
function _afficherMessage(aParamsCellule){const LMessage=this.Donnees.GetMessage();if(LMessage){GApplication.getMessage().afficher({type:EGenreBoiteMessage.Information,message:LMessage});} else if(this.Donnees.AvecEtatSaisie(aParamsCellule)){this.SetEtatSaisie(true);}}
function _SurCreationEvenement(I,aParamsSupp){if(this.Donnees){if(this.Donnees.AvecEvenement_Creation(I)){if(this.Pere&&this.Evenement){const lResult=this.Evenement.call(this.Pere,_getParamsCallback.call(this,EGenreEvenementListe.Creation,I,null,Object.assign({listeValeursCreation:this._cache.listeValeursCreation},aParamsSupp)),EGenreEvenementListe.Creation,I,null);_refreshSelf.call(this);return lResult;}}}}
function _setOptionEvenementSurTri(){if(this._options.evenementSurTri&&
this._triCourant&&
this._triCourant.colonne&&
this._cache.colonnes.listeIds){const lTabTri=[];for(let i=0;i<this._triCourant.colonne.length;i++){lTabTri.push({numero:this._triCourant.colonne[i],id:this._cache.colonnes.listeIds[this._triCourant.colonne[i]],genre:this._triCourant.genre[i]});}
this._options.evenementSurTri(lTabTri);}}
function _setColonneTri(aColonne,aGenre,aNumeroTri){const lNumeroTri=aNumeroTri||0,lNumeroColonne=MethodesObjet.isString(aColonne)?this.getNumeroColonneDIdColonne(aColonne):aColonne,lNumeroAncienTri=this._triCourant.colonne.indexOf(lNumeroColonne);if(lNumeroAncienTri>=0&&lNumeroAncienTri!==lNumeroTri){this._triCourant.colonne[lNumeroAncienTri]=this._triCourant.colonne[lNumeroTri];}
this._triCourant.genre[lNumeroTri]=(aGenre!==null&&aGenre!==undefined)?aGenre:EGenreTriElement.Croissant;this._triCourant.colonne[lNumeroTri]=lNumeroColonne;_setOptionEvenementSurTri.call(this);this._cache.infosZonesColonnes.forEach((aInfosZoneColonnes) =>{$('#'+this.ids.curseurTriSurvol.escapeJQ()+aInfosZoneColonnes.indiceBloc).hide();for(let lITri=0;lITri<this._triCourant.nombreTri;lITri++){const lNode=GHtml.getElement(this.ids.curseurTri+aInfosZoneColonnes.indiceBloc+'_'+lITri);if(lNode){_positionnerCurseurTri.call(this,aInfosZoneColonnes,lNode,lITri);GHtml.setHtml(lNode,this._getDessinCurseurTri({triCroissant:this._triCourant.genre[lITri]===EGenreTriElement.Croissant,triPrincipal:lITri===0}),{instance:this,ignorerScroll:true});}}});return new Promise((aResolve) =>{setTimeout(aResolve,0);}).then(() =>{_actualiser.call(this,{conserverSelection:true,sansTriDonnees:false,ignorerCalculTri:true,zonesActualisation:{contenu:true}});});}
function _extraireInfosId(aId){if(!aId){return false;}
const lInfos={};const lIds=aId.split('_');if(lIds[lIds.length-1]==='div'){lInfos.ligne=parseInt(lIds[lIds.length-2],10);lInfos.colonne=parseInt(lIds[lIds.length-3],10);} else{lInfos.ligne=parseInt(lIds[lIds.length-1],10);lInfos.colonne=parseInt(lIds[lIds.length-2],10);}
return lInfos;}
function _focusSuivant(AId,AOrientation,ADirection){const LIdSuivant=this.getIdNavigationSuivant(AId,AOrientation,ADirection);if(LIdSuivant){GHtml.setFocus(LIdSuivant);if(this.Donnees.options.avecSelectionSurNavigationClavier){const lInfos=_extraireInfosId(LIdSuivant);if(lInfos){this.selectionnerCellule({ligne:lInfos.ligne,colonne:lInfos.colonne,deselectionnerTout:true,selectionner:true,avecEvenement:true});}}}}
function _evenementMenuContextuel(aParametres ,aLigne){const lParametres=Object.assign({ligneMenu:aLigne,numeroMenu:aLigne?aLigne.GetNumero():-1,avecActualisation:true},aParametres);if(aLigne){switch(aLigne.GetNumero()){case EGenreCommandeMenu.Creation:if(this._avecLigneCreationUnique){const LId=_getIdCreation.call(this,-1,-1);GHtml.setDisplay(LId+'_Creation',false);GHtml.setDisplay(LId+'_Creation_Edit',true);}
this._cache.positionCreation=0;_SurCreationDeb.call(this,false,{origine:'menucontextuel'});if(aLigne.data){if(this._cache.listeValeursCreation){this._cache.listeValeursCreation.data=aLigne.data;}}
break;case EGenreCommandeMenu.Edition:_SurEditionDeb.call(this,lParametres.colonne,lParametres.ligne);break;case EGenreCommandeMenu.Suppression:_surSuppression.call(this);break;default:{this.Donnees.evenementMenuContextuel(lParametres);if(lParametres.avecActualisation){_actualiser.call(this,{conserverSelection:true,zonesActualisation:{contenu:true,total:true}});}}}}}
function _SurSelectionEvenement(I,J,aSurClavier,aSurInteractionUtilisateur){const lParams=_getParamsCellule.call(this,I,J);if(this.Donnees&&(J> -1)){if(this.Donnees.AvecEvenement_Selection(lParams.colonne,lParams.article,lParams)){if(this.Pere&&this.Evenement){this.Evenement.call(this.Pere,_getParamsCallback.call(this,EGenreEvenementListe.Selection,I,J,{surClavier:aSurClavier,surInteractionUtilisateur:aSurInteractionUtilisateur===false?false:true}),EGenreEvenementListe.Selection,I,J);}}}
_refreshSelf.call(this);return true;}
function _surModificationSelectionEvenement(aSelectionsAncienne,aSurInteractionUtilisateur){if(!this.Donnees||!this.Donnees.options.avecEvnt_ModificationSelection){return false;}
const lSelectionCourante=_getCellulesSelection.call(this);if(aSelectionsAncienne&&lSelectionCourante&&aSelectionsAncienne.length===lSelectionCourante.length){const lIdentique=lSelectionCourante.every((aSelection,aIndex) =>{const lSelection=aSelectionsAncienne[aIndex];return aSelection.ligne===lSelection.ligne&&aSelection.article===lSelection.article&&MethodesObjet.objetsIdentiques(aSelection.colonnes,lSelection.colonnes);});if(lIdentique){return false;}}
if(this.Pere&&this.Evenement){this.Evenement.call(this.Pere,_getParamsCallback.call(this,EGenreEvenementListe.ModificationSelection,-1,-1,{cellulesSelection:lSelectionCourante,surInteractionUtilisateur:!!aSurInteractionUtilisateur}),EGenreEvenementListe.ModificationSelection,-1,-1);_refreshSelf.call(this);return true;}
return false;}
function _refreshSelf(){if(this.Pere&&this.Pere.$refresh){this.Pere.$refresh();} else{this.$refreshSelf();}}
function _SurSuppressionEvenement(aParams){let lResult=false;if(this.Donnees&&(aParams.ligne> -1||(aParams.listeSuppressions&&aParams.listeSuppressions.GetNbrElements()>0))){if(this.Donnees.AvecEvenement_Suppression(aParams.article,aParams)){if(this.Pere&&this.Evenement){lResult=true;this.Evenement.call(this.Pere,_getParamsCallback.call(this,EGenreEvenementListe.Suppression,aParams.colonne,aParams.ligne,aParams),EGenreEvenementListe.Suppression,aParams.colonne,aParams.ligne);}}}
_refreshSelf.call(this);return lResult;}
function _SurApresCreationEvenement(aLigne){if(!this.Donnees){return;}
const lParams=_getParamsCallback.call(this,EGenreEvenementListe.ApresCreation,null,aLigne);if(this.Donnees.AvecEvenement_ApresCreation(lParams)){if(this.Pere&&this.Evenement){const lResult=this.Evenement.call(this.Pere,lParams,EGenreEvenementListe.ApresCreation,null,null);_refreshSelf.call(this);return lResult;}}}
function _SurApresErreurCreationEvenement(){if(this.Donnees){if(this.Donnees.AvecEvenement_ApresErreurCreation()){if(this.Pere&&this.Evenement){const lResult=this.Evenement.call(this.Pere,_getParamsCallback.call(this,EGenreEvenementListe.ApresErreurCreation,null,null),EGenreEvenementListe.ApresErreurCreation,null,null);_refreshSelf.call(this);return lResult;}}}}
function _SurApresEditionEvenement(aParams){if(this.Donnees){if(this.Donnees.AvecEvenement_ApresEdition(aParams.ligne,aParams.colonne,aParams.article,aParams)){if(this.Pere&&this.Evenement){this.Evenement.call(this.Pere,_getParamsCallback.call(this,EGenreEvenementListe.ApresEdition,aParams.colonne,aParams.ligne,{avecModification:!!aParams.avecModification}),EGenreEvenementListe.ApresEdition,aParams.colonne,aParams.ligne);}}}
_refreshSelf.call(this);return true;}
function _SurApresSuppressionEvenement(aParams){if(this.Donnees){if(this.Donnees.AvecEvenement_ApresSuppression()){if(this.Pere&&this.Evenement){this.Evenement.call(this.Pere,_getParamsCallback.call(this,EGenreEvenementListe.ApresSuppression,aParams.colonne,aParams.ligne,aParams),EGenreEvenementListe.ApresSuppression,aParams.colonne,aParams.ligne);}}}
_refreshSelf.call(this);}
function _Entrer_Edition(){_nettoyerElementsEditionEnCours.call(this);this._setStyleCellule(this.IdCellule,null,null,false,true);}
function _getHTMLControleTexte(aParams){const lControle=this.Donnees.getControleCaracteresInput(aParams);let lIEMask='',lMaxLength='';if(lControle&&lControle.mask){lIEMask='ie-mask="/[^'+lControle.mask+']/i" ';}
if(lControle&&lControle.tailleMax>0&&lControle.tailleMax<this._options.maxLengthTextareaIgnore){lMaxLength='maxlength="'+lControle.tailleMax+'" ';}
if(!lMaxLength&&IEHtml.MAX_LENGTH_Default>0&&this.Donnees._GetTailleTexteMax(aParams)>IEHtml.MAX_LENGTH_Default){lMaxLength='maxlength="0" ';}
return lIEMask+lMaxLength;}
function _toString(aValeur){return aValeur+'';}
function _setValueModel(aParams){const lParams=Object.assign({node:null,ligne:-1,colonne:-1,surCreation:false,value:'',estNote:false},aParams);this._cache.avecModificationSaisie=true;if(this._fenetreInformationAffichee){return;}
if(lParams.surCreation){if(this._messageEnCoursSurCreation){return;}
if(!this._cache.creationEnCours){return;}
lParams.colonne=this._cache.numeroColonneCreationEnCours;lParams.ligne= -1;} else{if(!this._cache.editionEnCours&&!this.enEditionEvenement){return;}}
if(lParams.estNote){this._valeurEnEdition=lParams.value;return;}
this._valeurEnEdition=_toString(lParams.value);const lParamsCellule=_getParamsCellule.call(this,lParams.colonne,lParams.ligne,{surEdition:true,surLigneCreation:lParams.surCreation,surInputSaisie:true});const lControle=GChaine.controleTailleTexte({chaine:this._valeurEnEdition,tailleTexteMax:this.Donnees._GetTailleTexteMax(lParamsCellule)});if(!lControle.controleOK){this._valeurEnEdition=lControle.chaine;this._fenetreInformationAffichee=true;GApplication.getMessage().afficher({type:EGenreBoiteMessage.Information,message:this.Donnees.GetMessage_TailleMaximaleSaisie(lParams),callback:function(){this._fenetreInformationAffichee=false;GHtml.setFocus(lParams.node);}.bind(this)});}}
function _Entrer_Texte(aColonne,aLigne,aSurLigneCreation,aTypeCellule,aIgnorerEventsNode){const lParamsCellule=_getParamsCellule.call(this,aColonne,aLigne,{surEdition:true,surLigneCreation:aSurLigneCreation,surInputSaisie:true});let LValeur=this.Donnees._GetValeur(lParamsCellule),lClass='';const lEstNote=aTypeCellule===ObjetDonneesListe.ETypeCellule.Note;if(!lEstNote){LValeur=_toString(LValeur);}
this._valeurEnEdition=LValeur;try{lClass=this.Donnees.getClass(lParamsCellule,lParamsCellule.colonne,lParamsCellule.article);} catch(e){lClass=''
;}
const lHeight=_getHeightCellule.call(this,lParamsCellule),lBalise=lEstNote?'ie-inputnote':'input';const lEstCreationMobile=this.optionsInterne.versionMobile&&aSurLigneCreation;const lIgnorerEventsNode=lEstCreationMobile?true:aIgnorerEventsNode;const H=[];const lHeightCellule=$('#'+this.IdCellule.escapeJQ()).height();const lHtmlInput=['<',lBalise,' id="'+this.IdEdition+'"',' class="Texte10 Liste_Input_Texte '+(lClass||'')+'"',lEstCreationMobile?'':' style="border: 0px;"',GHtml.composeAttr('ie-model','liste.saisieTexte',[aLigne,aColonne,!!aSurLigneCreation,lEstNote,false,lIgnorerEventsNode]),(lEstNote?'':_getHTMLControleTexte.call(this,lParamsCellule)),(lEstNote?' autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"':''),(!aSurLigneCreation?'':' size="1"'),'></',lBalise,'>'
].join('');if(this.optionsInterne.versionMobile){if(lEstCreationMobile&&this.optionsInterne.surEditionTextFenetre_promise){return this.optionsInterne.surEditionTextFenetre_promise({html:lHtmlInput,surCreation:aSurLigneCreation,surInputText:true,colonne:aColonne});} else{H.push(tag('div',{style:lHeightCellule?'height:'+lHeightCellule+'px; line-height:'+lHeightCellule+'px;':''},lHtmlInput));}} else{H.push(tag('div',{style:`width: 100%; box-sizing: border-box; height:${lHeightCellule}px; line-height:${Math.min(lHeight,lHeightCellule)}px; padding: 0px ${this._options.paddingCelluleLR}px;`},lHtmlInput));}
GHtml.setHtml(this.IdCellule,H.join(''),{instance:this});}
function _getInfosZoneColonneDeNumeroColonne(aNumeroColonne){let lInfosZone=null;this._cache.infosZonesColonnes.every((aZone) =>{if(aNumeroColonne>=aZone.indiceColonneDebut&&aNumeroColonne<=aZone.indiceColonneFin){lInfosZone=aZone;return false;}
return true;});return lInfosZone||this._cache.infosZonesColonnes[this._cache.infosZonesColonnes.length-1];}
function _afficher_marqueurEditionSurCellule(aColonne,aLigne){const lJConteneur=$('#'+this.ids.zoneFils.escapeJQ());$('#'+this.ids.surligneur_edition.escapeJQ()).remove();const lFunc=function(){const lRectCellule=GPosition.getClientRect(this.getIdCellule(aColonne,aLigne));const lRectContenur=GPosition.getClientRect(this.ids.zoneFils);const lInfosZone=_getInfosZoneColonneDeNumeroColonne.call(this,aColonne);const lPremiereColonneBlocFixeDroite=lInfosZone.estBlocFixeDroite&&aColonne===lInfosZone.indiceColonneDebut;const lPos={top:lRectCellule.top-lRectContenur.top-2,left:lRectCellule.left+(lPremiereColonneBlocFixeDroite?1:0)-lRectContenur.left-2,height:lRectCellule.height+(this.optionsInterne.versionMobile?0:-1),width:lRectCellule.width+(this.optionsInterne.versionMobile?0:-1)};if(lPos.left+lPos.width>lRectContenur.width){lPos.width=Math.max(1,lPos.width-(lPos.left+lPos.width-lRectContenur.width+2));}
return lPos;}.bind(this);const lPos=lFunc();lJConteneur.IEHtmlAppend(['<div id="',this.ids.surligneur_edition,'" class="liste_surligneur_edition" style="',GStyle.composeWidth(lPos.width),GStyle.composeHeight(lPos.height),'top:'+lPos.top+'px;','left:'+lPos.left+'px;','">','</div>'].join(''));$('#'+this.ids.surligneur_edition.escapeJQ()).data('positionnement',{func:function(){const lPos=lFunc();$('#'+this.ids.surligneur_edition.escapeJQ()).css({left:lPos.left,top:lPos.top});}.bind(this)});}
function _Entrer_ZoneTexte(aColonne,aLigne,aSurLigneCreation,aNumeroLigneCreation,aIgnorerEventsNode){const lParamsCellule=_getParamsCellule.call(this,aColonne,aLigne,{surEdition:true,surLigneCreation:aSurLigneCreation,surInputSaisie:true,numeroLigneCreation:aNumeroLigneCreation});this._valeurEnEdition=this.Donnees._GetValeur(lParamsCellule);this._valeurEnEdition=_toString(this._valeurEnEdition);let lTailleMax=0;const lControle=this.Donnees.getControleCaracteresInput(lParamsCellule);if(lControle){lTailleMax=lControle.tailleMax||0;}
if(lTailleMax===0||!MethodesObjet.isNumber(lControle.tailleMax)){lTailleMax=this.Donnees._GetTailleTexteMax(lParamsCellule)||0;}
if(lTailleMax>=this._options.maxLengthTextareaIgnore||!MethodesObjet.isNumber(lTailleMax)){lTailleMax=0;}
const lIgnorerEventsNode=this.optionsInterne.versionMobile?true:aIgnorerEventsNode;const T=[];let lNomBalise=lTailleMax>0?'ie-textareamax':'textarea';lNomBalise='ie-textareamax';T.push('<',lNomBalise,' '+GHtml.composeAttr('ie-model','liste.saisieTexte',[aLigne,aColonne,!!aSurLigneCreation,false,true,lIgnorerEventsNode])+' id="'+this.IdEdition+'" class="liste_textarea" '+_getHTMLControleTexte.call(this,lParamsCellule)+(lTailleMax>0?' ie-compteurmax="'+lTailleMax+'"':'')+'></',lNomBalise,'>');const lInfosZone=_getInfosZoneColonneDeNumeroColonne.call(this,aColonne),lPremiereColonneBlocFixeDroite=lInfosZone.estBlocFixeDroite&&aColonne===lInfosZone.indiceColonneDebut,lEstLigneCreationTitre=aSurLigneCreation&&!(aNumeroLigneCreation>=0);if(this.optionsInterne.versionMobile&&this.optionsInterne.surEditionTextFenetre_promise){return this.optionsInterne.surEditionTextFenetre_promise({html:T.join(''),surCreation:aSurLigneCreation,colonne:aColonne});}
const lOffset=$('#'+this.IdCellule.escapeJQ()).offset();const lJConteneur=$('#'+this.ids.zoneFils.escapeJQ());const lOffsetConteneur=lJConteneur.offset();const lHeightConteneur=lJConteneur.height();const lPositionnement={width:GPosition.getWidth(this.IdCellule)+1+(lInfosZone.dernierBloc&&aColonne===lInfosZone.indiceColonneFin?1:0)+(lPremiereColonneBlocFixeDroite?-1:0),height:Math.max(Math.min(100,lHeightConteneur),GPosition.getHeight(this.IdCellule)+1),left:lOffset.left-1+(lPremiereColonneBlocFixeDroite?1:0)-lOffsetConteneur.left,top:lOffset.top+(lEstLigneCreationTitre?0:-1)-lOffsetConteneur.top};if(lOffset.top-lOffsetConteneur.top+lPositionnement.height>=lHeightConteneur){lPositionnement.top=Math.max(0,lPositionnement.top-(lOffset.top-lOffsetConteneur.top+lPositionnement.height-lHeightConteneur));}
lJConteneur.IEHtmlAppend(['<div id="'+this.IdZoneTexte+'" class="liste_saisie_textarea" style="',GStyle.composeWidth(lPositionnement.width),GStyle.composeHeight(lPositionnement.height),'top:'+lPositionnement.top+'px;','left:'+lPositionnement.left+'px;','">'+T.join('')+'</div>'
].join(''),{controleur:this.controleur});}
function _nettoyerElementsEditionEnCours(){$('#'+this.IdZoneTexte.escapeJQ()).remove();$('#'+this.ids.surligneur_edition.escapeJQ()).remove();if(this.fenetreDate){this.fenetreDate.Fermer();delete this.fenetreDate;}}
function _surSelection(aNumeroColonne,aNumeroLigne,aParams){if(this._cache.creationEnCours||this._cache.editionEnCours){return false;}
if(!this.Donnees){return false;}
const lParams=Object.assign({avecFocus:true,forcerMonoSelection:false,ctrlKey:false,shiftKey:false,avecEvenementModificationSelection:true,surInteractionUtilisateur:false},aParams);this._cache.lignesSelectionnees_prec=[...this._cache.lignesSelectionnees];const lSelections=lParams.avecEvenementModificationSelection?_getCellulesSelection.call(this,true):null;let iLigne,iColonne;const lAvecMultiSelection=this.Donnees.AvecMultiSelection()&&!lParams.forcerMonoSelection,lEstSelectionParCellule=_estSelectionParCellule.call(this,aNumeroLigne,aNumeroColonne),lMultiSelectionCtrl=lAvecMultiSelection&&(!this.Donnees.avecMultiSelectionSurCtrl()||lParams.ctrlKey),lMultiSelectionShift=lAvecMultiSelection&&(!this.Donnees.avecMultiSelectionSurShift()||lParams.shiftKey);if(!lMultiSelectionCtrl&&!lMultiSelectionShift){if(_etatSelectionCellule.call(this,{ligne:aNumeroLigne,colonne:aNumeroColonne,cacheSelection:this._cache.lignesSelectionnees_prec})&&this.Donnees._avecDeselection(aNumeroLigne,aNumeroColonne)&&!lAvecMultiSelection&&(lParams.ctrlKey||this.Donnees.options.avecDeselectionMonoSelectionClick)){_selectionner.call(this,{deselectionnerTout:true,selectionner:false,avecEvenementModificationSelection:true});this._cache.selectionCellule.ligne= -1;this._cache.selectionCellule.colonne= -1;this.Donnees._SurSelection(aNumeroLigne,aNumeroColonne,false);return;}
if(aNumeroColonne===this._cache.selectionCellule.colonne&&
aNumeroLigne===this._cache.selectionCellule.ligne&&
!lAvecMultiSelection&&
_etatSelectionCellule.call(this,{ligne:aNumeroLigne,colonne:aNumeroColonne})){return;}
this._cache.selectionCellule.ligne=aNumeroLigne;this._cache.selectionCellule.colonne=aNumeroColonne;_selectionner.call(this,{ligne:aNumeroLigne,colonne:aNumeroColonne,deselectionnerTout:true,selectionner:true,_avecVisuCadreSelection:false});} else if(lMultiSelectionShift){if(!this._cache.celluleClicNonShift||
this._cache.celluleClicNonShift.ligne<0||
this._cache.celluleClicNonShift.colonne<0){return;}
const lMinLigne=Math.min(aNumeroLigne,this._cache.celluleClicNonShift.ligne),lMaxLigne=Math.max(aNumeroLigne,this._cache.celluleClicNonShift.ligne);if(lEstSelectionParCellule){const lMinColonne=Math.min(aNumeroColonne,this._cache.celluleClicNonShift.colonne),lMaxColonne=Math.max(aNumeroColonne,this._cache.celluleClicNonShift.colonne);for(iLigne=0;iLigne<this._cache.lignesSelectionnees.length;iLigne++){for(iColonne=0;iColonne<this.ListeTailles.length;iColonne++){if(iColonne>=lMinColonne&&
iColonne<=lMaxColonne&&
iLigne>=lMinLigne&&
iLigne<=lMaxLigne&&
_estLigneVisible(this,iLigne)){if(!_etatSelectionCellule.call(this,{ligne:iLigne,colonne:iColonne})){_selectionner.call(this,{ligne:iLigne,colonne:iColonne,selectionner:true,_avecVisuCadreSelection:false});}} else if(_etatSelectionCellule.call(this,{ligne:iLigne,colonne:iColonne})&&
this.Donnees._avecDeselection(iLigne,iColonne)){_selectionner.call(this,{ligne:iLigne,colonne:iColonne,selectionner:false,_avecVisuCadreSelection:false});}}}} else{for(iLigne=0;iLigne<this._cache.lignesSelectionnees.length;iLigne++){if(iLigne>=lMinLigne&&
iLigne<=lMaxLigne&&
_estLigneVisible(this,iLigne)){_selectionner.call(this,{ligne:iLigne,selectionner:true,_avecVisuCadreSelection:false});} else if(_etatSelectionCellule.call(this,{ligne:iLigne})&&
this.Donnees._avecDeselection(iLigne,aNumeroColonne)){_selectionner.call(this,{ligne:iLigne,selectionner:false,_avecVisuCadreSelection:false});}}}} else if(lMultiSelectionCtrl){const lNumeroColonneTraite=lEstSelectionParCellule?aNumeroColonne:-1;if(_etatSelectionCellule.call(this,{ligne:aNumeroLigne,colonne:lNumeroColonneTraite})){_selectionner.call(this,{ligne:aNumeroLigne,colonne:aNumeroColonne,selectionner:false,_avecVisuCadreSelection:false});this._cache.selectionCellule.ligne= -1;this._cache.selectionCellule.colonne= -1;} else{_selectionner.call(this,{ligne:aNumeroLigne,colonne:aNumeroColonne,selectionner:true,_avecVisuCadreSelection:false});this._cache.selectionCellule.ligne=aNumeroLigne;this._cache.selectionCellule.colonne=aNumeroColonne;}}
_actualiserCadreSelection.call(this);this.Donnees._SurSelection(this._cache.selectionCellule.colonne,this._cache.selectionCellule.ligne,true);if(lParams.avecFocus){const lNumeroColonne=aNumeroColonne>-1?aNumeroColonne:0;if(_estLigneDansRangeNonConstruitDyn.call(this,aNumeroLigne)){_scrollSurSelection.call(this,lNumeroColonne,aNumeroLigne);}
GHtml.setFocus(this.getIdCellule(lNumeroColonne,aNumeroLigne)+'_div');}
if(lParams.avecEvenementModificationSelection){_surModificationSelectionEvenement.call(this,lSelections,lParams.surInteractionUtilisateur);}
return true;}
function _celluleAvecBordureDroite(aListe,aEstDerniereColonne){return!aEstDerniereColonne&&aListe._options.borduresCellule_horizontal>0;}
function _getFusionColonnesCellule(aParametres){const lFusion={},lHash={};let lNumeroColonneFusionEnCoursPrec=null,lParamsCellule,lDerniereColonne,lNumeroColonneFusion,lNumeroColonneReferenceFusion=aParametres.colonnesVisibles[0];const lTailles=aParametres.tailles||this._cache.taillesColonne;aParametres.colonnesVisibles.forEach((aNumeroColonne) =>{if(aParametres.total){lParamsCellule=aParametres.getParamsCellule(aNumeroColonne,{colonnesVisibles:aParametres.colonnesVisibles});} else{lParamsCellule=_getParamsCellule.call(this,aNumeroColonne,aParametres.ligne,{colonnesVisibles:aParametres.colonnesVisibles});}
if(aParametres.total){lNumeroColonneFusion=this.Donnees.getColonneDeFusionTotal(lParamsCellule);} else{lNumeroColonneFusion=this.Donnees.getColonneDeFusion(lParamsCellule);}
if(lNumeroColonneFusion===undefined||lNumeroColonneFusion===null){lNumeroColonneFusion=aNumeroColonne;} else if(MethodesObjet.isString(lNumeroColonneFusion)){lNumeroColonneFusion=this.getNumeroColonneDIdColonne(lNumeroColonneFusion);} else if(!MethodesObjet.isNumber(lNumeroColonneFusion)){lNumeroColonneFusion=aNumeroColonne;}
if(lNumeroColonneFusion!==aNumeroColonne&&!_estColonneVisible.call(this,lNumeroColonneFusion)){GLog.addLog('[_getFusionColonnesCellule] la colonne de fusion est invisible');lNumeroColonneFusion=aNumeroColonne;}
if(lNumeroColonneFusion!==aNumeroColonne&&(lNumeroColonneFusion>aParametres.indiceColonneFin||lNumeroColonneFusion<aParametres.indiceColonneDebut)){GLog.addLog('[_getFusionColonnesCellule] la colonne de fusion est hors du bloc');lNumeroColonneFusion=lNumeroColonneFusion>aParametres.indiceColonneFin?aParametres.indiceColonneFin:aParametres.indiceColonneDebut;}
if(lNumeroColonneFusionEnCoursPrec!==null&&lNumeroColonneFusion<lNumeroColonneFusionEnCoursPrec){GLog.addLog('[_getFusionColonnesCellule] erreur getColonneDeFusion sur colonne '+aNumeroColonne);Object.keys(lHash).forEach((aCle) =>{if(lHash[aCle]===lNumeroColonneFusionEnCoursPrec){lHash[aCle]=parseInt(aCle,10);}});}
if(lNumeroColonneFusion===aNumeroColonne&&
aNumeroColonne>0&&
!aParametres.total&&
this.Donnees.fusionCelluleAvecColonnePrecedente(lParamsCellule,lParamsCellule.colonne,lParamsCellule.article)){lNumeroColonneFusion=lNumeroColonneReferenceFusion;} else{lNumeroColonneReferenceFusion=aNumeroColonne;}
lHash[aNumeroColonne]=lNumeroColonneFusion;lNumeroColonneFusionEnCoursPrec=lNumeroColonneFusion;});aParametres.colonnesVisibles.forEach((aNumeroColonne) =>{const lColPrimaire=lHash[aNumeroColonne];if(!lFusion[lColPrimaire]){lFusion[lColPrimaire]={nbCol:0,taille:parseInt(lTailles[lColPrimaire].px,10),debut:lColPrimaire,fin:lColPrimaire};}
lFusion[lColPrimaire].nbCol+=1;if(lColPrimaire!==aNumeroColonne){lDerniereColonne=aParametres.indiceColonneFin===aNumeroColonne&&aParametres.dernierBloc;lFusion[lColPrimaire].taille+=parseInt(lTailles[aNumeroColonne].px,10)+2*this._options.paddingCelluleLR+(_celluleAvecBordureDroite(this,lDerniereColonne)?1:0);lFusion[lColPrimaire].debut=Math.min(aNumeroColonne,lFusion[lColPrimaire].debut);lFusion[lColPrimaire].fin=Math.max(aNumeroColonne,lFusion[lColPrimaire].fin);}});return lFusion;}
function _setCadreSelection_interne(aParams,aArrayTraitements){if(!aParams.selection&&(!aParams.posCellulePrec||!aParams.posCellulePrec.selection)){return;}
const lElement=GHtml.getElement(aParams.idCellule);if(lElement){this._setStyleCellule(lElement,aParams.colonne,aParams.ligne,aParams.selection);}
let lNumeroColonne;const lIdSelecCellule=this.ids.cadreSelection+'_sel_'+aParams.ligne+'_'+aParams.colonne;let lPositionCache=this._cache.positionsCelluleCadreSelection[aParams.ligne]?this._cache.positionsCelluleCadreSelection[aParams.ligne][aParams.colonne]:null;if(aParams.selection){if(!this._cache.positionsCelluleCadreSelection[aParams.ligne]){this._cache.positionsCelluleCadreSelection[aParams.ligne]={};}
if(!this._cache.positionsCelluleCadreSelection[aParams.ligne][aParams.colonne]){let lParamsCellule;try{const lIndexLigne=this._cache.lignesVisibles.indexOf(aParams.ligne);lParamsCellule=_getParamsCellule.call(this,aParams.colonne,aParams.ligne,{celluleLignePrecedente:lIndexLigne>0?_getParamsCellule.call(this,aParams.colonne,this._cache.lignesVisibles[lIndexLigne-1]):null,celluleLigneSuivante:lIndexLigne>=0&&lIndexLigne+1<this._cache.lignesVisibles.length?_getParamsCellule.call(this,aParams.colonne,this._cache.lignesVisibles[lIndexLigne+1]):null});} catch(e){lParamsCellule=null;}
let lModifHeight=0;const lNode=GHtml.getElement(aParams.idCellule);if(!lNode){$('#'+lIdSelecCellule.escapeJQ()).remove();return;}
if(!this.optionsInterne.versionMobile){if(this.Donnees&&this._options.borduresCellule_vertical>0&&lParamsCellule&&!this.Donnees.avecBordureBas(lParamsCellule)){lModifHeight+=this._options.borduresCellule_vertical;} else{lModifHeight=GStyle.getFloatComputedValue(lNode,'border-bottom-width');}}
const lRect=GPosition.getRect(lNode,true);let lRectScroll={top:0,left:0};const lConteneurSel=GHtml.getElement(this.ids.cadreSelection+aParams.bloc.indiceBloc);if(lConteneurSel){lRectScroll=GPosition.getRect(lConteneurSel,true);}
this._cache.positionsCelluleCadreSelection[aParams.ligne][aParams.colonne]={top:lRect.top-lRectScroll.top,left:lRect.left-lRectScroll.left,height:lRect.height-lModifHeight,width:lRect.width};lPositionCache=this._cache.positionsCelluleCadreSelection[aParams.ligne][aParams.colonne];}}
if(lPositionCache){lPositionCache.selection=!!aParams.selection;}
if(aParams.selection){let lBloc;const lFusionLigneIdentique=function(aColonne){if(!this._cache.lignesFusionParColonne[aColonne+'_'+aParams.ligne]&&!this._cache.lignesFusionParColonne[aParams.colonne+'_'+aParams.ligne]){return true;}
if(this._cache.lignesFusionParColonne[lNumeroColonne+'_'+aParams.ligne]&&this._cache.lignesFusionParColonne[aParams.colonne+'_'+aParams.ligne]&&this._cache.lignesFusionParColonne[aParams.colonne+'_'+aParams.ligne].ligneOrigine===this._cache.lignesFusionParColonne[aParams.colonne+'_'+aParams.ligne].ligneOrigine){return true;}
return false;};const lFusions=_getFusionColonnesCellule.call(this,{colonnesVisibles:aParams.bloc.colonnesVisibles,ligne:aParams.ligne,indiceColonneDebut:aParams.bloc.indiceColonneDebut,indiceColonneFin:aParams.bloc.indiceColonneFin,dernierBloc:aParams.bloc.dernierBloc||(!aParams.bloc.dernierBloc&&!aParams.bloc.estBlocFixe)});let lIndiceCol=aParams.bloc.colonnesVisibles.indexOf(lFusions[aParams.colonne].debut);lNumeroColonne=aParams.bloc.colonnesVisibles[lIndiceCol-1];if(lIndiceCol===0){lBloc=this._cache.infosZonesColonnes[aParams.bloc.indiceBloc-1];if(lBloc){lNumeroColonne=lBloc.colonnesVisibles[lBloc.colonnesVisibles.length-1];}}
lPositionCache.selColPrec=(aParams.bloc.indiceBloc>0||aParams.colonne>aParams.bloc.colonnesVisibles[0])&&lFusionLigneIdentique.call(this,lNumeroColonne)&&_etatSelectionCellule.call(this,{ligne:aParams.ligne,colonne:lNumeroColonne})&&this.Donnees._AvecSelection(lNumeroColonne,aParams.ligne);lIndiceCol=aParams.bloc.colonnesVisibles.indexOf(lFusions[aParams.colonne].fin);lNumeroColonne=aParams.bloc.colonnesVisibles[lIndiceCol+1];if(lIndiceCol>=aParams.bloc.colonnesVisibles.length-1){lBloc=this._cache.infosZonesColonnes[aParams.bloc.indiceBloc+1];if(lBloc){lNumeroColonne=lBloc.colonnesVisibles[0];}}
lPositionCache.selColSuivante=(!aParams.bloc.dernierBloc||aParams.colonne<aParams.bloc.colonnesVisibles[aParams.bloc.colonnesVisibles.length-1])&&lFusionLigneIdentique.call(this,lNumeroColonne)&&_etatSelectionCellule.call(this,{ligne:aParams.ligne,colonne:lNumeroColonne})&&this.Donnees._AvecSelection(lNumeroColonne,aParams.ligne);if(aParams.posCellulePrec&&aParams.posCellulePrec.selection&&aParams.posCellulePrec.selColPrec===lPositionCache.selColPrec&&aParams.posCellulePrec.selColSuivante===lPositionCache.selColSuivante){return;}
const lStyle=GStyle.composeWidth(lPositionCache.width+(lPositionCache.selColPrec?1:0)+(lPositionCache.selColSuivante?1:0))+'left:'+((lPositionCache.selColPrec?-1:0))+'px;';const lId=this.ids.cadreSelection+aParams.bloc.indiceBloc;$('#'+lIdSelecCellule.escapeJQ()).remove();aArrayTraitements.cacheHTML[lId]=(aArrayTraitements.cacheHTML[lId]||'')+
tag('div',{class:"liste_ligneSelection",id:lIdSelecCellule,style:'top:'+lPositionCache.top+'px;'+'left:'+lPositionCache.left+'px;'},!lPositionCache.selColPrec?tag('div',{class:"liste_ligneSelection_g",style:GStyle.composeHeight(lPositionCache.height)}):'',tag('div',{class:"liste_ligneSelection_h",style:lStyle}),!lPositionCache.selColSuivante?tag('div',{class:"liste_ligneSelection_d",style:'left:'+(lPositionCache.width-2)+'px;'+GStyle.composeHeight(lPositionCache.height)}):'',tag('div',{class:"liste_ligneSelection_b",style:'top:'+(lPositionCache.height-2)+'px;'+lStyle}));} else{if(aParams.posCellulePrec&&aParams.posCellulePrec.selection){$('#'+lIdSelecCellule.escapeJQ()).remove();}}}
function _actualiserCadreSelection(){if(this._options.avecCadreSelection){_getTraitementsAffichageSelection.call(this).forEach((aTraitement,aIndex,aArray) =>{_setCadreSelection.call(this,aTraitement,aIndex,aArray);});}}
function _setCadreSelection(aParams,aIndexTraitement,aArrayTraitements){if(aIndexTraitement===0){aArrayTraitements.cacheHTML={};}
_setCadreSelection_interne.call(this,aParams,aArrayTraitements);if(aIndexTraitement>=aArrayTraitements.length-1){for(const lKey in aArrayTraitements.cacheHTML){const lElementBloc=GHtml.getElement(lKey);if(lElementBloc){lElementBloc.innerHTML+=aArrayTraitements.cacheHTML[lKey];}}}}
function _etatSelectionCellule(aParametres,aSelectionne){const lParametres=Object.assign({ligne:-1,colonne:-1,cacheSelection:this._cache.lignesSelectionnees},aParametres);if(arguments.length>1){if(aSelectionne){if(lParametres.colonne>=0&&!this.Donnees._AvecSelection(lParametres.colonne,lParametres.ligne)){return;}
if(!lParametres.cacheSelection[lParametres.ligne]){lParametres.cacheSelection[lParametres.ligne]=[];}
if(lParametres.colonne<0){for(let i=0;i<this.ListeTailles.length;i++){lParametres.cacheSelection[lParametres.ligne][i]=true;}} else{lParametres.cacheSelection[lParametres.ligne][lParametres.colonne]=aSelectionne;}} else{if(!lParametres.cacheSelection[lParametres.ligne]){return;}
if(lParametres.colonne<0){delete lParametres.cacheSelection[lParametres.ligne];return;}
lParametres.cacheSelection[lParametres.ligne][lParametres.colonne]=false;if(lParametres.cacheSelection[lParametres.ligne].every((aColonne) =>{return aColonne!==true;})){delete lParametres.cacheSelection[lParametres.ligne];}}} else{if(!lParametres.cacheSelection[lParametres.ligne]){return false;}
if(lParametres.colonne<0){return!!lParametres.cacheSelection[lParametres.ligne];}
return!!lParametres.cacheSelection[lParametres.ligne][lParametres.colonne];}}
function _getTraitementsAffichageSelection(){const lTraitements=[];this._cache.infosZonesColonnes.forEach((aInfosZoneColonnes) =>{this._cache.lignesVisibles.forEach((aLigne) =>{if(this.Donnees.Donnees.GetElement(aLigne)){aInfosZoneColonnes.colonnesVisibles.forEach((aNumeroColonne) =>{const lPosCellule=this._cache.positionsCelluleCadreSelection[aLigne]&&this._cache.positionsCelluleCadreSelection[aLigne][aNumeroColonne]?this._cache.positionsCelluleCadreSelection[aLigne][aNumeroColonne]:null;const lTraitement={bloc:aInfosZoneColonnes,ligne:aLigne,colonne:aNumeroColonne,idCellule:this.getIdCellule(aNumeroColonne,aLigne),selection:!!_etatSelectionCellule.call(this,{ligne:aLigne,colonne:aNumeroColonne})&&!!this.Donnees._AvecSelection(aNumeroColonne,aLigne),posCellulePrec:Object.assign({},lPosCellule)};lTraitements.push(lTraitement);});}});});return lTraitements;}
function _selectionner(aParametres){if(!this.Donnees){return;}
const lParametres=Object.assign({ligne:-1,colonne:-1,selectionner:true,avecScroll:false,avecEvenement:false,deselectionnerTout:false,avecFocusCellule:false,_avecVisuCadreSelection:true,avecEvenementModificationSelection:false},aParametres);let lLigne,lColonne,lNumeroColonne=lParametres.colonne,lTrouverLignePourScroll=false;const lEstSelectionParCellule=_estSelectionParCellule.call(this,lParametres.ligne,lNumeroColonne),lAvecMultiSelection=this.Donnees.AvecMultiSelection(),lCelluleAvecSelection=lParametres.ligne>=0?this.Donnees._AvecSelection(lParametres.colonne,lParametres.ligne):true;if(lParametres.selectionner&&
lEstSelectionParCellule&&
!lCelluleAvecSelection){return;}
if(!lEstSelectionParCellule){lNumeroColonne= -1;}
if(lParametres.selectionner&&
lParametres.ligne> -1&&
!lAvecMultiSelection&&
!lParametres._surMultiSelectionMiroir){if(lParametres.deselectionnerTout===false){lParametres.deselectionnerTout=true;} else if(lParametres.deselectionnerTout&&
!lCelluleAvecSelection&&
lParametres.ligne>=0&&
!this.Donnees.options.avecDeselectionSurNonSelectionnable){lParametres.deselectionnerTout=false;}}
const lSelectionsPrecedente=lParametres.avecEvenementModificationSelection?_getCellulesSelection.call(this,true):null;if(lParametres.deselectionnerTout){let lAvecDeselectionCellule=false;for(lLigne=0;lLigne<this._cache.lignesSelectionnees.length;lLigne++){if(lEstSelectionParCellule){for(lColonne=0;lColonne<this.ListeTailles.length;lColonne++){if(_etatSelectionCellule.call(this,{ligne:lLigne,colonne:lColonne})){if(lLigne!==lParametres.ligne||lColonne!==lNumeroColonne){lAvecDeselectionCellule=true;}
_selectionner.call(this,{ligne:lLigne,colonne:lColonne,selectionner:false,_avecVisuCadreSelection:false});}}} else{if(_etatSelectionCellule.call(this,{ligne:lLigne})){if(lLigne!==lParametres.ligne){lAvecDeselectionCellule=true;}
_selectionner.call(this,{ligne:lLigne,selectionner:false,_avecVisuCadreSelection:false});}}}
if(lAvecDeselectionCellule&&lAvecMultiSelection){this._cache.lignesSelectionnees_prec=[];}}
let lOldlignesSelection=null;if(lParametres.ligne> -1){lOldlignesSelection=[...this._cache.lignesSelectionnees];if(!lParametres.selectionner&&lNumeroColonne=== -1){_etatSelectionCellule.call(this,{ligne:lParametres.ligne,colonne:lNumeroColonne},lParametres.selectionner);}
this._cache.infosZonesColonnes.forEach((aInfosZoneColonnes) =>{this.Donnees.Donnees.parcourir((aElementLigne,aLigne) =>{if(aElementLigne){const lEstLigneVisible=_estLigneVisible(this,aLigne);aInfosZoneColonnes.colonnesVisibles.forEach((aNumeroColonne) =>{if(!_estColonneVisible.call(this,aNumeroColonne)||!this.Donnees._AvecSelection(aNumeroColonne,aLigne)){return;}
if(lParametres.selectionner&&lParametres.ligne===aLigne&&!lEstLigneVisible){require('IELog.js').addLog('MMh ? selection de ligne invisible ? voir fv');return;}
if(lParametres.ligne===aLigne&&(lNumeroColonne=== -1||lNumeroColonne===aNumeroColonne)){_etatSelectionCellule.call(this,{ligne:lParametres.ligne,colonne:aNumeroColonne},lParametres.selectionner);} else if(!lEstSelectionParCellule&&this.Donnees.options.avecMultiSelectionSurLigneFusion&&lParametres.ligne!==aLigne&&lParametres.colonne>=0){let lAvecModif=false;let lFusionCellule;lFusionCellule=this._cache.lignesFusionParColonne[lParametres.colonne+'_'+lParametres.ligne];if(lFusionCellule&&lFusionCellule.lignesCumuls&&lFusionCellule.lignesCumuls[aLigne]){lAvecModif=true;}
if(!lAvecModif){lFusionCellule=this._cache.lignesFusionParColonne[aNumeroColonne+'_'+aLigne];if(lFusionCellule&&lFusionCellule.lignesCumuls&&lFusionCellule.lignesCumuls[lParametres.ligne]){lAvecModif=true;}}
if(lAvecModif){_etatSelectionCellule.call(this,{ligne:aLigne,colonne:aNumeroColonne},lParametres.selectionner);}}});}});});if(lParametres.selectionner&&!lParametres._surMultiSelectionMiroir){this._cache.selectionCellule.ligne=lParametres.ligne;this._cache.selectionCellule.colonne=lParametres.colonne;}
if(lNumeroColonne<0&&!lParametres._surMultiSelectionMiroir){this.Donnees._SurSelectionLigne(lParametres.ligne,lParametres.selectionner);}}
if(!lEstSelectionParCellule&&lParametres.ligne>=0&&!lParametres._surMultiSelectionMiroir&&this.Donnees.options.avecRechercheSelectionMiroir){const lParamsCellule=_getParamsCellule.call(this,lParametres.colonne,lParametres.ligne,{selectionner:lParametres.selectionner});if(lParamsCellule.article){this.Donnees.Donnees.parcourir((aElement,aLigne) =>{if(aLigne!==lParametres.ligne&&aElement){const lParamsCelluleCible=_getParamsCellule.call(this,lParametres.colonne,aLigne,{estLigneVisible:_estLigneVisible(this,aLigne)});if(this.Donnees.estSelectionCibleMiroirDeSelectionSource(lParamsCellule,lParamsCelluleCible)){_selectionner.call(this,{ligne:aLigne,colonne:-1,selectionner:lParametres.selectionner,_avecVisuCadreSelection:lParametres._avecVisuCadreSelection,_surMultiSelectionMiroir:true});}}});}}
let lTraitements=null;if(this._options.avecCadreSelection&&lParametres._avecVisuCadreSelection){lTraitements=_getTraitementsAffichageSelection.call(this);lTraitements.forEach((aTraitement,aIndex,aArray) =>{_setCadreSelection.call(this,aTraitement,aIndex,aArray);});}
if(lParametres.ligne> -1){let lLignePourScroll=Number.MAX_VALUE;let lColonnePourScroll=0;if(!lTraitements&&lOldlignesSelection&&(!this._options.avecCadreSelection||(lParametres.selectionner&&lParametres.avecScroll))){lTraitements=_getTraitementsAffichageSelection.call(this);}
if(lTraitements){lTraitements.forEach((aTraitement) =>{const lOldSelec=lOldlignesSelection[aTraitement.ligne]?!!lOldlignesSelection[aTraitement.ligne][aTraitement.colonne]:false;if(lOldSelec!==aTraitement.selection){if(!this._options.avecCadreSelection){const lElement=GHtml.getElement(aTraitement.idCellule);if(lElement){this._setStyleCellule(lElement,aTraitement.colonne,aTraitement.ligne,aTraitement.selection);}}
if(lParametres.selectionner&&lParametres.avecScroll&&aTraitement.ligne<lLignePourScroll){lLignePourScroll=aTraitement.ligne;lColonnePourScroll=aTraitement.colonne;lTrouverLignePourScroll=true;}}});}
if(lParametres.avecFocusCellule&&lParametres.colonne>=0){const lIdCellule=this.getIdCellule(lParametres.colonne,lParametres.ligne)+'_div';const lElementFocus=GHtml.getElement(lIdCellule);if(GHtml.estElement(lElementFocus)){GHtml.setFocus(lElementFocus,true,0);} else if(this._cache.refresh.avecConstructionDynamiqueContenu){_scrollSurSelection.call(this,lParametres.colonne,lParametres.ligne);GHtml.setFocus(lIdCellule,true,0);}}
if(lParametres.selectionner&&lParametres.avecScroll&&lTrouverLignePourScroll){_scrollSurSelection.call(this,lColonnePourScroll,lLignePourScroll);}}
if(lParametres.avecEvenementModificationSelection){_surModificationSelectionEvenement.call(this,lSelectionsPrecedente);}
if(lParametres.avecEvenement&&lParametres.selectionner){_SurSelectionEvenement.call(this,-1,lParametres.ligne,false,false);}
_refreshSelf.call(this);}
function _estCellulePrecedemmentSelectionnee(aColonne,aLigne){if(!this._cache.lignesSelectionnees_prec){return false;}
if(_etatSelectionCellule.call(this,{ligne:aLigne,colonne:aColonne,cacheSelection:this._cache.lignesSelectionnees_prec})){return true;}
const lInfosFusion=this._cache.lignesFusionParColonne[aColonne+'_'+aLigne];if(lInfosFusion&&lInfosFusion.lignesCumuls){for(const lLigne in lInfosFusion.lignesCumuls){if(_etatSelectionCellule.call(this,{ligne:lLigne,colonne:aColonne,cacheSelection:this._cache.lignesSelectionnees_prec})){return true;}}}
return false;}
function _avecEditionApresSelection(aParamsCellule){let lParamsCellule=aParamsCellule;let lNumeroColonne=lParamsCellule.colonne;if(lNumeroColonne&&MethodesObjet.isString(lNumeroColonne)){lNumeroColonne=this.getNumeroColonneDIdColonne(lNumeroColonne);}
if(lNumeroColonne<0||!MethodesObjet.isNumber(lNumeroColonne)){lParamsCellule=_getParamsCellule.call(this,lNumeroColonne,lParamsCellule.ligne,{surEdition:true});}
lParamsCellule.typeValeur=this.Donnees.GetTypeValeur(lParamsCellule,lParamsCellule.colonne,lParamsCellule.article);return this.Donnees.avecEditionApresSelection(lParamsCellule);}
function _editionDebSurSelection(aColonne,aLigne,aEvent){if(this._cache.creationEnCours||this._cache.editionEnCours){return;}
const lParams=_getParamsCellule.call(this,aColonne,aLigne,{surEdition:true});if(this.Donnees&&(aLigne> -1)){if(this.Donnees.AvecEvenement_SelectionClick(aColonne,lParams.article,lParams)){if(this.Pere&&this.Evenement){const lResult=this.callback.appel(_getParamsCallback.call(this,EGenreEvenementListe.SelectionClick,aColonne,aLigne),EGenreEvenementListe.SelectionClick,aColonne,aLigne);_refreshSelf.call(this);if(lResult){return;}}}}
if(aEvent&&(aEvent.type==='click'||aEvent.type==='mouseup')&&(aEvent.ctrlKey===true||aEvent.shiftKey===true)){return;}
if(!_avecEditionApresSelection.call(this,lParams)||!this.Donnees._AvecSelection(aColonne,aLigne)||_estCellulePrecedemmentSelectionnee.call(this,aColonne,aLigne)||this.Donnees.avecSelecFile(lParams)){_SurEditionDeb.call(this,aColonne,aLigne);}}
function _ajouterElementCreation(aLibelle,aValeurCreation){if(aLibelle){if(_getNonEditable.call(this)){return;}
if(!this._cache.creationEnCours){this._cache.creationEnCours=true;this._cache.creationEnCoursEvenement=false;}
this._cache.listeValeursCreation[-1]=aValeurCreation;if(this._cache.positionCreation===0){this._cache.numeroColonneCreationEnCours=this.ListeCreations[this._cache.positionCreation++];}
_SurCreation.call(this,aLibelle);} else{_annulerCreation.call(this);}
return this;}
function _surLigneCreationUnique(aSurClick,aLigne,aSurToucheEdition){const lParams=_getParamsCellule.call(this,-1,aLigne,{surCreation:true}),lAvecInputFile=this.Donnees&&this.Donnees.avecSelecFile(lParams);if(lAvecInputFile&&this._cache.ouvrirSelecteurFileParLigne[aLigne+'_-1' ]){this._cache.ouvrirSelecteurFileParLigne[aLigne+'_-1']();return;}
if(!aSurClick&&!aSurToucheEdition){return;}
const LId=_getIdCreation.call(this,-1,aLigne);GHtml.setDisplay(LId+'_Creation',false);GHtml.setDisplay(LId+'_Creation_Edit',true);_SurCreationDeb.call(this,false,{numeroLigneCreation:aLigne});}
function _SurCreationDeb(ASuivant,aParams){const lParamsCreation=Object.assign({origine:null,numeroLigneCreation:-1,idCellule:null,ignorerEventsNode:false},aParams);if(_getNonEditable.call(this)||!this.Donnees){return;}
if(this._cache.positionCreation===0){this._cache.listeValeursCreation=[];}
let lInterrompreCreation=false;if(!this._cache.creationEnCours||ASuivant){this._cache.numeroColonneCreationEnCours=this.ListeCreations[this._cache.positionCreation++];const lParams=_getParamsCellule.call(this,this._cache.numeroColonneCreationEnCours,-1,{surLigneCreation:true,surEdition:true});this._cache.creationEnCoursEvenement=_SurCreationEvenement.call(this,lParams.colonne);if(this._cache.creationEnCoursEvenement===EGenreEvenementListe.Creation){lInterrompreCreation=true;} else if(lParamsCreation.origine!=='menucontextuel'&&this._cache.positionCreation===1&&this.Donnees.AvecMenuContextuel(lParams)){this._cache.positionCreation=0;this._ouvrirMenuContextuel(lParams);lInterrompreCreation=true;}
if(lInterrompreCreation){const LId=_getIdCreation.call(this,-1,lParams.ligne);GHtml.setDisplay(LId+'_Creation_Edit',false);GHtml.setDisplay(LId+'_Creation',true);return;}
_surSelection.call(this,-1,-1,{avecFocus:false});this._cache.creationEnCours=true;this.IdCellule=lParamsCreation.idCellule||_getIdCreation.call(this,_colonneCreationUniqueEnErreur.call(this)?0:this._cache.numeroColonneCreationEnCours,this._cache.numeroLigneCreationDynamique===null||this._cache.numeroLigneCreationDynamique===undefined?-1:this._cache.numeroLigneCreationDynamique);_Entrer_Edition.call(this);const lType=this.Donnees.GetTypeValeur(lParams,lParams.colonne,lParams.article);switch(lType){case ObjetDonneesListe.ETypeCellule.ZoneTexte:_Entrer_ZoneTexte.call(this,lParams.colonne,undefined,true ,lParamsCreation.numeroLigneCreation,lParamsCreation.ignorerEventsNode);break;default:_Entrer_Texte.call(this,lParams.colonne,undefined,true,lType,lParamsCreation.ignorerEventsNode);break;}
if(!this._cache.creationEnCoursEvenement){GHtml.setFocusEdit(this.IdEdition);GHtml.setSelectionEdit(this.IdEdition);}}}
function _annulerCreation(){_SurCreationFin.call(this,-1,true);}
function _SurCreationFin(ASelectionLigne,aAnnuler){if(this._cache.creationEnCours){_refreshSelf.call(this);this._cache.creationEnCours=false;this._cache.creationEnCoursEvenement=false;this._cache.finEditionCreation=null;this._cache.positionCreation=0;this._cache.listeValeursCreation=[];this._cache.numeroColonneCreationEnCours=null;this._cache.numeroLigneCreationDynamique=null;_setRechercheSaisie.call(this,'');_actualiser.call(this);_surSelection.call(this,-1,ASelectionLigne,{avecFocus:false});_SurSelectionEvenement.call(this,-1,ASelectionLigne);if(aAnnuler&&ASelectionLigne=== -1){GHtml.setFocus(this.IdPremierElement);} else{GHtml.setFocus(this.getIdCellule(0,ASelectionLigne)+'_div');}
if(ASelectionLigne>=0){_SurApresCreationEvenement.call(this,ASelectionLigne);} else{_SurApresErreurCreationEvenement.call(this);}
_refreshSelf.call(this);}}
function _SurCreation(aValeur){if(this._fenetreInformationAffichee){return;}
if(this._messageEnCoursSurCreation){return;}
if(!this._cache.creationEnCours){return;}
delete this._valeurEnEdition;const lColonne=this._cache.numeroColonneCreationEnCours;let lLigne= -1,lValeur=aValeur;let lParams=_getParamsCellule.call(this,lColonne,lLigne,{surEdition:true,surCreation:true});if(MethodesObjet.isString(lValeur)&&this.Donnees.avecTrimSurEdition(lParams)){lValeur=lValeur.trim();}
if(lValeur!==null&&lValeur!==undefined&&(lValeur!==''||this.Donnees.autoriserChaineVideSurEdition(lParams))){this._cache.listeValeursCreation[lColonne]=lValeur;if(this.ListeCreations[this._cache.positionCreation]===null||this.ListeCreations[this._cache.positionCreation]===undefined){lParams=_getParamsCellule.call(this,-1,-1,{surEdition:true,surCreation:true});lLigne=this.Donnees._SurCreation(this._cache.listeValeursCreation,this._cache.numeroLigneCreationDynamique===null||this._cache.numeroLigneCreationDynamique===undefined?-1:this._cache.numeroLigneCreationDynamique,lParams);this._messageEnCoursSurCreation=true;try{_afficherMessage.call(this,lParams);} finally{delete this._messageEnCoursSurCreation;}} else{this._cache.creationEnCours=false;this._setStyleCellule(this.IdCellule,lColonne,lLigne,false,true);if(MethodesObjet.isString(lValeur)){GHtml.setHtml(this.IdCellule,lValeur);}
_SurCreationDeb.call(this,true);return;}}
_SurCreationFin.call(this,lLigne);}
function _setCreationLigne(aCreationLigneBis){if(aCreationLigneBis<0||!MethodesObjet.isNumber(aCreationLigneBis)){return;}
this._cache.numeroLigneCreationDynamique=aCreationLigneBis;_actualiser.call(this);_surLigneCreationUnique.call(this,true,this._cache.numeroLigneCreationDynamique);_SurCreationDeb.call(this);}
function _getParamsCellule(aNumeroColonne,aNumeroLigne,aParamsSupp){const lParams={ligne:aNumeroLigne,colonne:aNumeroColonne,article:null,idColonne:null,declarationColonne:{},instance:this};if(lParams.ligne>=0&&this.Donnees&&MethodesObjet.isNumber(lParams.ligne)){lParams.article=this.getArticleDeLigne(lParams.ligne);}
if(lParams.colonne>=0&&this.Donnees&&MethodesObjet.isNumber(lParams.colonne)){lParams.idColonne=this.Donnees.getId(lParams.colonne);lParams.declarationColonne=this._cache.declColonnesByIds[lParams.idColonne];}
if(aParamsSupp){Object.assign(lParams,aParamsSupp);}
return lParams;}
function _getParamsCallback(aGenre,I,J,aParamsSupp){return Object.assign({genreEvenement:aGenre,surClavier:false},_getParamsCellule.call(this,I,J,aParamsSupp));}
function _surEditionDebutApresConfirmation(aParams){const lIdCellule=this.getIdCellule(aParams.colonne,aParams.ligne);if(this._cache.ouvrirSelecteurFileParLigne[aParams.ligne+'_'+aParams.colonne]&&this.Donnees.avecSelecFile(aParams)){this._cache.ouvrirSelecteurFileParLigne[aParams.ligne+'_'+aParams.colonne]();} else if(this.Donnees.AvecEvenement_Edition(aParams.colonne,aParams.article,aParams)){this._cache.editionEnCoursEvenement=true;_afficher_marqueurEditionSurCellule.call(this,aParams.colonne,aParams.ligne);const lIdCelluleFocus=lIdCellule+'_div';GHtml.setFocus(lIdCelluleFocus,true);const lthis=this;$('#'+lIdCelluleFocus.escapeJQ()).one('focusout',() =>{$('#'+lIdCelluleFocus.escapeJQ()).one('focusin',() =>{if(lthis._cache.editionEnCoursEvenement){lthis._cache.editionEnCoursEvenement=false;_nettoyerElementsEditionEnCours.call(lthis);}});});const lParamsCallback=_getParamsCallback.call(this,EGenreEvenementListe.Edition,aParams.colonne,aParams.ligne);lParamsCallback.actualisationApresEdition=(aIgnorerActualisation) =>{if(this.isDestroyed()){return;}
_finaliserEdition.call(this,{ligne:aParams.ligne,colonne:aParams.colonne,ignorerActualisation:aIgnorerActualisation});};lParamsCallback.ouvrirMenuContextuel=function(aParamsPerso){this._ouvrirMenuContextuel(Object.assign({id:this.getIdCellule(aParams.colonne,aParams.ligne)},aParams,aParamsPerso));}.bind(this);this.Evenement.call(this.Pere,lParamsCallback,EGenreEvenementListe.Edition,aParams.colonne,aParams.ligne);_refreshSelf.call(this);} else{this._cache.editionEnCours=true;for(let iLigne=0;iLigne<this._cache.lignesSelectionnees.length;iLigne++){if(iLigne!==aParams.ligne&&this._cache.lignesSelectionnees[iLigne]){this.SelectionnerLigne({ligne:iLigne,selectionner:false,avecEvenementModificationSelection:false});}}
this.IdCellule=lIdCellule;_Entrer_Edition.call(this);_afficher_marqueurEditionSurCellule.call(this,aParams.colonne,aParams.ligne);const lTypeValeur=this.Donnees.GetTypeValeur(aParams,aParams.colonne,aParams.article);switch(lTypeValeur){case ObjetDonneesListe.ETypeCellule.ZoneTexte:_Entrer_ZoneTexte.call(this,aParams.colonne,aParams.ligne,false);break;case ObjetDonneesListe.ETypeCellule.Image:case ObjetDonneesListe.ETypeCellule.Coche:_SurEdition.call(this,aParams,'coche',true);break;case ObjetDonneesListe.ETypeCellule.DateCalendrier:this._Entrer_DateCalendrier(aParams);break;default:_Entrer_Texte.call(this,aParams.colonne,aParams.ligne,false,lTypeValeur);break;}
if(!MethodesTableau.existe(lTypeValeur,[ObjetDonneesListe.ETypeCellule.Coche,ObjetDonneesListe.ETypeCellule.Image,ObjetDonneesListe.ETypeCellule.DateCalendrier])){const lElement=GHtml.getElement(this.IdEdition);if(lElement){GHtml.setFocus(lElement);if(lElement.select){lElement.select();}}
if(this.optionsInterne.versionMobile&&lTypeValeur===ObjetDonneesListe.ETypeCellule.Note){if(lElement&&lElement.click){lElement.click();} else{_finaliserEdition.call(this,{ligne:aParams.ligne,colonne:aParams.colonne});}}}}}
function _SurEditionDeb(aColonne,aLigne){if(_getNonEditable.call(this)){return;}
this._cache.selectionCellule.ligne=aLigne;this._cache.selectionCellule.colonne=aColonne;let lParams=_getParamsCellule.call(this,aColonne,aLigne,{surEdition:true})
;let lNumeroColonne=this.Donnees.getColonneTransfertEdition(lParams);if(lNumeroColonne&&MethodesObjet.isString(lNumeroColonne)){lNumeroColonne=this.getNumeroColonneDIdColonne(lNumeroColonne);}
if(lNumeroColonne>=0&&MethodesObjet.isNumber(lNumeroColonne)){lParams=_getParamsCellule.call(this,lNumeroColonne,aLigne,{surEdition:true});}
if(lParams.article&&
!this._cache.editionEnCours&&(this.Donnees.AvecEdition(lParams.colonne,lParams.article,lParams)||
this.Donnees.AvecEvenement_Edition(lParams.colonne,lParams.article,lParams)||
this.Donnees.avecSelecFile(lParams))){_nettoyerElementsEditionEnCours.call(this);if(this.Donnees.editionRefusee(lParams)){return;}
if(this.Donnees._Edition_Confirmation(lParams)){GApplication.getMessage().afficher({type:EGenreBoiteMessage.Confirmation,message:this.Donnees.GetMessage(),callback:function(AAccepte){if(AAccepte===EGenreAction.Valider){_surEditionDebutApresConfirmation.call(this,lParams);}}.bind(this)});} else{_surEditionDebutApresConfirmation.call(this,lParams);}}}
function _SurEdition(aParams,aValeur,aAvecModification,aForcerEvenement){if(this._fenetreInformationAffichee){return;}
if(this._cache.editionEnCours||this._cache.editionEnCoursEvenement){delete this._valeurEnEdition;delete this._cache.avecModificationSaisie;if(!aAvecModification){_surEditionFin.call(this,aParams.colonne,aParams.ligne,aForcerEvenement);return;}
let lValeur=aValeur;if(MethodesObjet.isString(lValeur)&&this.Donnees.avecTrimSurEdition(aParams)){lValeur=lValeur.trim();}
if(((lValeur!==null&&lValeur!==undefined)||this.Donnees.GetTypeValeur(aParams,aParams.colonne,aParams.article)===ObjetDonneesListe.ETypeCellule.DateCalendrier)&&(lValeur!==''||this.Donnees.autoriserChaineVideSurEdition(aParams))){aParams.valeur=lValeur;const lFuncAfficherMessage=(aParams) =>{if(!this._messageEnCoursDAffichage){this._messageEnCoursDAffichage=true;_afficherMessage.call(this,aParams);delete this._messageEnCoursDAffichage;}};const lResult=this.Donnees._SurEdition(aParams);if(lResult&&lResult.then){return lResult.then((aError) =>{lFuncAfficherMessage(aParams);_surEditionFin.call(this,aParams.colonne,aParams.ligne,true ,true);if(aError&&aError.annulerEdition&&aError.enEditionSurCelllule){this.demarrerEditionSurCellule(aParams.ligne,aParams.colonne);}
return aError;});}
lFuncAfficherMessage(aParams);}
_surEditionFin.call(this,aParams.colonne,aParams.ligne,true ,true);}}
function _finaliserEdition(aParametres){const lParametres=Object.assign({ligne:-1,colonne:-1,avecEvenement:false,avecModification:false,ignorerActualisation:false},aParametres);this._cache.editionEnCours=false;this._cache.editionEnCoursEvenement=false;this._cache.finEditionCreation=null;if(this._cache.timeout_ignorerScrollSortieEdition){clearTimeout(this._cache.timeout_ignorerScrollSortieEdition);delete this._cache.timeout_ignorerScrollSortieEdition;}
_nettoyerElementsEditionEnCours.call(this);if(lParametres.ignorerActualisation!==true){let lEstColonneTriCourant=false;if(this._triCourant.colonne){this._triCourant.colonne.forEach((aNumeroColonne) =>{if(lParametres.colonne===aNumeroColonne){lEstColonneTriCourant=true;}});}
const lElementCellule=GHtml.getElement(this.getIdCellule(lParametres.colonne,lParametres.ligne));const lFuncConstructCellule=this._cache.collectionFuncConstructCellule[lParametres.ligne+'_'+lParametres.colonne];if(lEstColonneTriCourant||!lFuncConstructCellule||!lElementCellule||this.Donnees.forcerActualisationListeSurEdition(lParametres)){_actualiser.call(this,{conserverSelection:false,zonesActualisation:{contenu:true,total:true},avecEvenementModificationSelection:false,conserverPositionElement:lElementCellule?{rectCellule:GPosition.getClientRect(lElementCellule),ligne:lParametres.ligne,colonne:lParametres.colonne}:null});} else{GHtml.setHtml(lElementCellule,lFuncConstructCellule(),{controleur:this.controleur});_selectionner.call(this,{deselectionnerTout:true});}
_surSelection.call(this,lParametres.colonne,lParametres.ligne,{avecFocus:false});if(lParametres.ligne>=0&&lParametres.colonne>=0){const lElement=GHtml.getElement(this.getIdCellule(lParametres.colonne,lParametres.ligne)+'_div');if(GHtml.elementExiste(lElement)&&lElement.focus){try{lElement.focus({preventScroll:true});} catch(e){}}} else{GHtml.setFocus(this.IdPremierElement,true);}}
_refreshSelf.call(this);if(lParametres.colonne>=0&&lParametres.avecEvenement){_SurApresEditionEvenement.call(this,_getParamsCellule.call(this,lParametres.colonne,lParametres.ligne,{avecModification:!!lParametres.avecModification}));}}
function _surEditionFin(aColonne,aLigne,aAvecEvenement,aAvecModification){_finaliserEdition.call(this,{ligne:aLigne,colonne:aColonne,avecEvenement:aAvecEvenement,avecModification:aAvecModification,ignorerActualisation:!this._cache.editionEnCours&&!this._cache.editionEnCoursEvenement});}
function _surSuppression(){const lListeSelections=_getListeElementsSelection.call(this);if(this._options.AvecSuppression&&!_getNonEditable.call(this)&&(this._cache.selectionCellule.ligne> -1||(lListeSelections&&lListeSelections.GetNbrElements()>0))){const lParamsCellule=_getParamsCellule.call(this,this._cache.selectionCellule.colonne,this._cache.selectionCellule.ligne,{surSuppression:true});if(this.Donnees._Suppression_Impossible(this._cache.selectionCellule.ligne,lListeSelections)){_afficherMessage.call(this,lParamsCellule);} else if(this.Donnees._Suppression_Confirmation(this._cache.selectionCellule.ligne,lListeSelections)){GApplication.getMessage().afficher({type:EGenreBoiteMessage.Confirmation,message:this.Donnees.GetMessage()}).then((aGenreAction) =>{_SurSuppressionApresConfirmation.call(this,lListeSelections,lParamsCellule,aGenreAction);});} else{_SurSuppressionApresConfirmation.call(this,lListeSelections,lParamsCellule,EGenreAction.Valider);}
this.EnSuppression=false;}}
function _SurSuppressionApresConfirmation(aListeSelections,aParamsCellule ,AAccepte){if(AAccepte===EGenreAction.Valider){Object.assign(aParamsCellule,{listeSelections:aListeSelections,listeSuppressions:new ObjetListeElements()});if(aListeSelections){aParamsCellule.listeSuppressions=this.Donnees.getListeSupprimables(aListeSelections,aParamsCellule);}
const lAvecEvenement=_SurSuppressionEvenement.call(this,aParamsCellule);if(lAvecEvenement&&this.Donnees.avecInterruptionSuppression()){this._cache.selectionCellule.ligne= -1;} else{this._cache.selectionCellule.ligne=this.Donnees._SurSuppression(aParamsCellule.ligne,aParamsCellule.listeSuppressions);_actualiser.call(this);if(this.Donnees.AvecEtatSaisie(aParamsCellule)){this.SetEtatSaisie(true);}}
_SurApresSuppressionEvenement.call(this,aParamsCellule);}
GHtml.setFocus(this.IdPremierElement,true,0);}
function _getIdCreation(I,J){return this.Nom+'_Creation_'+I+(J===null||J===undefined?'':'_'+J);}
function _getListeElementsSelection(){const lSelections=new ObjetListeElements();if(this._cache.lignesSelectionnees){for(let i=0;i<this._cache.lignesSelectionnees.length;i++){if(this._cache.lignesSelectionnees[i]){const lElement=this.getArticleDeLigne(i);if(lElement){lSelections.AddElement(lElement);}}}}
return lSelections;}
function _getCellulesSelection(aAvecLignesInvisible){const lSelections=[];if(this._cache.lignesSelectionnees&&this.Donnees){this._cache.lignesSelectionnees.forEach(function(aSelectionLigne,aLigne){if(!aAvecLignesInvisible&&!_estLigneVisible(this,aLigne)){return;}
let lLigne=null,lAvecSelectionParCelluleSurLigne=false;if(aSelectionLigne&&aSelectionLigne.forEach){aSelectionLigne.forEach(function(aSelectionne,aColonne){if(aSelectionne&&
_estColonneVisible.call(this,aColonne)&&
this.Donnees._AvecSelection(aColonne,aLigne)){if(!lLigne){lLigne={ligne:aLigne,article:this.getArticleDeLigne(aLigne),hashColonnesSelecParCellule:{},colonnes:[],idsColonnes:[]};}
lLigne.hashColonnesSelecParCellule[aColonne]=true;lLigne.colonnes.push(aColonne);lLigne.idsColonnes.push(this.getIdColonneDeNumeroColonne(aColonne));if(!lAvecSelectionParCelluleSurLigne&&_estSelectionParCellule.call(this,aLigne,aColonne)){lAvecSelectionParCelluleSurLigne=true;}}},this);} else if(aSelectionLigne){}
if(lLigne){if(!lAvecSelectionParCelluleSurLigne){delete lLigne.hashColonnesSelecParCellule;}
lSelections.push(lLigne);}},this);}
return lSelections;}
function _setCellulesSelection(aListe,aParams){let iColonne,lElement,lElementTrouve,lHashColonnesSelectionnees;const lParams=Object.assign({instancesIdentiques:false,avecScroll:false,avecEvenement:false,avecEvenementModificationSelection:true,ajoutSelection:false,funcRecherche:null,avecSelectionSurLigneInvisible:false},aParams);const lFuncRecherche=lParams.funcRecherche&&MethodesObjet.isFunction(lParams.funcRecherche)?lParams.funcRecherche:null;function _gererSelection(aParams,aElementTrouve,aNumeroLigne,aNumeroColonne,aEtatSelec){if(!aElementTrouve&&aEtatSelec){if(!aParams.ajoutSelection){_selectionner.call(this,{ligne:aNumeroLigne,colonne:aNumeroColonne,selectionner:false,avecEvenement:aParams.avecEvenement,_avecVisuCadreSelection:false});}} else if(aElementTrouve){const lEstSelection=aEtatSelec;if(!lEstSelection){_selectionner.call(this,{ligne:aNumeroLigne,colonne:aNumeroColonne,selectionner:true,avecScroll:aParams.avecScroll,deselectionnerTout:aParams.ignorerControleMultiSelection===true?null:false,avecEvenement:aParams.avecEvenement&&!lEstSelection,_avecVisuCadreSelection:false});}}}
function _trouveIdentique(aElement){if(aElement&&aElement.article&&aElement.article===lElement){lElementTrouve=true;lHashColonnesSelectionnees=aElement.hashColonnesSelecParCellule;return false;}
return true;}
function _trouveNumeroGenre(aElement){if(aElement&&aElement.article&&aElement.article.egalParNumeroEtGenre(lElement.GetNumero(),lElement.GetGenre())){lElementTrouve=aElement;lHashColonnesSelectionnees=aElement.hashColonnesSelecParCellule;return false;}
return true;}
function _trouverAvecRecherche(aElement){if(lFuncRecherche(lElement,aElement.article)===true){lElementTrouve=true;lHashColonnesSelectionnees=aElement.hashColonnesSelecParCellule;return false;}
return true;}
if(!aListe||!Array.isArray(aListe)){aListe=[];}
const lSelectionsPrecedente=lParams.avecEvenementModificationSelection?_getCellulesSelection.call(this,true):null;const lFuncs=[];for(let lNumeroLigne=this.Donnees.GetNbrLignes()-1;lNumeroLigne>=0;lNumeroLigne--){lElement=this.getArticleDeLigne(lNumeroLigne);lElementTrouve=false;lHashColonnesSelectionnees=null;if(lElement&&aListe.length>0&&(lParams.avecSelectionSurLigneInvisible||_estLigneVisible(this,lNumeroLigne))){if(lFuncRecherche){aListe.every(_trouverAvecRecherche);} else if(lParams.instancesIdentiques){aListe.every(_trouveIdentique);} else{aListe.every(_trouveNumeroGenre);}}
let lEtatSelec;const lColonnes=[];if(lHashColonnesSelectionnees){lEtatSelec=[];for(iColonne=0;iColonne<this.ListeTailles.length;iColonne++){if(_estColonneVisible.call(this,iColonne)){lColonnes.push(iColonne);lEtatSelec.push(_etatSelectionCellule.call(this,{ligne:lNumeroLigne,colonne:iColonne}));}}} else{lEtatSelec=_etatSelectionCellule.call(this,{ligne:lNumeroLigne,colonne:-1});}
lFuncs.push({hashColonnesSelectionnees:lHashColonnesSelectionnees,elementTrouve:lElementTrouve,numeroLigne:lNumeroLigne,colonnes:lColonnes,etatSelec:lEtatSelec});}
lFuncs.forEach((aParam) =>{if(aParam.hashColonnesSelectionnees){aParam.colonnes.forEach((aColonne) =>{_gererSelection.call(this,lParams,aParam.elementTrouve&&aParam.hashColonnesSelectionnees[aColonne],aParam.numeroLigne,aColonne,aParam.etatSelec[aColonne]);});} else{_gererSelection.call(this,lParams,aParam.elementTrouve,aParam.numeroLigne,-1,aParam.etatSelec);}});_actualiserCadreSelection.call(this);if(lParams.avecEvenementModificationSelection){_surModificationSelectionEvenement.call(this,lSelectionsPrecedente);}
return this;}
function _setTableauCellulesSelection(aListe,aParams){let lIndexTrouve= -1;if(!aListe||!Array.isArray(aListe)){aListe=[];}
this._cache.lignesSelectionnees_prec=[...this._cache.lignesSelectionnees];function _trouveIdentique(aCherche,aElement,aIndex){if(aElement&&aCherche&&aElement.article&&aElement.article===aCherche){lIndexTrouve=aIndex;return false;}
return true;}
const lListe=[];if(aListe&&Array.isArray(aListe)){aListe.forEach((aElement) =>{let lLigne=null;if(!aElement.article){return;}
lIndexTrouve= -1;if(!lListe.every(_trouveIdentique.bind(this,aElement.article))&&lIndexTrouve>=0){lLigne=lListe[lIndexTrouve];}
if(!lLigne){lLigne={article:aElement.article};}
let lNumeroColonne= -1;if(aElement.idColonne){lNumeroColonne=this.getNumeroColonneDIdColonne(aElement.idColonne);}
if(lNumeroColonne<0&&aElement.colonne>=0){lNumeroColonne=aElement.colonne;}
if(lNumeroColonne>=0){if(!lLigne.hashColonnesSelecParCellule){lLigne.hashColonnesSelecParCellule={};}
lLigne.hashColonnesSelecParCellule[lNumeroColonne]=true;}
lListe.push(lLigne);});}
return _setCellulesSelection.call(this,lListe,aParams);}
function _setListeElementsSelection(aListeElements,aParams){this._cache.lignesSelectionnees_prec=[...this._cache.lignesSelectionnees];if(!aListeElements||!aListeElements.GetElementParElement){aListeElements=new ObjetListeElements();}
const lListe=[];aListeElements.parcourir((D) =>{lListe.push({article:D});});return _setCellulesSelection.call(this,lListe,aParams);}
function _navigationCelluleSuivante(aParametres){if(!this.Donnees){return false;}
if(this._cache.finEditionCreation){const lResultFinEdition=this._cache.finEditionCreation();if(lResultFinEdition&&lResultFinEdition.promiseMessageErreur){return;}}
const lParametres=Object.assign({ligne:this._cache.selectionCellule.ligne,colonne:this._cache.selectionCellule.colonne,orientationVerticale:false,sensInverse:false,ligneEtColonneFixe:false,avecSelection:false,avecCelluleEditable:false,avecFocusCellule:true},aParametres);let lLigne=lParametres.ligne,lColonne=lParametres.colonne,lElement=null;const lNbLignes=this.Donnees.Donnees.GetNbrElements(),lNbColonnes=this.ListeTailles.length;let lParamsCellule;if(lLigne<0||lColonne<0){if(lParametres.orientationVerticale){lLigne=Math.max(lLigne,-1);lColonne=Math.max(lColonne,0);} else{lLigne=Math.max(lLigne,0);lColonne=Math.max(lColonne,-1);}
lParametres.sensInverse=false;}
while(!lElement){if(lParametres.orientationVerticale){lLigne+=lParametres.sensInverse?-1:1;if(lParametres.ligneEtColonneFixe){} else if(lLigne>=lNbLignes||lLigne<0){lLigne=lParametres.sensInverse?lNbLignes-1:0;lColonne+=lParametres.sensInverse?-1:1;}} else{lColonne+=lParametres.sensInverse?-1:1;if(lParametres.ligneEtColonneFixe){} else if(lColonne>=lNbColonnes||lColonne<0){lColonne=lParametres.sensInverse?lNbColonnes-1:0;lLigne+=lParametres.sensInverse?-1:1;}}
if(lLigne>=lNbLignes||lColonne>=lNbColonnes||lLigne<0||lColonne<0||isNaN(lLigne)||isNaN(lColonne)){break;}
lParamsCellule=_getParamsCellule.call(this,lColonne,lLigne);if(_estColonneVisible.call(this,lColonne)&&
_estLigneVisible(this,lLigne)&&(lParametres.avecCelluleEditable||!lParametres.avecSelection||this.Donnees._AvecSelection(lColonne,lLigne))&&(!lParametres.avecCelluleEditable||(!_getNonEditable.call(this)&&(this.Donnees.AvecEdition(lParamsCellule.colonne,lParamsCellule.article,lParamsCellule)||this.Donnees.AvecEvenement_Edition(lParamsCellule.colonne,lParamsCellule.article,lParamsCellule))))){const lIdCellule=this.getIdCellule(lColonne,lLigne)+'_div';lElement=GHtml.getElement(lIdCellule);if(!lElement&&_estLigneDansRangeNonConstruitDyn.call(this,lLigne)){_scrollSurSelection.call(this,lColonne,lLigne);lElement=GHtml.getElement(lIdCellule);}}}
if(lElement){if(lParametres.avecSelection){var lAvecFocusCellule=lParametres.avecFocusCellule&&
[ObjetDonneesListe.ETypeCellule.ZoneTexte].indexOf(this.Donnees.GetTypeValeur(lParamsCellule,lParamsCellule.colonne,lParamsCellule.article))<0;this.selectionnerCellule({ligne:lLigne,colonne:lColonne,deselectionnerTout:true,avecFocusCellule:lAvecFocusCellule,avecEvenement:true});} else{GHtml.setFocus(lElement);}
this._cache.selectionCellule={ligne:lLigne,colonne:lColonne};return true;}
return false;}
function _selectionnerCelluleSuivante(aParametres){const lParametres=Object.assign({ligne:this._cache.selectionCellule.ligne,colonne:this._cache.selectionCellule.colonne,orientationVerticale:false,sensInverse:false,avecSelection:true,avecCelluleEditable:false,entrerEdition:false},aParametres);if(lParametres.ligne<0||
lParametres.colonne<0||
!this.Donnees){return this;}
if(lParametres.entrerEdition){lParametres.avecCelluleEditable=true;}
if(_navigationCelluleSuivante.call(this,lParametres)&&lParametres.entrerEdition&&(lParametres.entrerEdition===true||(MethodesObjet.isFunction(lParametres.entrerEdition)&&lParametres.entrerEdition(_getParamsCellule.call(this,this._cache.selectionCellule.colonne,this._cache.selectionCellule.ligne))))){this.demarrerEditionSurCellule(this._cache.selectionCellule.ligne,this._cache.selectionCellule.colonne);}
return this;}
function _estColonneVisible(aNumeroColonne,aCache){return aNumeroColonne>=0&&
this.ListeTailles&&
aNumeroColonne<this.ListeTailles.length&&(aCache||this._cache).tableauColonnesCachees[aNumeroColonne]!==true;}
function _calculColonnesCachees(aCache){let lColonnesCachees=[],lTabColonnes=this._options.colonnesCachees;if(this.Donnees&&this.Donnees.enImpression&&this._options.colonnesCacheesImpression){lTabColonnes=this._options.colonnesCacheesImpression;}
if(!MethodesObjet.isArray(lTabColonnes)&&isFinite(lTabColonnes)){lColonnesCachees.push(lTabColonnes);} else if(MethodesObjet.isArray(lTabColonnes)){lColonnesCachees=lColonnesCachees.concat(lTabColonnes);}
lColonnesCachees.sort();aCache.nbColonnesCachees=0;aCache.tableauColonnesCachees=[];aCache.tableauColonnesCacheesOriginal=[];if(this.ListeTailles&&this.ListeTailles.forEach){this.ListeTailles.forEach((aTaille,aIndex) =>{let lIdCol;let lNonTrouve=lColonnesCachees.indexOf(aIndex)=== -1;if(lNonTrouve&&this._cache.colonnes.listeIds){lIdCol=this._cache.colonnes.listeIds[aIndex];if(lIdCol){lNonTrouve=lColonnesCachees.indexOf(lIdCol)=== -1;}}
let lIndexOriginal=aIndex;if(aCache.listeCorrespondancesColonnes&&lIdCol){lIndexOriginal=aCache.listeCorrespondancesColonnes.indexOf(aIndex);}
if(lNonTrouve){aCache.tableauColonnesCachees[aIndex]=false;aCache.tableauColonnesCacheesOriginal[lIndexOriginal]=false;} else{aCache.tableauColonnesCachees[aIndex]=true;aCache.tableauColonnesCacheesOriginal[lIndexOriginal]=true;aCache.nbColonnesCachees++;}});}}
function _colonneCreationUniqueEnErreur(){return this.ListeCreations.length===1&&(this.ListeCreations[0]<0||this.ListeCreations[0]>=this.ListeTailles.length);}
function _deploiementSurCellule(aParams){const lTypeValeur=this.Donnees.GetTypeValeur(aParams,aParams.colonne,aParams.article);return this.Donnees.AvecDeploiement()&&this.Donnees.AvecDeploiementSurColonne(aParams)&&this.Donnees.estUnDeploiement(aParams)&&(lTypeValeur!==ObjetDonneesListe.ETypeCellule.Coche);}
function _SurDeploiement(aEvent,aColonne,aLigne,aDeploiementSurImage){if(this._cache.creationEnCours||this._cache.editionEnCours){return;}
if(aEvent.type!=='keyup'&&aEvent.which===2){return;}
const lParams=_getParamsCellule.call(this,aColonne,aLigne,{surDeploiement:true});if(!aDeploiementSurImage&&!this.Donnees.avecEventDeploiementSurCellule(lParams)){return;}
if(_deploiementSurCellule.call(this,lParams)){this.Donnees.surDeploiement(aColonne,aLigne,lParams.article);_actualiser.call(this,{sansTriDonnees:true,conserverSelection:true,conserverFocusSelection:true,ignorerFocusListe:false});if(this.Donnees.AvecEvenement_Deploiement(lParams.colonne,lParams.article,lParams)){this.Evenement.call(this.Pere,_getParamsCallback.call(this,EGenreEvenementListe.Deploiement,aColonne,aLigne),EGenreEvenementListe.Deploiement,aColonne,aLigne);_refreshSelf.call(this);}
return true;}}
function _avecSuppressionSelectionCourante(aNumeroLigne,aNumeroColonne){const lListe=_getListeElementsSelection.call(this),lParams=_getParamsCellule.call(this,aNumeroColonne,aNumeroLigne,{listeSelection:lListe,surSuppression:true});return this._options.AvecSuppression&&!_getNonEditable.call(this)&&!this._cache.editionEnCours&&lListe.GetNbrElements()>0&&this.Donnees._AvecSuppression(lParams);}
function _surClickCelluleTotal(event){const lInfos=_extraireInfosId(this.id);const lInstance=event.data.instance;if(!lInfos){return;}
const lListeLignesTotal=lInstance.Donnees?lInstance.Donnees.getListeLignesTotal():null;const lParams=_getParamsCellule.call(lInstance,lInfos.colonne,-1,{surTotal:true});lParams.ligne=lInfos.ligne;if(!!lListeLignesTotal){lParams.article=lListeLignesTotal.GetElement(lInfos.ligne);}
if(lInstance.Donnees&&lInstance.Donnees.AvecEvenement_SelectionClickTotal(lParams)){if(lInstance.Pere&&lInstance.Evenement){const lParamsCallback=_getParamsCallback.call(lInstance,EGenreEvenementListe.SelectionClickTotal,lParams.colonne,lParams.ligne);lInstance.callback.appel(lParamsCallback,EGenreEvenementListe.SelectionClickTotal,lParams.colonne,lParams.ligne);}}}
function _construireCBToutCocher(aInstance){return tag('ie-checkbox',{'ie-model':tag.funcAttr('liste.cb_ligne_flatDesign',-1),'ie-textright':true,style:aInstance._options.paddingContenu_LR?'padding-left:'+aInstance._options.paddingContenu_LR+'px;':''},aInstance._options.avecCBToutCocher===true?GTraductions.getValeur('liste.toutCocher'):aInstance._options.avecCBToutCocher&&aInstance._options.avecCBToutCocher.libelle?aInstance._options.avecCBToutCocher.libelle:'');}
function _rechercheDeplacementPrecedenteSuivant(aParamsCelluleSource,aSuivant){let lInc=(aSuivant?1:-1);const lIndiceLigne=this._cache.lignesVisibles.indexOf(aParamsCelluleSource.ligne);if(lIndiceLigne<0){return null;}
let lParamsCelluleDest=_getParamsCellule.call(this,-1,this._cache.lignesVisibles[lIndiceLigne+lInc]);while(lParamsCelluleDest&&lParamsCelluleDest.article){if(this.Donnees.autoriserDeplacementElementSurLigne(lParamsCelluleDest,aParamsCelluleSource)){return lParamsCelluleDest;}
lInc+=(aSuivant?1:-1);lParamsCelluleDest=_getParamsCellule.call(this,-1,this._cache.lignesVisibles[lIndiceLigne+lInc]);}
return null;}
function _surDeplacementLigneSurAutreLigne(aParamsDroppable,aParamsDraggable){if(aParamsDraggable&&this.Donnees.surDeplacementElementSurLigne(aParamsDroppable,aParamsDraggable)!==false){_actualiser.call(this,{conserverSelection:false,zonesActualisation:{contenu:true},avecEvenementModificationSelection:false});this.SelectionnerLigne({ligne:aParamsDroppable.ligne,avecScroll:true,avecEvenement:true});}}
function _existeDeploiementDansListe(){if(!this.Donnees||!this.Donnees.Donnees){return false;}
let lAvecDeploiement=false;this.Donnees.Donnees.parcourir((aElement,aLigne) =>{const lParams=_getParamsCellule.call(this,-1,aLigne);if(this.Donnees.estUnDeploiement(lParams)&&_estLigneVisible(this,aLigne)){lAvecDeploiement=true;return false;}});return lAvecDeploiement;}
function _getBoutonDeploye(){if(!this.Donnees||!this.Donnees.AvecDeploiement()||!this.Donnees.Donnees){return false;}
let lEstDeploye=false;this.Donnees.Donnees.parcourir((aElement,aLigne) =>{const lParams=_getParamsCellule.call(this,-1,aLigne);if(this.Donnees.estUnDeploiement(lParams)&&_estLigneVisible(this,aLigne)){if(this.Donnees._estDeploye(aLigne)){lEstDeploye=true;return false;}}});return lEstDeploye;}
function _construireBoutonsEntete(aInstance){const lAvecBoutonsListeEntete=_avecBoutonsListeEntete.call(aInstance);const lAvecCBToutCocher=aInstance._options.avecCBToutCocher;const lAvecBtnCreation=!aInstance.optionsInterne.versionMobile&&aInstance._options.avecCreationEnBouton&&_avecLigneCreationTitre.call(aInstance);if(!lAvecBoutonsListeEntete&&!aInstance._options.avecCBToutCocher&&!lAvecBtnCreation){return'';}
const _construireBouton=(aBouton,aIndex) =>{return tag('ie-btnicon',{'ie-model':tag.funcAttr('liste.boutonListe',aIndex),title:(aBouton.title?aBouton.title:''),id:aBouton.id,class:[aBouton.class,aBouton.genre===_ObjetListe.typeBouton.deployer?'':'avecFond']});};return tag('div',{class:'liste_btnentete',role:'toolbar','aria-label':GTraductions.getValeur('liste.wai.EnteteDeListe')},(aTab) =>{const lIndexBtnDeployer=aInstance._cache.boutons.findIndex(aBouton => aBouton.genre===_ObjetListe.typeBouton.deployer);if(lIndexBtnDeployer>=0){const lBoutonDeployer=aInstance._cache.boutons[lIndexBtnDeployer];aTab.push(_construireBouton(lBoutonDeployer,lIndexBtnDeployer));}
if(lAvecCBToutCocher){aTab.push(_construireCBToutCocher(aInstance));}
if(lAvecBtnCreation){aTab.push(tag('ie-bouton',{'ie-model':'liste.btnCreationEntete',class:'themeBoutonPrimaire','ie-icon':aInstance._options.iconeTitreCreation},aInstance._options.titreCreation));}
if(lAvecBoutonsListeEntete){aTab.push(tag('div',{class:'liste_btnentete_droite'},(aTabBtn) =>{aInstance._cache.boutons.forEach((aBouton,aIndex) =>{if(aBouton.genre===_ObjetListe.typeBouton.deployer){return;}
if(aBouton.html){aTabBtn.push(tag('div',{'ie-node':tag.funcAttr('liste.nodeBtnEnteteLibre',aIndex)}));return;}
let H=_construireBouton(aBouton,aIndex);if(aBouton.genre===_ObjetListe.typeBouton.rechercher){H=tag('div',{class:'liste_contbtnRechercheEntete'},H);}
aTabBtn.push(H);});}));}});}
function _getJConteneurInputRecherche(aInstance){return aInstance._options.avecBoutonsDansEntete?$('#'+aInstance.Nom.escapeJQ()+' .liste_contbtnRechercheEntete'):$('#'+aInstance.Nom.escapeJQ()+' .liste_cont_btnscroll');}
function _creerZoneRechercheTexte(aAvecFocus){const lJContenur=_getJConteneurInputRecherche(this);if(lJContenur.find('.liste_rechercheTexte').length===0){let lAvecRecherche=false;if(this._cache.boutons){lAvecRecherche=!!this._cache.boutons.find(aBouton => aBouton.genre===_ObjetListe.typeBouton.rechercher);}
if(!lAvecRecherche){return;}
const H=tag('div',{class:'liste_rechercheTexte like-input'},tag('input',{type:"text",'ie-textbrut':true,'ie-model':"liste.rechercheTexte",placeholder:GTraductions.getValeur('liste.Rechercher'),class:'browser-default'}),tag('ie-btnicon',{class:'icon_fermeture_widget','ie-model':'liste.btnRechercheTexte',title:GTraductions.getValeur('liste.supprimer')}));lJContenur.IEHtmlAppend(H,{controleur:this.controleur});}
if(aAvecFocus){setTimeout(() =>{const lElement=lJContenur.find('.liste_rechercheTexte input').get(0);GHtml.setFocusEdit(lElement);},0);}}
function _supprimerZoneRechercheTexte(){_getJConteneurInputRecherche(this).find('.liste_rechercheTexte').remove();}
function _annulerRechercheTexte(){_setRechercheSaisie.call(this,'');_supprimerZoneRechercheTexte.call(this);const lCacheBouton=this._cache.boutons.find(aBouton => aBouton.genre===_ObjetListe.typeBouton.rechercher);GHtml.setFocus(lCacheBouton&&lCacheBouton.id?lCacheBouton.id:this.IdPremierElement);_filtreRechercheTexte.call(this,{annulerRechercheTexte:true});}
function _estLigneDansRangeNonConstruitDyn(aNumeroLigne){const lCacheRef=this._cache.refresh;if(!lCacheRef.avecConstructionDynamiqueContenu){return false;}
if(this._cache.lignesVisibles.indexOf(aNumeroLigne)<0){return false;}
const lStructureMin=lCacheRef.structure[lCacheRef.mapRangesExist.min];const lStructureMax=lCacheRef.structure[lCacheRef.mapRangesExist.max];if(lStructureMin&&lStructureMax){return aNumeroLigne<lStructureMin.deb||aNumeroLigne>lStructureMax.fin;}
return false;}
function _getPositionTopLigneDynamiqueEvaluee(aNumeroLigne){const lCacheRef=this._cache.refresh;if(!lCacheRef.avecConstructionDynamiqueContenu){return null;}
const lIndexLigne=this._cache.lignesVisibles.indexOf(aNumeroLigne);if(lIndexLigne<0){return null;}
let lPosTop_Cellule=GPosition.getClientRect(lCacheRef.node_gab_start[0]).top;for(const lStructure of lCacheRef.structure){const lHeightStruct=lCacheRef.getHeightStructure(lStructure);if(lIndexLigne>lStructure.fin){lPosTop_Cellule+=lHeightStruct;} else{lPosTop_Cellule+=lHeightStruct/(lStructure.fin-lStructure.deb+1)*(lIndexLigne-lStructure.deb);break;}}
return lPosTop_Cellule;}
function _actualiserHeightRanges(aIndiceRange){const lCacheRef=this._cache.refresh;let lAvecActualisation=false;const lTabIndices=[];if(aIndiceRange>=0){lTabIndices.push(aIndiceRange);} else{for(let lIndice=lCacheRef.mapRangesExist.min;lIndice<=lCacheRef.mapRangesExist.max;lIndice++){lTabIndices.push(lIndice);}}
for(const lIndice of lTabIndices){const lRangeConstruit=lCacheRef.mapRangesExist.get(lIndice);const lStructure=lCacheRef.structure[lIndice];if(!lRangeConstruit||!lStructure){continue;}
if(lRangeConstruit.node_start&&lRangeConstruit.node_end){lStructure.height=GPosition.getClientRect(lRangeConstruit.node_end).top-GPosition.getClientRect(lRangeConstruit.node_start).bottom;lAvecActualisation=true;}}
if(lAvecActualisation){let lHeightTotal=0;let lNbLignesTotal=0;lCacheRef.structure.forEach((aStructure) =>{if(aStructure.height>0){lHeightTotal+=aStructure.height;lNbLignesTotal+=aStructure.nbLignes;}});if(lNbLignesTotal>0){lCacheRef.hauteurMoyenneLigne=lHeightTotal/lNbLignesTotal;}}}
function _callbackObserverRefreshContenu(aObservables){let lAvecRefresh=false;aObservables.forEach((aObservable) =>{const lVisible=aObservable.intersectionRatio>0||aObservable.isIntersecting;const lData=this._cache.refresh.mapNodesObs.get(aObservable.target);if(lData){if(lVisible){lAvecRefresh=true;} else{if(!lData.gabarit){lAvecRefresh=true;}}}});if(lAvecRefresh){_refreshContenuDynamique.call(this,{avecBackupScroll:this.optionsInterne.versionMobile});this._cache.refresh.surRefreshContenu=true;setTimeout(() =>{this._cache.refresh.surRefreshContenu=false;},100);}}
function _addContenu_surRefreshDyn(aParams){const lParams=Object.assign({start:false,indices:[]},aParams);const lCache=this._cache;const lCacheRef=lCache.refresh;lCache.infosZonesColonnes.forEach((aInfosZoneColonnes,aIndex) =>{const H=[];for(const lIndice of lParams.indices){H.push(this._construireContenu_range(aInfosZoneColonnes,lIndice));}
if(H){let lNode=lCacheRef.node_gab_end[aIndex];if(lParams.start){lNode=lCacheRef.node_gab_start[aIndex].nextSibling;}
if(!lNode||!lNode.parentNode){return;}
IEHtml.injectHTMLParams({html:H.join(''),element:lNode.parentNode,insererAvantLeNode:lNode,controleur:this.controleur,ignorerScroll:true});}});}
function _getClassRange(aIndiceRange){return`_range_${aIndiceRange}`;}
function _refreshContenuDynamique(aParams){const lCache=this._cache;const lCacheRef=lCache.refresh;if(!lCacheRef.avecConstructionDynamiqueContenu){return;}
const lParams=Object.assign({surInitialisation:false,avecBackupScroll:false,refreshRecursif:false,conserverPositionElement:null},aParams);let lIndiceRangeDebut=lCacheRef.mapRangesExist.min;let lIndiceRangeFin=lCacheRef.mapRangesExist.max;if(!lCacheRef.mapRangesExist.has(lIndiceRangeDebut)||!lCacheRef.mapRangesExist.has(lIndiceRangeFin)){return;}
const lRectListe=GPosition.getClientRect(GHtml.getElement(this.Nom));if(lRectListe.width===0||lRectListe.height===0){return;}
let lAvecModif=false;let lBackupScroll=null;if(!lParams.surInitialisation){if(lParams.avecBackupScroll){lBackupScroll=this._backupScroll({conserverPositionScroll:true});}
const lBorneListeBottom=Math.min(GNavigateur.EcranH,lRectListe.bottom);const lBorneListeTop=Math.max(0,lRectListe.top);const lRectStart=GPosition.getClientRect(lCacheRef.node_gab_start[0]);const lMapIndexVisibles=new Map();let lPos=lRectStart.top;for(let lIndex=0;lIndex<lCacheRef.structure.length;lIndex++){const lStructure=lCacheRef.structure[lIndex];const lHeight=lCacheRef.getHeightStructure(lStructure);if(lPos+lHeight>lBorneListeTop&&lPos<lBorneListeBottom){lMapIndexVisibles.set(lIndex,true);if(lIndex>0){lMapIndexVisibles.set(lIndex-1,true);}
if(lIndex<lCacheRef.structure.length-1){lMapIndexVisibles.set(lIndex+1,true);}} else if(lPos+lHeight>lBorneListeBottom){break;}
lPos+=lHeight;}
if(lMapIndexVisibles.size===0){lMapIndexVisibles.set(0,true);}
const lIndices_suppr=[];for(let lIndiceRange=lIndiceRangeDebut;lIndiceRange<=lIndiceRangeFin;lIndiceRange++){if(lCacheRef.mapRangesExist.has(lIndiceRange)&&!lMapIndexVisibles.has(lIndiceRange)){lIndices_suppr.push(lIndiceRange);}}
if(lIndices_suppr.length>0){let lElementFocus=null;if(GHtml.focusEstDansElement&&GHtml.focusEstDansElement(this.Nom)){lElementFocus=GHtml.getElementEnFocus();}
lAvecModif=true;const lFindExpr=[];lIndices_suppr.forEach((aIndex) =>{lFindExpr.push(`.${_getClassRange(aIndex)}`);});for(const lIndex in lCache.infosZonesColonnes){$(lCacheRef.node_gab_end[lIndex]).parent().find(lFindExpr.join(',')).remove();}
if(lElementFocus&&!$.contains(document.body,lElementFocus)){GHtml.setFocus(this.IdPremierElement);}}
const lIndices_ajout_after=[];const lIndices_ajout_before=[];for(const lIndice of lMapIndexVisibles.keys()){if(lIndice>lIndiceRangeFin){lIndices_ajout_after.push(lIndice);}
if(lIndice<lIndiceRangeDebut){lIndices_ajout_before.push(lIndice);}}
const lFuncSortNumber=(a,b) => a-b;if(lIndices_ajout_after.length>0){lAvecModif=true;_addContenu_surRefreshDyn.call(this,{indices:lIndices_ajout_after.sort(lFuncSortNumber),start:false});}
if(lIndices_ajout_before.length>0){lAvecModif=true;_addContenu_surRefreshDyn.call(this,{indices:lIndices_ajout_before.sort(lFuncSortNumber),start:true});}
if(lAvecModif){this._controleHeightLigne();}}
if(lAvecModif||lParams.surInitialisation){lIndiceRangeFin=lCacheRef.mapRangesExist.max;lIndiceRangeDebut=lCacheRef.mapRangesExist.min;let lheight_start=0;let lHeight_end=0;lCacheRef.structure.forEach((aStructure,aIndice) =>{const lHeight=lCacheRef.getHeightStructure(aStructure);if(aIndice<lIndiceRangeDebut){lheight_start+=lHeight;} else if(aIndice>lIndiceRangeFin){lHeight_end+=lHeight;}});for(const lIndex in lCache.infosZonesColonnes){lCacheRef.observer.unobserve(lCacheRef.node_gab_start[lIndex]);lCacheRef.observer.unobserve(lCacheRef.node_gab_end[lIndex]);lheight_start=Math.max(0,lheight_start);$(lCacheRef.node_gab_start[lIndex]).height(lheight_start);lCacheRef.observer.observe(lCacheRef.node_gab_start[lIndex]);lHeight_end=Math.max(0,lHeight_end);$(lCacheRef.node_gab_end[lIndex]).height(lHeight_end);lCacheRef.observer.observe(lCacheRef.node_gab_end[lIndex]);}
if(lBackupScroll){this._setScroll(lBackupScroll);}
this._cache.positionsCelluleCadreSelection={};_actualiserCadreSelection.call(this);}
let lConserverPositionElement=lParams.conserverPositionElement;if(lParams.conserverPositionElement){const lElementCellule=GHtml.getElement(this.getIdCellule(lParams.conserverPositionElement.colonne,lParams.conserverPositionElement.ligne));const lBackupScrollElement=this._backupScroll({conserverPositionScroll:true});if(lBackupScrollElement){let lPos=0;if(lElementCellule){lPos=GPosition.getClientRect(lElementCellule).top;lConserverPositionElement=null;} else if(!lBackupScroll){lPos=_getPositionTopLigneDynamiqueEvaluee.call(this,lParams.conserverPositionElement.ligne);}
const lDiffY=lPos-lParams.conserverPositionElement.rectCellule.top;if(lDiffY!==0&&lPos!==null){lBackupScrollElement.scrollTop+=lDiffY;this._setScroll(lBackupScrollElement);}}}
if(lAvecModif&&lParams.refreshRecursif){if(lParams.indiceRecursif>10){return;}
_refreshContenuDynamique.call(this,{refreshRecursif:true,indiceRecursif:lParams.indiceRecursif>0?lParams.indiceRecursif+1:1,conserverPositionElement:lConserverPositionElement});}}
function _scrollSurSelection(aColonne,aLigne){if(!this.optionsInterne.scrollSurSelection){return;}
const lBackupScroll=this._backupScroll({conserverPositionScroll:true});if(!lBackupScroll){return;}
const lJScroll=this.optionsInterne.scrollSurSelection.getJScroll(lBackupScroll);if(!lJScroll||lJScroll.length===0){return;}
const lJCellule=$('#'+this.getIdCellule(aColonne,aLigne).escapeJQ());let lTopCelluleDansContenu=0;let lHeightCellule=0;const lRectContenuScroll=GPosition.getClientRect(lJScroll.get(0));if(lJCellule.length===0){const lCacheRef=this._cache.refresh;if(!lCacheRef.avecConstructionDynamiqueContenu){return;}
lHeightCellule=lCacheRef.hauteurMoyenneLigne;lTopCelluleDansContenu=_getPositionTopLigneDynamiqueEvaluee.call(this,aLigne);} else{const lPosTop_Cellule=GPosition.getClientRect(lJCellule.get(0)).top;lHeightCellule=lJCellule.height();lTopCelluleDansContenu=lPosTop_Cellule-lRectContenuScroll.top;}
const lScrollTopZone=this.optionsInterne.scrollSurSelection.getScrollTop(lJScroll);if(lTopCelluleDansContenu<0){this.optionsInterne.scrollSurSelection.setScroll(lJScroll,lScrollTopZone+lTopCelluleDansContenu);_refreshContenuDynamique.call(this,{avecBackupScroll:true,refreshRecursif:true});return;}
const lZoneHeight=lJScroll.height();if(lTopCelluleDansContenu+lHeightCellule>lZoneHeight){this.optionsInterne.scrollSurSelection.setScroll(lJScroll,lTopCelluleDansContenu+lHeightCellule-lZoneHeight+lScrollTopZone);_refreshContenuDynamique.call(this,{avecBackupScroll:true,refreshRecursif:true});}}
function _construireListeFiltres(){const T=[];this._cache.listeChipsFiltres=this._options.listeChipsFiltres;if(this._cache.listeChipsFiltres&&this._cache.listeChipsFiltres.length>0){this._cache.listeChipsFiltres.forEach((aChips,aIndex) =>{if(!aChips.event){return;}
if(!aChips.eventBtn){return;}
T.push(tag('ie-chips',{class:'iconic icon_filtre','ie-model':tag.funcAttr('liste.chipsFiltre',[aIndex])}));});}
return T.join('');}
_ObjetListe.protected={_getParamsCellule,_getParamsCallback,_etatSelectionCellule,_actualiserCadreSelection,_refreshSelf,_surSuppression,_positionnerCurseurTri,_surLigneCreationUnique,_avecBoutonsListeHautScroll,_avecBoutonsListeEntete,_actualiser,_SurApresEditionEvenement,_getLargeurPartieScrollV,_estColonneVisible,_initCacheLignes,_getIdCreation,_getHeightCellule,_calculColonnesCachees,_calculerTaillesColonnes,_extraireInfosId,_annulerCreation,_finaliserEdition,_nettoyerElementsEditionEnCours,_getLeftCurseurTri,_getListeElementsSelection,_estSelectionParCellule,_surSelection,_SurSelectionEvenement,_SurCreationDeb,_SurCreation,_SurCreationFin,_editionDebSurSelection,_SurEdition,_SurEditionDeb,_surEditionFin,_navigationCelluleSuivante,_navigationFlechesClavier,_estToucheNavigationFlechesClavier,_getFusionColonnesCellule,_celluleAvecBordureDroite,_colonneCreationUniqueEnErreur,_estLigneVisible,_getNonEditable,_deploiementSurCellule,_SurDeploiement,_avecLigneCreationTitre,_avecSuppressionSelectionCourante,_surClickCelluleTotal,_isToucheRetourChariot,_SurCreationEvenement,_getDiffLargeurContenu,_modifierCBLigne_flatDesign,_surDeplacementLigneSurAutreLigne,_construireBoutonsEntete,_getClassRange,_refreshContenuDynamique,_getPositionTopLigneDynamiqueEvaluee,_construireListeFiltres};module.exports=_ObjetListe;},fn:"_objetliste.js"});;
IE.fModule({f:function(exports,require,module,global){require('Produit/Css/ObjetListeEspaceMobile.css');require('Mobile/Css/ObjetListe_Mobile.css');const _ObjetListe=require('_ObjetListe.js');const GHtml=require('GHtml.js');const ObjetDonneesListe=require('ObjetDonneesListe.js');const ObjetListeElements=require('ObjetListeElements.js');const GTraductions=require('ObjetTraduction.js');const ObjetFenetre=require('ObjetFenetre.js');const{Invocateur}=require('Invocateur.js');const tag=require('tag.js');const _getParamsCellule=_ObjetListe.protected._getParamsCellule;class ObjetListe_Mobile extends _ObjetListe{constructor(...aParams){super(...aParams);Object.assign(this.optionsInterne,{avecActualisationParZone:false,versionMobile:true,surEditionTextFenetre_promise:_surEditionTextFenetre_promise.bind(this),getClassListe:() =>{const lClasses=[];if(this._options.hauteurAdapteContenu&&!document.querySelector(`#${this.Nom.escapeJQ()} .liste_scroll`)){lClasses.push('hauteur-auto');}
return lClasses.join(' ');},scrollSurSelection:{getJScroll:(aBackupScroll) =>{let lElementScroll=aBackupScroll.element;if(aBackupScroll.getterScroll){lElementScroll=aBackupScroll.getterScroll()||lElementScroll;}
return $(lElementScroll);},getScrollTop:(aJScroll) =>{return aJScroll.get(0).scrollTop;},setScroll:(aJScroll,aValScroll) =>{aJScroll.get(0).scrollTop=aValScroll;}}});this.ids.zoneFils=this.idZone;this.IdPremierElement=this.idZone;Invocateur.abonner('fenetre_mobile_finOuverture',function(aFenetre){let lPere=this.Pere;let lCpt=0;while(lPere&&lCpt<1000){if(lPere===aFenetre){this.Actualiser(true);return;}
lPere=lPere.Pere;lCpt+=1;}},this);}
resetOptions(){super.resetOptions();Object.assign(this._options,{nonEditable:true,forcerScrollV_mobile:null,avecCelluleEditableTriangle:true,avecCocheCheckBox:false,paddingCelluleLR:0,paddingCelluleTB:0,nbLignesMax:0});return this;}
getControleur(aInstance){return $.extend(true,super.getControleur(this),{liste:{nodeTdCellule:function(aLigne,aColonne){$(this.node).on({mousedown:function(aEvent){if(aInstance._cache.finEditionCreation){aInstance._cache.finEditionCreation();return;}
if(aInstance._cache.editionEnCoursEvenement){aInstance._cache.editionEnCoursEvenement=false;_ObjetListe.protected._nettoyerElementsEditionEnCours.call(aInstance);}
if(aEvent.originalEvent&&aEvent.originalEvent.__cancelEventListe__){return;}
const lSansSelection=!_ObjetListe.protected._surSelection.call(aInstance,aColonne,aLigne,{ctrlKey:aEvent.ctrlKey,shiftKey:aEvent.shiftKey,surInteractionUtilisateur:true});if(!lSansSelection){_ObjetListe.protected._SurSelectionEvenement.call(aInstance,aColonne,aLigne);}
if(_ObjetListe.protected._SurDeploiement.call(aInstance,aEvent,aColonne,aLigne)){aEvent.preventDefault();}},click:function(aEvent){if(aEvent.originalEvent&&aEvent.originalEvent.__cancelEventListe__){return;}
_ObjetListe.protected._editionDebSurSelection.call(aInstance,aColonne,aLigne,aEvent);if(aInstance.Donnees&&aInstance.Donnees.options.avecCocheCBSurLigne){_ObjetListe.protected._modifierCBLigne_flatDesign(aInstance,_getParamsCellule.call(aInstance,aColonne,aLigne));}}});},getClassNodeOmbre(){const lNode=$(`#${aInstance.Nom.escapeJQ()} .liste_scroll`).get(0);if(lNode&&lNode.clientHeight<lNode.scrollHeight){this.node.classList.remove('hide');} else{this.node.classList.add('hide');}},nodeCelluleTotal:function(){const lEventMapCelluleTd={click:_ObjetListe.protected._surClickCelluleTotal};const lData={instance:aInstance};$(this.node).on(lEventMapCelluleTd,lData);},nodeCreation:function(){$(this.node).eventValidation(function(){_surBtnCreation.call(aInstance,this);});},celluleCoche:{getValue:function(aNumeroLigne,aNumeroColonne,aValeur){return aValeur===true||aValeur===ObjetDonneesListe.EGenreCoche.Verte;},getIndeterminate:function(aNumeroLigne,aNumeroColonne,aValeur){return aValeur===ObjetDonneesListe.EGenreCoche.Grise;},setValue:function(){},getDisabled:function(aNumeroLigne,aNumeroColonne){if(_ObjetListe.protected._getNonEditable.call(aInstance)){return true;}
const lParamsCellule=_ObjetListe.protected._getParamsCellule.call(aInstance,aNumeroColonne,aNumeroLigne);return!aInstance.Donnees.AvecEdition(lParamsCellule.colonne,lParamsCellule.article,lParamsCellule);}},boutonListeEntete:{event:function(aIndex,aEvent){const lBouton=aInstance._cache.boutons[aIndex];if(lBouton.event){const lParams={bouton:lBouton,event:aEvent,liste:aInstance,node:this.node,avecFocus:true};lBouton.event(lParams);}},getDisabled:function(aIndex){const lBouton=aInstance._cache.boutons[aIndex];if(lBouton.getDisabled){return lBouton.getDisabled({bouton:lBouton,node:this.node,liste:aInstance});}}},boutonListePied:{attr:function(aIndex){const lBouton=aInstance._cache.boutons[aIndex];if(lBouton.getDisabled){return{disabled:lBouton.getDisabled({bouton:lBouton,node:this.node,liste:aInstance})};}},node:function(aIndex){const lBouton=aInstance._cache.boutons[aIndex];if(lBouton.event){$(this.node).eventValidation(function(aEvent){const lParams={bouton:lBouton,event:aEvent,liste:aInstance,node:this,avecFocus:true};lBouton.event(lParams);});}}}}});}
_construireAffichage(){const lHtmlEntete=_ObjetListe.protected._construireBoutonsEntete(this);const lAvecEntete=!!lHtmlEntete;return tag('div',{class:['ObjetListe'],'ie-class':'liste.getClassListe',id:this.idZone,tabIndex:0},lHtmlEntete,_avecScrollListe.call(this,lAvecEntete)||this._options.forcerOmbreScrollTop?tag('div',{class:'ombre-scroll top','ie-class':lAvecEntete||this._options.forcerOmbreScrollTop?false:'liste.getClassNodeOmbre'},tag('div')):'',_construireZoneScroll.call(this,lAvecEntete));}
_getTabElementsPourRsizeObserver(){return[GHtml.getElement(this.idZone)];}
_getInfosZonesColonnes(aCache){aCache.infosZonesColonnes=[];aCache.avecScrollHorizontal=false;aCache.avecScrollHMultiZonePrevu=false;if(!this.ListeTailles){return;}
const lInfos={dernierBloc:true,indiceColonneDebut:0,indiceColonneFin:this.ListeTailles.length-1,indiceBloc:aCache.infosZonesColonnes.length,estBlocFixe:false,gabaritColonnesTitre:[],colonnesVisibles:[],largeurBloc:0};for(let lColonne=lInfos.indiceColonneDebut;lColonne<=lInfos.indiceColonneFin;lColonne++){if(!aCache.tableauColonnesCachees[lColonne]){lInfos.colonnesVisibles.push(lColonne);}}
if(lInfos.colonnesVisibles.length>0){lInfos.indiceColonneDebut=lInfos.colonnesVisibles[0];lInfos.indiceColonneFin=lInfos.colonnesVisibles[lInfos.colonnesVisibles.length-1];if(aCache.infosZonesColonnes.length>0){aCache.infosZonesColonnes[aCache.infosZonesColonnes.length-1].dernierBloc=false;}
aCache.infosZonesColonnes.push(lInfos);}}
_backupScroll(aParams){let lBackupScroll=null;if(!aParams.conserverPositionScroll){return{scrollTop:0};}
let lGetterScroll=() =>{return $('#'+this.Nom.escapeJQ()+'>.ObjetListe>div.liste_scroll').get(0);};let lScroll=lGetterScroll();if(!lScroll){lScroll=GHtml.getElement(this.Nom);lGetterScroll=null;}
while(lScroll&&!lBackupScroll&&GHtml.estElement(lScroll)){let lAvecScroll=lScroll.scrollTop>0;if(!lAvecScroll){const lOverflow=$(lScroll).css('overflow');lAvecScroll=lOverflow==='auto'||lOverflow==='scroll';}
if(lAvecScroll){lBackupScroll={element:lScroll,getterScroll:lGetterScroll,scrollTop:lScroll.scrollTop};break;}
lGetterScroll=null;lScroll=GHtml.getParent(lScroll);}
return lBackupScroll;}
_setScroll(aBackupScroll){if(aBackupScroll&&aBackupScroll.element){let lElement=aBackupScroll.element;if(aBackupScroll.getterScroll){lElement=aBackupScroll.getterScroll()||lElement;}
if(lElement){lElement.scrollTop=aBackupScroll.scrollTop;}}}
_construireContenu_range(aInfosColonnes,aIndiceRange){return _construireContenu_range.call(this,aInfosColonnes,aIndiceRange);}}
ObjetListe_Mobile.initColonne=_ObjetListe.initColonne;ObjetListe_Mobile.getTitreCreation=_ObjetListe.getTitreCreation;ObjetListe_Mobile.typeBouton=_ObjetListe.typeBouton;ObjetListe_Mobile.skin=_ObjetListe.skin;function _surBtnCreation(aNodeBouton){if(this._options.avecCreationEnBouton){_ObjetListe.protected._SurCreationEvenement.call(this,-1,{nodeBouton:aNodeBouton});} else{_ObjetListe.protected._SurCreationDeb.call(this,false);}}
function _construireTitre(){const H=[];if(!this.ListeTitres){return'';}
this.ListeTitres.forEach((aTitre) =>{aTitre.forEach((aLigne,aIndice) =>{const lDescripteurTitre=aLigne;H.push('<li class="collection-header">',lDescripteurTitre.libelleHtml?lDescripteurTitre.libelleHtml:lDescripteurTitre.estCoche?'<div style="position:relative; left: .4rem; width:16px; overflow:hidden;">'+'<div ie-event="click->liste.surClickCocheTitre('+aIndice+')" id="'+(this.ids.cocheTitre+aIndice)+'" class="Image_CochePourTitre as-icon"  ie-class="liste.getClassCocheTitre('+aIndice+')"></div></div>':lDescripteurTitre.libelle||'','</li>');});});return H.join('');}
function _getClassCouleurCellule(aParamsCellule){const lClassAction=(this._options.avecCelluleEditableTriangle&&this.Donnees.avecBordureDroite(aParamsCellule)?'with-action':'with-action-simple')+' waves-effect waves-theme-claire';let lClass='';if(!_ObjetListe.protected._getNonEditable.call(this)&&(this.Donnees.AvecEdition(aParamsCellule.colonne,aParamsCellule.article,aParamsCellule)||this.Donnees.AvecEvenement_Edition(aParamsCellule.colonne,aParamsCellule.article,aParamsCellule))){lClass=lClassAction;}
const LCouleurCellule=this.Donnees.GetCouleurCellule(aParamsCellule,aParamsCellule.colonne,aParamsCellule.article);if((LCouleurCellule!==null&&LCouleurCellule!==undefined)){switch(LCouleurCellule){case ObjetDonneesListe.ECouleurCellule.Blanc:return lClassAction;case ObjetDonneesListe.ECouleurCellule.Gris:return'';default:return lClass;}} else{return lClass;}}
function _composeCoche(aParams){const lValeur=this.Donnees._GetValeur(aParams);if(this._options.avecCocheCheckBox){return['<div class="liste_cellule_cb">','<ie-checkbox',GHtml.composeAttr('ie-model','liste.celluleCoche',[aParams.ligne,aParams.colonne,lValeur]),'></ie-checkbox>','</div>'
].join('');}
if(lValeur===true||lValeur===ObjetDonneesListe.EGenreCoche.Verte){return'<div class="Image_CocheVerte as-icon" style="width:18px; margin:0 auto;">&nbsp;</div>';}
if(lValeur===ObjetDonneesListe.EGenreCoche.Grise){return'<div class="Image_CocheGrise as-icon" style="width:18px; margin:0 auto;">&nbsp;</div>';}
return'';}
function _composeDeploiement(aParamsCellule){return['<i class="',(this.Donnees._estDeploye(aParamsCellule.ligne)?'icon_fleche_num_bas':'icon_fleche_num'),'"></i>'].join('');}
function _construireCellule(aParamsCellule,aTypeValeur,aId,aTaille){let lContenuAffichage={valeur:''};let lAvecDeploiementCellule=false;switch(aTypeValeur){case ObjetDonneesListe.ETypeCellule.Coche:lContenuAffichage={valeur:_composeCoche.call(this,aParamsCellule)};break;case ObjetDonneesListe.ETypeCellule.CocheDeploiement:if(this.Donnees.estUnDeploiement(aParamsCellule)){lContenuAffichage.valeur=_composeDeploiement.call(this,aParamsCellule);}
break;case ObjetDonneesListe.ETypeCellule.Image:;break;default:lContenuAffichage=this.Donnees._GetContenuAffichage(aParamsCellule);if(_ObjetListe.protected._deploiementSurCellule.call(this,aParamsCellule)&&this.Donnees.avecImageSurColonneDeploiement(aParamsCellule)){lAvecDeploiementCellule=true;const lAvecEvent=!this.Donnees.avecEventDeploiementSurCellule(aParamsCellule);lContenuAffichage.valeur=['<div',(lAvecEvent?GHtml.composeAttr('ie-node','liste.nodeDeploiementLigne',[aParamsCellule.ligne,aParamsCellule.colonne]):''),'>',_composeDeploiement.call(this,aParamsCellule),'</div>',lContenuAffichage.valeur
].join('');}}
const lClassesDIV=['liste_cellule_div','liste_contenu_ligne',this.Donnees.getClass(aParamsCellule,aParamsCellule.colonne,aParamsCellule.article)||''
];if(lAvecDeploiementCellule){lClassesDIV.push('liste_cellule_div_depl');}
let lStyleDIV='';if(!aTaille.estPourcent&&!aTaille.valeurRem){lStyleDIV='width:'+aTaille.px+'px;';}
const lIndentation=this.Donnees.getIndentationCellule(aParamsCellule)||0;if(lIndentation>0){lStyleDIV+='padding-left:'+lIndentation+'px;';}
lStyleDIV+=this.Donnees.getStyle(aParamsCellule,aParamsCellule.colonne,aParamsCellule.article)||'';return['<div id="',aId+'_div','" class="',lClassesDIV.join(' ').trim(),'"',(lStyleDIV?' style="'+lStyleDIV+'"':''),'>',lContenuAffichage.valeur,'</div>'
].join('');}
function _construireContenu(){const H=[];this._cache.positionsCelluleCadreSelection={};const lCacheRef=this._cache.refresh;lCacheRef.init();const lIndiceInfosColonne=0;const lInfosColonnes=this._cache.infosZonesColonnes[lIndiceInfosColonne];const lNbColonnesVisibles=lInfosColonnes.colonnesVisibles.length;const lStyles=[tag.styleToStr('grid-column',`1/${lNbColonnesVisibles+1}`)];const lHtmlFiltre=_ObjetListe.protected._construireListeFiltres.call(this);if(lHtmlFiltre){H.push(tag('div',{class:'liste-filtres',style:lStyles},lHtmlFiltre));}
lCacheRef.avecConstructionDynamiqueContenu=this._options.avecConstructionDynamiqueContenu&&this._cache.lignesVisibles.length>lCacheRef.nbLignes*5;if(lCacheRef.avecConstructionDynamiqueContenu){let lNbLignesRestantes=this._cache.lignesVisibles.length;let lIndiceLigneDebut=0;while(lNbLignesRestantes>0){const lNbLignes=lNbLignesRestantes<lCacheRef.nbLignes?lNbLignesRestantes:lCacheRef.nbLignes;lCacheRef.structure.push({deb:lIndiceLigneDebut,fin:lIndiceLigneDebut+lNbLignes-1,nbLignes:lNbLignes,height:-1});lIndiceLigneDebut+=lNbLignes;lNbLignesRestantes=Math.max(0,lNbLignesRestantes-lNbLignes);}
H.push(tag('div',{'ie-node':tag.funcAttr('liste.nodeGabaritRefresh',[true,lIndiceInfosColonne]),class:'gabarit-refresh',style:lStyles}));}
H.push(_construireContenu_range.call(this,lInfosColonnes,0));if(lCacheRef.avecConstructionDynamiqueContenu){H.push(tag('div',{'ie-node':tag.funcAttr('liste.nodeGabaritRefresh',[false,lIndiceInfosColonne]),class:'gabarit-refresh',style:lStyles}));}
return H.join('');}
function _construireContenu_range(aInfosColonnes,aIndiceRange){const H=[];const lNbColonnesVisibles=aInfosColonnes.colonnesVisibles.length;const lClasseRange=this._cache.refresh.avecConstructionDynamiqueContenu?_ObjetListe.protected._getClassRange(aIndiceRange):'';let lRangeLignes;if(this._cache.refresh.avecConstructionDynamiqueContenu){lRangeLignes={debut:this._cache.refresh.structure[aIndiceRange].deb,fin:this._cache.refresh.structure[aIndiceRange].fin+1};} else{lRangeLignes={debut:0,fin:this._cache.lignesVisibles.length};}
for(let lIndiceLigne=lRangeLignes.debut;lIndiceLigne<lRangeLignes.fin;lIndiceLigne++){const lNumeroLigne=this._cache.lignesVisibles[lIndiceLigne];if((lIndiceLigne>0||aIndiceRange>0)&&!this.Donnees.enConstruction_cacheRechercheTexte&&lNbColonnesVisibles===1&&this.Donnees.avecSeparateurLigneHaut_flatdesign&&this.Donnees.avecSeparateurLigneHaut_flatdesign(_getParamsCellule.call(this,-1,lNumeroLigne),_getParamsCellule.call(this,-1,lNumeroLigne-1))){H.push(tag('hr',{class:['liste_sepligne',lClasseRange]}));}
aInfosColonnes.colonnesVisibles.forEach((aNumeroColonne,aIndex) =>{const lEstDerniereColonne=aIndex+1>=lNbColonnesVisibles;const lParamsCellule=_ObjetListe.protected._getParamsCellule.call(this,aNumeroColonne,lNumeroLigne);const lTypeValeur=this.Donnees.GetTypeValeur(lParamsCellule,lParamsCellule.colonne,lParamsCellule.article);const lTaille=this._cache.taillesColonne[aNumeroColonne];const lClasses=[];let lCelluleSelectionnee=false;if(!this.Donnees.enConstruction_cacheRechercheTexte&&this.Donnees._AvecSelection(aNumeroColonne,lNumeroLigne)){lCelluleSelectionnee=_ObjetListe.protected._etatSelectionCellule.call(this,{ligne:lNumeroLigne,colonne:aNumeroColonne});lClasses.push('waves-effect');}
Object.assign(lParamsCellule,{k:0,surEdition:false,typeValeur:lTypeValeur,taille:lTaille.px});lClasses.push('collection-item','liste_celluleGrid_'+(lIndiceLigne+1),_getClassCouleurCellule.call(this,lParamsCellule)||'',this.Donnees._getClassCelluleConteneur(lParamsCellule)||'',lCelluleSelectionnee?'selected':'',lClasseRange);if(!lEstDerniereColonne&&!this.Donnees.avecBordureDroite(lParamsCellule)){lClasses.push('liste_sansBordureD');}
const lId=this.getIdCellule(aNumeroColonne,lNumeroLigne);this._cache.collectionFuncConstructCellule[lParamsCellule.ligne+'_'+lParamsCellule.colonne]=_construireCellule.bind(this,lParamsCellule,lTypeValeur,lId,lTaille);H.push(tag('li',{id:lId,'ie-node':!this.Donnees.enConstruction_cacheRechercheTexte?tag.funcAttr('liste.nodeTdCellule',[lNumeroLigne,aNumeroColonne]):false,class:lClasses},this._cache.collectionFuncConstructCellule[lParamsCellule.ligne+'_'+lParamsCellule.colonne]()));});}
let lResult=H.join('');if(this._cache.refresh.avecConstructionDynamiqueContenu&&!this.Donnees.enConstruction_cacheRechercheTexte&&lRangeLignes.fin>lRangeLignes.debut){lResult=tag('div',{class:lClasseRange,style:'height:0; grid-column:1/'+(lNbColonnesVisibles+1)+';','ie-nodeafter':tag.funcAttr('liste.nodeObsRange',[true,aIndiceRange,aInfosColonnes.indiceBloc])})+lResult+tag('div',{class:lClasseRange,style:'height:0; grid-column:1/'+(lNbColonnesVisibles+1)+';','ie-nodeafter':tag.funcAttr('liste.nodeObsRange',[false,aIndiceRange,aInfosColonnes.indiceBloc])});}
return lResult;}
function _construireTotal(){const lListeTotal=this.Donnees?this.Donnees.getListeLignesTotal():null;if(!this._options.avecLigneTotal&&(!lListeTotal||lListeTotal.GetNbrElements()===0)){return'';}
const H=[];const lLignes=(this.Donnees?this.Donnees.getListeLignesTotal():null)||new ObjetListeElements().AddElement(null);const lInfosColonnes=this._cache.infosZonesColonnes[0];lLignes.parcourir((aArticle,aIndexLigne) =>{let lFusions=null;if(this.Donnees){lFusions=_ObjetListe.protected._getFusionColonnesCellule.call(this,{total:true,getParamsCellule:function(aNumeroColonne){return _ObjetListe.protected._getParamsCellule.call(this,aNumeroColonne,-1,{surTotal:true,ligne:aIndexLigne,article:aArticle});}.bind(this),colonnesVisibles:lInfosColonnes.colonnesVisibles,indiceColonneDebut:lInfosColonnes.indiceColonneDebut,indiceColonneFin:lInfosColonnes.indiceColonneFin,dernierBloc:true});}
let lIndiceColonne=0;lInfosColonnes.colonnesVisibles.forEach((aNumeroColonne) =>{if(lFusions&&(!lFusions[aNumeroColonne]||!lFusions[aNumeroColonne].nbCol)){return;}
lIndiceColonne+=1;const lParams=_ObjetListe.protected._getParamsCellule.call(this,aNumeroColonne,-1,{surTotal:true});if(aArticle){lParams.ligne=aIndexLigne;lParams.article=aArticle;}
let lContenu='';let lClassLi='';let lGridColumn='';let lStyle;if(this.Donnees){lParams.typeCellule=this.Donnees.getTypeCelluleTotal(lParams);const lAvecBordureTotalVisible=this.Donnees.avecBordureTotalVisible(lParams);if(lFusions[aNumeroColonne]&&lFusions[aNumeroColonne].nbCol>1){lGridColumn='grid-column:'+lIndiceColonne+' / '+(lIndiceColonne+lFusions[aNumeroColonne].nbCol)+';';}
lStyle=lGridColumn+(this.Donnees.getStyleTotal(lParams)||'');lClassLi='collection-item liste_ligne_total '+(this.Donnees.getClassTotal(lParams)||'');if(!lAvecBordureTotalVisible){lClassLi+=' liste_sansBordureD';}
lContenu=this.Donnees.getContenuTotal(lParams);}
const lIdCellule=this.getIdCelluleTotal(lParams.colonne,lParams.ligne);H.push('<li id="',lIdCellule,'" ie-node="liste.nodeCelluleTotal" class="liste_cellule_total'+(lClassLi?' '+lClassLi:'')+'" ',(lStyle?' style="'+lStyle+'"':''),'>','<div class="liste_cellule_div">',lContenu,'</div>','</li>');});});return H.join('');}
function _getStyleGridColumn(){const H=[];const lNbColonnesVisibles=this._cache.infosZonesColonnes[0].colonnesVisibles.length;this._cache.infosZonesColonnes[0].colonnesVisibles.forEach((aNumeroColonne,aIndex) =>{const lTaille=this._cache.taillesColonne[aNumeroColonne];let lStyle='';if(lTaille.estPourcent){lStyle='minmax(1rem, '+(lTaille.pourcent/100)+'fr)';} else{const lEstDerniereColonne=aIndex+1>=lNbColonnesVisibles;lStyle=(lTaille.px+8+(lEstDerniereColonne?0:1))+'px';}
H.push(lStyle);});return H.length>0?'grid-template-columns:'+H.join(' ')+';':'';}
function _contruireBouton(aIcon,aLibelle,aAttrs){return['<button class="btn-flat"',aAttrs,'>','<div>','<div><i class="',aIcon,'"></i></div>',aLibelle?'<div>'+aLibelle+'</div>':'','</div>','</button>'
].join('');}
function _construireBoutons(){const H=[];const lHtmlBoutons=[];const lAvecCreation=_ObjetListe.protected._avecLigneCreationTitre.call(this);if(lAvecCreation){const lParams=_ObjetListe.protected._getParamsCellule.call(this,-1,-1,{surCreation:true});const lAvecInputFile=this.Donnees.avecSelecFile(lParams);const lAttr=lAvecInputFile?GHtml.composeAttr('ie-model','liste.modeleSelecFileCellule',[-1,-1,true])+' ie-selecfile ':GHtml.composeAttr('ie-node','liste.nodeCreation');lHtmlBoutons.push(_contruireBouton.call(this,this._options.avecCreationEnBouton?'icon_plus_fin':'icon_plus',this._options.avecCreationEnBouton?'':this._options.titreCreation,lAttr));}
if(this._cache.boutons&&this._cache.boutons.forEach&&!this._options.avecBoutonsDansEntete){this._cache.boutons.forEach((aBouton,aIndex) =>{if(!(aBouton.masquerBouton&&aBouton.masquerBouton())){lHtmlBoutons.push(_contruireBouton.call(this,aBouton.class,aBouton.title,GHtml.composeAttr('ie-attr','liste.boutonListePied.attr',aIndex)+GHtml.composeAttr('ie-node','liste.boutonListePied.node',aIndex)));}});}
if(lHtmlBoutons.length>0){H.push(tag('div',{class:'liste_separateur_boutons'}),tag('section',{class:'liste_boutons'},lHtmlBoutons.join('')));}
return H.join('');}
function _construireZoneScroll(aAvecEntete){let lResult=tag('div',{id:this.ids.cadreSelection+'0',class:'liste_conteneurCadreSelection'})+tag('ul',{class:'collection with-header',style:_getStyleGridColumn.call(this)},_construireTitre.call(this),_construireContenu.call(this),_construireTotal.call(this))+(this._cache.lignesVisibles.length===0&&this._options.messageContenuVide?tag('div',{class:'liste_messageVide'},this._options.messageContenuVide,tag('div',{class:'Image_No_Data'})):'')+_construireBoutons.call(this);const lAvecScroll=_avecScrollListe.call(this,aAvecEntete);if(lAvecScroll){lResult=tag('div',{class:'liste_scroll'},lResult);}
if(this._options.forcerOmbreScrollBottom||lAvecScroll){lResult+=tag('div',{class:'ombre-scroll bottom','ie-class':this._options.forcerOmbreScrollBottom?false:'liste.getClassNodeOmbre'},tag('div'));}
return lResult;}
function _avecScrollListe(aAvecEntete){return this._options.forcerScrollV_mobile===true||(this.forcerScrollV_mobile!==false&&aAvecEntete);}
function _surEditionTextFenetre_promise(aParams){var lParams=Object.assign({html:'',surCreation:false,surInputText:false,colonne:-1},aParams);let lStrTitre='';if(this.ListeTitres&&this.ListeTitres[0]){const lDescripteurTitre=this.ListeTitres[0][lParams.colonne];if(lDescripteurTitre){lStrTitre=lDescripteurTitre.libelleHtml?lDescripteurTitre.libelleHtml:lDescripteurTitre.estCoche?'':lDescripteurTitre.libelle||'';}
if(lStrTitre){if(lParams.surCreation&&this._options.titreCreation){lStrTitre=this._options.titreCreation+' - '+lStrTitre;}
if(!lParams.surCreation){lStrTitre=GTraductions.getValeur('liste.modifier')+' - '+lStrTitre;}}}
const lAvecFocusZoneSaisie=true;let lSurValidation=false;return ObjetFenetre.creerInstance(ObjetFenetre,{pere:this,initialiser:function(aInstanceFenetre){aInstanceFenetre.setOptionsFenetre({listeBoutons:[GTraductions.getValeur('Fermer'),{estValider:true,libelle:GTraductions.getValeur('Valider')}],titre:lStrTitre,avecCroixFermeture:true,fermerFenetreSurClicHorsFenetre:true,empilerFenetre:false,bloquerFocus:lAvecFocusZoneSaisie,surValiderAvantFermer:(aParams) =>{if(aParams.bouton&&aParams.bouton.estValider){lSurValidation=true;}}});const lThis=this;aInstanceFenetre.controleur.getNode=function(){GHtml.setHtml(this.node,lParams.html,{instance:lThis});if(lParams.surInputText){$(this.node).on('keyup',(aEvent) =>{if(_ObjetListe.protected._isToucheRetourChariot(aEvent)){lSurValidation=true;aInstanceFenetre.Fermer();}});}};if(lAvecFocusZoneSaisie&&lParams.surCreation){aInstanceFenetre.SurAfficher=() =>{if(lParams.surCreation){GHtml.setFocusEdit(this.IdEdition);GHtml.setSelectionEdit(this.IdEdition);}};}}}).Afficher(tag('div',{'ie-node':'getNode'})).then(() =>{if(lSurValidation){if(this._cache.finEditionCreation){this._cache.finEditionCreation();}} else{if(lParams.surCreation){_ObjetListe.protected._annulerCreation.call(this);} else{_ObjetListe.protected._surEditionFin.call(this,this._cache.selectionCellule.colonne,this._cache.selectionCellule.ligne);}}});}
module.exports=ObjetListe_Mobile;},fn:"objetliste_mobile.js"});;
IE.fModule({f:function(exports,require,module,global){if(IE.estMobile){module.exports=require('ObjetListe_Mobile.js');} else{module.exports=require('ObjetListe_Espace.js');}},fn:"objetliste.js"});;
IE.fModule({f:function(exports,require,module,global){module.exports.TypeFiltreAffichage={securisation:'securisation',coords:'coords',communication:'communication',notification:'notification',droitImage:'droitImage',signature:'signature',autorisationSortie:'autorisationSortie',documentsAFournir:'documentsAFournir',autresContacts:'autresContacts',profilPrimEnfant:'profilPrimEnfant',parametres:'parametres',style:'style',deconnexion:'deconnexion',cahierDeTexte:'cahierDeTexte',generalites:'generalites',interTitre:'interTitre'};const EGenreTypeContenu={Notifications:0,Autorisations:1,DroitImage:2,DerniereConnexion:3,MotDePasse:4,Identifiant:5,Informations:6,InfosCompteEnfant:7,INE:8,AutorisationSortie:9,ProjetsAccompagnement:10,__InformationsMedicales:11,__RestrictionsAlimentaires:12,Coordonnees:13,PreferencesContact:14,AutorisationsSupplementaires:15,AutorisationsMessages:17,DepotDocuments:18,CommunicationParents:19,ContenuCommunicationParents:20,Medecin:21,Allergies:22,sourcesConnexions:'sourcesConnexions',Signature:'signature',Style:'style',CahierDeTexte:'CahierDeTexte',Deconnexion:'Deconnexion',Generalites:'Generalites'};module.exports.EGenreTypeContenu=EGenreTypeContenu;const EGenreTelephone={mail:1,telFixe:2,telPort:3,fax:4};module.exports.EGenreTelephone=EGenreTelephone;const EListeIds={identifiant:'_ident',mdp:'_mdp',email:'_email',cbSMS:'cbSMS',cbMail:'cbMail',cbMailEtab:'cbMailEtab',cbParent:'cbParent',cbCourrier:'cbCourrier',cbMsgParent:'cbMsgParent',cbMsgEleve:'cbMsgEleve',cbMsgProfsPerso:'cbMsgProfsPerso',cbMsgContactVS:'cbMsgContactVS',cbNotifs:'cbNotif',comboDelai:'comboNotif',cbNotifsTravaux:'cbNotifTravaux',comboDelaiTravaux:'comboNotifTravaux',cbDroitImage:'cbDroitImage',cbExposerDossierMedical:'cbExposerDosierMedical',cbAutoriserHospitalisation:'cbAutoriserHospitalisation',cbAutoriserAllergies:'cbAutoriserAllergies',cbDestinataireBulletin:'cbDestinataireBulletin',cbDestinataireInfosEleve:'cbDestinataireInfosEleve',cbDestinataireInfosProf:'cbDestinataireInfosProf',cbDestinataireInfosGen:'cbDestinataireInfosGen',mdpEnfant:'mdp_enfant',sideNav:'_idSideNav',sideInterlocuteurs:'_idSideNavInterlocuteurs',sidePreferences:'_idSideNavPreferences',sideInformations:'_idSideNavInformations',sideCommunicationParents:'idsideCommunicationParents',autoriserSignature:'idAutoriserSignature'};module.exports.EListeIds=EListeIds;const EGenreDestinataire={SMS:1,Email:2,Courrier:3};module.exports.EGenreDestinataire=EGenreDestinataire;const ETypeSwitch={Bulletin:1,InfosEleve:2,InfosProfesseur:3,InfosGenerales:4};module.exports.ETypeSwitch=ETypeSwitch;},fn:"enumere_donneespersonnelles.js"});;
IE.fModule({f:function(exports,require,module,global){const TUtilitaireMessagerie=require('UtilitaireMessagerie.js');const{TypeDroits}=require('ObjetDroitsPN.js');const GTraductions=require('ObjetTraduction.js');const EGenreEspace=require('Enumere_Espace.js');const ObjetElement=require('ObjetElement.js');const TypeOrigineCreationEtiquetteMessage=require('TypeOrigineCreationEtiquetteMessage.js').TypeOrigineCreationEtiquetteMessage;const ObjetTri=require('ObjetTri.js');const ObjetRequeteListeMessagerie=require('ObjetRequeteListeMessagerie.js');const ObjetRequeteListeMessages=require('ObjetRequeteListeMessages.js');const ObjetRequeteSaisieMessage=require('ObjetRequeteSaisieMessage.js');const GChaine=require('GChaine.js');const ObjetListeElements=require('ObjetListeElements.js');const EGenreAction=require('Enumere_Action.js');const EGenreBoiteMessage=require('Enumere_BoiteMessage.js');const EGenreRessource=require('Enumere_Ressource.js');const MethodesObjet=require('MethodesObjet.js');const EGenreTriElement=require('Enumere_TriElement.js');const GHtml=require('GHtml.js');const EGenreEvenementObjetSaisie=require('Enumere_EvenementObjetSaisie.js');const{GDate}=require('ObjetDate.js');const tag=require('tag.js');const{ObjetInvocateur,Invocateur}=require('Invocateur.js');const EGenreOnglet=require('Enumere_Onglet.js');const TypeThemeBouton=require('Type_ThemeBouton.js');const ObjetFenetre=require('ObjetFenetre.js');const TypeCommandeMessagerie=require('TypeCommandeMessagerie.js').TypeCommandeMessagerie;const ETypeAffEnModeMixte=require('Enumere_MenuCtxModeMixte.js').ETypeAffEnModeMixte;const TypeGenreDiscussion=require('TypeGenreDiscussion.js').TypeGenreDiscussion;const ObjetFenetre_ListeCategoriesDiscussion=require('ObjetFenetre_ListeCategoriesDiscussion.js');const ToucheClavier=require('ToucheClavier.js');const ObjetMenuCtxMixte=require('ObjetMenuCtxMixte.js');const ObjetListe=require('ObjetListe.js');const{TypeFiltreAffichage}=require('Enumere_DonneesPersonnelles.js');const TypeApresSaisieMessage={vider:'vider'};let uFenetreAvertissementASignaler=null;let uFenetreAvertissement=null;class MoteurMessagerie{constructor(){this.options={instance:null,avecCategoriesListeEtiquettes:!IE.estMobile,estChat:false,discussionSelectionneeUniquementVisible:false,estDiscussionCommune:false,avecFiltreNonLues:false,avecTiny:TUtilitaireMessagerie.avecEditeurTiny(),callbackBrouillonAvantSaisie:null,callbackAvantSaisie:null,callbackApresSaisie:function(){}};this.donneesListeMessagerie={};this.donneesMessagesVisu={};}
setOptions(aOptions){Object.assign(this.options,aOptions);return this;}
requeteListeMessagerie(aDonnees){return new ObjetRequeteListeMessagerie(this.options.instance).lancerRequete(aDonnees).then((aParams) =>{this.donneesListeMessagerie=aParams;_traiterListeEtiquette(this.donneesListeMessagerie.listeEtiquettes,this.options.avecCategoriesListeEtiquettes);return this.donneesListeMessagerie;});}
requeteMessagesVisu(aDonnees){const lDonnees=Object.assign({message:null,marquerCommeLu:false,nbMessagesVus:undefined},aDonnees);if(!lDonnees.message){return Promise.reject();}
return new ObjetRequeteListeMessages(this.options.instance).lancerRequete(lDonnees).then((aParams) =>{if(aParams.listeBoutons){aParams.listeBoutons.setTri([ObjetTri.init('Genre',EGenreTriElement.Decroissant)]).trier();}
return aParams;});}
requeteSaisieMessage(aMessage,aAvecSauvegardeBrouillon,aParamsCallbackApresSaisie){if(!this.options.instance){return Promise.reject();}
return Promise.resolve().then(() =>{if(aAvecSauvegardeBrouillon&&this.options.callbackBrouillonAvantSaisie){return this.options.callbackBrouillonAvantSaisie(aAvecSauvegardeBrouillon);}}).then(() =>{if(aMessage){return _controleUtilisateurDansDestinataires(aMessage).then(() =>{let lListeFichiers=aMessage.listeFichiers||new ObjetListeElements();if(!lListeFichiers&&aMessage.brouillon&&aMessage.brouillon.listeFichiers){lListeFichiers=aMessage.brouillon.listeFichiers;}
aMessage.avecHtml=TUtilitaireMessagerie.avecEditionHtmlMessage();if(aMessage.avecHtml&&aMessage.contenu&&!IE.estMobile&&!this.options.avecTiny){aMessage.contenu=GChaine.ToHTML(aMessage.contenu);}
if(this.options.callbackAvantSaisie){this.options.callbackAvantSaisie();}
return new ObjetRequeteSaisieMessage(this.options.instance).addUpload({listeFichiers:lListeFichiers,listeDJCloud:lListeFichiers}).lancerRequete(aMessage).then(() =>{if(aParamsCallbackApresSaisie){return this.options.callbackApresSaisie(aParamsCallbackApresSaisie);}}).then(() =>{return{saisieMessageOK:true};});}).catch(() =>{});} else{return Promise.reject();}});}
saisieViderCorbeille(aNbMessages){GApplication.getMessage().afficher({type:EGenreBoiteMessage.Confirmation,message:GTraductions.getValeur('Messagerie.Menu_ConfirmationViderCorbeille',[aNbMessages])}).then((aGenreAction) =>{if(aGenreAction===EGenreAction.Valider){return this.requeteSaisieMessage({commande:'viderCorbeille'},true,TypeApresSaisieMessage.vider);}});}
saisieBrouillon(aBrouillon,aMessagePourReponse){return this.requeteSaisieMessage({commande:'brouillon',brouillon:aBrouillon,messagePourReponse:aMessagePourReponse,objet:aBrouillon.objet,contenu:aBrouillon.contenu,listeDestinataires:aBrouillon.listeDestinataires,listeFichiers:aBrouillon.listeFichiers});}
supprimerBrouillonConfirmation_promise(aBrouillon){const lMessage=MethodesObjet.dupliquer(aBrouillon);lMessage.listePossessionsMessages=new ObjetListeElements();lMessage.listePossessionsMessages.AddElement(MethodesObjet.dupliquer(aBrouillon));return GApplication.getMessage().afficher({type:EGenreBoiteMessage.Confirmation,message:GTraductions.getValeur('Messagerie.ConfirmationSupressionBrouillon')}).then((aAccepte) =>{if(aAccepte===EGenreAction.Valider){const lCommande={commande:'suppression',message:lMessage};return this.requeteSaisieMessage(lCommande);}});}
sauvegarderCreationBrouillon(aMessage){if(this.avecSauvegardeBrouillonAutorise()&&GApplication.droits.get(TypeDroits.communication.avecDiscussionAvancee)&&((aMessage.listeDestinataires&&aMessage.listeDestinataires.GetNbrElements()>0)||aMessage.contenu||(!aMessage.listeMessagesTransfert&&aMessage.objet)||(aMessage.listeFichiers&&aMessage.listeFichiers.GetNbrElements()>0))){return GApplication.getMessage().afficher({type:EGenreBoiteMessage.Confirmation,message:GTraductions.getValeur('Messagerie.ConfirmationEnregistrerBrouillon')}).then((aAccepte) =>{if(aAccepte===EGenreAction.Valider){return this.requeteSaisieMessage({commande:aMessage.listeMessagesTransfert?'transfert':'brouillon',brouillon:null,messagePourReponse:null,objet:aMessage.objet,contenu:aMessage.contenu,listeDestinataires:aMessage.listeDestinataires,listeMessagesTransfert:aMessage.listeMessagesTransfert,listeFichiers:aMessage.listeFichiers});}});} else{return Promise.resolve();}}
avecSauvegardeBrouillonAutorise(){return!this.options.estChat&&!GApplication.droits.get(TypeDroits.estEnConsultation);}
autoriserAjoutPJ(){return!this.options.estChat&&TUtilitaireMessagerie.avecAjoutPieceJointeMessage();}
avecIconeAvertissementListeMessagerie(){const lResult=_avecAvertissementListeMessagerie(this);if(lResult){if(uFenetreAvertissementASignaler===null){uFenetreAvertissementASignaler=true;}}
return lResult;}
ouvrirFenetreAvertissement(aSurInitialisation){if(aSurInitialisation&&!uFenetreAvertissementASignaler&&!uFenetreAvertissement){return;}
if(uFenetreAvertissement){uFenetreAvertissement.Fermer();uFenetreAvertissement=null;}
if(!_avecAvertissementListeMessagerie(this)){return;}
uFenetreAvertissementASignaler=false;uFenetreAvertissement=ObjetFenetre.creerInstance(ObjetFenetre,{pere:this.options.instance},{largeur:500,modale:false,cssFenetre:'fenetre-messagerie-avertissement',titre:tag('i',{class:'icon_warning_sign'})+' '+GTraductions.getValeur('Messagerie.TitreFenetreAvertissement'),listeBoutons:[GTraductions.getValeur('Fermer')],callbackFermer:function(){uFenetreAvertissement=null;},identConservationCoordonnees:'FenetreAvertissMotMess'});uFenetreAvertissement.Afficher(_construirePanelAvertissement(this));}
addCommandesMenuContextuelDiscussion(aParams){const lParams=Object.assign({moteur:this,message:null,listeMessages:null,listeMessagerie:this.donneesListeMessagerie.listeMessagerie,listeEtiquettes:this.donneesListeMessagerie.listeEtiquettes,menuContextuel:null,strSuperUtilisateurs:this.donneesListeMessagerie.strSuperUtilisateurs,callback:null,avecListeDestinataires:IE.estMobile,avecCommandes:true},aParams);if(lParams.avecListeDestinataires){const lMessage=aParams.message.messagePourParticipants||aParams.message.messagePourReponse;if(lMessage&&!GApplication.droits.get(TypeDroits.estEnConsultation)&&!GApplication.droits.get(TypeDroits.communication.discussionInterdit)){_addCommandeMenuContextuel(Object.assign({genre:TypeCommandeMessagerie.afficherDestinataires,numeroMessage:lMessage.GetNumero(),estPublicParticipant:false,estDestinatairesReponse:true},lParams));lParams.menuContextuel.avecSeparateurSurSuivant();}}
if(!lParams.avecCommandes){return;}
_addCommandeMenuContextuel(Object.assign({genre:TypeCommandeMessagerie.lu},lParams));_addCommandeMenuContextuel(Object.assign({genre:TypeCommandeMessagerie.nonLu},lParams));_addCommandeMenuContextuel(Object.assign({genre:TypeCommandeMessagerie.archiver},lParams));_addCommandeMenuContextuel(Object.assign({genre:TypeCommandeMessagerie.desarchiver},lParams));_addCommandeMenuContextuel(Object.assign({genre:TypeCommandeMessagerie.transferer},lParams));_addCommandeMenuContextuel(Object.assign({genre:TypeCommandeMessagerie.modifierCategories},lParams));_addCommandeMenuContextuel(Object.assign({genre:TypeCommandeMessagerie.discussionEnFenetre},lParams));_addCommandeMenuContextuel(Object.assign({genre:TypeCommandeMessagerie.modificationObjetDiscussion},lParams));lParams.menuContextuel.avecSeparateurSurSuivant();_addCommandeMenuContextuel(Object.assign({genre:TypeCommandeMessagerie.fermerDiscussion},lParams));_addCommandeMenuContextuel(Object.assign({genre:TypeCommandeMessagerie.ouvrirDiscussion},lParams));_addCommandeMenuContextuel(Object.assign({genre:TypeCommandeMessagerie.restaurer},lParams));_addCommandeMenuContextuel(Object.assign({genre:TypeCommandeMessagerie.corbeille},lParams));_addCommandeMenuContextuel(Object.assign({genre:TypeCommandeMessagerie.purger},lParams));_addCommandeMenuContextuel(Object.assign({genre:TypeCommandeMessagerie.supprimer},lParams));_addCommandeMenuContextuel(Object.assign({genre:TypeCommandeMessagerie.entrerSortirDiscussion},lParams));lParams.menuContextuel.avecSeparateurSurSuivant();_addCommandeMenuContextuel(Object.assign({genre:TypeCommandeMessagerie.signalerSuppression},lParams));}
addCommandesMenuContextuelVisuMessage(aParams){const lParams=Object.assign({moteur:this,messageListeSelection:null,messageVisu:null,listeMessages:new ObjetListeElements().AddElement(aParams.messageVisu),elementCibleCopie:null,listeMessagerie:this.donneesListeMessagerie.listeMessagerie,listeEtiquettes:this.donneesListeMessagerie.listeEtiquettes,menuContextuel:null,strSuperUtilisateurs:this.donneesListeMessagerie.strSuperUtilisateurs,callback:null,avecListeDestinataires:IE.estMobile},aParams);if(!lParams.messageVisu||!lParams.listeMessagerie){return;}
lParams.indiceListeMessagerie=TUtilitaireMessagerie.getIndiceDiscussionDeMessageVisu(lParams.listeMessagerie,lParams.messageVisu);lParams.message=lParams.listeMessagerie.GetElement(lParams.indiceListeMessagerie);if(!lParams.message){return;}
if(lParams.avecListeDestinataires&&lParams.messageVisu){_addCommandeMenuContextuel(Object.assign({genre:TypeCommandeMessagerie.afficherDestinataires,numeroMessage:lParams.messageVisu.GetNumero(),estPublicParticipant:false,estDestinatairesReponse:false},lParams));lParams.menuContextuel.avecSeparateurSurSuivant();}
_addCommandeMenuContextuel(Object.assign({genre:TypeCommandeMessagerie.afficherDiscussion},lParams));_addCommandeMenuContextuel(Object.assign({genre:TypeCommandeMessagerie.repondreMessage},lParams));if(lParams.message.brouillon){_addCommandeMenuContextuel(Object.assign({genre:TypeCommandeMessagerie.supprimer},lParams));}
_addCommandeMenuContextuel(Object.assign({genre:TypeCommandeMessagerie.copierContenuVisu},lParams));_addCommandeMenuContextuel(Object.assign({genre:TypeCommandeMessagerie.transferer},lParams));_addCommandeMenuContextuel(Object.assign({genre:TypeCommandeMessagerie.signaler},lParams));_addCommandeMenuContextuel(Object.assign({genre:TypeCommandeMessagerie.modifierCategories},lParams));}
ouvrirFenetreListeCategoriesDiscussion(aListeMessages,aListeEtiquettes,aCallback){let lAvecModif=false;ObjetFenetre.creerInstance(ObjetFenetre_ListeCategoriesDiscussion,{pere:this.options.instance},{surSaisieEtiquette:function(){lAvecModif=true;},callbackFermer:function(){if(lAvecModif){aCallback();}}}).SetDonnees({listeEtiquettes:aListeEtiquettes,listeMessages:aListeMessages});}
composeTitreBandeauDeMessageVisu(aMessage,aOptions){if(!aMessage||!this.donneesListeMessagerie.listeMessagerie){return'';}
const lOptions=Object.assign({instance:null,avecMenuActions:false,avecMenuPublic:false,callbackMenu:null},aOptions);const lThis=this;const lInstance=lOptions.instance||this.options.instance;const lControleur=lInstance.controleur;if(!lControleur){return'';}
let lTitre='';if(aMessage.estUneDiscussion){if(aMessage.nbBrouillons===1&&aMessage.nbBrouillons===aMessage.nombreMessages){lTitre=_getLibelleBrouillonNonEnvoye(aMessage,this.donneesListeMessagerie.listeMessagerie);}} else{if(aMessage.brouillon&&aMessage.pere.nbBrouillons===1&&aMessage.pere.nbBrouillons===aMessage.pere.nombreMessages){lTitre=_getLibelleBrouillonNonEnvoye(aMessage,this.donneesListeMessagerie.listeMessagerie,aMessage);}}
let lInitiateur='';if(lTitre===''){const lDiscussionRacine=TUtilitaireMessagerie.getDiscussionRacine(aMessage);if(_estMessageDetiquetteChat(aMessage)){lTitre=lDiscussionRacine.initiateur||GTraductions.getValeur('Messagerie.Moi');lInitiateur=lDiscussionRacine.initiateur;} else{lTitre=lDiscussionRacine.objet||GTraductions.getValeur('Messagerie.ObjetVideDiscussion');}}
if(GApplication.droits.get(TypeDroits.communication.discussionInterdit)){lTitre+=' ('+GTraductions.getValeur('Messagerie.InfoBandeauDicussionInterdite').ucfirst()+')';}
let lSousTitre='';let lValIEHint='';if(aMessage.estUneDiscussion){if(aMessage.public){lSousTitre=aMessage.public;if(lSousTitre===lInitiateur){lSousTitre=GTraductions.getValeur('Messagerie.Moi');}} else if(aMessage.nbPublic>1){lSousTitre=GChaine.Format(GTraductions.getValeur('Messagerie.NParticipants'),[aMessage.nbPublic||0]);if(aMessage.messagePourParticipants){lValIEHint=tag.funcAttr('moteurMessagerie.hintPublicBandeauDroite');}}}
if(GApplication.estPrimaire){lSousTitre=aMessage.strPublicLong;}
const lIcone=TUtilitaireMessagerie.getIconeMessage(aMessage);const H=[];if(lIcone){H.push(tag('i',{class:[lIcone,'icon-titre']}));}
H.push(tag('div',{class:'titre'},tag('h5',{'ie-ellipsis':true},lTitre),lSousTitre?tag('div',{class:'ie-sous-titre','ie-ellipsis':true,'ie-hint':lValIEHint},lSousTitre):''));if(lOptions.callbackMenu&&(lOptions.avecMenuPublic||lOptions.avecMenuActions)){H.push(tag('div',{'ie-identite':tag.funcAttr('moteurMessagerie.getCtxMixteBandeauDroite')}));}
if(!lControleur.moteurMessagerie){lControleur.moteurMessagerie={};}
lControleur.moteurMessagerie.hintPublicBandeauDroite=function(){return TUtilitaireMessagerie.getStrHintPublicMessage_promise(lInstance,aMessage.messagePourParticipants.GetNumero(),true ,false,this.node);};lControleur.moteurMessagerie.getCtxMixteBandeauDroite=function(){return{class:ObjetMenuCtxMixte,pere:lInstance,init:function(aMenuCtxMixte){lThis.menuCtxMixteBandeauDroite=aMenuCtxMixte;aMenuCtxMixte.setOptions({callbackAddCommandes:function(aMenu){lThis.addCommandesMenuContextuelDiscussion({avecListeDestinataires:lOptions.avecMenuPublic,avecCommandes:lOptions.avecMenuActions,message:aMessage,menuContextuel:aMenu,callback:function(aParams,aCommande){lOptions.callbackMenu(aParams,aCommande);}});}});},destroy:function(){lThis.menuCtxMixteBandeauDroite=null;}};};return H.join('');}
actualiserMenuCtxMixteBandeauDroite(){if(this.menuCtxMixteBandeauDroite){this.menuCtxMixteBandeauDroite.actualiser();}}
modifierVisibiliteListeMessagerie(aMessageSelectionne){let lEtatVisible=true;let lIndicePere=null;if(this.options.discussionSelectionneeUniquementVisible&&aMessageSelectionne){lIndicePere=TUtilitaireMessagerie.getIndiceDiscussion(this.donneesListeMessagerie.listeMessagerie,aMessageSelectionne);}
const lVoirUniquementNonLues=GApplication.parametresUtilisateur.get('Communication.DiscussionNonLues');for(let i=0;i<this.donneesListeMessagerie.listeMessagerie.GetNbrElements();i++){const lMessage=this.donneesListeMessagerie.listeMessagerie.GetElement(i);lMessage.visible=true;lEtatVisible=true;if(this.options.avecFiltreNonLues){if(lMessage.estUneDiscussion&&lVoirUniquementNonLues&&!_selectionEstMessageOuMessageFilsDeDiscussion.call(this,aMessageSelectionne,lMessage)){lEtatVisible=!lMessage.lu;}
if(lVoirUniquementNonLues){lMessage.visible=lEtatVisible;}}
if(this.options.discussionSelectionneeUniquementVisible&&lIndicePere!==null){if(lIndicePere!==TUtilitaireMessagerie.getIndicePere(this.donneesListeMessagerie.listeMessagerie,lMessage)){lMessage.visible=false;}}
if(this.options.estDiscussionCommune){const lUniquementLesCommunes=this.uniquementLesCommunes;if(lUniquementLesCommunes&&lMessage.visibleFiltre===false){lMessage.visible=false;}
if(lMessage.listePossessionsMessages){lMessage.listePossessionsMessages.parcourir((D) =>{D.ignorerSerialisation=lUniquementLesCommunes&&D.visibleFiltre===false;});}}}}
getNbMessagesSupprimablesPoubelle(){let lCpt=0;if(GApplication.droits.get(TypeDroits.communication.avecDiscussionAvancee)&&this.donneesListeMessagerie.listeMessagerie){const lEtiquette=new ObjetElement('',0,TypeOrigineCreationEtiquetteMessage.OCEM_Pre_Poubelle);this.donneesListeMessagerie.listeMessagerie.parcourir((D) =>{if(TUtilitaireMessagerie.estDiscussionVisibleSelonEtiquette(D,lEtiquette)){if(!D.estUneDiscussion){lCpt+=1;}}});}
return lCpt;}
static saisieSortirConversation(aInstance,aMessage,aPossessionMessage){let lPossessionMessage=aPossessionMessage;if(!lPossessionMessage&&aMessage&&aMessage.listePossessionsMessages){lPossessionMessage=aMessage.listePossessionsMessages.GetElement(aMessage.listePossessionsMessages.GetNbrElements()-1);}
;if(lPossessionMessage){return new ObjetRequeteSaisieMessage(aInstance).lancerRequete({commande:'entrerSortirConversation',entrer:false,possessionMessage:lPossessionMessage});}
return Promise.reject();}}
MoteurMessagerie.TypeApresSaisieMessage=TypeApresSaisieMessage;function _selectionEstMessageOuMessageFilsDeDiscussion(aMessageSelectionne,aDiscussion){if(aMessageSelectionne&&aDiscussion){if(aMessageSelectionne.estUneDiscussion){return TUtilitaireMessagerie.getIndiceDiscussion(this.donneesListeMessagerie.listeMessagerie,aMessageSelectionne)===TUtilitaireMessagerie.getIndiceDiscussion(this.donneesListeMessagerie.listeMessagerie,aDiscussion);}
if(!aMessageSelectionne.estUneDiscussion){return TUtilitaireMessagerie.getIndicePere(this.donneesListeMessagerie.listeMessagerie,aMessageSelectionne)===TUtilitaireMessagerie.getIndicePere(this.donneesListeMessagerie.listeMessagerie,aDiscussion);}}
return false;}
function _addCommandeMenuContextuel(aParams){const lCallback=function(aCommande){aParams.callback(aParams,aCommande);};const lSaisie=function(aCommande,aNePasSauvegarderBrouillons){aParams.moteur.requeteSaisieMessage(aCommande,!aNePasSauvegarderBrouillons).then((aResult) =>{if(aResult&&aResult.saisieMessageOK===true){return lCallback();}});};function _add(aTrad,aFunc,aExtendMenu,aActif){aParams.menuContextuel.add(aTrad,aActif===false?false:true,() =>{if(aFunc){aFunc();} else{lCallback();}},aExtendMenu);}
const lEnConsult=GApplication.droits.get(TypeDroits.estEnConsultation)||GApplication.droits.get(TypeDroits.communication.discussionInterdit);const lDiscussionAvancee=GApplication.droits.get(TypeDroits.communication.avecDiscussionAvancee);const lEstBrouillon=(!aParams.message.estUneDiscussion&&aParams.message.brouillon)||(aParams.message.estUneDiscussion&&(aParams.message.nbBrouillons||0)>=aParams.message.nombreMessages);switch(aParams.genre){case TypeCommandeMessagerie.afficherDestinataires:_add(GTraductions.getValeur('Messagerie.ListeDestinataires'),lCallback,{icon:'icon_intervenants'});break;case TypeCommandeMessagerie.archiver:case TypeCommandeMessagerie.desarchiver:{const lArchiver=aParams.genre===TypeCommandeMessagerie.archiver;if(!lEnConsult&&lDiscussionAvancee&&aParams.message&&aParams.message.estUneDiscussion&&(lArchiver===!aParams.message.archive)&&!aParams.message.poubelle&&!aParams.message.estNonPossede){_add(lArchiver?GTraductions.getValeur('Messagerie.Archiver'):GTraductions.getValeur('Messagerie.Desarchiver'),() =>{lSaisie({commande:'archive',archiver:lArchiver,message:aParams.message});},{icon:'icon_archiver_discussion',typeAffEnModeMixte:ETypeAffEnModeMixte.icon});}
break;}
case TypeCommandeMessagerie.transferer:if(!IE.estMobile&&!lEnConsult&&lDiscussionAvancee&&aParams.message&&!aParams.message.estNonPossede&&!TUtilitaireMessagerie.estMessageNonEditable(aParams.message)&&!lEstBrouillon){_add(aParams.message.estUneDiscussion?GTraductions.getValeur('Messagerie.Menu_TransfererLaDiscussion'):GTraductions.getValeur('Messagerie.Menu_TransfererLeMessage'),null,{icon:'icon_transferer_discussion'});}
break;case TypeCommandeMessagerie.signaler:case TypeCommandeMessagerie.signalerSuppression:if(!lEnConsult&&lDiscussionAvancee&&!lEstBrouillon&&aParams.strSuperUtilisateurs&&!TUtilitaireMessagerie.estMessageNonEditable(aParams.message)&&!aParams.message.estNonPossede){const lPourSignaler=aParams.genre===TypeCommandeMessagerie.signaler;const lActif=lPourSignaler?!aParams.message.estUneDiscussion:!!aParams.message.estUneDiscussion&&aParams.message.profondeur===0;_add(lPourSignaler?GTraductions.getValeur('Messagerie.Menu_SignalerLeMessage',[aParams.strSuperUtilisateurs]):GTraductions.getValeur('Messagerie.Menu_SignalerPourSuppr',[aParams.strSuperUtilisateurs]),() =>{lSaisie({commande:lPourSignaler?'signalement':'signalementSuppression',message:aParams.message});},{icon:'icon_warning_sign'},lActif);}
break;case TypeCommandeMessagerie.modifierCategories:if(!lEnConsult&&lDiscussionAvancee&&aParams.message&&!aParams.message.estNonPossede&&aParams.listeEtiquettes&&aParams.listeMessagerie&&!!ObjetFenetre_ListeCategoriesDiscussion){_add(aParams.message.listeEtiquettes&&
aParams.message.listeEtiquettes.getListeElements((D) =>{return TypeOrigineCreationEtiquetteMessage.estEtiquettePerso(D.GetGenre());}).GetNbrElements()>0?GTraductions.getValeur('Messagerie.Menu.ModifierCategories'):GTraductions.getValeur('Messagerie.Menu.AjouterCategories'),() =>{let lListeMessages=aParams.listeMessages||new ObjetListeElements();if(!aParams.listeMessages){if(aParams.message.estUneDiscussion){lListeMessages=aParams.listeMessagerie.getListeElements((D) =>{return D.pere===aParams.message;});} else{lListeMessages.add(aParams.message);}}
aParams.moteur.ouvrirFenetreListeCategoriesDiscussion(lListeMessages,aParams.listeEtiquettes,() =>{lCallback();});},{icon:'icon_classer_discussion'});}
break;case TypeCommandeMessagerie.corbeille:if(!lEnConsult&&aParams.message&&aParams.message.estUneDiscussion&&aParams.message.profondeur===0&&!aParams.message.poubelle&&!aParams.message.estNonPossede){_add(GTraductions.getValeur('Messagerie.Menu.Supprimer'),() =>{lSaisie({commande:'corbeille',listePossessionsMessages:aParams.message?aParams.message.listePossessionsMessages:new ObjetListeElements()});},{icon:'icon_trash',typeAffEnModeMixte:ETypeAffEnModeMixte.icon});}
break;case TypeCommandeMessagerie.restaurer:if(!lEnConsult&&aParams.message&&aParams.message.poubelle){_add(GTraductions.getValeur('Messagerie.Menu_Restaurer'),() =>{lSaisie({commande:'restauration',message:aParams.message});},{icon:'icon_undo'});}
break;case TypeCommandeMessagerie.purger:if(!lEnConsult&&aParams.message&&aParams.message.messagePurge){_add(GTraductions.getValeur('Messagerie.Menu_Purger'),() =>{_getCommandePurgerMessages_promise(true,new ObjetListeElements().add(aParams.message)).then((aParams) =>{if(aParams){lSaisie(aParams);}});},{icon:'icon_purger_messages'});}
break;case TypeCommandeMessagerie.supprimer:if(!lEnConsult&&aParams.message&&((aParams.message.estUneDiscussion&&aParams.message.poubelle)||lEstBrouillon)&&!aParams.message.estNonPossede){_add(aParams.message.estUneDiscussion?GTraductions.getValeur('Messagerie.Menu_SupprimerDefinitivement'):GTraductions.getValeur('Messagerie.MenuVisu_SupprimerBrouillon'),() =>{return GApplication.getMessage().afficher({type:EGenreBoiteMessage.Confirmation,message:GTraductions.getValeur('Messagerie.ConfirmationSuppression')}).then((aAccepte) =>{if(aAccepte===EGenreAction.Valider){lSaisie({commande:'suppression',message:aParams.message});}});},{icon:'icon_trash'});}
break;case TypeCommandeMessagerie.lu:case TypeCommandeMessagerie.nonLu:{const lLu=aParams.genre===TypeCommandeMessagerie.lu;if(!lEnConsult&&aParams.message&&!aParams.message.estNonPossede&&lLu===!aParams.message.lu){_add(lLu?GTraductions.getValeur('Messagerie.Menu.Lu'):GTraductions.getValeur('Messagerie.Menu.NonLu'),() =>{lSaisie({commande:'pourLu',lu:lLu,message:aParams.message});},{icon:lLu?'icon_eye_open':'icon_eye_close'});}
break;}
case TypeCommandeMessagerie.fermerDiscussion:case TypeCommandeMessagerie.ouvrirDiscussion:{const lOuvrir=aParams.genre===TypeCommandeMessagerie.ouvrirDiscussion;if(!lEnConsult&&lDiscussionAvancee&&aParams.message&&((lOuvrir&&aParams.message.ouvrable)||(!lOuvrir&&aParams.message.fermable))&&!aParams.message.estNonPossede&&!aParams.message.estSorti){_add(lOuvrir?GTraductions.getValeur('Messagerie.Menu_OuvrirDiscussion'):GTraductions.getValeur('Messagerie.Menu_FermerDiscussion'),() =>{return GApplication.getMessage().afficher({type:EGenreBoiteMessage.Confirmation,message:lOuvrir?GTraductions.getValeur('Messagerie.ConfirmationOuvertureDiscussion'):GTraductions.getValeur('Messagerie.ConfirmationFermetureDiscussion')}).then((aGenreAction) =>{if(aGenreAction===EGenreAction.Valider){lSaisie({commande:'pourOuvrirFermer',ouvrir:lOuvrir,message:aParams.message});}});},{icon:'icon_discussion_terminee'});}
break;}
case TypeCommandeMessagerie.entrerSortirDiscussion:if(!lEnConsult&&aParams.message&&aParams.message.avecIODicussion&&!lEstBrouillon&&aParams.message.dernierPossessionMessage){_add(aParams.message.estSorti?GTraductions.getValeur('Messagerie.Menu_Entrer'):GTraductions.getValeur('Messagerie.Menu_Sortir'),() =>{lSaisie({commande:'entrerSortirDiscussion',estSorti:aParams.message.estSorti,possessionMessage:aParams.message.dernierPossessionMessage});},{icon:'icon_sortir_reintegrer_conversation'});}
break;case TypeCommandeMessagerie.modificationObjetDiscussion:if(!lEnConsult&&aParams.message&&aParams.message.avecModifObjet&&aParams.message.dernierPossessionMessage){_add(GTraductions.getValeur('Messagerie.Menu_ModifierObjet'),() =>{return _editerObjetDiscussion_promise(aParams.moteur,aParams.message).then((aParams) =>{if(aParams&&aParams.commande){lSaisie(aParams);}});},{icon:'icon_edit'});}
break;case TypeCommandeMessagerie.discussionEnFenetre:if(!IE.estMobile&&!lEnConsult&&aParams.message&&aParams.message.messageFenetre&&aParams.message.dernierPossessionMessage&&!aParams.message.estNonPossede){_add(aParams.message.messageFenetre.GetGenre()===TypeGenreDiscussion.GD_Conversation?GTraductions.getValeur('Messagerie.Menu_FenetreConversation'):GTraductions.getValeur('Messagerie.Menu_FenetreDiscussion'),null,{icon:'icon_affichage_widget'});}
break;case TypeCommandeMessagerie.copierContenuVisu:if(aParams.messageVisu&&aParams.elementCibleCopie&&global.getSelection&&global.getSelection()&&global.getSelection().selectAllChildren){_add(GTraductions.getValeur('Messagerie.MenuVisu_Copier'),() =>{window.getSelection().selectAllChildren(aParams.elementCibleCopie);try{document.execCommand('copy');} catch(e){}},{icon:'icon_copier_liste'});}
break;case TypeCommandeMessagerie.repondreMessage:if(!GApplication.droits.get(TypeDroits.communication.discussionInterdit)&&aParams.messageListeSelection&&aParams.message&&!aParams.message.estNonPossede&&!aParams.message.estCarnetLiaison&&aParams.messageListeSelection.estUneDiscussion&&!TUtilitaireMessagerie.estMessageNonEditable(aParams.message)){_add(aParams.message.brouillon?GTraductions.getValeur('Messagerie.MenuVisu_ReprendreBrouillon'):GTraductions.getValeur('Messagerie.MenuVisu_Repondre'),lCallback,{icon:'icon_discussion_repondu'},!lEnConsult);}
break;case TypeCommandeMessagerie.afficherDiscussion:if(!GApplication.droits.get(TypeDroits.communication.discussionInterdit)&&aParams.messageListeSelection&&aParams.message&&!aParams.message.estNonPossede&&!aParams.message.brouillon&&!aParams.messageListeSelection.estUneDiscussion){_add(GTraductions.getValeur('Messagerie.MenuVisu_AfficherDiscussion'),lCallback,{icon:'icon_eye_open'},!lEnConsult);}
break;default:;}}
function _estMessageDetiquetteChat(aMessage){let lEstChat=false;if(aMessage&&aMessage.listeEtiquettes){aMessage.listeEtiquettes.parcourir((aEtiquette) =>{if([TypeOrigineCreationEtiquetteMessage.OCEM_Pre_Alerte,TypeOrigineCreationEtiquetteMessage.OCEM_Pre_ContactVS,TypeOrigineCreationEtiquetteMessage.OCEM_Pre_Conversation].indexOf(aEtiquette.GetGenre())>=0){lEstChat=true;return false;}});}
return lEstChat;}
function _getLibelleBrouillonNonEnvoye(aDiscussion,aListeMessagerie,aMessageBrouillon){let lMessageBrouillon=aMessageBrouillon;if(!lMessageBrouillon&&aListeMessagerie){const lNumeroPossession=aDiscussion.listePossessionsMessages.GetNumero(0);aListeMessagerie.parcourir((aMessage) =>{if(!aMessage.estUneDiscussion&&aMessage.brouillon&&aMessage.listePossessionsMessages&&aMessage.listePossessionsMessages.GetNumero(0)===lNumeroPossession){lMessageBrouillon=aMessage;return false;}});}
if(lMessageBrouillon&&lMessageBrouillon.transferant){return GTraductions.getValeur('Messagerie.BrouillonDiscussionTransfert');}
return GTraductions.getValeur('Messagerie.BrouillonDiscussion');}
function _getCommandePurgerMessages_promise(aPurgeSelection,aListeMessages){const lListeMessagesPurge=new ObjetListeElements();aListeMessages.parcourir((aMessage) =>{if(aMessage.messagePurge){lListeMessagesPurge.AddElement(aMessage.messagePurge);}});if(!lListeMessagesPurge||!lListeMessagesPurge.GetNbrElements||lListeMessagesPurge.GetNbrElements()===0){return Promise.resolve();}
const H=[];H.push('<b>',GTraductions.getValeur('Messagerie.ConfirmationRaccourcir_Titre'),'</b>','<br>','<br>','<div class="listeMessagerie_messConfirm">','<div class="Insecable">',GTraductions.getValeur('Messagerie.ConfirmationRaccourcir_SeulsLes'),'</div>','<div><ie-combo ie-model="combo"></ie-combo></div>','<div>',GTraductions.getValeur('Messagerie.ConfirmationRaccourcir_DerniersMessages'),'</div>','</div>',aPurgeSelection?GTraductions.getValeur('Messagerie.ConfirmationRaccourcir_DiscussionSel'):GTraductions.getValeur('Messagerie.ConfirmationRaccourcir_DiscussionToutes'),'<br><br>',GChaine.ToHTML(GTraductions.getValeur('Messagerie.ConfirmationRaccourcir_3')));const lChoix=[10,20,50,100];const lIndiceSelection=1;let lNbMaxMessages=lChoix[lIndiceSelection];const lListe=new ObjetListeElements();lChoix.forEach((aVal) =>{lListe.AddElement(new ObjetElement(aVal+'',aVal));});const lControleur={combo:{init:function(aCombo){aCombo.setOptions_ObjetSaisie({longueur:35});aCombo.SetDonnees(lListe,lIndiceSelection);},event:function(aParametres){if(aParametres.genreEvenement===EGenreEvenementObjetSaisie.selection&&aParametres.element){lNbMaxMessages=aParametres.element.GetNumero();}}}};return GApplication.getMessage().afficher({type:EGenreBoiteMessage.Confirmation,message:H.join(''),controleur:lControleur,width:430}).then((aAccepte) =>{if(aAccepte===EGenreAction.Valider){return{commande:'purger',listeMessagesPurge:lListeMessagesPurge,nbMaxMessages:lNbMaxMessages};}});}
function _editerObjetDiscussion_promise(aMoteur,aMessage){let lObjet=aMessage.objet;const lFenetre=ObjetFenetre.creerInstance(ObjetFenetre,{pere:aMoteur.options.instance},{titre:GTraductions.getValeur('Messagerie.Menu_ModifierObjet'),listeBoutons:[GTraductions.getValeur('Annuler'),{valider:true,libelle:GTraductions.getValeur('Valider')}],largeur:300});lFenetre.controleur.input={getValue:function(){return lObjet;},setValue:function(aValue){lObjet=aValue;},node:function(){$(this.node).on('keyup',(aEvent) =>{if(aEvent.which===ToucheClavier.RetourChariot){lFenetre.setBoutonFocus({valider:true});}});}};lFenetre.controleur.fenetreBtn.getDisabled=function(aBoutonRepeat){return aBoutonRepeat.element.valider&&!lObjet;};return lFenetre.Afficher(tag('span',GTraductions.getValeur('Messagerie.SaisieObjetDiscussion'))+
tag('br')+tag('br')+
tag('input',{class:IE.estMobile?'':'round-style','ie-model':'input','ie-trim':true,maxlength:TUtilitaireMessagerie.C_TailleObjetMessage,style:'width:100%;'})).then((aParams) =>{if(aParams.bouton&&aParams.bouton.valider&&lObjet){return{commande:'modificationObjetDiscussion',possessionMessage:aMessage.dernierPossessionMessage,objet:lObjet};}});}
const TypeCommandeAvertissementsMessage={purger:'purger',viderCorbeille:'viderCorbeille',corbeilleInactif:'corbeilleInactif'};function _avecAvertissementListeMessagerie(aInstance){return aInstance.donneesListeMessagerie&&(aInstance.donneesListeMessagerie.avertissements||aInstance.donneesListeMessagerie.messagerieDesactivee);}
function _construirePanelAvertissement(aInstance){const lAvertissements=aInstance.donneesListeMessagerie?aInstance.donneesListeMessagerie.avertissements:null;uFenetreAvertissement.controleur._panelAvert_={nodeAvertissements:function(aGenre){$(this.node).eventValidation(() =>{switch(aGenre){case TypeCommandeAvertissementsMessage.purger:return _getCommandePurgerMessages_promise(false,aInstance.donneesListeMessagerie.listeMessagerie).then((aCommandePurger) =>{if(aCommandePurger){return aInstance.requeteSaisieMessage(aCommandePurger,true);}});case TypeCommandeAvertissementsMessage.viderCorbeille:return aInstance.saisieViderCorbeille(lAvertissements.nbCorbeille);case TypeCommandeAvertissementsMessage.corbeilleInactif:return _discussionsInactivesDansCorbeille(aInstance);default:;}});},btnRecupererMessageDesactivation:{event:function(){aInstance.requeteSaisieMessage({commande:'recupererMessageDesactivation'},true);}},btnModifierPreferencesDesactivation:{event:function(){GEtatUtilisateur.setGenreAffichageCompteSelectionne(TypeFiltreAffichage.deconnexion);Invocateur.evenement(ObjetInvocateur.events.navigationOnglet,EGenreOnglet.InfosPerso);}}};const H=[];H.push('<div class="panelAvert-conteneur">');if(lAvertissements){H.push('<div>');H.push('<b>',GTraductions.getValeur('Messagerie.TropMessage_Titre',[lAvertissements.nbMax]),'</b>','<br><br>',GTraductions.getValeur('Messagerie.TropMessage_Conseil'),'<ul>','<li>',GTraductions.getValeur('Messagerie.TropMessage_Trier'),'</li>','<li>',GTraductions.getValeur('Messagerie.TropMessage_MettreFin'),'</li>');if(lAvertissements.avecPurge){H.push('<li><a class="Lien link"',GHtml.composeAttr('ie-node','_panelAvert_.nodeAvertissements',[TypeCommandeAvertissementsMessage.purger]),' tabindex="0">',GTraductions.getValeur('Messagerie.TropMessage_Raccourcir'),'</a></li>');}
H.push('<li><a class="Lien link"',GHtml.composeAttr('ie-node','_panelAvert_.nodeAvertissements',[TypeCommandeAvertissementsMessage.corbeilleInactif]),' tabindex="0">',GTraductions.getValeur('Messagerie.TropMessage_CorbeilleInactive'),'</a></li>');if(lAvertissements.nbCorbeille>0){H.push('<li><a class="Lien link"',GHtml.composeAttr('ie-node','_panelAvert_.nodeAvertissements',[TypeCommandeAvertissementsMessage.viderCorbeille]),' tabindex="0">',GTraductions.getValeur('Messagerie.TropMessage_ViderCorbeille'),'</a></li>');}
H.push('</ul>');H.push('</div>');}
if(aInstance.donneesListeMessagerie.messagerieDesactivee){H.push(tag('div',{class:'panelAvert-conteneur-desactive'},tag('b',GTraductions.getValeur('Messagerie.MessagerieDesactivee')),tag('ie-bouton',{'ie-model':'_panelAvert_.btnRecupererMessageDesactivation',class:[TypeThemeBouton.neutre,'small-bt']},GTraductions.getValeur('Messagerie.RecupererMessageDesactivation')),tag('ie-bouton',{'ie-model':'_panelAvert_.btnModifierPreferencesDesactivation',class:[TypeThemeBouton.neutre,'small-bt']},GTraductions.getValeur('Messagerie.ModifierPreferencesDesactivation'))));}
H.push('</div>');return H.join('');}
function _discussionsInactivesDansCorbeille(aInstance){const H=[];H.push('<b>',GTraductions.getValeur('Messagerie.ConfirmationCorbeilleInactive_Titre'),'</b>','<br>','<br>',GTraductions.getValeur('Messagerie.ConfirmationCorbeilleInactive_1'),'<div class="listeMessagerie_messConfirm">','<div class="Insecable">',GTraductions.getValeur('Messagerie.ConfirmationCorbeilleInactive_2'),'</div>','<div><ie-combo ie-model="combo"></ie-combo></div>','<div>',GTraductions.getValeur('Messagerie.ConfirmationCorbeilleInactive_3'),'</div>','</div>');const lChoix=[15,30,60];const lIndiceSelection=0;let lNbJours=lChoix[lIndiceSelection];const lListe=new ObjetListeElements();lChoix.forEach((aVal) =>{lListe.AddElement(new ObjetElement(aVal+'',aVal));});const lControleur={combo:{init:function(aCombo){aCombo.setOptions_ObjetSaisie({longueur:25});aCombo.SetDonnees(lListe,lIndiceSelection);},event:function(aParametres){if(aParametres.genreEvenement===EGenreEvenementObjetSaisie.selection&&aParametres.element){lNbJours=aParametres.element.GetNumero();}}}};GApplication.getMessage().afficher({type:EGenreBoiteMessage.Confirmation,message:H.join(''),controleur:lControleur,width:370}).then((aAccepte) =>{if(aAccepte!==EGenreAction.Valider){return;}
const lNow=new Date();const lListePossessionsMessages=new ObjetListeElements();aInstance.donneesListeMessagerie.listeMessagerie.parcourir((aMessage) =>{if(aMessage&&aMessage.dateActivite&&aMessage.listePossessionsMessages&&GDate.getNbrJoursEntreDeuxDates(aMessage.dateActivite,lNow)>lNbJours){lListePossessionsMessages.FusionnerListe(aMessage.listePossessionsMessages);}});if(lListePossessionsMessages.GetNbrElements()>0){return aInstance.requeteSaisieMessage({commande:'corbeille',listePossessionsMessages:lListePossessionsMessages},true,TypeApresSaisieMessage.vider);}});}
function _controleNbDestinatairesResponEleve(aMessage){return Promise.resolve().then(() =>{if(aMessage.commande!=='brouillon'&&
aMessage.listeDestinataires&&
aMessage.avecControleNbDest!==false){const lNbEleves=aMessage.listeDestinataires.getListeElements((D) =>{return D.GetGenre()===EGenreRessource.Eleve;}).GetNbrElements(),lNbResponsables=aMessage.listeDestinataires.getListeElements((D) =>{return D.GetGenre()===EGenreRessource.Responsable;}).GetNbrElements();if(lNbEleves+lNbResponsables>100){return GApplication.getMessage().afficher({type:EGenreBoiteMessage.Confirmation,message:!aMessage.message&&(!aMessage.messagePourReponse||!aMessage.messagePourReponse.existeNumero())?GTraductions.getValeur('Messagerie.ConfirmationDestinatairesParentsElevesNouvelle',[lNbEleves,lNbResponsables]):GTraductions.getValeur('Messagerie.ConfirmationDestinatairesParentsElevesAjout',[lNbEleves,lNbResponsables])}).then((aGenreAction) =>{if(aGenreAction===EGenreAction.NePasValider){return Promise.reject({refus:true,refus_controleNbDest:true});}});}}});}
function _controleUtilisateurDansDestinataires(aMessage){return Promise.resolve().then(() =>{return _controleNbDestinatairesResponEleve(aMessage);}).then(() =>{if(aMessage.commande!=='brouillon'&&
aMessage.listeDestinataires&&
aMessage.listeDestinataires.GetNbrElements()>=1&&
aMessage.listeDestinataires.GetElementParElement(GEtatUtilisateur.getUtilisateur())){return GApplication.getMessage().afficher({type:EGenreBoiteMessage.Confirmation,message:GTraductions.getValeur('Messagerie.ConfirmationAuteurDansDestinataires')}).then((aGenreAction) =>{if(aGenreAction===EGenreAction.NePasValider){aMessage.listeDestinataires.remove(aMessage.listeDestinataires.GetIndiceParElement(GEtatUtilisateur.getUtilisateur()));}});}});}
function _traiterListeEtiquette(aListeEtiquettes,aAvecCategories){const lAvecDiscussionAvancee=GApplication.droits.get(TypeDroits.communication.avecDiscussionAvancee);const lAvecCategories=aAvecCategories!==false&&lAvecDiscussionAvancee;let lLibelleEtiquetteToutes=GTraductions.getValeur('Messagerie.Toutes');if(GEtatUtilisateur.GenreEspace===EGenreEspace.PrimParent||GEtatUtilisateur.GenreEspace===EGenreEspace.Mobile_PrimParent){lLibelleEtiquetteToutes=GTraductions.getValeur('Messagerie.LesMiennes');}
let lElement=new ObjetElement(lLibelleEtiquetteToutes,1);lElement.toutes=true;aListeEtiquettes.AddElement(lElement);if(lAvecDiscussionAvancee){lElement=new ObjetElement(GTraductions.getValeur('Messagerie.EnCours'),2);lElement.enCours=true;aListeEtiquettes.insererElement(lElement,1);}
let lCumulEtiquettesPerso=null;if(lAvecCategories){lCumulEtiquettesPerso=new ObjetElement(GTraductions.getValeur('Messagerie.Titre.Categories'),3);lCumulEtiquettesPerso.cumulEtiquettePerso=true;lCumulEtiquettesPerso.estUnDeploiement=true;lCumulEtiquettesPerso.estDeploye=false;lCumulEtiquettesPerso.nonSelectionnable=true;aListeEtiquettes.AddElement(lCumulEtiquettesPerso);lElement=new ObjetElement(GTraductions.getValeur('Messagerie.categorie.EditerCategorieEtiquette'),4);lElement.categories=true;lElement.pere=lCumulEtiquettesPerso;lElement.nonSelectionnable=true;aListeEtiquettes.AddElement(lElement);lElement=new ObjetElement(GTraductions.getValeur('Messagerie.Titre.Historiques'));lElement.estInterTitreHistorique=true;lElement.estInterTitre=ObjetListe.typeInterTitre.h5;lElement.nonSelectionnable=true;aListeEtiquettes.AddElement(lElement);}
aListeEtiquettes.parcourir((aEtiquette) =>{if(TypeOrigineCreationEtiquetteMessage.estEtiquettePerso(aEtiquette.GetGenre())){if(lCumulEtiquettesPerso){aEtiquette.pere=lCumulEtiquettesPerso;}
if(aEtiquette.couleur){aEtiquette.libelleHtml='<div class="InlineBlock AlignementMilieuVertical PetitEspaceDroit">'+
TUtilitaireMessagerie.dessinCouleurEtiquette(aEtiquette)+'</div>'+'<div class="InlineBlock AlignementMilieuVertical">'+aEtiquette.GetLibelle()+'</div>';}}});const lEstPrimParent=GEtatUtilisateur.GenreEspace===EGenreEspace.PrimParent||GEtatUtilisateur.GenreEspace===EGenreEspace.Mobile_PrimParent;const lTriEtiquettes=[];if(lEstPrimParent){lTriEtiquettes.push(ObjetTri.init((D) =>{return D.GetGenre()!==TypeOrigineCreationEtiquetteMessage.OCEM_Pre_CarnetLiaison;}),ObjetTri.init((D) =>{return!D.toutes;}));} else{lTriEtiquettes.push(ObjetTri.init((D) =>{return lAvecDiscussionAvancee?!D.enCours:!D.toutes;}),ObjetTri.init((D) =>{return D.GetGenre()!==TypeOrigineCreationEtiquetteMessage.OCEM_Pre_Brouillon;}),ObjetTri.init((D) =>{return!D.cumulEtiquettePerso;}),ObjetTri.init((D) =>{return!TypeOrigineCreationEtiquetteMessage.estEtiquettePerso(D.GetGenre());}),ObjetTri.init((D) =>{return!D.categories;}),ObjetTri.init((D) =>{return!D.estInterTitreHistorique;}),ObjetTri.init((D) =>{return D.GetGenre()!==TypeOrigineCreationEtiquetteMessage.OCEM_Pre_CarnetLiaison;}));}
lTriEtiquettes.push(ObjetTri.init((D) =>{return D.GetGenre()!==TypeOrigineCreationEtiquetteMessage.OCEM_Pre_Conversation;}),ObjetTri.init((D) =>{return D.GetGenre()!==TypeOrigineCreationEtiquetteMessage.OCEM_Pre_ContactVS;}),ObjetTri.init((D) =>{return D.GetGenre()!==TypeOrigineCreationEtiquetteMessage.OCEM_Pre_Alerte;}),ObjetTri.init((D) =>{return!D.toutes;}),ObjetTri.init((D) =>{return D.GetGenre()!==TypeOrigineCreationEtiquetteMessage.OCEM_Pre_Archive;}),ObjetTri.init((D) =>{return D.GetGenre()!==TypeOrigineCreationEtiquetteMessage.OCEM_Pre_Poubelle;}),ObjetTri.init('Libelle'));aListeEtiquettes.setTri(lTriEtiquettes).trier();}
module.exports=MoteurMessagerie;},fn:"moteurmessagerie.js"});;
IE.fModule({f:function(exports,require,module,global){class _Cache{constructor(){this._actif=true;this._donnees=[];}
setActif(aActif){this._actif=aActif;}
getActif(){if(IE.optionsDebug&&IE.optionsDebug.desactiver_Cache){return false;}
return this._actif;}
getCle(aTableauElements){let lCle='';for(let i=0;i<aTableauElements.length;i++){lCle+=aTableauElements[i].getCle();}
return lCle;}
vider(aCle){if(aCle){if(this.existeDonnee(aCle)){this.effacer(aCle);}} else{this._donnees=[];}}
effacer(aCle){const tmpArray=[];for(const x in this._donnees){if(x!==aCle){tmpArray[x]=this._donnees[x];}}
this._donnees=tmpArray;}
existeDonnee(aCle){if(IE.optionsDebug&&IE.optionsDebug.desactiver_Cache){return false;}
if(!this.getActif()){return false;}
return(this._donnees[aCle]!==undefined);}
getDonnee(aCle){return this._donnees[aCle];}
setDonnee(aCle,aObjetDonnee){this._donnees[aCle]=aObjetDonnee;}}
module.exports=_Cache;},fn:"_cache.js"});;
IE.fModule({f:function(exports,require,module,global){const _Cache=require('_Cache.js');class CachePN extends _Cache{constructor(...aParams){super(...aParams);this._init();}
_init(){this.general=new _Cache();this.ficheScolaire=new _Cache();this.resultatsClasses=new _Cache();this.dossierVS=new _Cache();this.agenda=new _Cache();this.livretScolaire=new _Cache();this.creneauxLibres=new _Cache();}
reset(){this._init();}}
module.exports=new CachePN();},fn:"cache.js"});;
IE.fModule({f:function(exports,require,module,global){const{ObjetRequeteConsultation}=require('ObjetRequeteJSON.js');const Requetes=require('CollectionRequetes.js');const TypeEnsembleNombre=require('TypeEnsembleNombre.js');const GCache=require('Cache.js');const ObjetListeElements=require('ObjetListeElements.js');const ObjetElement=require('ObjetElement.js');class ObjetRequeteListePublics extends ObjetRequeteConsultation{constructor(...aParams){super(...aParams);}
lancerRequete(aParam){this.genres=aParam.genres;this.sansFiltreSurEleve=aParam.sansFiltreSurEleve||false;this.entreResponsables=aParam.entreResponsables;this.pourMessagerie=aParam.pourMessagerie;this.JSON={genres:new TypeEnsembleNombre().add(aParam.genres),pourMessagerie:aParam.pourMessagerie,sansFiltreSurEleve:this.sansFiltreSurEleve,avecFonctionPersonnel:aParam.avecFonctionPersonnel||false,avecFiltreDelegues:aParam.avecFiltreDelegues,classe:aParam.classe};const lCleCache=this._getCle();if(this.pourMessagerie&&GCache&&GCache.general._jetonViderCacheMessagerie&&GCache.general.existeDonnee(lCleCache)){delete GCache.general._jetonViderCacheMessagerie;GCache.general.vider(lCleCache);}
if(GCache&&GCache.general.existeDonnee(lCleCache)){return new Promise(function(aResolve,aReject){this.reussitePromesse=aResolve;this.echecPromesse=aReject;this.executerCallbackReussite(aParam.genres,GCache.general.getDonnee(lCleCache));}.bind(this));} else{return this.appelAsynchrone();}}
_getCle(){return`listePublic_${this.genres.sort().join('_')}${this.sansFiltreSurEleve}_${this.entreResponsables}_${!!this.pourMessagerie}`;}
actionApresRequete(){if(GCache){GCache.general.setDonnee(this._getCle(),this.JSONReponse);}
this.executerCallbackReussite(this.genres,this.JSONReponse);}
executerCallbackReussite(aGenres,aDonneesJSON){if(aDonneesJSON.listeFamilles){if(aDonneesJSON.listePublics){aDonneesJSON.listePublics.parcourir((aPublic) =>{if(aPublic.listeNumerosSousFamille&&aPublic.listeNumerosSousFamille.length>0){for(let i=0;i<aPublic.listeNumerosSousFamille.length;i++){const lNumeroSousFamilleRecherche=aPublic.listeNumerosSousFamille[i].N;const lGenreSousFamilleRecherche=aPublic.listeNumerosSousFamille[i].G;const lObjFamilleSousFamilleTrouve=_getFamilleEtSousFamille(aDonneesJSON.listeFamilles,lNumeroSousFamilleRecherche,lGenreSousFamilleRecherche);if(lObjFamilleSousFamilleTrouve&&lObjFamilleSousFamilleTrouve.famille){if(!aPublic.listeFamilles){aPublic.listeFamilles=new ObjetListeElements();}
let lFamilleDePublic=aPublic.listeFamilles.GetElementParElement(lObjFamilleSousFamilleTrouve.famille);if(!lFamilleDePublic){lFamilleDePublic=new ObjetElement(lObjFamilleSousFamilleTrouve.famille.GetLibelle(),lObjFamilleSousFamilleTrouve.famille.GetNumero(),lObjFamilleSousFamilleTrouve.famille.GetGenre());aPublic.listeFamilles.add(lFamilleDePublic);}
if(lObjFamilleSousFamilleTrouve.sousFamille){if(!lFamilleDePublic.listeSousFamilles){lFamilleDePublic.listeSousFamilles=new ObjetListeElements();}
let lSousFamilleDePublic=lFamilleDePublic.listeSousFamilles.GetElementParElement(lObjFamilleSousFamilleTrouve.sousFamille);if(!lSousFamilleDePublic){lSousFamilleDePublic=new ObjetElement(lObjFamilleSousFamilleTrouve.sousFamille.GetLibelle(),lObjFamilleSousFamilleTrouve.sousFamille.GetNumero(),lObjFamilleSousFamilleTrouve.sousFamille.GetGenre());lFamilleDePublic.listeSousFamilles.add(lSousFamilleDePublic);}}}}}});}}
this.callbackReussite.appel({genres:aGenres,listePublic:aDonneesJSON.listePublics,listeFamilles:aDonneesJSON.listeFamilles,listeServicesPeriscolaire:aDonneesJSON.listeServicesPeriscolaire});}}
Requetes.inscrire('ListePublics',ObjetRequeteListePublics);function _getFamilleEtSousFamille(aListeFamilles,aNumeroSousFamille,aGenreSousFamille){const lResult={famille:null,sousFamille:null};if(aListeFamilles){aListeFamilles.parcourir((aFamille) =>{if(aFamille.listeSousFamilles){aFamille.listeSousFamilles.parcourir((aSousFamille) =>{if(aSousFamille.egalParNumeroEtGenre(aNumeroSousFamille,aGenreSousFamille)){lResult.sousFamille=aSousFamille;return false;}});if(lResult.sousFamille){lResult.famille=aFamille;return false;}}});}
return lResult;}
module.exports=ObjetRequeteListePublics;},fn:"objetrequetelistepublics.js"});;
IE.fModule({f:function(exports,require,module,global){const{ObjetRequeteConsultation}=require('ObjetRequeteJSON.js');const Requetes=require('CollectionRequetes.js');class ObjetRequeteListeRessourcesPourCommunication extends ObjetRequeteConsultation{constructor(...aParams){super(...aParams);}
lancerRequete(aParametres){$.extend(this.JSON,aParametres);return this.appelAsynchrone();}
actionApresRequete(){this.callbackReussite.appel(this.JSONReponse);}}
Requetes.inscrire('ListeRessourcesPourCommunication',ObjetRequeteListeRessourcesPourCommunication);module.exports=ObjetRequeteListeRessourcesPourCommunication;},fn:"objetrequetelisteressourcespourcommunication.js"});;
IE.fModule({f:function(exports,require,module,global){const{ObjetRequeteConsultation}=require('ObjetRequeteJSON.js');const Requetes=require('CollectionRequetes.js');class ObjetRequeteListeDiffusion extends ObjetRequeteConsultation{}
Requetes.inscrire('ListeDiffusion',ObjetRequeteListeDiffusion);module.exports=ObjetRequeteListeDiffusion;},fn:"objetrequetelistediffusion.js"});;
IE.fModule({f:function(exports,require,module,global){const MethodesObjet=require('MethodesObjet.js');const ObjetDonneesListe=require('ObjetDonneesListe.js');const tag=require('tag.js');const GTraductions=require('ObjetTraduction.js');require('script/css/ObjetDonneesListeFlatDesign.css');class ObjetDonneesListeFlatDesign extends ObjetDonneesListe{constructor(aDonnees){super(aDonnees);this.setOptions({avecBoutonActionLigne:true,avecEdition:false,avecSuppression:false,avecEtatSaisie:false,avecEvnt_Creation:true,avecCB:false,avecEvnt_CB:true,avecCocheCBSurLigne:false,avecDeselectionSurNonSelectionnable:false,avecContenuTronque:false,avecDeploiement:true,avecEventDeploiementSurCellule:false,flatDesignMinimal:false,avecEllipsis:true,avecContextMenuSansSelection:true});this.estFlatDesign=true;}
getZoneGauche(aParams){return'';}
avecCB(aParams){return this.options.avecCB;}
getIconeGaucheContenuFormate(aParams){return'';}
getHintIconeGaucheContenuFormate(aParams){return'';}
getTitreZonePrincipale(aParams){return aParams.article.GetLibelle();}
getInfosSuppZonePrincipale(aParams){return'';}
getZoneComplementaire(aParams){return'';}
getZoneMessage(aParams){return'';}
estLigneOff(aParams){if(this.avecCB(aParams)){return this.getDisabledCB(aParams);}
return false;}
avecBoutonActionLigne(aParams){return this.options.avecBoutonActionLigne&&!this.estInterTitre(aParams.article);}
estInterTitre(aArticle){return!!aArticle.estInterTitre;}
avecVoileBleuHover(aParams){return!this.estInterTitre(aParams.article);}
avecSeparateurLigneHaut_flatdesign(aParamsCellule,aParamsCellulePrec){return aParamsCellule.article&&aParamsCellulePrec.article&&!this.estInterTitre(aParamsCellule.article)&&!this.estInterTitre(aParamsCellulePrec.article);}
desactiverIndentationParente(){return false;}
getValueCB(aParams){return aParams.article?aParams.article.estCoche:false;}
setValueCB(aParams,aValue){aParams.article.estCoche=aValue;}
getDisabledCB(aParams){return false;}
_GetValeur(aParams){const lAvecEllipsis=this.options.avecEllipsis;if(this.estInterTitre(aParams.article)){let lNiveau=aParams.article.estInterTitre;if(lNiveau!==ObjetDonneesListe.typeInterTitre.h4&&lNiveau!==ObjetDonneesListe.typeInterTitre.h5){lNiveau=ObjetDonneesListe.typeInterTitre.h3;}
return tag(lNiveau,{class:'fd-style-intertitre','ie-ellipsis':lAvecEllipsis},aParams.article.GetLibelle());}
const lDonneesListe=this;const H=[];const lEstUnDeploiement=!this.enConstruction_cacheRechercheTexte&&this.estUnDeploiement(aParams);const lZoneGauche=this.getZoneGauche(aParams);const lNiveauParente=this.desactiverIndentationParente()?0:_getNiveauParente(aParams);if(lEstUnDeploiement||lNiveauParente>0){H.push(tag('div',{class:'zone-deploiement'},function(aTab){if(lNiveauParente>0){for(let i=0;i<lNiveauParente;i++){aTab.push(tag('div',{class:'indentation-fils'}));}}
if(lEstUnDeploiement){const lDeploye=lDonneesListe._estDeploye(aParams.ligne);aTab.push(tag('ie-btnicon',{class:['btn-deploiement ',lDeploye?'icon_fleche_num_bas':'icon_fleche_num'],'ie-node':lDonneesListe.enImpression?'':tag.funcAttr('liste.nodeDeploiementLigne',[aParams.ligne,aParams.colonne]),title:GTraductions.getValeur('liste.DeployerReduire'),'aria-expanded':lDeploye?'true':'false'}));}}));}
let lCheckBox='';if(!this.enConstruction_cacheRechercheTexte&&this.avecCB(aParams)){lCheckBox=tag('ie-checkbox',{'ie-model':tag.funcAttr('liste.cb_ligne_flatDesign',aParams.ligne),'ie-textright':true});}
if(lZoneGauche||lCheckBox){H.push(tag('div',{class:'zone-gauche'},function(aTab){if(lCheckBox){aTab.push(lCheckBox);}
if(lZoneGauche){aTab.push(lZoneGauche);}}));}
H.push(tag('div',{class:'zone-centrale'},function(aTabCentrale){const lTitre=lDonneesListe.getTitreZonePrincipale(aParams);const lInfosSupp=lDonneesListe.getInfosSuppZonePrincipale(aParams);const lCompl=lDonneesListe.getZoneComplementaire(aParams);const lIconeGauche=lDonneesListe.getIconeGaucheContenuFormate(aParams);if(lTitre||lInfosSupp||lCompl||lIconeGauche){aTabCentrale.push(tag('div',{class:'zone-contenu-format'},function(aTabContenuFormat){if(lIconeGauche){const lHint=lDonneesListe.getHintIconeGaucheContenuFormate(aParams);aTabContenuFormat.push(tag('i',{class:['icon',lIconeGauche],title:lHint&&MethodesObjet.isString(lHint)?lHint:false,'ie-hint':lHint&&lHint.html?lHint.html:false}));}
aTabContenuFormat.push(tag('div',{class:'zone-principale'},function(aTabZonePric){if(lTitre){aTabZonePric.push(tag('h4',{'ie-ellipsis':lAvecEllipsis},lTitre));}
if(lInfosSupp){aTabZonePric.push(tag('div',{class:'infos-supp','ie-ellipsis':lAvecEllipsis},lInfosSupp));}}));if(lCompl){aTabContenuFormat.push(tag('div',{class:'zone-complementaire'},lCompl));}}));}
const lMessage=lDonneesListe.getZoneMessage(aParams);if(lMessage){aTabCentrale.push(tag('div',{class:'zone-message'},lMessage));}}));if(!this.enConstruction_cacheRechercheTexte&&this.avecBoutonActionLigne(aParams)){aParams._haspopup=true;H.push(tag('div',{class:'zone-droite'+(this.options.versionMobile||GNavigateur.isTactile?'':' btn-survol')},_construireBtnAction(aParams)));}
return H.join('');}
_AvecSelection(I,J){const lArticle=this.Donnees.GetElement(J);return!this.estInterTitre(lArticle)&&this.AvecSelection(I,lArticle);}
GetTypeValeur(){return ObjetDonneesListe.ETypeCellule.Html;}
_getClassCelluleConteneur(aParams){const lEstInterTitre=this.estInterTitre(aParams.article);const lClasses=[lEstInterTitre?'fd_intertitre':'fd_ligne'];if(this.options.flatDesignMinimal){lClasses.push('fd-design-minimal');}
if(this.estLigneOff(aParams)){lClasses.push('off');}
if(!lEstInterTitre){if(this.AvecSelection(aParams.colonne,aParams.article)||(this.options.avecCocheCBSurLigne&&this.avecCB(aParams))){lClasses.push('with-select');}}
const lClass=this.getClassCelluleConteneur(aParams);if(lClass){lClasses.push(lClass);}
return lClasses.join(' ');}
_getEtatCocheSimple(aParams){return!!this.getValueCB(aParams);}}
function _construireBtnAction(aParams){return tag('ie-btnicon',{class:'icon_ellipsis_vertical',tabindex:'-1','aria-hidden':'true','ie-model':tag.funcAttr('liste.btnEllipsisLigne',[aParams.ligne]),title:GTraductions.getValeur('liste.BtnAction')});}
function _getNiveauParente(aParams){let lNiveau=0;let lArticle=aParams?aParams.article:null;while(lArticle&&lArticle.pere){lNiveau+=1;lArticle=lArticle.pere;if(lNiveau>=10){break;}}
return lNiveau;}
module.exports=ObjetDonneesListeFlatDesign;},fn:"objetdonneeslisteflatdesign.js"});;
IE.fModule({f:function(exports,require,module,global){const MethodesObjet=require('MethodesObjet.js');const MethodesTableau=require('MethodesTableau.js');const ObjetFenetre=require('ObjetFenetre.js');const GTraductions=require('ObjetTraduction.js');const EGenreEspace=require('Enumere_Espace.js');const tag=require('tag.js');const{TypeDroits}=require('ObjetDroitsPN.js');const EGenreEtat=require('Enumere_Etat.js');const GCache=require('Cache.js');const ObjetElement=require('ObjetElement.js');const ObjetListeElements=require('ObjetListeElements.js');const ObjetTri=require('ObjetTri.js');const EGenreRessource=require('Enumere_Ressource.js');const ObjetRequeteListePublics=require('ObjetRequeteListePublics.js');const ObjetRequeteListeRessourcesPourCommunication=require('ObjetRequeteListeRessourcesPourCommunication.js');const ObjetRequeteListeDiffusion=require('ObjetRequeteListeDiffusion.js');const ObjetListe=require('ObjetListe.js');const ObjetDonneesListeFlatDesign=require('ObjetDonneesListeFlatDesign.js');const EGenreEvenementListe=require('Enumere_EvenementListe.js');var TUtilitaireMessagerie=require('UtilitaireMessagerie.js');class ObjetFenetre_DestDiscussion_Mobile extends ObjetFenetre{constructor(...aParams){super(...aParams);this.setOptionsFenetre({titre:GTraductions.getValeur('Messagerie.ListeDestinataires'),listeBoutons:[GTraductions.getValeur('Fermer')],fermerFenetreSurClicHorsFenetre:true,heightMax_mobile:true,sansPaddingContenu:true});}
ConstruireInstances(){this.identListe=this.Add(ObjetListe,(aParametres) =>{if(aParametres.genreEvenement===EGenreEvenementListe.Selection){if(aParametres.article.estListeDiff){if(!this.listesDiffusion&&GCache&&GCache.general.existeDonnee('listeDiffusion_messagerie')){this.listesDiffusion=GCache.general.getDonnee('listeDiffusion_messagerie');}
Promise.resolve().then(() =>{if(!this.listesDiffusion){return new ObjetRequeteListeDiffusion(this).lancerRequete({pourMessagerie:true}).then((aJSON) =>{if(aJSON&&aJSON.liste){this.listesDiffusion=aJSON.liste.trier();if(GCache){GCache.general.setDonnee('listeDiffusion_messagerie',aJSON.liste);}}});}}).then(() =>{_remplirListe.call(this,null,{listePublic:this.listesDiffusion},false);});} else{_surSelectionGenreRessource.call(this,aParametres.article.GetGenre(),aParametres.article.GetNumero());}}},(aListe) =>{aListe.setOptionsListe({skin:ObjetListe.skin.flatDesign});});}
pourTouteLaClasse(aNumClasse,aGenre){let result=false;let lListeClasses=this.optionsFenetre.genresDest.GetElementParGenre(parseInt(aGenre));lListeClasses=lListeClasses?lListeClasses.listeClasses:null;if(lListeClasses){if(aNumClasse==='0'){aNumClasse=0;}
const lClasse=lListeClasses.GetElementParNumero(aNumClasse);if(lClasse){const lListeEleves=lClasse.listeEleves;if(lListeEleves){const lListeElevesPossibles=lListeEleves.getListeElements(function(aEle){return this.options.discussionAvancee?!aEle.discussionInterdit:aEle.avecDiscussion;}.bind(this));if(lListeElevesPossibles){const lNumerosElevesPossibles=lListeElevesPossibles.getTableauNumeros();const lTabNumDest=this.optionsFenetre.newMsg.listeDestinataires.getTableauNumeros();result=MethodesTableau.inclus(lNumerosElevesPossibles,lTabNumDest);}}}}
return result;}
ComposeContenu(){return tag('div',{id:this.GetInstance(this.identListe).Nom,style:'height: 100%;'});}
afficher(aGenre,aUniquementAjouterDest){this.uniquementAjouterDest=aUniquementAjouterDest;const lGenreDest=this.optionsFenetre.genresDest.GetElementParGenre(aGenre);if(!lGenreDest){const lListe=new ObjetListeElements();this.optionsFenetre.genresDest.parcourir((aElement) =>{if(aElement.Actif){lListe.add(aElement);}});if(this.options.discussionAvancee&&!this.options.estChat&&this.options.avecDestinatairesListeDiffusion&&TUtilitaireMessagerie.avecListeDiffusionSelonEspace()){const lElement=new ObjetElement(GTraductions.getValeur('actualites.public.chargerListeDiffusion'));lElement.estListeDiff=true;lListe.add(lElement);}
this.GetInstance(this.identListe).SetDonnees(new DonneesListe_ChoixRess_Mobile(lListe));} else{_surSelectionGenreRessource.call(this,aGenre);}
return this.Afficher();}}
function _surSelectionGenreRessource(aGenre,aNumeroClasse){_surGenreDest_promise.call(this,aGenre,aNumeroClasse).then((aParams) =>{_remplirListe.call(this,aGenre,aParams,this.uniquementAjouterDest);});}
function _surGenreDest_promise(aGenre,aNumeroClasse){return Promise.resolve().then(() =>{if(this.optionsFenetre.listeContacts&&(this.optionsFenetre.alertePPMS||this.options.estChat)){const lListe=this.optionsFenetre.listeContacts.getListeElements(function(aElement){return aElement.GetGenre()===aGenre;});return{listePublic:lListe,surListeContacts:true};}
if(this.options.discussionAvancee){const lEleGenre=this.optionsFenetre.genresDest.GetElementParGenre(aGenre);if(lEleGenre&&lEleGenre.listePublic){return{listePublic:lEleGenre.listePublic};} else{return new ObjetRequeteListePublics(this).lancerRequete({pourMessagerie:true,genres:[aGenre],sansFiltreSurEleve:GApplication.droits.get(TypeDroits.communication.toutesClasses),avecFonctionPersonnel:true});}}
let lOnglet=null;let lFiltreElement=null;let lParamsSupplementaires=null;if(this.optionsFenetre.estDiscussionSpecifiqueResponsables(aGenre)){const lGenreFiltreExact=(aGenre* -1);if(aGenre===this.optionsFenetre.genreRequete.ParentsDelegues||aGenre===this.optionsFenetre.genreRequete.ParentsDeLaClasse){lParamsSupplementaires={classe:new ObjetElement('',aNumeroClasse,EGenreRessource.Classe)};}
lOnglet=new ObjetElement('',0,EGenreRessource.Responsable);lFiltreElement=new ObjetElement('',0,lGenreFiltreExact);} else{lOnglet=new ObjetElement('',0,aGenre);lFiltreElement=GEtatUtilisateur.getMembre();}
const lParametresRequete={onglet:lOnglet,filtreElement:lFiltreElement};if(!!lParamsSupplementaires){Object.assign(lParametresRequete,lParamsSupplementaires);}
return new ObjetRequeteListeRessourcesPourCommunication(this).lancerRequete(lParametresRequete);});}
function _remplirListe(aGenre,aDonnees,aUniquementAjouterDest){const lListeRessource=aDonnees.listePublic||aDonnees.listeRessourcesPourCommunication;let i,j,lRess,lDest,lVisible;let lAvecDeploiement=false;const lListe=new ObjetListeElements();if(MethodesTableau.existe(aGenre,[EGenreRessource.Eleve])){this.optionsFenetre.genresDest.GetElementParGenre(aGenre).listePublic=lListeRessource;this.optionsFenetre.genresDest.GetElementParGenre(aGenre).listeClasses=new ObjetListeElements();const lListeClasses=this.optionsFenetre.genresDest.GetElementParGenre(aGenre).listeClasses;let lClasse;this.optionsFenetre.genresDest.GetElementParGenre(aGenre).listePublic.setTri([ObjetTri.init('Position')]);this.optionsFenetre.genresDest.GetElementParGenre(aGenre).listePublic.trier();for(i=0;i<lListeRessource.GetNbrElements();i++){const lEle=lListeRessource.GetElement(i);for(j=0;j<lEle.classes.GetNbrElements();j++){const lClasseEle=lEle.classes.GetElement(j);lClasse=lListeClasses.GetElementParNumero(lClasseEle.GetNumero());if(!lClasse){lClasse=MethodesObjet.dupliquer(lClasseEle);lClasse.listeEleves=new ObjetListeElements();lListeClasses.AddElement(lClasse);}
lClasse.listeEleves.AddElement(lEle);}}
lListeClasses.setTri([ObjetTri.init('Libelle')]);lListeClasses.trier();for(i=0;i<lListeClasses.GetNbrElements();i++){lClasse=lListeClasses.GetElement(i);const lTouteLaClasse=this.pourTouteLaClasse(lClasse.GetNumero(),aGenre);const lPere=new ObjetElement(lClasse.GetLibelle());lListe.add(lPere);lPere.estCoche=!lTouteLaClasse;lPere.estUnDeploiement=true;lPere.estDeploye=false;lPere.estClasse=true;lPere.classe=lClasse;lAvecDeploiement=true;for(j=0;j<lClasse.listeEleves.GetNbrElements();j++){lRess=lClasse.listeEleves.GetElement(j);lDest=this.optionsFenetre.newMsg.listeDestinataires.GetElementParNumeroEtGenre(lRess.GetNumero(),null,true);lVisible=MethodesTableau.existe(GEtatUtilisateur.GenreEspace,[EGenreEspace.Mobile_Professeur,EGenreEspace.Mobile_Etablissement,EGenreEspace.Mobile_Administrateur,EGenreEspace.Mobile_PrimProfesseur,EGenreEspace.Mobile_PrimPeriscolaire,EGenreEspace.Mobile_Accompagnant,EGenreEspace.Mobile_PrimAccompagnant])?!lRess.discussionInterdit:lRess.avecDiscussion;if(lDest&&aUniquementAjouterDest){lVisible=false;}
if(lVisible){const lArticle=new ObjetElement(lRess.GetLibelle(),lRess.GetNumero());lListe.add(lArticle);lArticle.ress=lRess;lArticle.estCoche=!!lDest;lArticle.disabled=lRess.nonEditable;lArticle.pere=lPere;}}}} else if(aGenre){this.optionsFenetre.genresDest.GetElementParGenre(aGenre).listePublic=lListeRessource;this.optionsFenetre.genresDest.GetElementParGenre(aGenre).listePublic.setTri([ObjetTri.init('Position'),ObjetTri.init('Libelle')]);this.optionsFenetre.genresDest.GetElementParGenre(aGenre).listePublic.trier();for(i=0;i<lListeRessource.GetNbrElements();i++){lRess=lListeRessource.GetElement(i);lDest=this.optionsFenetre.newMsg.listeDestinataires.GetElementParNumeroEtGenre(lRess.GetNumero(),null,true);lVisible=(!lRess.discussionInterdit&&(MethodesTableau.existe(GEtatUtilisateur.GenreEspace,[EGenreEspace.Mobile_Professeur,EGenreEspace.Mobile_Administrateur,EGenreEspace.Mobile_PrimProfesseur,EGenreEspace.Mobile_PrimPeriscolaire,EGenreEspace.Mobile_Etablissement,EGenreEspace.Mobile_Accompagnant,EGenreEspace.Mobile_PrimAccompagnant])||lRess.avecDiscussion));if(lDest&&aUniquementAjouterDest){lVisible=false;}
if(lVisible){if(aDonnees&&aDonnees.surListeContacts&&!lRess.existeNumero()){} else{const lLibelleItem=[lRess.GetLibelle()+(!!lRess.delegueDesClasses?' ('+lRess.delegueDesClasses+')':'')];if(lRess.estPrincipal){lLibelleItem.push(' - <span class="Gras">',GTraductions.getValeur('fenetreCommunication.profPrincipal'),'</span>');}
if(lRess.estTuteur){lLibelleItem.push(' - <span class="Gras">',GTraductions.getValeur('fenetreCommunication.tuteur'),'</span>');}
const lArticle=new ObjetElement(lLibelleItem.join(''),lRess.GetNumero());lListe.add(lArticle);lArticle.ress=lRess;lArticle.estCoche=!!lDest;lArticle.disabled=lRess.nonEditable;}}}} else{for(i=0;i<lListeRessource.GetNbrElements();i++){lRess=lListeRessource.GetElement(i);lDest=this.optionsFenetre.newMsg.listeDestinataires.GetElementParNumeroEtGenre(lRess.GetNumero(),null,true);if(!lDest||!aUniquementAjouterDest){const lArticle=new ObjetElement(lRess.GetLibelle(),lRess.GetNumero());lListe.add(lArticle);lArticle.estListeDiff=true;lArticle.ress=lRess;lArticle.estCoche=!!lDest;lArticle.disabled=lRess.nonEditable;}}}
const lBoutons=[];if(lAvecDeploiement){lBoutons.push({genre:ObjetListe.typeBouton.deployer});}
lBoutons.push({genre:ObjetListe.typeBouton.rechercher});this.GetInstance(this.identListe).setOptionsListe({boutons:lBoutons,avecCBToutCocher:{libelle:GTraductions.getValeur('liste.toutCocher')},forcerOmbreScrollBottom:true}).SetDonnees(new DonneesListe_DestDiscussion_Mobile(lListe).setOptions({newMsg:this.optionsFenetre.newMsg,genre:aGenre,listesDiffusion:this.listesDiffusion,genresDest:this.optionsFenetre.genresDest,genreRequete:this.optionsFenetre.genreRequete}));}
class DonneesListe_ChoixRess_Mobile extends ObjetDonneesListeFlatDesign{constructor(aDonnees){super(aDonnees);this.setOptions({avecBoutonActionLigne:false,avecEvnt_Selection:true,avecTri:false});}}
class DonneesListe_DestDiscussion_Mobile extends ObjetDonneesListeFlatDesign{constructor(aDonnees){super(aDonnees);this.setOptions({avecBoutonActionLigne:false,avecCB:true,avecEvnt_CB:false,avecCocheCBSurLigne:true,avecSelection:false,avecTri:false});}
getTitreZonePrincipale(aParams){let lLibelle=aParams.article.GetLibelle();if(aParams.article.ress&&aParams.article.ress.refusMess){lLibelle=`${lLibelle} - ${GTraductions.getValeur('Messagerie.RefuseDiscussions')}`;}
return lLibelle;}
getInfosSuppZonePrincipale(aParams){return TUtilitaireMessagerie.getLibelleSuppListePublics(aParams.article.ress);}
getDisabledCB(aParams){return aParams.article.disabled||(aParams.article.ress&&aParams.article.ress.refusMess);}
setValueCB(aParams,aValue){aParams.article.estCoche=aValue;if(aParams.article.estUnDeploiement){return;}
const lNewMsg=this.options.newMsg;const lNumero=aParams.article.ress.GetNumero();if(aParams.article.estListeDiff){const lListe=this.options.listesDiffusion.GetElementParNumero(lNumero);for(let i=0;i<lListe.listePublicIndividu.GetNbrElements();i++){const lIndiv=lListe.listePublicIndividu.GetElement(i);const lDest=lNewMsg.listeDestinataires.GetElementParNumeroEtGenre(lIndiv.GetNumero(),lIndiv.GetGenre());if(lDest===undefined&&aParams.article.estCoche){const lNewDest=new ObjetElement(lIndiv.GetLibelle(),lIndiv.GetNumero(),lIndiv.GetGenre());lNewDest.SetEtat(EGenreEtat.Modification);lNewMsg.listeDestinataires.AddElement(lNewDest);} else if(!aParams.article.estCoche){const lIndDest=lNewMsg.listeDestinataires.GetIndiceExisteParNumeroEtGenre(lIndiv.GetNumero(),lIndiv.GetGenre());lNewMsg.listeDestinataires.remove(lIndDest);}}
lNewMsg.listePublic=lNewMsg.listeDestinataires.getTableauLibelles();lNewMsg.SetEtat(EGenreEtat.Modification);return;}
const lDest=lNewMsg.listeDestinataires.GetElementParNumeroEtGenre(lNumero,this.options.genre);if(lDest===undefined&&aValue){const lNewDest=new ObjetElement(this.options.genresDest.GetElementParGenre(this.options.genre).listePublic.GetElementParNumero(lNumero).GetLibelle(),lNumero,this.options.genre);lNewDest.SetEtat(EGenreEtat.Modification);lNewMsg.listeDestinataires.AddElement(lNewDest);} else if(!aValue){let lIndDest=lNewMsg.listeDestinataires.GetIndiceExisteParNumeroEtGenre(lNumero,this.options.genre);if(lIndDest===undefined&&this.options.genre===this.options.genreRequete.TousResponsablesDelegues){lIndDest=lNewMsg.listeDestinataires.GetIndiceExisteParNumeroEtGenre(lNumero,this.options.genreRequete.ParentsDelegues);}
lNewMsg.listeDestinataires.remove(lIndDest);}
lNewMsg.SetEtat(EGenreEtat.Modification);lNewMsg.listePublic=lNewMsg.listeDestinataires.getTableauLibelles();}}
module.exports=ObjetFenetre_DestDiscussion_Mobile;},fn:"objetfenetre_destdiscussion_mobile.js"});;
IE.fModule({f:function(exports,require,module,global){const{TypeDroits}=require('ObjetDroitsPN.js');const MethodesObjet=require('MethodesObjet.js');const MethodesTableau=require('MethodesTableau.js');const GChaine=require('GChaine.js');const GHtml=require('GHtml.js');const EGenreEtat=require('Enumere_Etat.js');const ObjetIdentite_Mobile=require('ObjetIdentite_Mobile.js');const ObjetElement=require('ObjetElement.js');const ObjetListeElements=require('ObjetListeElements.js');const GTraductions=require('ObjetTraduction.js');const EGenreRessource=require('Enumere_Ressource.js');const TypeHttpNotificationDonnes=require('TypeHttpNotificationDonnes.js').TypeHttpNotificationDonnes;const TUtilitaireMessagerie=require('UtilitaireMessagerie.js');const TypeHttpReponseMessage=require('TypeHttpReponseMessage.js').TypeHttpReponseMessage;const{Invocateur,ObjetInvocateur}=require('Invocateur.js');const TypeThemeBouton=require('Type_ThemeBouton.js');const ZoneFenetre=require('IEZoneFenetre.js');const ObjetMenuContextuel=require('ObjetMenuContextuel.js');const TypeGenreDiscussion=require('TypeGenreDiscussion.js').TypeGenreDiscussion;const TypeCommandeMessagerie=require('TypeCommandeMessagerie.js').TypeCommandeMessagerie;const tag=require('tag.js');const UtilitaireUrl=require('UtilitaireUrl.js');const EGenreBoiteMessage=require('Enumere_BoiteMessage.js');const EGenreAction=require('Enumere_Action.js');const MoteurMessagerie=require('MoteurMessagerie.js');const ObjetFenetre=require('ObjetFenetre.js');const ObjetFenetre_DestDiscussion_Mobile=require('ObjetFenetre_DestDiscussion_Mobile.js');require('mobile/css/ObjetDiscussion_Mobile.css');class ObjetDiscussion_Mobile extends ObjetIdentite_Mobile{constructor(...aParams){super(...aParams);this.moteurMessagerie=aParams?aParams[0].moteurMessagerie:null
;this.moteurMessagerie.setOptions({callbackApresSaisie:function(aGenre){switch(aGenre){case MoteurMessagerie.TypeApresSaisieMessage.vider:return this.masquer();}}.bind(this)});this._estAffiche=false;this.listePJ=new ObjetListeElements();this.idConteneurPanel=this.Nom+'_ConteneurPanel';this.idConversation_Reponse=this.Nom+'_ConversReponse';this.idCheckboxDirecteur=this.Nom+'_cbDirecteur';this.genreRequete={TousMembresCA:-1,ParentsDeLaClasse:-2,ParentsDelegues:-3,TousResponsablesDelegues:-4,TousResponsables:-5};const lDiscussionAvancee=GApplication.droits.get(TypeDroits.communication.avecDiscussionAvancee);this.setOptions({estSidePanel:false,estSidePanelAvecMenu:false,estChat:false,genreDiscussion:TypeGenreDiscussion.GD_Discussion,callbackEnvoyer:null,callbackNavigation:null,callbackFermeture:null,callbackBtnCreation:null,callbackSelectDiscussion:null,discussionAvancee:lDiscussionAvancee,avecPJ:TUtilitaireMessagerie.avecAjoutPieceJointeMessage(),avecHtml:TUtilitaireMessagerie.avecEditionHtmlMessage(),parametresSupplementaireSaisieDiscussion:null,genresDestinatairesAutorises:null,avecDestinatairesListeDiffusion:true,activerBoutonsBrouillon:false});this.avecInclureParentsEleves=false;Invocateur.abonner('notification_actualisationMessage',_notification_actualisationMessage,this);}
setOptions(aOptions){super.setOptions(aOptions);this.moteurMessagerie.setOptions({estChat:this.options.estChat});return this;}
estAffiche(){return this._estAffiche;}
setDonnees(aDonnees){this.donnees=Object.assign({message:null,listeBoutons:null,messagePourReponse:null,brouillon:null,conserverBrouillon:false,creationDiscussion:false,alertePPMS:null,listeMessages:null,tableauDeBord:null,listeContacts:null,titre:null,nbPossessionsMessageListe:0,estPrimParentSurEtiquetteCL:false,MAJNbMessages:false},aDonnees)
;_initGenresDest.call(this);if(!this.donnees.messagePourReponse){this.donnees.messagePourReponse=new ObjetElement();}
if(this.donnees.message){this.donnees.message.lu=true;}
if(this.donnees.creationDiscussion&&(!this.donnees.listeBoutons||this.donnees.listeBoutons.GetNbrElements()===0)){this.donnees.listeBoutons=new ObjetListeElements().AddElement(new ObjetElement(GTraductions.getValeur('Messagerie.BtnEnvoyer')));}
let lBrouillon=this.donnees.brouillon;if(this.donnees.conserverBrouillon){lBrouillon=MethodesObjet.dupliquer(this.newMsg);}
_initNewMsg.call(this,lBrouillon);this.listePJ=this.options.avecPJ&&GEtatUtilisateur.listeDonnees?GEtatUtilisateur.listeDonnees[TypeHttpNotificationDonnes.THND_ListeDocJointEtablissement]:null;this.afficher();}
afficher(){this._estAffiche=true;const lHtml=_composer.call(this);let lBackupScroll=0;let lElementScroll;if(this.donnees.MAJNbMessages){lElementScroll=_getElementScroll(this);if(lElementScroll){lBackupScroll=lElementScroll.scrollHeight-lElementScroll.scrollTop;}}
if(this.options.estSidePanel){let lJFenetre=$('#'+this.GetNom().escapeJQ());if(!ObjetDiscussion_Mobile.ids[this.GetNom()]||lJFenetre.length===0){Object.keys(ObjetDiscussion_Mobile.ids).forEach((aId) =>{const lModale=M.Sidenav.getInstance($('#'+aId.escapeJQ()));if(lModale&&lModale.isOpen){lModale.close();}});const lClass=this.options.estSidePanelAvecMenu?'side-panel-avecMenu':'';GHtml.addHtml(ZoneFenetre.getElementZoneFenetre(),'<div id="'+this.GetNom()+'" class="sidenav side-panel-complet '+lClass+'"></div>');lJFenetre=$('#'+this.GetNom().escapeJQ());const lThis=this;lJFenetre.on('destroyed',() =>{lThis.free();});M.Sidenav.init(lJFenetre,{edge:'right',draggable:false,onCloseEnd:function(){_fermer.call(this);this.free();}.bind(this)});Invocateur.desabonner(ObjetInvocateur.events.fermerFenetres,this);Invocateur.abonner(ObjetInvocateur.events.fermerFenetres,function(){this.masquer();},this);}
lJFenetre.IEHtml(lHtml,{controleur:this.controleur});_getModale.call(this).open();ObjetDiscussion_Mobile.ids[this.GetNom()]=true;lJFenetre.find('.header-titre').focus();} else if(this.options.estPanelFixe){const lConteneur=GInterface.GetInstance(GInterface.identPageMobile);const lZoneSelection=GInterface.idZoneSelection;GHtml.addHtml(lConteneur.GetNom(),'<div id="'+this.idConteneurPanel+'"></div>');GHtml.setHtml(this.idConteneurPanel,lHtml,{controleur:this.controleur});$('#'+this.idConteneurPanel.escapeJQ()).siblings().hide();$('#'+lZoneSelection.escapeJQ()).hide();} else{$('#'+this.Nom.escapeJQ()).show();this.Afficher(lHtml);}
if(this.options.estChat){Invocateur.desabonner('traiter_notifications_chatVS',this);Invocateur.abonner('traiter_notifications_chatVS',_actualisationSurNotificationChat.bind(this),this);}
lElementScroll=_getElementScroll(this);if(lElementScroll){if(lBackupScroll>0){lElementScroll.scrollTop=lElementScroll.scrollHeight-lBackupScroll;} else{lElementScroll.scrollTop=lElementScroll.scrollHeight;}}}
masquer(){this._estAffiche=false;if(this.options.estSidePanel){const lModale=_getModale.call(this);if(lModale&&lModale.isOpen){lModale.close();}} else{this.Afficher('');$('#'+this.Nom.escapeJQ()).hide();_fermer.call(this);}}
free(){if(this.isDestroyed()){return;}
super.free();delete ObjetDiscussion_Mobile.ids[this.GetNom()];if(this.options.estSidePanel){const lModale=_getModale.call(this);if(lModale){try{lModale.destroy();} catch(e){}}
$('#'+this.Nom.escapeJQ()).remove();}}
getControleur(aInstance){return $.extend(true,super.getControleur(this),{btnFermer:{event:function(){if(aInstance.options.estPanelFixe){GHtml.setDisplay(aInstance.idConteneurPanel,false);GHtml.setHtml(aInstance.idConteneurPanel,'');const lZoneSelection=GInterface.idZoneSelection;$('#'+aInstance.idConteneurPanel.escapeJQ()).siblings().show();GHtml.setDisplay(lZoneSelection,true);}
aInstance.masquer();}},btnNav:{event:function(aNavGauche){aInstance.avecInclureParentsEleves=false;aInstance.options.callbackNavigation(!!aNavGauche);}},getNodeBtnCreation:function(){$(this.node).on('click',(aEvent) =>{aInstance.options.callbackBtnCreation(aEvent);});},getNodeModifDest:function(aGenre){$(this.node).on('click',(aEvent) =>{_popupDestinataires.call(aInstance,aEvent,aGenre);});},chipsDest:{event:function(aGenre,aEvent){_popupDestinataires.call(aInstance,aEvent,aGenre);},eventBtn:function(aGenre,aEvent){aEvent.stopPropagation();aInstance.newMsg.listeDestinataires=aInstance.newMsg.listeDestinataires.getListeElements((aDest) =>{if(aGenre===aInstance.genreRequete.TousResponsablesDelegues){return aDest.GetGenre()!==aGenre&&aDest.GetGenre()!==aInstance.genreRequete.ParentsDelegues;}
return aDest.GetGenre()!==aGenre;});aInstance.newMsg.SetEtat(EGenreEtat.Modification);}},getHtmlModifDest:function(){const lHtml=[];lHtml.push(GTraductions.getValeur('Messagerie.DestinatairesMsg')+' ');let lNbTRD=0,lNbCA=0,lNbTR=0,lNbDC=0;aInstance.newMsg.listeDestinataires.parcourir((aElt) =>{switch(aElt.GetGenre()){case aInstance.genreRequete.TousResponsablesDelegues:case aInstance.genreRequete.ParentsDelegues:lNbTRD++;break;case aInstance.genreRequete.TousMembresCA:lNbCA++;break;case aInstance.genreRequete.TousResponsables:lNbTR++;break;case aInstance.genreRequete.ParentsDeLaClasse:lNbDC++;break;}});if(lNbTRD>0){lHtml.push('<ie-chips class="chips-dest"',GHtml.composeAttr('ie-model','chipsDest',[aInstance.genreRequete.TousResponsablesDelegues]),'>'+GTraductions.getValeur('fenetreEnvoiEmail.generique.parentsDelegues')+' ('+lNbTRD+')</ie-chips>');}
if(lNbCA>0){lHtml.push('<ie-chips class="chips-dest"',GHtml.composeAttr('ie-model','chipsDest',[aInstance.genreRequete.TousMembresCA]),'>'+GTraductions.getValeur('fenetreEnvoiEmail.generique.membresCA')+' ('+lNbCA+')</ie-chips>');}
if(lNbTR>0){lHtml.push('<ie-chips class="chips-dest"',GHtml.composeAttr('ie-model','chipsDest',[aInstance.genreRequete.TousResponsables]),'>'+GTraductions.getValeur('fenetreEnvoiEmail.generique.tousResponsables')+' ('+lNbTR+')</ie-chips>');}
if(lNbDC>0){lHtml.push('<ie-chips class="chips-dest"',GHtml.composeAttr('ie-model','chipsDest',[aInstance.genreRequete.ParentsDeLaClasse]),'>'+GTraductions.getValeur('fenetreEnvoiEmail.generique.parentsDeLaClasse')+' ('+lNbDC+')</ie-chips>');}
if(aInstance.genresDest){aInstance.genresDest.parcourir((aEle) =>{const lNb=aInstance.newMsg.listeDestinataires.getListeElements((aE) =>{return(aE.GetGenre()===aEle.GetGenre())&&(aE.GetGenre()>0);}).GetNbrElements();if(lNb>0){lHtml.push(tag('ie-chips',{'ie-model':tag.funcAttr('chipsDest',aEle.GetGenre()),class:'chips-dest'},aEle.GetLibelle()+' ('+lNb+')'));}});}
return lHtml.join('');},cbExerciceAlerte:{getValue:function(){return aInstance.newMsg.estExercice;},setValue:function(aValue){aInstance.newMsg.estExercice=aValue;}},modelChipsPJ:{eventBtn:function(aIndice){const lElement=aInstance.newMsg.listeFichiers?aInstance.newMsg.listeFichiers.GetElement(aIndice):null;if(lElement){GApplication.getMessage().afficher({type:EGenreBoiteMessage.Confirmation,message:GTraductions.getValeur('selecteurPJ.msgConfirmPJ',[lElement.GetLibelle()])}).then((aGenreAction) =>{if(aGenreAction===EGenreAction.Valider){lElement.SetEtat(EGenreEtat.Suppression);aInstance.newMsg.SetEtat(EGenreEtat.Modification);}});}},getDisabled:function(aIndice){const lElement=aInstance.newMsg.listeFichiers?aInstance.newMsg.listeFichiers.GetElement(aIndice):null;return!aInstance.Actif||!lElement;}},getHtmlPJ:function(){if(aInstance.options.avecPJ&&aInstance.newMsg.listeFichiers&&aInstance.newMsg.listeFichiers.GetNbrElements()>0){return UtilitaireUrl.construireListeUrls(aInstance.newMsg.listeFichiers,{IEModelChips:'modelChipsPJ'});}
return'';},inputObjet:{getValue:function(){return aInstance.newMsg.objet||'';},setValue:function(aValue){aInstance.newMsg.objet=aValue;aInstance.newMsg.SetEtat(EGenreEtat.Modification);}},modelSaisieContenu:{getValue:function(){return aInstance.newMsg.contenu;},setValue:function(aEstHtml,aValue){let lValue=aValue;if(aEstHtml){const lJNodes=$(this.node).find('img');if(lJNodes.length>0){lJNodes.remove();lValue=this.node.innerHTML;GApplication.getMessage().afficher({message:GTraductions.getValeur('CahierDeTexte.MessageSuppressionImage')});}}
aInstance.newMsg.contenu=lValue;aInstance.newMsg.SetEtat(EGenreEtat.Modification);},node:function(aEstHtml){if(!aEstHtml){return;}
$(this.node).on({focus:function(){$(this).siblings('label').addClass('active');},blur:function(){if(!this.innerHTML){$(this).siblings('label').removeClass('active');}}});const lThis=this;$(this).siblings('label').on('focus',() =>{lThis.focus();});}},btnIconPiedSaisie:{event:function(aAvecPJ,aAvecModifDest,aAvecBtnInclurePE,aInclurePEHorsLimite,aAvecCommandesBrouillon){ObjetMenuContextuel.afficher({pere:aInstance,id:this.node,initCommandes:function(aMenu){_addCommandesMenuPiedSaisie(aInstance,aMenu,aAvecPJ,aAvecModifDest,aAvecBtnInclurePE,aInclurePEHorsLimite,aAvecCommandesBrouillon);}});}},buttonRepondre:{event:function(aGenre){_surBoutonRepondre.call(aInstance,aGenre);},getDisabled:function(){return GApplication.droits.get(TypeDroits.estEnConsultation);}},visuMessage:{hint:function(aNumeroMessage,aParticipants){_afficherFenetreDestinatairesDemessage(aInstance,aNumeroMessage,aParticipants,false);}},cbProfsCarnetL:{getValue:function(aNumeroArticle){return aInstance.listeSelectionProfsCarnetLiaison.GetElementParNumero(aNumeroArticle);},setValue:function(aNumeroArticle,aValue){if(!aValue){if(aInstance.listeSelectionProfsCarnetLiaison.GetNbrElements()===1){return;}
const lIndice=aInstance.listeSelectionProfsCarnetLiaison.GetIndiceParNumeroEtGenre(aNumeroArticle);if(lIndice>=0){aInstance.listeSelectionProfsCarnetLiaison.remove(lIndice);}} else{if(!aInstance.listeSelectionProfsCarnetLiaison.GetElementParNumero(aNumeroArticle)){aInstance.listeSelectionProfsCarnetLiaison.add(new ObjetElement('',aNumeroArticle));}}}},cbInclureResp2:{getValue(){let lListe=aInstance.newMsg.listeDestinataires;let lActif=false;lListe.parcourir(function(aDest){if(aDest.GetGenre()===EGenreRessource.Responsable){lActif=aDest.Actif;}});return lActif;},setValue(aValue){let lListe=aInstance.newMsg.listeDestinataires;lListe.parcourir(function(aDest){if(aDest.GetGenre()===EGenreRessource.Responsable){aDest.Actif=aValue;}});}},modelComboAlerte:{init(aCombo){const lListe=new ObjetListeElements();aInstance.donnees.alertePPMS.listeModelesAlerte.parcourir((aModele) =>{const lArticle=new ObjetElement(aModele.GetLibelle());lArticle.modele=aModele;lListe.add(lArticle);lArticle.callbackSelection=(aParametres) =>{if(aParametres.estSelectionManuelle){aInstance.newMsg.modeleAlerte=MethodesObjet.dupliquer(aParametres.element.modele);aInstance.newMsg.contenu=aInstance.newMsg.modeleAlerte.contenu;aInstance.newMsg.SetEtat(EGenreEtat.Modification);}};});aCombo.setDonnees_ObjetSaisie({liste:lListe,selection:0});}},comboTableauDeBord_choixDisc:{init(aCombo){const lListe=new ObjetListeElements();let lIndiceSelection=0;if(aInstance.donnees.tableauDeBord&&aInstance.donnees.tableauDeBord.listeDiscussions){aInstance.donnees.tableauDeBord.listeDiscussions.parcourir((D,aIndiceDiscussion) =>{if(D.estUneDiscussion&&D.profondeur===0){const lElement=new ObjetElement(D.objet||GTraductions.getValeur('Messagerie.ObjetVideDiscussion'));lListe.add(lElement);if(aInstance.donnees.tableauDeBord.indiceDiscussionSelectionnee===aIndiceDiscussion){lIndiceSelection=lListe.GetNbrElements()-1;}
lElement.callbackSelection=(aParametres) =>{if(aParametres.estSelectionManuelle&&aIndiceDiscussion!==aInstance.donnees.tableauDeBord.indiceDiscussionSelectionnee){aInstance.avecInclureParentsEleves=false;aInstance.options.callbackSelectDiscussion(aIndiceDiscussion);}};}});}
aCombo.setDonnees_ObjetSaisie({liste:lListe,selection:lIndiceSelection});}}});}
execCommandesMenuContextuel(aParams){const lInstance=this;switch(aParams.genre){case TypeCommandeMessagerie.afficherDestinataires:;if(aParams.numeroMessage){_afficherFenetreDestinatairesDemessage(this,aParams.numeroMessage,aParams.estPublicParticipant,aParams.estDestinatairesReponse);}
return;case TypeCommandeMessagerie.repondreMessage:_requeteListeMessages.call(this,{titre:this.donnees.titre,message:aParams.message,marquerCommeLu:false});return;case TypeCommandeMessagerie.afficherDiscussion:{let lMessage=aParams.message;while(lMessage&&lMessage.pere){lMessage=lMessage.pere;}
if(lMessage){_requeteListeMessages.call(this,{titre:this.donnees.titre,message:lMessage,marquerCommeLu:false});}
return;}
default:return lInstance.masquer();}}}
ObjetDiscussion_Mobile.ids={};function _getElementScroll(aInstance){return $('#'+aInstance.Nom.escapeJQ()+' .utilMess_conteneur_visu_messages>div').get(0);}
function _getModale(){return M.Sidenav.getInstance($('#'+this.GetNom().escapeJQ()));}
function _fermer(){this._estAffiche=false;if(this.options.callbackFermeture){this.options.callbackFermeture(this.donnees);}
this.avecInclureParentsEleves=false;}
function _avecGenreDest(aInstance,aGenreRessource){return TUtilitaireMessagerie.estGenreDestinataireAutorise(aGenreRessource)&&(!aInstance.options.genresDestinatairesAutorises||!aInstance.options.genresDestinatairesAutorises.indexOf||aInstance.options.genresDestinatairesAutorises.indexOf(aGenreRessource)>=0);}
function _initGenresDest(){this.genresDest=new ObjetListeElements();if((!this.options.estChat||(this.donnees.listeContacts&&this.donnees.listeContacts.GetElementParGenre(EGenreRessource.Enseignant)))&&_avecGenreDest(this,EGenreRessource.Enseignant)){this.genresDest.AddElement(new ObjetElement(GTraductions.getValeur('Professeurs'),null,EGenreRessource.Enseignant,null,TUtilitaireMessagerie.estGenreDestinataireAutorise(EGenreRessource.Enseignant)));}
if((!this.options.estChat||(this.donnees.listeContacts&&this.donnees.listeContacts.GetElementParGenre(EGenreRessource.Personnel)))&&_avecGenreDest(this,EGenreRessource.Personnel)){this.genresDest.AddElement(new ObjetElement(GTraductions.getValeur('Personnels'),null,EGenreRessource.Personnel,null,TUtilitaireMessagerie.estGenreDestinataireAutorise(EGenreRessource.Personnel)));}
if(this.options.discussionAvancee&&!this.options.estChat){if(_avecGenreDest(this,EGenreRessource.Eleve)){this.genresDest.AddElement(new ObjetElement(GTraductions.getValeur('Eleves'),null,EGenreRessource.Eleve,null,TUtilitaireMessagerie.estGenreDestinataireAutorise(EGenreRessource.Eleve)));}
if(_avecGenreDest(this,EGenreRessource.Responsable)){this.genresDest.AddElement(new ObjetElement(GTraductions.getValeur('Messagerie.Parents'),null,EGenreRessource.Responsable,null,TUtilitaireMessagerie.estGenreDestinataireAutorise(EGenreRessource.Responsable)));}}
if(!this.options.estChat&&this.options.estDiscussionResponsables&&GParametres.ActivationMessagerieEntreParents&&GEtatUtilisateur.Identification.ressource.avecDiscussionResponsables&&_avecGenreDest(this,EGenreRessource.Responsable)){const lEstDelegue=GEtatUtilisateur.Identification.ressource.estDelegue;const lInstance=this;if(lEstDelegue){GEtatUtilisateur.Identification.ressource.listeClassesDelegue.parcourir((D) =>{lInstance.genresDest.AddElement(new ObjetElement(GTraductions.getValeur('fenetreEnvoiEmail.parentsDeLaClasse',[D.GetLibelle()]),D.GetNumero(),lInstance.genreRequete.ParentsDeLaClasse));});if(GEtatUtilisateur.Identification.ListeRessources.GetNbrElements()>1){GEtatUtilisateur.Identification.ListeRessources.parcourir((D) =>{lInstance.genresDest.AddElement(new ObjetElement(GTraductions.getValeur('fenetreEnvoiEmail.parentsDelegues',[D.Classe.GetLibelle()]),D.Classe.GetNumero(),lInstance.genreRequete.ParentsDelegues));});}
this.genresDest.AddElement(new ObjetElement(GTraductions.getValeur('fenetreEnvoiEmail.tousDelegues'),0,this.genreRequete.TousResponsablesDelegues));} else{GEtatUtilisateur.Identification.ListeRessources.parcourir((D) =>{lInstance.genresDest.AddElement(new ObjetElement(GTraductions.getValeur('fenetreEnvoiEmail.parentsDelegues',[D.Classe.GetLibelle()]),D.Classe.GetNumero(),lInstance.genreRequete.ParentsDelegues));});}}}
function _initNewMsg(aBrouillon){this.newMsg=Object.assign(TUtilitaireMessagerie.getBrouillonDefaut(),{avecHtml:this.options.avecHtml,listePublic:[],genreDiscussion:this.options.genreDiscussion});if(this.donnees.tableauDeBord){this.newMsg=Object.assign(new ObjetElement(),this.donnees.message);this.newMsg.listeDestinataires=this.donnees.message.listeDestinataires?this.donnees.message.listeDestinataires:new ObjetListeElements();} else if(aBrouillon){this.newMsg=MethodesObjet.dupliquer(aBrouillon);this.newMsg.brouillon=aBrouillon;if(aBrouillon.contenu){this.newMsg.contenu=aBrouillon.contenu;}
this.newMsg.commande='';this.newMsg.listeDestinataires=this.donnees.destinataires&&this.donnees.destinataires.listeDestinataires?this.donnees.destinataires.listeDestinataires:new ObjetListeElements();if(aBrouillon.listeDestinataires){this.newMsg.listeDestinataires=aBrouillon.listeDestinataires;}
if(aBrouillon.listeDocumentsJoints){this.newMsg.listeFichiers=aBrouillon.listeDocumentsJoints;}} else{this.newMsg.listeDestinataires=this.donnees.destinataires&&this.donnees.destinataires.listeDestinataires?this.donnees.destinataires.listeDestinataires:new ObjetListeElements();}
if(!this.newMsg.listeFichiers){this.newMsg.listeFichiers=new ObjetListeElements();}
if(!this.newMsg.listeDestinataires){this.newMsg.listeDestinataires=new ObjetListeElements();}
if(this.donnees.estPrimParentSurEtiquetteCL){this.newMsg.estCreationCarnetLiaison=true;if(!this.donnees.listeDestinatairesCarnetLiaison){throw'pas de liste destinataires';}
if(!this.donnees.eleveCarnetLiaison){throw'Il faut un eleve carnet de liaison';}
this.newMsg.listeDestinataires=MethodesObjet.dupliquer(this.donnees.listeDestinatairesCarnetLiaison);this.newMsg.eleveCarnetLiaison=this.donnees.eleveCarnetLiaison;}
this.newMsg.estChat=this.options.estChat;if(this.options.estChat&&this.donnees.creationDiscussion&&this.donnees.titre){this.newMsg.objet=this.donnees.titre;}
if(this.donnees.alertePPMS){this.newMsg.genreDiscussion===TypeGenreDiscussion.GD_Alerte;if(this.donnees.alertePPMS.modeleAlerte&&this.donnees.alertePPMS.modeleAlerte.contenu){this.newMsg.contenu=this.donnees.alertePPMS.modeleAlerte.contenu;}
this.newMsg.modeleAlerte=this.donnees.alertePPMS.modeleAlerte;this.newMsg.estExercice=false;}
this.newMsg.listeDestinataires.parcourir((aEle) =>{aEle.SetEtat(EGenreEtat.Modification);});this.newMsg.listePublic=this.newMsg.listeDestinataires?this.newMsg.listeDestinataires.getTableauLibelles():[];}
function _requeteSaisie(aInstance,aCommande){aInstance._desactiverAbonnementNotifMessage=true;return aInstance.moteurMessagerie.requeteSaisieMessage(aCommande).finally((aArg) =>{delete aInstance._desactiverAbonnementNotifMessage;return aArg;});}
function _addCommandesMenuPiedSaisie(aInstance,aMenu,aAvecPJ,aAvecModifDest,aAvecBtnInclurePE,aInclurePEHorsLimite,aAvecCommandesBrouillon){const lEstEnConsulation=GApplication.droits.get(TypeDroits.estEnConsultation);if(aAvecPJ&&!lEstEnConsulation){aMenu.addSelecFile(GTraductions.getValeur('Messagerie.HintPJ'),{icon:'icon_piece_jointe',getOptionsSelecFile:function(){return{maxSize:GApplication.droits.get(TypeDroits.tailleMaxDocJointEtablissement)};},addFiles:function(aParams){if(MethodesTableau.existe(aParams.eltFichier.GetLibelle(),aInstance.listePJ.getTableauLibelles())){GApplication.getMessage().afficher({message:GTraductions.getValeur('inputFile.msgEchecLibelleFichier')});} else{aInstance.newMsg.listeFichiers.AddElement(aParams.eltFichier);aInstance.newMsg.SetEtat(EGenreEtat.Modification);aInstance.listePJ.AddElement(aParams.eltFichier);}}});}
if(aAvecModifDest){const lNb=aInstance.newMsg.listeDestinataires?aInstance.newMsg.listeDestinataires.GetNbrElements():0;aMenu.add(GTraductions.getValeur('Messagerie.HintAjouterDest')+(lNb>0?' ('+lNb+')':''),!!aInstance.donnees.destinataires&&!lEstEnConsulation,() =>{_popupDestinataires.call(aInstance,null,undefined,true);},{icon:'icon_plus_cercle'});}
if(aAvecBtnInclurePE){const lEstCoche=aInstance.avecInclureParentsEleves&&!aInclurePEHorsLimite;aMenu.add(GTraductions.getValeur('Messagerie.InclureParentsEleves'),!lEstEnConsulation,() =>{if(aInclurePEHorsLimite){GApplication.getMessage().afficher({message:GTraductions.getValeur('Messagerie.HintInclureParentsElevesDisabled')});} else{aInstance.avecInclureParentsEleves=!lEstCoche;}},{icon:lEstCoche?'icon_case_on':'icon_check_empty',visuInactif:!!aInclurePEHorsLimite});}
if(aAvecCommandesBrouillon){const lBrouillon=aInstance.newMsg;const lMessagePourReponse=aInstance.donnees.messagePourReponse;let lEstActif=lMessagePourReponse&&lBrouillon.Etat!==EGenreEtat.Aucun&&!lEstEnConsulation;aMenu.add(GTraductions.getValeur('Messagerie.HintEnregistrerBrouillon'),!!lEstActif,() =>{aInstance.moteurMessagerie.saisieBrouillon(lBrouillon,lMessagePourReponse).then(() =>{if(aInstance.options.callbackEnvoyer){aInstance.options.callbackEnvoyer({});}});},{icon:'icon_save'});lEstActif=lBrouillon&&lBrouillon.existeNumero()&&lBrouillon.Etat!==EGenreEtat.Creation&&!lEstEnConsulation;aMenu.add(GTraductions.getValeur('Messagerie.HintSupprimerBrouillon'),!!lEstActif,() =>{const lCreation=_estBrouillonCreationDiscussion.call(aInstance);aInstance.moteurMessagerie.supprimerBrouillonConfirmation_promise(lBrouillon).then((aResult) =>{if(aResult&&aResult.saisieMessageOK===true){if(lCreation){aInstance.masquer();} else{if(aInstance.options.callbackEnvoyer){aInstance.options.callbackEnvoyer({});}}}});},{icon:'icon_trash'});}}
function _actualisationSurNotificationChat(aListeDiscussions){if(!aListeDiscussions){return;}
let lMessageActualisation=null;aListeDiscussions.parcourir((aMessage) =>{if(aMessage.listePossessionsMessages){if(!this.donnees.message&&this._creationChatAvecSaisieMessage&&aMessage.perso&&aMessage.listePossessionsMessages.GetNbrElements()===1){lMessageActualisation=aMessage;} else if(this.donnees.message&&this.donnees.message.listePossessionsMessages){aMessage.listePossessionsMessages.parcourir((aPossessionMessage) =>{if(this.donnees.message.listePossessionsMessages.GetElementParElement(aPossessionMessage)){lMessageActualisation=aMessage;return false;}});}
if(lMessageActualisation){lMessageActualisation.messageDejaTraite=true;return false;}}});if(lMessageActualisation){lMessageActualisation=MethodesObjet.dupliquer(lMessageActualisation);_requeteListeMessages.call(this,{titre:this.donnees.titre,message:lMessageActualisation,marquerCommeLu:true,conserverBrouillon:true});}}
function _requeteListeMessages(aParams){const lNbMessagesVus=aParams.nbMessagesVus<0?undefined:(aParams.nbMessagesVus||TUtilitaireMessagerie.palierNbMessages);if(this.donnees.message&&aParams.marquerCommeLu){this.donnees.message.lu=true;}
return this.moteurMessagerie.requeteMessagesVisu({message:aParams.message,marquerCommeLu:aParams.marquerCommeLu,nbMessagesVus:lNbMessagesVus}).then((aParamRequette) =>{this.setDonnees({titre:aParams.titre,message:aParams.message,messagePourReponse:aParamRequette.messagePourReponse,listeBoutons:aParamRequette.listeBoutons,listeMessages:aParamRequette.listeMessages,destinataires:aParamRequette.destinataires,nbPossessionsMessageListe:aParamRequette.nbPossessionsMessage,brouillon:aParamRequette.brouillon,conserverBrouillon:aParams.conserverBrouillon,MAJNbMessages:aParams.MAJNbMessages});});}
function _surBoutonRepondre(aGenre){const lGenre=TUtilitaireMessagerie.getGenreReponse(aGenre,this.avecInclureParentsEleves);let lContenuEscape=this.newMsg.contenu.trim();if(this.options.avecHtml){lContenuEscape=$(GHtml.htmlToDOM(tag('div',lContenuEscape))).text().trim();}
const lControleContenuNonVide=lGenre!==TypeHttpReponseMessage.rm_ClotureAlerte;const lEstBrouillonCreationDiscussion=_estBrouillonCreationDiscussion.call(this);if(this.donnees.estPrimParentSurEtiquetteCL&&this.listeSelectionProfsCarnetLiaison&&this.listeSelectionProfsCarnetLiaison.GetNbrElements()>0){this.newMsg.listeDestinataires.removeFilter((D) =>{if(D.GetGenre()===EGenreRessource.Enseignant&&!this.listeSelectionProfsCarnetLiaison.GetElementParNumero(D.GetNumero())){return true;}
return false;});}
if(((this.donnees.creationDiscussion&&!this.options.discussionAvancee)||(this.options.estChat&&this.donnees.creationDiscussion)||lEstBrouillonCreationDiscussion)&&(!this.newMsg.listeDestinataires||this.newMsg.listeDestinataires.GetNbrElements()===0)){return GApplication.getMessage().afficher({message:GTraductions.getValeur('Messagerie.MsgAucuneSelection')});}
if(lControleContenuNonVide&&!lContenuEscape){return GApplication.getMessage().afficher({message:GTraductions.getValeur('Messagerie.MsgAucunContenu')});}
if(this.options.estChat&&!this.donnees.message){this._creationChatAvecSaisieMessage=true;}
if(!this.donnees.creationDiscussion){this.newMsg.bouton=new ObjetElement('',0,lGenre);}
this.newMsg.avecHtml=this.options.avecHtml;this.newMsg.messagePourReponse=this.donnees.messagePourReponse;if(_avecCBDirecteur.call(this)){if($('#'+this.idCheckboxDirecteur.escapeJQ()).is(':checked')){const lElement=new ObjetElement('',0,EGenreRessource.Personnel);lElement.SetEtat(EGenreEtat.Modification);this.newMsg.listeDestinataires.AddElement(lElement);}}
if(this.donnees.creationDiscussion&&this.options.parametresSupplementaireSaisieDiscussion){Object.assign(this.newMsg,this.options.parametresSupplementaireSaisieDiscussion);}
const lInstance=this;this.newMsg.listeDestinataires.parcourir((D) =>{if(_estDiscussionSpecifiqueResponsables(lInstance,D.GetGenre())){D.Genre=EGenreRessource.Responsable;}});this.newMsg.listeDestinataires.removeFilter((D) =>{if(D.GetGenre()===EGenreRessource.Responsable){return!D.Actif;}
return false;});const lMessageSaisie=this.newMsg;_requeteSaisie(this,lMessageSaisie).then(() =>{_initNewMsg.call(this);if(this.options.callbackEnvoyer){this.options.callbackEnvoyer({creationDiscussion:this.donnees.creationDiscussion||lEstBrouillonCreationDiscussion,message:lMessageSaisie});}});}
function _estDiscussionSpecifiqueResponsables(aInstance,aGenre){return MethodesTableau.existe(aGenre,[aInstance.genreRequete.TousResponsablesDelegues,aInstance.genreRequete.TousMembresCA,aInstance.genreRequete.TousResponsables,aInstance.genreRequete.ParentsDelegues,aInstance.genreRequete.ParentsDeLaClasse]);}
function _popupDestinataires(aEvent,aGenre,aUniquementAjouterDest){if(aEvent){aEvent.stopPropagation();}
ObjetFenetre.creerInstance(ObjetFenetre_DestDiscussion_Mobile,{pere:this},{newMsg:this.newMsg,genresDest:this.genresDest,genreRequete:this.genreRequete,estDiscussionSpecifiqueResponsables:function(aGenre){return _estDiscussionSpecifiqueResponsables(this,aGenre);}.bind(this),listeContacts:this.donnees.listeContacts,alertePPMS:this.donnees.alertePPMS}).setOptions(this.options).afficher(aGenre,aUniquementAjouterDest);}
function _composeSelectionDiscussion(){if(!this.donnees.tableauDeBord||!this.options.callbackSelectDiscussion){return'';}
const lIndiceDiscussionSelectionnee=this.donnees.tableauDeBord.indiceDiscussionSelectionnee;let lAvecDiscussion=false;if(this.donnees.tableauDeBord.listeDiscussions){this.donnees.tableauDeBord.listeDiscussions.parcourir((aMessage) =>{if(aMessage.estUneDiscussion){lAvecDiscussion=true;return false;}});}(!!this.donnees.tableauDeBord.listeDiscussions?this.donnees.tableauDeBord.listeDiscussions.GetNbrElements():0);const H=[];if(lIndiceDiscussionSelectionnee>=0&&lAvecDiscussion){let lNbDiscussionsNonLues=0;if(!!this.donnees.tableauDeBord.listeDiscussions){this.donnees.tableauDeBord.listeDiscussions.parcourir((D) =>{if(D.estUneDiscussion&&D.profondeur===0){let nbMessagesNonLus=0;if(!!D.nbNonLus&&D.nbNonLus>0){nbMessagesNonLus=D.nbNonLus;}
if(nbMessagesNonLus>0){lNbDiscussionsNonLues++;}}});}
let lStrNbNonLues;if(lNbDiscussionsNonLues>0){lStrNbNonLues='<span class="selectDiscussionNonLu">'+GTraductions.getValeur(lNbDiscussionsNonLues===1?'Messagerie.NombreNonLue':'Messagerie.NombreNonLues',[lNbDiscussionsNonLues])+'</span>';}
H.push('<div class="selectDiscussion">',(lStrNbNonLues||''),tag('ie-combo',{'ie-model':'comboTableauDeBord_choixDisc',class:'combo-disc combo-mobile'}),'</div>');}
return H.join('');}
function _composeSelectAlerte(){const H=[];H.push('<div class="odm_selectModeleAlerte"><div class="input-field">');H.push(tag('ie-combo',{'ie-model':'modelComboAlerte',class:'combo-mobile'}));H.push('<label class="">',GTraductions.getValeur('Messagerie.ModeleAlerte'),'</label>','</div></div>');return H.join('');}
function _composeStrListeDestinataires(){this.listeSelectionProfsCarnetLiaison=new ObjetListeElements();const H=[GTraductions.getValeur('Messagerie.DestinatairesMsg')];if(!!this.newMsg.listeDestinataires&&this.newMsg.listeDestinataires.GetNbrElements()>0){let lListeChoixProfs=null;let lListeDestinatairesAAfficher=this.newMsg.listeDestinataires;if(this.donnees.estPrimParentSurEtiquetteCL){lListeChoixProfs=this.newMsg.listeDestinataires.getListeElements((D) =>{return D.GetGenre()===EGenreRessource.Enseignant;});if(lListeChoixProfs.GetNbrElements()===1){lListeChoixProfs=null;} else{this.listeSelectionProfsCarnetLiaison.add(lListeChoixProfs.GetElement(0));lListeDestinatairesAAfficher=this.newMsg.listeDestinataires.getListeElements((D) =>{return D.GetGenre()!==EGenreRessource.Enseignant;});}}
if(lListeChoixProfs){lListeChoixProfs.parcourir((D) =>{H.push('<ie-checkbox',GHtml.composeAttr('ie-model','cbProfsCarnetL',D.GetNumero()),' ie-textright style="margin-left:1rem">',D.GetLibelle(),'</ie-checkbox>');});H.push('<br/>&nbsp;&nbsp;&nbsp;&nbsp;');}
H.push('&nbsp;');H.push('<div style="display:flex; flex-direction : column;">');lListeDestinatairesAAfficher.parcourir(function(D){if(D.GetGenre()===EGenreRessource.Responsable){H.push('<ie-checkbox ',GHtml.composeAttr('ie-model','cbInclureResp2'),' ie-textright class="p-top">',D.GetLibelle(),'</ie-checkbox>');} else{H.push('<span class="labelDestinataire">',D.GetLibelle(),'</span>');}});H.push('</div>');}
return H.join('');}
function _estBrouillonCreationDiscussion(){return!!(this.newMsg&&this.newMsg.brouillon&&(!this.donnees.messagePourReponse||!this.donnees.messagePourReponse.existeNumero()));}
function _getHtmlBtnRepondre(){const H=[];if(this.donnees.listeBoutons){this.donnees.listeBoutons.parcourir((aBouton,aIndex) =>{if(aIndex===this.donnees.listeBoutons.GetNbrElements()-1){H.push(tag('ie-bouton',{'ie-icon':'icon_envoyer',class:'themeBoutonPrimaire','ie-model':tag.funcAttr('buttonRepondre',aBouton.GetGenre())}));} else{H.push(tag('ie-bouton',{class:TypeThemeBouton.neutre,'ie-model':tag.funcAttr('buttonRepondre',aBouton.GetGenre()),'ie-ellipsis':true},aBouton.GetLibelle()));}});}
return H.join('');}
function _composer(){const lMessageNonEditable=TUtilitaireMessagerie.estMessageNonEditable(this.donnees.messagePourReponse);const lCreationAlertePPMS=this.donnees.alertePPMS&&this.options.estChat;const lEstBrouillonCreationDiscussion=_estBrouillonCreationDiscussion.call(this);const lEstNouvelleDiscussion=this.donnees.creationDiscussion||lEstBrouillonCreationDiscussion;const lAvecPublic=this.donnees.messagePourReponse&&this.donnees.messagePourReponse.existeNumero()&&!this.donnees.creationDiscussion;const lAvecBtnActions=(!this.options.estSidePanel&&!lEstNouvelleDiscussion&&!this.options.estChat);const lEstMessageCarnetLiaison=this.donnees.messagePourReponse&&this.donnees.messagePourReponse.estCarnetLiaison;const lEstMessageVisuChat=TUtilitaireMessagerie.estMessageVisuChat(this.donnees.messagePourReponse);const H=[];let lLibelle='';if(this.donnees.titre){lLibelle=this.donnees.titre;} else if(lEstNouvelleDiscussion){lLibelle=GTraductions.getValeur('Messagerie.TitreFenetre');} else if(this.donnees.message){lLibelle=this.donnees.message.objet||GTraductions.getValeur('Messagerie.ObjetVideDiscussion');}
H.push('<div id="',this.Nom+'_conteneur" class="ObjetDiscussion_Mobile">');H.push('<div class="navheader',this.options.estSidePanel?' header-titre':'','" tabindex="-1">','<ie-btnicon ie-model="btnFermer" class="icon_retour_mobile retour"></ie-btnicon>','<span class="odm_header_libelle">',lLibelle,'</span>',this.options.callbackNavigation?tag('ie-btnicon',{class:'icon_angle_left nav','ie-model':'btnNav(true)'})+tag('ie-btnicon',{class:'icon_angle_right nav','ie-model':'btnNav(false)'}):'',this.options.callbackBtnCreation?'<span class="messagerieNouveauMessage btn-floating waves-effect waves-light" ie-node="getNodeBtnCreation">&nbsp;</span>':'','</div>');if(!this.donnees.tableauDeBord&&(lAvecBtnActions||lAvecPublic)){H.push(tag('div',{class:'messagerie-titre-bandeau-message'},this.moteurMessagerie.composeTitreBandeauDeMessageVisu(this.donnees.message,{avecMenuActions:lAvecBtnActions,avecMenuPublic:lAvecPublic,instance:this,callbackMenu:this.execCommandesMenuContextuel.bind(this)})));}
if(this.donnees.tableauDeBord){H.push(_composeSelectionDiscussion.call(this));}
if(this.donnees.listeMessages&&this.donnees.listeMessages.GetNbrElements()){H.push(tag('div',{class:'utilMess_conteneur_visu_messages'},tag('div',TUtilitaireMessagerie.getDiscussion({listeMessages:this.donnees.listeMessages,controleur:this.controleur,nbMessagesTotal:this.donnees.nbPossessionsMessageListe,callbackAfficherSuivants:function(aNbMessagesVus){_requeteListeMessages.call(this,{message:this.donnees.message,marquerCommeLu:false,nbMessagesVus:aNbMessagesVus,MAJNbMessages:true});}.bind(this),ieHint:'visuMessage.hint',callbackBtnSignalantPourSupp:function(aCommande){_requeteSaisie(this,aCommande);}.bind(this),callbackCommandesMessage:!this.options.estChat?_callbackCommandesMessage.bind(this):null}))));}
H.push('<div class="odm_contenu">');H.push('<div class="odm_messages">');if(this.donnees.messagePourReponse&&this.donnees.messagePourReponse.messageInfo){H.push(tag('div',{style:"color:red"},GChaine.ToHTML(this.donnees.messagePourReponse.messageInfo)));}
if(this.donnees.messagePourReponse&&this.donnees.messagePourReponse.messageDestinataires){H.push(tag('div',GChaine.ToHTML(this.donnees.messagePourReponse.messageDestinataires)));}
if(this.donnees.messagePourReponse&&this.donnees.messagePourReponse.estCarnetLiaison&&GEtatUtilisateur.pourPrimaire()){H.push(tag('div',{class:'ie-titre-petit avert-carnet'},GChaine.ToHTML(GTraductions.getValeur('MessagerieCarnetLiaison.AvertissementMessagesPublics'))));}
H.push('</div>');if(this.options.estChat&&this.donnees.message&&this.donnees.message.estAlerte&&this.donnees.message.exercice){H.push('<span class="odm_exercice">',GTraductions.getValeur('Messagerie.AlerteEstUnExercice'),'</span>');}
if(!GApplication.droits.get(TypeDroits.communication.discussionInterdit)&&!lMessageNonEditable&&!(this.options.estChat&&this.donnees.message&&this.donnees.message.estAlerte&&this.donnees.message.cloture)){const lAvecModifDestinataires=!lMessageNonEditable&&!this.donnees.tableauDeBord&&!this.donnees.estPrimParentSurEtiquetteCL&&!lEstMessageCarnetLiaison&&(!this.options.estChat||lEstNouvelleDiscussion)&&(lEstNouvelleDiscussion||GApplication.droits.get(TypeDroits.communication.avecDiscussionAvancee))&&!lEstMessageVisuChat;if(lAvecModifDestinataires&&lEstNouvelleDiscussion){H.push('<div style="margin:1em 0;border-bottom:1px solid #bababa;" ie-node="getNodeModifDest(undefined)" ie-html="getHtmlModifDest()"></div>');}
if(this.donnees.tableauDeBord||this.donnees.estPrimParentSurEtiquetteCL){const lEstMessagePossede=(this.donnees.message&&!this.donnees.message.estNonPossede);const lEstNouveauMessageCL=(this.newMsg&&this.newMsg.estCreationCarnetLiaison);if(lEstMessagePossede||lEstNouveauMessageCL){H.push('<div class="odm_dest_TableauDeBord">',_composeStrListeDestinataires.call(this),'</div>');}}
if(_avecCBDirecteur.call(this)){const lEstSelected=TUtilitaireMessagerie.unMessageContientLeDirecteur(this.donnees.tableauDeBord?this.newMsg.listeMessages:this.donnees.listeMessages);const lDiscussionEstNonPossedee=this.donnees.tableauDeBord?this.newMsg.estNonPossede===true:false;H.push('<div class="odm_TransmettreDir_TableauDeBord">',tag('ie-checkbox',{id:this.idCheckboxDirecteur,checked:lEstSelected?'checked':false,disabled:lEstSelected||lDiscussionEstNonPossedee?'disabled':false,'ie-textright':true},GTraductions.getValeur('MessagerieCarnetLiaison.AjouterDirecteur')),'</div>');}
if(lCreationAlertePPMS){H.push(_composeSelectAlerte.call(this));}
if(!this.donnees.alertePPMS&&!this.options.estChat&&lEstNouvelleDiscussion){const lObjetEstEditable=!this.donnees.tableauDeBord||this.donnees.tableauDeBord.indiceDiscussionSelectionnee=== -1;H.push('<div>','<div class="input-field">',tag('input',{'ie-model':"inputObjet",id:this.Nom+'_inputObj',type:"text",disabled:!lObjetEstEditable,maxlength:TUtilitaireMessagerie.C_TailleObjetMessage}),'<label for="',this.Nom+'_inputObj','"',(this.newMsg.objet?' class="active"':''),'>',GTraductions.getValeur('Messagerie.ObjetMsg'),'</label>','</div>','</div>');}
if(this.donnees.creationDiscussion||(!lMessageNonEditable&&this.donnees.listeBoutons&&this.donnees.listeBoutons.GetNbrElements()>0)){const lContenu=this.donnees.tableauDeBord||(this.donnees.alertePPMS&&this.donnees.alertePPMS.modeleAlerte&&this.newMsg.contenu)||(this.newMsg.brouillon&&this.newMsg.contenu)?this.newMsg.contenu||'':'';this.newMsg.contenu=lContenu;if(lContenu){this.newMsg.SetEtat(EGenreEtat.Modification);}
H.push('<div class="input-field">',this.options.avecHtml?tag('div',{'ie-model':tag.funcAttr('modelSaisieContenu',true),class:["contenteditable_index",this.donnees.creationDiscussion?'creation':''],contenteditable:"true"}):tag('textarea',{'ie-model':tag.funcAttr('modelSaisieContenu',false),class:["contenteditable_index materialize-textarea",this.donnees.creationDiscussion?'creation':'']}),'<label ',(lContenu?' class="active"':''),'>',GTraductions.getValeur('Messagerie.RedigerMessage'),'</label>','</div>');}
if(lCreationAlertePPMS){H.push('<div class="odm_cbExercice">','<ie-switch ie-model="cbExerciceAlerte">',GTraductions.getValeur('Messagerie.IndiquerExercice'),'</ie-switch>','</div>');}
const lAvecBtnEnvoi=this.donnees.listeBoutons&&this.donnees.listeBoutons.GetNbrElements()>0;const lAvecPJ=this.options.avecPJ&&!this.donnees.alertePPMS&&this.moteurMessagerie.autoriserAjoutPJ()&&!this.options.estChat&&!lEstMessageVisuChat&&!TUtilitaireMessagerie.estMessageNonEditable(this.donnees.messagePourReponse)&&lAvecBtnEnvoi;const lAvecModifDestinatairesSurRepondre=lAvecModifDestinataires&&!lEstNouvelleDiscussion;let lAvecBtnInclurePE=false;let lInclurePEHorsLimite=false;if(lAvecBtnEnvoi){this.donnees.listeBoutons.parcourir((aBouton) =>{if(aBouton.GetGenre()===TypeHttpReponseMessage.rm_EnvoiATousSaufParentEleve||aBouton.GetGenre()===TypeHttpReponseMessage.rm_RelanceATousSaufParentEleve){lInclurePEHorsLimite=aBouton.horsLimiteParentsEleves;lAvecBtnInclurePE=true;return false;}});}
const lAvecCommandesBrouillon=this.options.activerBoutonsBrouillon&&!this.options.estChat&&!lEstMessageVisuChat&&(this.options.discussionAvancee||!lEstNouvelleDiscussion);const lAvecCommandes=lAvecBtnEnvoi&&(lAvecPJ||lAvecModifDestinatairesSurRepondre||lAvecBtnInclurePE||lAvecCommandesBrouillon);H.push(tag('div',{class:'odm_pied_saisie'},tag('div',{class:'odm_pied_pj','ie-html':'getHtmlPJ'}),lAvecCommandes?tag('ie-btnicon',{'ie-model':tag.funcAttr('btnIconPiedSaisie',[lAvecPJ,lAvecModifDestinatairesSurRepondre,lAvecBtnInclurePE,lInclurePEHorsLimite,lAvecCommandesBrouillon]),class:'icon_ellipsis_vertical commandes'}):'',_getHtmlBtnRepondre.call(this)));}
H.push('</div>');if(lCreationAlertePPMS){H.push(tag('span',{class:'odm_messagefooter'},GTraductions.getValeur('Messagerie.InfosAlerte')));}
H.push('</div>');return H.join('');}
function _callbackCommandesMessage(aParams){if(aParams.surMenuContextuel){return;}
ObjetMenuContextuel.afficher({pere:this,id:aParams.node,initCommandes:function(aInstance){this.moteurMessagerie.addCommandesMenuContextuelVisuMessage({messageListeSelection:this.donnees.message,messageVisu:aParams.messageVisu,menuContextuel:aInstance,elementCibleCopie:aParams.elementCibleCopie,callback:function(aParams,aCommande){this.execCommandesMenuContextuel(aParams,aCommande);}.bind(this)});}});}
function _avecCBDirecteur(){return GEtatUtilisateur.pourPrimaire()&&((this.donnees.creationDiscussion&&!this.options.estChat)||(this.donnees.messagePourReponse&&this.donnees.messagePourReponse.estCarnetLiaison&&GApplication.droits.get(TypeDroits.communication.avecDiscussionAvancee)));}
function _afficherFenetreDestinatairesDemessage(aInstance,aNumeroMessage,aEstPublicParticipant,aEstDestinatairesReponse){TUtilitaireMessagerie.getListePublicMessage_promise(aInstance,aNumeroMessage,aEstPublicParticipant,aEstDestinatairesReponse).then((aListeDest) =>{if(!aListeDest||aListeDest.GetNbrElements()===0){return;}
const lHtml=[];lHtml.push('<ul class="liste-destinataires">');aListeDest.parcourir((aDest) =>{const lLibelleSupp=TUtilitaireMessagerie.getStrHintDetailDePublic(aDest);lHtml.push('<li>',aListeDest.avecConnection?TUtilitaireMessagerie.contruirePublicConnecte(aDest,lLibelleSupp):aDest.GetLibelle()+lLibelleSupp,'</li>');});lHtml.push('</ul>');ObjetFenetre.creerInstance(ObjetFenetre,{pere:aInstance},{titre:GTraductions.getValeur('Messagerie.ListeDestinataires'),fermerFenetreSurClicHorsFenetre:true}).Afficher(lHtml.join(''));});}
function _notification_actualisationMessage(){if(this.options.estChat||!this.estAffiche()){return;}
if(this._desactiverAbonnementNotifMessage){return;}
if(!this.donnees.message.dernierPossessionMessage){return;}
this.moteurMessagerie.requeteListeMessagerie({avecMessage:true,avecLu:true,possessionMessageDiscussionUnique:this.donnees.message.dernierPossessionMessage}).then((aParams) =>{if(aParams.listeMessagerie&&aParams.listeMessagerie.GetNbrElements()>0){const lMessageReponse=aParams.listeMessagerie.GetElement(0);if(TUtilitaireMessagerie.avecPossessionPartageeEntreMessages(this.donnees.message,lMessageReponse)){let lAvecActualisation=true;if(lMessageReponse.listePossessionsMessages.GetNbrElements()===this.donnees.message.listePossessionsMessages.GetNbrElements()){lAvecActualisation=false;lMessageReponse.listePossessionsMessages.parcourir((aMessage,aIndex) =>{const lMessageTrouve=this.donnees.message.listePossessionsMessages.GetElement(aIndex);if(lMessageTrouve.GetNumero()!==aMessage.GetNumero()){lAvecActualisation=true;return false;}});}
if(lAvecActualisation){return _requeteListeMessages.call(this,{titre:this.donnees.titre,message:lMessageReponse,marquerCommeLu:false,conserverBrouillon:true});}}}});}
module.exports=ObjetDiscussion_Mobile;},fn:"objetdiscussion_mobile.js"});;
IE.fModule({f:function(exports,require,module,global){require('produit/css/InterfaceDestMessageInstantane.css');const{TypeDroits}=require('ObjetDroitsPN.js');const ObjetDonneesListeFlatDesign=require('ObjetDonneesListeFlatDesign.js');const ObjetInterface=require('ObjetInterface.js');const ObjetListe=require('ObjetListe.js');const ObjetListeElements=require('ObjetListeElements.js');const GTraductions=require('ObjetTraduction.js');const ObjetTri=require('ObjetTri.js');const EStructureAffichage=require('Enumere_StructureAffichage.js');const TUtilitaireMessagerie=require('UtilitaireMessagerie.js');const tag=require('tag.js');const{TypeGenreStatutConnexionBase,TypeGenreStatutConnexion}=require('TypeStatutConnexion.js');const ObjetElement=require('ObjetElement.js');const EGenreEvenementObjetSaisie=require('Enumere_EvenementObjetSaisie.js');const{ObjetRequeteSaisie}=require('ObjetRequeteJSON.js');const Requetes=require('CollectionRequetes.js');Requetes.inscrire('SaisieStatutConnexion',ObjetRequeteSaisie);class InterfaceDestMessageInstantane extends ObjetInterface{constructor(...aParams){super(...aParams);this.GenreStructure=EStructureAffichage.Autre;this.params={};this.listeStatuts=new ObjetListeElements();this.listeStatuts.add([
new ObjetElement('',TypeGenreStatutConnexionBase.SCB_Connecte),new ObjetElement('',TypeGenreStatutConnexionBase.SCB_NePasDeranger),new ObjetElement('',TypeGenreStatutConnexionBase.SCB_Invisible)
]);}
getControleur(aInstance){return $.extend(true,super.getControleur(this),{btnContact:{event:function(){if(aInstance.params.fermer){aInstance.params.fermer();}
aInstance.params.creerDiscussionContactVS();}},getHtmlZoneStatut:function(){if(!aInstance.params.statutConnexion){return'';}
if(aInstance.params.statutConnexion.desactive){return _getHtmlStatut(aInstance,TypeGenreStatutConnexionBase.SCB_Invisible)+' - '+GTraductions.getValeur('Messagerie.MessagerieDesactivee');} else{return tag('ie-combo',{'ie-model':'comboStatut'});}},comboStatut:{init:function(aCombo){aCombo.setOptions_ObjetSaisie({longueur:190,getContenuCellule:function(aElement){return{libelleHtml:_getHtmlStatut(aInstance,aElement.GetNumero())};},getContenuElement:function(aParams){return _getHtmlStatut(aInstance,aParams.element.GetNumero());}});},getDonnees:function(aDonnees){if(aDonnees){return;}
return aInstance.listeStatuts;},getIndiceSelection:function(){if(!aInstance.params.statutConnexion){return-1;}
const lIndice=aInstance.listeStatuts.GetIndiceParNumeroEtGenre(aInstance.params.statutConnexion.statut);return lIndice||0;},event:function(aParametres,aCombo){if(aParametres.genreEvenement===EGenreEvenementObjetSaisie.selection&&aParametres.element&&aCombo.EstUneInteractionUtilisateur()){let lStatut=aParametres.element.GetNumero();if(lStatut!==aInstance.params.statutConnexion.statut){aInstance.params.statutConnexion.statut=lStatut;Requetes('SaisieStatutConnexion',aInstance).lancerRequete({statut:lStatut});}}},getDisabled:function(){return GApplication.droits.get(TypeDroits.estEnConsultation);}},rechercheTexte:{getValue:function(){const lListe=_getListe(aInstance);return lListe?lListe.getRechercheTexte():'';},setValue:function(aValue){_getListe(aInstance).setRechercheTexte(aValue);}},btnRechercheTexte:{event:function(){_getListe(aInstance).setRechercheTexte('');},avecBtn:function(){return _getListe(aInstance).getRechercheTexte()!=='';}}});}
ConstruireInstances(){this.identListe=this.Add(ObjetListe,null,function(aListe){aListe.setOptionsListe({skin:ObjetListe.skin.flatDesign,hauteurAdapteContenu:true,hauteurMaxAdapteContenu:400,messageContenuVide:GTraductions.getValeur('Messagerie.AucunDestinataire')});});}
setDonnees(aParams){this.params=Object.assign({fermer:null,creerDiscussionContactVS:null,creerMessageInstantane:null},aParams);this.listeContacts=aParams.listeContacts;this.listeContacts.parcourir(function(aDest){const lResult=aParams.listeDestinataires.GetElementParElement(aDest);if(lResult){aDest.statutConnexion=lResult.statutConnexion;} else{aDest.statutConnexion=TypeGenreStatutConnexion.GSC_Deconnecte;}}.bind(this));this.GetInstance(this.identListe).SetDonnees(new DonneesListe_DestMessageInstantane(this.listeContacts));}
ConstruireStructureAffichageAutre(){const T=[];T.push('<div class="InterfaceDestMessageInstantane">');if(GApplication.droits.get(TypeDroits.communication.avecContactVS)){T.push('<ie-bouton ie-model="btnContact" class="dmi_btnContact" ie-icon="icon_contact_vs">',GTraductions.getValeur('Messagerie.ContacterVS'),'</ie-bouton>');}
T.push(tag('div',{'ie-html':'getHtmlZoneStatut',class:'dmi_statut'}));T.push('<div class="dmi_zone_input">','<div class="as-input dmi_recherche">','<input type="text" ie-trim ie-textbrut ie-model="rechercheTexte" class="browser-default" placeholder="',GTraductions.getValeur('Messagerie.RechercherProfPerso'),'" />','<ie-btnimage class="icon_remove btnImageIcon" ie-model="btnRechercheTexte" ie-if="avecBtn" title="',GTraductions.getValeur('Supprimer'),'"></ie-btnimage>','</div>','<i class="icon_search"></i>','</div>');T.push('<div class="dest-contain" id="'+this.GetNomInstance(this.identListe)+'"></div>');T.push('</div>');return T.join('');}
getListeSelectionsUtils(){return _getListeSelections(this);}
lancerConversation(){const lSelections=this.getListeSelectionsUtils();if(lSelections.GetNbrElements()>0){let lListeConnecte=lSelections.getListeElements(function(D){return D.statutConnexion!==TypeGenreStatutConnexion.GSC_Deconnecte;});let lListeNonConnecte=lSelections.getListeElements(function(D){return D.statutConnexion===TypeGenreStatutConnexion.GSC_Deconnecte;});this.params.creerMessageInstantane(lListeConnecte,lListeNonConnecte);}}}
function _getHtmlStatut(aInstance,aStatut){const lDonneesStatut=aInstance.params.statutConnexion;if(!lDonneesStatut){return'';}
let lStatutConnexion=TypeGenreStatutConnexion.GSC_Disponible;switch(aStatut){case TypeGenreStatutConnexionBase.SCB_Connecte:if(lDonneesStatut.profEnCours){lStatutConnexion=TypeGenreStatutConnexion.GSC_EnCours;} else{lStatutConnexion=TypeGenreStatutConnexion.GSC_Disponible;}
break;case TypeGenreStatutConnexionBase.SCB_NePasDeranger:lStatutConnexion=TypeGenreStatutConnexion.GSC_NePasDeranger;break;case TypeGenreStatutConnexionBase.SCB_Invisible:lStatutConnexion=TypeGenreStatutConnexion.GSC_Deconnecte;break;default:;}
return tag('span',{class:['dmi_texte_combo',TypeGenreStatutConnexion.getClassIcon(lStatutConnexion)]},TypeGenreStatutConnexion.toLibelle(lStatutConnexion,true));}
function _getListe(aInstance){return aInstance.GetInstance(aInstance.identListe);}
function _getListeSelections(aFenetre){if(!aFenetre||!aFenetre.listeContacts){return new ObjetListeElements();}
return aFenetre.listeContacts.getListeElements(function(aElement){return aElement.estCoche;});}
class DonneesListe_DestMessageInstantane extends ObjetDonneesListeFlatDesign{constructor(aDonnees){super(aDonnees);this.setOptions({avecBoutonActionLigne:false,avecCB:true,avecEvnt_CB:false,avecCocheCBSurLigne:true,avecSelection:false,avecEllipsis:false});}
getTitreZonePrincipale(aParams){return TUtilitaireMessagerie.contruirePublicConnecte(aParams.article);}
getDisabledCB(aParams){return!!aParams.article.refusMess;}
getTri(){return[
ObjetTri.init((D) =>!!D.refusMess),ObjetTri.init((D) => D.statutConnexion),ObjetTri.init('Libelle')
];}}
module.exports=InterfaceDestMessageInstantane;},fn:"interfacedestmessageinstantane.js"});;
IE.fModule({f:function(exports,require,module,global){require('Produit/Css/ObjetConversationEnCours.css');const GTraductions=require('ObjetTraduction.js');const MoteurMessagerie=require('MoteurMessagerie.js');const Identite=require('ObjetIdentite.js');const TUtilitaireMessagerie=require('UtilitaireMessagerie.js');class ObjetConversationEnCours extends Identite{constructor(...aParams){super(...aParams);this.setOptions({message:null,surFermer:null,surMessage:null,surQuitter:null});}
getControleur(aInstance){return $.extend(true,super.getControleur(this),{btnFerme:{event:function(aEvent){aEvent.stopPropagation();aInstance.options.surFermer();}},getNodeConteneur:function(){$(this.node).eventValidation(function(){if(aInstance.options.surMessage){aInstance.options.surMessage();}});},getNodeQuitter:function(){$(this.node).eventValidation(function(aEvent){aEvent.stopPropagation();MoteurMessagerie.saisieSortirConversation(aInstance,aInstance.options.message);if(aInstance.options.surQuitter){aInstance.options.surQuitter();}});}});}
ConstruireAffichage(){const lMessage=this.options.message;if(!lMessage||$('#'+this.Nom.escapeJQ()).length===0){return'';}
const H=[];$('#'+this.Nom.escapeJQ()).addClass('ObjetConversationEnCours');if(this.options.surFermer){H.push('<ie-btnimage ie-model="btnFerme" class="btnImageIcon icon_remove"></ie-btnimage>');}
H.push('<div class="cec_conteneur" ie-node="getNodeConteneur">');H.push('<div class="cec_titre">',lMessage.libelleDate,'&nbsp;-&nbsp;',TUtilitaireMessagerie.getLibelleParticipants(lMessage,false),'</div>');if(lMessage.contenu){H.push('<div>',lMessage.contenu,'</div>');}
H.push('<div class="cec_lignefin">');if(lMessage.nbNonLus>0){H.push('<label>',lMessage.nbNonLus<2?GTraductions.getValeur('Messagerie.UnNouveauMessage'):GTraductions.getValeur('Messagerie.NNouveauxMessages',[lMessage.nbNonLus]),'</label>');}
H.push('<a ie-node="getNodeQuitter" class="AvecMain">',GTraductions.getValeur('Messagerie.QuitterModeInstantane'),'</a>');H.push('</div>');H.push('</div>');return H.join('');}}
module.exports=ObjetConversationEnCours;},fn:"objetconversationencours.js"});;
IE.fModule({f:function(exports,require,module,global){require('mobile/css/InterfaceWrapperDestMessageInstantane_Mobile.css');const ObjetInterface=require('ObjetInterface.js');const GTraductions=require('ObjetTraduction.js');const EStructureAffichage=require('Enumere_StructureAffichage.js');const InterfaceDestMessageInstantane=require('InterfaceDestMessageInstantane.js');const ObjetConversationEnCours=require('ObjetConversationEnCours.js');class InterfaceWrapperDestMessageInstantane_Mobile extends ObjetInterface{constructor(...aParams){super(...aParams);this.GenreStructure=EStructureAffichage.Autre;}
getControleur(aInstance){return $.extend(true,super.getControleur(this),{btnFermer:{event:function(){aInstance.options.closeSideNav();}},compteur:{afficher:function(){return aInstance.options.getListeConversations().GetNbrElements()>0;},texte:function(){return aInstance.options.getListeConversations().GetNbrElements();}},afficherAucuneConvers:function(){return aInstance.options.getListeConversations().GetNbrElements()===0;},btnConvers:{getDisabled:function(){return aInstance.GetInstance(aInstance.identAff).getListeSelectionsUtils().GetNbrElements()===0;},event:function(){aInstance.options.closeSideNav();aInstance.GetInstance(aInstance.identAff).lancerConversation();}},getRepeatMessages:function(){return[].concat(aInstance.options.getListeConversations().GetListeElements());},identiteConvers:function(aRepeatMessage){var lMessage=aRepeatMessage.element;return{class:ObjetConversationEnCours,pere:aInstance,init:function(aInstanceConvers){aInstanceConvers.setOptions({message:lMessage,surFermer:function(){_suppressionMessage(aInstance,lMessage);},surMessage:function(){if(aInstance.options.surMessage){aInstance.options.surMessage(lMessage);}
_suppressionMessage(aInstance,lMessage);aInstance.options.closeSideNav();},surQuitter:function(){_suppressionMessage(aInstance,lMessage);}});}};}});}
ConstruireInstances(){this.identAff=this.Add(InterfaceDestMessageInstantane);}
setDonnees(aParams){$(`#${this.Nom.escapeJQ()} header.header-titre`).focus();this.GetInstance(this.identAff).setDonnees(Object.assign({fermer:function(){this.options.closeSideNav();}.bind(this)},aParams));}
ConstruireStructureAffichageAutre(){var T=[];T.push('<div class="InterfaceWrapperDestMessageInstantane_Mobile">');T.push('<header class="header-titre" tabindex="-1">','<ie-btnimage ie-model="btnFermer" class="icon_retour_mobile btnImageIcon"></ie-btnimage>','<div>',GTraductions.getValeur('Messagerie.EnvoiMessageInstantane').toUpperCase(),'</div>','</header>');T.push('<div class="wdmi_contenu">');T.push('<div class="wdmi_titre_conversations">','<div>',GTraductions.getValeur('Messagerie.ConversationInstantaneesEnCours'),'</div>','<div class="wdmi_compteur" ie-texte="compteur.texte" ie-if="compteur.afficher"></div>','</div>');T.push('<label class="wdmi_titre_aucuneConvers" ie-if="afficherAucuneConvers">',GTraductions.getValeur('Messagerie.AucuneConversation'),'</label>');T.push('<ul class="wdmi_conversations">');T.push('<li ie-repeat="messageConvers in getRepeatMessages" ie-identite="identiteConvers(messageConvers)"></li>');T.push('</ul>');T.push('<div class="wdmi_liste">');T.push('<div id="'+this.GetNomInstance(this.identAff)+'"></div>');T.push('<div class="wdmi_cont_btnConvers">');T.push('<ie-bouton ie-model="btnConvers" class="themeBoutonPrimaire">',GTraductions.getValeur('Messagerie.LancerConversation'),'</ie-bouton>');T.push('</div>');T.push('</div>');T.push('</div>');T.push('</div>');return T.join('');}}
function _suppressionMessage(aInstance,aMessage){aInstance.options.surSuppressionConversationEnCours(aMessage);aInstance.$refreshSelf();}
module.exports=InterfaceWrapperDestMessageInstantane_Mobile;},fn:"interfacewrapperdestmessageinstantane_mobile.js"});;
IE.fModule({f:function(exports,require,module,global){const{ObjetInvocateur,Invocateur}=require('Invocateur.js');const Identite=require('ObjetIdentite.js');const ZoneFenetre=require('IEZoneFenetre.js');const GHtml=require('GHtml.js');module.exports={createComplet:function(aClassIdentite,aParametres){const lParametres=Object.assign({start:null,onOpenEnd:null},aParametres);let lInstance=Identite.creerInstance(aClassIdentite,lParametres);const lCloseSideNav=function(){if(lInstance){M.Sidenav.getInstance($('#'+lInstance.GetNom().escapeJQ())).close();}};lInstance.setOptions({closeSideNav:lCloseSideNav});GHtml.addHtml(ZoneFenetre.getElementZoneFenetre(),'<div id="'+lInstance.GetNom()+'" class="sidenav side-panel-complet"></div>');const lJFenetre=$('#'+lInstance.GetNom().escapeJQ());lJFenetre.on('destroyed',function(){if(lInstance){lInstance.free();}
lInstance=null;});Invocateur.abonner(ObjetInvocateur.events.fermerFenetres,function(){lCloseSideNav();},lInstance);M.Sidenav.init(lJFenetre,{edge:'right',draggable:false,onOpenEnd:function(){if(lParametres.onOpenEnd){lParametres.onOpenEnd(lInstance);}},onCloseEnd:function(){lJFenetre.remove();if(lInstance){lInstance.free();}
lInstance=null;}.bind(this)});lInstance.Initialiser();if(lParametres.start){lParametres.start(lInstance);}
M.Sidenav.getInstance($('#'+lInstance.GetNom().escapeJQ())).open();return{getInstance:function(){return lInstance;},fermer:lCloseSideNav};}};},fn:"utilitairesidenav.js"});;
IE.fModule({f:function(exports,require,module,global){const GChaine=require('GChaine.js');const ObjetIdentite=require('ObjetIdentite.js');const UtilitaireContactVieScolaire=require('UtilitaireContactVieScolaire.js');const ObjetDiscussion_Mobile=require('ObjetDiscussion_Mobile.js');const EGenreRessource=require('Enumere_Ressource.js');const{Invocateur}=require('Invocateur.js');const InterfaceWrapperDestMessageInstantane_Mobile=require('InterfaceWrapperDestMessageInstantane_Mobile.js');const ObjetListeElements=require('ObjetListeElements.js');const TypeGenreDiscussion=require('TypeGenreDiscussion.js').TypeGenreDiscussion;const TUtilitaireMessagerie=require('UtilitaireMessagerie.js');const UtilitaireSideNav=require('UtilitaireSideNav.js');const MoteurMessagerie=require('MoteurMessagerie.js');class UtilitaireContactVieScolaire_Mobile extends UtilitaireContactVieScolaire{constructor(...aParams){super(...aParams);this.listeConversationsEnCours=new ObjetListeElements();}
creerChat(aParams){const lInstance=ObjetIdentite.creerInstance(ObjetDiscussion_Mobile,{pere:this,moteurMessagerie:_creerMoteurMessagerie(this)});lInstance.setOptions({estSidePanel:true,estChat:true,genreDiscussion:aParams.genreDiscussion,callbackFermeture:function(){lInstance.free();}}).setDonnees({titre:aParams.objet,creationDiscussion:true,alertePPMS:aParams.alerte,destinataires:{listeDestinataires:aParams.listeDestinataires},listeContacts:aParams.listeContacts});}
creerNouvelleDiscussion(aParams){const lInstance=ObjetIdentite.creerInstance(ObjetDiscussion_Mobile,{pere:this,moteurMessagerie:_creerMoteurMessagerie(this)});const lGenresDest=[];[EGenreRessource.Personnel,EGenreRessource.Enseignant].forEach((aGenre) =>{if(TUtilitaireMessagerie.estGenreDestinataireAutorise(aGenre)){lGenresDest.push(aGenre);}});lInstance.setOptions({estSidePanel:true,genreDiscussion:aParams.genreDiscussion,genresDestinatairesAutorises:lGenresDest,avecDestinatairesListeDiffusion:false,callbackEnvoyer:function(){lInstance.masquer();Invocateur.evenement('actualiserListeDiscussion_mobile');}.bind(this),callbackFermeture:function(){lInstance.free();}}).setDonnees({titre:aParams.objet,creationDiscussion:true,destinataires:{listeDestinataires:aParams.listeDestinataires},listeContacts:aParams.listeContacts});}
creerChatDeListe(aListe){if(!aListe||aListe.GetNbrElements()===0){return;}
const lListeChats=new ObjetListeElements();const lNbConversations=this.listeConversationsEnCours.GetNbrElements();aListe.parcourir(function(aMessage){if(aMessage.GetGenre()===TypeGenreDiscussion.GD_Conversation){let lTrouve=false;this.listeConversationsEnCours.parcourir(function(aMessageEnCours,aIndex){if(TUtilitaireMessagerie.avecPossessionPartageeEntreMessages(aMessageEnCours,aMessage)){lTrouve=true;this.listeConversationsEnCours.AddElement(aMessage,aIndex);return false;}}.bind(this));if(!lTrouve){if(this._avecConversationsEnPopup()){this.listeConversationsEnCours.add(aMessage);} else{lListeChats.add(aMessage);}}} else{lListeChats.add(aMessage);}}.bind(this));if(lNbConversations!==this.listeConversationsEnCours.GetNbrElements()){Invocateur.evenement('modifier_nb_conversationEnCours',this.listeConversationsEnCours.GetNbrElements());}
if(lListeChats.GetNbrElements()>0){_initFenetreChatMultiple.call(this,lListeChats);}}
afficher_destMessageInstantane(aParams){if(this.sideNavConversation){this.sideNavConversation.fermer();delete this.sideNavConversation;}
this.sideNavConversation=UtilitaireSideNav.createComplet(InterfaceWrapperDestMessageInstantane_Mobile,{pere:this,options:{getListeConversations:function(){return this.listeConversationsEnCours;}.bind(this),surMessage:function(aMessage){_initFenetreChatMultiple.call(this,new ObjetListeElements().add(aMessage));}.bind(this),surSuppressionConversationEnCours:function(aMessageCherche){let lTrouve=false;this.listeConversationsEnCours.parcourir(function(aMessage,aIndice){if(TUtilitaireMessagerie.avecPossessionPartageeEntreMessages(aMessageCherche,aMessage)){this.listeConversationsEnCours.remove(aIndice);lTrouve=true;return false;}}.bind(this))
;if(lTrouve){Invocateur.evenement('modifier_nb_conversationEnCours',this.listeConversationsEnCours.GetNbrElements());}}.bind(this)},start:function(aInstance){aInstance.setDonnees(aParams);}});}}
function _creerMoteurMessagerie(aInstance){return new MoteurMessagerie().setOptions({instance:aInstance,estChat:true});}
function _creerFenetreChatMultiple(aIndiceCourant,aListe,aInstance,aMoteurMessagerie){const lMessage=aListe.GetElement(aIndiceCourant);aMoteurMessagerie.requeteMessagesVisu({message:lMessage,marquerCommeLu:true}).then(function(aParam){if(lMessage.estAlerte){this.compteurFenetreAlertePPMS+=1;}
const lInfosMessage=this._getInfosChatMessage(lMessage);const lNbMessages=aListe.GetNbrElements();const lTitre=lNbMessages<2?lInfosMessage.titre:GChaine.Format('(%s/%s) %s',[aIndiceCourant+1,lNbMessages,lInfosMessage.titre]);aInstance.setOptions({estSidePanel:true,estChat:true,callbackNavigation:lNbMessages>1?function(aPrec){aIndiceCourant+=aPrec?-1:1;if(aIndiceCourant<0){aIndiceCourant=lNbMessages-1;} else if(aIndiceCourant>=lNbMessages){aIndiceCourant=0;}
if(lMessage.estAlerte){this.compteurFenetreAlertePPMS=Math.max(0,this.compteurFenetreAlertePPMS-1);}
_creerFenetreChatMultiple.call(this,aIndiceCourant,aListe,aInstance,aMoteurMessagerie);}.bind(this):null,callbackFermeture:function(){if(lMessage.estAlerte){this.compteurFenetreAlertePPMS=Math.max(0,this.compteurFenetreAlertePPMS-1);}
aInstance.free();}.bind(this)}).setDonnees(Object.assign({titre:lTitre,message:lMessage,contenuInitial:lInfosMessage.contenuInitial},aParam));}.bind(this));}
function _initFenetreChatMultiple(aListe){const lMoteurMessagerie=_creerMoteurMessagerie(this);const lIndiceChatCourant=0;const lInstance=ObjetIdentite.creerInstance(ObjetDiscussion_Mobile,{pere:this,moteurMessagerie:lMoteurMessagerie});_creerFenetreChatMultiple.call(this,lIndiceChatCourant,aListe,lInstance,lMoteurMessagerie);}
module.exports=new UtilitaireContactVieScolaire_Mobile();},fn:"utilitairecontactviescolaire_mobile.js"});;
IE.fModule({f:function(exports,require,module,global){class ObjetThemesPrimaire{setTheme(){const lThemeCourant=this.getTheme();$('#'+GApplication.getIdConteneur().escapeJQ()).addClass(lThemeCourant);}
getTheme(){const lGenreTheme=this.getGenreTheme();let lClass='';switch(lGenreTheme){case'0':lClass='ThemeButterfly';break;case'1':lClass='ThemeNotebook';break;case'2':lClass='ThemeSchool';break;}
return'AvecThemeFond '+(lClass||'ThemeSchool');}
getGenreTheme(){const T=new RegExp('[?&]'+'theme'+'=([^&#]*)').exec(window.location.href);return T?T[1]:'2';}}
module.exports.GThemesPrimaire=new ObjetThemesPrimaire();},fn:"themesprimaire.js"});;
IE.fModule({f:function(exports,require,module,global){const EGenreRepas={Midi:0,Soir:1};module.exports=EGenreRepas;},fn:"enumere_repas.js"});;
IE.fModule({f:function(exports,require,module,global){const EGenreSanction={Avertissement:0,Blame:1,ExclusionTemporaireEtablissement:2,ExclusionTemporaireClasse:3,ExclusionDefinitive:4,Autre_Exclusion:5,ExclusionInternat:6,ExclusionDP:7,Autre_Sanction:8,Responsabilisation:9,MesureConservatoire:10};EGenreSanction.getSanctionsDansLOrdre=function(){return[EGenreSanction.ExclusionDefinitive,EGenreSanction.ExclusionTemporaireEtablissement,EGenreSanction.ExclusionTemporaireClasse,EGenreSanction.ExclusionDP,EGenreSanction.ExclusionInternat,EGenreSanction.Autre_Exclusion,EGenreSanction.Responsabilisation,EGenreSanction.Avertissement,EGenreSanction.Blame,EGenreSanction.Autre_Sanction];};EGenreSanction.estUneExclusion=function(aGenre){switch(aGenre){case EGenreSanction.ExclusionDP:case EGenreSanction.ExclusionDefinitive:case EGenreSanction.ExclusionInternat:case EGenreSanction.ExclusionTemporaireClasse:case EGenreSanction.ExclusionTemporaireEtablissement:case EGenreSanction.Autre_Exclusion:return true;}
return false;};EGenreSanction.estUneExclusionTemporaire=function(aGenre){switch(aGenre){case EGenreSanction.ExclusionDP:case EGenreSanction.ExclusionInternat:case EGenreSanction.ExclusionTemporaireClasse:case EGenreSanction.ExclusionTemporaireEtablissement:case EGenreSanction.Autre_Exclusion:return true;}
return false;};module.exports=EGenreSanction;},fn:"enumere_sanction.js"});;
IE.fModule({f:function(exports,require,module,global){const TypeGenreIndividuAuteur={GIA_Administratif:0,GIA_Inspecteur:1,GIA_Personnel:2,GIA_Professeur:3,GIA_ProfesseurHistorique:4,GIA_PersonnelHistorique:5,GIA_MaitreDeStage:6,GIA_Responsable:7,GIA_Eleve:8,GIA_Utilisateur:9,GIA_ResponsablePostulant:10,GIA_AgentCollectivite:11};module.exports.TypeGenreIndividuAuteur=TypeGenreIndividuAuteur;},fn:"typegenreindividuauteur.js"});;
IE.fModule({f:function(exports,require,module,global){const TypePerimetreMesureConservatoire={PMC_Internat:0,PMC_Externat:1,PMC_DP:2};module.exports.TypePerimetreMesureConservatoire=TypePerimetreMesureConservatoire;},fn:"typeperimetremesureconservatoire.js"});;
IE.fModule({f:function(exports,require,module,global){const ObjetFenetre_Mobile=require('ObjetFenetre_Mobile.js');class ObjetFiche_Mobile extends ObjetFenetre_Mobile{constructor(...aParams){super(...aParams);this.EnAffichage=false;this.idContenu=this.Nom+'_ContenuFiche';this.IdPremierElement=this.idContenu;this.setOptionsFenetre({estFicheMobile:true,modale:false,largeur:null,hauteur:null,avecAbonnementBlocage:true,avecAbonnementPremierPlan:true,htmlContenu:''});}
Compose(){const H=[];H.push('<div tabindex="-1" id="',this.idContenu,'">');H.push(this.optionsFenetre.htmlContenu||this.ComposeContenu());H.push('</div>');return H.join('');}
SurAfficher(){if(this.surPreAffichage){this.surPreAffichage();}
this.positionnerFenetre(this._parametresAffichageFiche);}
actualiser(){this.Afficher();}
Afficher(){super.Afficher(this.Compose());}
afficherFiche(){this.Afficher();}
Fermer(aSurInteractionUtilisateur){const lEstEnAffichage=this.EnAffichage;super.Fermer();if(lEstEnAffichage){const LSurInteractionUtilisateur=aSurInteractionUtilisateur===null||aSurInteractionUtilisateur===undefined?true:aSurInteractionUtilisateur;if(LSurInteractionUtilisateur){this.callback.appel();}}}}
module.exports=ObjetFiche_Mobile;},fn:"objetfiche_mobile.js"});;
IE.fModule({f:function(exports,require,module,global){if(IE.estMobile){module.exports=require('ObjetFiche_Mobile.js');} else{module.exports=require('ObjetFiche_Espace.js');}},fn:"objetfiche.js"});;
IE.fModule({f:function(exports,require,module,global){const{GDate}=require('ObjetDate.js');class MoteurSelecteurDate{constructor(aParams){this.options={premiereDate:GDate.premiereDate,derniereDate:GDate.derniereDate,premiereDateSaisissable:undefined,afficherPremiereDateSaisissable:true,avecSelectionSemaine:false,joursSemaineValide:GDate.joursOuvres,domaineValide:undefined,joursFeries:global.GParametres?global.GParametres.JoursFeries:undefined,joursValidesAnnuels:undefined,estJoursValidesAnnuelsSelonPremiereDate:false,joursMarques:undefined,estJoursMarquesSelonPremiereDate:false},this.setOptions(aParams);}
setOptions(aOptions){Object.assign(this.options,aOptions);if(this.options.premiereDate&&this.options.derniereDate&&this.options.derniereDate<this.options.premiereDate){this.options.derniereDate=new Date(this.options.premiereDate.getTime());}
if(this.options.premiereDateSaisissable){this.options.premiereDateSaisissable=this.getDateBornee(this.options.premiereDateSaisissable);}
return this;}
estDateValide(aDate){if(!aDate||!aDate.getDay){return false;}
if(!this.estDateDansBorne(aDate,true)){return false;}
if(!this.estJoursSemaineValide(aDate)){return false;}
const lDateDebCycle=IE.Cycles.dateDebutPremierCycle();const lNbjours=GDate.getNbrJoursEntreDeuxDates(lDateDebCycle,aDate)+1;if(this.options.joursFeries&&this.options.joursFeries.GetValeur(lNbjours)){return false;}
const lNbJoursPremDate=this.options.estJoursValidesAnnuelsSelonPremiereDate?GDate.getNbrJoursEntreDeuxDates(this.options.premiereDate,aDate):GDate.getNbrJoursEntreDeuxDates(lDateDebCycle,aDate)+1;if(this.options.joursValidesAnnuels&&!this.options.joursValidesAnnuels.GetValeur(lNbJoursPremDate)){return false;}
if(this.options.domaineValide){const lNumeroCycle=IE.Cycles.cycleDeLaDate(aDate);if(lNumeroCycle<=0||!this.options.domaineValide.GetValeur(lNumeroCycle)){return false;}}
return true;}
getPremiereDateValide(){return this.options.premiereDateSaisissable?this.options.premiereDateSaisissable:this.options.premiereDate;}
estJoursSemaineValide(aDate){const lJour=GDate.GetJourDeDate(aDate);return this.options.joursSemaineValide?this.options.joursSemaineValide.GetValeur(lJour+1):true;}
estDateDansBorne(aDate,aAvecDateValide){const lPremiereDate=aAvecDateValide?this.getPremiereDateValide():this.options.premiereDate;if(lPremiereDate&&GDate.GetDifferenceJours(aDate,lPremiereDate)<0){return false;}
if(this.options.derniereDate&&GDate.GetDifferenceJours(aDate,this.options.derniereDate)>0){return false;}
return true;}
getDateBornee(aDate,aAvecDateValide){const lPremiereDate=aAvecDateValide?this.getPremiereDateValide():this.options.premiereDate;if(lPremiereDate&&aDate<lPremiereDate&&!GDate.estJourEgal(aDate,lPremiereDate)){return new Date(lPremiereDate.getTime());}
if(this.options.derniereDate&&aDate>this.options.derniereDate&&!GDate.estJourEgal(aDate,this.options.derniereDate)){return new Date(this.options.derniereDate.getTime());}
return new Date(aDate.getTime());}
rechercheSuivantValide(aDate,aSensRechercheInverse){if(this.options.avecSelectionSemaine){return _getSemaineSuivanteValide.call(this,aDate,aSensRechercheInverse,true);} else{return _getJourSuivantValide.call(this,aDate,aSensRechercheInverse,true);}}
getDateSelonValidite(aDate){if(this.options.derniereDate&&aDate>this.options.derniereDate){return _getJourSuivantValide.call(this,this.options.derniereDate,true)||aDate;}
if(this.options.premiereDate&&aDate<this.options.premiereDate){return _getJourSuivantValide.call(this,this.options.premiereDate,false)||aDate;}
return _getJourSuivantValide.call(this,aDate,false)||aDate;}}
function _getJourSuivantValide(aDateCourant,aSensRechercheInverse,aAvecIncrement){const lNrJours=aSensRechercheInverse?-1:1;let lDateCourant=aAvecIncrement?GDate.GetJourSuivant(aDateCourant,lNrJours):aDateCourant;const lAvecArret=(aSensRechercheInverse&&!this.getPremiereDateValide())||(!aSensRechercheInverse&&!this.options.derniereDate);let lCompteurArret=30;if(!this.estDateValide(lDateCourant)&&this.estDateDansBorne(lDateCourant,true)){do{lDateCourant=GDate.GetJourSuivant(lDateCourant,lNrJours);if(lAvecArret){lCompteurArret-=1;}}
while(!this.estDateValide(lDateCourant)&&this.estDateDansBorne(lDateCourant,true)&&lCompteurArret>=0);}
if(!this.estDateValide(lDateCourant)){return null;} else{return lDateCourant;}}
function _getSemaineSuivanteValide(aDate,aSensRechercheInverse,aAvecIncrement){let lDateCourant=aDate;const lNumeroCycle=IE.Cycles.cycleDeLaDate(lDateCourant);const lIncrement=aSensRechercheInverse?-1:1;const lAvecArret=(aSensRechercheInverse&&!this.getPremiereDateValide())||(!aSensRechercheInverse&&!this.options.derniereDate);if(aAvecIncrement){lDateCourant=aSensRechercheInverse?IE.Cycles.dateDernierJourOuvreCycle(lNumeroCycle-1):IE.Cycles.dateDebutCycle(lNumeroCycle+1);}
if(!this.estDateValide(lDateCourant)&&this.estDateDansBorne(GDate.GetJourSuivant(lDateCourant,lIncrement),true)){do{lDateCourant=GDate.GetJourSuivant(lDateCourant,lIncrement);}
while(!this.estDateValide(lDateCourant)&&this.estDateDansBorne(lDateCourant,true)&&!lAvecArret);}
if(!this.estDateValide(lDateCourant)){return null;}
return this.getDateBornee(lDateCourant,true);}
module.exports=MoteurSelecteurDate;},fn:"moteurselecteurdate.js"});;
IE.fModule({f:function(exports,require,module,global){require('script/css/InterfaceSelectionDate.css');const GHtml=require('GHtml.js');const GStyle=require('GStyle.js');const EGenreEvenementObjetSaisie=require('Enumere_EvenementObjetSaisie.js');const EStructureAffichage=require('Enumere_StructureAffichage.js');const{GDate}=require('ObjetDate.js');const ObjetAbstraitInterface=require('ObjetInterface.js');const ObjetListeElements=require('ObjetListeElements.js');const ObjetElement=require('ObjetElement.js');const GTraductions=require('ObjetTraduction.js');const tag=require('tag.js');const MoteurSelecteurDate=require('MoteurSelecteurDate.js');const ToucheClavier=require('ToucheClavier.js');class InterfaceSelecteurDate extends ObjetAbstraitInterface{constructor(...aParams){super(...aParams);this.IdContenu=this.Nom+'_Contenu';this.nbrLignes=6;this.nbrColonnes=7;this.idJours=this.Nom+'_Jours';this.parametres={listeMois:new ObjetListeElements(),indiceMoisCourant:-1};this.moteurDate=new MoteurSelecteurDate();}
setMoteurDate(aMoteurDate){this.moteurDate=aMoteurDate;}
SetParametresGeneraux(){this.GenreStructure=EStructureAffichage.Autre;}
getControleur(aInstance){return $.extend(true,super.getControleur(this),{comboMois:{init(aCombo){aInstance.comboMois=aCombo;aCombo.setOptions_ObjetSaisie({longueur:_avecComboAnnee.call(aInstance)?80:120,avecDesignMobile:IE.estMobile,avecBouton:!IE.estMobile,avecBoutonsPrecSuiv:true,getClassElement(aParams){if(aParams.element.estMoisPrecedent||aParams.element.estMoisSuivant){return'element-distinct';}
return'';}});},event:_eventSurSelecMois.bind(aInstance),getDisabled(){const lListeArticles=aInstance.comboMois.getListeElements();return!lListeArticles||lListeArticles.GetNbrElements()<2;}},comboAnnee:{init(aCombo){aInstance.comboAnnee=aCombo;aCombo.setOptions_ObjetSaisie({longueur:40,avecDesignMobile:IE.estMobile,avecBouton:!IE.estMobile,avecBoutonsPrecSuiv:true});},event:_eventSelecAnnee.bind(aInstance),getDisabled(){const lListeArticles=aInstance.comboAnnee.getListeElements();return!lListeArticles||lListeArticles.GetNbrElements()<2;}}});}
ConstruireStructureAffichageAutre(){const H=[];H.push('<div class="InterfaceSelectionDate" id="',this.IdContenu,'"></div>');return H.join('');}
SetDonnees(aDate,aAvecDate){if(aAvecDate===undefined){aAvecDate=true;}
this.dateCourante=GDate.getDateCourante(this.moteurDate.options.bornerDateCourante);this.avecDate=(aDate!==null&&aDate!==undefined&&aAvecDate);this.date=this.avecDate?this.moteurDate.getDateBornee.call(this,aDate):this.dateCourante;const lDateBornee=this.moteurDate.getDateBornee(this.date);if(!this.comboAnnee){this.parametres.listeMois=GDate.getListeMoisAPartirDeDate(this.moteurDate.options.premiereDate,this.moteurDate.options.derniereDate);} else{this.parametres.listeMois=_construireListeMoisDAnnee.call(this,lDateBornee.getFullYear());}
GHtml.setHtml(this.IdContenu,this.ComposeContenu(),{controleur:this.controleur});this.Afficher();if(this.comboAnnee){_construireListeAnnees.call(this,this.date);}
this.parametres.indiceMoisCourant=_getIndiceMoisDeDate.bind(this)(this.date);this.comboMois.SetDonnees(this.parametres.listeMois,this.parametres.indiceMoisCourant);$('#'+this.idJours.escapeJQ()).on({focusin:function(event){const lInfo=_getLigneEtColonne(this);event.data.instance.surSurvol(lInfo.i,lInfo.j,true);},focusout:function(event){const lInfo=_getLigneEtColonne(this);event.data.instance.surSurvol(lInfo.i,lInfo.j,false);},keyup:function(event){const lInfo=_getLigneEtColonne(this);_surKeyUp.call(event.data.instance,lInfo.i,lInfo.j,event);},pointerover:function(event){const lInfo=_getLigneEtColonne(this);event.data.instance.surSurvol(lInfo.i,lInfo.j,true);},pointerout:function(event){const lInfo=_getLigneEtColonne(this);event.data.instance.surSurvol(lInfo.i,lInfo.j,false);},click:function(event){const lInfo=_getLigneEtColonne(this);event.data.instance.surSelection(lInfo.i,lInfo.j);}},'td.date',{instance:this});}
ComposeContenu(){if(this.dateCourante===null||this.dateCourante===undefined){return'';}
const lAvecComboAnnee=_avecComboAnnee.call(this);const T=[];T.push(tag('div',{class:['combos-container']},tag('ie-combo',{'ie-model':'comboMois',class:'combo-selecteur'}),lAvecComboAnnee?tag('ie-combo',{'ie-model':'comboAnnee',class:'combo-selecteur'}):''),tag('div',{id:this.idJours}));return T.join('');}
composeJour(I,J){const lHtml=[];const lDate=GDate.GetJourSuivant(this.premierLundiDuMois,I*7+J);const lPremDateSais=this.moteurDate.getPremiereDateValide();const lEstJoursActif=this.estJourActif(I,J);const lId=this.Nom+'_'+I+'_'+J;const lIdTD=this.Nom+'_td_'+I+'_'+J;let lClass=['date'];if(lEstJoursActif){lClass.push('actif');}
if(this.estJourDuMois(I,J)){lClass.push('current-month');}
if(GDate.estJourCourant(lDate,false)){lClass.push('current-date');}
if(this.avecDate){if(this.moteurDate.options.avecSelectionSemaine?lEstJoursActif&&IE.Cycles.cycleDeLaDate(lDate)===IE.Cycles.cycleDeLaDate(this.date):GDate.estJourEgal(lDate,this.date)){lClass.push('selected-date');}}
if(GDate.estDateJourAvant(lDate<this.dateCourante)){lClass.push('previous-date');}
if(this.estJourMarque(lDate)){lClass.push('with-mark');}
if(this.moteurDate.options.afficherPremiereDateSaisissable&&this.moteurDate.options.premiereDateSaisissable&&GDate.estJourEgal(lDate,this.moteurDate.options.premiereDateSaisissable)&&!GDate.estJourEgal(this.moteurDate.options.premiereDateSaisissable,this.moteurDate.options.premiereDate)){lClass.push('first-selectable-date');}
if(I===0){lClass.push('b-top');}
if(I===this.nbrLignes-1){lClass.push('b-bottom');}
if(J===0){lClass.push('b-left');}
if(J===this.nbrColonnes-1){lClass.push('b-right');}
const lTabIndex=!lPremDateSais||
GDate.estJourEgal(lDate,lPremDateSais)||(I===0&&J===0&&GDate.GetDifferenceJours(lDate,lPremDateSais)>0)?"0":"-1";lHtml.push(tag('td',{id:lIdTD,class:lClass,tabindex:lTabIndex,'aria-disabled':lEstJoursActif?false:'true','aria-label':GDate.FormatDate(lDate,'%JJJJ %J %MMM %AAAA')},tag('div',tag('div',{id:lId},tag('div',tag('div',GDate.FormatDate(lDate,'%J')))))));return lHtml.join('');}
surSurvol(I,J,aSurvol){const lId=this.Nom+'_td_'+I+'_'+J;if(this.ICourant&&this.JCourant&&this.JCourant!== -1&&(this.ICourant!==I||this.JCourant!==J)){this.surSurvol(this.ICourant,this.JCourant,false);}
if(aSurvol){this.ICourant=I;this.JCourant=J;GHtml.setFocus(lId);}}
surSelection(I,J){if(!this.estJourActif(I,J)){return;}
this.Pere.date=GDate.getDateJour(GDate.GetJourSuivant(this.premierLundiDuMois,I*7+J));this.Pere.SurValidation(1,this.mois,this.annee);}
estJourDuMois(I,J){const lDate=GDate.GetJourSuivant(this.premierLundiDuMois,I*7+J);const lMois=lDate.getMonth();return lMois===this.mois&&this.moteurDate.estDateDansBorne(lDate);}
estJourActif(I,J){return this.estJourValide(I,J);}
estJourValide(I,J){const lDate=GDate.GetJourSuivant(this.premierLundiDuMois,I*7+J);return this.moteurDate.estDateValide(lDate);}
estJourSemaineOuvre(J){return this.moteurDate.options.joursSemaineValide?this.moteurDate.options.joursSemaineValide.GetValeur(J+1):true;}
estJourMarque(aDate){const lNbJours=this.moteurDate.options.estJoursMarquesSelonPremiereDate?GDate.getNbrJoursEntreDeuxDates(this.moteurDate.options.premiereDate,aDate):GDate.getNbrJoursEntreDeuxDates(IE.Cycles.dateDebutPremierCycle(),aDate)+1;return this.moteurDate.options.joursMarques?this.moteurDate.options.joursMarques.GetValeur(lNbJours):false;}}
function _avecComboAnnee(){return!this.moteurDate.options.premiereDate||!this.moteurDate.options.derniereDate;}
function _eventSurSelecMois(aParams){if(aParams.genreEvenement===EGenreEvenementObjetSaisie.selection&&aParams.element){if(aParams.estSelectionManuelle&&(aParams.element.estMoisSuivant||aParams.element.estMoisPrecedent)){const lIndice=this.parametres.indiceAnnee+(aParams.element.estMoisSuivant?1:-1);this.comboAnnee.SetSelection(lIndice);} else{this.parametres.indiceMoisCourant=aParams.indice;_actualiserSelonMoisCourant.call(this,aParams.element);}}}
function _eventSelecAnnee(aParams){if(aParams.genreEvenement===EGenreEvenementObjetSaisie.selection){this.parametres.listeMois=_construireListeMoisDAnnee.call(this,aParams.element.annee);this.parametres.listeMois.parcourir((aMoisListe,aIndex) =>{if(!aMoisListe.estMoisPrecedent&&!aMoisListe.estMoisSuivant){this.parametres.indiceMoisCourant=aIndex;if(aParams.indice>this.parametres.indiceAnnee){return false;}}});this.parametres.indiceAnnee=aParams.indice;this.comboMois.SetDonnees(this.parametres.listeMois,this.parametres.indiceMoisCourant);}}
function _getIndiceMoisDeDate(aDate){const lAnnee=aDate.getFullYear();const lMois=aDate.getMonth();let lIndice=0;this.parametres.listeMois.parcourir(function(D,aIndex){if(D.mois===lMois&&D.annee===lAnnee){lIndice=aIndex;return false;}});return lIndice;}
function _actualiserSelonMoisCourant(aArticleMois){this.mois=aArticleMois.mois;this.annee=aArticleMois.annee;this.premierJourDuMois=GDate.GetPremierJourDuMois(aArticleMois.annee,aArticleMois.mois);this.premierLundiDuMois=GDate.GetPremierLundiDuMois(aArticleMois.annee,aArticleMois.mois);this.premiereSemaineDuMois=IE.Cycles.cycleDeLaDate(this.premierLundiDuMois);this.$refreshSelf();_afficherJoursDeMoisCourant.bind(this)();}
function _getLigneEtColonne(aElement){return{i:GHtml.extraireNombreDId(aElement.id,1),j:GHtml.extraireNombreDId(aElement.id)};}
function _construireListeMoisDAnnee(aAnnee){let lPremiereDate=GDate.GetPremierJourDuMois(aAnnee,0);let lDerniereDate=GDate.GetDernierJourDuMois(aAnnee,11);let lAvecMoisPrec=false;if(this.moteurDate.options.premiereDate&&this.moteurDate.options.premiereDate>lPremiereDate){lPremiereDate=this.moteurDate.options.premiereDate;} else{lAvecMoisPrec=true;}
let lAvecMoisSuiv=false;if(this.moteurDate.options.derniereDate&&this.moteurDate.options.derniereDate<lDerniereDate){lDerniereDate=this.moteurDate.options.derniereDate;} else{lAvecMoisSuiv=true;}
const lListe=GDate.getListeMoisAPartirDeDate(lPremiereDate,lDerniereDate,'%MMMM');if(lAvecMoisPrec){lListe.insererElement(new ObjetElement({Libelle:GDate.FormatDate(GDate.GetDernierJourDuMois(aAnnee-1,11),'%MMMM %AAAA'),estMoisPrecedent:true,annee:aAnnee-1}),0);}
if(lAvecMoisSuiv){lListe.add(new ObjetElement({Libelle:GDate.FormatDate(GDate.GetDernierJourDuMois(aAnnee+1,0),'%MMMM %AAAA'),estMoisSuivant:true,annee:aAnnee+1}));}
return lListe;}
function _construireListeAnnees(aDate){const lListeAnnees=new ObjetListeElements();const lAnneeCourante=aDate.getFullYear();let lAnneeDebut=lAnneeCourante;let lAnneeFin=lAnneeCourante;if(this.moteurDate.options.premiereDate){lAnneeDebut=this.moteurDate.options.premiereDate.getFullYear();} else{lAnneeDebut=lAnneeCourante-100;}
if(this.moteurDate.options.derniereDate){lAnneeFin=this.moteurDate.options.derniereDate.getFullYear();} else{lAnneeFin=lAnneeCourante+100;}
this.parametres.indiceAnnee=0;for(let lAnnee=lAnneeDebut;lAnnee<=lAnneeFin;lAnnee++){lListeAnnees.add(new ObjetElement({Libelle:lAnnee+'',annee:lAnnee}));if(lAnneeCourante===lAnnee){this.parametres.indiceAnnee=lListeAnnees.GetNbrElements()-1;}}
this.comboAnnee.SetDonnees(lListeAnnees,this.parametres.indiceAnnee);}
function _getJourPremierSemaine(){return GDate.PremierLundi?GDate.GetJourDeDate(GDate.PremierLundi):0;}
function _afficherJoursDeMoisCourant(){const T=[];T.push('<table class="Texte10 EspaceHaut" style="'+GStyle.composeCouleurTexte(GCouleur.noir)+'" border="0" cellpadding="0" cellspacing="0">');T.push('<tr class="titre-jours">');for(let J=0;J<this.nbrColonnes;J++){const lJour=(J+_getJourPremierSemaine())%7;T.push('<td',(this.estJourSemaineOuvre(lJour)?' class="ouvre"':''),'>',GTraductions.getValeur('JoursCourt')[lJour],'</td>');}
T.push('</tr>');for(let I=0;I<this.nbrLignes;I++){T.push('<tr class="jours">');for(let J=0;J<this.nbrColonnes;J++){T.push(this.composeJour(I,J));}
T.push('</tr>');}
T.push('</table>');GHtml.setHtml(this.idJours,T.join(''),true);}
function _surKeyUp(I,J,aEvent){if(ToucheClavier.estEventSelection(aEvent)){if(this.estJourValide(I,J)){this.surSelection(I,J);}} else if(aEvent.which===ToucheClavier.FlecheHaut&&I>0){this.surSurvol(I,J,false);this.surSurvol(I-1,J,true);} else if(aEvent.which===ToucheClavier.FlecheBas&&I+1<this.nbrLignes){this.surSurvol(I,J,false);this.surSurvol(I+1,J,true);} else if(aEvent.which===ToucheClavier.FlecheGauche&&J>0){this.surSurvol(I,J,false);this.surSurvol(I,J-1,true);} else if(aEvent.which===ToucheClavier.FlecheDroite&&J+1<this.nbrColonnes){this.surSurvol(I,J,false);this.surSurvol(I,J+1,true);} else if(aEvent.which===ToucheClavier.Debut){this.surSurvol(I,J,false);this.surSurvol(aEvent.ctrlKey?0:I,0,true);} else if(aEvent.which===ToucheClavier.Fin){this.surSurvol(I,J,false);this.surSurvol(aEvent.ctrlKey?this.nbrLignes-1:I,this.nbrColonnes-1,true);}}
module.exports=InterfaceSelecteurDate;},fn:"interfaceselecteurdate.js"});;
IE.fModule({f:function(exports,require,module,global){const InterfaceSelecteurDate=require('InterfaceSelecteurDate.js');const ObjetFenetre=require('ObjetFenetre.js');const ObjetListeElements=require('ObjetListeElements.js');const GTraductions=require('ObjetTraduction.js');const MoteurSelecteurDate=require('MoteurSelecteurDate.js');class ObjetFenetre_Date extends ObjetFenetre{constructor(...aParams){super(...aParams);this.setOptionsFenetre({titre:GTraductions.getValeur('Fenetre_Date.Titre'),largeur:200,hauteur:100,fermerFenetreSurClicHorsFenetre:IE.estMobile,avecTailleSelonContenu:true,listeBoutons:[GTraductions.getValeur('Fermer')],avecAucuneDate:false});this.moteurDate=new MoteurSelecteurDate();this.parametres={listeMois:new ObjetListeElements(),indiceMoisCourant:-1};}
ComposeContenu(){const T=[];T.push('<div id="',this.GetInstance(this.identSelecteur).GetNom(),'" class="ContentBox"></div>');return T.join('');}
setParametres(aPremierLundi,aPremiereDate,aDerniereDate,aActifJour,aActifSemaine,aJoursFeries,aAvecAucuneDate){this.setOptionsMoteurDate({premiereDate:aPremiereDate,derniereDate:aDerniereDate,joursSemaineValide:aActifJour,domaineValide:aActifSemaine,joursFeries:aJoursFeries});if(aAvecAucuneDate!==undefined){this.setOptionsFenetre({avecAucuneDate:aAvecAucuneDate});}}
setMoteurDate(aMoteurDate){this.moteurDate=aMoteurDate;}
setOptionsMoteurDate(aOptions){this.moteurDate.setOptions(aOptions);}
SetDonnees(aDate){this.Afficher();this.date=aDate;if(this.optionsFenetre.avecAucuneDate){this.setOptionsFenetre({listeBoutons:[GTraductions.getValeur('Fenetre_Date.AucuneDate')]});}
this.GetInstance(this.identSelecteur).SetDonnees(aDate);}
ConstruireInstances(){this.identSelecteur=this.Add(InterfaceSelecteurDate,null,(aInstance) =>{aInstance.setMoteurDate(this.moteurDate);});}
setJoursMarques(aJoursMarques){this.moteurDate.setOptions({joursMarques:aJoursMarques});}
setPremiereDateSaisissable(aPremiereDateSaisissable,aAfficher){this.moteurDate.setOptions({premiereDateSaisissable:aPremiereDateSaisissable||this.moteurDate.options.premiereDate,afficherPremiereDateSaisissable:aAfficher?aAfficher:false});}
SurValidation(aGenreBouton){if(aGenreBouton=== -1||aGenreBouton===0||this.moteurDate.estDateDansBorne(this.date)){this.Fermer();this.callback.appel(aGenreBouton,this.date);}}}
module.exports=ObjetFenetre_Date;},fn:"objetfenetre_date.js"});;
IE.fModule({f:function(exports,require,module,global){require('Produit/Css/Form-components.css');const ControleSaisieEvenement=require('ControleSaisieEvenement.js');const EEvent=require('Enumere_Event.js');const{GDate}=require('ObjetDate.js');const ObjetFenetre=require('ObjetFenetre.js');const ObjetFenetre_Date=require('ObjetFenetre_Date.js');const Identite=require('ObjetIdentite.js');const GTraductions=require('ObjetTraduction.js');const{ObjetCelluleBouton,EGenreBoutonCellule}=require('ObjetCelluleBouton.js');const MoteurSelecteurDate=require('MoteurSelecteurDate.js');const ToucheClavier=require('ToucheClavier.js');const{EGenreRole}=require('ObjetWAI.js');class ObjetCelluleDate extends Identite{constructor(...aParams){super(...aParams);this.moteurDate=new MoteurSelecteurDate();this.options=this.moteurDate.options;this._optionsFenetre={};this.moteurDate.setOptions({avecInitDateSiVide:IE.estMobile,avecControleDateInit:IE.estMobile,labelWAIEdit:'',largeurComposant:IE.estMobile?'':75,hauteurComposant:17,formatDate:'[%JJJ %JJ %MMM]',avecBoutonsPrecedentSuivant:false,genreBoutonCellule:IE.estMobile?EGenreBoutonCellule.Aucun:EGenreBoutonCellule.Image,iconeGauche:IE.estMobile?'icon_calendar_empty':'',classeCSSTexte:'Gras',designMobile:IE.estMobile,selecteurMobile:false,placeHolder:''});if(!IE.estMobile){this.moteurDate.setOptions({joursSemaineValide:null,joursFeries:null});}}
DetruireInstances(){this._fermerFenetreDate();}
getControleur(aInstance){return $.extend(true,super.getControleur(this),{getStyle:function(){return{'width':(aInstance.options.largeurComposant&&aInstance.options.largeurComposant==='100%'?'100%':'')};},getClassesDynamiques:function(){const lClasses=[];if(!aInstance.getActif()){lClasses.push('input-wrapper-disabled');}
return lClasses.join(' ');},btn:{event:function(aPrecedent){_eventDateSuivante.call(aInstance,aPrecedent);},getDisabled:function(aPrecedent){return _getDisabledBtnPrecSuiv.call(aInstance,aPrecedent);},getTitle:function(aPrecedent){return aPrecedent?GTraductions.getValeur('Precedent'):GTraductions.getValeur('Suivant');}},getNodeCellulePrecSuiv(){$(this.node).on({'swipeleft':function(){if(!_getDisabledBtnPrecSuiv.call(aInstance,false)){_eventDateSuivante.call(aInstance,false);}},'swiperight':function(){if(!_getDisabledBtnPrecSuiv.call(aInstance,true)){_eventDateSuivante.call(aInstance,true);}}});}});}
setOptions_ObjetCelluleDate(aOptions){$.extend(this.options,aOptions);if(this.options.fenetre){this.setOptionsFenetre(this.options.fenetre);}
return this;}
setOptionsFenetre(aOptions){Object.assign(this._optionsFenetre,aOptions);}
setParametres_Fenetre(aPremierLundi,aPremiereDate,aDerniereDate,aActifJour,aActifSemaine,aJoursFeries,aAvecAucuneDate,aJoursMarques){this.moteurDate.setOptions({premiereDate:aPremiereDate,derniereDate:aDerniereDate,joursSemaineValide:aActifJour,domaineValide:aActifSemaine,joursFeries:aJoursFeries,joursMarques:aJoursMarques});if(aAvecAucuneDate!==undefined){this._optionsFenetre.avecAucuneDate=aAvecAucuneDate;}}
setPremiereDateSaisissable(aPremiereDateSaisissable,aAfficher){this.moteurDate.setOptions({premiereDateSaisissable:aPremiereDateSaisissable,afficherPremiereDateSaisissable:aAfficher});}
Initialiser(){this.cellule=new ObjetCelluleBouton(this.Nom+'.cellule',null,this,this.surCellule);this.SetPremierElement(this.cellule.NomEdit);this.cellule.setOptions_ObjetCelluleBouton(this.options);this.cellule.setOptions_ObjetCelluleBouton({estSaisissable:false,avecZoneSaisie:false,roleWAIZone:EGenreRole.Button,popupWAI:true,genreBouton:this.options.genreBoutonCellule,hauteur:this.options.hauteurComposant,largeur:this.options.largeurComposant,classTexte:this.options.classeCSSTexte,iconeGauche:this.options.avecBoutonsPrecedentSuivant?'':this.options.iconeGauche});this.Afficher();this.cellule.Initialiser();this.cellule.SetActif(this.Actif);}
SetDonnees(aDate,aAvecEvenement){this.date=aDate;if(!this.date&&this.options.avecInitDateSiVide){this.date=GApplication.getDemo()?GApplication.getDateDemo():GDate.getDateCourante();}
if(this.options.avecControleDateInit&&this.date){this.date=this.moteurDate.getDateSelonValidite(this.date);}
this._actualiserDate();if(aAvecEvenement){this.surFenetreDate(null,this.date);}}
ConstruireAffichage(){const H=[];H.push('<div class="ObjetCelluleDate input-wrapper',(this.options.designMobile?' design-mobile':''),(this.options.selecteurMobile?' selecteur-mobile':''),'" ie-class="getClassesDynamiques" ie-style="getStyle">');if(this.options.avecBoutonsPrecedentSuivant){H.push('<ie-btnicon class="icon_angle_left',(this.options.designMobile?'':' icon btnImageIcon'),'" ie-model="btn(true)" style="flex: none;"></ie-btnicon>');H.push('<div id="',this.cellule.GetNom(),'" style="flex:1 1 auto;" ie-node="getNodeCellulePrecSuiv"',(this.options.placeHolder?' placeholder="'+this.options.placeHolder+'"':''),'></div>');H.push('<ie-btnicon class=" icon_angle_right',(this.options.designMobile?'':' icon btnImageIcon'),'" ie-model="btn(false)" style="flex: none;"></ie-btnicon>');} else{H.push('<div id="',this.cellule.GetNom(),'" style="flex:1 1 auto;"></div>');}
H.push('</div>');return H.join('');}
_actualiserDate(){if(this.cellule){this.cellule.setLibelle(_getChaineDate.call(this));}}
surCellule(aGenreEvent,aEvent){if(!this.Actif){return;}
switch(aGenreEvent){case EEvent.SurClick:{this._ouvrirFenetreDate();break;}
case EEvent.SurKeyUp:{if(aEvent.which===ToucheClavier.RetourChariot||aEvent.which===ToucheClavier.FlecheBas){this._ouvrirFenetreDate();}}}}
_ouvrirFenetreDate(){if(this.fenetreDate){this._fermerFenetreDate();}
if(this.options.avecAucuneDate!==undefined){this._optionsFenetre.avecAucuneDate=this.options.avecAucuneDate;}
this.fenetreDate=ObjetFenetre.creerInstance(ObjetFenetre_Date,{pere:this,evenement:this.surFenetreDate,initialiser:false},this._optionsFenetre);const lSelf=this;this.fenetreDate.ajouterCallbackSurDestruction(function(){lSelf.fenetreDate=null;});this.fenetreDate.setMoteurDate(this.moteurDate);this.fenetreDate.Initialiser();this.fenetreDate.SetDonnees(this.date);this.fenetreDate.positionnerSousId(this.Nom);}
_fermerFenetreDate(){if(this.fenetreDate){this.fenetreDate.Fermer();}}
surFenetreDate(aGenreBouton,aDate){this.date=aDate;this._actualiserDate();this._fermerFenetreDate();if(aDate){ControleSaisieEvenement(function(){this.callback.appel(this.date,aGenreBouton);}.bind(this),!this.ControleNavigation);}}
getDate(){return this.date;}
getBorneDates(){return{dateDebut:this.options.premiereDate,dateFin:this.options.derniereDate};}
SetActif(AActif){super.SetActif(AActif);if(this.cellule){this.cellule.SetActif(AActif);}
this.$refreshSelf();}
getOptionsCelluleDate(){return this.options;}}
function _getDisabledBtnPrecSuiv(aPrecedent){if(!this.date||!this.getActif()){return true;}
return!this.moteurDate.rechercheSuivantValide(this.date,aPrecedent);}
function _eventDateSuivante(aPrecedent){const lDate=this.moteurDate.rechercheSuivantValide(this.date,aPrecedent);if(lDate){this.surFenetreDate(null,lDate);}
this.$refreshSelf();}
function _getPeriodeCourante(){const lCycleCourant=IE.Cycles.cycleDeLaDate(this.date);const lDateDeb=IE.Cycles.dateDebutCycle(lCycleCourant);const lDateFin=IE.Cycles.dateDernierJourOuvreCycle(lCycleCourant);return{dateDebut:lDateDeb,dateFin:lDateFin,estJourUnique:lDateDeb===lDateFin,estMoisUnique:lDateDeb.getMonth()===lDateFin.getMonth()&&lDateDeb.getFullYear()===lDateFin.getFullYear(),estAnneeUnique:lDateDeb.getFullYear()===lDateFin.getFullYear()};}
function _getChaineDate(){if(!this.date){return'&nbsp;';}
if(this.options.avecSelectionSemaine){const lPeriode=_getPeriodeCourante.call(this);const lFormatDateDeb='%J'+(lPeriode.estMoisUnique?'':' %MMM')+(lPeriode.estAnneeUnique?'':' %AA'),lFormatDateFin='%J %MMM'+(lPeriode.estAnneeUnique?'':' %AA');return GTraductions.getValeur('Dates.DuDateDebutAuDateFin',[GDate.FormatDate(lPeriode.dateDebut,lFormatDateDeb),GDate.FormatDate(lPeriode.dateFin,lFormatDateFin)]);} else{return GDate.FormatDate(this.date,this.options.formatDate);}}
module.exports=ObjetCelluleDate;},fn:"objetcelluledate.js"});;
IE.fModule({f:function(exports,require,module,global){const ObjetFiche=require('ObjetFiche.js');const MethodesObjet=require('MethodesObjet.js');const{GDate}=require('ObjetDate.js');const GTraductions=require('ObjetTraduction.js');const ObjetCelluleDate=require('ObjetCelluleDate.js');const Identite=require('ObjetIdentite.js');const EGenreEvenementObjetSaisie=require('Enumere_EvenementObjetSaisie.js');const EGenreEtat=require('Enumere_Etat.js');const EGenreDocumentJoint=require('Enumere_DocumentJoint.js');const EGenreRessource=require('Enumere_Ressource.js');const{TypeDroits}=require('ObjetDroitsPN.js');const GChaine=require('GChaine.js');const ObjetListeElements=require('ObjetListeElements.js');const EGenreBoiteMessage=require('Enumere_BoiteMessage.js');const GHtml=require('GHtml.js');const ObjetIdentite=require('ObjetIdentite.js');const TypeThemeBouton=require('Type_ThemeBouton.js');require('Produit/Css/ObjetFenetre_Edition.css');class ObjetVSFenetre_SaisieAbsence extends ObjetIdentite{constructor(...aParams){super(...aParams);this.largeurMax=500;this.hauteurMax=1250;this.boutons={annuler:0,valider:1};this.listeMotifs=GEtatUtilisateur.listeMotifsAbsences;}
ConstruireInstances(){this.selecDateDebut=Identite.creerInstance(ObjetCelluleDate,{pere:this,evenement:this._surDateDebut});this.selecDateFin=Identite.creerInstance(ObjetCelluleDate,{pere:this,evenement:this._surDateFin});}
_surDateDebut(aDate){const lDateMax=GEtatUtilisateur.Identification.ressource.nbMaxJoursDeclarationAbsence===0?GDate.derniereDate:GDate.GetJourSuivant(GDate.aujourdhui,GEtatUtilisateur.Identification.ressource.nbMaxJoursDeclarationAbsence);const lDateOriginale=this.absenceTraitee.debut.date;if(GDate.estAvantJour(aDate,lDateMax)){this.absenceTraitee.debut.date=aDate;this.absenceTraitee.fin.date=aDate;this.selecDateFin.setPremiereDateSaisissable(aDate,true);this.selecDateFin.SetDonnees(aDate);} else{const lThis=this;const lDateMaxFormatee=GDate.FormatDate(lDateMax,"%JJ/%MM/%AAAA");GApplication.getMessage().afficher({type:EGenreBoiteMessage.Information,message:GTraductions.getValeur('AbsenceVS.DateLimiteDeclaration',[lDateMaxFormatee]),callback:function(){lThis.selecDateDebut.SetDonnees(lDateOriginale);}});}}
_surDateFin(aDate){this.absenceTraitee.fin.date=aDate;}
ComposeContenu(){const H=[];H.push('<div class="ObjetFenetre_Edition_Contenu">');H.push('      <div class="dates-contain">','        <label>',GTraductions.getValeur('AbsenceVS.Du'),'</label>','        <div id="',this.selecDateDebut.GetNom(),'" ie-node="getNodeSelecDate(true)"></div>','        <ie-radio ie-model="radioDuDemiJournee(true)">',GTraductions.getValeur('AbsenceVS.matin'),'</ie-radio>','        <ie-radio ie-model="radioDuDemiJournee(false)">',GTraductions.getValeur('AbsenceVS.apresMidi'),'</ie-radio>','      </div>');H.push('      <div class="dates-contain">','        <label>',GTraductions.getValeur('AbsenceVS.Au'),'</label>','        <div id="',this.selecDateFin.GetNom(),'" ie-node="getNodeSelecDate(false)"></div>','        <ie-radio ie-model="radioAuDemiJournee(true)">',GTraductions.getValeur('AbsenceVS.matin'),'</ie-radio>','        <ie-radio ie-model="radioAuDemiJournee(false)">',GTraductions.getValeur('AbsenceVS.apresMidi'),'</ie-radio>','      </div>');H.push('      <ie-combo class="rounded" ie-model="comboMotif"></ie-combo>');H.push('      <div class="bt-pj-unique" ie-model="telechargerJustificatif" ie-class="getClassPJ" ie-selecfile><span ie-html="getLibellePJ"></span></div>');H.push('      <div class="commentaire"><ie-textareamax ie-model="commentaire" maxlength="200" ie-class="getClassCommentaire" placeholder="',GTraductions.getValeur('AbsenceVS.AjouterUnCommentaire'),'"></ie-textareamax></div>');H.push('</div>');H.push('<div class="zone-bas NePasImprimer">','         <div class="btn-conteneur">','         <ie-bouton ie-model="btnAnnuler" class="',TypeThemeBouton.secondaire,'">',GTraductions.getValeur('Annuler'),'</ie-bouton><ie-bouton ie-model="btnValider" class="ml-large ',TypeThemeBouton.primaire,'">',GTraductions.getValeur('Valider'),'</ie-bouton>','       </div></div>');return H.join('');}
SurValidation(aGenreBouton){if(this.options.avecBascule){this.options.instanceAppelante.afficherEcranSaisie();this.options.instanceAppelante.Initialiser(true);} else{this.Pere.Fermer();}
this.callback.appel(aGenreBouton,this.absenceTraitee);}
getControleur(aInstance){return $.extend(true,super.getControleur(this),{btnAnnuler:{event:function(){if(aInstance.options.retourAccueil){aInstance.options.callbackEnvoyer();} else if(aInstance.options.avecBascule){const lThis=aInstance.options.instanceAppelante;lThis.deselectionnerRecap();lThis.selectionnerRecap(lThis.objDonneesDuRecap);lThis.afficherListeElementsVSDeRecap();} else{aInstance.Pere.Fermer();}}},btnFermer:{event:function(){aInstance.options.callbackEnvoyer();}},btnValider:{event:function(){aInstance.SurValidation(aInstance.boutons.valider);},getDisabled:function(){return!(!!aInstance.absenceTraitee.motifParent);},estVisible:function(){return true;}},radioDuDemiJournee:{getValue:function(aMode){return(aInstance.absenceTraitee.debut.estMatin===aMode);},setValue:function(aVal){aInstance.absenceTraitee.debut.estMatin=aVal;if((aVal===false)&&(GDate.estDateEgale(aInstance.absenceTraitee.debut.date,aInstance.absenceTraitee.fin.date))){aInstance.absenceTraitee.fin.estMatin=false;}}},radioAuDemiJournee:{getValue:function(aMode){return(aInstance.absenceTraitee.fin.estMatin===aMode);},setValue:function(aVal){let lVal=aVal;if((aVal===true)&&(GDate.estDateEgale(aInstance.absenceTraitee.debut.date,aInstance.absenceTraitee.fin.date))&&aInstance.absenceTraitee.debut.estMatin===false){lVal=false;}
aInstance.absenceTraitee.fin.estMatin=lVal;}},commentaire:{getValue:function(){return aInstance.absenceTraitee&&aInstance.absenceTraitee.justification?aInstance.absenceTraitee.justification:'';},setValue:function(aValue){if(aInstance.absenceTraitee.justification!==aValue){aInstance.absenceTraitee.justification=aValue;aInstance.absenceTraitee.SetEtat(EGenreEtat.Modification);}},getDisabled:function(){return!aInstance.absenceTraitee;}},getClassCommentaire:function(){return!aInstance.absenceTraitee.justification?'sansCommentaire':'';},telechargerJustificatif:{getOptionsSelecFile:function(){return{genrePJ:EGenreDocumentJoint.Fichier,genreRessourcePJ:EGenreRessource.DocJointEleve,maxFiles:1,maxSize:GApplication.droits.get(TypeDroits.tailleMaxDocJointEtablissement)};},addFiles:function(aParams){aInstance.documents.AddElement(aParams.eltFichier);aInstance.absenceTraitee.documents.AddElement(aParams.eltFichier);aInstance.absenceTraitee.SetEtat(EGenreEtat.Modification);},getDisabled:function(){return!aInstance.absenceTraitee||(aInstance.absenceTraitee.documents&&aInstance.absenceTraitee.documents.GetNbrElementsExistes());}},getLibellePJ:function(){if(aInstance.absenceTraitee&&aInstance.absenceTraitee.documents&&aInstance.absenceTraitee.documents.GetNbrElementsExistes()){const lDocs=[];for(let i=0;i<aInstance.absenceTraitee.documents.GetNbrElements();i++){const lDocument=aInstance.absenceTraitee.documents.GetElement(i);if(lDocument.Existe()){lDocs.push(GChaine.composerUrlLienExterne({documentJoint:lDocument,genreRessource:EGenreRessource.DocumentJoint,avecLien:aInstance.estEspaceParent,afficherIconeDocument:false,ieChipsMinimal:true}));}}
return lDocs.join(', ');} else{return GTraductions.getValeur('AbsenceVS.TelechargerUnJustifcatif');}},getClassPJ:function(){const lClass=['icon_piece_jointe'];if(aInstance.element&&aInstance.element.documents&&aInstance.element.documents.GetNbrElementsExistes()){lClass.push('sansEdition');}
return lClass.join(' ');},getNodeSelecDate:function(aEstDebut){const lSelecteur=aEstDebut?aInstance.selecDateDebut:aInstance.selecDateFin;lSelecteur.Initialiser();lSelecteur.setParametres_Fenetre(GParametres.PremierLundi,GParametres.PremiereDate,GParametres.DerniereDate,GParametres.JoursOuvres,null,GParametres.JoursFeries,null);const lDateBornee=GDate.getDateBornee(GDate.aujourdhui);const lDate=GDate.estUnJourOuvre(lDateBornee)?lDateBornee:GDate.getProchainJourOuvre(lDateBornee);lSelecteur.setPremiereDateSaisissable(lDate,true);lSelecteur.SetDonnees(lDate);aInstance.absenceTraitee.debut.date=lDate;aInstance.absenceTraitee.fin.date=lDate;},comboMotif:{init:function(aInstance){aInstance.setOptions_ObjetSaisie(Object.assign({longueur:'100%'},_getOptionsCombo.call(aInstance)));},getDonnees:function(aDonnees){if(!aDonnees){return aInstance.listeMotifs;}},getIndiceSelection:function(){const lElement=aInstance.element;if(!lElement||!lElement.motifParent||!lElement.motifParent.existeNumero()){return-1;}
let lIndice=aInstance.listeMotifs.GetIndiceParNumeroEtGenre(lElement.motifParent.GetNumero());if(lIndice<0||!MethodesObjet.isNumber(lIndice)){lIndice= -1;}
return lIndice;},event:function(aParametres){if(aParametres.genreEvenement===EGenreEvenementObjetSaisie.selection&&aParametres.element){aInstance.absenceTraitee.motifParent=aParametres.element;}},getDisabled:function(){return false;}}});}
SetDonnees(aDonnees,aParams){this.absenceTraitee=aDonnees;this.absenceTraitee.documents=new ObjetListeElements();this.ConstruireInstances();this.documents=new ObjetListeElements();if(aParams&&aParams.estConteneur){GHtml.setHtml(aParams.id,this._composeSlide(),{controleur:this.controleur});} else{this.Afficher();}}
_composeSlide(){const H=[];H.push('<div id="',this.Nom+'_conteneur" class="ObjetFenetre_Edition">');const lLibelle=GTraductions.getValeur('AbsenceVS.PrevenirAbsenceParentPrim');if(this.options.estSidePanel){H.push('<div class="navheader no-bg',this.options.estSidePanel?' header-titre':'','">','<ie-btnimage ie-model="btnFermer" class="fleche-nav icon_retour_mobile btnImageIcon"></ie-btnimage>','<span class="as-titre">',lLibelle,'</span>','</div>');}
H.push(this.ComposeContenu());return H.join('');}}
ObjetVSFenetre_SaisieAbsence.ids={};function _getContenuCombo(aLibelle){const T=['<div class="libelle-contain icon_ul" style="font-size:var(--taille-m)">'];if(!!aLibelle){T.push('<span>',aLibelle,'</span>');}
T.push('</div>');return T.join('');}
function _getOptionsCombo(){const lOptions={placeHolder:{libelleHtml:_getContenuCombo(GTraductions.getValeur('AbsenceVS.aPreciser'))},getContenuCellule:function(aElement){return{libelleHtml:_getContenuCombo(aElement.GetLibelle()||'')};}.bind(this),getContenuElement:function(aParams){const T=['<div style="width:100%; text-align: center;">'];if(!!aParams.element){T.push(aParams.element.GetLibelle());}
T.push('</div>');return T.join('');}};if(!IE.estMobile){Object.assign(lOptions,{largeurListe:300});}
return lOptions;}
class ObjetFicheVSSaisieAbsence extends ObjetFiche{constructor(...aParams){super(...aParams);this.largeurMax=500;this.hauteurMax=1250;this.idScroll=this.Nom+'_scroll';this.objetDetailVS=new ObjetVSFenetre_SaisieAbsence(this.Nom+".objetDetailVS",null,this,this.evntDetailVS);this.objetDetailVS.setOptions({avecValidation:false});this.setOptionsFenetre({largeur:350,hauteur:null,avecTailleSelonContenu:true,titre:function(){return'<div>'+this.titreFiche+'</div>';}.bind(this)});}
evntDetailVS(aGenre,aParams){this.callback.appel(aGenre,aParams);this.Fermer();}
setOptions(aOptions){$.extend(this.options,aOptions);}
SetDonnees(aAbsence){this.element=aAbsence;this.setTitreFiche(GTraductions.getValeur('AbsenceVS.PrevenirAbsenceParentPrim'));this.afficherFiche({positionSurSouris:true,positionSurSourisSiAffiche:true});this.objetDetailVS.Initialiser();this.objetDetailVS.SetDonnees(this.element,{id:this.objetDetailVS.GetNom(),estConteneur:true});}
setTitreFiche(aTitre){this.titreFiche=aTitre;}
ComposeContenu(){const H=[];H.push('<div class="ifc_RecapVS theme-cat-viescolaire">');H.push('<div id="',this.objetDetailVS.GetNom(),'" class="ifc_RecapVS_EcranElement_Content VSFiche"></div>');H.push('</div>');return H.join('');}
surPreAffichage(){this.objetDetailVS.Initialiser();}}
module.exports.ObjetFicheVSSaisieAbsence=ObjetFicheVSSaisieAbsence;module.exports.ObjetVSFenetre_SaisieAbsence=ObjetVSFenetre_SaisieAbsence;},fn:"objetvsfenetre_saisieabsence.js"});;
IE.fModule({f:function(exports,require,module,global){const{ObjetRequeteSaisie}=require('ObjetRequeteJSON.js');const Requetes=require('CollectionRequetes.js');class ObjetRequeteSaisieVieScolaire extends ObjetRequeteSaisie{constructor(...aParams){super(...aParams);}
lancerRequete(aListeAbsences){aListeAbsences.setSerialisateurJSON({methodeSerialisation:_serialiserAbsences.bind(this)});this.JSON.listeAbsences=aListeAbsences;return this.appelAsynchrone();}
actionApresRequete(aXml,aGenreReponse){let lAbsence;if(this.JSONRapportSaisie&&this.JSONRapportSaisie.absence){lAbsence=this.JSONRapportSaisie.absence;}
const lObj=!!lAbsence?lAbsence:{genreReponse:aGenreReponse};if(this.JSONRapportSaisie&&this.JSONRapportSaisie.servicesPeriscolairePourAbsence){lObj.servicesPeriscolairePourAbsence=this.JSONRapportSaisie.servicesPeriscolairePourAbsence;}
this.callbackReussite.appel(lObj);}}
Requetes.inscrire('SaisieVieScolaire',ObjetRequeteSaisieVieScolaire);function _serialiserAbsences(aAbsence,aJSON){if(!!aAbsence.documents){aAbsence.documents.setSerialisateurJSON({methodeSerialisation:_surValidation_Fichier.bind(this)});aJSON.documents=aAbsence.documents;}
aJSON.estLue=aAbsence.estLue;aJSON.justification=aAbsence.justification;aJSON.estUneCreationParent=aAbsence.estUneCreationParent;aJSON.debut=aAbsence.debut;aJSON.fin=aAbsence.fin;aJSON.motifParent=aAbsence.motifParent;aJSON.justification=aAbsence.justification;aJSON.parentAAccuseDeReception=aAbsence.parentAAccuseDeReception;}
function _surValidation_Fichier(aElement,aJSON){const lIdFichier=aElement.idFichier!==undefined?aElement.idFichier:(aElement.Fichier!==undefined?aElement.Fichier.idFichier:null);if(lIdFichier!==null){aJSON.idFichier=''+lIdFichier;}
if(!aElement.nomFichier){aJSON.nomFichier=aElement.nomOriginal;} else{aJSON.nomFichier=aElement.nomFichier;}
aJSON.url=aElement.url;}
module.exports=ObjetRequeteSaisieVieScolaire;},fn:"objetrequetesaisieviescolaire.js"});;
IE.fModule({f:function(exports,require,module,global){const MethodesObjet=require('MethodesObjet.js');const MethodesTableau=require('MethodesTableau.js');const GChaine=require('GChaine.js');const GStyle=require('GStyle.js');const{GDate}=require('ObjetDate.js');const GTraductions=require('ObjetTraduction.js');const TUtilitaireDuree=require('UtilitaireDuree.js');const EGenreEspace=require('Enumere_Espace.js');const EGenreRepas=require('Enumere_Repas.js');const EGenreRessource=require('Enumere_Ressource.js');const EGenreSanction=require('Enumere_Sanction.js');const TypeGenreIndividuAuteur=require('TypeGenreIndividuAuteur.js').TypeGenreIndividuAuteur;const TypeGenreObservationVS=require('TypeGenreObservationVS.js').TypeGenreObservationVS;const TypeGenrePunition=require('TypeGenrePunition.js').TypeGenrePunition;const TypePerimetreMesureConservatoire=require('TypePerimetreMesureConservatoire.js').TypePerimetreMesureConservatoire;const TypeThemeBouton=require('Type_ThemeBouton.js');const ObjetListeElements=require('ObjetListeElements.js');const ObjetElement=require('ObjetElement.js');const ObjetFenetre=require('ObjetFenetre.js');const EGenreEtat=require('Enumere_Etat.js');const ObjetVSFicheSaisieAbsence=require('ObjetVSFenetre_SaisieAbsence.js').ObjetFicheVSSaisieAbsence;const ObjetRequeteSaisieVieScolaire=require('ObjetRequeteSaisieVieScolaire.js');const Toast=require('Toast.js').Toast;const ETypeToast=require('Toast.js').ETypeToast;const{EGenreReponseSaisie}=require('ObjetRequeteJSON.js');const ObjetTri=require('ObjetTri.js');const EGenreOnglet=require('Enumere_Onglet.js');const EGenreTriElement=require('Enumere_TriElement.js');require('espace/css/ObjetFichePresenceStyle.css');class ObjetUtilitaireAbsence{constructor(){this.maxLengthCommentaire=200;}
getChaineTraductionGenreAbsenceTitre(aObjet){if(!!aObjet.aucun){switch(aObjet.genre){case EGenreRessource.ObservationProfesseurEleve:switch(aObjet.genreObservation){case TypeGenreObservationVS.OVS_ObservationParent:return GTraductions.getValeur('AbsenceVS.aucuneObservation');case TypeGenreObservationVS.OVS_Encouragement:return GTraductions.getValeur('AbsenceVS.aucunEncouragement');case TypeGenreObservationVS.OVS_DefautCarnet:return GTraductions.getValeur('AbsenceVS.aucunDefautCarnet');case TypeGenreObservationVS.OVS_Autres:return GTraductions.getValeur('AbsenceVS.aucuneAutreObservation');default:;return'';}
case EGenreRessource.Absence:return GTraductions.getValeur('AbsenceVS.aucuneAbsence');case EGenreRessource.AbsenceRepas:return GTraductions.getValeur('AbsenceVS.aucuneAbsenceRepas');case EGenreRessource.AbsenceInternat:return GTraductions.getValeur('AbsenceVS.aucuneAbsenceInternat');case EGenreRessource.Retard:return GTraductions.getValeur('AbsenceVS.aucunRetard');case EGenreRessource.Infirmerie:return GTraductions.getValeur('AbsenceVS.aucunInfirmerie');case EGenreRessource.Incident:return GTraductions.getValeur('AbsenceVS.aucunIncident');case EGenreRessource.Punition:return GTraductions.getValeur('AbsenceVS.aucunePunition');case EGenreRessource.Sanction:return GTraductions.getValeur('AbsenceVS.aucuneSanction');case EGenreRessource.MesureConservatoire:return GTraductions.getValeur('AbsenceVS.aucuneMesure');default:;return'';}} else{switch(aObjet.genre){case EGenreRessource.ObservationProfesseurEleve:if(aObjet.genreObservation!==undefined){switch(aObjet.genreObservation){case TypeGenreObservationVS.OVS_ObservationParent:return aObjet.singulier?GTraductions.getValeur('AbsenceVS.observation'):GTraductions.getValeur('AbsenceVS.observations');case TypeGenreObservationVS.OVS_Encouragement:return aObjet.singulier?GTraductions.getValeur('AbsenceVS.encouragement'):GTraductions.getValeur('AbsenceVS.encouragements');case TypeGenreObservationVS.OVS_DefautCarnet:return aObjet.singulier?GTraductions.getValeur('AbsenceVS.defautDeCarnet'):GTraductions.getValeur('AbsenceVS.defautsDeCarnet');case TypeGenreObservationVS.OVS_Autres:return aObjet.singulier?GTraductions.getValeur('AbsenceVS.autreObservation'):GTraductions.getValeur('AbsenceVS.autresObservations');default:;return aObjet.singulier?GTraductions.getValeur('AbsenceVS.observation'):GTraductions.getValeur('AbsenceVS.observations');}}
if(aObjet.estLue===undefined){return GTraductions.getValeur('AbsenceVS.observation');}
if(aObjet.estLue){return GTraductions.getValeur('AbsenceVS.observationLue');} else{return GTraductions.getValeur('AbsenceVS.observationNonLue');}
case EGenreRessource.Absence:if(aObjet.justifie===undefined){return aObjet.singulier?GTraductions.getValeur('AbsenceVS.absenceEnCours'):GTraductions.getValeur('AbsenceVS.absencesEnCours');} else if(aObjet.justifie){return GTraductions.getValeur('AbsenceVS.absencesRecapJust');} else{return GTraductions.getValeur('AbsenceVS.absencesRecapNonJust');}
case EGenreRessource.AbsenceRepas:return aObjet.singulier?GTraductions.getValeur('AbsenceVS.absenceRepas'):GTraductions.getValeur('AbsenceVS.absencesRepas');case EGenreRessource.AbsenceInternat:return aObjet.singulier?GTraductions.getValeur('AbsenceVS.absenceInternat'):GTraductions.getValeur('AbsenceVS.absencesInternat');case EGenreRessource.Retard:return aObjet.singulier?GTraductions.getValeur('AbsenceVS.retard'):GTraductions.getValeur('AbsenceVS.retards');case EGenreRessource.Infirmerie:return aObjet.singulier?GTraductions.getValeur('AbsenceVS.infirmerie'):GTraductions.getValeur('AbsenceVS.infirmeries');case EGenreRessource.Exclusion:return aObjet.singulier?GTraductions.getValeur('AbsenceVS.exclusion'):GTraductions.getValeur('AbsenceVS.exclusions');case EGenreRessource.Punition:if(aObjet.estLIncident){return GTraductions.getValeur('AbsenceVS.incidentPunition');}
if(aObjet.genreNature===undefined){return aObjet.singulier?GTraductions.getValeur('AbsenceVS.punition'):GTraductions.getValeur('AbsenceVS.punitions');}
switch(aObjet.genreNature){case TypeGenrePunition.GP_ExclusionCours:return GTraductions.getValeur('AbsenceVS.exclusion');case TypeGenrePunition.GP_Retenues:return GTraductions.getValeur('AbsenceVS.retenue');case TypeGenrePunition.GP_Devoir:return GTraductions.getValeur('AbsenceVS.devoirSuppl');case TypeGenrePunition.GP_Autre:return GTraductions.getValeur('AbsenceVS.punitionAutre');default:;return'';}
case EGenreRessource.MesureConservatoire:return aObjet.singulier?GTraductions.getValeur('AbsenceVS.mesureConservatoire'):GTraductions.getValeur('AbsenceVS.mesuresConservatoires');case EGenreRessource.Sanction:if(!aObjet.libelle&&!aObjet.genreNature){return aObjet.singulier?GTraductions.getValeur('AbsenceVS.sanction'):GTraductions.getValeur('AbsenceVS.sanctions');}
return aObjet.singulier?GTraductions.getValeur('AbsenceVS.sanction'):GTraductions.getValeur('AbsenceVS.sanctions');case EGenreRessource.Incident:if(!aObjet.genreNature){return aObjet.singulier?GTraductions.getValeur('AbsenceVS.incident'):GTraductions.getValeur('AbsenceVS.incidents');}
switch(aObjet.genreNature){case EGenreRessource.Punition:return GTraductions.getValeur('AbsenceVS.LieAPunition');case EGenreRessource.Sanction:return GTraductions.getValeur('AbsenceVS.LieASanction');case EGenreRessource.MesureConservatoire:return GTraductions.getValeur('AbsenceVS.LieAMesureConservatoire');case EGenreRessource.Aucune:return GTraductions.getValeur('AbsenceVS.SansMesureDiciplinaire');default:;return'';}
default:;return'';}}}
getCheckBoxVS(aParams){const H=[];const lID=aParams.id?' id="'+aParams.id+'"':'';const lIEmodel=aParams.ieModel?' '+aParams.ieModel:'';if(aParams.sansLabel){H.push('<ie-checkbox class="theme-viescolaire colored-label"',lID,lIEmodel,'></ie-checkbox>');} else{const lLibelle=aParams.label||GTraductions.getValeur('AbsenceVS.JeSuisInformee');H.push('<ie-checkbox class="theme-viescolaire colored-label" ie-textleft',lID,lIEmodel,'>',lLibelle,'</ie-checkbox>');}
return H.join('');}
getSaisieObservation(aObservation,aCallBack,aID,aSansLabel){const H=[];let lLibelle=GTraductions.getValeur('AbsenceVS.JeSuisInformee');switch(aObservation.genreObservation){case TypeGenreObservationVS.OVS_DefautCarnet:lLibelle=GTraductions.getValeur('AbsenceVS.titres.prisConnaissance');break;case TypeGenreObservationVS.OVS_Autres:if(aObservation.avecARObservation){lLibelle=GTraductions.getValeur('AbsenceVS.titres.prisConnaissance');} else{lLibelle='';}
break;case TypeGenreObservationVS.OVS_ObservationParent:lLibelle=GTraductions.getValeur('AbsenceVS.prisConnaissanceObservation');break;case TypeGenreObservationVS.OVS_Encouragement:lLibelle=GTraductions.getValeur('AbsenceVS.prisConnaissanceEncouragement');break;default:lLibelle='';}
if(aSansLabel){H.push('<ie-checkbox id="',aID,'" onclick="',aCallBack,'" ',(aObservation.estLue?'checked disabled ':''),'></ie-checkbox>');} else{H.push('<div class="EspaceGauche">','<ie-checkbox id="',aID,'" onclick="',aCallBack,'" ',(aObservation.estLue?'checked disabled ':''),'>',lLibelle,'</ie-checkbox>','</div>');}
return H.join('');}
getARdePunition(aAbsence,aCallBack,aID){const H=[];H.push('<div class="EspaceGauche">','<ie-checkbox id="',aID,'" onclick="',aCallBack,'" ',(aAbsence.parentAAccuseDeReception?'checked disabled ':''),'/>',GTraductions.getValeur('AbsenceVS.accuseDeReception'),'</ie-checkbox>','</div>');return H.join('');}
getInfoAbsenceAccessible(aAbsence){const H=[];switch(aAbsence.Genre){case EGenreRessource.ObservationProfesseurEleve:H.push(this.getMatiere(aAbsence,false,true));H.push(this.getCommentaire(aAbsence,false,false));break;case EGenreRessource.Absence:H.push(this.getHeuresCoursManquees(aAbsence));break;case EGenreRessource.AbsenceRepas:break;case EGenreRessource.AbsenceInternat:break;case EGenreRessource.Retard:break;case EGenreRessource.Infirmerie:H.push(this.getSymptomesMedicaux(aAbsence,true,false));H.push(this.getActesMedicaux(aAbsence,true,false));break;case EGenreRessource.Exclusion:case EGenreRessource.Punition:case EGenreRessource.Sanction:case EGenreRessource.Incident:case EGenreRessource.MesureConservatoire:{for(let I=0;I<aAbsence.listeMotifs.GetNbrElements();I++){H.push('<span>',aAbsence.listeMotifs.GetLibelle(I),'</span><br>');}
if(aAbsence.circonstances){H.push('<span>',aAbsence.circonstances,'</span><br>');}
if(aAbsence.travailAFaire){H.push('<span>',GTraductions.getValeur('AbsenceVS.travailAFaire'),' : ',aAbsence.travailAFaire,'</span><br>');}
const lIndividu=this.getDemandeurDecideur(aAbsence);if(lIndividu){H.push('<span>',lIndividu,'</span><br>');}
break;}
default:break;}
return H.join('');}
getInfosMotifAbsenceVS(aObjet){const lMotif={label:'',labelParent:GTraductions.getValeur('AbsenceVS.Raison')+' : ',texte:'',texteParent:'',message:'',existe:function(){return!!this.texte;}};if(aObjet.donnee.avecSaisie&&aObjet.pourSaisieParent&&this.estEspaceParent()){if(!!aObjet.donnee.motifParent&&(aObjet.donnee.motifParent.existeNumero())){lMotif.label=lMotif.labelParent;lMotif.texte=aObjet.donnee.motifParent.GetLibelle();}} else{lMotif.label=GTraductions.getValeur('AbsenceVS.titres.motif')+' : ';}
if(aObjet.donnee.message&&this.estEspaceParent()){lMotif.message=aObjet.donnee.message;}
if(aObjet.donnee.reglee||(aObjet.donnee.listeMotifs&&aObjet.donnee.listeMotifs.GetNbrElements()>0)){if(this.estEspaceParent()&&!!aObjet.donnee.motifParent&&(aObjet.donnee.motifParent.existeNumero())){lMotif.texteParent=aObjet.donnee.motifParent.GetLibelle();}
lMotif.texte=aObjet.donnee.listeMotifs.getTableauLibelles().join(', ');if(aObjet.donnee.reglee&&aObjet.donnee.listeMotifs.GetNbrElements()===0){lMotif.texte=GTraductions.getValeur('AbsenceVS.sansMotif').ucfirst();}
if((aObjet.donnee.GetGenre()===EGenreRessource.Absence||aObjet.donnee.GetGenre()===EGenreRessource.Retard)&&!aObjet.donnee.justifie){if(lMotif.texte){lMotif.texte+=' ('+GTraductions.getValeur('AbsenceVS.sansRaisonValable')+')';} else{lMotif.texte=GTraductions.getValeur('AbsenceVS.sansRaisonValable').ucfirst();}}}
return lMotif;}
getMotifAbsence(aObjet){let lTitle='';let lResult='';let lMotif='';if(aObjet.donnee.reglee||(aObjet.donnee.listeMotifs&&aObjet.donnee.listeMotifs.GetNbrElements()>0)){if(this.estEspaceParent()&&aObjet.donnee.message&&aObjet.enListe){lTitle='ie-hint="'+(aObjet.donnee.message.replace?aObjet.donnee.message.replace(/\n/g,'<br />'):aObjet.donnee.message)+'"';}
lMotif=aObjet.donnee.listeMotifs.getTableauLibelles().join(', ');if(aObjet.donnee.reglee&&aObjet.donnee.listeMotifs.GetNbrElements()===0){lMotif=GTraductions.getValeur('AbsenceVS.sansMotif').ucfirst();}
if((aObjet.donnee.GetGenre()===EGenreRessource.Absence||aObjet.donnee.GetGenre()===EGenreRessource.Retard)&&!aObjet.donnee.justifie){if(lMotif){lMotif+=' ('+GTraductions.getValeur('AbsenceVS.sansRaisonValable')+')';} else{lMotif=GTraductions.getValeur('AbsenceVS.sansRaisonValable').ucfirst();}}
lResult=!aObjet.enListe||(aObjet.editable===false)?lMotif:'<div class="PetitEspace'+(lTitle&&aObjet.classe?' '+aObjet.classe:'')+'" '+lTitle+'>'+lMotif+'</div>';if(!aObjet.enListe&&aObjet.donnee.message&&this.estEspaceParent()){lResult+='<div class="Texte10 Italique EspaceHaut">'+aObjet.donnee.message+'</div>';}
return lResult;}
if(!this.estEspaceParent()||!MethodesTableau.existe(aObjet.donnee.GetGenre(),[EGenreRessource.Absence,EGenreRessource.Retard])){return'';}
return lResult;}
getCommentaireMotifAbsence(aObjet){if(!this.estEspaceParent()||!MethodesTableau.existe(aObjet.donnee.GetGenre(),[EGenreRessource.Absence,EGenreRessource.Retard])){return'';}
let lResult='';if(aObjet.donnee.reglee||aObjet.donnee.listeMotifs.GetNbrElements()>0){if(!aObjet.enListe||aObjet.donnee.message){return'';}
lResult='<div class="PetitEspace">'+aObjet.donnee.justification+'</div>';return lResult;}
let lValue='';if(!aObjet.enListe){lResult+='<div class="Texte10">'+GTraductions.getValeur('AbsenceVS.saisissezCommentaire',[this.maxLengthCommentaire]).ucfirst()+'&nbsp;:</div>';}
const lStyle=!aObjet.enListe?GStyle.composeHeight(90):'padding:3px;';if(aObjet.donnee.justification){lValue=aObjet.donnee.justification;}
if(!aObjet.enListe){lResult+='<div><textarea class="Texte10" maxlength="'+this.maxLengthCommentaire+'" id="'+aObjet.id+'" style="line-height:14px; '+GStyle.composeWidth(aObjet.width?aObjet.width:100,aObjet.width?'px':'%')+GStyle.composeCouleurBordure(GCouleur.bordure,1)+lStyle+'" onfocus="$(this).one(\'mouseup\',function(){$(this).select();return false;}).select();" onkeyup="'+aObjet.callback+'" onchange="'+aObjet.callback+'">'+lValue+'</textarea></div>';} else if(aObjet.editable!==false){lResult+='<div><input class="Texte10" maxlength="'+this.maxLengthCommentaire+'" type="text" id="'+aObjet.id+'" style="line-height:14px; '+GStyle.composeWidth(aObjet.width?aObjet.width:100,aObjet.width?'px':'%')+GStyle.composeCouleurBordure(GCouleur.bordure,1)+lStyle+'" onfocus="$(this).one(\'mouseup\',function(){$(this).select();return false;}).select();" onkeyup="'+aObjet.callback+'" onchange="'+aObjet.callback+'" value="'+lValue+'" /></div>';}
if(aObjet.donnee.message&&this.estEspaceParent()&&!aObjet.enListe&&!aObjet.donnee.reglee&&aObjet.donnee.listeMotifs.GetNbrElements()===0){lResult+='<div class="Texte10 Italique EspaceHaut">'+aObjet.donnee.message+'</div>';}
return lResult;}
getHeuresCoursManquees(aElement,aSansSpan){if(!aElement.NbrHeures||aElement.NbrHeures==='0h00'){return'';}
let lTrad='';if(parseInt(aElement.NbrHeures.charAt(0))<2){lTrad=GTraductions.getValeur('AbsenceVS.heureCoursManque',[aElement.NbrHeures]);} else{lTrad=GTraductions.getValeur('AbsenceVS.heuresCoursManquees',[aElement.NbrHeures]);}
if(aSansSpan){return lTrad;}
return'<span>'+lTrad+'</span><br>';}
getHeuresCoursManqueesBulletin(aElement){if(!aElement.nbrHeures||aElement.nbrHeures==='0h00'){return'';}
let lTrad='';const lArray=aElement.nbrHeures.split('h');if(parseInt(lArray[0])<2){lTrad=GTraductions.getValeur('AbsenceVS.heureCoursManque',[aElement.nbrHeures]);} else{lTrad=GTraductions.getValeur('AbsenceVS.heuresCoursManquees',[aElement.nbrHeures]);}
return lTrad;}
getXAbsencesNonJustifiees(aNombreAbsencesNonJustifiees){if($.isNumeric(aNombreAbsencesNonJustifiees)&&aNombreAbsencesNonJustifiees>0){return GTraductions.getValeur('AbsenceVS.absenceNonjustifiees',[aNombreAbsencesNonJustifiees]);}
return'';}
getDontXObservationsNonLu(aNombreNonLu){if($.isNumeric(aNombreNonLu)&&aNombreNonLu>0){return GTraductions.getValeur('AbsenceVS.obs_Encouragements_NonLus',[aNombreNonLu]);}
return'';}
getDontXRetardNonJustifies(aNombreRetardsNonJustifies){if($.isNumeric(aNombreRetardsNonJustifies)&&aNombreRetardsNonJustifies>0){return GTraductions.getValeur('AbsenceVS.retardNonjustifies',[aNombreRetardsNonJustifies]);}
return'';}
getDontXNonJustifiees(aNombreAbsencesNonJustifiees){if($.isNumeric(aNombreAbsencesNonJustifiees)&&aNombreAbsencesNonJustifiees>0){if(aNombreAbsencesNonJustifiees===1){return GTraductions.getValeur('AbsenceVS.Dont1AbsenceNonJustifiee',[aNombreAbsencesNonJustifiees]);} else{return GTraductions.getValeur('AbsenceVS.DontXAbsenceNonJustifiee',[aNombreAbsencesNonJustifiees]);}}
return'';}
getDemiJourneesBulletin(aElement){if(!$.isNumeric(aElement.nombreDemiJournees)||aElement.nombreDemiJournees<=0){return'';}
let lResult='';const lCleTraduction=aElement.nombreDemiJournees>1?'AbsenceVS.demiJournees':'AbsenceVS.demiJournee';lResult=GTraductions.getValeur(lCleTraduction,[aElement.nombreDemiJournees]);if($.isNumeric(aElement.nombreDemiJourneesNonJustifies)&&aElement.nombreDemiJourneesNonJustifies>0){lResult+=' ('+this.getDontXNonJustifiees(aElement.nombreDemiJourneesNonJustifies)+')';}
return lResult;}
getDemiJourneesNonJustifiesBulletin(aElement){if(!$.isNumeric(aElement.nombreDemiJourneesNonJustifies)||aElement.nombreDemiJourneesNonJustifies<=0){return'';}
const lCleTraduction=aElement.nombreDemiJournees>1?'AbsenceVS.demiJourneesNJ':'AbsenceVS.demiJourneeNJ';return GTraductions.getValeur(lCleTraduction,[aElement.nombreDemiJournees]);}
getDemiJournees(aElement,aSansSpan){if(!$.isNumeric(aElement.NbrJours)||aElement.NbrJours<=0){return'';}
const lCleTraduction=aElement.NbrJours>1?'AbsenceVS.demiJournees':'AbsenceVS.demiJournee';if(aSansSpan){return GTraductions.getValeur(lCleTraduction,[aElement.NbrJours]);}
return'<span>'+GTraductions.getValeur(lCleTraduction,[aElement.NbrJours])+'</span><br>';}
getSymptomesMedicauxVS(aElement){const lResult={label:GTraductions.getValeur('AbsenceVS.titres.symptMedicaux'),texte:'',tohtml:function(){if(this.texte){return'<div><span class="labelVS">'+this.label.ucfirst()+' : </span><span class="colorVS">'+this.texte+'</span></div>';} else{return'';}},toAria:function(){if(this.texte){return this.label+' : '+this.texte+'.';} else{return'';}}};if(!!aElement.symptomesMedicaux){lResult.texte=aElement.symptomesMedicaux.getTableauLibelles().join(', ');}
return lResult;}
getActesMedicauxVS(aElement){const lResult={label:GTraductions.getValeur('AbsenceVS.titres.actesMedicaux'),texte:'',tohtml:function(){if(this.texte){return'<div><span class="labelVS">'+this.label.ucfirst()+' : </span><span class="colorTexte">'+this.texte+'</span></div>';} else{return'';}},toAria:function(){if(this.texte){return this.label+' : '+this.texte+'.';} else{return'';}}};if(!!aElement.actesMedicaux){lResult.texte=aElement.actesMedicaux.getTableauLibelles().join(', ');}
return lResult;}
getSymptomesMedicaux(aElement,aAvecLibelle,aSansSpan){if(!aElement.symptomesMedicaux){return'';}
const lResult=(aAvecLibelle?GTraductions.getValeur('AbsenceVS.titres.symptMedicaux').ucfirst()+' : ':'')+aElement.symptomesMedicaux.getTableauLibelles().join(', ');if(aSansSpan){return lResult;}
return'<span>'+lResult+'</span><br>';}
getActesMedicaux(aElement,aAvecLibelle,aSansSpan){if(!aElement.symptomesMedicaux){return'';}
const lResult=(aAvecLibelle?GTraductions.getValeur('AbsenceVS.titres.actesMedicaux').ucfirst()+' : ':'')+aElement.actesMedicaux.getTableauLibelles().join(', ');if(aSansSpan){return lResult;}
return'<span>'+lResult+'</span><br>';}
getMatiere(aElement,aSansSpan,aSansDate){if(!aElement.matiere||!aElement.matiere.existeNumero()){return'';}
let lResult=aElement.matiere.GetLibelle();if(aElement.dateDebut&&(aElement.dateDebut.getHours()!==0)&&!aSansDate){lResult+=' '+GTraductions.getValeur('Dates.AHeure',[GDate.FormatDate(aElement.dateDebut,'%xh%sh%mm')])+' ';}
if(aSansSpan){return lResult;}
return'<span>'+lResult+'</span><br>';}
getCommentaire(aElement,aAvecLibelle,aSansSpan){if(!aElement.commentaire){return'';}
const lResult=(aAvecLibelle?GTraductions.getValeur('AbsenceVS.titres.observation').ucfirst()+' : ':'')+aElement.commentaire;if(aSansSpan){return lResult;}
return'<span>'+lResult+'</span><br>';}
getCirconstances(aElement){let lCirconstance='';if(!!aElement.circonstances){lCirconstance=aElement.circonstances;}
const lCirconstanceDoc=[];if(!!aElement.documentsCirconstances){aElement.documentsCirconstances.parcourir(function(D){lCirconstanceDoc.push('<span class="vsDoc">'+GChaine.composerUrlLienExterne({documentJoint:D,genreRessource:EGenreRessource.DocJointEleve})+'</span>');});}
return lCirconstance+(!!lCirconstance&&!!lCirconstanceDoc.length?'<div class="vsDoc">':'')+lCirconstanceDoc.join(', ')+(!!lCirconstance&&!!lCirconstanceDoc.length?'</div>':'');}
eventApresFiche(aElementOrig,aParams){if(!!aParams&&aParams.element){aElementOrig.motifParent=aParams.element.motifParent;if(aElementOrig.motifParent){aElementOrig.motifParent.SetEtat(EGenreEtat.Modification);}
aElementOrig.documents=aParams.element.documents;aElementOrig.justification=aParams.element.justification;aElementOrig.SetEtat(aParams.element.Etat);const lRequete=new ObjetRequeteSaisieVieScolaire(this);if(aParams.documents&&aParams.documents.GetNbrElements()>0){lRequete.addUpload({listeFichiers:aParams.documents});}
lRequete.lancerRequete(this.donnees.listeAbsences).then(function(aAbsence){if(this.fiche){this.fiche.Fermer(false);}
if(aElementOrig.Etat!==EGenreEtat.Suppression){this.majAbsenceApresSaisie(aElementOrig,aAbsence);}
if(this.optionsEcrans&&this.optionsEcrans.avecBascule){this.revenirSurEcranPrecedent();}
if(!!this.objDonneesDuRecap){this.GetInstance(this.identListeDetails).SetDonnees(this.objDonneesDuRecap);}
Toast.afficher({msg:aElementOrig.Etat===EGenreEtat.Suppression?GTraductions.getValeur('AbsenceVS.message.supression'):GTraductions.getValeur('AbsenceVS.message.justification'),type:ETypeToast.succes,dureeAffichage:4500});if(IE.estMobile){const lOngletRetour=(GEtatUtilisateur.SaisieAbsence&&GEtatUtilisateur.SaisieAbsence.ongletProvenance)?GEtatUtilisateur.SaisieAbsence.ongletProvenance:EGenreOnglet.VieScolaire_Recapitulatif;GEtatUtilisateur.SaisieAbsence={};GInterface.evenementSurOnglet(lOngletRetour);} else{GInterface.retourSurNavigation({ignorerHistorique:true,onglet:GEtatUtilisateur.getGenreOnglet()});}}.bind(this));}}
_majAbsenceApresSaisie(aAbsenceOrig,aAbsenceSaisie){aAbsenceOrig.SetEtat(EGenreEtat.Aucun);if(aAbsenceOrig.motifParent){aAbsenceOrig.motifParent.SetEtat(EGenreEtat.Aucun);}
const lClassName=MethodesObjet.getObjectClass(aAbsenceSaisie);if(aAbsenceSaisie&&lClassName&&(lClassName==='ObjetElement')&&aAbsenceSaisie.GetNumero()===aAbsenceOrig.GetNumero()){if(aAbsenceSaisie.message){aAbsenceOrig.message=aAbsenceSaisie.message;if(aAbsenceOrig.infosMotif){aAbsenceOrig.infosMotif.message=aAbsenceOrig.message;}}
if(aAbsenceSaisie.documents){aAbsenceOrig.documents=aAbsenceSaisie.documents;}}}
getDonneesAAfficher(aObjet){const lResult={recapitulatif:aObjet.recapitulatif,donnees:new ObjetListeElements(),genre:aObjet.recapitulatif.GetGenre(),genreObservation:aObjet.recapitulatif.genreObservation||undefined,utilitaireAbsence:this.utilitaireAbsence,autorisations:this.donnees.autorisations};lResult.donnees=this.donnees.listeAbsences.getListeElements(function(aElement){const lTestGenre=aElement.GetGenre()===aObjet.recapitulatif.GetGenre();const lTestGenreObservation=(aElement.GetGenre()!==EGenreRessource.ObservationProfesseurEleve)||(aElement.genreObservation===aObjet.recapitulatif.genreObservation);const lTestProg=(aElement.GetGenre()!==EGenreRessource.Punition)||aElement.estProgrammation!==true;return lTestGenre&&lTestGenreObservation&&lTestProg;});const lTris=[];if((aObjet.recapitulatif.GetGenre()===EGenreRessource.ObservationProfesseurEleve)&&(aObjet.recapitulatif.genreObservation===TypeGenreObservationVS.OVS_Autres)){lTris.push(ObjetTri.init('Libelle'));}
if(aObjet.recapitulatif.GetGenre()===EGenreRessource.Punition){lTris.push(ObjetTri.init('dateDemande',EGenreTriElement.Decroissant));} else{lTris.push(ObjetTri.init('dateDebut',EGenreTriElement.Decroissant));}
lTris.push(ObjetTri.init('Genre'));if(aObjet.recapitulatif.GetGenre()===EGenreRessource.AbsenceRepas){lTris.push(ObjetTri.init('genreRepas'));}
lResult.donnees.setTri(lTris);lResult.donnees.trier();return lResult;}
remplirContentHtml(aObjet){aObjet.element.infosDate=this.getInfosDate({element:aObjet.element,sansChaineAujourdhui:true});switch(aObjet.genre){case EGenreRessource.ObservationProfesseurEleve:_remplirInfosObservations.call(this,aObjet.element,aObjet.genreObservation,aObjet.node,aObjet.model);break;case EGenreRessource.Absence:_remplirInfosAbsences.call(this,aObjet.element,{avecDetailEdition:true,pourParent:aObjet.pourParent,avecBascule:aObjet.avecBascule,avecSaisie:aObjet.avecSaisie,node:aObjet.node,nodeEdition:aObjet.nodeEdition,ieHintPJ:aObjet.ieHintPJ,ieHintCommentaire:aObjet.ieHintCommentaire});break;case EGenreRessource.AbsenceRepas:_remplirInfosAbsences.call(this,aObjet.element,{});break;case EGenreRessource.AbsenceInternat:_remplirInfosAbsences.call(this,aObjet.element,{});break;case EGenreRessource.Infirmerie:_remplirInfosInfirmerie.call(this,aObjet.element);break;case EGenreRessource.Retard:_remplirInfosAbsences.call(this,aObjet.element,{avecDetailEdition:true,pourParent:aObjet.pourParent,avecBascule:aObjet.avecBascule,avecSaisie:aObjet.avecSaisie,node:aObjet.node,nodeEdition:aObjet.nodeEdition,ieHintPJ:aObjet.ieHintPJ,ieHintCommentaire:aObjet.ieHintCommentaire});break;case EGenreRessource.Incident:_remplirInfosIncident.call(this,aObjet.element,aObjet.model);break;case EGenreRessource.Punition:_remplirInfosPunition.call(this,aObjet.element,aObjet.model);break;case EGenreRessource.Sanction:_remplirInfosSanction.call(this,aObjet.element);break;case EGenreRessource.MesureConservatoire:_remplirInfosMesuresConservatoire.call(this,aObjet.element);break;default:;break;}}
getDemandeurDecideur(aElement,aAvecTitre,aAvecDate){let lResult='';if(aElement.GetGenre()===EGenreRessource.ObservationProfesseurEleve){if(aAvecTitre){lResult=GTraductions.getValeur('AbsenceVS.titres.saisiepar')+' ';}
return'<div class="AlignementHaut InlineBlock">'+lResult+aElement.demandeur.GetLibelle()+'&nbsp;</div>';}
let lCleTraduction='AbsenceVS.decidePar';let lDate='';if(aAvecDate){lCleTraduction='AbsenceVS.decideLePar';lDate=GDate.FormatDate(aElement.dateDebut,'%J %MMM');}
let lIndividu=null;if(aElement.GetGenre()===EGenreRessource.Punition){if(aAvecDate){lCleTraduction='AbsenceVS.demandeeLePar';lDate=GDate.FormatDate(aElement.dateDemande,'%J %MMM');} else{lCleTraduction='AbsenceVS.demandePar';}
lIndividu=aElement.demandeur;} else if(aElement.GetGenre()===EGenreRessource.Incident){lIndividu=aElement.rapporteur;} else{lIndividu=aElement.decideur;}
if(!lIndividu||!lIndividu.existeNumero()){return lResult;}
lResult+=lIndividu.GetLibelle();if(lIndividu.GetGenre()!==TypeGenreIndividuAuteur.GIA_Personnel){lResult+=' ('+GTraductions.getValeur('AbsenceVS.titres.professeur').ucfirst()+')';}
if(aAvecTitre&&lResult){if(aAvecDate){lResult=GTraductions.getValeur(lCleTraduction,[lDate,lResult]);} else{lResult=GTraductions.getValeur(lCleTraduction,[lResult]);}}
return lResult;}
getDate(aElement,aAvecChaineAujourdhui,aSansDate){const lEstJourEgal=!(aElement.dateDebut&&aElement.dateFin)||GDate.estJourEgal(aElement.dateDebut,aElement.dateFin);const lSansDate=(aSansDate===true)&&lEstJourEgal;let lDateDebut=!!aElement.dateDebut?GDate.FormatDate(aElement.dateDebut,lEstJourEgal?aAvecChaineAujourdhui?'['+GTraductions.getValeur('Dates.LeDate',['%J %MMM'])+']':GTraductions.getValeur('Dates.LeDate',['%J %MMM']):(aElement.ouverte?GTraductions.getValeur('Dates.LeDate',['%J %MMM']):GTraductions.getValeur('Dates.DuDate',['%J %MMM']))):'';const lDateFin=!!aElement.dateFin?GDate.FormatDate(aElement.dateFin,'%J %MMM'):'';let lHeureDebut=!!aElement.dateDebut?GDate.FormatDate(aElement.dateDebut,'%xh%sh%mm'):'';const lHeureFin=!!aElement.dateFin?GDate.FormatDate(aElement.dateFin,'%xh%sh%mm'):'';let lPlace=aElement.place;if(aElement.GetGenre()===EGenreRessource.MesureConservatoire){const lHeureDebutMesureConservatoire=GDate.PlaceParJourEnDate(aElement.placeDebutMesureConservatoire);lHeureDebut=GDate.FormatDate(lHeureDebutMesureConservatoire,'%xh%sh%mm');}
switch(aElement.GetGenre()){case EGenreRessource.AbsenceRepas:return lDateDebut+' '+(aElement.genreRepas===EGenreRepas.Midi?GTraductions.getValeur('AbsenceVS.amidi'):GTraductions.getValeur('AbsenceVS.ausoir'));case EGenreRessource.ObservationProfesseurEleve:if(aElement.dateDebut.getHours()===0){return lDateDebut;} else{return GTraductions.getValeur('Dates.DateDebutAHeureDebut',[lDateDebut,lHeureDebut]);}
case EGenreRessource.Infirmerie:case EGenreRessource.Absence:if(aElement.ouverte){return GTraductions.getValeur('Dates.DepuisDateAHeure',[lDateDebut,lHeureDebut]);}
if(lEstJourEgal){return(lSansDate?'':lDateDebut+' ')+GTraductions.getValeur('Dates.DeHeureDebutAHeureFin',[lHeureDebut,lHeureFin]);}
return GTraductions.getValeur('Dates.DateDebutAHeureDebutAuDateFinAHeureFin',[lDateDebut,lHeureDebut,lDateFin,lHeureFin]);case EGenreRessource.Incident:case EGenreRessource.Retard:if(lSansDate){return GTraductions.getValeur('Dates.AHeure',[lHeureDebut]);} else{return GTraductions.getValeur('Dates.DateDebutAHeureDebut',[lDateDebut,lHeureDebut]);}
case EGenreRessource.Punition:{let lResult='';lPlace=aElement.placeDemande;if(aElement.horsCours){lPlace=null;}
let lFormatDate=GTraductions.getValeur('Dates.LeDate',['%J %MMM']);if(aAvecChaineAujourdhui!==false){lFormatDate='['+lFormatDate+']';}
lDateDebut=GDate.FormatDate(aElement.dateDemande,lFormatDate);if((lPlace!==null&&lPlace!==undefined)){const lDate=GDate.PlaceAnnuelleEnDate(lPlace);if(lDate&&GDate.estDateValide(lDate)&&GDate.estJourEgal(lDate,aElement.dateDemande)){lResult=GTraductions.getValeur('Dates.DateDebutAHeureDebut',[lDateDebut,GDate.FormatDate(lDate,'%xh%sh%mm')])+' ';} else{lResult=lDateDebut;}} else{lResult=lDateDebut;}
return lResult;}
case EGenreRessource.AbsenceInternat:case EGenreRessource.Sanction:if(lEstJourEgal){return lDateDebut;}
return GTraductions.getValeur('Dates.DateDebutAuDateFin',[lDateDebut,lDateFin]);case EGenreRessource.MesureConservatoire:if(lEstJourEgal){return lDateDebut;}
return GTraductions.getValeur('Dates.DateDebutAHeureDebutAuDateFin',[lDateDebut,lHeureDebut,lDateFin]);default:return'';}}
getInfosDate(aParams){const lResult={date:'',heure:'',dateDebut:'',dateFin:'',heureDebut:'',heureFin:'',estJourEgal:!(aParams.element.dateDebut&&aParams.element.dateFin)||GDate.estJourEgal(aParams.element.dateDebut,aParams.element.dateFin),strDate:function(){return this.date.ucfirst();}};let lFormatDateDebut='[%JJJ %J %MMM]';if(aParams.sansChaineAujourdhui){lFormatDateDebut='%JJJ %J %MMM';}
if(aParams.avecTraduction){lFormatDateDebut=lResult.estJourEgal?!aParams.sansChaineAujourdhui?'['+GTraductions.getValeur('Dates.LeDate',['%J %MMM'])+']':GTraductions.getValeur('Dates.LeDate',['%J %MMM']):(aParams.element.ouverte?GTraductions.getValeur('Dates.LeDate',['%J %MMM']):GTraductions.getValeur('Dates.DuDate',['%J %MMM']));}
lResult.dateDebut=!!aParams.element.dateDebut?GDate.FormatDate(aParams.element.dateDebut,lFormatDateDebut):'';lResult.dateFin=!!aParams.element.dateFin?GDate.FormatDate(aParams.element.dateFin,'%J %MMM'):'';lResult.heureDebut=!!aParams.element.dateDebut?GDate.FormatDate(aParams.element.dateDebut,'%xh%sh%mm'):'';lResult.heureFin=!!aParams.element.dateFin?GDate.FormatDate(aParams.element.dateFin,'%xh%sh%mm'):'';let lPlace=aParams.element.place;if(aParams.element.GetGenre()===EGenreRessource.MesureConservatoire){const lHeureDebutMesureConservatoire=GDate.PlaceParJourEnDate(aParams.element.placeDebutMesureConservatoire);lResult.heureDebut=GDate.FormatDate(lHeureDebutMesureConservatoire,'%xh%sh%mm');}
switch(aParams.element.GetGenre()){case EGenreRessource.AbsenceRepas:lResult.heure=aParams.element.genreRepas===EGenreRepas.Midi?GTraductions.getValeur('AbsenceVS.amidi'):GTraductions.getValeur('AbsenceVS.ausoir');lResult.date=lResult.dateDebut+' '+lResult.heure;break;case EGenreRessource.ObservationProfesseurEleve:if(aParams.element.dateDebut.getHours()===0){lResult.date=lResult.dateDebut;} else{lResult.heure=GTraductions.getValeur('Dates.AHeure',[lResult.heureDebut]);lResult.date=GTraductions.getValeur('Dates.DateDebutAHeureDebut',[lResult.dateDebut,lResult.heureDebut]);}
break;case EGenreRessource.Infirmerie:case EGenreRessource.Absence:if(aParams.element.ouverte){lResult.heure=GTraductions.getValeur('Dates.AHeure',[lResult.heureDebut]);lResult.date=GTraductions.getValeur('Dates.DepuisDateAHeure',[lResult.dateDebut.toLowerCase(),lResult.heureDebut]);} else if(lResult.estJourEgal){lResult.heure=GTraductions.getValeur('Dates.DeHeureDebutAHeureFin',[lResult.heureDebut,lResult.heureFin]);lResult.date=lResult.dateDebut+' '+lResult.heure;} else{lResult.date=GTraductions.getValeur('Dates.DuDateDebutAHeureDebutAuDateFinAHeureFin',[lResult.dateDebut,lResult.heureDebut,lResult.dateFin,lResult.heureFin]);}
break;case EGenreRessource.Incident:case EGenreRessource.Retard:lResult.heure=GTraductions.getValeur('Dates.AHeure',[lResult.heureDebut]);lResult.date=GTraductions.getValeur('Dates.DateDebutAHeureDebut',[lResult.dateDebut,lResult.heureDebut]);break;case EGenreRessource.Punition:{lPlace=aParams.element.placeDemande;if(aParams.element.horsCours){lPlace=null;}
let lFormatDate='%JJJ %J %MMM';if(aParams.sansChaineAujourdhui!==true){lFormatDate='['+lFormatDate+']';}
lResult.date=GDate.FormatDate(aParams.element.dateDemande,lFormatDate);if((lPlace!==null&&lPlace!==undefined)){const lDate=GDate.PlaceAnnuelleEnDate(lPlace);if(lDate&&GDate.estDateValide(lDate)&&GDate.estJourEgal(lDate,aParams.element.dateDemande)){lResult.date=GTraductions.getValeur('Dates.DateDebutAHeureDebut',[lResult.date,GDate.FormatDate(lDate,'%xh%sh%mm')])+' ';}}
break;}
case EGenreRessource.AbsenceInternat:case EGenreRessource.Sanction:if(lResult.estJourEgal){lResult.date=lResult.dateDebut;} else{lResult.date=GTraductions.getValeur('Dates.DateDebutAuDateFin',[lResult.dateDebut,lResult.dateFin]);}
break;case EGenreRessource.MesureConservatoire:if(lResult.estJourEgal){lResult.date=lResult.dateDebut;} else{lResult.heure=GTraductions.getValeur('Dates.AHeure',[lResult.heureDebut]);lResult.date=GTraductions.getValeur('Dates.DateDebutAHeureDebutAuDateFin',[lResult.dateDebut,lResult.heureDebut,lResult.dateFin]);}
break;default:break;}
return lResult;}
getDureeDAbsence(aAbsence){if(aAbsence.Genre===EGenreRessource.Retard){return aAbsence.duree;} else{if(MethodesObjet.isString(aAbsence.duree)){return aAbsence.duree;}
if(MethodesObjet.isDate(aAbsence.duree)){return GDate.FormatDate(aAbsence.duree,'%xh%sh%mm ');}
if(MethodesObjet.isNumber(aAbsence.duree)){return GDate.FormatDureeEnMillisecondes(TUtilitaireDuree.minEnMs(aAbsence.duree));}}
return aAbsence.duree;}
getDureeSanction(aAbsence){const H=[];let lNombre=0;if(EGenreSanction.estUneExclusionTemporaire(aAbsence.nature.GetGenre())){lNombre=aAbsence.duree;let lCleTraduction;if(aAbsence.nature.GetGenre()===EGenreSanction.ExclusionInternat){lCleTraduction=lNombre>1?'AbsenceVS.nuits':'AbsenceVS.nuit';} else{lCleTraduction=lNombre>1?'AbsenceVS.jours':'AbsenceVS.jour';}
H.push('&nbsp;',lNombre,'&nbsp;',GTraductions.getValeur(lCleTraduction));if(aAbsence.estDemiJournee){H.push(' ('+(aAbsence.estMatin?GTraductions.getValeur('AbsenceVS.matin'):GTraductions.getValeur('AbsenceVS.apresMidi'))+')');}
if(aAbsence.avecSursis){if(aAbsence.dureeSursis>0){H.push(' ',GTraductions.getValeur('AbsenceVS.dont'),' ',aAbsence.dureeSursis,' ',GTraductions.getValeur('AbsenceVS.avecSursis'));if(aAbsence.dateFinSursis){H.push(GDate.FormatDate(aAbsence.dateFinSursis,' '+GTraductions.getValeur('jusquAu')+' %J %MMM'));}} else{H.push(' ',GTraductions.getValeur('AbsenceVS.avecSursis'));}}} else if(aAbsence.nature.GetGenre()===EGenreSanction.Responsabilisation){lNombre=aAbsence.duree;const lCleTraduction=(lNombre>1?'AbsenceVS.heures':'AbsenceVS.heure');H.push('&nbsp;',lNombre,'&nbsp;',GTraductions.getValeur(lCleTraduction).toLowerCase());} else if(aAbsence.nature.GetGenre()===EGenreSanction.ExclusionDefinitive){if(aAbsence.avecSursis){H.push(' (',GTraductions.getValeur('AbsenceVS.avecSursis'));if(aAbsence.dateFinSursis){H.push(GDate.FormatDate(aAbsence.dateFinSursis,' '+GTraductions.getValeur('jusquAu')+' %J %MMM'));}
H.push(')');}}
return H.join('');}
getInfosModalitesPunitionSanction(aAbsence){const lResult={titre:'',programmations:[],demandeur:'',demandeLe:''};switch(aAbsence.Genre){case EGenreRessource.Exclusion:case EGenreRessource.Punition:if(aAbsence.nature&&aAbsence.nature.GetLibelle()){lResult.titre=aAbsence.nature.GetLibelle();} else{lResult.titre=GTraductions.getValeur('AbsenceVS.punition');}
if(aAbsence.programmation&&(aAbsence.programmation.GetNbrElements()>0)){const lPrefixe=(aAbsence.nature.GetGenre()===TypeGenrePunition.GP_Devoir?GTraductions.getValeur('AbsenceVS.aRendreLe')+' ':'');for(let I=0;I<aAbsence.programmation.GetNbrElements();I++){const lProg=aAbsence.programmation.GetElement(I);let lTemp=GDate.FormatDate(lProg.date,'%JJJ %J %MMM');const lDate=$.isNumeric(lProg.place)?(aAbsence.Genre===EGenreRessource.Punition)&&aAbsence.nature&&(aAbsence.nature.GetGenre()!==TypeGenrePunition.GP_ExclusionCours)?GDate.PlaceParJourEnDate(lProg.place):GDate.PlaceAnnuelleEnDate(lProg.place):'';if(lDate&&GDate.estDateValide(lDate)){lTemp+=' '+GTraductions.getValeur('Dates.AHeure',[GDate.FormatDate(lDate,'%xh%sh%mm')])+' ';}
if(lProg.duree){if(lProg.placeExecution!==undefined&&lProg.placeExecution!==null){const lExecution=GDate.PlaceParJourEnDate(lProg.placeExecution);if(lExecution&&GDate.estDateValide(lExecution)){lTemp+=' '+GTraductions.getValeur('Dates.AHeure',[GDate.FormatDate(lExecution,'%xh%sh%mm')])+' ';}}
lTemp+=' - '+GDate.FormatDureeEnMillisecondes(TUtilitaireDuree.minEnMs(lProg.duree));}
lResult.programmations.push(lPrefixe+lTemp);}} else if(aAbsence.estProgrammable){lResult.programmations.push(GTraductions.getValeur('AbsenceVS.nonProgramme'));}
break;case EGenreRessource.MesureConservatoire:if(aAbsence.nature){lResult.titre=aAbsence.nature.GetLibelle();} else{lResult.titre=GTraductions.getValeur('AbsenceVS.mesureConservatoire');}
break;case EGenreRessource.Sanction:if(aAbsence.nature){lResult.titre=aAbsence.nature.GetLibelle();} else{lResult.titre=GTraductions.getValeur('AbsenceVS.sanction');}
if(aAbsence.nature.GetGenre()===EGenreSanction.Autre_Exclusion){lResult.titre+=' ('+GTraductions.getValeur('AbsenceVS.exclusion2').toLowerCase()+') ';}
lResult.titre+=this.getDureeSanction(aAbsence);break;case EGenreRessource.Incident:if(aAbsence.mesure){lResult.titre=this.getModalitesPunitionSanction(aAbsence.mesure);} else{lResult.titre=GTraductions.getValeur('AbsenceVS.AucuneMesure');}
break;default:break;}
lResult.demandeur=this.getDemandeurDecideur(aAbsence);return lResult;}
getModalitesPunitionSanction(aAbsence){let lResult='';switch(aAbsence.Genre){case EGenreRessource.Exclusion:case EGenreRessource.Punition:if(aAbsence.nature&&aAbsence.nature.GetLibelle()){lResult+=aAbsence.nature.GetLibelle();} else{lResult+=GTraductions.getValeur('AbsenceVS.punition');}
if(aAbsence.programmation&&(aAbsence.programmation.GetNbrElements()>0)){lResult+=' '+(aAbsence.nature.GetGenre()===TypeGenrePunition.GP_Devoir?GTraductions.getValeur('AbsenceVS.aRendreLe'):GTraductions.getValeur('Le'));const lArray=[];for(let I=0;I<aAbsence.programmation.GetNbrElements();I++){const lProg=aAbsence.programmation.GetElement(I);let lTemp=GDate.FormatDate(lProg.date,' %J %MMM');const lDate=$.isNumeric(lProg.place)?(aAbsence.Genre===EGenreRessource.Punition)&&aAbsence.nature&&(aAbsence.nature.GetGenre()!==TypeGenrePunition.GP_ExclusionCours)?GDate.PlaceParJourEnDate(lProg.place):GDate.PlaceAnnuelleEnDate(lProg.place):'';if(lDate&&GDate.estDateValide(lDate)){lTemp+=' '+GTraductions.getValeur('Dates.AHeure',[GDate.FormatDate(lDate,'%xh%sh%mm')])+' ';}
if(lProg.duree){if(lProg.placeExecution!==undefined&&lProg.placeExecution!==null){const lExecution=GDate.PlaceParJourEnDate(lProg.placeExecution);if(lExecution&&GDate.estDateValide(lExecution)){lTemp+=' '+GTraductions.getValeur('Dates.AHeure',[GDate.FormatDate(lExecution,'%xh%sh%mm')])+' ';}}
lTemp+=' - '+GDate.FormatDureeEnMillisecondes(TUtilitaireDuree.minEnMs(lProg.duree));}
lArray.push(lTemp);}
lResult+=lArray.join(',');} else if(aAbsence.estProgrammable){lResult+=' - '+GTraductions.getValeur('AbsenceVS.nonProgramme');}
break;case EGenreRessource.MesureConservatoire:if(aAbsence.nature){lResult+=aAbsence.nature.GetLibelle();} else{lResult+=GTraductions.getValeur('AbsenceVS.mesureConservatoire');}
break;case EGenreRessource.Sanction:if(aAbsence.nature){lResult+=aAbsence.nature.GetLibelle();} else{lResult+=GTraductions.getValeur('AbsenceVS.sanction');}
if(aAbsence.nature.GetGenre()===EGenreSanction.Autre_Exclusion){lResult+=' ('+GTraductions.getValeur('AbsenceVS.exclusion2').toLowerCase()+') ';}
lResult+=this.getDureeSanction(aAbsence);break;case EGenreRessource.Incident:if(aAbsence.mesure){lResult+=this.getModalitesPunitionSanction(aAbsence.mesure);} else{lResult+=GTraductions.getValeur('AbsenceVS.AucuneMesure');}
break;default:break;}
return lResult.ucfirst();}
getLibellesInterdit(aAbsence){let lResult='';if((aAbsence.GetGenre()===EGenreRessource.MesureConservatoire)&&!!aAbsence.interditAcces&&aAbsence.interditAcces.count()>0){lResult+='<div class="TexteTitreInfoVS">'+GTraductions.getValeur('AbsenceVS.titres.interditLAcces').ucfirst()+' :</div>';if(aAbsence.interditAcces.contains(TypePerimetreMesureConservatoire.PMC_Externat)){lResult+='- '+GTraductions.getValeur('AbsenceVS.mesureconservatoire.aLEtablissement')+'<br />';}
if(aAbsence.interditAcces.contains(TypePerimetreMesureConservatoire.PMC_DP)){lResult+='- '+GTraductions.getValeur('AbsenceVS.mesureconservatoire.aLaDemiPension')+'<br />';}
if(aAbsence.interditAcces.contains(TypePerimetreMesureConservatoire.PMC_Internat)){lResult+='- '+GTraductions.getValeur('AbsenceVS.mesureconservatoire.aLInternat')+'<br />';}}
return lResult;}
getLibellePunitionSanctionDIncident(aAbsence){let lResult='';if(MethodesTableau.existe(aAbsence.GetGenre(),[EGenreRessource.Punition,EGenreRessource.Sanction,EGenreRessource.MesureConservatoire])&&!aAbsence.estProgrammation&&aAbsence.estLieAUnIncident&&aAbsence.incident&&aAbsence.incident.publie){lResult=GTraductions.getValeur('AbsenceVS.IncidentSignaleLe',[GDate.FormatDate(aAbsence.incident.date,'%J %MMM'),GDate.FormatDate(aAbsence.incident.date,'%xh%sh%mm')]);}
return lResult;}
getChaineTraductionGenreAbsence(aObjet){switch(aObjet.genre){case EGenreRessource.ObservationProfesseurEleve:switch(aObjet.genreObservation){case TypeGenreObservationVS.OVS_DefautCarnet:if(!!aObjet.libelle){return aObjet.libelle;}
return aObjet.singulier?GTraductions.getValeur('AbsenceVS.defautDeCarnet'):GTraductions.getValeur('AbsenceVS.defautsDeCarnet');case TypeGenreObservationVS.OVS_Autres:if(!!aObjet.libelle){return aObjet.libelle;}
return aObjet.singulier?GTraductions.getValeur('AbsenceVS.autreObservation'):GTraductions.getValeur('AbsenceVS.autresObservations');case TypeGenreObservationVS.OVS_ObservationParent:if(aObjet.estLue===false){return GTraductions.getValeur('AbsenceVS.observationNonLue');}
return aObjet.singulier?GTraductions.getValeur('AbsenceVS.observation'):GTraductions.getValeur('AbsenceVS.observations');case TypeGenreObservationVS.OVS_Encouragement:if(aObjet.estLue===false){return GTraductions.getValeur('AbsenceVS.encouragementNonLu');}
return aObjet.singulier?GTraductions.getValeur('AbsenceVS.encouragement'):GTraductions.getValeur('AbsenceVS.encouragements');default:return'';}
case EGenreRessource.Absence:if(aObjet.justifie===true){return aObjet.singulier?GTraductions.getValeur('AbsenceVS.absenceCoursJust'):GTraductions.getValeur('AbsenceVS.absencesCoursJust');}
if(aObjet.justifie===false){return aObjet.singulier?GTraductions.getValeur('AbsenceVS.absenceCoursNonJust'):GTraductions.getValeur('AbsenceVS.absencesCoursNonJust');}
return aObjet.singulier?GTraductions.getValeur('AbsenceVS.absence'):GTraductions.getValeur('AbsenceVS.absences');case EGenreRessource.AbsenceRepas:return aObjet.singulier?GTraductions.getValeur('AbsenceVS.absenceRepas'):GTraductions.getValeur('AbsenceVS.absencesRepas');case EGenreRessource.AbsenceInternat:return aObjet.singulier?GTraductions.getValeur('AbsenceVS.absenceInternat'):GTraductions.getValeur('AbsenceVS.absencesInternat');case EGenreRessource.Retard:return aObjet.singulier?GTraductions.getValeur('AbsenceVS.retard'):GTraductions.getValeur('AbsenceVS.retards');case EGenreRessource.Infirmerie:return aObjet.singulier?GTraductions.getValeur('AbsenceVS.infirmerie'):GTraductions.getValeur('AbsenceVS.infirmeries');case EGenreRessource.Exclusion:return aObjet.singulier?GTraductions.getValeur('AbsenceVS.exclusion'):GTraductions.getValeur('AbsenceVS.exclusions');case EGenreRessource.Punition:return aObjet.singulier?GTraductions.getValeur('AbsenceVS.punition'):GTraductions.getValeur('AbsenceVS.punitions');case EGenreRessource.Sanction:return aObjet.singulier?GTraductions.getValeur('AbsenceVS.sanction'):GTraductions.getValeur('AbsenceVS.sanctions');case EGenreRessource.MesureConservatoire:return aObjet.singulier?GTraductions.getValeur('AbsenceVS.mesureConservatoire'):GTraductions.getValeur('AbsenceVS.mesuresConservatoires');case EGenreRessource.Incident:return aObjet.singulier?GTraductions.getValeur('AbsenceVS.incident'):GTraductions.getValeur('AbsenceVS.incidents');default:;return'';}}
arrayToChaine(aArray,aSeparateur,aSeparateurFin){let lResult='';if(aArray.length>0){lResult=aArray[aArray.length-1];if(aArray.length>1){aArray.pop();lResult=aArray.join(aSeparateur)+aSeparateurFin+lResult;}}
return lResult;}
getChaineRecapitulatifPunitionSanction(aObjet){let lResult='';if(aObjet.genre===EGenreRessource.MesureConservatoire){lResult+=aObjet.nombre+' '+(aObjet.nombre===1?GTraductions.getValeur('AbsenceVS.mesureConservatoire').toLowerCase():GTraductions.getValeur('AbsenceVS.mesuresConservatoires').toLowerCase());return lResult;} else if(aObjet.genre===EGenreRessource.Sanction){lResult+=aObjet.nombre+' '+(aObjet.nombre===1?GTraductions.getValeur('AbsenceVS.sanction').toLowerCase():GTraductions.getValeur('AbsenceVS.sanctions').toLowerCase());} else{lResult+=aObjet.nombre+' '+(aObjet.nombre===1?GTraductions.getValeur('AbsenceVS.punition').toLowerCase():GTraductions.getValeur('AbsenceVS.punitions').toLowerCase());}
if(aObjet.nombre>1&&!!aObjet.recap&&(aObjet.recap.getNombre()>0)){lResult+=' ('+GTraductions.getValeur('AbsenceVS.dont')+' ';const lPunitions=[];for(const j in aObjet.recap.Nombre){const lLibelle=aObjet.recap.libelles[j];const lNombre=aObjet.recap.Nombre[j];if(lNombre>0){lPunitions.push(lNombre+' '+lLibelle);}}
lResult+=this.arrayToChaine(lPunitions,', ',' '+GTraductions.getValeur('Et')+' ');lResult+=')';}
return lResult;}
getLibelleTAF(aAbsence){let lLibelle='';const lTAFDoc=[];if(!!aAbsence.travailAFaire||(!!aAbsence.documentsTAF&&aAbsence.documentsTAF.GetNbrElements()>0)){lLibelle+='<span>'+GTraductions.getValeur('AbsenceVS.travailAFaire')+' : '+'</span>';}
if(!!aAbsence.travailAFaire){lLibelle+=aAbsence.travailAFaire;}
if(!!aAbsence.documentsTAF&&aAbsence.documentsTAF.GetNbrElements()>0){if(!!aAbsence.travailAFaire){lLibelle+='<div class="vsDoc">';}
for(let i=0;i<aAbsence.documentsTAF.GetNbrElements();i++){const lDoc=aAbsence.documentsTAF.GetElement(i);lTAFDoc.push('<span class="vsDoc">'+GChaine.composerUrlLienExterne({documentJoint:lDoc,genreRessource:EGenreRessource.DocJointEleve})+'</span>');}
lLibelle+=lTAFDoc.join(', ');if(!!aAbsence.travailAFaire){lLibelle+='</div>';}}
return((lLibelle!=='')?'<div class="Texte10 EspaceHaut10">'+lLibelle+'</div>':'');}
getTravailAFaire(aElement){let lTAF='';if(!!aElement.travailAFaire){lTAF=aElement.travailAFaire;}
const lTAFDoc=[];if(!!aElement.documentsTAF){for(let k=0;k<aElement.documentsTAF.GetNbrElements();k++){const lDocTAF=aElement.documentsTAF.GetElement(k);lTAFDoc.push('<span class="vsDoc">'+GChaine.composerUrlLienExterne({documentJoint:lDocTAF,genreRessource:EGenreRessource.DocJointEleve})+'</span>');}}
return lTAF+(!!lTAF&&!!lTAFDoc.length?'<div class="vsDoc">':'')+lTAFDoc.join(', ')+(!!lTAF&&!!lTAFDoc.length?'</div>':'');}
estEspaceParent(){return MethodesTableau.existe(GEtatUtilisateur.GenreEspace,[EGenreEspace.Parent,EGenreEspace.PrimParent,EGenreEspace.Mobile_Parent,EGenreEspace.Mobile_PrimParent]);}
getIndiceCoursParPlace(aListeCours,aPlaceCourante){let lEcartAvant= -1000;let lIndiceAvant;if(MethodesObjet.isNumber(aPlaceCourante)){for(let I=0;I<aListeCours.GetNbrElements();I++){const lCours=aListeCours.GetElement(I);if(lCours&&lCours.Visible!==false&&GDate.estJourEgal(lCours.DateDuCours,new Date())){if((aPlaceCourante>=lCours.Debut)&&((lCours.Fin-aPlaceCourante)>lEcartAvant)){lEcartAvant=lCours.Fin-aPlaceCourante;lIndiceAvant=I;}}}}
return lIndiceAvant;}
ajouterAbsence(aParam){const lParent=aParam.instanceAppel;const lAbsenceAjoutee=new ObjetElement(null,null,EGenreRessource.Absence);lAbsenceAjoutee.estUneCreationParent=true;const lDateBornee=GDate.getDateBornee(GDate.aujourdhui);lAbsenceAjoutee.debut={date:lDateBornee,estMatin:true};lAbsenceAjoutee.fin={date:lDateBornee,estMatin:false};lAbsenceAjoutee.SetEtat(EGenreEtat.Creation);this.fenetre=ObjetFenetre.creerInstance(ObjetVSFicheSaisieAbsence,{pere:this,evenement:function(aNumeroBouton,aDonnees){if(aNumeroBouton===1){const lInstance=!!lParent.instance?lParent.instance:lParent;const lRequete=new ObjetRequeteSaisieVieScolaire(lInstance);const lListeAbsences=new ObjetListeElements().AddElement(aDonnees);lRequete.addUpload({listeFichiers:aDonnees.documents}).lancerRequete(lListeAbsences).then(function(aParams){if(aParams.genreReponse&&(aParams.genreReponse===EGenreReponseSaisie.succes)){Toast.afficher({msg:GTraductions.getValeur('AbsenceVS.message.confirmerDeclaration'),type:ETypeToast.succes,dureeAffichage:4500})
;if(aParam.callbackApresSaisieAbsences){Object.assign(aParams,{absenceAjoutee:lAbsenceAjoutee});aParam.callbackApresSaisieAbsences(aParams);}}});}},initialiser:function(aInstance){if(!GEtatUtilisateur.pourPrimaire()){aInstance.setTitreFiche(GTraductions.getValeur('AbsenceVS.PrevenirAbsenceParentPrim'));}
aInstance.nbMaxJoursDeclarationAbsence=GEtatUtilisateur.Identification.ressource.nbMaxJoursDeclarationAbsence;}});this.fenetre.Initialiser();if(aParam.estSidePanel){this.fenetre.setOptions({estSidePanel:true,idPanel:aParam.idEcranSecondaire,callbackEnvoyer:function(){$('#'+(aParam.idEcranPrincipal).escapeJQ()).show();$('#'+(aParam.idEcranSecondaire).escapeJQ()).hide();}});}
this.fenetre.SetDonnees(lAbsenceAjoutee);if(aParam.estSidePanel){$('#'+(aParam.idEcranPrincipal).escapeJQ()).hide();$('#'+(aParam.idEcranSecondaire).escapeJQ()).show();}}}
function _remplirInfosObservations(aElement,aGenreObservation,aNode,aModel){aElement.html={titre:aElement.infosDate.strDate(),content:[],aria:aElement.infosDate.strDate(),node:'',model:'',class:['listeDetails Observation'],classSection:[],auteur:'',matiere:!!aElement.matiere&&aElement.matiere.GetLibelle()?aElement.matiere.GetLibelle():'',commentaire:!!aElement.commentaire?GChaine.ToHTML(aElement.commentaire):''};if(aGenreObservation===TypeGenreObservationVS.OVS_Autres){aElement.html.class.push('OVS_Autres');aElement.html.aria+=' '+aElement.GetLibelle();}
if(aElement.demandeur){aElement.html.auteur=aElement.demandeur.GetLibelle()+(aElement.demandeur.estProfPrincipal?' ('+GTraductions.getValeur('AbsenceVS.ProfPrincipal')+')':'');aElement.html.content.push('<div>'+aElement.html.auteur+'</div>');aElement.html.aria+=' - '+aElement.html.auteur;}
if(!!aElement.html.matiere){aElement.html.content.push('<div>'+aElement.html.matiere+'</div>');aElement.html.aria+=', '+aElement.html.matiere;}
if(!!aElement.commentaire){aElement.html.content.push('<div class="commentaire">'+aElement.html.commentaire+'</div>');aElement.html.aria+=' '+aElement.commentaire;}
if(aNode||aModel){aElement.html.node=aNode;aElement.html.model=aModel;aElement.html.content.push('<div class="avecJustification">',this.getCheckBoxVS({observation:aElement,ieModel:aElement.html.model}),'</div>');}
if(aElement.estLue){aElement.html.class.push('estLue');}
if(aElement.estPremier){aElement.html.class.push('VSRegroupement1rFils');}}
function _remplirInfosInfirmerie(aElement){aElement.html={titre:aElement.infosDate.strDate(),content:[],aria:aElement.infosDate.strDate(),node:'',model:'',class:['listeDetails Infirmerie'],classSection:[]};aElement.html.content.push(this.getSymptomesMedicauxVS(aElement).tohtml());aElement.html.content.push(this.getActesMedicauxVS(aElement).tohtml());}
function _remplirInfosPunition(aElement,aModel){const lInfos=this.getInfosModalitesPunitionSanction(aElement);aElement.html={titre:lInfos.titre,content:[],aria:lInfos.titre,node:'',model:'',class:['listeDetails Punition'],classSection:[]};if(aElement.estLue){aElement.html.class.push('estLue');}
lInfos.programmations.forEach(function(aVal){aElement.html.content.push('<div class="contentProgrammation"><span class="colorVS">'+aVal+'</span></div>');});if(lInfos.demandeur){aElement.html.content.push('<div class="contentDemandeur">'+lInfos.demandeur+'</div>');}
if(aElement.infosDate&&aElement.infosDate.date){aElement.html.content.push('<div class="contentDate">'+GTraductions.getValeur('AbsenceVS.titres.demande_le').ucfirst()+' : <span class="colorTexte">'+aElement.infosDate.date+'</span></div>');}
if(aElement.listeMotifs){aElement.html.content.push('<div class="contentMotif">'+GTraductions.getValeur('AbsenceVS.titres.motif').ucfirst()+' : <span class="colorVS">'+aElement.listeMotifs.getTableauLibelles().join(', ')+'</span></div>');}
const lCirconstances=this.getCirconstances(aElement);if(!!lCirconstances){aElement.html.content.push('<div class="contentCirconstances">'+GTraductions.getValeur('AbsenceVS.titres.circonstances').ucfirst()+' : <span class="colorTexte">'+GChaine.ToHTML(lCirconstances)+'</span></div>');}
const lTAF=this.getTravailAFaire(aElement);if(!!lTAF){aElement.html.content.push('<div class="contentTAF">'+GTraductions.getValeur('AbsenceVS.travailAFaire').ucfirst()+' : <span class="colorTexte">'+GChaine.ToHTML(lTAF)+'</span></div>');}
if(aModel){aElement.html.model=aModel;aElement.html.content.push('<div class="avecJustification">',this.getCheckBoxVS({ieModel:aElement.html.model}),'</div>');}}
function _remplirInfosSanction(aElement){const lInfos=this.getInfosModalitesPunitionSanction(aElement);aElement.html={titre:lInfos.titre,content:[],aria:lInfos.titre,node:'',model:'',class:['listeDetails Sanction'],classSection:[]};if(aElement.infosDate&&aElement.infosDate.date){aElement.html.content.push('<div class="contentDate"><span class="colorVS">'+aElement.infosDate.strDate()+'</span></div>');}
if(lInfos.demandeur){aElement.html.content.push('<div class="contentDemandeur">'+lInfos.demandeur+'</div>');}
if(aElement.listeMotifs){aElement.html.content.push('<div class="contentMotif">'+GTraductions.getValeur('AbsenceVS.titres.motif').ucfirst()+' : <span class="colorVS">'+aElement.listeMotifs.getTableauLibelles().join(', ')+'</span></div>');}
const lCirconstances=this.getCirconstances(aElement);if(!!lCirconstances){aElement.html.content.push('<div class="contentCirconstances">'+GTraductions.getValeur('AbsenceVS.titres.circonstances').ucfirst()+' : <span class="colorTexte">'+GChaine.ToHTML(lCirconstances)+'</span></div>');}}
function _remplirInfosMesuresConservatoire(aElement){const lInfos=this.getInfosModalitesPunitionSanction(aElement);aElement.html={titre:aElement.infosDate.strDate(),content:[],aria:aElement.infosDate.strDate(),node:'',model:'',class:['listeDetails MesuresConservatoire'],classSection:[]};if(lInfos.demandeur){aElement.html.content.push('<div class="contentDemandeur">'+lInfos.demandeur+'</div>');}
if(aElement.listeMotifs){aElement.html.content.push('<div class="contentMotif">'+GTraductions.getValeur('AbsenceVS.titres.motif').ucfirst()+' : <span class="colorVS">'+aElement.listeMotifs.getTableauLibelles().join(', ')+'</span></div>');}
const lCirconstances=this.getCirconstances(aElement);if(!!lCirconstances){aElement.html.content.push('<div class="contentCirconstances">'+GTraductions.getValeur('AbsenceVS.titres.circonstances').ucfirst()+' : <span class="colorTexte">'+GChaine.ToHTML(lCirconstances)+'</span></div>');}
if(aElement.interditAcces){aElement.html.content.push('<div class="contentInterditAccess">'+GTraductions.getValeur('AbsenceVS.titres.interditLAcces').ucfirst()+'</div>');if(aElement.interditAcces.contains(TypePerimetreMesureConservatoire.PMC_Externat)){aElement.html.content.push('<div class="itemVSListe"><span class="colorVS">'+GTraductions.getValeur('AbsenceVS.mesureconservatoire.aLEtablissement')+'</span></div>');}
if(aElement.interditAcces.contains(TypePerimetreMesureConservatoire.PMC_DP)){aElement.html.content.push('<div class="itemVSListe"><span class="colorVS">'+GTraductions.getValeur('AbsenceVS.mesureconservatoire.aLaDemiPension')+'</span></div>');}
if(aElement.interditAcces.contains(TypePerimetreMesureConservatoire.PMC_Internat)){aElement.html.content.push('<div class="itemVSListe"><span class="colorVS">'+GTraductions.getValeur('AbsenceVS.mesureconservatoire.aLInternat')+'</span></div>');}}}
function _remplirInfosIncident(aElement,aModel){const lInfos=this.getInfosModalitesPunitionSanction(aElement);aElement.html={titre:aElement.infosDate.strDate(),content:[],aria:aElement.infosDate.strDate(),node:'',model:'',class:['listeDetails MesuresConservatoire'],classSection:[]};if(lInfos.demandeur){aElement.html.content.push('<div class="contentDemandeur">'+lInfos.demandeur+'</div>');}
if(aElement.listeMotifs){aElement.html.content.push('<div class="contentMotif">'+GTraductions.getValeur('AbsenceVS.titres.motif').ucfirst()+' : <span class="colorVS">'+aElement.listeMotifs.getTableauLibelles().join(', ')+'</span></div>');}
const lCirconstances=aElement.GetLibelle();if(!!lCirconstances){aElement.html.content.push('<div class="contentCirconstances">'+GTraductions.getValeur('AbsenceVS.titres.details').ucfirst()+' : <span class="colorTexte">'+GChaine.ToHTML(lCirconstances)+'</span></div>');}
aElement.html.content.push('<div class="contentMesuresDisciplinaire">'+GTraductions.getValeur('AbsenceVS.titres.mesureDisciplinaire').ucfirst()+' : <span class="colorVS">'+lInfos.titre+'</span></div>');if(!!aElement.gravite){aElement.html.content.push('<div class="contentGravite">'+GTraductions.getValeur('AbsenceVS.titres.gravite').ucfirst()+' : <span class="colorVS">'+aElement.gravite+'</span></div>');}
if(aModel){aElement.html.model=aModel;aElement.html.content.push('<div class="avecJustification">',this.getCheckBoxVS({ieModel:aElement.html.model}),'</div>');}}
function _getIconAbsence(aElement){if(aElement.justifie){return'icon_ok';} else if(aElement.motifParent&&aElement.motifParent.existeNumero()&&aElement.avecSaisie){return'icon_edt_permanence';}
if(aElement.GetGenre()===EGenreRessource.Absence||aElement.GetGenre()===EGenreRessource.Retard){return'icon_exclamation';} else if(aElement.reglee){return'icon_ok';}
return'';}
function _getCommentaire(aElement,aPourParent){let lCommentaire='';if(aPourParent&&!!aElement.justification){lCommentaire=aElement.justification;}
return lCommentaire;}
function _remplirInfosAbsences(aElement,aParams){aElement.infosMotif=this.getInfosMotifAbsenceVS({donnee:aElement,pourSaisieParent:aParams.avecSaisie});aElement.html={titre:aElement.infosDate.strDate(),content:[],icon:'',aria:aElement.infosDate.strDate(),node:'',model:'',class:['listeDetails Absence'],classSection:[],motif:'',motifMessage:'',nbrHeures:'',duree:'',justifie:'',avecDocuments:!!aElement.documents&&(aElement.documents.GetNbrElementsExistes()>0),commentaire:_getCommentaire.call(this,aElement,aParams.pourParent),avecSaisie:aParams.avecSaisie&&aElement.avecSaisie};aElement.html.icon='<i aria-hidden="true" class="iconVSDetail '+_getIconAbsence(aElement)+'"></i>';if(aElement.reglee){aElement.html.class.push('estLue');}
if(!aParams.avecBascule){aElement.html.classSection.push('sansBascule');}
if(aParams.node){aElement.html.node=aParams.node;}
aElement.html.content.push('<div class="sectionVSMotif">');if(aElement.NbrHeures&&!GEtatUtilisateur.pourPrimaire()){aElement.html.nbrHeures=this.getHeuresCoursManquees(aElement,true);aElement.html.content.push('<div>'+aElement.html.nbrHeures+'</div>');}
if(!!aElement.duree){aElement.html.duree=aElement.duree+' '+GTraductions.getValeur('AbsenceVS.minutes');aElement.html.content.push('<div>'+aElement.html.duree+'</div>');}
if(aElement.infosMotif.existe()){aElement.html.motif=aElement.infosMotif.label+'<span class="colorVS">'+aElement.infosMotif.texte+'</span>';aElement.html.content.push('<div>'+aElement.html.motif+'</div>');}
if(!!aElement.infosMotif.message){aElement.html.content.push('<div class="VSmessage">'+aElement.infosMotif.message+'</div>');}
if((aElement.GetGenre()===EGenreRessource.Absence)){let lStrAffichee='';if(!!aElement.justifie&&(!(aParams.avecSaisie&&(aElement.aJustifierParParents||aElement.estMotifNonEncoreConnu))||aElement.reglee)){lStrAffichee=aElement.justifie?GTraductions.getValeur('AbsenceVS.absenceCoursJust'):GTraductions.getValeur('AbsenceVS.absenceCoursNonJust');} else if(!aElement.message&&aElement.estUneCreationParent){lStrAffichee=aElement.refusee?GTraductions.getValeur('AbsenceVS.absenceRefusee'):GTraductions.getValeur('AbsenceVS.absenceConfirmee');} else if(aElement.aRegulariser){lStrAffichee=GTraductions.getValeur('AbsenceVS.absenceAJustifier');}
aElement.html.justifie=lStrAffichee;aElement.html.content.push('<div class="justifie">'+aElement.html.justifie+'</div>');}
if((aElement.GetGenre()===EGenreRessource.Retard)){let lStrAffichee='';if(aElement.justifie){lStrAffichee=GTraductions.getValeur('AbsenceVS.retardJustifie');} else{lStrAffichee=GTraductions.getValeur('AbsenceVS.retardAJustifier');}
aElement.html.justifie=lStrAffichee;aElement.html.content.push('<div class="justifie">'+aElement.html.justifie+'</div>');}
aElement.html.content.push('</div>');if(aParams.avecDetailEdition){if(!aParams.avecBascule){aElement.html.content.push('<div class="sectionVSIcones">');let lIconDocs='';if(aElement.html.avecDocuments&&aParams.ieHintPJ){lIconDocs='<i class="icon_piece_jointe" '+aParams.ieHintPJ+'></i>';}
aElement.html.content.push('<div class="iconVSAbsence">',lIconDocs,'</div>');let lIconCommentaire;if(!!aElement.html.commentaire&&aParams.ieHintCommentaire){lIconCommentaire='<i class="icon_nouvelle_conversation" '+aParams.ieHintCommentaire+'></i>';}
aElement.html.content.push('<div class="iconVSAbsence">',lIconCommentaire,'</div>');aElement.html.content.push('</div>');aElement.html.content.push('<div class="sectionVSEdition">');if(aElement.avecSaisie&&aParams.avecSaisie){let lBtnLabel=GTraductions.getValeur('Justifier');let lThemeBouton=TypeThemeBouton.primaire;if(lIconDocs||lIconCommentaire||(aElement.motifParent&&aElement.motifParent.existeNumero())){lBtnLabel=GTraductions.getValeur('Modifier');lThemeBouton=TypeThemeBouton.secondaire;}
aElement.html.content.push('<ie-bouton class="',lThemeBouton,'" ',aParams.nodeEdition,'>',lBtnLabel,'</ie-bouton>');} else{aElement.html.content.push('<div class="btnVisu" ',aParams.nodeEdition,'><i class="icon_eye_open"></i></div>');}
aElement.html.content.push('</div>');} else{if(aElement.avecSaisie){const lInfo=aElement.message&&aElement.message.replace?' ie-hint="'+aElement.message.replace(/\n/g,'<br />')+'"':'';if(aParams.avecSaisie){if(!aElement.motifParent||!aElement.motifParent.existeNumero()){aElement.html.content.push('<div class="avecJustification avecLienJustifie"',lInfo,'>',GTraductions.getValeur('AbsenceVS.jeJustifie'),' <i class="icon_justifier"></i></div>');}}}}}}
module.exports=ObjetUtilitaireAbsence;},fn:"objetutilitaireabsence.js"});;
IE.fModule({f:function(exports,require,module,global){const EGenreWidget={discussions:0,casier:1,appelNonFait:2,CDTNonSaisi:3,conseilDeClasse:4,menuDeLaCantine:5,vieScolaire:6,travailAFaire:7,agenda:8,actualites:9,notes:10,QCM:11,EDT:12,ressources:13,kiosque:14,ressourcePedagogique:15,DS:16,aide:17,competences:18,coursNonAssures:19,penseBete:20,DSEvaluation:21,RetourEspace:22,carnetDeCorrespondance:23,Encouragement:24,TAFARendre:25,Intendance_Execute:26,lienUtile:27,partenaireCDI:28,partenaireAgate:29,incidents:30,donneesVS:31,donneesProfs:32,tableauDeBord:33,communications:34,connexionsEnCours:35,partenaireARD:36,personnelsAbsents:37,tachesSecretariat_Execute:38,Planning:39,elections:40,activite:41,enseignementADistance:42,TAFPrimaire:43,absRetardsJustifiesParents:44,blog_filActu:45,maintenanceInfoExecute:46,TAFEtActivites:47,evenementRappel:48,exclusions:49,partenaireApplicam:50};module.exports=EGenreWidget;},fn:"enumere_widget.js"});;
IE.fModule({f:function(exports,require,module,global){const GUID=require('GUID.js');const GHtml=require('GHtml.js');const GTraductions=require('ObjetTraduction.js');const{GObjetWAI,EGenreRole}=require('ObjetWAI.js');const MethodesTableau=require('MethodesTableau.js');const ObjetListeElements=require('ObjetListeElements.js');require('produit/css/Widgets-dashboard.css');const UtilitaireWidget={};UtilitaireWidget.parametres={};UtilitaireWidget.hauteurTitre=27;UtilitaireWidget.nbrItemsVisible=3;UtilitaireWidget.suffixIdWidget=GUID.getId();UtilitaireWidget.suffixIdContenu='';UtilitaireWidget.suffixIdWrapper=GUID.getId();UtilitaireWidget.suffixIdActualiser=GUID.getId();UtilitaireWidget.suffixIdToutVoir=GUID.getId();UtilitaireWidget.setParametres=function(aParametres){this.parametres=aParametres;};UtilitaireWidget.compose=function(aParams){const H=[];H.push(this.composeTitre(aParams));H.push(aParams.contenu);return H.join('');};UtilitaireWidget.composeTitre=function(aParams){if(UtilitaireWidget.invisible){return'';}
const H=[];H.push('<header',aParams.hint?' title="'+aParams.hint+'">':'>',aParams.titre?aParams.titre:'','</header>');return H.join('');};UtilitaireWidget.composeWidget=function(aWidget,aNom){return UtilitaireWidget.compose({titre:UtilitaireWidget.composeTitreWidget(aWidget,aNom),hint:aWidget.hint,contenu:UtilitaireWidget.composeContenuWidget(aWidget),couleurFond:aWidget.couleurFond,maximise:aWidget.maximise,sansGabarit:aWidget.sansGabarit});};UtilitaireWidget.composeTitreWidget=function(aWidget,aNom){const lExistePage=(aWidget.page&&(GEtatUtilisateur.existeGenreOnglet?GEtatUtilisateur.existeGenreOnglet(aWidget.page.Onglet):true))||aWidget.getPage;const H=[];if(aWidget.titre){const lAttrSupplementairesTitre=[];if(!aWidget.hint&&!aWidget.titreFixe){lAttrSupplementairesTitre.push('ie-ellipsis');}
if(lExistePage){lAttrSupplementairesTitre.push('onclick="'+aNom+'._surToutVoir('+aWidget.genre+')"');lAttrSupplementairesTitre.push('class="clickable"');}
lAttrSupplementairesTitre.push('id="'+aWidget.id+'_TitreText"');H.push('<h3 tabindex="0" ',lAttrSupplementairesTitre.join(' '),'>','<span>',aWidget.titre,((aWidget.nbrElements>0&&(this.parametres.avecCompteur||UtilitaireWidget._avecCompteur(aWidget)))?' ('+aWidget.nbrElements+')':''),'</span>','</h3>');} else{H.push('<h3 tabindex="0" class="wai_hidden" id="'+aWidget.id+'_TitreText">',aWidget.hint?aWidget.hint:'','</h3>');}
H.push('<div class="cta-conteneur">');if(lExistePage){if(this.parametres.avecToutVoir){H.push(UtilitaireWidget.composeToutVoir(aWidget,aNom));} else{H.push('<i role="button" tabIndex="0" aria-label="'+GTraductions.getValeur('accueil.hint.toutVoir')+'" class="as-button bt-widget icon icon_affichage_widget" ie-hint="'+GTraductions.getValeur('accueil.hint.toutVoir')+'" onclick="'+aNom+'._surToutVoir ('+aWidget.genre+', false)"></i>');}}
if(aWidget&&aWidget.avecActualisation){H.push('<i role="button" aria-label="',GTraductions.getValeur('accueil.hint.refresh'),'" ie-hint="',GTraductions.getValeur('accueil.hint.refresh'),'" id="'+aWidget.id+UtilitaireWidget.suffixIdActualiser,'" class="as-button bt-widget icon icon_refresh" onclick="',aNom+'._surActualiser (',aWidget.genre,')"></i>');}
if(this.parametres.avecFermer){H.push('<i role="button" tabIndex="0" aria-label="'+GTraductions.getValeur('accueil.hint.fermer')+'" class="as-button bt-close icon icon_fermeture_widget" ie-hint="'+GTraductions.getValeur('accueil.hint.fermer')+'" onclick="'+aNom+'._surFermer (',aWidget.genre,', false)"></i>');}
MethodesTableau.parcourir(aWidget.listeElementsGraphiques,function(D){(!!D.htmlMrFiche)?H.push(D.htmlMrFiche):'';});H.push('</div>');return H.join('');};UtilitaireWidget.composeContenuWidget=function(aWidget){const H=[];aWidget.nbrItemsVisible=(aWidget.nbrItemsVisible===undefined)?this.nbrItemsVisible:aWidget.nbrItemsVisible;if(aWidget.listeElementsGraphiques!==undefined){H.push('<div class="filtre-conteneur">');MethodesTableau.parcourir(aWidget.listeElementsGraphiques,function(D){if(!!D.id){H.push('<span id="'+D.id+'" ></span>');} else if(!!D.html){H.push(D.html);}});H.push('</div>');}
H.push('<div class="content-container overflow-auto" id="',aWidget.id,UtilitaireWidget.suffixIdWrapper,'" ','  role="presentation" tabIndex="0">');H.push('<div id="',aWidget.id+UtilitaireWidget.suffixIdContenu,'">');H.push(aWidget.afficherMessage&&aWidget.message?UtilitaireWidget.composeMessageAucuneDonnee(aWidget):aWidget.html);H.push('</div>');if(aWidget.isCollapsible){let lNbElementsAffichables= -1;if(!!aWidget.nbrListes&&aWidget.nbrListes>0&&!!aWidget.liste){lNbElementsAffichables=UtilitaireWidget._getNbrElementsNonVisibles(aWidget);} else if(aWidget.nbrElements>aWidget.nbrItemsVisible){lNbElementsAffichables=(aWidget.nbrElements-aWidget.nbrItemsVisible);}
if(lNbElementsAffichables>0){H.push('<div class="as-footer"><a class="btn-collapse" tabindex="0" role="button" aria-label="'+GTraductions.getValeur('accueil.hintAfficherElements')+'"><span class="icon icon_eye_open"></span><span class="counter">+</span>',lNbElementsAffichables,'</a></div>');}}
H.push('</div>');return H.join('');};UtilitaireWidget.actualiserWidget=function(aWidget){GHtml.setHtml(aWidget.id+UtilitaireWidget.suffixIdActualiser,aWidget.avecActualisation?'<i tabIndex="0" role="button" aria-label="'+GTraductions.getValeur('accueil.hint.refresh')+'" class="as-button bt-widget icon icon_refresh"></i>':'');GHtml.setHtml(aWidget.id+UtilitaireWidget.suffixIdContenu,aWidget.afficherMessage&&aWidget.message?UtilitaireWidget.composeMessageAucuneDonnee(aWidget):aWidget.html,{controleur:aWidget.controleur});GHtml.setHtml(aWidget.id+'_TitreText',aWidget.titre+(aWidget.nbrElements>0?' ('+aWidget.nbrElements+')':''),{controleur:aWidget.controleur});};UtilitaireWidget.composeMessageAucuneDonnee=function(aWidget,aMessage){const H=[];H.push('<div class="no-events" tabIndex="0" aria-label="',(aWidget&&aWidget.message?aWidget.message:aMessage),'"><p>',aWidget&&aWidget.message?aWidget.message:aMessage,'</p></div>');return H.join('');};UtilitaireWidget.composeToutVoir=function(aWidget,aNom){const H=[];H.push('<i id="'+aWidget.id+UtilitaireWidget.suffixIdToutVoir+'" '+GObjetWAI.composeRole(EGenreRole.Button),' title="',GTraductions.getValeur('accueil.toutVoir'),'"',' class="as-button bt-widget icon icon_affichage_widget"',' onclick="'+aNom+'._surToutVoir('+aWidget.genre+')"',' tabIndex="0" role="button" aria-label="'+GTraductions.getValeur('accueil.toutVoir')+'">','</i>');return H.join('');};UtilitaireWidget.afficherMasquerListe=function(aWidget){aWidget.nbrItemsVisible=(aWidget.nbrItemsVisible===undefined)?this.nbrItemsVisible:aWidget.nbrItemsVisible;if(aWidget.isCollapsible){const lWidgetComplet=$('#'+aWidget.id).closest('.widget');let lListItems;if(aWidget.nomDonnees==='actualites'&&lWidgetComplet.find('ul ul').length>1){lListItems=lWidgetComplet.find('ul.liste-clickable');} else{lListItems=lWidgetComplet.find('ul');}
lListItems.find(' > li:gt('+(aWidget.nbrItemsVisible-1)+')').addClass('more masked').attr('tabindex',-1);$('.btn-collapse',lWidgetComplet).eventValidation(function(){const lIconBt=$(this).find('span.icon');const more=lListItems.find('li.more');lIconBt.hasClass('icon_eye_close')?lIconBt.toggleClass('icon_eye_close icon_eye_open'):lIconBt.toggleClass('icon_eye_open icon_eye_close');let lAriaLabelBouton;if(more.hasClass('masked')){lAriaLabelBouton=GTraductions.getValeur('accueil.hintCacherElements');more.toggleClass('masked unmasked').attr('tabindex',0);more.attr('aria-hidden',false);if(more[0]){more[0].focus();}
$(this).find('span.counter').text('-');} else{lAriaLabelBouton=GTraductions.getValeur('accueil.hintAfficherElements');more.toggleClass('unmasked masked').attr('tabindex',-1);more.attr('aria-hidden',true);$(this).find('span.counter').text('+');}
$(this).attr('aria-label',lAriaLabelBouton);});}};UtilitaireWidget._getNbrElementsNonVisibles=function(aWidget){let lNbrElements=0;const lListes=[];for(let i=0,j= -1,lNbr=aWidget.liste.GetNbrElements();i<lNbr;i++){if(aWidget.liste.GetElement(i).estUnDeploiement){j++;lListes[j]=new ObjetListeElements();continue;}
lListes[j].add(aWidget.liste.GetElement(i));}
for(let i=0,lNbr=lListes.length;i<lNbr;i++){if(lListes[i].GetNbrElements()>aWidget.nbrItemsVisible){lNbrElements=lNbrElements+(lListes[i].GetNbrElements()-aWidget.nbrItemsVisible);}}
return lNbrElements;};UtilitaireWidget._avecCompteur=function(aWidget){return MethodesTableau.existe(aWidget.nomDonnees,['discussions'])?true:false;};module.exports=UtilitaireWidget;},fn:"utilitairewidget.js"});;
IE.fModule({f:function(exports,require,module,global){const EGenreLienDS={tGL_Devoir:0,tGL_Evaluation:1};module.exports=EGenreLienDS;},fn:"enumere_liends.js"});;
IE.fModule({f:function(exports,require,module,global){const TypeGenreReponseInternetActualite={AvecAR:0,Textuelle:1,ChoixUnique:2,ChoixMultiple:3,SansAR:4,SansReponse:5};module.exports.TypeGenreReponseInternetActualite=TypeGenreReponseInternetActualite;},fn:"typegenrereponseinternetactualite.js"});;
IE.fModule({f:function(exports,require,module,global){const MethodesObjet=require('MethodesObjet.js');const{GDate}=require('ObjetDate.js');const ObjetElement=require('ObjetElement.js');const ObjetListeElements=require('ObjetListeElements.js');const GTraductions=require('ObjetTraduction.js');const ObjetTri=require('ObjetTri.js');function TUtilitaireListePeriodes(){}(function(){TUtilitaireListePeriodes.choix={aujourdhui:1,hier:1,demain:1,semaineCourante:1,semainePrecedente:1,semaineSuivante:1,moisCourant:1,periodes:1,annee:1,mois:1};MethodesObjet.indenterEnumere(TUtilitaireListePeriodes.choix);TUtilitaireListePeriodes.construireListePeriodes=function(aChoixPeriodes,aOptions){const lListe=new ObjetListeElements(),lOptions=$.extend({dateDebut:GParametres.PremiereDate,dateFin:GParametres.DerniereDate,dansBornes:function(aDate){return(aDate>this.dateDebut||GDate.estJourEgal(aDate,this.dateDebut))&&(aDate<this.dateFin||GDate.estJourEgal(aDate,this.dateFin));},datesOK:function(aDateDebut,aDateFin){return this.dansBornes(aDateDebut)||this.dansBornes(aDateFin);},borner:function(aDate){if(aDate<this.dateDebut){return new Date(this.dateDebut.getTime());}
if(aDate>this.dateFin){return new Date(this.dateFin.getTime());}
return aDate;}},aOptions);if(MethodesObjet.isArray(aChoixPeriodes)){for(let i=0;i<aChoixPeriodes.length;i++){_ajouterChoix(lListe,aChoixPeriodes[i],lOptions);}}
return lListe;};function _ajouterChoix(aListe,aChoix,aOptions){let lElement=null;let lDate;let lDateDebut;let lDateFin;let lCycle;function _ajouterElement(aLibelle,aDateDebut,aDateFin){const lElement=new ObjetElement(aLibelle);lElement.dates={debut:aOptions.borner(aDateDebut),fin:aOptions.borner(aDateFin)};lElement.choix=aChoix;aListe.AddElement(lElement);}
switch(aChoix){case TUtilitaireListePeriodes.choix.aujourdhui:_ajouterElement(GTraductions.getValeur('Aujourdhui').ucfirst(),GDate.getDateCourante(),GDate.getDateCourante());break;case TUtilitaireListePeriodes.choix.hier:lDate=GDate.GetJourSuivant(GDate.getDateCourante(),-1);if(aOptions.datesOK(lDate,lDate)){_ajouterElement(GTraductions.getValeur('Hier').ucfirst(),lDate,lDate);}
break;case TUtilitaireListePeriodes.choix.demain:lDate=GDate.GetJourSuivant(GDate.getDateCourante(),1);if(aOptions.datesOK(lDate,lDate)){_ajouterElement(GTraductions.getValeur('Demain').ucfirst(),lDate,lDate);}
break;case TUtilitaireListePeriodes.choix.semaineCourante:lCycle=IE.Cycles.cycleCourant();lDateDebut=IE.Cycles.dateDebutCycle(lCycle);lDateFin=IE.Cycles.dateFinCycle(lCycle);if(aOptions.datesOK(lDateDebut,lDateFin)){_ajouterElement(GTraductions.getValeur('SemaineEnCours'),lDateDebut,lDateFin);}
break;case TUtilitaireListePeriodes.choix.semainePrecedente:lCycle=IE.Cycles.cycleCourant()-1;if(IE.Cycles.cycleDansAnnee(lCycle)!==lCycle){return;}
lDateDebut=IE.Cycles.dateDebutCycle(lCycle);lDateFin=IE.Cycles.dateFinCycle(lCycle);if(aOptions.datesOK(lDateDebut,lDateFin)){_ajouterElement(GTraductions.getValeur('SemainePrecedente'),lDateDebut,lDateFin);}
break;case TUtilitaireListePeriodes.choix.semaineSuivante:lCycle=IE.Cycles.cycleCourant()+1;if(IE.Cycles.cycleDansAnnee(lCycle)!==lCycle){return;}
lDateDebut=IE.Cycles.dateDebutCycle(lCycle);lDateFin=IE.Cycles.dateFinCycle(lCycle);if(aOptions.datesOK(lDateDebut,lDateFin)){_ajouterElement(GTraductions.getValeur('SemaineSuivante'),lDateDebut,lDateFin);}
break;case TUtilitaireListePeriodes.choix.moisCourant:lDate=GDate.getDateCourante();lDateDebut=GDate.GetPremierJourDuMois(lDate.getFullYear(),lDate.getMonth());lDateFin=GDate.GetDernierJourDuMois(lDate.getFullYear(),lDate.getMonth());if(aOptions.datesOK(lDateDebut,lDateFin)){_ajouterElement(GTraductions.getValeur('MoisEnCours'),lDateDebut,lDateFin);}
break;case TUtilitaireListePeriodes.choix.periodes:{const lListePeriodesSaisie=new ObjetListeElements();GParametres.listePeriodes.parcourir(function(D){if(D.GetGenre()>0&&D.GetGenre()!==3&&(aOptions.datesOK(D.dates.debut,D.dates.fin))){lElement=MethodesObjet.dupliquer(D);lElement.choix=aChoix;lElement.dates.debut=aOptions.borner(D.dates.debut);lElement.dates.fin=aOptions.borner(D.dates.fin);lListePeriodesSaisie.AddElement(lElement);}});lListePeriodesSaisie.setTri([ObjetTri.init(function(D){return D.GetGenre()===3?0:1;}),ObjetTri.init(function(D){return D.GetGenre();})]);lListePeriodesSaisie.trier();aListe.FusionnerListe(lListePeriodesSaisie);break;}
case TUtilitaireListePeriodes.choix.annee:GParametres.listePeriodes.parcourir(function(D){if(D.GetGenre()===3){lElement=MethodesObjet.dupliquer(D);lElement.SetLibelle(GTraductions.getValeur('AnneeComplete'));lElement.choix=aChoix;lElement.dates.debut=aOptions.borner(D.dates.debut);lElement.dates.fin=aOptions.borner(D.dates.fin);aListe.AddElement(lElement);return false;}});break;case TUtilitaireListePeriodes.choix.mois:GDate.getListeMoisAPartirDeDate(aOptions.dateDebut,aOptions.dateFin).parcourir(function(D){_ajouterElement(D.GetLibelle(),D.dateDebut,D.dateFin);});break;default:;}}})();module.exports=TUtilitaireListePeriodes;},fn:"utilitairelisteperiodes.js"});;
IE.fModule({f:function(exports,require,module,global){const{TypeDroits}=require('ObjetDroitsPN.js');const MethodesObjet=require('MethodesObjet.js');const MethodesTableau=require('MethodesTableau.js');const GChaine=require('GChaine.js');const GStyle=require('GStyle.js');const EGenreEtat=require('Enumere_Etat.js');const EGenreTriElement=require('Enumere_TriElement.js');const{GDate}=require('ObjetDate.js');const ObjetElement=require('ObjetElement.js');const ObjetListeElements=require('ObjetListeElements.js');const GTraductions=require('ObjetTraduction.js');const ObjetTri=require('ObjetTri.js');const{GObjetWAI,EGenreAttribut}=require('ObjetWAI.js');const TypeDomaine=require('TypeDomaine.js');const TypeEnsembleNombre=require('TypeEnsembleNombre.js');const EGenreEspace=require('Enumere_Espace.js');const EGenreRessource=require('Enumere_Ressource.js');const TypeGenreReponseInternetActualite=require('TypeGenreReponseInternetActualite.js').TypeGenreReponseInternetActualite;const TUtilitaireListePeriodes=require('UtilitaireListePeriodes.js');require('produit/css/InfoSondage.css');function TUtilitaireInformations(){}
TUtilitaireInformations.creerActualiteDiffusionDesResultatsSondage=function(aSondage,aListeCategories,aListePiecesJointesResultats){var lCategorieParDefaut=null;if(!!aListeCategories){aListeCategories.parcourir(function(D){if(!!D&&D.estDefaut){lCategorieParDefaut=D;return false;}});if(!lCategorieParDefaut){lCategorieParDefaut=aListeCategories.GetPremierElement();}}
var lNouvelleActualite=TUtilitaireInformations.initialiserNouveauItem({categorie:lCategorieParDefaut});lNouvelleActualite.SetLibelle(GTraductions.getValeur('actualites.Edition.TitreDiffusionResultatsDuSondage',[(aSondage.GetLibelle()||'')]));lNouvelleActualite.publie=true;lNouvelleActualite.estUneDiffusionDeResultatsSondage=true;var lStrTypeSondage=(aSondage.reponseAnonyme?GTraductions.getValeur('actualites.Anonyme'):GTraductions.getValeur('actualites.Nominatif'));var lMessageNouvelleInformation=GTraductions.getValeur('actualites.Edition.MessageDiffusionResultatsDuSondage',[lStrTypeSondage.toLowerCase(),(aSondage.GetLibelle()||'')]);var lPremiereQuestion=lNouvelleActualite.listeQuestions.GetPremierElement();lPremiereQuestion.texte=lMessageNouvelleInformation;if(!lPremiereQuestion.listePiecesJointes){lPremiereQuestion.listePiecesJointes=new ObjetListeElements();}
aListePiecesJointesResultats.parcourir(function(D){lPremiereQuestion.listePiecesJointes.AddElement(D);});return lNouvelleActualite;};TUtilitaireInformations.getListePiecesJointesDActualite=function(aActualite){var lListePiecesJointes=new ObjetListeElements();if(!!aActualite&&!!aActualite.listeQuestions){aActualite.listeQuestions.parcourir(function(aQuestion){if(!!aQuestion&&!!aQuestion.listePiecesJointes){aQuestion.listePiecesJointes.parcourir(function(aPJQuestion){lListePiecesJointes.AddElement(aPJQuestion);});}});}
return lListePiecesJointes;};function _calculeDateFinSondage(aDate){var i=0;var lDate=new Date(aDate.getTime());do{lDate=GDate.GetJourSuivant(lDate);if(!GParametres.JoursFeries.GetValeur(GDate.getNbrJoursEntreDeuxDates(IE.Cycles.dateDebutPremierCycle(),aDate)+1)&&GDate.estUnJourOuvre(lDate)){i++;}} while(i<15&&lDate<GDate.derniereDate);return lDate;}
TUtilitaireInformations.appliquerModeleSurExistant=function(aParam){const lModele=aParam.modele;var lInfoSond=aParam.infoSond;if(lInfoSond===null||lInfoSond===undefined){return null;}
if(lModele===null||lModele===undefined){return lInfoSond;}
if(lInfoSond.estVerrouille){return lInfoSond;}
if(lModele.estModele!==true){}
if((lInfoSond.estInformation!==lModele.estInformation)||(lInfoSond.estSondage!==lModele.estSondage)){return lInfoSond;}
lInfoSond.SetLibelle(lModele.GetLibelle());lInfoSond.categorie=lModele.categorie;lInfoSond.estModele=false;if(lModele.listeQuestions){lInfoSond.listeQuestions=_copierQuestions.call(this,lModele.listeQuestions);}
lInfoSond.reponseAnonyme=lModele.reponseAnonyme;return lInfoSond;};TUtilitaireInformations.initialiserNouveauItem=function(aParam){var lInformation=aParam.actualite?new ObjetElement(GTraductions.getValeur('actualites.Edition.CopieDe',[aParam.actualite.GetLibelle()])):new ObjetElement('');var lGenreReponse=aParam.genreReponse?aParam.genreReponse:TypeGenreReponseInternetActualite.AvecAR;var lForcerAR=GApplication.droits.get(TypeDroits.fonctionnalites.forcerARInfos);if((lGenreReponse===TypeGenreReponseInternetActualite.SansAR)&&lForcerAR===true){lGenreReponse=TypeGenreReponseInternetActualite.AvecAR;}
lInformation.categorie=!aParam.categorie?!aParam.actualite?GEtatUtilisateur.listeCategories.GetElement(this.indiceCategorieParDefaut):aParam.actualite.categorie:aParam.categorie;lInformation.auteur=GEtatUtilisateur.getUtilisateur().GetLibelle();lInformation.reponseAnonyme=false;lInformation.estInformation=MethodesTableau.existe(lGenreReponse,[TypeGenreReponseInternetActualite.AvecAR,TypeGenreReponseInternetActualite.SansAR]);lInformation.estSondage=!lInformation.estInformation;lInformation.date='';lInformation.publie=(aParam.publie!==null)&&(aParam.publie!==undefined)?aParam.publie:(aParam.actualite?false:true);lInformation.estModele=(aParam.estModele===true);var lDateDebut=GDate.getDateCourante();var lDateFin=lInformation.estInformation?GDate.derniereDate:_calculeDateFinSondage(lDateDebut);lInformation.dateDebut=aParam.actualite&&aParam.actualite.dateDebut?aParam.actualite.dateDebut:lDateDebut;lInformation.dateFin=aParam.actualite?aParam.actualite.dateFin:lDateFin;lInformation.avecReponse=TUtilitaireInformations.avecReponse;lInformation.aToutRepondu=TUtilitaireInformations.aToutRepondu;lInformation.lue=false;lInformation.public=new ObjetElement('');lInformation.genrePublic= -1;lInformation.visible=true;if(aParam.actualite&&aParam.actualite.listeQuestions){lInformation.listeQuestions=_copierQuestions.call(this,aParam.actualite.listeQuestions);} else{lInformation.listeQuestions=new ObjetListeElements();lInformation.listeQuestions.AddElement(TUtilitaireInformations.creerQuestionOuTexteSondage({genreReponse:lGenreReponse}));}
lInformation.estVerrouille=false;lInformation.nombreDestinataire=aParam.actualite?aParam.actualite.nombreDestinataire:0;lInformation.nomDestinataire=aParam.actualite?aParam.actualite.nomDestinataire:GTraductions.getValeur('actualites.Aucun');lInformation.detailPublic=aParam.actualite?aParam.actualite.detailPublic:GTraductions.getValeur('actualites.AucunDestinataire');lInformation.avecModificationPublic=aParam.actualite||aParam.listePublic?true:false;lInformation.avecElevesRattaches=false;lInformation.genresPublicEntite=aParam.actualite?MethodesObjet.dupliquer(aParam.actualite.genresPublicEntite):new TypeEnsembleNombre();lInformation.listePublicEntite=aParam.actualite?MethodesObjet.dupliquer(aParam.actualite.listePublicEntite):new ObjetListeElements();if(aParam.listePublic&&aParam.genresPublic){lInformation.listePublicEntite=new ObjetListeElements();lInformation.listePublicIndividu=new ObjetListeElements();if(aParam.genresPublic.length>0){if(($.inArray(EGenreRessource.Classe,this.getGenresRessourceAffDestinataire())>-1)||($.inArray(EGenreRessource.Groupe,this.getGenresRessourceAffDestinataire())>-1)){lInformation.listePublicEntite=aParam.listePublic;} else{lInformation.listePublicIndividu=aParam.listePublic;}}} else{lInformation.listePublicEntite=aParam.actualite?MethodesObjet.dupliquer(aParam.actualite.listePublicEntite):new ObjetListeElements();lInformation.listePublicIndividu=aParam.actualite?MethodesObjet.dupliquer(aParam.actualite.listePublicIndividu):new ObjetListeElements();}
lInformation.getDate=TUtilitaireInformations.getDate.bind(lInformation);return lInformation;};TUtilitaireInformations.creerQuestionOuTexteSondage=function(aParams){var lParams=aParams||{};var lRang=lParams.rang?lParams.rang:1;var lGenreReponse=(!lParams.genreReponse||((lParams.genreReponse===TypeGenreReponseInternetActualite.SansAR)&&GApplication.droits.get(TypeDroits.fonctionnalites.forcerARInfos)))?TypeGenreReponseInternetActualite.AvecAR:lParams.genreReponse;var lRangElement=lParams.rangElement?lParams.rangElement:lRang;var lLibelle;if(!!aParams.genreReponse&&aParams.genreReponse===TypeGenreReponseInternetActualite.SansReponse){lLibelle=GTraductions.getValeur('actualites.Edition.TexteN',[lRangElement]);} else{lLibelle=GTraductions.getValeur('actualites.Edition.QuestionN',[lRangElement]);}
var lResult=new ObjetElement(lLibelle);lResult.rang=lRang;lResult.indice=lRangElement;lResult.genreReponse=lGenreReponse;lResult.texte='';lResult.titre='';lResult.tailleReponse=200;lResult.listePiecesJointes=new ObjetListeElements();lResult.listeChoix=new ObjetListeElements();lResult.reponse=new ObjetElement();if(lGenreReponse===TypeGenreReponseInternetActualite.Textuelle){lResult.reponse.valeurReponse='';} else if(MethodesTableau.existe(lGenreReponse,[TypeGenreReponseInternetActualite.ChoixMultiple,TypeGenreReponseInternetActualite.ChoixUnique])){lResult.reponse.valeurReponse=new TypeDomaine();}
lResult.reponse.avecReponse=false;return lResult;};TUtilitaireInformations.getDate=function(){return GTraductions.getValeur('Du')+GDate.FormatDate(this.dateDebut,' %JJ/%MM/%AAAA ')+GTraductions.getValeur('Au')+GDate.FormatDate(this.dateFin,' %JJ/%MM/%AAAA');};TUtilitaireInformations.avecReponse=function(){var lResult=false;for(var i=0;i<this.listeQuestions.GetNbrElements()&&!lResult;i++){var lQuestion=this.listeQuestions.GetElement(i);lResult=lQuestion.reponse.avecReponse||(lQuestion.genreReponse===TypeGenreReponseInternetActualite.SansAR);}
return lResult;};TUtilitaireInformations.aToutRepondu=function(){var lResult=true;for(var i=0;i<this.listeQuestions.GetNbrElements()&&lResult;i++){var lQuestion=this.listeQuestions.GetElement(i);lResult=lQuestion.reponse.avecReponse||(MethodesTableau.existe(lQuestion.genreReponse,[TypeGenreReponseInternetActualite.SansAR,TypeGenreReponseInternetActualite.SansReponse]));}
return lResult;};function _copierQuestions(aListeQuestions){var lResult=new ObjetListeElements();for(var i=0;i<aListeQuestions.GetNbrElements();i++){if(aListeQuestions.Existe(i)){var lElement=_copieQuestion(aListeQuestions.GetElement(i));lElement.SetEtat(EGenreEtat.Creation);lResult.AddElement(lElement);}}
return lResult;}
function _copieQuestion(aQuestion){var lNouvelleQuestion=TUtilitaireInformations.creerQuestionOuTexteSondage(aQuestion);lNouvelleQuestion.SetLibelle(aQuestion.GetLibelle());lNouvelleQuestion.rang=aQuestion.rang;lNouvelleQuestion.indice=aQuestion.indice;lNouvelleQuestion.genreReponse=aQuestion.genreReponse;lNouvelleQuestion.texte=aQuestion.texte;lNouvelleQuestion.tailleReponse=aQuestion.tailleReponse;lNouvelleQuestion.listePiecesJointes=_copierDocuments(aQuestion.listePiecesJointes);lNouvelleQuestion.listeChoix=_copierChoixReponses(aQuestion.listeChoix);lNouvelleQuestion.avecMaximum=aQuestion.avecMaximum;lNouvelleQuestion.titre=aQuestion.titre;return lNouvelleQuestion;}
function _copierDocuments(aListeDocuments){var lResult=MethodesObjet.dupliquer(aListeDocuments);for(var i=0;i<lResult.GetNbrElements();i++){if(lResult.Existe(i)){var lElement=lResult.GetElement(i);lElement.SetEtat(EGenreEtat.Creation);}}
return lResult;}
function _copierChoixReponses(aListeChoix){var lResult=new ObjetListeElements();for(var i=0;i<aListeChoix.GetNbrElements();i++){if(aListeChoix.Existe(i)){var lElement=aListeChoix.GetElement(i);var lChoix=new ObjetElement(lElement.GetLibelle());lChoix.rang=lElement.rang;lChoix.SetEtat(EGenreEtat.Creation);if(lElement.estReponseLibre!==null&&lElement.estReponseLibre!==undefined){lChoix.estReponseLibre=lElement.estReponseLibre;}
lResult.AddElement(lChoix);}}
return lResult;}
TUtilitaireInformations.getIDReponse=function(aParams){return aParams.instance.Nom+'_reponse_'+aParams.indice;};TUtilitaireInformations.composeReponse=function(aParams){var H=[];if(aParams.avecLibelleQuestion){H.push('<div class="Actu_Question" style="padding: 2px 0px;">',(aParams.question.genreReponse!==TypeGenreReponseInternetActualite.SansReponse)?aParams.question.GetLibelle():'','</div>');}
var lIdReponse=TUtilitaireInformations.getIDReponse(aParams);if(aParams.question.genreReponse===TypeGenreReponseInternetActualite.ChoixMultiple&&aParams.question.avecMaximum){H.push('<div style="padding: 2px 0px 1px 0px;">',GTraductions.getValeur('actualites.Edition.NbrMaxChoix',[aParams.question.nombreReponsesMax]),'</div>');}
H.push('<div id="titre_',lIdReponse,'" class="AvecSelectionTexte" style="padding: 2px 0px 1px 0px;">',aParams.question.texte,'</div>');H.push('<div id="',lIdReponse,'" class="PetitEspaceBas">');var lSurKeyUp='';var lSurSaisie='';switch(aParams.question.genreReponse){case TypeGenreReponseInternetActualite.AvecAR:lSurKeyUp=aParams.instance.Nom+'.surKeyUpReponse ('+aParams.indice+');';lSurSaisie=aParams.instance.Nom+'.surSaisieReponse('+aParams.indice+');';H.push('<div class="Actu_AR">');if(aParams.question.reponse.estRepondant===false){H.push(GTraductions.getValeur('actualites.XAPrisConnaissanceLeX',[aParams.question.reponse.strRepondant,GDate.FormatDate(aParams.question.reponse.reponduLe,'%JJ/%MM/%AAAA')]));} else{H.push('<ie-checkbox tabindex="-1" id="',lIdReponse,'_0" class="',this._classActualiteSaisieDirect,'" ',GObjetWAI.composeAttribut({genre:EGenreAttribut.label,valeur:GTraductions.getValeur('accueil.prisConnaissance')}),'onclick="',lSurSaisie,'"','onkeyup=" ',lSurKeyUp,'"',(aParams.question.reponse.avecReponse?' checked="checked" disabled':(aParams.estAffEditionActualite?' disabled':'')),'><label class="EspaceGauche" for="',lIdReponse,'">',GTraductions.getValeur('accueil.prisConnaissance'),'</label></ie-checkbox>');}
H.push('</div>');break;case TypeGenreReponseInternetActualite.Textuelle:lSurSaisie=aParams.instance.Nom+'.surSaisieReponse ('+aParams.indice+',value);';H.push('<div style="padding:1px 1px;"><textarea maxlength="0" tabindex="-1" id="',lIdReponse,'_0" class="Texte10" style="width: 100%; overflow : hidden; ',GStyle.composeCouleurBordure(GCouleur.grisClair),'" rows="3" ',GObjetWAI.composeAttribut({genre:EGenreAttribut.label,valeur:GTraductions.getValeur('accueil.saisirReponse')}),'onkeyup="',lSurSaisie,'" maxlength="'+aParams.question.tailleReponse+'" placeholder="',GTraductions.getValeur('actualites.SaisirReponse'),'"',(aParams.estAffEditionActualite?' disabled':''),'>',aParams.question.reponse.valeurReponse,'</textarea></div>');break;case TypeGenreReponseInternetActualite.ChoixUnique:case TypeGenreReponseInternetActualite.ChoixMultiple:var lNombreCoche=aParams.question&&aParams.question.reponse&&aParams.question.reponse.valeurReponse?aParams.question.reponse.valeurReponse.GetNbrValeurs():0;for(var I=0;I<aParams.question.listeChoix.GetNbrElements();I++){var lNr=I+1;var lValeurReponse=aParams.question.reponse&&aParams.question.reponse.valeurReponse?aParams.question.reponse.valeurReponse.GetValeur(lNr):undefined;var lDisabled=false;if(aParams.question.genreReponse===TypeGenreReponseInternetActualite.ChoixMultiple&&aParams.question.avecMaximum&&(lNombreCoche>=aParams.question.nombreReponsesMax)){lDisabled=!lValeurReponse;}
var ieInput=(aParams.question.genreReponse===TypeGenreReponseInternetActualite.ChoixMultiple?'ie-checkbox':'ie-radio');lSurSaisie=aParams.instance.Nom+'.surSaisieReponse ('+aParams.indice+', value, checked);';H.push('<div class="Actu_InfoCoche NoWrap" ><',ieInput,' class="InlineBlock AlignementMilieuVertical" id="',lIdReponse,'_',I,'" name="coches_',lIdReponse,'" ',GObjetWAI.composeAttribut({genre:EGenreAttribut.label,valeur:aParams.question.listeChoix.GetLibelle(I)}),'onclick="',lSurSaisie,'" value="',lNr,'"'+(lValeurReponse?' checked="checked"':'')+(aParams.estAffEditionActualite||lDisabled?' disabled':'')+' ></',ieInput,'><label class="EspaceGauche InlineBlock AlignementMilieuVertical" for="',lIdReponse,'_',I,'">'+aParams.question.listeChoix.GetLibelle(I)+'</label></div>');}
break;default:break;}
H.push('</div>');if(aParams.question.listePiecesJointes&&aParams.question.listePiecesJointes.GetNbrElements()>0){H.push('<div class="PetitEspace">',TUtilitaireInformations.composeDocuments(aParams.question.listePiecesJointes),'</div>');}
return H.join('');};TUtilitaireInformations.composeDocuments=function(aListeDocumentsJoints){var lHtml=[];for(var I=0;I<aListeDocumentsJoints.GetNbrElements();I++){var lDocumentJoint=aListeDocumentsJoints.GetElement(I);lHtml.push(GChaine.composerUrlLienExterne({documentJoint:lDocumentJoint,genreRessource:EGenreRessource.DocJointEtablissement}));}
return lHtml.join('<br/>');};TUtilitaireInformations.initListePeriodes=function(){return TUtilitaireListePeriodes.construireListePeriodes([TUtilitaireListePeriodes.choix.aujourdhui,TUtilitaireListePeriodes.choix.semaineCourante,TUtilitaireListePeriodes.choix.moisCourant,TUtilitaireListePeriodes.choix.annee,TUtilitaireListePeriodes.choix.periodes,TUtilitaireListePeriodes.choix.mois]);};TUtilitaireInformations.avecCumul=function(aListe){if(MethodesTableau.existe(GEtatUtilisateur.GenreEspace,[EGenreEspace.Parent,EGenreEspace.Mobile_Parent,EGenreEspace.Entreprise])){if(GEtatUtilisateur.Identification.ListeRessources.GetNbrElements()>1){return true;} else{var lGenre=(GEtatUtilisateur.GenreEspace===EGenreEspace.Entreprise)?EGenreRessource.MaitreDeStage:EGenreRessource.Responsable;return(aListe.getIndiceElementParFiltre(function(aElement){return(aElement.public.GetNumero()===GEtatUtilisateur.getUtilisateur().GetNumero())&&(aElement.public.GetNumero()===lGenre);})>-1);}} else{return false;}};TUtilitaireInformations.avecInfoPublic=function(aActualite){if(MethodesTableau.existe(GEtatUtilisateur.GenreEspace,[EGenreEspace.Parent,EGenreEspace.Mobile_Parent,EGenreEspace.Entreprise,EGenreEspace.PrimParent,EGenreEspace.Mobile_PrimParent])){var lGenre=(GEtatUtilisateur.GenreEspace===EGenreEspace.Entreprise)?EGenreRessource.MaitreDeStage:EGenreRessource.Responsable;var lEstActuDUtilisateur=(aActualite.public.GetNumero()===GEtatUtilisateur.getUtilisateur().GetNumero())&&(aActualite.public.GetGenre()===lGenre);return!lEstActuDUtilisateur;} else{return false;}};TUtilitaireInformations.formaterListePourCumul=function(aListe){for(var I=0;I<aListe.GetNbrElements();I++){var lElement=aListe.GetElement(I);if(lElement.public){var lCumulPere=aListe.GetElementParNumeroEtGenre(lElement.public.GetNumero(),lElement.public.GetGenre());if(!lCumulPere){var lGenre=(GEtatUtilisateur.GenreEspace===EGenreEspace.Entreprise)?EGenreRessource.MaitreDeStage:EGenreRessource.Responsable;var lATitreIndividuel=(lElement.public.GetNumero()===GEtatUtilisateur.getUtilisateur().GetNumero())&&(lElement.public.GetGenre()===lGenre);var lLibelle=lATitreIndividuel?GTraductions.getValeur('actualites.ATitreIndividuel'):GTraductions.getValeur('actualites.AProposDe',[lElement.public.prenom&&(GEtatUtilisateur.GenreEspace!==EGenreEspace.Entreprise)?lElement.public.prenom:lElement.public.GetLibelle()]);lCumulPere=new ObjetElement(lLibelle,lElement.public.GetNumero(),lElement.public.GetGenre());lCumulPere.estUnDeploiement=true;lCumulPere.estDeploye=true;lCumulPere.aTitreIndividuel=lATitreIndividuel;aListe.AddElement(lCumulPere);}
lElement.pere=lCumulPere;}}
aListe.setTri(ObjetTri.initRecursif('pere',[
ObjetTri.init('aTitreIndividuel'),ObjetTri.init(function(D){return D.estUnDeploiement?D.GetLibelle():D.pere.GetLibelle();}),ObjetTri.init(function(D){return D.dateDebut;},EGenreTriElement.Decroissant),ObjetTri.init(function(D){return D.dateFin;}),ObjetTri.init('Libelle'),ObjetTri.init('Numero')
]));aListe.trier();};module.exports=TUtilitaireInformations;},fn:"utilitaireinformations.js"});;
IE.fModule({f:function(exports,require,module,global){const TypeEtatPublication={Publiee:0,PublieeFutur:1,PublieePasse:2,Brouillon:3};module.exports.TypeEtatPublication=TypeEtatPublication;const TypeItemEnum={IE_Reception:0,IE_Diffusion_Tout:1,IE_Diffusion_Publiee:2,IE_Diffusion_PublieeFutur:3,IE_Diffusion_PublieePasse:4,IE_Brouillon:5,IE_Modele_Sondage:6,IE_Modele_Info:7};module.exports.TypeItemEnum=TypeItemEnum;const TypeModeAff={MA_Reception:0,MA_Diffusion:1,MA_Brouillon:2,MA_Modele:3};module.exports.TypeModeAff=TypeModeAff;const GTraductions=require('ObjetTraduction.js');const TypeItemEnumUtil={getStr(aItem){switch(aItem){case TypeItemEnum.IE_Reception:return GTraductions.getValeur('infoSond.recus');case TypeItemEnum.IE_Diffusion_Tout:return GTraductions.getValeur('infoSond.diffuses');case TypeItemEnum.IE_Diffusion_Publiee:return GTraductions.getValeur('infoSond.enCours');case TypeItemEnum.IE_Diffusion_PublieeFutur:return GTraductions.getValeur('infoSond.aVenir');case TypeItemEnum.IE_Diffusion_PublieePasse:return GTraductions.getValeur('infoSond.passes');case TypeItemEnum.IE_Brouillon:return GTraductions.getValeur('infoSond.brouillons');case TypeItemEnum.IE_Modele_Sondage:return GTraductions.getValeur('infoSond.modelesSondage');case TypeItemEnum.IE_Modele_Info:return GTraductions.getValeur('infoSond.modelesInfo');default:return'';}},getIcon(aItem){switch(aItem){case TypeItemEnum.IE_Reception:return'icon_inbox';case TypeItemEnum.IE_Diffusion_Tout:return'icon_envoyer';case TypeItemEnum.IE_Diffusion_Publiee:return'icon_info_sondage_publier mix-icon_ok';case TypeItemEnum.IE_Diffusion_PublieeFutur:return'icon_info_sondage_publier mix-icon_edt_permanence';case TypeItemEnum.IE_Diffusion_PublieePasse:return'icon_info_sondage_publier';case TypeItemEnum.IE_Brouillon:return'icon_brouillon_discussion';case TypeItemEnum.IE_Modele_Sondage:return'icon_diffuser_sondage';case TypeItemEnum.IE_Modele_Info:return'icon_diffuser_information';default:return'';}},getTypeModeAffDeTypeItemEnum(aItem){switch(aItem){case TypeItemEnum.IE_Reception:return TypeModeAff.MA_Reception;case TypeItemEnum.IE_Diffusion_Tout:case TypeItemEnum.IE_Diffusion_PublieePasse:case TypeItemEnum.IE_Diffusion_Publiee:case TypeItemEnum.IE_Diffusion_PublieeFutur:return TypeModeAff.MA_Diffusion;case TypeItemEnum.IE_Brouillon:return TypeModeAff.MA_Brouillon;case TypeItemEnum.IE_Modele_Sondage:case TypeItemEnum.IE_Modele_Info:return TypeModeAff.MA_Modele;default:return null;}}};module.exports.TypeItemEnumUtil=TypeItemEnumUtil;},fn:"typeetatpublication.js"});;
IE.fModule({f:function(exports,require,module,global){const{GDate}=require('ObjetDate.js');const GTraductions=require('ObjetTraduction.js');function TUtilitaireInfoSondage(){}
TUtilitaireInfoSondage.getDate=function(){return GTraductions.getValeur('Du')+GDate.FormatDate(this.dateDebut,' %JJ/%MM/%AAAA ')+GTraductions.getValeur('Au')+GDate.FormatDate(this.dateFin,' %JJ/%MM/%AAAA');};TUtilitaireInfoSondage.avecReponse=function(){let lResult=false;for(let i=0;i<this.listeQuestions.GetNbrElements()&&!lResult;i++){const lQuestion=this.listeQuestions.GetElement(i);lResult=lQuestion.reponse.avecReponse||!lQuestion.reponse.estReponseAttendue;}
return lResult;};TUtilitaireInfoSondage.aToutRepondu=function(){let lResult=true;for(let i=0;i<this.listeQuestions.GetNbrElements()&&lResult;i++){const lQuestion=this.listeQuestions.GetElement(i);lResult=lQuestion.reponse.avecReponse||!lQuestion.reponse.estReponseAttendue;}
return lResult;};module.exports=TUtilitaireInfoSondage;},fn:"utilitaireinfosondage.js"});;
IE.fModule({f:function(exports,require,module,global){const EGenreEvntActu={SurAR:1,SurValidationSondage:2,SurMenuCtxActu:3,SurValidationModif:4,SurCreationActu:5,SurValidationDirecte:6,SurDiffusionResultats:7,SurSelectionInfoSondage:8,SurAnnulationSondage:9,SurVoirResultats:10,SurMarquerVuSansAR:11};EGenreEvntActu.estEvntSaisieReponse=function(aGenreEvntActu){switch(aGenreEvntActu){case EGenreEvntActu.SurValidationSondage:case EGenreEvntActu.SurAR:case EGenreEvntActu.SurValidationDirecte:return true;default:return false;}};module.exports=EGenreEvntActu;},fn:"egenreevntactu.js"});;
IE.fModule({f:function(exports,require,module,global){const EGenreBoiteMessage=require('Enumere_BoiteMessage.js');const GTraductions=require('ObjetTraduction.js');const Toast=require('Toast.js').Toast;const ETypeToast=require('Toast.js').ETypeToast;class MoteurDestinataires{constructor(aParam){this.utilitaires={genreEspace:aParam.genreEspace};}
controlerSurValidation(aParam){const lDonnee=aParam.donnee;const lNbPublicEntite=lDonnee.listePublicEntite.GetNbrElementsExistes();const lNbGenreEntite=lDonnee.genresPublicEntite.count();const lAvecIndividus=lDonnee.listePublicIndividu.GetNbrElementsExistes()>0||(this.utilitaires.genreEspace.estPourPrimaire()&&!!lDonnee.avecDirecteur);let lMessagePbDestinataires=null;if(lDonnee.publicationPageEtablissement!==true){if(lNbGenreEntite>0&&lNbPublicEntite===0){lMessagePbDestinataires=GTraductions.getValeur('actualites.MsgSelectionnerUneClasseGroupe');} else if(lNbGenreEntite===0&&lNbPublicEntite>0){lMessagePbDestinataires=GTraductions.getValeur('actualites.MsgSelectionnerUneEntite');} else if(lNbPublicEntite===0&&!lAvecIndividus){lMessagePbDestinataires=GTraductions.getValeur('actualites.MsgAucunUnDestinataire');}}
if(lMessagePbDestinataires!==null){if(IE.estMobile){Toast.afficher({msg:lMessagePbDestinataires,type:ETypeToast.info,dureeAffichage:4500});} else{GApplication.getMessage().afficher({type:EGenreBoiteMessage.Information,message:lMessagePbDestinataires});}
return false;} else{return true;}}
avecDestinataires(aParam){const lDonnee=aParam.donnee;return((lDonnee.listePublicEntite!==null)&&(lDonnee.listePublicEntite!==undefined)&&(lDonnee.listePublicEntite.GetNbrElementsExistes()>0)&&(lDonnee.genresPublicEntite!==null)&&(lDonnee.genresPublicEntite!==undefined)&&(lDonnee.genresPublicEntite.count()>0))||((lDonnee.listePublicIndividu!==null)&&(lDonnee.listePublicIndividu!==undefined)&&(lDonnee.listePublicIndividu.GetNbrElementsExistes()>0))||!!lDonnee.avecDirecteur;}}
module.exports.MoteurDestinataires=MoteurDestinataires;},fn:"moteurdestinataires.js"});;
IE.fModule({f:function(exports,require,module,global){const GTraductions=require('ObjetTraduction.js');const GChaine=require('GChaine.js');const{GDate}=require('ObjetDate.js');const GHtml=require('GHtml.js');const TUtilitaireInfoSondage=require('UtilitaireInfoSondage.js');const EGenreEvntActu=require('EGenreEvntActu.js');const ObjetListeElements=require('ObjetListeElements.js');const ObjetElement=require('ObjetElement.js');const ObjetTri=require('ObjetTri.js');const EGenreTriElement=require('Enumere_TriElement.js');const Toast=require('Toast.js').Toast;const ETypeToast=require('Toast.js').ETypeToast;const MethodesObjet=require('MethodesObjet.js');const TypeEnsembleNombre=require('TypeEnsembleNombre.js');const TypeDomaine=require('TypeDomaine.js');const EGenreEtat=require('Enumere_Etat.js');const EGenreBoiteMessage=require('Enumere_BoiteMessage.js');const EGenreAction=require('Enumere_Action.js');const ETypeAffEnModeMixte=require('Enumere_MenuCtxModeMixte.js').ETypeAffEnModeMixte;const TUtilitaireUrl=require('UtilitaireUrl.js');const MoteurDestinataires=require('MoteurDestinataires.js').MoteurDestinataires;require('produit/css/InfoSondage.css');const EGenreEvntMenuCtxBlocInfoSondage={editerActu:1,supprimerActu:2,dupliquerActu:3,publier:4,depublier:5,marquerLu:6,marquerNonLu:7,supprimerConsult:8,demarrerDiscussion:9,creerModeleDepuisExistant:10,recupererModele:11,voirResultats:12,publierModele:13,nePasPublierModele:14,exporterModele:15,publierPageEtablissement:17,depublierPageEtablissement:18};class MoteurInfoSondage{constructor(aParam){this.utilitaires={genreReponse:aParam.genreReponse,genreRessource:aParam.genreRessource,genreEspace:aParam.genreEspace};this.moteurDestinataires=new MoteurDestinataires(this.utilitaires);}
composeComposanteInfoSondage(aParam){if(aParam.actu.estSondage){return this.composeComposanteSondage(aParam);} else{return this.composeComposanteInfo(aParam);}}
composePiecesJointes(aParam){const H=[];const lListePJ=aParam.composante.listePiecesJointes;if(!!lListePJ&&lListePJ.GetNbrElements()>0){H.push('<div style="margin-top: 1.5rem;">',TUtilitaireUrl.construireListeUrls(lListePJ,{genreRessource:this.utilitaires.genreRessource.getRessourceDocJointEtablissement(),separateur:'<br>'}),'</div>');}
return H.join('');}
composeContenuTexte(aParam,aId){const H=[];H.push('<div id="',this.getIdTexteComposante(aId),'">',this.getTexteComposante(aParam),'</div>');return H.join('');}
getTexteComposante(aParam){return aParam.composante.texte;}
getIdReponse(aParam){return aParam.instance.Nom+'_reponse_'+aParam.indice;}
getIdReponseInputTexteLibre(aId,I){return aId+'_reponselibre_'+I;}
getIdTexteComposante(aId){return'titre_'+aId;}
composeDescriptif(aParam){const lActu=aParam.actualite;const lEstModeReception=!aParam.avecEditionActualite;const lEstModeDiffusion=aParam.avecEditionActualite;const H=[];if(lActu){H.push('<div class="Actu_InfoSondage">');H.push('<div class="zoneTitreIntegral-info-sondage ',(lEstModeDiffusion?'modeDiffusion':''),'">');H.push(this.composeIconInfoSond({actualite:lActu}));H.push('<div class="zoneTitre-info-sondage">');if(aParam.avecTitre){H.push('<div class="titre-info-sondage">');H.push(lActu.GetLibelle());H.push('</div>');}
H.push('<div>');const lAvecCategorie=(lActu.categorie!==null&&lActu.categorie!==undefined);if(lAvecCategorie){H.push(lActu.categorie.GetLibelle());}
if(lEstModeReception&&!!lActu.auteur){H.push(lAvecCategorie?' - ':'');H.push(lActu.auteur);}
H.push('</div>');if(lEstModeReception&&this.avecInfoPublic(lActu)){H.push('<div>');H.push(lActu.public.GetLibelle());H.push('</div>');}
if(lEstModeReception&&aParam.avecDate){H.push('<div>');H.push(GDate.FormatDate(lActu.dateDebut,'%JJJ %JJ %MMMM'));H.push('</div>');}
if(lActu.estSondage){H.push('<div>');H.push(lActu.reponseAnonyme?GTraductions.getValeur('actualites.InfoAnonyme'):GTraductions.getValeur('actualites.InfoNominatif'));if(lActu.reponseAnonyme&&lActu.strInfoSondageAnonyme!==null&&lActu.strInfoSondageAnonyme!==undefined){H.push(' (',lActu.strInfoSondageAnonyme,')');}
H.push('</div>');}
if(lEstModeDiffusion&&!lActu.estModele){H.push('<div class="publication-info-sondage">',this.composeInfoPublication(aParam),this.composeInfoDiffusionPageEtablissement(aParam),'</div>');if(!lActu.estInformation&&lActu.listeIndividusPartage!==null&&lActu.listeIndividusPartage!==undefined){const lNbrPartage=lActu.listeIndividusPartage.GetNbrElements();if(lNbrPartage>0){const lStr=lNbrPartage>1?GTraductions.getValeur('actualites.detailPartageSondageN',[lNbrPartage]):GTraductions.getValeur('actualites.detailPartageSondage',[lActu.listeIndividusPartage.GetLibelle(0)]);H.push('<div class="partage-info-sondage">',lStr,'</div>');}}}
if(lEstModeDiffusion){const lModeSuccinct=(aParam.avecDetailPublicSuccinct===true);const lDetailPublic=lModeSuccinct?(lActu.detailPublicSuccinct?GChaine.ToHTML(lActu.detailPublicSuccinct):''):(lActu.detailPublic?lActu.detailPublic:'');const lClassPublic=lModeSuccinct?'publicSucc-info-sondage':'public-info-sondage';H.push('<div class="',lClassPublic,'">',lDetailPublic,'</div>');}
H.push('</div>');H.push('</div>');H.push('</div>');}
return H.join('');}
composeIconInfoSond(aParam){const lIcon=aParam.actualite.estSondage?'icon_diffuser_sondage':'icon_diffuser_information';return'<i class="'+lIcon+' icon-titre"></i>';}
composeIconDiffusionPageEtablissement(aParam){const H=[];if(!!aParam.actualite&&aParam.actualite.publicationPageEtablissement){const lInfos=this.getInfosPublication(aParam.actualite);const lIcon='icon_ecole';const lColor=_getFlatClassColorPublication.call(this,lInfos);const lStr=GTraductions.getValeur('actualites.Edition.DiffuseSurPageEtab');H.push('<i title="',lStr,'" class="icon '+lIcon+' '+lColor+'"></i>');}
return H.join('');}
composeInfoDiffusionPageEtablissement(aParam){const H=[];if(!!aParam.actualite&&aParam.actualite.publicationPageEtablissement){const lInfos=this.getInfosPublication(aParam.actualite);const lIcon='icon_ecole';const lCssColor=_getFlatClassColorPublication.call(this,lInfos);const lStr=GTraductions.getValeur('actualites.Edition.DiffuseSurPageEtab');H.push('<div><div class="infos-icon ',lIcon,' ',lCssColor,'">',lStr,'</div></div>');}
return H.join('');}
composeIconPublication(aParam){const lInfos=this.getInfosPublication(aParam.actualite);const lIcon=_getIconePublication.call(this,lInfos);const lColor=_getFlatClassColorPublication.call(this,lInfos);const lStr=_getStrPublication.call(this,lInfos);const H=[];H.push('<i title="',lStr,'" class="icon '+lIcon+' '+lColor+'"></i>');return H.join('');}
composeInfoPublication(aParam){const lActu=aParam.actualite;const H=[];const lInfos=this.getInfosPublication(lActu);const lIcon=_getIconePublication.call(this,lInfos);const lCssColor=_getFlatClassColorPublication.call(this,lInfos);const lStr=_getStrPublication.call(this,lInfos);const lDatesPublication=lInfos.estPubliee&&lActu.date?' - '+lActu.date:'';H.push('<div class="infos-icon has-text ',lIcon,' ',lCssColor,'"><span class="libelle">',lStr+lDatesPublication,'</span></div>');return H.join('');}
estComposanteTexte(aParam){return this.utilitaires.genreReponse.estGenreSansReponse(aParam.composante.genreReponse);}
estComposanteQuestion(aParam){return!this.estComposanteTexte(aParam);}
estComposanteQuestChoixMultiple(aParam){return this.utilitaires.genreReponse.estGenreChoixMultiple(aParam.composante.genreReponse);}
estComposanteQuestChoixUnique(aParam){return this.utilitaires.genreReponse.estGenreChoixUnique(aParam.composante.genreReponse);}
estComposanteQuestTextuelle(aParam){return this.utilitaires.genreReponse.estGenreTextuelle(aParam.composante.genreReponse);}
estComposanteAvecMaximum(aParam){return aParam.composante.avecMaximum;}
getNbReponsesMaxDeComposante(aParam){return aParam.composante.nombreReponsesMax;}
getLibelleComposante(aParam){return aParam.composante.GetLibelle();}
getLibelleAffichageComposanteQuest(aParam){const lComposante=aParam.composante;const lAvecAbbr=(lComposante.titre!==null)&&(lComposante.titre!==undefined)&&(lComposante.titre!=='');const lEstTxt=this.utilitaires.genreReponse.estGenreSansReponse(lComposante.genreReponse);const lCleTraductionLibelleConflit=lAvecAbbr?(lEstTxt?'actualites.Edition.AbbrTxtN':'actualites.Edition.AbbrQuN'):(lEstTxt?'actualites.Edition.TexteN':'actualites.Edition.QuestionN');let lResult=GTraductions.getValeur(lCleTraductionLibelleConflit,[aParam.rang]);if(lAvecAbbr){lResult=lResult+' : '+lComposante.titre;}
return lResult;}
composeComposanteSondage(aParam){const H=[];const lId=this.getIdReponse(aParam);if(aParam.avecLibelleQuestion&&this.estComposanteQuestion(aParam)){H.push('<div class="InfoSond_Question">',this.getLibelleComposante(aParam),'</div>');}
if(this.estComposanteQuestChoixMultiple(aParam)&&this.estComposanteAvecMaximum(aParam)){H.push('<div class="InfoSond_NbChoixLimite">',GTraductions.getValeur('actualites.Edition.NbrMaxChoix',[this.getNbReponsesMaxDeComposante(aParam)]),'</div>');}
H.push(this.composeContenuTexte(aParam,lId));H.push(this.composeReponsesSondage(aParam,lId));H.push(this.composePiecesJointes(aParam));return H.join('');}
composeReponsesSondage(aParam,aId){const H=[];H.push('<div id="',aId,'">');if(this.estComposanteQuestTextuelle(aParam)){H.push(this.composeReponseTextuelle(aParam,aId));} else if(this.estComposanteQuestChoixUnique(aParam)||this.estComposanteQuestChoixMultiple(aParam)){H.push(this.composeReponseChoix(aParam,aId));}
H.push('</div>');return H.join('');}
composeReponseTextuelle(aParam,aId){const H=[];H.push('<div style="width:calc(100% - 1rem); margin-top:1rem; margin-bottom:1rem; ',IE.estMobile?'':'border: solid 1px '+GCouleur.themeNeutre.moyen1+'; ','">');H.push('<ie-textareamax tabindex="-1" id="',aId,'_0" ',GHtml.composeAttr('ie-model','surSaisieReponseTextuelle',aParam.indice),'  maxlength="'+aParam.composante.tailleReponse+'" placeholder="',GTraductions.getValeur('actualites.SaisirReponse'),'" ',(IE.estMobile?'':' style="height:6rem;" rows="6" '),(aParam.estAffEditionActualite||GApplication.getModeExclusif()?' disabled':''),'></ie-textareamax>');H.push('</div>');return H.join('');}
composeReponseChoix(aParam,aId){const H=[];const lComposante=aParam.composante;if(lComposante){const lEstQuestChoixMulti=this.estComposanteQuestChoixMultiple(aParam);const lEstAvecMax=lEstQuestChoixMulti&&this.estComposanteAvecMaximum(aParam);const lNombreCoche=lEstAvecMax?lComposante.reponse&&lComposante.reponse.valeurReponse?lComposante.reponse.valeurReponse.GetNbrValeurs():0:0;for(let I=0,lNbr=lComposante.listeChoix.GetNbrElements();I<lNbr;I++){const lReponseChoix=lComposante.listeChoix.GetElement(I);const lNr=I+1;const lValeurReponse=!aParam.estAffEditionActualite&&lComposante.reponse&&lComposante.reponse.valeurReponse?lComposante.reponse.valeurReponse.GetValeur(lNr):undefined;const lEstAffichageEnLectureSeule=(aParam.estAffEditionActualite||GApplication.getModeExclusif());let lEstCocheDisabled=false;if(lEstAffichageEnLectureSeule){lEstCocheDisabled=true;} else if(lEstAvecMax&&(lNombreCoche>=lComposante.nombreReponsesMax)){lEstCocheDisabled=!lValeurReponse;}
const ieInput=(lEstQuestChoixMulti?'ie-checkbox':'ie-radio');const lSurSaisie=aParam.instance.Nom+'.surSaisieReponse ('+aParam.indice+', value, checked);';const lIdCoche=aId+'_'+I;H.push('<div class="InfoSond_InfoCoche" >');H.push('<',ieInput,' ie-textright id="',lIdCoche,'" name="coches_',aId,'"',' onclick="',lSurSaisie,'" value="',lNr,'"'+(lValeurReponse?' checked="checked"':'')+(lEstCocheDisabled?' disabled':'')+' >');H.push(lReponseChoix.GetLibelle());H.push('</',ieInput,'>');if(lReponseChoix.estReponseLibre){const lTailleMaxReponseLibre=30;const lIdReponseLibre=this.getIdReponseInputTexteLibre(aId,I);let lReponseLibreDisabled=lEstAffichageEnLectureSeule;if(!lReponseLibreDisabled){lReponseLibreDisabled=!lValeurReponse;}
const lSurSaisieTexteLibre=aParam.instance.Nom+'.surSaisieReponseLibre ('+aParam.indice+', value);';const lValeurReponseLibre=lComposante.reponse?lComposante.reponse.valeurReponseLibre||'':'';H.push(`<input type="text" style="width:30rem;" maxlength="${lTailleMaxReponseLibre}" class="like-input m-left-xl" id="${lIdReponseLibre}" `,(lReponseLibreDisabled?' disabled':''),` onkeyup="${lSurSaisieTexteLibre}" value="${lValeurReponseLibre}"/>`);}
H.push('</div>');}}
return H.join('');}
estComposanteAvecAR(aParam){const lEstAvecAR=this.utilitaires.genreReponse.estGenreAvecAR(aParam.composante.genreReponse);if(lEstAvecAR!==null){return lEstAvecAR;} else{return aParam.composante.avecAR;}}
composeComposanteInfo(aParam){const H=[];const lId=this.getIdReponse(aParam);H.push(this.composeContenuTexte(aParam,lId));H.push(this.composePiecesJointes(aParam));if(aParam&&aParam.estModeSansAuth!==true){H.push(this.composeReponseInfo(aParam));}
return H.join('');}
composeReponseInfo(aParam){const H=[];if(this.estComposanteAvecAR(aParam)){H.push('<div style="margin-top: 1.5rem;">');H.push(this.composeReponseAvecAR(aParam));H.push('</div>');}
return H.join('');}
composeReponseAvecAR(aParam){const H=[];const lSurKeyUp=aParam.instance.Nom+'.surKeyUpReponse ('+aParam.indice+');';const lSurSaisie=aParam.instance.Nom+'.surSaisieReponse('+aParam.indice+');';H.push('<div class="info-AR">');if(aParam.composante.reponse.estRepondant===false){H.push(GTraductions.getValeur('actualites.XAPrisConnaissanceLeX',[aParam.composante.reponse.strRepondant,GDate.FormatDate(aParam.composante.reponse.reponduLe,'%JJ/%MM/%AAAA')]));} else{H.push('<ie-checkbox tabindex="-1" ','onclick="',lSurSaisie,'"','onkeyup=" ',lSurKeyUp,'"',(aParam.composante.reponse.avecReponse?' checked="checked" disabled':(aParam.estAffEditionActualite||GApplication.getModeExclusif()?' disabled':'')),'>');H.push(GTraductions.getValeur('accueil.prisConnaissance'));H.push('</ie-checkbox>');}
H.push('</div>');return H.join('');}
avecInfoPublic(aActualite){const lEspace=GEtatUtilisateur.GenreEspace;const lEstEspaceParent=this.utilitaires.genreEspace.estEspaceParent(lEspace);const lEstEspaceEntreprise=this.utilitaires.genreEspace.estEspaceEntreprise(lEspace);if(lEstEspaceParent||lEstEspaceEntreprise){const lUtilisateurConnecte=GEtatUtilisateur.getUtilisateur();const lGenre=lEstEspaceEntreprise?this.utilitaires.genreRessource.getRessourceEntreprise():this.utilitaires.genreRessource.getRessourceParent();const lEstActuDUtilisateur=(aActualite.public.GetNumero()===lUtilisateurConnecte.GetNumero())&&(aActualite.public.GetGenre()===lGenre);return!lEstActuDUtilisateur;}
return false;}
avecCumul(aListeInfoSond){const lEspace=GEtatUtilisateur.GenreEspace;const lEstEspaceParent=this.utilitaires.genreEspace.estEspaceParent(lEspace);const lEstEspaceEntreprise=this.utilitaires.genreEspace.estEspaceEntreprise(lEspace);if(lEstEspaceParent||lEstEspaceEntreprise){if(GEtatUtilisateur.avecPlusieursMembres()){return true;} else{const lGenre=lEstEspaceEntreprise?this.utilitaires.genreRessource.getRessourceEntreprise():this.utilitaires.genreRessource.getRessourceParent();const lUtilisateurConnecte=GEtatUtilisateur.getUtilisateur();return(aListeInfoSond.getIndiceElementParFiltre(function(aElement){return(aElement.public.GetNumero()===lUtilisateurConnecte.GetNumero())&&(aElement.public.GetGenre()===lGenre);})> -1);}} else{return false;}}
formaterListePourCumul(aListeInfoSond){const lEspace=GEtatUtilisateur.GenreEspace;const lEstEspaceEntreprise=this.utilitaires.genreEspace.estEspaceEntreprise(lEspace);const lGenre=lEstEspaceEntreprise?this.utilitaires.genreRessource.getRessourceEntreprise():this.utilitaires.genreRessource.getRessourceParent();const lUtilisateurConnecte=GEtatUtilisateur.getUtilisateur();for(let i=0,lNbr=aListeInfoSond.GetNbrElements();i<lNbr;i++){const lElement=aListeInfoSond.GetElement(i);if(lElement.public){let lCumulPere=aListeInfoSond.GetElementParNumeroEtGenre(lElement.public.GetNumero(),lElement.public.GetGenre());if(!lCumulPere){const lATitreIndividuel=(lElement.public.GetNumero()===lUtilisateurConnecte.GetNumero())&&(lElement.public.GetGenre()===lGenre);const lLibelle=lATitreIndividuel?GTraductions.getValeur('actualites.ATitreIndividuel'):GTraductions.getValeur('actualites.AProposDe',[lElement.public.prenom&&(!lEstEspaceEntreprise)?lElement.public.prenom:lElement.public.GetLibelle()]);lCumulPere=new ObjetElement(lLibelle,lElement.public.GetNumero(),lElement.public.GetGenre());lCumulPere.estUnDeploiement=true;lCumulPere.estDeploye=true;lCumulPere.aTitreIndividuel=lATitreIndividuel;aListeInfoSond.AddElement(lCumulPere);}
lElement.pere=lCumulPere;}}
aListeInfoSond.setTri(ObjetTri.initRecursif('pere',[
ObjetTri.init('aTitreIndividuel'),ObjetTri.init(function(D){return D.estUnDeploiement?D.GetLibelle():D.pere.GetLibelle();}),ObjetTri.init(function(D){return D.dateDebut;},EGenreTriElement.Decroissant),ObjetTri.init(function(D){return D.dateFin;}),ObjetTri.init('Libelle'),ObjetTri.init('Numero')
]));aListeInfoSond.trier();}
aToutRepondu(aActualite){let lResult=true;for(let i=0,lNbr=aActualite.listeQuestions.GetNbrElements();i<lNbr&&lResult;i++){const lQuestion=aActualite.listeQuestions.GetElement(i);lResult=lQuestion.reponse.avecReponse||this.utilitaires.genreReponse.estGenreSansReponse(lQuestion.genreReponse)||this.utilitaires.genreReponse.estGenreSansAR(lQuestion.genreReponse);}
return lResult;}
getDerniereReponse(aActualite){let lResult=null;aActualite.listeQuestions.parcourir(aQuestion =>{if(aQuestion.reponse.avecReponse&&!this.utilitaires.genreReponse.estGenreSansReponse(aQuestion.genreReponse)&&!this.utilitaires.genreReponse.estGenreSansAR(aQuestion.genreReponse)){if(!lResult){lResult=aQuestion;} else{if(GDate.estAvantJour(lResult.reponse.reponduLe,aQuestion.reponse.reponduLe)){lResult=aQuestion;}}}});return lResult;}
estAvecVisuReponses(aActualite){const lPremierQ=aActualite.listeQuestions.GetPremierElement();return(((aActualite.estSondage&&!IE.estMobile)||(!aActualite.estSondage&&(!!lPremierQ&&(((lPremierQ.genreReponse!==null)&&(lPremierQ.genreReponse!==undefined)&&!this.utilitaires.genreReponse.estGenreSansAR(lPremierQ.genreReponse))||
lPremierQ.avecAR===true)))))&&(aActualite.listePublicEntite.GetNbrElementsExistes()>0||aActualite.listePublicIndividu.GetNbrElementsExistes()>0||this.utilitaires.genreEspace.estPourPrimaire()&&aActualite.avecDirecteur);}
formatterListeActusPourBlocs(aParam){for(let i=0,lNbr=aParam.listeActualites.GetNbrElements();i<lNbr;i++){const lActu=aParam.listeActualites.GetElement(i);lActu.DateDebut=lActu.dateDebut;lActu.avecReponse=TUtilitaireInfoSondage.avecReponse.bind(lActu);lActu.aToutRepondu=TUtilitaireInfoSondage.aToutRepondu.bind(lActu);lActu.getDate=TUtilitaireInfoSondage.getDate.bind(lActu);}}
getParamSaisie(aInfoSondage,aGenreEvnt,aParam){if(aGenreEvnt===EGenreEvntActu.SurValidationSondage){aParam.avecMsgConfirm=true;}
const lListeActualites=new ObjetListeElements();lListeActualites.AddElement(aInfoSondage);return{listeActualite:lListeActualites,validationDirecte:true,saisieActualite:aParam.modeAuteur};}
afficherToast(aActualite,aGenreEvnt,aParam){let lMessage,lIcon;switch(aGenreEvnt){case EGenreEvntActu.SurValidationSondage:lMessage=GTraductions.getValeur('actualites.msgConfirmValidation',[GDate.FormatDate(aActualite.dateFin,'%J/%MM/%AAAA')]);lIcon='icon_diffuser_sondage';break;case EGenreEvntActu.SurAR:lMessage=GTraductions.getValeur('infoSond.msgSurAR');lIcon=null;break;default:lMessage='';}
if(lMessage!==''){Toast.fermer();Toast.afficher({msg:lMessage,type:ETypeToast.succes,dureeAffichage:4500,icon:lIcon});if(!!aParam.avecRecupDonnees){aParam.clbckRecupDonnees.call(aParam.pereRecupDonnees);}} else{if(!!aParam.avecRecupDonnees){aParam.clbckRecupDonnees.call(aParam.pereRecupDonnees);}}}
initialiserNouveauItem(aParam){const lInformation=new ObjetElement('');let lGenreReponse=(aParam.genreReponse!==null)&&(aParam.genreReponse!==undefined)?aParam.genreReponse:this.utilitaires.genreReponse.getGenreAvecAR();if(aParam.forcerAR===true){if(this.utilitaires.genreReponse.estGenreSansAR(lGenreReponse)){lGenreReponse=this.utilitaires.genreReponse.getGenreAvecAR();} else{lInformation.avecAR=true;}}
if(aParam.categorie!==null&&aParam.categorie!==undefined){lInformation.categorie=aParam.categorie;}
lInformation.auteur=GEtatUtilisateur.getUtilisateur().GetLibelle();if(!aParam.estInformation){lInformation.reponseAnonyme=false;}
lInformation.estInformation=aParam.estInformation;lInformation.estSondage=!lInformation.estInformation;lInformation.date='';lInformation.publie=(aParam.publie!==null)&&(aParam.publie!==undefined)?aParam.publie:(aParam.actualite?false:true);lInformation.estModele=(aParam.estModele===true);const lDateDebut=GDate.getDateCourante();const lDateFin=lInformation.estInformation?_calculeDateFinInfo({derniereDate:aParam.dateFinDerniereDate}):_calculeDateFinSondage(lDateDebut);lInformation.dateDebut=aParam.actualite&&aParam.actualite.dateDebut?aParam.actualite.dateDebut:lDateDebut;lInformation.dateFin=aParam.actualite?aParam.actualite.dateFin:lDateFin;lInformation.avecReponse=TUtilitaireInfoSondage.avecReponse;lInformation.aToutRepondu=TUtilitaireInfoSondage.aToutRepondu;lInformation.lue=false;lInformation.public=new ObjetElement('');lInformation.genrePublic= -1;lInformation.visible=true;if(aParam.actualite&&aParam.actualite.listeQuestions){lInformation.listeQuestions=_copierQuestions.call(this,aParam.actualite.listeQuestions);} else{lInformation.listeQuestions=new ObjetListeElements();lInformation.listeQuestions.AddElement(this.creerQuestionOuTexteSondage({genreReponse:lGenreReponse}));}
lInformation.estVerrouille=false;lInformation.detailPublic=aParam.actualite?aParam.actualite.detailPublic:GTraductions.getValeur('actualites.AucunDestinataire');lInformation.avecModificationPublic=aParam.actualite||aParam.listePublic?true:false;lInformation.avecElevesRattaches=false;lInformation.genresPublicEntite=aParam.actualite?MethodesObjet.dupliquer(aParam.actualite.genresPublicEntite):new TypeEnsembleNombre();lInformation.listePublicEntite=aParam.actualite?MethodesObjet.dupliquer(aParam.actualite.listePublicEntite):new ObjetListeElements();lInformation.listePublicIndividu=aParam.actualite?MethodesObjet.dupliquer(aParam.actualite.listePublicIndividu):new ObjetListeElements();if(!aParam.estInformation){lInformation.listeIndividusPartage=aParam.actualite?MethodesObjet.dupliquer(aParam.actualite.listeIndividusPartage):new ObjetListeElements();}
lInformation.getDate=TUtilitaireInfoSondage.getDate.bind(lInformation);return lInformation;}
creerQuestionOuTexteSondage(aParams){const lUtil=this.utilitaires.genreReponse;const lParams=aParams||{};const lRang=lParams.rang?lParams.rang:1;const lGenreReponse=((lParams.genreReponse===null)||(lParams.genreReponse===undefined)||(lUtil.estGenreSansAR(lParams.genreReponse)&&aParams.forcerAR))?lUtil.getGenreAvecAR():lParams.genreReponse;const lRangElement=lParams.rangElement?lParams.rangElement:lRang;let lLibelle;if(!!aParams.genreReponse&&lUtil.estGenreSansReponse(aParams.genreReponse)){lLibelle=GTraductions.getValeur('actualites.Edition.TexteN',[lRangElement]);} else{lLibelle=GTraductions.getValeur('actualites.Edition.QuestionN',[lRangElement]);}
const lResult=new ObjetElement(lLibelle);lResult.rang=lRang;lResult.indice=lRangElement;lResult.genreReponse=lGenreReponse;if(lGenreReponse===null||lGenreReponse===undefined){lResult.avecAR=true;} else{lResult.avecAR=lUtil.estGenreAvecAR(lGenreReponse);}
lResult.texte='';lResult.titre='';lResult.tailleReponse=200;lResult.listePiecesJointes=new ObjetListeElements();lResult.listeChoix=new ObjetListeElements();lResult.reponse=new ObjetElement();if(lUtil.estGenreTextuelle(lGenreReponse)){lResult.reponse.valeurReponse='';} else if(lUtil.estGenreChoixUnique(lGenreReponse)||lUtil.estGenreChoixMultiple(lGenreReponse)){lResult.reponse.valeurReponse=new TypeDomaine();}
lResult.reponse.avecReponse=false;return lResult;}
creerInfoDiffusionDesResultatsSondage(aSondage,aListeCategories,aListePiecesJointesResultats){const lCategorieParDefaut=_getCategorieParDefaut.call(this,aListeCategories);const lNouvelleActualite=this.initialiserNouveauItem({categorie:lCategorieParDefaut,estInformation:true});lNouvelleActualite.SetLibelle(GTraductions.getValeur('actualites.Edition.TitreDiffusionResultatsDuSondage',[(aSondage.GetLibelle()||'')]));lNouvelleActualite.publie=true;lNouvelleActualite.estUneDiffusionDeResultatsSondage=true;const lStrTypeSondage=(aSondage.reponseAnonyme?GTraductions.getValeur('actualites.Anonyme'):GTraductions.getValeur('actualites.Nominatif'));const lMessageNouvelleInformation=GTraductions.getValeur('actualites.Edition.MessageDiffusionResultatsDuSondage',[lStrTypeSondage.toLowerCase(),(aSondage.GetLibelle()||'')]);const lPremiereQuestion=lNouvelleActualite.listeQuestions.GetPremierElement();lPremiereQuestion.texte=lMessageNouvelleInformation;if(!lPremiereQuestion.listePiecesJointes){lPremiereQuestion.listePiecesJointes=new ObjetListeElements();}
aListePiecesJointesResultats.parcourir(function(D){lPremiereQuestion.listePiecesJointes.AddElement(D);});return lNouvelleActualite;}
getListePiecesJointesDActualite(aActualite){const lListePiecesJointes=new ObjetListeElements();if(!!aActualite&&!!aActualite.listeQuestions){aActualite.listeQuestions.parcourir(function(aQuestion){if(!!aQuestion&&!!aQuestion.listePiecesJointes){aQuestion.listePiecesJointes.parcourir(function(aPJQuestion){lListePiecesJointes.AddElement(aPJQuestion);});}});}
return lListePiecesJointes;}
afficherInfoNonDispoSurMobile(){const lMessage=GTraductions.getValeur('infoSond.nonDispoSurMobile');Toast.afficher({msg:lMessage,type:ETypeToast.info,dureeAffichage:4500});}
initCommandesMenuCtxDInfoSond(aMenu,aActualite,aParam){if(aParam.avecEditionActualite){this.initCommandesMenuCtxDInfoSond_Diffusion(aMenu,aActualite,aParam);} else{this.initCommandesMenuCtxDInfoSond_Reception(aMenu,aActualite,aParam);}}
initCommandesMenuCtxDInfoSond_Diffusion(aMenu,aActualite,aParam){if(!GApplication.getModeExclusif()){const lAvecDroitSaisie=aParam.droitSaisie;const lDroitPublicationPageEtablissement=!!aParam.droitPublicationPageEtablissement&&!!aActualite&&aActualite.estInformation;const lEstCtxModele=(aParam.estCtxModeles===true);if(lAvecDroitSaisie){const lEstAuteurActu=aActualite.estAuteur;aMenu.add(GTraductions.getValeur('actualites.Edition.Modification'),lAvecDroitSaisie&&lEstAuteurActu,function(aLigneMenu){if(IE.estMobile&&aActualite.estSondage){this.afficherInfoNonDispoSurMobile();} else{aParam.evenementMenuContextuel(aActualite,EGenreEvntActu.SurMenuCtxActu,{cmd:aLigneMenu});}}.bind(this),{icon:'icon_pencil',Numero:EGenreEvntMenuCtxBlocInfoSondage.editerActu,typeAffEnModeMixte:ETypeAffEnModeMixte.icon});if(lEstCtxModele){aMenu.add(GTraductions.getValeur('actualites.utiliserModele'),lAvecDroitSaisie,function(aLigneMenu){if(IE.estMobile&&aActualite.estSondage){this.afficherInfoNonDispoSurMobile();} else{aParam.evenementMenuContextuel(aActualite,EGenreEvntActu.SurMenuCtxActu,{cmd:aLigneMenu});}}.bind(this),{icon:'icon_transferer_discussion',Numero:EGenreEvntMenuCtxBlocInfoSondage.recupererModele,typeAffEnModeMixte:ETypeAffEnModeMixte.icon});if(lEstAuteurActu){const lEstPartage=(aActualite.estModelePartage===true);aMenu.add(lEstPartage?GTraductions.getValeur('actualites.nePasPartagerModele'):GTraductions.getValeur('actualites.partagerModele'),lAvecDroitSaisie&&lEstAuteurActu,function(){_changerEtatPartageModele.call(this,aActualite,!lEstPartage,aParam);}.bind(this),{icon:lEstPartage?'icon_retirer_bibliotheque':'icon_sondage_bibliotheque',Numero:lEstPartage?EGenreEvntMenuCtxBlocInfoSondage.nePasPublierModele:EGenreEvntMenuCtxBlocInfoSondage.publierModele,typeAffEnModeMixte:ETypeAffEnModeMixte.ellipsis});}
if(!IE.estMobile&&aActualite.estSondage){aMenu.add(GTraductions.getValeur('actualites.exporterModeleSondage'),lAvecDroitSaisie,function(aLigneMenu){aParam.evenementMenuContextuel(aActualite,EGenreEvntActu.SurMenuCtxActu,{cmd:aLigneMenu});}.bind(this),{icon:'icon_upload_alt',Numero:EGenreEvntMenuCtxBlocInfoSondage.exporterModele,typeAffEnModeMixte:ETypeAffEnModeMixte.ellipsis});}}
if(!lEstCtxModele){aMenu.add(GTraductions.getValeur('actualites.Edition.Dupliquer'),lAvecDroitSaisie,function(){if(IE.estMobile&&aActualite.estSondage){this.afficherInfoNonDispoSurMobile();} else{const lActualite=MethodesObjet.dupliquer(aActualite);lActualite.SetEtat(EGenreEtat.Modification);lActualite.estADupliquer=true;lActualite.dupliquerPublic=true;aParam.evenementMenuContextuel(lActualite,EGenreEvntActu.SurCreationActu);}}.bind(this),{icon:'icon_copier_liste',Numero:EGenreEvntMenuCtxBlocInfoSondage.dupliquerActu,typeAffEnModeMixte:ETypeAffEnModeMixte.ellipsis});if(aActualite.publie){aMenu.add(GTraductions.getValeur('actualites.Edition.Depublier'),lAvecDroitSaisie&&lEstAuteurActu,function(){_changerEtatPublie.call(this,aActualite,false,aParam);}.bind(this),{icon:'icon_info_sondage_non_publier',Numero:EGenreEvntMenuCtxBlocInfoSondage.depublier,typeAffEnModeMixte:ETypeAffEnModeMixte.icon});} else{aMenu.add(GTraductions.getValeur('actualites.Edition.Publier'),_estPublicationAutorisee.call(this,aActualite,aParam),function(){_changerEtatPublie.call(this,aActualite,true,aParam);}.bind(this),{icon:'icon_info_sondage_publier',Numero:EGenreEvntMenuCtxBlocInfoSondage.publier,typeAffEnModeMixte:ETypeAffEnModeMixte.icon});}
if(lDroitPublicationPageEtablissement){if(aActualite.publicationPageEtablissement){aMenu.add(GTraductions.getValeur('actualites.Edition.DepublierPageEtab'),lAvecDroitSaisie&&lEstAuteurActu,function(){_changerPublicationPageEtablissement.call(this,aActualite,false,aParam);}.bind(this),{icon:'icon_ecole mix-icon_fermeture_widget i-small',Numero:EGenreEvntMenuCtxBlocInfoSondage.depublierPageEtablissement,typeAffEnModeMixte:ETypeAffEnModeMixte.icon});} else{aMenu.add(GTraductions.getValeur('actualites.Edition.PublierPageEtab'),lAvecDroitSaisie&&lEstAuteurActu&&aActualite.publie,function(){_changerPublicationPageEtablissement.call(this,aActualite,true,aParam);}.bind(this),{icon:'icon_ecole',Numero:EGenreEvntMenuCtxBlocInfoSondage.publierPageEtablissement,typeAffEnModeMixte:ETypeAffEnModeMixte.icon});}}
if(aParam.avecModeles===true){aMenu.add(GTraductions.getValeur('actualites.creerModele'),lAvecDroitSaisie&&lEstAuteurActu,function(){const lActualite=MethodesObjet.dupliquer(aActualite);lActualite.SetEtat(EGenreEtat.Modification);lActualite.estAModeliser=true;aParam.evenementMenuContextuel(lActualite,EGenreEvntActu.SurCreationActu);}.bind(this),{icon:aActualite.estSondage?'icon_diffuser_sondage mix-icon_plus':'icon_diffuser_information mix-icon_plus',Numero:EGenreEvntMenuCtxBlocInfoSondage.creerModeleDepuisExistant,typeAffEnModeMixte:ETypeAffEnModeMixte.ellipsis});}}
aMenu.add(GTraductions.getValeur('actualites.Edition.Supprimer'),lAvecDroitSaisie&&lEstAuteurActu,function(){const lMsgConfirmSuppression=aActualite.estVerrouille?GTraductions.getValeur('actualites.ConfirmationSuppression'):GTraductions.getValeur('liste.suppressionSelection');GApplication.getMessage().afficher({type:EGenreBoiteMessage.Confirmation,message:lMsgConfirmSuppression,callback:_evntSuppressionActu.bind(this,aActualite,aParam)});}.bind(this),{icon:'icon_trash',Numero:EGenreEvntMenuCtxBlocInfoSondage.supprimerActu,typeAffEnModeMixte:ETypeAffEnModeMixte.icon});if(!lEstCtxModele){if(aParam.avecVisuResultats&&this.estAvecVisuReponses(aActualite)){aMenu.add(GTraductions.getValeur('actualites.Edition.OngletResultats'),true,function(aLigneMenu){aParam.evenementMenuContextuel(aActualite,EGenreEvntActu.SurMenuCtxActu,{cmd:aLigneMenu});},{icon:'icon_qcm',Numero:EGenreEvntMenuCtxBlocInfoSondage.voirResultats,typeAffEnModeMixte:ETypeAffEnModeMixte.bouton});}}}}}
initCommandesMenuCtxDInfoSond_Reception(aMenu,aActualite,aParam){if(!GApplication.getModeExclusif()){if(aActualite.lue){aMenu.add(GTraductions.getValeur('actualites.MarquerNonLu'),aActualite.lue,function(){_changerEtatLue.call(this,aActualite,false,aParam);}.bind(this),{icon:'icon_eye_close',Numero:EGenreEvntMenuCtxBlocInfoSondage.marquerNonLu,typeAffEnModeMixte:ETypeAffEnModeMixte.icon});} else{aMenu.add(GTraductions.getValeur('actualites.MarquerLu'),!aActualite.lue,function(){_changerEtatLue.call(this,aActualite,true,aParam);}.bind(this),{icon:'icon_eye_open',Numero:EGenreEvntMenuCtxBlocInfoSondage.marquerLu,typeAffEnModeMixte:ETypeAffEnModeMixte.icon});}
if(aParam.avecSuppressionActusRecues){aMenu.add(GTraductions.getValeur('actualites.MarquerSupprimee'),true,function(){GApplication.getMessage().afficher({type:EGenreBoiteMessage.Confirmation,message:GTraductions.getValeur('liste.suppressionSelection'),callback:function(aGenreAction){if(aGenreAction===EGenreAction.Valider){_changerEtatSupprimee.call(this,aActualite,aParam);}}.bind(this)});}.bind(this),{icon:'icon_trash',Numero:EGenreEvntMenuCtxBlocInfoSondage.supprimerConsult,typeAffEnModeMixte:ETypeAffEnModeMixte.icon});}
if(aParam.avecDiscussion&&aActualite.elmauteur&&aActualite.elmauteur.avecDiscussion){aMenu.AddSeparateur();aMenu.add(GTraductions.getValeur('actualites.discussion.demarrer'),true,function(aLigneMenu){aParam.evenementMenuContextuel(aActualite,EGenreEvntActu.SurMenuCtxActu,{cmd:aLigneMenu});}.bind(this),{icon:'icon_nouvelle_discussion',Numero:EGenreEvntMenuCtxBlocInfoSondage.demarrerDiscussion,typeAffEnModeMixte:ETypeAffEnModeMixte.icon});}}}
verifierEtatModification(aParam){const lDonnee=aParam.donnee;const lDonneeOrigine=aParam.donneeOrigine;const lTest=(lDonnee.GetLibelle()!==lDonneeOrigine.GetLibelle())||(lDonnee.categorie!==null&&lDonnee.categorie!==undefined&&lDonneeOrigine.categorie!==null&&lDonneeOrigine.categorie!==undefined&&lDonnee.categorie.GetNumero()!==lDonneeOrigine.categorie.GetNumero())||(lDonnee.publie!==lDonneeOrigine.publie)||(!GDate.estJourEgal(lDonnee.dateDebut,lDonneeOrigine.dateDebut))||(!GDate.estJourEgal(lDonnee.dateFin,lDonneeOrigine.dateFin))||
lDonnee.listeQuestions.existeElementPourValidation()||
lDonnee.avecModificationPublic||(lDonnee.publicationPageEtablissement!==lDonneeOrigine.publicationPageEtablissement)||
!!lDonnee.partageAEteModifie;return lTest?EGenreEtat.Modification:EGenreEtat.Aucun;}
validerEdition(aParam){const lListeActualites=new ObjetListeElements();lListeActualites.AddElement(aParam.donnee);const lObjetSaisie={listeActualite:lListeActualites,validationDirecte:false,saisieActualite:true,listeDocuments:aParam.listePJ,genresAffDestinataire:aParam.genresRessAffDestinataire};aParam.envoyerRequete(lObjetSaisie);}
formatterDonnees(aParam){aParam.listeInfoSond.parcourir(function(aActu){if(aActu.estInformation){aActu.listeQuestions.parcourir(function(aQuestion){aQuestion.avecAR=aParam.forcerAR===true||this.estComposanteAvecAR({composante:aQuestion});}.bind(this));}}.bind(this));}
formatterDonneesAvantSaisie(aParam){aParam.listeInfoSond.parcourir(function(aActu){if(aActu.estInformation){aActu.listeQuestions.parcourir(function(aQuestion){aQuestion.genreReponse=aQuestion.avecAR?this.utilitaires.genreReponse.getGenreAvecAR():this.utilitaires.genreReponse.getGenreSansAR();}.bind(this));}}.bind(this));}
composeForm_Text(aParam){const H=[];H.push('<input type="text" id="',aParam.id,'" ie-node="',aParam.node,'" ie-model="',aParam.model,'" class="',aParam.classCss,'" />');return H.join('');}
getInfosPublication(aActualite){const lEstPubliee=(aActualite.publie===true);let lEnCours=false;let lFutur=false;let lPassee=false;if(lEstPubliee){lEnCours=GDate.dateEntreLesDates(GDate.getDateCourante(false),aActualite.dateDebut,aActualite.dateFin,true);lFutur=GDate.estDateJourAvant(GDate.getDateCourante(false),aActualite.dateDebut);lPassee=!lEnCours&&!lFutur;}
return{estPubliee:lEstPubliee,estEnCours:lEnCours,estFutur:lFutur,estPassee:lPassee};}
dupliquerQuestion(aQuestion){return _copieQuestion.call(this,aQuestion);}}
function _getIconePublication(aInfos){if(aInfos.estPubliee){if(aInfos.estFutur){return'icon_info_sondage_publier mix-icon_edt_permanence';} else if(aInfos.estPassee){return'icon_info_sondage_publier';} else if(aInfos.estEnCours){return'icon_info_sondage_publier mix-icon_ok';}} else{return'icon_brouillon_discussion';}
;return'';}
function _getFlatClassColorPublication(aInfos){return aInfos.estPubliee&&!aInfos.estPassee?'on':'off';}
function _getStrPublication(aInfos){return aInfos.estPubliee?aInfos.estEnCours?GTraductions.getValeur('actualites.Publie'):(aInfos.estFutur?GTraductions.getValeur('infoSond.publicationFutur'):GTraductions.getValeur('infoSond.publicationPassee')):GTraductions.getValeur('actualites.NonPubliee');}
function _calculeDateFinSondage(aDate){let i=0;let lDate=new Date(aDate.getTime());do{lDate=GDate.GetJourSuivant(lDate);if(!GParametres.JoursFeries.GetValeur(GDate.getNbrJoursEntreDeuxDates(IE.Cycles.dateDebutPremierCycle(),aDate)+1)&&GDate.estUnJourOuvre(lDate)){i++;}} while(i<15&&lDate<GDate.derniereDate);return lDate;}
function _calculeDateFinInfo(aParam){if(aParam!==null&&aParam!==undefined&&aParam.derniereDate===true){return GDate.derniereDate;} else{const lDerniereSemaine=IE.Cycles.nombreCyclesAnneeScolaire();return IE.Cycles.dateDernierJourOuvreCycle(lDerniereSemaine);}}
function _copierQuestions(aListeQuestions){const lResult=new ObjetListeElements();for(let i=0;i<aListeQuestions.GetNbrElements();i++){if(aListeQuestions.Existe(i)){const lElement=_copieQuestion(aListeQuestions.GetElement(i));lElement.SetEtat(EGenreEtat.Creation);lResult.AddElement(lElement);}}
return lResult;}
function _copieQuestion(aQuestion){const lNouvelleQuestion=this.creerQuestionOuTexteSondage(aQuestion);lNouvelleQuestion.SetLibelle(aQuestion.GetLibelle());lNouvelleQuestion.rang=aQuestion.rang;lNouvelleQuestion.indice=aQuestion.indice;lNouvelleQuestion.genreReponse=aQuestion.genreReponse;lNouvelleQuestion.texte=aQuestion.texte;lNouvelleQuestion.tailleReponse=aQuestion.tailleReponse;lNouvelleQuestion.listePiecesJointes=_copierDocuments(aQuestion.listePiecesJointes);lNouvelleQuestion.listeChoix=_copierChoixReponses(aQuestion.listeChoix);lNouvelleQuestion.avecMaximum=aQuestion.avecMaximum;lNouvelleQuestion.nombreReponsesMax=aQuestion.nombreReponsesMax;lNouvelleQuestion.titre=aQuestion.titre;return lNouvelleQuestion;}
function _copierDocuments(aListeDocuments){const lResult=MethodesObjet.dupliquer(aListeDocuments);for(let i=0;i<lResult.GetNbrElements();i++){if(lResult.Existe(i)){const lElement=lResult.GetElement(i);lElement.SetEtat(EGenreEtat.Creation);}}
return lResult;}
function _copierChoixReponses(aListeChoix){const lResult=new ObjetListeElements();for(let i=0;i<aListeChoix.GetNbrElements();i++){if(aListeChoix.Existe(i)){const lElement=aListeChoix.GetElement(i);const lChoix=new ObjetElement(lElement.GetLibelle());lChoix.rang=lElement.rang;lChoix.SetEtat(EGenreEtat.Creation);if(lElement.estReponseLibre!==null&&lElement.estReponseLibre!==undefined){lChoix.estReponseLibre=lElement.estReponseLibre;}
lResult.AddElement(lChoix);}}
return lResult;}
function _getCategorieParDefaut(aListeCategories){let lCategorieParDefaut=null;if(!!aListeCategories){aListeCategories.parcourir(function(D){if(!!D&&D.estDefaut){lCategorieParDefaut=D;return false;}});if(!lCategorieParDefaut){lCategorieParDefaut=aListeCategories.GetPremierElement();}}
return lCategorieParDefaut;}
function _changerEtatPartageModele(aArticle,aPartage,aParam){if(aArticle.estModelePartage!==aPartage){aArticle.estModelePartage=aPartage;aArticle.changePartageModeleSeulement=true;aParam.evenementMenuContextuel(aArticle,EGenreEvntActu.SurValidationDirecte,{avecRecupDonnees:true});}}
function _changerEtatPublie(aArticle,aPublie,aParam){if(aArticle&&aParam.avecEditionActualite){aArticle.publie=aPublie;if(!aArticle.publie&&aArticle.estInformation){aArticle.publicationPageEtablissement=false;}
aArticle.SetEtat(EGenreEtat.Modification);aParam.evenementMenuContextuel(aArticle,EGenreEvntActu.SurValidationModif);}}
function _changerPublicationPageEtablissement(aArticle,aPublie,aParam){const lDroitPublicationPageEtablissement=aParam.avecEditionActualite&&!!aParam.droitPublicationPageEtablissement&&!!aArticle&&aArticle.estInformation;if(lDroitPublicationPageEtablissement){aArticle.publicationPageEtablissement=aPublie;aArticle.SetEtat(EGenreEtat.Modification);aParam.evenementMenuContextuel(aArticle,EGenreEvntActu.SurValidationModif);}}
function _estPublicationAutorisee(aArticle,aParam){const lAvecPublic=this.moteurDestinataires.avecDestinataires({donnee:aArticle});const lEstAuteurActu=aArticle.estAuteur;return aParam.droitSaisie&&lAvecPublic&&!!lEstAuteurActu;}
function _evntSuppressionActu(aArticle,aParam,aGenreAction){if(aGenreAction===EGenreAction.Valider){aArticle.SetEtat(EGenreEtat.Suppression);aArticle.visible=false;aParam.evenementMenuContextuel(aArticle,EGenreEvntActu.SurValidationModif);}}
function _changerEtatLue(aArticle,aEtat,aParam){if(aArticle.lue!==aEtat){aArticle.lue=aEtat;aArticle.marqueLueSeulement=true;aParam.evenementMenuContextuel(aArticle,EGenreEvntActu.SurValidationDirecte,{avecRecupDonnees:true});}}
function _changerEtatSupprimee(aArticle,aParam){aArticle.supprimee=true;aArticle.marqueLueSeulement=true;aParam.evenementMenuContextuel(aArticle,EGenreEvntActu.SurValidationDirecte,{avecRecupDonnees:true});}
module.exports.MoteurInfoSondage=MoteurInfoSondage;module.exports.EGenreEvntMenuCtxBlocInfoSondage=EGenreEvntMenuCtxBlocInfoSondage;},fn:"moteurinfosondage.js"});;
IE.fModule({f:function(exports,require,module,global){const EModeAffichageTimeline={classique:1,widget:2,grille:3,compact:4,liste:5};module.exports=EModeAffichageTimeline;},fn:"enumere_modeaffichagetimeline.js"});;
IE.fModule({f:function(exports,require,module,global){const TypeThemeBouton=require('Type_ThemeBouton.js');const EGenreDocumentJoint=require('Enumere_DocumentJoint.js');const GTraductions=require('ObjetTraduction.js');const GChaine=require('GChaine.js');const ObjetListeElements=require('ObjetListeElements.js');const GUID=require('GUID.js');const MethodesTableau=require('MethodesTableau.js');const GStyle=require('GStyle.js');const GHtml=require('GHtml.js');const ObjetElement=require('ObjetElement.js');const{GDate}=require('ObjetDate.js');const TUtilitaireUrl=require('UtilitaireUrl.js');const EModeAffichage=require('Enumere_ModeAffichageTimeline.js');const UtilitaireAudio=require('UtilitaireAudio.js');require('espace/css/UtilitaireBloc.css');const EGenreTitreBloc={texte:0,document:1};const EGenreProfondeurBloc={petite:0,moyenne:1,grande:2};const EGenreBoutonBloc={bouton:0,texte:1,selecFile:2,chips:3,chipsAudio:4};function TUtilitaireBloc(){}
TUtilitaireBloc.compose=function(aParams){const lDefault={genreTitre:EGenreTitreBloc.texte,titre:'',estSelectionne:false,estTitreAvecEspace:true,estTitreMaigre:false,estPlie:false,sansContenu:false,htmlContenu:'',widthColDroite:150,widthBtnAction:120,eventPropagationTitre:null,eventPropagationSurBlocEntier:false,infoSousTitre:{avecInfo:false,strInfo:''},infoTitre:{avecInfo:false,strInfo:''},marqueurV:{avecMarqueur:true,surTitreUniquement:true,couleur:GCouleur.themeNeutre.sombre,epaisseur:4},documents:{genreRessource:aParams.genreRessourceDocumentJoint,avecDocuments:false,listeDocuments:new ObjetListeElements()},ombre:{avecOmbre:true,profondeur:EGenreProfondeurBloc.petite},bordure:{avecBordure:false,couleur:GCouleur.themeNeutre.claire},avecArrondis:true,avecVoile:false,avecMargeGauche:true,avecNoWrap:false,couleursBloc:{fondBloc:'#ffffff',fondTitre:'#ffffff',fondContenu:'#ffffff',texteTitre:'black',texteContenu:'black'},menuContextuel:{actif:false,avecBtn3Pts:false,param:{}},boutonsActions:[]};const lParams=$.extend(true ,{},lDefault,aParams);return this.composeHtml({param:lParams,titre:this.composeTitre(lParams),contenu:this.composeContenu(lParams)});};TUtilitaireBloc.getCssProfondeur=function(aProfondeur){switch(aProfondeur){case EGenreProfondeurBloc.petite:return'z-depth-1';case EGenreProfondeurBloc.moyenne:return'z-depth-3';case EGenreProfondeurBloc.grande:return'z-depth-5';default:break;}};TUtilitaireBloc.composeHtml=function(aParams){const H=[];const lEstListe=aParams.param.estListe;const lClass=aParams.param.estSelectionne?'selection':'';const lClassArrondis=((aParams.param.avecArrondis&&!lEstListe)?'ArrondisBloc z-depth-1':'');const lClassMargeGauche=((aParams.param.avecMargeGauche&&!lEstListe)?'MargeGaucheBloc':'');const lAvecVoile=aParams.param.avecVoile?'opacity:0.5;':'';const lStyleBordure=!aParams.param.ombre.avecOmbre&&aParams.param.bordure.avecBordure?GStyle.composeCouleurBordure(aParams.param.bordure.couleur):'';const lStyle=lEstListe?'':'position:relative;margin: 0px 5px 10px 5px;';const lStyleFond=GStyle.composeCouleurFond(aParams.param.couleursBloc.fondBloc);const lClassDivBloc=aParams.param.estListe?'DivBlocListe ':'DivBloc ';const lEventStopPropagation=aParams.param.eventPropagationTitre?' onclick="'+aParams.param.eventPropagationTitre+'(event);"':'';H.push('<div style="',lStyle,lAvecVoile,lStyleBordure,lStyleFond,'" class="',lClassDivBloc,lClass,' ',lClassArrondis,' ',lClassMargeGauche,' "',lEventStopPropagation,' id="event_'+aParams.param.controleur.$GUID+'">');const lAvecZoneAction=aParams.param.menuContextuel.actif||(aParams.param.boutonsActions.length>0);const lDisplayInfoComp=(aParams.param.infoTitre.avecInfo&&aParams.param.infoTitre.strInfo)?'display:block;':'display:none';H.push('<div class="Timeline UtilitaireBloc_containerGauche">');let lDisplay=aParams.param.avecDateAffichee?'':'display:none;';H.push('<div class="UtilitaireBloc_itemGauche" style="',lDisplay,'">');const lDate=aParams.param.dateAffichee||new Date();const lCouleurBloc=GDate.estAvantJourCourant(lDate)?GCouleur.themeNeutre.legere2:GCouleur.themeCouleur.claire;const lCouleurTexte=GDate.estAvantJourCourant(lDate)?GCouleur.themeNeutre.foncee:GCouleur.themeCouleur.foncee;H.push('<div class="UtilitaireBloc_Date AlignementMilieu ie-ellipsis ',lClass,'" style="font-weight:bold;'+(aParams.param.estSelectionne?'':GStyle.composeCouleurFond(lCouleurBloc))+'">');H.push('  <span style="'+GStyle.composeCouleurTexte(lCouleurTexte)+'">',GDate.FormatDate(lDate,"%JJ"),'</span>');H.push('  <span style="'+GStyle.composeCouleurTexte(lCouleurTexte)+'">',GDate.FormatDate(lDate,"%MMM"),'</span>');H.push('</div>');H.push('</div>');H.push('<div class="UtilitaireBloc_itemGauche">');H.push('<div class="AvecMain UtilitaireBloc_containerInverse" style="',(aParams.param.avecNoWrap?'flex-wrap:nowrap;':''),'">');H.push('<div class="UtilitaireBloc_itemInverse" style="display:inline-flex">');H.push(this.composeCelluleMarqueur(aParams,false,false));const lMinWidth=aParams.param.infoTitre.minWidth?'min-width:'+aParams.param.infoTitre.minWidth+';':'min-width:150px;';H.push('<div style="color : ',aParams.param.couleursBloc.texteTitre,'; ',GStyle.composeWidthCalc(aParams.param.marqueurV.epaisseur),'">',aParams.titre,'</div></div>','<div style="',lMinWidth,'color : ',aParams.param.couleursBloc.texteTitre,';',lDisplayInfoComp,'" class="UtilitaireBloc_itemInverse Bloc_InfoCompl',(aParams.param.infoTitre.avecInfo&&aParams.param.infoTitre.alignement?' '+aParams.param.infoTitre.alignement:' AlignementDroit AlignementHaut EspaceHaut'),'">',(aParams.param.infoTitre.avecInfo?aParams.param.infoTitre.strInfo:'&nbsp;'),'</div>');H.push('</div>');lDisplay=(aParams.param.estPlie===true)?'display:none; ':'';let lPropagation=aParams.param.eventPropagationSurBlocEntier?'':'onclick="event.stopPropagation();"';H.push('<div class="elementPliable " style="',lDisplay,'" ',lPropagation,'>');const lDisplayActions=lAvecZoneAction?'display:block':'display:none';if(aParams.param.sansContenu!==true){const lClassVertical=(aParams.param.modeAffichage===EModeAffichage.grille)?'containerVertical':'';H.push('<div class="UtilitaireBloc_containerNormal ',lClassVertical,'" style="',(aParams.param.avecNoWrap?'flex-wrap:nowrap;':''),'">');H.push('<div class="Bloc_Contenu UtilitaireBloc_itemNormal">','<div>',aParams.contenu,'</div>',(aParams.param.documents.avecDocuments?'<div>'+this.composeEspaceDocuments(aParams)+'</div>':''),'</div>');lPropagation=aParams.param.eventPropagationSurBlocEntier?'onclick="event.stopPropagation();"':'';H.push('<div class="UtilitaireBloc_itemNormal" style="',lDisplayActions,' ','" ',lPropagation,'>',(lAvecZoneAction?this.composeZoneBoutonsAction(aParams):''),'</div>');H.push('</div>');}
H.push('</div>');H.push('</div>');H.push('</div>');return H.join('');};TUtilitaireBloc.composeCelluleMarqueur=function(aParams,avecTop,avecBottom){const H=[];if(aParams.param.marqueurV.avecMarqueur){const lArrondiTop=avecTop?'border-top-left-radius: 20px 30px;':'';const lArrondiBottom=avecBottom?'border-bottom-left-radius: 20px 30px;':'';H.push('<div class="celluleMarqueur" style="width:',aParams.param.marqueurV.epaisseur,'px; background-color:',aParams.param.marqueurV.couleur,'; ',lArrondiTop,' ',lArrondiBottom,' border-radius:3px;">&nbsp;</div>');}
return H.join('');};TUtilitaireBloc.composeBtnAction=function(aBouton,aNumeroArticle){const H=[];const lArrayAttr=[];lArrayAttr.push(aBouton.genreBtn);if(aNumeroArticle!==undefined){lArrayAttr.push(aNumeroArticle);}
const lIdBtnAction=GUID.getId();const lClassesBouton=[];lClassesBouton.push(TypeThemeBouton.secondaire);lClassesBouton.push('small-bt');let lGenreAffichageBouton=aBouton.genreAffichage;if(lGenreAffichageBouton===undefined){lGenreAffichageBouton=EGenreBoutonBloc.bouton;}
if(lGenreAffichageBouton===EGenreBoutonBloc.bouton){H.push('<ie-bouton id="',lIdBtnAction,'" ',GHtml.composeAttr('ie-model','btnAction',lArrayAttr),' class="',lClassesBouton.join(' '),'">',aBouton.libelle,'</ie-bouton>');} else if(lGenreAffichageBouton===EGenreBoutonBloc.selecFile){H.push('<ie-bouton id="',lIdBtnAction,'" ',GHtml.composeAttr('ie-model','btnSelecFile',lArrayAttr),' ie-selecfile class="',lClassesBouton.join(' '),'">',aBouton.libelle,'</ie-bouton>');} else if(lGenreAffichageBouton===EGenreBoutonBloc.texte){H.push('<div id="',lIdBtnAction,'" class="btn-texte">',aBouton.libelle,'</div>');} else if(lGenreAffichageBouton===EGenreBoutonBloc.chips){H.push('<div><ie-chips ',GHtml.composeAttr('ie-model','chipsAction',lArrayAttr),'>',aBouton.libelle,'</ie-chips></div>');} else if(lGenreAffichageBouton===EGenreBoutonBloc.chipsAudio){H.push('<div>',UtilitaireAudio.construitChipsAudio({libelle:aBouton.libelle,url:aBouton.url,ieModel:'chipsAudio',argsIEModel:aBouton.argsIEModel,idAudio:aBouton.id,estLien:true}),'</div>');}
return H.join('');};TUtilitaireBloc.composeEspaceDocumentsTitre=function(aParam){const H=[];const lElement=aParam.titre.document;const lDocumentJoint=new ObjetElement(lElement.GetLibelle(),lElement.GetNumero(),EGenreDocumentJoint.Fichier);const lLien=GChaine.composerUrlLienExterne({documentJoint:lDocumentJoint,genreRessource:lElement.GetGenre()});let lEvnt='';if(aParam.titre.avecEvnt===true){lEvnt='onclick="'+aParam.titre.pereEvnt.Nom+'.evntSurDocumentTitre()"';}
H.push('<div class="InlineBlock" ',lEvnt,'>'+lLien+'</div>');return H.join('');};TUtilitaireBloc.composeEspaceDocuments=function(aParam){const H=[];let lListeDocuments='';if(!!aParam.param.documents&&!!aParam.param.documents.listeDocuments){lListeDocuments=TUtilitaireUrl.construireListeUrls(aParam.param.documents.listeDocuments,{genreRessource:aParam.param.documents.genreRessource});}
H.push('<div style="',GStyle.composeCouleurFond(GCouleur.fond),'margin:.8rem .4rem .8rem 0;">');H.push('<div style="',GStyle.composeCouleurTexte(GCouleur.grisTresFonce),'">',GTraductions.getValeur('Bloc.Documents'),'</div>');H.push('<div style="word-break: break-all;">',lListeDocuments,' </div>');H.push('</div>');return H.join('');};TUtilitaireBloc.composeZoneBoutonsAction=function(aParams){const lParamBtn={libelle:aParams.param.menuContextuel.libelle||GTraductions.getValeur('Editer')};const H=[];const lIdBtn=GUID.getId();H.push('<div class="zone-boutons-action">');if(aParams.param.menuContextuel.actif){if(IE.estMobile||aParams.param.menuContextuel.avecBtn3Pts){const lVisibility=aParams.param.menuContextuel.estMasque?'hidden':'visible';H.push('<ie-btnimage id="',lIdBtn,'" ie-model="btnMenuCtx" class="btnImageIcon icon_ellipsis_vertical" style="padding:1rem; ',IE.estMobile?'font-size:1.2rem;':'font-size:2rem;',' color: ',GCouleur.themeCouleur.foncee,'; visibility:',lVisibility,'"></ie-btnimage>');} else{H.push('<ie-bouton id="',lIdBtn,'" ie-model="btnMenuCtx" class="small-bt">',lParamBtn.libelle,'</ie-bouton>');}}
if(!!aParams.param.boutonsActions&&aParams.param.boutonsActions.length>0){MethodesTableau.parcourir(aParams.param.boutonsActions,(function(aBouton){H.push(this.composeBtnAction(aBouton));}).bind(this));}
H.push('</div>');return H.join('');};TUtilitaireBloc.composeTitre=function(aParams){const H=[];H.push('<div class="Bloc_Titre_container ',(aParams.estTitreAvecEspace?'Espace':'EspaceGauche EspaceDroit'),'">');const lClass=aParams.estTitreMaigre?'Bloc_Titre_Maigre':'Bloc_Titre';H.push('<div class="',lClass,'">');switch(aParams.genreTitre){case EGenreTitreBloc.document:H.push(this.composeEspaceDocumentsTitre(aParams));break;default:H.push(aParams.titre?aParams.titre:'&nbsp;');break;}
H.push('</div>');if(aParams.infoSousTitre.avecInfo){H.push('<div class="Bloc_SSTitre">');H.push(aParams.infoSousTitre.strInfo);H.push('</div>');}
H.push('</div>');return H.join('');};TUtilitaireBloc.composeContenu=function(aParams){const H=[];if((aParams.htmlContenu!=='')&&(aParams.htmlContenu!==undefined)&&(aParams.htmlContenu!==null)){H.push('<div style="color : ',aParams.couleursBloc.texteContenu,'; height:100%;" >');H.push(aParams.htmlContenu);H.push('</div>');} else{H.push(this.composeMsgAucuneDonnee(aParams));}
return H.join('');};TUtilitaireBloc.composeMsgAucuneDonnee=function(aParams){const H=[];H.push('<div class="PetitEspace Italique" style="margin: 3px;">',aParams.msg?aParams.msg:'','</div>');return H.join('');};module.exports.TUtilitaireBloc=TUtilitaireBloc;module.exports.EGenreTitreBloc=EGenreTitreBloc;module.exports.EGenreProfondeurBloc=EGenreProfondeurBloc;module.exports.EGenreBoutonBloc=EGenreBoutonBloc;},fn:"utilitairebloc.js"});;
IE.fModule({f:function(exports,require,module,global){const Identite=require('ObjetIdentite.js');const TUtilitaireBloc=require('UtilitaireBloc.js').TUtilitaireBloc;const ObjetElement=require('ObjetElement.js');const ObjetListeElements=require('ObjetListeElements.js');const EGenreTitreBloc=require('UtilitaireBloc.js').EGenreTitreBloc;const EGenreProfondeurBloc=require('UtilitaireBloc.js').EGenreProfondeurBloc;const GTraductions=require('ObjetTraduction.js');const ObjetAbstraitInterface=require('ObjetInterface.js');const EModeAffichage=require('Enumere_ModeAffichageTimeline.js');const GHtml=require('GHtml.js');class GestionnaireBlocDeBase extends Identite{constructor(...aParams){super(...aParams);this._instances=[];this._options={};}
setOptions(aOptions){$.extend(this._options,aOptions);}
instancierObjetMetier(aDataBloc,aConstructeurObjMetier,aParamObjMetier){const lIndiceObjMetier=this._instances.length;$.extend(aDataBloc,{indiceInstanceMetier:lIndiceObjMetier,estSelectionne:false});this._instances[lIndiceObjMetier]=new aConstructeurObjMetier(this.Nom+'._instances',lIndiceObjMetier,aParamObjMetier.pere,aParamObjMetier.evenement);this._instances[lIndiceObjMetier].setParametres(aDataBloc,this._options);return this._instances[lIndiceObjMetier];}
getInstanceObjetMetier(aDataBloc,aConstructeurObjMetier){const lIndice=aDataBloc.indiceInstanceMetier;if((lIndice!==null)&&(lIndice!==undefined)&&(this._instances[lIndice]!==null)&&(this._instances[lIndice]!==undefined)){return this._instances[lIndice];} else{return this.instancierObjetMetier(aDataBloc,aConstructeurObjMetier,{pere:this,evenement:this.surEvntMetier.bind(this)});}}
surEvntMetier(aDataBloc,aGenreEvnt,aParam){if(this.Pere&&this.Evenement){this.callback.appel(aDataBloc,aGenreEvnt,aParam);}}
composeZoneInstance(aInstance){return'<div id="'+aInstance.GetNom()+'" tabIndex="0"></div>';}
composeBloc(){}
refresh(){const lNbr=this._instances.length;for(let i=0;i<lNbr;i++){this.refreshInstance(i);}}
refreshInstance(aIndice){const lInstance=this._instances[aIndice];if(lInstance!==null&&lInstance!==undefined){lInstance.Initialiser();}}
reinit(){const lNbr=this._instances.length;for(let i=0;i<lNbr;i++){this.reInitInstance(i);}
this._instances=[];}
reInitInstance(aIndice){const lInstance=this._instances[aIndice];const lNomInstance=lInstance.GetNom();if(lInstance&&!lInstance._estDetruite&&lInstance.free){lInstance.free();}
this._instances[aIndice]=null;return lNomInstance;}
setDataInstance(aIndice,aDataBloc){const lInstance=this._instances[aIndice];if(lInstance!==null&&lInstance!==undefined){lInstance.setParametres(aDataBloc,this._options);lInstance.Initialiser();}}
getInstanceObjetMetierDeNumeroDataBloc(aNumeroDataBloc){for(let i=0,lNbr=this._instances.length;i<lNbr;i++){const lInstance=this._instances[i];if(lInstance!==null&&lInstance!==undefined){const lDataBloc=lInstance.donnee;if((lDataBloc!==null)&&(lDataBloc!==undefined)){if(lDataBloc.GetNumero()===aNumeroDataBloc){return lInstance;}}}}}
rafraichirBloc(aDataBloc){const lEltBloc=this.composeBlocComplet(aDataBloc);GHtml.setHtml(aDataBloc.idBloc,lEltBloc.html,{controleur:lEltBloc.controleur});this.refreshInstance(aDataBloc.indiceInstanceMetier);}}
class GestionnaireBloc extends GestionnaireBlocDeBase{constructor(...aParams){super(...aParams);this._options={avecZoneAction:true,avecPastille:false};}
setGenreBloc(aGenreBloc){this.GenreBloc=aGenreBloc;}
saisGererBloc(aDataBloc){return(aDataBloc.genreBloc===this.GenreBloc);}
getParamsBloc(){return{};}
setConstructeurBloc(aConstructeurBloc){this.constructeurBloc=aConstructeurBloc;}
setUtilitaires(aUtilitaires){this.utilitaires=aUtilitaires;}
composeBlocComplet(aDataBloc){const lParamBloc=Object.assign({estSelectionne:aDataBloc.estSelectionne,dateAffichee:aDataBloc.DateDebut},this.getParamsBloc(aDataBloc));lParamBloc.genreRessourceDocumentJoint=this.getRessourceDocumentJoint();return{html:TUtilitaireBloc.compose(lParamBloc),controleur:lParamBloc.controleur};}
getRessourceDocumentJoint(){return this.utilitaires.genreRessource.getRessourceDocumentJoint();}
getRessourceAucune(){return this.utilitaires.genreRessource.getRessourceAucune();}
memoriserContexteAvantRedirection(){}
redirection(aOnglet,aGenreRessource,aNumeroDataBloc,aEvent){this.memoriserContexteAvantRedirection(aNumeroDataBloc);const lPage={Onglet:aOnglet};if(aGenreRessource!==this.getRessourceAucune()){$.extend(lPage,{ressource:aGenreRessource});}
GEtatUtilisateur.setPage(lPage);if(GEtatUtilisateur.getGenreOnglet()){const lOnglet=new ObjetElement('',0,GEtatUtilisateur.getGenreOnglet());if(GInterface.GetInstance(GInterface.IdentBandeauEntete)){GInterface.GetInstance(GInterface.IdentBandeauEntete).evenementSurMenuOnglets(lOnglet);}}
aEvent.stopPropagation();}
getInfosPastille(){}
getAvecPastille(){return this._options.avecPastille;}
setDataPastille(aData){this.dataPastille=aData;}
getDataPastille(){return this.dataPastille;}}
class ObjetBloc extends ObjetAbstraitInterface{constructor(...aParams){super(...aParams);this.donneesRecues=false;this._options={};}
setUtilitaires(aUtilitaires){this.utilitaires=aUtilitaires;}
setParametres(aElement,aOptions){this.donneesRecues=true;this._options=$.extend(this._options,aOptions);this.donnee=aElement;}
memoriserContexteAvantRedirection(){}
getParamsBloc(){return{estListe:this.getAvecDateAffichee(),controleur:this.controleur,titre:this.getTitre(),estTitreAvecEspace:this.estTitreAvecEspace(),estTitreMaigre:this.avecTitreMaigre(),infoSousTitre:this.getInfoSsTitre(),infoTitre:this.getInfoTitre(),widthColDroite:this.getWidthColDroite(),widthBtnAction:this.getWidthBtnAction(),eventParDefaut:this.getEventParDefaut(),marqueurV:{couleur:this.getCouleurMarqueur(),avecMarqueur:this.getAvecMarqueurV(),epaisseur:this.getEpaisseurMarqueur()},avecArrondis:this.getAvecArrondis(),avecDateAffichee:this.getAvecDateAffichee(),avecMargeGauche:this.getAvecMargeGauche(),avecNoWrap:this.getAvecNoWrap(),couleursBloc:{fondBloc:this.getCouleurFondBloc(),texteBloc:this.getCouleurTexteBloc(),fondTitre:this.getCouleurFondTitre(),fondContenu:this.getCouleurFondContenu(),texteTitre:this.getCouleurTexteTitre(),texteContenu:this.getCouleurTexteContenu()},ombre:{avecOmbre:this.avecOmbre(),profondeur:this.getProfondeurOmbre()},bordure:{avecBordure:this.avecBordure(),couleur:this.couleurBordure()},menuContextuel:{actif:this.avecMenuContextuel(),libelle:this.libelleMenuContextuel(),avecBtn3Pts:this.avecMenuContextuelBtn3Pts(),estMasque:this.estMenuContextuelMasque(),param:{pere:this}},documents:{genreRessource:this.getGenreRessourceDocuments(),avecDocuments:this.getAvecDocuments(),listeDocuments:this.getListeDocuments()},boutonsActions:this.getTabBtnActions(),avecVoile:this.avecVoile(),estPlie:this.estBlocFerme(),eventPropagationTitre:this.eventPropagationTitre?this.Nom+'.eventPropagationTitre':null,eventPropagationSurBlocEntier:this.getEventPropagationSurBlocEntier(),modeAffichage:this._options.modeAffichage};}
getCouleurMarqueur(){return GCouleur.themeNeutre.sombre;}
getAvecMarqueurV(){return this._options.modeAffichage!==EModeAffichage.compact;}
getAvecArrondis(){return this._options.modeAffichage!==EModeAffichage.compact;}
getAvecDateAffichee(){return this._options.modeAffichage===EModeAffichage.liste;}
getAvecMargeGauche(){return!IE.estMobile;}
getAvecNoWrap(){return false;}
getEpaisseurMarqueur(){return 3;}
getCouleurFondBloc(){return GCouleur.blanc;}
getCouleurTexteBloc(){return GCouleur.themeCouleur.foncee;}
getCouleurFondTitre(){return'#ffffff';}
getCouleurFondContenu(){return'#ffffff';}
getCouleurTexteTitre(){return'black';}
getCouleurTexteContenu(){return'black';}
avecVoile(){return false;}
avecOmbre(){return true;}
avecBordure(){return false;}
couleurBordure(){return GCouleur.themeNeutre.claire;}
estBlocFerme(){return false;}
getEventPropagationSurBlocEntier(){return false;}
getProfondeurOmbre(){return EGenreProfondeurBloc.petite;}
getGenreTitre(){return EGenreTitreBloc.texte;}
getTitre(aTitre){if(this.getGenreTitre()===EGenreTitreBloc.texte){let lResult=((aTitre!==null)&&(aTitre!==undefined))?aTitre:'';if(lResult===''){lResult=GTraductions.getValeur('SansTitre');}
return lResult;}
return new ObjetElement();}
avecTitreMaigre(){return false;}
estTitreAvecEspace(){return true;}
getInfoSsTitre(){const lStrSsTitre=[];return{avecInfo:false,strInfo:lStrSsTitre.join('')};}
getInfoTitre(){const lAvecInfo=false;const lStrInfo=[];return{avecInfo:lAvecInfo,strInfo:lStrInfo.join('')};}
getGenreRessourceDocuments(){return this.utilitaires.genreRessource.getRessourceDocumentJoint();}
getAvecDocuments(){return false;}
getListeDocuments(){return new ObjetListeElements();}
getWidthColDroite(aValeur){if((this._options!==null)&&(this._options!==undefined)&&(this._options.avecZoneAction===false)&&(this.getInfoTitre().avecInfo===false)){return 0;}
return aValeur;}
getEventParDefaut(){return'toggleElement';}
getWidthBtnAction(aValeur){if((this._options!==null)&&(this._options!==undefined)&&(this._options.avecZoneAction===false)){return 0;}
return aValeur;}
avecMenuContextuel(aValeur){if((this._options!==null)&&(this._options!==undefined)&&(this._options.avecZoneAction===false)){return false;}
return(aValeur!==null)&&(aValeur!==undefined)?aValeur:false;}
libelleMenuContextuel(){return GTraductions.getValeur('Editer');}
avecMenuContextuelBtn3Pts(){return false;}
estMenuContextuelMasque(){return false;}
getTabBtnActions(){const lResult=[];return lResult;}
estEspaceParent(aGenreEspace){return this.utilitaires.genreEspace.estEspaceParent(aGenreEspace);}}
module.exports={GestionnaireBlocDeBase,GestionnaireBloc,ObjetBloc};},fn:"gestionnairebloc.js"});;
IE.fModule({f:function(exports,require,module,global){const GestionnaireBloc=require('GestionnaireBloc.js').GestionnaireBloc;const ObjetBloc=require('GestionnaireBloc.js').ObjetBloc;const EGenreRessource=require('Enumere_Ressource.js');const EGenreEspace=require('Enumere_Espace.js');const TypeGenreReponseInternetActualite=require('TypeGenreReponseInternetActualite.js').TypeGenreReponseInternetActualite;const MethodesTableau=require('MethodesTableau.js');class UtilitaireGenreRessource{constructor(){}
getRessourceDocumentJoint(){return EGenreRessource.DocumentJoint;}
getRessourceAucune(){return EGenreRessource.Aucune;}
getRessourceDocJointEtablissement(){return EGenreRessource.DocJointEtablissement;}
getRessourceEleve(){return EGenreRessource.Eleve;}
getRessourceParent(){return EGenreRessource.Responsable;}
getRessourceProf(){return EGenreRessource.Enseignant;}
getRessourcePersonnel(){return EGenreRessource.Personnel;}
getRessourceEntreprise(){return EGenreRessource.MaitreDeStage;}
getRessourceInspecteur(){return EGenreRessource.InspecteurPedagogique;}
getRessourceClasse(){return EGenreRessource.Classe;}
getRessourceGroupe(){return EGenreRessource.Groupe;}}
class UtilitaireGenreEspace{constructor(){}
estEspaceParent(aGenreEspace){return MethodesTableau.existe(aGenreEspace,[
EGenreEspace.Parent,EGenreEspace.Mobile_Parent,EGenreEspace.PrimParent,EGenreEspace.Mobile_PrimParent
]);}
estEspaceEntreprise(aGenreEspace){return MethodesTableau.existe(aGenreEspace,[EGenreEspace.Entreprise]);}
estPourPrimaire(){return GEtatUtilisateur.pourPrimaire();}}
class UtilitaireGenreReponse{constructor(){}
estGenreSansReponse(aGenreReponse){return MethodesTableau.existe(aGenreReponse,[TypeGenreReponseInternetActualite.SansReponse]);}
estGenreChoixMultiple(aGenreReponse){return MethodesTableau.existe(aGenreReponse,[TypeGenreReponseInternetActualite.ChoixMultiple]);}
estGenreChoixUnique(aGenreReponse){return MethodesTableau.existe(aGenreReponse,[TypeGenreReponseInternetActualite.ChoixUnique]);}
estGenreTextuelle(aGenreReponse){return MethodesTableau.existe(aGenreReponse,[TypeGenreReponseInternetActualite.Textuelle]);}
estGenreAvecAR(aGenreReponse){return MethodesTableau.existe(aGenreReponse,[TypeGenreReponseInternetActualite.AvecAR]);}
estGenreSansAR(aGenreReponse){return MethodesTableau.existe(aGenreReponse,[TypeGenreReponseInternetActualite.SansAR]);}
getGenreSansReponse(){return TypeGenreReponseInternetActualite.SansReponse;}
getGenreChoixMultiple(){return TypeGenreReponseInternetActualite.ChoixMultiple;}
getGenreChoixUnique(){return TypeGenreReponseInternetActualite.ChoixUnique;}
getGenreTextuelle(){return TypeGenreReponseInternetActualite.Textuelle;}
getGenreAvecAR(){return TypeGenreReponseInternetActualite.AvecAR;}
getGenreSansAR(){return TypeGenreReponseInternetActualite.SansAR;}}
class GestionnaireBlocPN extends GestionnaireBloc{constructor(...aParams){super(...aParams);this.setUtilitaires({genreRessource:new UtilitaireGenreRessource()});}}
class ObjetBlocPN extends ObjetBloc{constructor(...aParams){super(...aParams);this.setUtilitaires({genreRessource:new UtilitaireGenreRessource()});}}
module.exports={GestionnaireBlocPN,UtilitaireGenreRessource,UtilitaireGenreEspace,UtilitaireGenreReponse,ObjetBlocPN};},fn:"gestionnaireblocpn.js"});;
IE.fModule({f:function(exports,require,module,global){const Identite=require('ObjetIdentite.js');const EGenreTriElement=require('Enumere_TriElement.js');const EGenreEspace=require('Enumere_Espace.js');const GTraductions=require('ObjetTraduction.js');const ObjetTri=require('ObjetTri.js');const{GObjetWAI,EGenreRole,EGenreAttribut}=require('ObjetWAI.js');const TUtilitaireInformations=require('UtilitaireInformations.js');const EGenreOnglet=require('Enumere_Onglet.js');const TypeModeAff=require('TypeEtatPublication.js').TypeModeAff;const MoteurInfoSondage=require('MoteurInfoSondage.js').MoteurInfoSondage;const UtilitaireGenreRessource=require('GestionnaireBlocPN.js').UtilitaireGenreRessource;const UtilitaireGenreEspace=require('GestionnaireBlocPN.js').UtilitaireGenreEspace;const UtilitaireGenreReponse=require('GestionnaireBlocPN.js').UtilitaireGenreReponse;class WidgetActualites extends Identite{construire(aParams){this.donnees=aParams.donnees;this.options=aParams.options!==null&&aParams.options!==undefined?aParams.options:{estModeSansAuth:false};if(this.options.estModeSansAuth===true){this.moteur=new MoteurInfoSondage({genreRessource:new UtilitaireGenreRessource(),genreEspace:new UtilitaireGenreEspace(),genreReponse:new UtilitaireGenreReponse()});}
this.listeActualites=this.donnees.listeModesAff[TypeModeAff.MA_Reception].listeActualites;const lNbrElements=this.listeActualites.GetNbrElements();const lAvecCumul=this.options.estModeSansAuth===true?false:TUtilitaireInformations.avecCumul(this.listeActualites);this.listeActualites.setTri([ObjetTri.init(function(a){return a.categorie?a.categorie.GetLibelle():'';})]);this.listeActualites.trier();if(lAvecCumul){TUtilitaireInformations.formaterListePourCumul(this.listeActualites);} else{this.listeActualites.setTri([
ObjetTri.init('dateDebut',EGenreTriElement.Decroissant),ObjetTri.init('dateCreation',EGenreTriElement.Decroissant),ObjetTri.init('Libelle')
]);this.listeActualites.trier();}
let lNbrListes=0;for(let i=0,lNbr=this.listeActualites.GetNbrElements();i<lNbr;i++){if(this.listeActualites.GetElement(i).estUnDeploiement){lNbrListes++;}}
const lWidget={html:this.composeWidgetActualites(),nbrElements:lNbrElements,nbrListes:lNbrListes,liste:this.listeActualites,afficherMessage:lNbrElements===0,fermerFiches:function(){}.bind(this)};$.extend(true,aParams.donnees,lWidget);aParams.construireWidget(this.donnees);}
composeWidgetActualites(){this.indiceLigne=0;const H=[];const lEstModeSansAuth=this.options.estModeSansAuth===true;if(this.listeActualites.GetNbrElements()>0){H.push('<ul role="list" class="liste-imbriquee">');for(let I=0;I<this.listeActualites.GetNbrElements();I++){const lElement=this.listeActualites.GetElement(I);lElement.avecReponse=lEstModeSansAuth?false:TUtilitaireInformations.avecReponse;lElement.aToutRepondu=TUtilitaireInformations.aToutRepondu;if(lElement.estUnDeploiement){if(I!==0){H.push('</ul></li>');}
H.push('<li role="listitem" tabIndex="0" aria-label="',lElement.GetLibelle(),'">','<h4>',lElement.GetLibelle(),'</h4>');H.push('<ul role="list" class="liste-clickable">');} else{if(I===0){H.push('<ul role="list" class="',lEstModeSansAuth?'':'liste-clickable','">');}
H.push(this.composeActualite(lElement,I));}}
H.push('</ul>');H.push('</ul>');}
return H.join('');}
composeActualite(aActualite,i){const H=[];const lID=this.donnees.id+'_div_'+i;const lOnKeyUp='if (GNavigateur.IsToucheSelection())'+this.Nom+'._surActualite ('+i+')';const lLabel=aActualite.estInformation?GTraductions.getValeur('accueil.informations.hintLien.information'):GTraductions.getValeur('accueil.informations.hintLien.sondage');let lTitre=aActualite.GetLibelle();if((lTitre===null)||(lTitre===undefined)||(lTitre==='')){lTitre=GTraductions.getValeur('SansTitre');}
const lEstModeSansAuth=this.options.estModeSansAuth===true;H.push('<li id="',lID,'" ');H.push('class="as-offset ',aActualite.estInformation?'icon_diffuser_information"':'icon_diffuser_sondage"');H.push(lEstModeSansAuth?'':' ie-hint="'+(aActualite.estInformation?GTraductions.getValeur('accueil.informations.hintLien.information'):GTraductions.getValeur('accueil.informations.hintLien.sondage'))+'"');H.push(lEstModeSansAuth?'':' onclick="'+this.Nom+'._surActualite ('+i+')"');H.push(lEstModeSansAuth?'':' onkeyup="'+lOnKeyUp+'"');H.push(GObjetWAI.composeRole(EGenreRole.Link));H.push(' aria-label="',lLabel+(lTitre?' : '+lTitre:''),'"');H.push(i===0?GObjetWAI.composeAttribut({genre:EGenreAttribut.describedby,valeur:lID+'_detail'}):'');H.push(' tabIndex="0">');if(lEstModeSansAuth){H.push('<div>');}
H.push('<div class="wrap">');H.push('<h5>',lTitre,'</h5>',aActualite.auteur?aActualite.auteur:'');H.push('</div>');if(this.options.estModeSansAuth!==true&&(GEtatUtilisateur.GenreEspace===EGenreEspace.Parent||GEtatUtilisateur.GenreEspace===EGenreEspace.Mobile_Parent)&&aActualite.prenom){H.push('<div class="circle" ie-hint="',aActualite.prenom,'">'+aActualite.prenom.substr(0,1).toUpperCase()+'</div>');}
if(lEstModeSansAuth&&aActualite.listeQuestions){var lComposanteInfo=aActualite.listeQuestions.GetElement(0);H.push('<div style="margin-top:1rem; margin-bottom : 1rem;">');H.push(this.moteur.composeComposanteInfoSondage({instance:this,actu:aActualite,composante:lComposanteInfo,indice:0,avecLibelleQuestion:false,estAffEditionActualite:false,estModeSansAuth:lEstModeSansAuth}));H.push('</div>');H.push('</div>');}
H.push('</li>');return H.join('');}
_surActualite(i){const lActuSelectionne=this.listeActualites.GetElement(i);GEtatUtilisateur.setInfoSond(lActuSelectionne);const lPage={Onglet:EGenreOnglet.Informations};if(GEtatUtilisateur.estEspaceMobile()){this.evenementPage({genreOngletDest:lPage.Onglet});} else{this.evenementPage(this.genreEvenement.selectionPage,lPage);}}}
module.exports=WidgetActualites;},fn:"widgetactualites.js"});;
IE.fModule({f:function(exports,require,module,global){const GChaine=require('GChaine.js');const GStyle=require('GStyle.js');const ObjetFiche=require('ObjetFiche.js');class ObjetFicheEvenement extends ObjetFiche{constructor(...aParams){super(...aParams);this.largeurMax=750;this.hauteurMax=400;this.setOptionsFenetre({largeur:300,hauteur:150,titre:function(){return this.evenement?this.evenement.GetLibelle():'';}.bind(this)});}
SetDonnees(aListeEvenements,aEvenement){this.listeEvenements=aListeEvenements;this.evenement=aEvenement;this.Afficher();}
ComposeContenu(){const H=[];H.push('<div class="PetitEspace">');H.push('<div style="clear: both" class="PetitEspace">','<div style="float: left; width: 12px; ',GStyle.composeCouleurFond(this.evenement.CouleurCellule),'">&nbsp;</div>','<div style="float: left; padding:0px 5px;">',this.listeEvenements._getDateEvenement({evenement:this.evenement}),'</div>','</div>');H.push('<div  style="clear: both" class="PetitEspace">',this.evenement.Commentaire,'</div>');if(this.evenement.listeDocJoints&&this.evenement.listeDocJoints.GetNbrElements()>0){H.push('<div  style="clear: both" class="PetitEspace">',this.composeDocuments(this.evenement.listeDocJoints),'</div>');}
H.push('</div>');return H.join('');}
composeDocuments(aListeDocumentsJoints){const lHtml=[];for(let I=0;I<aListeDocumentsJoints.GetNbrElements();I++){const lDocumentJoint=aListeDocumentsJoints.GetElement(I);lHtml.push(GChaine.composerUrlLienExterne({documentJoint:lDocumentJoint}));}
return lHtml.join('<br/>');}}
module.exports=ObjetFicheEvenement;},fn:"objetficheevenement.js"});;
IE.fModule({f:function(exports,require,module,global){const Requetes=require('CollectionRequetes.js');const{ObjetRequeteConsultation}=require('ObjetRequeteJSON.js');const{ObjetRequeteSaisie}=require('ObjetRequeteJSON.js');const ObjetFenetre=require('ObjetFenetre.js');const GTraductions=require('ObjetTraduction.js');const EGenreBoiteMessage=require('Enumere_BoiteMessage.js');const EGenreEtat=require('Enumere_Etat.js');const TypeThemeBouton=require('Type_ThemeBouton.js');const EGenreAction=require('Enumere_Action.js');const MethodesObjet=require('MethodesObjet.js');require('ObjetFenetre_SaisieVisiosCours.css');Requetes.inscrire('FenetreSaisieVisiosCours',ObjetRequeteConsultation);Requetes.inscrire('SaisieVisio',ObjetRequeteSaisie);const TypeBoutonFenetreSaisieVisiosCours={Supprimer:'supprimer',Annuler:'annuler',Valider:'valider'};class ObjetFenetre_SaisieVisiosCours extends ObjetFenetre{constructor(...aParams){super(...aParams);this.setOptionsFenetre({titre:GTraductions.getValeur('FenetreSaisieVisiosCours.URLAssocieeAuCours'),largeur:500,hauteur:300,listeBoutons:[{libelle:GTraductions.getValeur('Annuler'),theme:TypeThemeBouton.secondaire,typeBouton:TypeBoutonFenetreSaisieVisiosCours.Annuler},{libelle:GTraductions.getValeur('Valider'),theme:TypeThemeBouton.primaire,typeBouton:TypeBoutonFenetreSaisieVisiosCours.Valider}],avecComposeBasInFooter:true});this.saisieDirecte=false;this.estPourHP=false;this.callbackOuvrirLienVisio=null;this.tailleMaxChamps={libelle:60,commentaire:255};this.donnees={cours:null,progression:null,nbVisiosMaxProgrammes:0};}
getVisioCours(){return this.donnees.lienVisio;}
getNbVisiosProgrammesSurLaJournee(){let lNbVisios=0;if(!!this.donnees.cours){lNbVisios=this.donnees.nbVisiosMaxProgrammes||0;}
return lNbVisios;}
getControleur(aInstance){return $.extend(true,super.getControleur(this),{getNodeTestURL:function(){$(this.node).on('click',function(event){event.preventDefault();if(!!aInstance.callbackOuvrirLienVisio){const lVisioCours=aInstance.getVisioCours();aInstance.callbackOuvrirLienVisio(lVisioCours);}});},modelURL:{getValue:function(){const lVisioCours=aInstance.getVisioCours();return lVisioCours?(lVisioCours.url||''):'';},setValue:function(aValue){const lVisioCours=aInstance.getVisioCours();if(!!lVisioCours){lVisioCours.url=aValue;lVisioCours.SetEtat(EGenreEtat.Modification);}
afficherMasquerLienTest(estLienTesterURLVisible(lVisioCours));}},modelLibelleLien:{getValue:function(){const lVisioCours=aInstance.getVisioCours();return lVisioCours?(lVisioCours.libelleLien||''):'';},setValue:function(aValue){const lVisioCours=aInstance.getVisioCours();if(!!lVisioCours){lVisioCours.libelleLien=aValue;lVisioCours.SetEtat(EGenreEtat.Modification);}}},modelCommentaire:{getValue:function(){const lVisioCours=aInstance.getVisioCours();return lVisioCours?(lVisioCours.commentaire||''):'';},setValue:function(aValue){const lVisioCours=aInstance.getVisioCours();if(!!lVisioCours){lVisioCours.commentaire=aValue;lVisioCours.SetEtat(EGenreEtat.Modification);}}},btnSupprimer:{event:function(){aInstance._SurValidation(TypeBoutonFenetreSaisieVisiosCours.Supprimer);},getDisabled:function(){const lVisioCours=aInstance.getVisioCours();return!(lVisioCours&&lVisioCours.existeNumero()&&lVisioCours.Etat!==EGenreEtat.Creation);}},afficherNbVisiosProgrammes:function(){return aInstance.getNbVisiosProgrammesSurLaJournee()>0;},getStrNbVisiosProgrammes:function(){const lNbVisios=aInstance.getNbVisiosProgrammesSurLaJournee();if(lNbVisios>1){return GTraductions.getValeur('FenetreSaisieVisiosCours.XCoursEnVisioProgrammes',[lNbVisios]);} else{return GTraductions.getValeur('FenetreSaisieVisiosCours.1CoursEnVisioProgramme');}}});}
setAvecSaisieDirecte(aSaisieDirecte){this.saisieDirecte=!!aSaisieDirecte;}
setCallbackOuvrirLienVisio(aCallbackOuvrirLienVisio){this.callbackOuvrirLienVisio=aCallbackOuvrirLienVisio;}
setDonnees(aParametres){this.donnees.lienVisio=aParametres.lienVisio;this.callbackValider=aParametres.callbackValider;this.sauvegardeVisio=MethodesObjet.dupliquer(aParametres.lienVisio);if(!!aParametres){if(aParametres.tailleMaxLibelle){this.tailleMaxChamps.libelle=aParametres.tailleMaxLibelle;}
if(aParametres.tailleMaxCommentaire){this.tailleMaxChamps.commentaire=aParametres.tailleMaxCommentaire;}}
const lThis=this;lThis.donnees.nbVisiosMaxProgrammes=0;const lVisioCours=lThis.getVisioCours();lThis.setBoutonVisible(0,lVisioCours.Etat!==EGenreEtat.Creation);lThis.Afficher();if(!estLienTesterURLVisible(lVisioCours)){afficherMasquerLienTest(false);}}
ComposeContenu(){const T=[];T.push('<div class="flex-contain cols">');T.push(`<div class="field-contain label-up">\n              <div class="flex-contain flex-center justify-between">\n                  <label class="fluid-bloc">${GTraductions.getValeur('FenetreSaisieVisiosCours.ChampURL')} : ${GTraductions.getValeur('FenetreSaisieVisiosCours.MarqueurChampObligatoire')}</label>\n                  <span class="fluid-bloc text-end m-bottom-l" ie-node="getNodeTestURL">\n                    <a href="#">${GTraductions.getValeur('FenetreSaisieVisiosCours.TesterURL')}</a>\n                  </span>\n              </div>\n\n              <input ie-model="modelURL" ie-trim class="round-style full-width"/>\n            </div>`);T.push(`<div class="field-contain label-up">\n              <label>${GTraductions.getValeur('FenetreSaisieVisiosCours.ChampLibelleURL')} :</label>\n              <input ie-model="modelLibelleLien" ie-trim class="round-style full-width" maxlength="${this.tailleMaxChamps.libelle}"/>\n            </div>`);T.push(`<div class="field-contain label-up">\n              <label>${GTraductions.getValeur('FenetreSaisieVisiosCours.ChampCommentaireURL')} :</label>\n              <ie-textareamax ${!IE.estMobile?`style="height: 6rem;"`:``}  ie-model="modelCommentaire" class="round-style full-width" maxlength="${this.tailleMaxChamps.commentaire}" placeholder="${GTraductions.getValeur('FicheEleve.redigezCommentaire')}"></ie-textareamax>\n            </div>`);T.push(`<div ie-if="afficherNbVisiosProgrammes()">\n              <span ie-html="getStrNbVisiosProgrammes()"></span>\n            </div>`);T.push(`<div class="m-top-l ${IE.estMobile?` m-bottom-nega-xl`:`m-bottom-nega-l`}">\n                ${GTraductions.getValeur('FenetreSaisieVisiosCours.MarqueurChampObligatoire')} ${GTraductions.getValeur('FenetreSaisieVisiosCours.ChampObligatoire')}
            </div>`);T.push('</div>');return T.join('');}
ComposeBas(){const lHTML=[];lHTML.push('<div class="compose-bas">');lHTML.push('<ie-btnicon ie-model="btnSupprimer" title="',GTraductions.getValeur('Supprimer'),'" class="icon_trash avecFond i-medium"></ie-btnicon>');lHTML.push('</div>');return lHTML.join('');}
SurValidation(aNumeroBouton){let lTypeBouton=TypeBoutonFenetreSaisieVisiosCours.Annuler;const lBouton=this.getBoutonNumero(aNumeroBouton);if(!!lBouton&&lBouton.typeBouton!==undefined){lTypeBouton=lBouton.typeBouton;}
this._SurValidation(lTypeBouton);}
_SurValidation(aTypeBouton){let lVisioCours=this.getVisioCours();if(!lVisioCours){this.Fermer();return;}
if(aTypeBouton===TypeBoutonFenetreSaisieVisiosCours.Valider){const lMessagesChampsObligatoires=[];if(!lVisioCours.url||lVisioCours.url.length===0){lMessagesChampsObligatoires.push(GTraductions.getValeur('FenetreSaisieVisiosCours.ChampURLEstObligatoire'));}
if(lMessagesChampsObligatoires.length>0){GApplication.getMessage().afficher({type:EGenreBoiteMessage.Information,message:lMessagesChampsObligatoires.join('<br/>')});return;}}
if(aTypeBouton===TypeBoutonFenetreSaisieVisiosCours.Annuler){lVisioCours=this.sauvegardeVisio;}
const lThis=this;(aTypeBouton===TypeBoutonFenetreSaisieVisiosCours.Supprimer?new Promise(function(aResolve){GApplication.getMessage().afficher({type:EGenreBoiteMessage.Confirmation,message:GTraductions.getValeur('FenetreSaisieVisiosCours.ConfirmationSuppression'),callback:function(aNumeroBouton){if(aNumeroBouton===EGenreAction.Valider){aResolve();}}});}):Promise.resolve()).then(function(){if(aTypeBouton===TypeBoutonFenetreSaisieVisiosCours.Supprimer){lVisioCours.SetEtat(EGenreEtat.Suppression);} else if(aTypeBouton!==TypeBoutonFenetreSaisieVisiosCours.Valider){if(lVisioCours.Etat===EGenreEtat.Creation){lVisioCours.SetEtat(EGenreEtat.Suppression);}}
if(lThis.saisieDirecte&&(aTypeBouton===TypeBoutonFenetreSaisieVisiosCours.Valider||aTypeBouton===TypeBoutonFenetreSaisieVisiosCours.Supprimer)){lThis.callbackValider(aTypeBouton,lThis.donnees);} else{lThis.callback.appel(aTypeBouton,lThis.donnees);}
lThis.Fermer();});}}
function estLienTesterURLVisible(aVisioCours){let lEstLienVisible=true;if(!aVisioCours||!aVisioCours.url||aVisioCours.url.length===0){lEstLienVisible=false;}
return lEstLienVisible;}
function afficherMasquerLienTest(aVisible){const $lienTestUrl=$('.ObjetFenetreSaisieVisiosCours .TestChampURL');if(aVisible){$lienTestUrl.show();} else{$lienTestUrl.hide();}}
module.exports={ObjetFenetre_SaisieVisiosCours:ObjetFenetre_SaisieVisiosCours,TypeBoutonFenetreSaisieVisiosCours:TypeBoutonFenetreSaisieVisiosCours};},fn:"objetfenetre_saisievisioscours.js"});;
IE.fModule({f:function(exports,require,module,global){const{ObjetRequeteConsultation}=require('ObjetRequeteJSON.js');const Requetes=require('CollectionRequetes.js');const{Invocateur}=require('Invocateur.js');const UtilsRequeteJSON=require('ObjetRequeteJSON.js').utils;const tag=require('tag.js');const GTraductions=require('ObjetTraduction.js');const UtilitaireVisio={visio_enCours(aIdVisio){return new ObjetRequeteVisioAttente({}).lancerRequete({visioEnCours:true,visio:aIdVisio}).then((aJSON) =>{return aJSON;}).catch((aError) =>{if(aError&&aError.sansMessage){return Promise.reject();}
return GApplication.getMessage().afficher({message:aError||GTraductions.getValeur('UtilitaireVisio.echec')}).then(() =>{return Promise.reject();});});},visio_visioUrl(aIdVisio){return new ObjetRequeteVisioAttente({}).lancerRequete({getUrlVisio:true,visio:aIdVisio}).then((aJSON) =>{return aJSON;}).catch((aError) =>{if(aError&&aError.sansMessage){return Promise.reject();}
return GApplication.getMessage().afficher({message:aError||GTraductions.getValeur('UtilitaireVisio.echec')}).then(() =>{return Promise.reject();});});}};class ObjetRequeteVisioAttente extends ObjetRequeteConsultation{}
Requetes.inscrire('VisioAttente',ObjetRequeteVisioAttente);module.exports=UtilitaireVisio;},fn:"utilitairevisio.js"});;
IE.fModule({f:function(exports,require,module,global){const ObjetFenetre=require('ObjetFenetre.js');const GChaine=require('GChaine.js');const ObjetFenetre_SaisieVisiosCours=require('ObjetFenetre_SaisieVisiosCours.js').ObjetFenetre_SaisieVisiosCours;const TypeBoutonFenetreSaisieVisiosCours=require('ObjetFenetre_SaisieVisiosCours.js').TypeBoutonFenetreSaisieVisiosCours;const tag=require('tag.js');const GTraductions=require('ObjetTraduction.js');const ObjetListeElements=require('ObjetListeElements.js');const ObjetElement=require('ObjetElement.js');const EGenreEtat=require('Enumere_Etat.js');const Requetes=require('CollectionRequetes.js');const UtilitaireVisio=require('UtilitaireVisio.js');class UtilitaireVisios{constructor(){}
getTailleMaxLibelle(){return 50;}
getTailleMaxCommentaire(){return 255;}
getNomIconeParametrageVisios(){return'icon_cours_virtuel_lien';}
getNomIconePresenceVisios(){return'icon_cours_virtuel';}
getHintListeVisiosCours(aListeVisiosCours){const H=[];if(!!aListeVisiosCours&&aListeVisiosCours.GetNbrElementsExistes()>0){aListeVisiosCours.parcourir(function(aVisioCours){H.push(this.getHintVisio(aVisioCours));}.bind(this));}
return H.join('');}
getHintVisio(aElementVisios){const H=[];if(aElementVisios){if(!!aElementVisios.libelleLien){H.push('<span style="font-weight: bold;">',aElementVisios.libelleLien,'</span>');} else if(!!aElementVisios.url){H.push(aElementVisios.url);}
if(!!aElementVisios.commentaire){if(H.length>0){H.push('<br/>');}
H.push(GChaine.ToHTML(aElementVisios.commentaire));}}
return H.join('');}
ouvrirLiensVisioCours(aListeVisiosCours){if(!!aListeVisiosCours&&aListeVisiosCours.GetNbrElementsExistes()>0){this.ouvrirLienVisioCours(aListeVisiosCours.GetPremierElement());}}
ouvrirLienVisioCours(aVisioCours){if(!!aVisioCours&&!!aVisioCours.url&&aVisioCours.url!=='##BBB##'){const lURLCorrigee=GChaine.verifierURLHttp(GChaine.encoderUrl(aVisioCours.url));window.open(lURLCorrigee);} else if(!!aVisioCours&&aVisioCours.url==='##BBB##'){UtilitaireVisio.visio_enCours(aVisioCours).then((aJSON) =>{var lJSON=aJSON;if(!lJSON.estEnCours){GApplication.getMessage().afficher({message:aJSON.message}).then(() =>{});} else{UtilitaireVisio.visio_visioUrl(aVisioCours).then((aJSON) =>{var lJSON=aJSON;if(lJSON.urlVisio){window.open(lJSON.urlVisio);}},() =>{});}},() =>{});} else{GApplication.getMessage().afficher({message:aParamCloud.message||GTraductions.getValeur('requete.erreur')}).then(() =>{this.Fermer();});}}
ouvrirFenetreEditionVisios(aVisio,aCallbackApresModification,aCallbackValidation){const lFenetre=ObjetFenetre.creerInstance(ObjetFenetre_SaisieVisiosCours,{pere:this,initialiser:function(aInstance){aInstance.setOptionsFenetre({titre:aVisio.titreFenetre});},evenement:function(aNumeroBouton){if(aNumeroBouton!==TypeBoutonFenetreSaisieVisiosCours.Annuler){if(!!aCallbackApresModification){aCallbackApresModification();}}}});const lParams={lienVisio:aVisio,tailleMaxLibelle:this.getTailleMaxLibelle(),tailleMaxCommentaire:this.getTailleMaxCommentaire(),callbackValider:aCallbackValidation};lFenetre.setAvecSaisieDirecte(true);lFenetre.setCallbackOuvrirLienVisio(this.ouvrirLienVisioCours);lFenetre.setDonnees(lParams);}
ouvrirFenetreEditionVisiosCoursNSeances(aToutesSeances,aCours,aCallbackApresModification,aDomaine,aEstConteu){let lVisio;if(!!aCours&&!!aCours.listeVisios){aCours.listeVisios.parcourir(function(aElt){if(aElt.concerneProgression===aToutesSeances){lVisio=aElt;}});}
if(!lVisio){lVisio=new ObjetElement();lVisio.SetEtat(EGenreEtat.Creation);if(!aCours.listeVisios){aCours.listeVisios=new ObjetListeElements();}
aCours.listeVisios.add(lVisio);}
this.ouvrirFenetreEditionVisios(lVisio,aCallbackApresModification,this.callbackValidationCours.bind(this,aCours,aEstConteu,aCallbackApresModification,aDomaine));}
ouvrirFenetreEditionVisiosCours(aCours,aCallbackApresModification,aDomaine,aEstConteu){let lVisio;if(!!aDomaine&&aDomaine.GetNbrValeurs()>1){lVisio=new ObjetElement();lVisio.SetEtat(EGenreEtat.Creation);if(!aCours.listeVisios){aCours.listeVisios=new ObjetListeElements();}
aCours.listeVisios.add(lVisio);} else{lVisio=this.obtenirLienVisioDeCours(aCours);}
this.ouvrirFenetreEditionVisios(lVisio,aCallbackApresModification,this.callbackValidationCours.bind(this,aCours,aEstConteu,aCallbackApresModification,aDomaine));}
obtenirLienVisioDeCours(aElement){let lVisio;if(!!aElement){if(!aElement.listeVisios){aElement.listeVisios=new ObjetListeElements();}
if(aElement.listeVisios.GetNbrElementsExistes()===0){const lNouveauVisio=new ObjetElement();lNouveauVisio.SetEtat(EGenreEtat.Creation);aElement.listeVisios.add(lNouveauVisio);}
lVisio=aElement.listeVisios.GetPremierElement();aElement.listeVisios.parcourir(function(aElt){if(!aElt.concerneProgression){lVisio=aElt;}});}
return lVisio;}
ouvrirFenetreEditionVisiosProgramme(aProgramme,aEstContenu,aCallbackApresModification){let lVisio;if(!!aProgramme){if(!aProgramme.liensVisio){aProgramme.liensVisio=new ObjetListeElements();}
if(aProgramme.liensVisio.GetNbrElementsExistes()===0){const lNouveauVisio=new ObjetElement();lNouveauVisio.SetEtat(EGenreEtat.Creation);aProgramme.liensVisio.add(lNouveauVisio);}
lVisio=aProgramme.liensVisio.GetPremierElement();}
this.ouvrirFenetreEditionVisios(lVisio,aCallbackApresModification,this.callbackValidationProgramme.bind(this,aProgramme,aEstContenu,aCallbackApresModification));}
callbackValidationCours(aCours,aEstContenu,aCallbackApresModification,aDomaine){const lParamsSaisie={cours:aCours.toJSON(),domaine:aDomaine,estContenu:aEstContenu,estProgramme:!aEstContenu,estCours:true,elementParent:aCours.toJSON(),listeVisio:aCours.listeVisios};lParamsSaisie.cours.dateCours=aCours.DateDuCours;lParamsSaisie.listeVisio.setSerialisateurJSON({methodeSerialisation:function(aElement,AJSON){AJSON.url=aElement.url;AJSON.libelleLien=aElement.libelleLien;AJSON.commentaire=aElement.commentaire;}});Requetes('SaisieVisio',this).lancerRequete(lParamsSaisie).then(function(){if(aCallbackApresModification){aCallbackApresModification.call(this);}});}
callbackValidationProgramme(aProgramme,aEstContenu,aCallbackApresModification){const lParamsSaisie={programme:aProgramme.toJSON(),estContenu:aEstContenu,estProgramme:!aEstContenu,estCours:false,elementParent:aProgramme.toJSON(),listeVisio:aProgramme.liensVisio};lParamsSaisie.listeVisio.setSerialisateurJSON({methodeSerialisation:function(aElement,AJSON){AJSON.url=aElement.url;AJSON.libelleLien=aElement.libelleLien;AJSON.commentaire=aElement.commentaire;}});Requetes('SaisieVisio',this).lancerRequete(lParamsSaisie).then(function(){if(aCallbackApresModification){aCallbackApresModification.call(this);}});}
ouvrirFenetreConsultVisio(aElementVisio,aOptions){if(aElementVisio&&aElementVisio.url){const lUrl=aElementVisio.url;const lLibelleLien=aElementVisio.libelleLien;const lCommentaire=aElementVisio.commentaire;const lAvecLibelleLien=(!!lLibelleLien&&lLibelleLien.length>0);const lAvecCommentaire=(!!lCommentaire&&lCommentaire.length>0);if(lUrl!=='##BBB##'&&(lAvecLibelleLien||lAvecCommentaire)){const lMessage=[];lMessage.push(tag('div',{class:'AlignementMilieu'},tag('ie-chips',{class:['iconic',this.getNomIconePresenceVisios()],href:GChaine.verifierURLHttp(lUrl)},lAvecLibelleLien?lLibelleLien:GTraductions.getValeur('FenetreSaisieVisiosCours.AccederAuCoursVirtuel'))));if(lAvecCommentaire){lMessage.push('<div class="EspaceHaut10">',GChaine.ToHTML(lCommentaire),'</div>');}
const lFenetreLienVisioCours=ObjetFenetre.creerInstance(ObjetFenetre,{pere:this,initialiser:function(aInstance){aInstance.setOptionsFenetre({modale:true,largeur:350,titre:aOptions&&aOptions.titre?aOptions.titre:'',fermerFenetreSurClicHorsFenetre:true});}});lFenetreLienVisioCours.Afficher(lMessage.join(''));} else{this.ouvrirLienVisioCours(aElementVisio);}}}}
module.exports=UtilitaireVisios;},fn:"utilitairevisios.js"});;
IE.fModule({f:function(exports,require,module,global){const UtilitaireVisios=require('UtilitaireVisios.js');class UtilitaireVisiosSco extends UtilitaireVisios{constructor(...aParams){super(...aParams);}
getTailleMaxLibelle(){return GParametres.tailleMaxLibelleUrlCours;}
getTailleMaxCommentaire(){return GParametres.tailleMaxCommentaireUrlCours;}}
module.exports={UtilitaireVisios:new UtilitaireVisiosSco()};},fn:"utilitairevisiossco.js"});;
IE.fModule({f:function(exports,require,module,global){const Identite=require('ObjetIdentite.js');const ObjetFicheEvenement=require('ObjetFicheEvenement.js');const ObjetFenetre=require('ObjetFenetre.js');const GTraductions=require('ObjetTraduction.js');const{GObjetWAI,EGenreRole,EGenreAttribut}=require('ObjetWAI.js');const MethodesTableau=require('MethodesTableau.js');const GHtml=require('GHtml.js');const{GDate}=require('ObjetDate.js');const UtilitaireVisios=require('UtilitaireVisiosSco.js').UtilitaireVisios;const tag=require('tag.js');const GChaine=require('GChaine.js');class WidgetAgenda extends Identite{getControleur(aInstance){return $.extend(true,super.getControleur(this),{getNode:function(aIndice){$(this.node).eventValidation(function(){aInstance.ficheEvenement.SetDonnees(aInstance.donnees.listeEvenements,aInstance.donnees.listeEvenements.GetElement(aIndice));});},getNodeVisio:function(aIndice,aAvecOuvertureFenetre){$(this.node).on('click',function(aEvent){const lElement=aInstance.donnees.listeEvenements.GetElement(aIndice);if(lElement&&lElement.visio){aEvent.stopPropagation();if(aAvecOuvertureFenetre){const lOptions={titre:GTraductions.getValeur('FenetreSaisieVisiosCours.URLAssocieeAuConseil')};UtilitaireVisios.ouvrirFenetreConsultVisio(lElement.visio,lOptions);}}});}});}
construire(aParams){this.donnees=aParams.donnees;const lWidget={html:_composeWidgetAgenda.call(this),nbrElements:this.donnees.listeEvenements.GetNbrElements(),afficherMessage:this.donnees.listeEvenements.GetNbrElements()===0,fermerFiches:function(){this.ficheEvenement.Fermer();}.bind(this)};$.extend(this.donnees,lWidget);aParams.construireWidget(aParams.donnees);_creerObjetstAgenda.call(this);}}
function _composeEvenement(aEvenement,i){const H=[];H.push('<li tabIndex="0" ',GObjetWAI.composeRole(EGenreRole.Link),' ',GObjetWAI.composeAttribut({genre:EGenreAttribut.label,valeur:aEvenement.GetLibelle()+' '+this.donnees.listeEvenements._getLibelleEvenement({evenement:aEvenement}).join(',')}),GHtml.composeAttr('ie-node','getNode',i),'>');H.push('<div class="wrap">');H.push('<div class="bloc-date-conteneur" aria-hidden="true">',GDate.FormatDate(aEvenement.DateDebut,'<div>%JJ</div><div>%MMM</div>'),'</div>');H.push('<div class="infos-agenda-conteneur">');H.push('<h4 title="',GTraductions.getValeur('accueil.agenda.hintLien'),'">',aEvenement.GetLibelle(),'</h4>');H.push('<span>'+this.donnees.listeEvenements._getDateEvenement({evenement:aEvenement})+'</span>');H.push('</div>');H.push('</div>');if(aEvenement.listeEleves&&aEvenement.listeEleves.length>0){H.push('<div class="liste-enfants">');MethodesTableau.parcourir(aEvenement.listeEleves,function(aEleve){H.push('<span class="circle" aria-label="'+aEleve+'" ie-hint="'+aEleve+'">',aEleve.substr(0,1),'</span>');});H.push('</div>');}
if(aEvenement.visio&&aEvenement.visio.url){if(IE.estMobile){H.push(tag('i',{class:['btn-lien-visio',UtilitaireVisios.getNomIconePresenceVisios()],'ie-node':tag.funcAttr('getNodeVisio',[i,true])}));} else{H.push(tag('a',{class:[UtilitaireVisios.getNomIconePresenceVisios()],href:GChaine.verifierURLHttp(aEvenement.visio.url),target:'_blank','ie-hint':UtilitaireVisios.getHintVisio(aEvenement.visio)||false,'ie-node':tag.funcAttr('getNodeVisio',[i,false])}));}}
H.push('</li>');return H.join('');}
function _creerObjetstAgenda(){this.ficheEvenement=ObjetFenetre.creerInstance(ObjetFicheEvenement,{pere:this,evenement:this.evenementSurFicheEvenement,initialiser:false});this.ficheEvenement.destructionSurFermeture=false;this.ficheEvenement.Initialiser();}
function _composeWidgetAgenda(){const H=[];if(this.donnees.listeEvenements.GetNbrElements()>0){H.push('<ul role="list" class="liste-clickable">');for(let I=0;I<this.donnees.listeEvenements.GetNbrElements();I++){H.push(_composeEvenement.call(this,this.donnees.listeEvenements.GetElement(I),I));}
H.push('</ul>');}
return H.join('');}
module.exports=WidgetAgenda;},fn:"espace/script/widget/widgetagenda.js"});;
IE.fModule({f:function(exports,require,module,global){const GTraductions=require('ObjetTraduction.js');const TypeEtatCommentaireBillet={ECB_EnAttenteValidation:0,ECB_Publie:1,ECB_Refuse:2,ECB_Supprime:3};module.exports.TypeEtatCommentaireBillet=TypeEtatCommentaireBillet;TypeEtatCommentaireBillet.getStrEtat=function(aEtat){switch(aEtat){case TypeEtatCommentaireBillet.ECB_EnAttenteValidation:return GTraductions.getValeur('blog.typeEtatCommentaire.enAttente');case TypeEtatCommentaireBillet.ECB_Publie:return GTraductions.getValeur('blog.typeEtatCommentaire.publie');case TypeEtatCommentaireBillet.ECB_Refuse:return GTraductions.getValeur('blog.typeEtatCommentaire.refuse');case TypeEtatCommentaireBillet.ECB_Supprime:return GTraductions.getValeur('blog.typeEtatCommentaire.supprime');default:return'';}};TypeEtatCommentaireBillet.getIcon=function(aEtat){switch(aEtat){case TypeEtatCommentaireBillet.ECB_EnAttenteValidation:return'icon_edt_permanence';case TypeEtatCommentaireBillet.ECB_Publie:return'icon_check_fin';case TypeEtatCommentaireBillet.ECB_Refuse:return'icon_fermeture_widget';case TypeEtatCommentaireBillet.ECB_Supprime:return'icon_fermeture_widget';default:return'';}};TypeEtatCommentaireBillet.getClass=function(aEtat){switch(aEtat){case TypeEtatCommentaireBillet.ECB_EnAttenteValidation:return'warn';case TypeEtatCommentaireBillet.ECB_Publie:return'ok';case TypeEtatCommentaireBillet.ECB_Refuse:return'notOK';case TypeEtatCommentaireBillet.ECB_Supprime:return'delete';default:return'';}};},fn:"typeetatcommentairebillet.js"});;
IE.fModule({f:function(exports,require,module,global){const EGenreTriElement=require('Enumere_TriElement.js');const ObjetDonneesListe=require('ObjetDonneesListe.js');const ObjetTri=require('ObjetTri.js');const TTypeElementCloud=require('TTypeElementCloud.js').TTypeElementCloud;const TypeFormatPublication=require('TTypeElementCloud.js').TypeFormatPublication;const GTraductions=require('ObjetTraduction.js');const EFormatDocJoint=require('Enumere_FormatDocJoint.js');const GChaine=require('GChaine.js');const tag=require('tag.js');class DonneesListe_FichiersCloud extends ObjetDonneesListe{constructor(aDonnees){super(aDonnees);this.setOptions({avecSuppression:false,estMonoSelection:false,uniquementRepertoireVisible:false,avecSelectionRepertoire:true});}
AvecEtatSaisie(){return false;}
AvecEdition(I,aArticle,aParams){if(aParams.colonne===DonneesListe_FichiersCloud.genreColonne.selection){if(aParams.article.GetGenre()===TTypeElementCloud.tec_Dossier){return this.options.avecSelectionRepertoire;}
return true;} else{return false;}}
getTri(){return[ObjetTri.init('Genre',EGenreTriElement.Decroissant),ObjetTri.init('Libelle')];}
GetCouleurCellule(aParams){if(aParams.colonne===DonneesListe_FichiersCloud.genreColonne.selection&&!this.AvecEdition(aParams.colonne,aParams.article,aParams)){return ObjetDonneesListe.ECouleurCellule.Gris;}
return ObjetDonneesListe.ECouleurCellule.Blanc;}
GetValeur(I,D){switch(I){case DonneesListe_FichiersCloud.genreColonne.selection:return D.selection;case DonneesListe_FichiersCloud.genreColonne.nom:return D.GetGenre()===TTypeElementCloud.tec_Fichier?tag('div',{'ie-ellipsis':true},tag('i',{class:['EspaceDroit',EFormatDocJoint.getClassIconDeGenre(EFormatDocJoint.getGenreDeFichier(GChaine.extraireExtensionFichier(D.GetLibelle())))],style:'font-size:1.2em'}),D.GetLibelle()):'<div class="InlineBlock" style="width:100%;" ie-ellipsis>'+'<i class="icon_folder_close" style="padding-right:3px; font-size:1.1em;"></i>'+D.GetLibelle()+'</div>';case DonneesListe_FichiersCloud.genreColonne.taille:if(D.GetGenre()===TTypeElementCloud.tec_Fichier){return GChaine.tailleOctetsToStr(D.taille);}
break;case DonneesListe_FichiersCloud.genreColonne.formatPub:if(D.GetGenre()===TTypeElementCloud.tec_Fichier){return D.formatPub===TypeFormatPublication.FP_Natif?GTraductions.getValeur('FenetreCloud.FormatOrigine'):D.formatPub===TypeFormatPublication.FP_Pdf?GTraductions.getValeur('FenetreCloud.FormatPdf'):'-';}
break;}
return'';}
GetTypeValeur(aParams,I){switch(I){case DonneesListe_FichiersCloud.genreColonne.selection:return ObjetDonneesListe.ETypeCellule.Coche;case DonneesListe_FichiersCloud.genreColonne.nom:return ObjetDonneesListe.ETypeCellule.Html;case DonneesListe_FichiersCloud.genreColonne.taille:return ObjetDonneesListe.ETypeCellule.Texte;case DonneesListe_FichiersCloud.genreColonne.formatPub:return ObjetDonneesListe.ETypeCellule.Texte;}
return'';}
GetVisible(aDonnee){return this.options.uniquementRepertoireVisible?aDonnee.GetGenre()===TTypeElementCloud.tec_Dossier:true;}
fusionCelluleAvecColonnePrecedente(aParams,I,D){if(I===DonneesListe_FichiersCloud.genreColonne.taille&&D.GetGenre()===TTypeElementCloud.tec_Dossier){return true;}
return false;}
SurEdition(aParams,I,D,V){switch(I){case DonneesListe_FichiersCloud.genreColonne.selection:if(V&&this.options.estMonoSelection){this.Donnees.parcourir((aArticle) =>{if(aArticle.selection){aArticle.selection=false;}});}
D.selection=V;break;}}
AvecEvenement_ApresEdition(aLigne,aColonne){if(aColonne===DonneesListe_FichiersCloud.genreColonne.selection){return true;}
return false;}}
DonneesListe_FichiersCloud.genreColonne={selection:0,nom:1,formatPub:2,taille:3};module.exports=DonneesListe_FichiersCloud;},fn:"donneesliste_fichierscloud.js"});;
IE.fModule({f:function(exports,require,module,global){require('script/css/ObjetScroll.css');const Callback=require('Callback.js');const MethodesObjet=require('MethodesObjet.js');const MethodesTableau=require('MethodesTableau.js');const GHtml=require('GHtml.js');const GPosition=require('GPosition.js');const Identite=require('ObjetIdentite.js');const{GObjetWAI,EGenreRole,EGenreAttribut}=require('ObjetWAI.js');const Support=require('ObjetSupport.js');const GStyle=require('GStyle.js');const EGenreScroll={Vertical:0,Horizontal:1};const EGenreScrollEvenement={Deplacement:0,TailleZone:1,TailleContenu:2,TailleScroll:3};class ObjetScroll extends Identite{constructor(aNom,aIdent,aPere,aEvenement,aGenre,aEvenementDecalage){super(aNom,aIdent,aPere,aEvenement);if(MethodesObjet.isObject(aNom)){this.Genre=aNom.genre;this.EvenementDecalage=aNom.evenementDecalage;} else{this.Genre=aGenre;this.EvenementDecalage=aEvenementDecalage;}
this.Largeur=GNavigateur.GetLargeurBarreDeScroll();this.setOptions({avecFakeTrackBar:Support.tailleScrollBar===0});this.tailleScrollPersonnalisee=false;this.tailleMin=22;this.avecScrollEnTactile=false;this.Position=0;this.nbLigneScroll=2;this.pas=0;this.callBackDecalage=new Callback(aPere,aEvenementDecalage);this.zonesSansScrollTouch=[];this.styleSheetDisabled=GStyle.styleSheetDisabled();}
GetLargeur(){return this.Largeur;}
SetDonnees(...aParams){let lElement;this.Position=0;this.Zones=[];for(let I=0;I<aParams.length;I++){if(GHtml.elementExiste(this.GetIdZone(aParams[I]))){this.Zones.push(aParams[I]);}}
if(this.Zones.length===0){if(aParams.length>0){return;} else{this.Zones.push(0);}}
this.TailleZone=this.callback.appel(EGenreScrollEvenement.TailleZone);this.TailleContenu=this.callback.appel(EGenreScrollEvenement.TailleContenu);if(!this.TailleContenu){this.TailleContenu=this.GetTaille(this.GetIdContenu(this.Zones[0]));}
;if(!this.TailleZone||this.styleSheetDisabled||(global.GNavigateur&&GNavigateur.isLayoutTactile&&!this.avecScrollEnTactile&&(this.TailleContenu<this.TailleZone||this.TailleContenu>this.TailleZone))){this.TailleZone=this.TailleContenu;}
this.TailleZone=Math.min(this.TailleZone,this.TailleContenu);this.TailleZone=Math.max(this.TailleZone,0);this.TailleContenu=Math.max(this.TailleContenu,0);this.tailleScroll=this.TailleZone;if(this.tailleScrollPersonnalisee){this.tailleScroll=Math.max(0,this.callback.appel(EGenreScrollEvenement.TailleScroll,this.TailleZone)||this.TailleZone);}
for(let I=0;I<this.Zones.length;I++){this.SetTaille(this.GetIdZone(this.Zones[I]),this.TailleZone);}
this.Zones.forEach(function(aVal){$('#'+this.GetIdZone(aVal).escapeJQ()).off(this.Genre===EGenreScroll.Vertical?'scroll.ObjetScrollV wheel.ObjetScrollV touchmove.ObjetScrollV pointermove.ObjetScrollV pointerdown.ObjetScrollV':'scroll.ObjetScrollH wheel.ObjetScrollH touchmove.ObjetScrollH pointermove.ObjetScrollH pointerdown.ObjetScrollH');}.bind(this));if(this.TailleContenu>this.TailleZone){if(this.pas===0){while(this.callback.appel(EGenreScrollEvenement.Deplacement,++this.pas)===0&&this.pas<this.TailleContenu){continue;}}
if(this.pas<3){this.pas=this.callback.appel(EGenreScrollEvenement.Deplacement,this.pas);}
GHtml.setHtml(this.GetIdScroll(),this.Compose(),{instance:this});this._avecScrollConstruit=true;$('#'+this.Nom.escapeJQ()).attr('tabIndex','-1');if(this.Genre===EGenreScroll.Vertical){for(let I=0;I<this.Zones.length;I++){$('#'+this.GetIdZone(this.Zones[I]).escapeJQ()).on('scroll.ObjetScrollV',{instance:this,genre:this.Zones[I]},function(aEvent){aEvent.data.instance.Actualiser(aEvent.data.genre);}).on('wheel.ObjetScrollV',{aObjet:this},surMouseWheelV);if(_estTactile()&&this.zonesSansScrollTouch.indexOf(this.Zones[I])=== -1){$('#'+this.GetIdZone(this.Zones[I]).escapeJQ()).on({'pointerdown.ObjetScrollV':surPointerDownV,'pointermove.ObjetScrollV':surPointerMoveV,'touchmove.ObjetScrollV':surTouchMoveV},{aObjet:this});}}} else{for(let I=0;I<this.Zones.length;I++){$('#'+this.GetIdZone(this.Zones[I]).escapeJQ()).on('scroll.ObjetScrollH',{instance:this,genre:this.Zones[I]},function(aEvent){aEvent.data.instance.Actualiser(aEvent.data.genre);}).on('wheel.ObjetScrollH',{aObjet:this},surMouseWheelH);if(_estTactile()&&this.zonesSansScrollTouch.indexOf(this.Zones[I])=== -1){$('#'+this.GetIdZone(this.Zones[I]).escapeJQ()).on({'pointerdown.ObjetScrollH':surPointerDownH,'pointermove.ObjetScrollH':surPointerMoveH,'touchmove.ObjetScrollH':surTouchMoveH},{aObjet:this});}}}} else{if(this._avecScrollConstruit){this._avecScrollConstruit=false;GHtml.setHtml(this.GetIdScroll(),'');}}
for(let I=0;I<this.Zones.length;I++){lElement=GHtml.getElement(this.GetIdZone(this.Zones[I]));if(lElement&&lElement.style){lElement.style.position='relative';}}}
avecScrollVisible(){return this._avecScrollConstruit;}
getControleur(aInstance){return $.extend(true,super.getControleur(this),{getNodeScroll:function(){$(this.node).on('scroll',function(){const _getPosition=function(){return Math.round(aInstance.Genre===EGenreScroll.Horizontal?this.scrollLeft:this.scrollTop);}.bind(this);if(!aInstance._tickingScroll){if(window.requestAnimationFrame){window.requestAnimationFrame(function(){aInstance.EvenementSurScroll(_getPosition());delete aInstance._tickingScroll;});} else{aInstance.EvenementSurScroll(_getPosition());}}
aInstance._tickingScroll=true;});}});}
Compose(){let LStyleScroll,LStyleContenu,lStyleBarre;const lTailleZone=this.tailleScroll,lTailleContenu=_getTailleScrollDeTailleContenu.call(this,this.TailleContenu);if(this.options.avecFakeTrackBar){this._tailleFakeScrollBar=Math.min(this.tailleScroll-2,Math.round(lTailleZone/lTailleContenu*lTailleZone));}
if(this.Genre===EGenreScroll.Horizontal){LStyleScroll='width:'+lTailleZone+'px; height:'+this.Largeur+'px; min-width:'+this.tailleMin+'px;';LStyleContenu='width:'+lTailleContenu+'px; height:'+this.Largeur+'px;';lStyleBarre='height:'+this.Largeur+'px;width:'+this._tailleFakeScrollBar+'px;';} else{LStyleScroll='height:'+lTailleZone+'px; width:'+this.Largeur+'px; min-height:'+this.tailleMin+'px;';LStyleContenu='height:'+lTailleContenu+'px; width:'+this.Largeur+'px;';lStyleBarre='width:'+this.Largeur+'px;height:'+this._tailleFakeScrollBar+'px;';}
const H=[];H.push('<div ie-node="getNodeScroll" class="ObjetScroll ',(this.Genre===EGenreScroll.Horizontal?'horizontal':'vertical'),(this.options.avecFakeTrackBar?' fakeTrackBar':''),'" ',' aria-hidden="true" ',GObjetWAI.composeRole(EGenreRole.Scrollbar),' ',GObjetWAI.composeAttribut({genre:EGenreAttribut.controls,valeur:this.GetIdZone(this.Zones[0])}),' ',this.Genre===EGenreScroll.Horizontal?GObjetWAI.composeAttribut({genre:EGenreAttribut.orientation,valeur:'horizontal'})+' ':'','tabindex="-1" id="'+this.Nom+'" style="'+LStyleScroll+'">');if(this.options.avecFakeTrackBar){H.push('<div class="fake_contenu" style="'+lStyleBarre+'"></div>');}
H.push('<div style="'+LStyleContenu+'"></div>');H.push('</div>');return H.join('');}
Vider(){GHtml.setDisplay(this.GetIdScroll(),false);}
EvenementSurScroll(APosition){if(MethodesObjet.isNumber(APosition)){APosition=Math.round(APosition);}
const LPosition=this.callback.appel(EGenreScrollEvenement.Deplacement,APosition===null||APosition===undefined?this.GetPosition():_getTailleContenuDeTailleScroll.call(this,APosition));for(let I=0;I<this.Zones.length;I++){const lIdZone=this.GetIdZone(this.Zones[I]);if(LPosition!==this.GetPosition(lIdZone)){this.SetPosition(lIdZone,LPosition);}}
this.callBackDecalage.appel(this.Position-LPosition);if(this.Position!==LPosition){this.SetPosition(this.Nom,LPosition);}}
Actualiser(I){this.SetPosition(this.Nom,this.GetPosition(this.GetIdZone(I)));}
GetPosition(aId){const lNom=aId||this.Nom;const lElement=GHtml.getElement(lNom);let lPosition=0;if(lElement){lPosition=this.Genre===EGenreScroll.Horizontal?lElement.scrollLeft:lElement.scrollTop;if(lNom===this.Nom){lPosition=_getTailleContenuDeTailleScroll.call(this,lPosition);}}
return lPosition;}
SetPosition(ANom,APosition){if(!$.isNumeric(APosition)){return false;}
this.Position=APosition;const lElement=GHtml.getElement(ANom);if(!lElement){return;}
if(ANom===this.Nom){const lPositionScroll=_getTailleScrollDeTailleContenu.call(this,APosition);if(this.Genre===EGenreScroll.Horizontal){lElement.scrollLeft=lPositionScroll;} else{lElement.scrollTop=lPositionScroll;}} else{if(this.Genre===EGenreScroll.Horizontal){lElement.scrollLeft=APosition;} else{lElement.scrollTop=APosition;}}
if(this.options.avecFakeTrackBar){const lElementFake=$('#'+this.Nom.escapeJQ()+' >.fake_contenu').get(0);if(lElementFake){const lTailleContenu=_getTailleScrollDeTailleContenu.call(this,this.TailleContenu);let lPosition=APosition+APosition*(this.TailleZone-this._tailleFakeScrollBar)/(this.TailleContenu-this.TailleZone);lPosition=Math.max(Math.min(lPosition,lTailleContenu-this._tailleFakeScrollBar),0);if(this.Genre===EGenreScroll.Horizontal){GPosition.setLeft(lElementFake,lPosition);} else{GPosition.setTop(lElementFake,lPosition);}}}}
GetTaille(ANom){return this.Genre===EGenreScroll.Horizontal?GPosition.getWidth(ANom):GPosition.getHeight(ANom);}
SetTaille(ANom,ATaille){return this.Genre===EGenreScroll.Horizontal?GPosition.setWidth(ANom,ATaille):GPosition.setHeight(ANom,ATaille);}
GetIdScroll(){return this.Nom+'_Scroll';}
GetIdZone(I){return this.Pere.Nom+'_Zone_'+(I===null||I===undefined?0:I);}
GetIdContenu(I){return this.Pere.Nom+'_Contenu_'+(I===null||I===undefined?0:I);}
scrollTo(aScroll){const lElement=GHtml.getElement(this.Nom);if(lElement){const lPositionScroll=_getTailleScrollDeTailleContenu.call(this,aScroll);this.EvenementSurScroll(lPositionScroll);if(this.Genre===EGenreScroll.Vertical){lElement.scrollTop=lPositionScroll;} else{lElement.scrollLeft=lPositionScroll;}}}
scrollToElement(aElement){if(this.TailleContenu<=this.TailleZone){return;}
let lJElement,e,eleHeight,eleWidth,eleTop=0,eleLeft=0,lMaxVisible,lPositionDestination;try{lJElement=e=$(aElement);} catch(err){return;}
if(e.length===0){return;}
const lTabId=[];for(let I=0;I<this.Zones.length;I++){lTabId.push(this.GetIdZone(this.Zones[I]));}
while(!MethodesTableau.existe(e.get(0).id,lTabId)){let lPosElement=e.position();eleTop+=lPosElement.top;eleLeft+=lPosElement.left;e=e.offsetParent();if(/^body|html$/i.test(e[0].nodeName)){return;}}
eleTop+=e.get(0).scrollTop;eleLeft+=e.get(0).scrollLeft;const lPosition=this.GetPosition();lMaxVisible=lPosition+this.TailleZone;if(this.Genre===EGenreScroll.Vertical){eleHeight=lJElement.outerHeight();if(eleTop<lPosition){lPositionDestination=eleTop-this.Largeur;} else if(eleTop+eleHeight>lMaxVisible){lPositionDestination=eleTop-this.TailleZone+eleHeight+this.Largeur;}} else{eleWidth=lJElement.outerWidth();if(eleLeft<lPosition){lPositionDestination=eleLeft-this.Largeur;} else if(eleLeft+eleWidth>lMaxVisible){lPositionDestination=eleLeft-this.TailleZone+eleWidth+this.Largeur;}}
if(MethodesObjet.isNumber(lPositionDestination)){this.scrollTo(_getTailleScrollDeTailleContenu.call(this,Math.max(0,lPositionDestination)));}
return true;}}
function _affectationScroll(aInstance,aElement,aScroll,aVertical,aSurTouch){const lTaille=_getTailleScrollDeTailleContenu.call(aInstance,aInstance.callback.appel(EGenreScrollEvenement.Deplacement,_getTailleContenuDeTailleScroll.call(aInstance,aScroll)));const lGetter=aVertical?'scrollTop':'scrollLeft';const lResult=aElement[lGetter]!==lTaille;aElement[lGetter]=lTaille;if(aSurTouch||aElement[lGetter]!==lTaille){aInstance.EvenementSurScroll(aElement[lGetter]);}
return lResult;}
function surMouseWheelV(event){let lDeltaY=event.originalEvent.deltaY;if(isNaN(lDeltaY)){lDeltaY=0;}
lDeltaY=lDeltaY>0?Math.min(1,lDeltaY):Math.max(-1,lDeltaY);const lInstance=event.data.aObjet;const lElement=GHtml.getElement(lInstance.Nom);if(lElement){const lScroll=lElement.scrollTop+lInstance.nbLigneScroll*lInstance.pas*Math.round(lDeltaY);_affectationScroll(lInstance,lElement,lScroll,true);return false;}
return true;}
function surPointerDownV(aEvent){aEvent.data.aObjet.scrollStartPosY=aEvent.pointerType==='touch'&&aEvent.originalEvent.isPrimary?aEvent.originalEvent.pageY:null;}
function surPointerMoveV(aEvent){if(aEvent.data.aObjet.scrollStartPosY===null||aEvent.pointerType!=='touch'||!aEvent.originalEvent.isPrimary){return;}
if(aEvent.target&&aEvent.target.closest('.IE_draggable')){return;}
const lInstance=aEvent.data.aObjet;const lElement=GHtml.getElement(lInstance.Nom);if(lElement){const lPageY=aEvent.originalEvent.pageY;const lDecalage=lInstance.scrollStartPosY-lPageY;if(Math.abs(lDecalage)>=1){const lScroll=lElement.scrollTop+lDecalage;if(_affectationScroll(lInstance,lElement,lScroll,true,true)){lInstance.scrollStartPosY=lPageY;}}}}
function surTouchMoveV(aEvent){if(aEvent.data.aObjet.scrollStartPosY===null){return;}
aEvent.originalEvent.preventDefault();return false;}
function surMouseWheelH(event){let lDeltaX=event.originalEvent.deltaX;if(isNaN(lDeltaX)){lDeltaX=0;}
lDeltaX=lDeltaX>0?Math.min(1,lDeltaX):Math.max(-1,lDeltaX);const lInstance=event.data.aObjet;const lElement=GHtml.getElement(lInstance.Nom);if(lElement){const lScroll=lElement.scrollLeft+(lInstance.nbLigneScroll*lInstance.pas*Math.floor(lDeltaX));_affectationScroll(lInstance,lElement,lScroll,false);return false;}
return true;}
function surPointerDownH(aEvent){aEvent.data.aObjet.scrollStartPosX=aEvent.pointerType==='touch'&&aEvent.originalEvent.isPrimary?aEvent.originalEvent.pageX:null;}
function surPointerMoveH(aEvent){if(aEvent.data.aObjet.scrollStartPosX===null||aEvent.pointerType!=='touch'||!aEvent.originalEvent.isPrimary){return;}
if(aEvent.target&&aEvent.target.closest('.IE_draggable')){return;}
const lInstance=aEvent.data.aObjet;const lElement=GHtml.getElement(lInstance.Nom);if(lElement){const lPageX=aEvent.originalEvent.pageX;const lDecalage=lInstance.scrollStartPosX-lPageX;if(Math.abs(lDecalage)>=1){const lScroll=lElement.scrollLeft+lDecalage;if(_affectationScroll(lInstance,lElement,lScroll,false,true)){lInstance.scrollStartPosX=lPageX;}}}}
function surTouchMoveH(aEvent){if(aEvent.data.aObjet.scrollStartPosX===null){return;}
aEvent.originalEvent.preventDefault();return false;}
function _estTactile(){return window.GNavigateur&&window.GNavigateur.isTactile;}
function _getTailleScrollDeTailleContenu(aValeur){if(!this.tailleScrollPersonnalisee||this.tailleScroll===this.TailleZone||this.tailleScroll<=0){return aValeur;}
return Math.round(aValeur*this.tailleScroll/this.TailleZone);}
function _getTailleContenuDeTailleScroll(aValeur){if(!this.tailleScrollPersonnalisee||this.tailleScroll===this.TailleZone||this.tailleScroll<=0){return aValeur;}
return Math.round(aValeur*this.TailleZone/this.tailleScroll);}
module.exports={EGenreScroll:EGenreScroll,EGenreScrollEvenement:EGenreScrollEvenement,ObjetScroll:ObjetScroll};},fn:"objetscroll.js"});;
IE.fModule({f:function(exports,require,module,global){
function UtilitaireResizeObserver(){}
var c_idData='data_resizeObbserver';UtilitaireResizeObserver.observe=function(aParams){var lParams=Object.assign({node:null,nodeObserve:null,callback:null,timeoutCallback:100},aParams);var lNodeObserve=lParams.nodeObserve||lParams.node;if(!lParams.node||!lNodeObserve||!lParams.callback){return;}
var lData={timeout:null,surInit:true};UtilitaireResizeObserver.unobserve(lParams.node);try{var lRect=$.extend({},lNodeObserve.getBoundingClientRect());lData.surInit=true;lData.observer=new ResizeObserver(function(aObservers){if(lData.surCallback){delete lData.surCallback;clearTimeout(lData.timeoutReinit);return;}
if(aObservers[0]&&aObservers[0].contentRect){var lWidthCurrent=aObservers[0].contentRect.width;var lHeightCurrent=aObservers[0].contentRect.height;if(lWidthCurrent>0&&lHeightCurrent>0&&((Math.abs(lWidthCurrent-lRect.width)>1)||(Math.abs(lHeightCurrent-lRect.height)>1))){lRect.width=lWidthCurrent;lRect.height=lHeightCurrent;var lFunc=function(){lData.surCallback=true;lParams.callback();lData.timeoutReinit=setTimeout(function(){delete lData.surCallback;},10);};if(lData.surInit){if(lData.timeout){return;}
lData.timeout=setTimeout(function(){lData.surInit=false;lData.timeout=null;lFunc();},lParams.timeoutCallback);} else{lFunc();}}}});lData.observer.observe(lNodeObserve);lData.element=lNodeObserve;$(lParams.node).data(c_idData,lData);} catch(e){}
$(lParams.node).off('destroyed.resizeobserver').on('destroyed.resizeobserver',function(){UtilitaireResizeObserver.unobserve(this);});};UtilitaireResizeObserver.unobserve=function(aNode){var lData=$(aNode).data(c_idData);if(lData){$(aNode).data(c_idData,null);if(lData.timeout){clearTimeout(lData.timeout);lData.timeout=null;}
if(lData.observer&&lData.element){lData.observer.unobserve(lData.element);}}};module.exports=UtilitaireResizeObserver;},fn:"utilitaireresizeobserver.js"});;
IE.fModule({f:function(exports,require,module,global){const IEHtml=require('IEHtml.js');const GStyle=require('GStyle.js');const ObjetScroll=require('ObjetScroll.js').ObjetScroll;const EGenreScroll=require('ObjetScroll.js').EGenreScroll;const EGenreScrollEvenement=require('ObjetScroll.js').EGenreScrollEvenement;const MethodesObjet=require('MethodesObjet.js');const UtilitaireResizeObserver=require('UtilitaireResizeObserver.js');IEHtml.addAttribut('ie-scroll',function(aContexteCourant,aNodeName,aAttributValue,aOutils){const lValue=_creerScroll(aContexteCourant,aAttributValue,aOutils,true,true);return lValue;});IEHtml.addAttribut('ie-scrollv',function(aContexteCourant,aNodeName,aAttributValue,aOutils){const lValue=_creerScroll(aContexteCourant,aAttributValue,aOutils,true,false);return lValue;});IEHtml.addAttribut('ie-scrollh',function(aContexteCourant,aNodeName,aAttributValue,aOutils){const lValue=_creerScroll(aContexteCourant,aAttributValue,aOutils,false,true);return lValue;});function _creerScroll(aContexteCourant,aAttributValue,aOutils,aAvecScrollV,aAvecScrollH){if(!aContexteCourant.controleur){return true;}
let lReserverPlaceScrollVisible=false;if(aContexteCourant.node.hasAttribute('ie-scrollReservation')){lReserverPlaceScrollVisible=true;aContexteCourant.node.removeAttribute('ie-scrollReservation');}
let lReserverPlaceScrollFixe=false;if(aContexteCourant.node.hasAttribute('ie-scrollReservationFixe')){lReserverPlaceScrollFixe=true;aContexteCourant.node.removeAttribute('ie-scrollReservationFixe');}
aOutils.addCommentaireDebug(aContexteCourant.node,'ie-scroll'+(!aAvecScrollV?!aAvecScrollH?'':'h':'v')+(aAttributValue?'="'+aAttributValue+'"':'')+(lReserverPlaceScrollVisible?' ie-scrollReservation':'')+(lReserverPlaceScrollFixe?' ie-scrollReservationFixe':''));const lNom=aAttributValue;let lInfosCallback=null;let lInfosInstanceV;let lInfosInstanceH;let lJNode;let lZone;let lContenu;let lBoucheTrou;const lApi={avecScrollV:aAvecScrollV,avecScrollH:aAvecScrollH,tailleScroll:11,heightContenuMinZone:false,reserverPlaceScrollVisible:lReserverPlaceScrollVisible,reserverPlaceScrollFixe:lReserverPlaceScrollFixe,couleurBoucheTrou:GCouleur.themeNeutre.legere,decalageScrollH:1,decalageScrollV:1,avecResizeObserver:true,avecRefresh:true,actualiser:_actualiser,scrollToElement:_scrollToElement,surRefresh:null,resizeEnCours:false,surResize:function(){if(!lApi.resizeEnCours){_surPreResize();_surPostResize();}},surPreResize:_surPreResize,surPostResize:_surPostResize,scrollV:null,scrollH:null,scrollsVisible:{v:false,h:false},zone:null,heightZone:0,heightContenu:0,widthZone:0,widthContenu:0};if(lNom){lInfosCallback=aOutils.getAccesParametres(lNom,aContexteCourant);if(!lInfosCallback.estFonction){return true;}
lInfosCallback.callback([lApi]);}
lJNode=$(aContexteCourant.node);lJNode.wrapInner('<div>');lZone=lJNode.get(0).firstChild;lApi.zone=lZone;if(!lZone){return true;}
lContenu=lZone.firstChild;lBoucheTrou=null;if(!lContenu){return true;}
let lPere={};let lLargeur;if(lApi.avecScrollV){lInfosInstanceV=aOutils.creerInstanceIdentite(ObjetScroll,{pere:lPere,evenement:function(aGenre,aScrollTop){switch(aGenre){case EGenreScrollEvenement.Deplacement:return aScrollTop;case EGenreScrollEvenement.TailleZone:return lApi.heightZone+(lApi.scrollsVisible.h&&!lApi.reserverPlaceScrollFixe?-lLargeur:0);case EGenreScrollEvenement.TailleContenu:return lApi.heightContenu;}},genre:EGenreScroll.Vertical});lApi.scrollV=lInfosInstanceV.instance;lPere.Nom='pere_'+lApi.scrollV.GetNom();lApi.scrollV.pas=30;lApi.scrollV.Largeur=lApi.tailleScroll;lApi.scrollV.avecScrollEnTactile=true;}
if(lApi.avecScrollH){lInfosInstanceH=aOutils.creerInstanceIdentite(ObjetScroll,{pere:lPere,evenement:function(aGenre,aScrollTop){switch(aGenre){case EGenreScrollEvenement.Deplacement:return aScrollTop;case EGenreScrollEvenement.TailleZone:return lApi.widthZone+(lApi.scrollsVisible.v&&!lApi.reserverPlaceScrollFixe?-lLargeur:0);case EGenreScrollEvenement.TailleContenu:return lApi.widthContenu;}},genre:EGenreScroll.Horizontal});lApi.scrollH=lInfosInstanceH.instance;lPere.Nom='pere_'+lApi.scrollH.GetNom();lApi.scrollH.pas=30;lApi.scrollH.Largeur=lApi.tailleScroll;lApi.scrollH.avecScrollEnTactile=true;}
lJNode.css({'position':'relative','overflow':'hidden'});const lCss={'overflow':'hidden','box-sizing':'border-box'};if(lApi.reserverPlaceScrollFixe){if(lApi.avecScrollV){lCss['padding-right']=lApi.tailleScroll;}
if(lApi.avecScrollH){lCss['padding-bottom']=lApi.tailleScroll;}
if(lApi.reserverPlaceScrollVisible){lApi.reserverPlaceScrollVisible=false;}}
$(lZone).css(lCss);const lJScroll=lJNode.find('#'+(lApi.scrollV||lApi.scrollH).GetNom().escapeJQ());lApi.DOMScroll=lJScroll.get(0);const lObjetCss={'box-sizing':'border-box'};if(lApi.heightContenuMinZone){lObjetCss.height='100%';}
$(lContenu).css(lObjetCss);lLargeur=(lApi.scrollV||lApi.scrollH).Largeur;let lBorderWidth=parseInt(lJNode.css('borderWidth')||0,10);if(lZone.id){if(lApi.scrollV){lApi.scrollV.GetIdZone=function(){return lZone.id;};}
if(lApi.scrollH){lApi.scrollH.GetIdZone=function(){return lZone.id;};}} else{lZone.id=(lApi.scrollV||lApi.scrollH).GetIdZone(0);}
if(lContenu.id){if(lApi.scrollV){lApi.scrollV.GetIdContenu=function(){return lContenu.id;};}
if(lApi.scrollH){lApi.scrollH.GetIdContenu=function(){return lContenu.id;};}} else{lContenu.id=(lApi.scrollV||lApi.scrollH).GetIdContenu(0);}
$(lZone).on('scroll',function(){if(lApi.scrollV){lApi.scrollV.Actualiser(0);}
if(lApi.scrollH){lApi.scrollH.Actualiser(0);}});function _scrollToElement(aElement){if(lApi.scrollV&&lApi.scrollsVisible.v){lApi.scrollV.scrollToElement(aElement);}
if(lApi.scrollH&&lApi.scrollsVisible.h){lApi.scrollH.scrollToElement(aElement);}}
function _actualiser(){const lForcerActualisation=_actualiserZone();_actualiserContenu(lForcerActualisation);}
function _actualiserZone(aForcer){const lHeight=lApi.avecScrollV?lJNode.height():0,lWidth=lApi.avecScrollH?lJNode.width():0;if(!aForcer&&lHeight===lApi.heightZone&&lWidth===lApi.widthZone){return false;}
lApi.heightZone=lHeight;lApi.widthZone=lWidth;if(lApi.avecScrollV){$(lZone).height(lApi.heightZone);}
if(lApi.avecScrollH){$(lZone).width(lApi.widthZone);}
return true;}
function _actualiserContenu(aForcerActualisation){const lHeight=lApi.avecScrollV?_getHeightContenu():0;const lWidth=lApi.avecScrollH?lContenu.scrollWidth:0;let lScrollTop= -1;let lScrollLeft= -1;if(!aForcerActualisation&&lHeight===lApi.heightContenu&&lWidth===lApi.widthContenu){return;}
lApi.heightContenu=lHeight;lApi.widthContenu=lWidth;if(lApi.scrollsVisible.v){lScrollTop=lZone.scrollTop;lApi.scrollV.SetDonnees(0);$(lZone).height(lApi.heightZone);$('#'+lApi.scrollV.GetIdScroll().escapeJQ()).remove();if(lApi.reserverPlaceScrollVisible){$(lZone).css('padding-right','');}}
if(lApi.scrollsVisible.h){lScrollLeft=$(lZone).scrollLeft();lApi.scrollH.SetDonnees(0);$('#'+lApi.scrollH.GetIdScroll().escapeJQ()).remove();if(lApi.reserverPlaceScrollVisible){$(lZone).css('padding-bottom','');}}
if(lApi.avecScrollH){$(lZone).width(lApi.widthZone);}
if(lApi.avecScrollV){$(lZone).height(lApi.heightZone);}
if(lBoucheTrou){$(lBoucheTrou).remove();lBoucheTrou=null;}
_construireScrolls();if(lApi.scrollsVisible.v&&lScrollTop>=0){lApi.scrollV.scrollTo(lScrollTop);}
if(lApi.scrollsVisible.h&&lScrollLeft>=0){lApi.scrollH.scrollTo(lScrollLeft);}}
function _surPreResize(){lApi.resizeEnCours=true;const lCss={position:'absolute',top:0,left:0,right:lApi.reserverPlaceScrollFixe?(lApi.tailleScroll+'px'):'',height:''};if(lApi.heightContenuMinZone){lCss.bottom=0;}
$(lContenu).css(lCss);$('#'+lZone.id.escapeJQ()).css({height:'100%',width:'100%'});if(lApi.scrollsVisible.v){$('#'+lApi.scrollV.GetIdScroll().escapeJQ()).hide();}
if(lApi.scrollsVisible.h){$('#'+lApi.scrollH.GetIdScroll().escapeJQ()).hide();}}
function _actualiserHeightContenu(){if(lApi.heightContenuMinZone){$(lContenu).height(lApi.scrollsVisible.v?'':'100%');}}
function _surPostResize(){_actualiserZone(true);$('#'+lContenu.id.escapeJQ()).css({position:'',top:'',left:'',right:'',overflow:'',bottom:''});if(lApi.scrollsVisible.v){$('#'+lApi.scrollV.GetIdScroll().escapeJQ()).show();}
_actualiserHeightContenu();if(lApi.scrollsVisible.h){$('#'+lApi.scrollH.GetIdScroll().escapeJQ()).show();}
_actualiserContenu(true);lApi.resizeEnCours=false;}
function _construireScrolls(){lApi.scrollsVisible=_avecScroll();const lNbPixReservation=MethodesObjet.isNumber(lApi.reserverPlaceScrollVisible)?lApi.reserverPlaceScrollVisible:lApi.tailleScroll;if(lApi.scrollsVisible.v){_construireScrollV(lApi.scrollsVisible.h);if(lApi.reserverPlaceScrollVisible){$(lZone).css('padding-right',lNbPixReservation+'px');}} else if(lApi.avecScrollV){lApi.scrollV.SetTaille(lZone,lApi.scrollV.callback.appel(EGenreScrollEvenement.TailleZone));}
_actualiserHeightContenu();if(lApi.scrollsVisible.h){_construireScrollH(lApi.scrollsVisible.v);if(lApi.reserverPlaceScrollVisible){$(lZone).css('padding-bottom',lNbPixReservation+'px');}} else if(lApi.avecScrollH){lApi.scrollH.SetTaille(lZone,lApi.scrollH.callback.appel(EGenreScrollEvenement.TailleZone));}
if(lApi.scrollsVisible.v&&lApi.scrollsVisible.h){lJNode.append('<div style="position:absolute;'+
GStyle.composeCouleurFond(lApi.couleurBoucheTrou)+'bottom:'+(lApi.decalageScrollH+lBorderWidth+parseInt(lJNode.css('paddingBottom'),10)-1)+'px;'+'right:'+(lApi.decalageScrollV+lBorderWidth+parseInt(lJNode.css('paddingRight'),10)-1)+'px;'+'width:'+(lLargeur)+'px; height:'+(lLargeur)+'px"></div>');lBoucheTrou=lJNode.get(0).lastChild;}}
function _construireScrollV(aAvecScrollH){lJNode.append('<div id="'+lApi.scrollV.GetIdScroll()+'" style="position:absolute; top:0px; bottom:'+(aAvecScrollH?lLargeur:0)+'px; right:'+(lApi.decalageScrollV+lBorderWidth+parseInt(lJNode.css('paddingRight'),10)-1)+'px; width:'+lLargeur+'px"></div>');lApi.scrollV.SetDonnees(0);}
function _construireScrollH(aAvecScrollV){lJNode.append('<div id="'+lApi.scrollH.GetIdScroll()+'" style="position:absolute; bottom:'+(lApi.decalageScrollH+lBorderWidth+parseInt(lJNode.css('paddingBottom'),10)-1)+'px; left:0px; right:'+(aAvecScrollV?lLargeur:0)+'px;'+'height:'+(lLargeur)+'px"></div>');lApi.scrollH.SetDonnees(0);}
function _avecScroll(){const lObj={v:false,h:false};let lHeightZone=lApi.heightZone;let lWidthZone=lApi.widthZone;let lWidthContenu=lApi.widthContenu;if(lApi.avecScrollV&&lApi.heightContenu>lHeightZone){lObj.v=true;lWidthZone=lWidthZone-lLargeur;if(lApi.avecScrollH){$(lZone).width(lWidthZone);lWidthContenu=lContenu.scrollWidth;$(lZone).width(lApi.widthContenu);}}
if(lApi.avecScrollH&&lWidthContenu>lWidthZone){lObj.h=true;lHeightZone=lHeightZone-lLargeur;if(lApi.avecScrollV&&lApi.heightContenu>lHeightZone){lObj.v=true;}}
return lObj;}
$(aContexteCourant.node).on('destroyed',function(){if(lInfosInstanceV){lInfosInstanceV.callbackDestruction();}
if(lInfosInstanceH){lInfosInstanceH.callbackDestruction();}
if(lApi.scrollV){lApi.scrollV.free();lApi.scrollV=null;}
if(lApi.scrollH){lApi.scrollH.free();lApi.scrollH=null;}
lJNode=null;lApi.destroyed=true;lApi.scrollV=null;lApi.scrollH=null;});function _getHeightContenu(){const lJContenu=$(lContenu);if(lApi.heightContenuMinZone){lJContenu.height('');}
const lHeight=lJContenu.height();_actualiserHeightContenu();return lHeight;}
let lCompteur=0;function _MAJVisible(){if($(aContexteCourant.node).is(':visible')){if(lApi.avecScrollV){lApi.heightZone=lJNode.height();lApi.heightContenu=_getHeightContenu();$(lZone).height(lApi.heightZone);}
if(lApi.avecScrollH){lApi.widthZone=lJNode.width();lApi.widthContenu=lContenu.scrollWidth;$(lZone).width(lApi.widthZone);}
_construireScrolls();if(lApi.surRefresh){lApi.surRefresh();}} else{lCompteur+=1;if(lCompteur>100){return;}
setTimeout(_MAJVisible,0);}}
aOutils.surInjectionHtml(aContexteCourant,function(aParams){aParams.addMutate(function(){_MAJVisible();});},true);const lFuncActualisation=function(){if(!lApi.resizeEnCours&&$(aContexteCourant.node).is(':visible')){_actualiser();if(lApi.surRefresh){lApi.surRefresh();}}};if(lApi.avecResizeObserver){UtilitaireResizeObserver.observe({node:aContexteCourant.node,nodeObserve:lContenu,callback:function(){lFuncActualisation();}});}
if(lApi.avecRefresh){aOutils.abonnerRefresh(function(){if(lApi.timeout){clearTimeout(lApi.timeout);lApi.timeout=null;}
lApi.timeout=setTimeout(function(){lFuncActualisation();},0);},aContexteCourant.node,aContexteCourant);}
return true;}
module.exports=IEHtml;},fn:"iehtml.scroll.js"});;
IE.fModule({f:function(exports,require,module,global){const EGenreBoutonSouris={Gauche:0,Droite:1};module.exports=EGenreBoutonSouris;},fn:"enumere_boutonsouris.js"});;
IE.fModule({f:function(exports,require,module,global){const EGenreEvenementTreeView={selection:0,creation:1,editionDebut:2,edition:3,editionFin:4,suppression:5,deplacement:6,menuContextuel:7,dragDebut:8,dragFin:9,selectionDblClick:10};module.exports=EGenreEvenementTreeView;},fn:"enumere_evenementtreeview.js"});;
IE.fModule({f:function(exports,require,module,global){require('produit/css/ObjetTreeView.css')
;const MethodesObjet=require('MethodesObjet.js');const MethodesTableau=require('MethodesTableau.js');const GChaine=require('GChaine.js');const GHtml=require('GHtml.js');const GPosition=require('GPosition.js');const GStyle=require('GStyle.js');const EGenreAction=require('Enumere_Action.js');const EGenreBoiteMessage=require('Enumere_BoiteMessage.js');const EEvent=require('Enumere_Event.js');require('IEHtml.scroll.js');const ZoneFenetre=require('IEZoneFenetre.js');const ObjetHint=require('objethint.js');const Identite=require('ObjetIdentite.js');const ObjetMenuContextuel=require('ObjetMenuContextuel.js');const Support=require('ObjetSupport.js');const EGenreBoutonSouris=require('Enumere_BoutonSouris.js');const EGenreEvenementTreeView=require('Enumere_EvenementTreeView.js');class ObjetTreeView extends Identite{constructor(...aParams){super(...aParams);this.idConteneur=this.Nom+'_conteneur';this.idScroll=this.Nom+'_scroll';this.idMenuContextuel=this.Nom+'.menuContextuel';this.idDraggable=this.Nom+'_drag';this.idBoutons=this.Nom+'_boutons';if(this.avecEventResizeNavigateur()){this.ajouterEvenementGlobal(EEvent.SurPreResize,this._surResize.bind(this,true));this.ajouterEvenementGlobal(EEvent.SurPostResize,this._surResize.bind(this,false));}
this.SetParametres();}
getControleur(){return $.extend(true,super.getControleur(this),{scroll:function(api){this.instance.apiScroll=api;}});}
DetruireInstances(){}
RecupererDonnees(){}
SetParametres(){this.couleurs=GCouleur.liste;this.largeurDeploiement=8;this.ecartDroitDeploiement=2;this.largeurDropInterLigne=200;this.hauteurDropInterLigne=4;}
SetDonnees(aDonneeTreeView){this.donneesRecus=true;this.donneeTreeView=aDonneeTreeView;if(this.donneeTreeView){this.donneeTreeView.parent=this;this.donneeTreeView.couleurs=this.couleurs;this.donneeTreeView.construireNodes();}
this.nodeSelection=null;this.nodeSelectionFocus=null;this._construireBoutons();this.actualiser();this._donneesRecus=true;this._surResize();}
surResize(){this._surResize(true,true);this._surResize(false,true);}
_surResize(aPreResize){const lClientRect=GPosition.getClientRect(this.Nom,true);const lWidth=aPreResize?50:Math.floor(lClientRect.innerWidth)+(Support.bordureExterneDIV?0:-2)-(this._avecBoutons?GPosition.getWidth(this.idBoutons):0);const lHeight=aPreResize?50:Math.floor(lClientRect.innerHeight)+(Support.bordureExterneDIV?0:-2);if(!aPreResize){GPosition.setTaille(this.idScroll,lWidth,lHeight);}
if(aPreResize){GPosition.setTaille(this.idScroll,lWidth,lHeight);}
if(this._objetDrag&&aPreResize){window.clearTimeout(this._timerDrag);GHtml.setHtml(this._objetDrag.elementDrag,'');GHtml.setDisplay(this._objetDrag.elementDrag,false);delete this._objetDrag;}
this.$refreshSelf();}
ConstruireAffichage(){const H=[];H.push('<div class="ObjetTreeView">');H.push('<div id="',this.idDraggable,'" class="Liste_Suppression Texte10 Gras" style="display:none;"></div>');H.push('<table cellpadding="0" cellspacing="0" border="0"><tr>');H.push('<td>');H.push('<div class="Texte10 Maigre" style="',GStyle.composeCouleurBordure(this.couleurs.bordure,1),'">');H.push('<div ie-scroll="scroll" id="',this.idScroll,'" class="Table" style="',GStyle.composeCouleurFond(GCouleur.blanc),'min-height:',ObjetTreeView.CONST_hauteurMin,'px;">');H.push('<div id="',this.idConteneur,'" class="SansMain">');H.push(this._construireTreeView());H.push('</div>');H.push('</div>');H.push('</div>');H.push('</td>');H.push('<td id="'+this.idBoutons+'" style="display:none" class="AlignementHaut boutons-commande"></td>');H.push('</tr></table>');H.push('</div>');return H.join('');}
actualiser(aAvecCallbackSelection){if(!this.donneesRecus){return;}
this._supprimerElementEdition();this._construireTreeView();this.$refreshSelf();this.setSelectionParContenuDeNode(this.nodeSelection,aAvecCallbackSelection);}
_construireBoutons(){if(!this.donneeTreeView){return;}
this._boutons={avecCreation:this.donneeTreeView.avecBoutonsEvenementDuGenre(EGenreEvenementTreeView.creation),avecEdition:this.donneeTreeView.avecBoutonsEvenementDuGenre(EGenreEvenementTreeView.edition),avecSuppression:this.donneeTreeView.avecBoutonsEvenementDuGenre(EGenreEvenementTreeView.suppression),avecDeplacement:this.donneeTreeView.avecBoutonsEvenementDuGenre(EGenreEvenementTreeView.deplacement)};this._avecBoutons=false;for(const i in this._boutons){if(this._boutons[i]){this._avecBoutons=true;}}
if(!this._avecBoutons){return;}
const H=[];if(this._boutons.avecDeplacement){H.push('<div id="'+(this.Nom+'.boutonHaut')+'"></div>');H.push('<div id="'+(this.Nom+'.boutonBas')+'"></div>');}
if(this._boutons.avecCreation){H.push('<div id="'+(this.Nom+'.boutonC')+'"></div>');}
if(this._boutons.avecEdition){H.push('<div id="'+(this.Nom+'.boutonE')+'"></div>');}
if(this._boutons.avecSuppression){H.push('<div id="'+(this.Nom+'.boutonS')+'"></div>');}
GHtml.setHtml(this.idBoutons,H.join(''),true);GHtml.setDisplay(this.idBoutons,true);if(this._boutons.avecCreation){this.boutonC=new ObjetBoutonTreeView(this.Nom+'.boutonC',this,this._evenementSurBouton);this.boutonC.setParametres(EGenreEvenementTreeView.creation,null,this.donneeTreeView.getHintBoutonsEvenementDuGenre(EGenreEvenementTreeView.creation));this.boutonC.Initialiser();}
if(this._boutons.avecEdition){this.boutonE=new ObjetBoutonTreeView(this.Nom+'.boutonE',this,this._evenementSurBouton);this.boutonE.setParametres(EGenreEvenementTreeView.edition,null,this.donneeTreeView.getHintBoutonsEvenementDuGenre(EGenreEvenementTreeView.edition));this.boutonE.Initialiser();}
if(this._boutons.avecSuppression){this.boutonS=new ObjetBoutonTreeView(this.Nom+'.boutonS',this,this._evenementSurBouton);this.boutonS.setParametres(EGenreEvenementTreeView.suppression,null,this.donneeTreeView.getHintBoutonsEvenementDuGenre(EGenreEvenementTreeView.suppression));this.boutonS.Initialiser();}
if(this._boutons.avecDeplacement){this.boutonHaut=new ObjetBoutonTreeView(this.Nom+'.boutonHaut',this,this._evenementSurBouton);this.boutonHaut.setParametres(EGenreEvenementTreeView.deplacement,true,this.donneeTreeView.getHintBoutonsEvenementDuGenre(EGenreEvenementTreeView.deplacement,true));this.boutonHaut.Initialiser();this.boutonBas=new ObjetBoutonTreeView(this.Nom+'.boutonBas',this,this._evenementSurBouton);this.boutonBas.setParametres(EGenreEvenementTreeView.deplacement,false,this.donneeTreeView.getHintBoutonsEvenementDuGenre(EGenreEvenementTreeView.deplacement));this.boutonBas.Initialiser();}
this._actualiserBoutons();}
_actualiserBoutons(){let lNodeSelection=this.nodeSelection;let lMultiSelection=false;if(MethodesObjet.isArray(this.nodeSelection)){lNodeSelection=this.nodeSelection[0];lMultiSelection=this.nodeSelection.length>1;}
if(this._boutons.avecCreation){this.boutonC.SetActif(!lMultiSelection&&this.donneeTreeView.avecCreation(lNodeSelection,null)&&this.donneeTreeView.avecMenuContextuelSurBouton(lNodeSelection,EGenreEvenementTreeView.creation));}
if(this._boutons.avecEdition){this.boutonE.SetActif(lNodeSelection&&!lMultiSelection&&this.donneeTreeView.avecEdition(lNodeSelection));}
if(this._boutons.avecSuppression){this.boutonS.SetActif(lNodeSelection&&this.donneeTreeView.avecSuppression(lNodeSelection));}
if(this._boutons.avecDeplacement){let lDeplacementHautActif=false;let lDeplacementBasActif=false;const lDragAutorise=lNodeSelection&&!lMultiSelection&&this.donneeTreeView.avecDragNDrop()&&this.donneeTreeView.dragAutorise(lNodeSelection);if(lDragAutorise){lDeplacementHautActif=this.donneeTreeView.dropAutorise(lNodeSelection,lNodeSelection.frerePrecedent(),true);lDeplacementBasActif=this.donneeTreeView.dropAutorise(lNodeSelection,lNodeSelection.frereSuivant(),false);}
this.boutonHaut.SetActif(lDeplacementHautActif);this.boutonBas.SetActif(lDeplacementBasActif);}}
_construireTreeView(){if(!this.donneesRecus){return;}
const lConteneur=GHtml.getElement(this.idConteneur);GHtml.setHtml(lConteneur,'');if(this.donneeTreeView&&this.donneeTreeView.listeNodes){const lListeRacines=this.donneeTreeView.listeRacines();for(let i=0,lnb=lListeRacines.length;i<lnb;i++){this._construireLigneDeNode(lConteneur,lListeRacines[i]);}}
const lEventMap={'mouseup':_surMouseUpTreeView,'keydown':_surKeyDownTreeView,'mouseenter':_surMouseEnterTreeView,'mouseleave':_surMouseLeaveTreeView};$('#'+this.idConteneur.escapeJQ()).off().on(lEventMap,{instance:this});}
_construireLigneDeNode(aElementConteneur,aNode){let lTdImage,lDiv=null,lEventMap;aNode.DOM={};const lNiveau=aNode.getNiveau();const lLibelle=this.donneeTreeView.getLibelle(aNode);const lPaddingLeft=this.donneeTreeView.getIndent(aNode)*lNiveau;const lStyleVisible=this.donneeTreeView.getVisible(aNode)?'':'display:none';const lClassIcon=this.donneeTreeView.getClassIcon(aNode);const lDivLigne=GHtml.creerElementDOM('div');GHtml.setClass(lDivLigne,'NoWrap');const lStyle=(lPaddingLeft>0?'padding-left:'+lPaddingLeft+'px;':'')+lStyleVisible;if(lStyle){GStyle.setStyle(lDivLigne,lStyle);}
$(lDivLigne).mouseup({instance:this,node:aNode},_surMouseUpLigne);aNode.DOM.dropInterLigne=lDivLigne;const lTdDeploiement=GHtml.creerElementDOM('div');GHtml.setClass(lTdDeploiement,'InlineBlock AlignementMilieuVertical');GStyle.setStyle(lTdDeploiement,GStyle.composeWidth(this.largeurDeploiement)+'padding-right:'+this.ecartDroitDeploiement+'px;');if(this.donneeTreeView.getAvecDeploiement(aNode)){lDiv=GHtml.creerElementDOM('div');GHtml.setClass(lDiv,'AvecMain '+(aNode.deploye?'Image_DeploiementListe_Deploye':'Image_DeploiementListe_NonDeploye'));$(lDiv).mousedown({instance:this,node:aNode},_surMouseDownDeploiement);GHtml.setTexte(lDiv,' ');aNode.DOM.deploiement=lDiv;lTdDeploiement.appendChild(lDiv);}
lDivLigne.appendChild(lTdDeploiement);if(lClassIcon){lTdImage=GHtml.creerElementDOM('div');GHtml.setClass(lTdImage,'InlineBlock AlignementMilieuVertical');GStyle.setStyle(lTdImage,'padding-right : 2px; font-size: 1.1em;');lDiv=GHtml.creerElementDOM('i');GHtml.setClass(lDiv,lClassIcon);lEventMap={'dblclick':_surDblClickImage,'mousedown':_surMouseDownImage,'mouseover':_surMouseOverImage,'mouseout':_surMouseOutImage,'mouseup':_surMouseUpImage};aNode.DOM.image=lDiv;$(lTdImage).on(lEventMap,{instance:this,node:aNode});lTdImage.appendChild(lDiv);lDivLigne.appendChild(lTdImage);}
const lDivConteneur=$('<div class="InlineBlock OmbreFocus AlignementMilieuVertical" style="margin:1px">').get(0);lDiv=GHtml.creerElementDOM('div');const lStyleLibelle=this.donneeTreeView.getStyleLibelle(aNode);const lClassLibelle=this.donneeTreeView.getClassLibelle(aNode);GHtml.setClass(lDiv,(lClassLibelle?lClassLibelle:''));if(lStyleLibelle){GStyle.setStyle(lDiv,lStyleLibelle);}
GHtml.setHtml(lDiv,lLibelle,true);lDiv.tabIndex=1;lEventMap={'mousedown':_surMouseDownLibelle,'mouseover':_surMouseOverLibelle,'mouseout':_surMouseOutLibelle,'mouseup':_surMouseUpLibelle,'dblclick':_surDblClickLibelle,'focus':_surFocusLibelle,'blur':_surBlurLibelle};$(lDiv).on(lEventMap,{instance:this,node:aNode});aNode.DOM.libelle=lDiv;lDivConteneur.appendChild(lDiv);lDivLigne.appendChild(lDivConteneur);aElementConteneur.appendChild(lDivLigne);const lListeFils=aNode.listeFils();if(lListeFils.length>0){lDiv=GHtml.creerElementDOM('div');if(!aNode.deploye){GHtml.setDisplay(lDiv,false);}
aNode.DOM.conteneurFils=lDiv;for(let i=0,lNb=lListeFils.length;i<lNb;i++){this._construireLigneDeNode(lDiv,lListeFils[i]);}
aElementConteneur.appendChild(lDiv);}}
_construireInterLigneDeNode(aObjetDrag){this._detruireInterLignesDrop(aObjetDrag);aObjetDrag.listeNoeudsDOM=[];const lNode=aObjetDrag.source;const lListeNodes=lNode.pere?lNode.pere.listeFils():lNode.listeRacines();const lEventMap={'mouseover':_surMouseOverInterLigne,'mouseout':_surMouseOutInterLigne,'mouseup':_surMouseUpInterLigne};let lNodeCourant,lDiv,lDivInterligne,lDernierDecendant;for(let i=0;i<lListeNodes.length;i++){lNodeCourant=lListeNodes[i];lDiv=GHtml.creerElementDOM('div');aObjetDrag.listeNoeudsDOM.push(lDiv);GStyle.setStyle(lDiv,'position:relative; height:0px; top:0px; font-size:0px;');GHtml.insererElementDOM(lNodeCourant.DOM.dropInterLigne,lDiv,true);if(this.donneeTreeView.dropAutorise(aObjetDrag.source,lNodeCourant,true)){lDivInterligne=GHtml.creerElementDOM('div');GStyle.setStyle(lDivInterligne,this.getStyleInterLigne(-1));GHtml.insererElementDOM(lDiv,lDivInterligne);$(lDivInterligne).on(lEventMap,{instance:this,node:lNodeCourant,dernierElement:false});}
if((i===lListeNodes.length-1)&&this.donneeTreeView.dropAutorise(aObjetDrag.source,lNodeCourant,false)){lDivInterligne=GHtml.creerElementDOM('div');lDernierDecendant=this.donneeTreeView.getDifferenceIndexDernierDescendantVisible(lNodeCourant);const lTop=GPosition.getHeight(lNodeCourant.DOM.dropInterLigne)*(lDernierDecendant+1);GStyle.setStyle(lDivInterligne,this.getStyleInterLigne(lTop));GHtml.insererElementDOM(lDiv,lDivInterligne);$(lDivInterligne).on(lEventMap,{instance:this,node:lNodeCourant,dernierElement:true});}}}
getStyleInterLigne(aTop){return'position:absolute; z-index:1;'+'height:'+this.hauteurDropInterLigne+'px;'+'top:'+aTop+'px;'+'left:'+(this.largeurDeploiement+this.ecartDroitDeploiement)+'px;'+'width:'+this.largeurDropInterLigne+'px;';}
_detruireInterLignesDrop(aObjetDrag){if(!aObjetDrag||!aObjetDrag.listeNoeudsDOM){return;}
for(let i=0;i<aObjetDrag.listeNoeudsDOM.length;i++){const lNoeud=aObjetDrag.listeNoeudsDOM[i];GHtml.supprimerElementDOM(lNoeud);}
delete aObjetDrag.listeNoeudsDOM;}
_surDragDebut(aNode){if(!aNode){return;}
this._posSourisX=GNavigateur.pointerX;this._posSourisY=GNavigateur.pointerY;const lDraggable=GHtml.getElement(this.idDraggable);GHtml.delClass(lDraggable,'Liste_Rouge Blanc');GStyle.setVisible(lDraggable,false);GHtml.setDisplay(lDraggable,true);const lPositionX=Math.min(this._posSourisX,GNavigateur.ClientL-GPosition.getWidth(lDraggable));GPosition.setPosition(lDraggable,lPositionX+8,this._posSourisY+5,true);GNavigateur.DebDeplacement(this,lDraggable);this._objetDrag={elementDrag:lDraggable,source:aNode,visible:false,cible:null,insertionAvant:null,setContenuHtml:function(aContenu){if(this.contenuHtml===aContenu){return;}
this.contenuHtml=aContenu;GHtml.setHtml(this.elementDrag,this.contenuHtml,true);}};this._objetDrag.setContenuHtml(this.donneeTreeView.getContenuDraggable_Interdit(this._objetDrag.source));window.clearTimeout(this._timerDrag);this._timerDrag=setTimeout(this._surDraggableAfficher.bind(this,true),500);$(document).off('mouseup.treeview ',_surMouseUp).off('mousemove.treeview ',_surMouseMove).on({'mouseup.treeview':_surMouseUp,'mousemove.treeview':_surMouseMove},{instance:this});}
_surDraggableAfficher(AAfficher){if(this._objetDrag&&!this._objetDrag.visible&&GNavigateur.SourisBouton){if(AAfficher||((this._posSourisX-GNavigateur.pointerX)*(this._posSourisX-GNavigateur.pointerX)+(this._posSourisY-GNavigateur.pointerY)*(this._posSourisY-GNavigateur.pointerY)>20)){GStyle.setVisible(this._objetDrag.elementDrag,true);this._objetDrag.visible=true;this._construireInterLigneDeNode(this._objetDrag);if(this.donneeTreeView.avecEvenementDeGenre(EGenreEvenementTreeView.dragDebut,this._objetDrag.source)){this.callback.appel(EGenreEvenementTreeView.dragDebut,this._objetDrag);}}}}
_surDragFin(){$(document).off('mouseup.treeview ',_surMouseUp).off('mousemove.treeview ',_surMouseMove);if(this._objetDrag&&this._objetDrag.visible){window.clearTimeout(this._timerDrag);GHtml.setHtml(this._objetDrag.elementDrag,'');GHtml.setDisplay(this._objetDrag.elementDrag,false);if(this.donneeTreeView.avecEvenementDeGenre(EGenreEvenementTreeView.dragFin,this._objetDrag.source)){this.callback.appel(EGenreEvenementTreeView.dragFin,this._objetDrag);}
if(this._objetDrag.horsZone&&this._objetDrag.source){this.surSuppression(this._objetDrag.source);} else if(this._objetDrag.source&&!this._objetDrag.annulerDrop){this.surDeplacement(this._objetDrag.source,this._objetDrag.cible,this._objetDrag.insertionAvant);}}
this._detruireInterLignesDrop(this._objetDrag);delete this._objetDrag;}
surDeplacement(aNodeSource,aNodeCible,aInsertionAvant){if(this.donneeTreeView.surDeplacement(aNodeSource,aNodeCible,aInsertionAvant)){this.donneeTreeView.construireNodes();this.actualiser(false);if(this.donneeTreeView.avecEtatSaisie()){this.SetEtatSaisie(true);}
if(this.donneeTreeView.avecEvenementDeGenre(EGenreEvenementTreeView.deplacement,aNodeSource)){this.callback.appel(EGenreEvenementTreeView.deplacement,aNodeSource);}}}
_setSelectionNode(aNode){if(this._enEdition){return;}
let lNodeSelection=this.donneeTreeView.getSelection(aNode);if(this.donneeTreeView.avecMultiSelection()){if(!MethodesObjet.isArray(lNodeSelection)){lNodeSelection=[lNodeSelection];}
if(this.nodeSelection){if(GNavigateur.CtrlTouche){for(let i=0;i<this.nodeSelection.length;i++){const lIndex=lNodeSelection.indexOf(this.nodeSelection[i]);if(lIndex>=0){MethodesTableau.supprimerElement(lNodeSelection,lIndex);} else{lNodeSelection.push(this.nodeSelection[i]);}}}}}
this._appliquerSelection(lNodeSelection,true,true);}
_appliquerSelection(aNode,aInteractionUtilisateur,aAvecCallbackSelection){if(this.donneeTreeView.avecMultiSelection()){let lNodes=aNode;if(!MethodesObjet.isArray(lNodes)){lNodes=[lNodes];}
if(this.nodeSelection){for(let i=0;i<this.nodeSelection.length;i++){if(!MethodesTableau.existe(this.nodeSelection[i],lNodes)){this.setDeselectionNode(this.nodeSelection[i]);}}}
this.nodeSelection=[];if(lNodes){for(let i=0;i<lNodes.length;i++){if(lNodes[i]){this.nodeSelection.push(lNodes[i]);GStyle.setStyle(lNodes[i].DOM.libelle,this.donneeTreeView.getStyleLibelle(lNodes[i],true));}}}} else{if(this.nodeSelection&&!this.nodeSelection.identique(aNode)){this.setDeselectionNode(this.nodeSelection);}
this.nodeSelection=aNode;if(aNode){GStyle.setStyle(aNode.DOM.libelle,this.donneeTreeView.getStyleLibelle(aNode,true));}}
this._actualiserBoutons();if(aAvecCallbackSelection&&this.donneeTreeView.avecEvenementDeGenre(EGenreEvenementTreeView.selection,this.nodeSelection)){this.callback.appel(EGenreEvenementTreeView.selection,this.nodeSelection,aInteractionUtilisateur);}}
setSelectionParContenuDeNode(aNode,aAvecCallbackSelection){if(!aNode){this._appliquerSelection(null,false,aAvecCallbackSelection);} else{if(this.donneeTreeView.avecMultiSelection()){let lNodes=aNode;if(!MethodesObjet.isArray(lNodes)){lNodes=[lNodes];}
const lNodesSelection=[];for(let i=0;i<lNodes.length;i++){const lNode=this.donneeTreeView.getNodeParContenu(lNodes[i].contenu);if(lNode){lNodesSelection.push(lNode);}}
this._appliquerSelection(lNodesSelection,false,aAvecCallbackSelection);} else{this._appliquerSelection(this.donneeTreeView.getNodeParContenu(aNode.contenu),false,aAvecCallbackSelection);}}}
setDeselectionNode(aNode){if(aNode){GStyle.setStyle(aNode.DOM.libelle,this.donneeTreeView.getStyleLibelle(aNode,false));}}
getOrdreSelection(){const lResult=[];if(this.nodeSelection){let lNodes=this.nodeSelection;if(!MethodesObjet.isArray(lNodes)){lNodes=[lNodes];}
for(let i=0;i<lNodes.length;i++){const lIndex=this.donneeTreeView.listeNodes.indexOf(lNodes[i]);if(lIndex>=0){lResult.push(lIndex);}}}
return lResult;}
setSelectionParOrdre(aOrdres,aAvecCallbackSelection){if(aOrdres===null||aOrdres===undefined){this._appliquerSelection(null,false,aAvecCallbackSelection);} else{if(!MethodesObjet.isArray(aOrdres)){aOrdres=[aOrdres];}
let lNode;if(this.donneeTreeView.avecMultiSelection()){const lNodesSelection=[];for(let i=0;i<aOrdres.length;i++){lNode=this.donneeTreeView.listeNodes[aOrdres[i]];if(lNode){lNodesSelection.push(lNode);}}
this._appliquerSelection(lNodesSelection,false,aAvecCallbackSelection);} else{lNode=this.donneeTreeView.listeNodes[aOrdres[0]];this._appliquerSelection(lNode,false,aAvecCallbackSelection);}}}
_ouvrirMenuContextuel(aNode,aSurBouton,aGenreEvenement){if(this.menuContextuel){this.menuContextuel.free();}
this.menuContextuel=new ObjetMenuContextuel(this.idMenuContextuel,null,this,this._evenementMenuContextuel.bind(this,aNode));ZoneFenetre.ajouterFenetre(this.menuContextuel.GetNom());if(!aSurBouton){this.donneeTreeView.initialisationMenuContextuel(this.menuContextuel,aNode);} else{this.donneeTreeView.initialisationMenuContextuelSurBouton(this.menuContextuel,aNode,aGenreEvenement);}
if(this.menuContextuel.ListeLignes.GetNbrElements()===0){this.menuContextuel.free();delete this.menuContextuel;}}
_evenementMenuContextuel(aNode,aLigne,aElement){this.menuContextuel.free();GHtml.setHtml(this.menuContextuel.GetNom(),'');delete this.menuContextuel;const lInfosMenuContextuel=this.donneeTreeView.evenementMenuContextuel(aNode,aLigne,aElement);if(lInfosMenuContextuel){switch(lInfosMenuContextuel.evenementTreeView){case EGenreEvenementTreeView.suppression:{this.surSuppression(aNode);return;}
case EGenreEvenementTreeView.edition:{this.demarrerEdition(aNode);return;}
case EGenreEvenementTreeView.creation:{this.demarrerCreation(lInfosMenuContextuel.nodePere,lInfosMenuContextuel.contenu);return;}}
if(lInfosMenuContextuel.avecEtatSaisie&&this.donneeTreeView.avecEtatSaisie()){this.SetEtatSaisie(true);}
if(lInfosMenuContextuel.avecActualisation){this.donneeTreeView.construireNodes();this.actualiser(true);}}
if(this.donneeTreeView.avecEvenementDeGenre(EGenreEvenementTreeView.menuContextuel,aNode)){this.callback.appel(EGenreEvenementTreeView.menuContextuel,aNode,true,aLigne);}}
demarrerCreation(aNodePere,aContenu){if(!this.donneeTreeView.avecCreation(aNodePere,aContenu)){return;}
if(this.donneeTreeView.surCreation(aNodePere,aContenu)){this.donneeTreeView.construireNodes();this.actualiser(false);if(this.donneeTreeView.avecEtatSaisie()){this.SetEtatSaisie(true);}
const lNode=this.donneeTreeView.getNodeParContenu(aContenu);this._appliquerSelection(lNode,false,true);if(this.donneeTreeView.avecEvenementDeGenre(EGenreEvenementTreeView.creation,lNode)){this.callback.appel(EGenreEvenementTreeView.creation,lNode);}
if(lNode&&this.donneeTreeView.avecEditionApresCreation(lNode)){this.demarrerEdition(lNode);}}}
demarrerEdition(aNode){if(!this.donneeTreeView.avecEdition(aNode)){return;}
this._supprimerElementEdition();this.apiScroll.scrollToElement(aNode.DOM.libelle);this.conteneurEdition=GHtml.htmlToDOM('<div class="Liste_Cellule_ZoneTexte Texte10 FondBlanc"></div>');GHtml.getElement(this.Nom).appendChild(this.conteneurEdition);const lLibelle=this.donneeTreeView.getLibelleNode(aNode);aNode._valeurEdition=lLibelle;this.textAreaEdition=GHtml.htmlToDOM('<input value="'+lLibelle+'" class="Texte10"/>');const lWidth=GChaine.GetLongueurChaineDansDiv(GChaine.enleverEntites(lLibelle),10,false)+10;GStyle.setStyle(this.textAreaEdition,GStyle.composeCouleurBordure(this.couleurs.editable.getBordure(false),1)+GStyle.composeHeight(this.donneeTreeView.getHauteurLigneMin())+GStyle.composeWidth(lWidth));this.conteneurEdition.appendChild(this.textAreaEdition);const lEventMap={'keydown':_surKeyDownEdition,'input keyup paste cut change':_surKeyUpEdition,'blur':_surBlurEdition};$(this.textAreaEdition).on(lEventMap,{instance:this,node:aNode});this.apiScroll.actualiser();GStyle.setVisible(aNode.DOM.libelle,false);const lScroll=GHtml.getElement(this.idScroll);GPosition.placer(this.conteneurEdition,GPosition.getLeft(aNode.DOM.libelle)-lScroll.scrollLeft-1,GPosition.getTop(aNode.DOM.libelle)-lScroll.scrollTop);GHtml.setFocusEdit(this.textAreaEdition);GHtml.setSelectionEdit(this.textAreaEdition);this._enEdition=true;if(this.donneeTreeView.avecEvenementDeGenre(EGenreEvenementTreeView.editionDebut,aNode)){this.callback.appel(EGenreEvenementTreeView.editionDebut,aNode);}
setTimeout(function(){$('#'+this.idScroll.escapeJQ()).on('scroll.treeview',{instance:this,node:aNode},_surBlurEdition);}.bind(this),100);}
enEdition(aNode,aValue){const lValue=this.donneeTreeView.surEdition(aNode,aValue);aNode._valeurEdition=lValue;if(lValue!==GHtml.getValue(this.textAreaEdition)){GHtml.setValue(this.textAreaEdition,lValue);}
GPosition.setWidth(this.textAreaEdition,GChaine.GetLongueurChaineDansDiv(GChaine.enleverEntites(lValue),10,false)+10);this.$refreshSelf();}
sortirEdition(aNode){this._supprimerElementEdition();GStyle.setVisible(aNode.DOM.libelle,true);this.modifierLibelleNode(aNode,this.donneeTreeView.getLibelle(aNode));if(this._enEdition){this._enEdition=false;const lValeurEdition=aNode._valeurEdition;delete aNode._valeurEdition;if(this.donneeTreeView.surEditionFin(aNode,lValeurEdition)){if(this.donneeTreeView.avecEtatSaisie()){this.SetEtatSaisie(true);}
this.actualiser(true);if(this.donneeTreeView.avecEvenementDeGenre(EGenreEvenementTreeView.edition,aNode)){this.callback.appel(EGenreEvenementTreeView.edition,aNode);}}}
this.$refreshSelf();if(this.donneeTreeView.avecEvenementDeGenre(EGenreEvenementTreeView.editionFin,aNode)){this.callback.appel(EGenreEvenementTreeView.editionFin,aNode);}}
_supprimerElementEdition(){$('#'+this.idScroll.escapeJQ()).off('scroll.treeview');if(!GHtml.estElement(this.conteneurEdition)){return;}
GHtml.supprimerElementDOM(this.conteneurEdition);this.conteneurEdition=null;this.textAreaEdition=null;}
modifierLibelleNode(aNode,aValeur){if(aNode&&aNode.DOM&&aNode.DOM.libelle){GHtml.setHtml(aNode.DOM.libelle,aValeur);this.$refreshSelf();}}
surSuppression(aNode){if(!aNode){return;}
if(this.donneeTreeView.avecSuppression(aNode)){if(this.donneeTreeView.surSuppression_Confirmation(aNode)){const lThis=this;GApplication.getMessage().afficher({type:EGenreBoiteMessage.Confirmation,message:this.donneeTreeView.getMessage_Suppression_Confirmation(aNode),callback:function(aAccepte){lThis._surSuppressionApresConfirmation(aAccepte,aNode);}});} else{this._surSuppressionApresConfirmation(EGenreAction.Valider,aNode);}}}
_surSuppressionApresConfirmation(AAccepte,aNode){if(AAccepte===EGenreAction.Valider){this.donneeTreeView.surSuppression(aNode);this.donneeTreeView.construireNodes();this.actualiser(true);if(this.donneeTreeView.avecEvenementDeGenre(EGenreEvenementTreeView.suppression,aNode)){this.callback.appel(EGenreEvenementTreeView.suppression,aNode);}
if(this.donneeTreeView.avecEtatSaisie()){this.SetEtatSaisie(true);}}}
_evenementSurBouton(aGenreEvenement,aDeplacementHaut){let lNodeSelection=this.nodeSelection;if(MethodesObjet.isArray(this.nodeSelection)){lNodeSelection=this.nodeSelection[0];}
switch(aGenreEvenement){case EGenreEvenementTreeView.creation:{if(this.donneeTreeView.avecMenuContextuelSurBouton(lNodeSelection,aGenreEvenement)){this._ouvrirMenuContextuel(lNodeSelection,true,aGenreEvenement);}
break;}
case EGenreEvenementTreeView.suppression:{if(lNodeSelection){this.surSuppression(lNodeSelection);}
break;}
case EGenreEvenementTreeView.edition:{if(lNodeSelection){this.demarrerEdition(lNodeSelection);}
break;}
case EGenreEvenementTreeView.deplacement:{if(aDeplacementHaut){this.surDeplacement(lNodeSelection,lNodeSelection.frerePrecedent(),true);} else{this.surDeplacement(lNodeSelection,lNodeSelection.frereSuivant(),false);}
break;}}}}
ObjetTreeView.CONST_hauteurMin=80;function _surMouseDownDeploiement(aEvent){_surMouseDownLibelle(aEvent);_surDeploiement(aEvent);}
function _surDeploiement(aEvent){const lNode=aEvent.data.node;if(aEvent.data.instance.donneeTreeView.getAvecDeploiement(lNode)){lNode.deploye=!lNode.deploye;const lInstance=aEvent.data.instance;$(lNode.DOM.conteneurFils).slideToggle('fast',function(){lInstance.$refreshSelf();});GHtml.modifierClass(lNode.DOM.deploiement,lNode.deploye?'Image_DeploiementListe_NonDeploye':'Image_DeploiementListe_Deploye',lNode.deploye?'Image_DeploiementListe_Deploye':'Image_DeploiementListe_NonDeploye');if(lNode.DOM.image){GHtml.setClass(lNode.DOM.image,lInstance.donneeTreeView.getClassIcon(lNode));}}}
function _surDblClickImage(event){_surDeploiement(event);}
function _surMouseDownImage(event){_surMouseDownLibelle(event);}
function _surMouseUpImage(aEvent){_surMouseUpLibelle(aEvent);GHtml.setFocus(aEvent.data.node.DOM.libelle,true);}
function _surMouseOverImage(aEvent){_surMouseOverLibelle(aEvent);}
function _surMouseOutImage(aEvent){_surMouseOutLibelle(aEvent);}
function _surMouseDownLibelle(aEvent){const lInstance=aEvent.data.instance;lInstance._setSelectionNode(aEvent.data.node);if((GNavigateur.getBoutonSouris(aEvent)!==EGenreBoutonSouris.Droite)&&lInstance.donneeTreeView.avecDragNDrop()){if(lInstance.donneeTreeView.dragAutorise(aEvent.data.node)){lInstance._surDragDebut(aEvent.data.node);return false;}}}
function _surMouseUpLibelle(aEvent){const lInstance=aEvent.data.instance;if(lInstance._objetDrag&&lInstance._objetDrag.visible){if(lInstance.donneeTreeView.dropAutorise(lInstance._objetDrag.source,aEvent.data.node,null)){lInstance._objetDrag.cible=aEvent.data.node;} else{lInstance._objetDrag.annulerDrop=true;}
lInstance._surDragFin();}}
function _surMouseOverLibelle(aEvent){const lInstance=aEvent.data.instance;if(lInstance._objetDrag&&lInstance._objetDrag.visible){lInstance._objetDrag.surSurvolDrop=true;if(lInstance.donneeTreeView.dropAutorise(lInstance._objetDrag.source,aEvent.data.node,null)){GStyle.setStyle(aEvent.data.node.DOM.libelle,lInstance.donneeTreeView.getStyleLibelle(aEvent.data.node,true));lInstance._objetDrag.setContenuHtml(lInstance.donneeTreeView.getContenuDraggable_Inclusion(lInstance._objetDrag.source,aEvent.data.node));} else{lInstance._objetDrag.setContenuHtml(lInstance.donneeTreeView.getContenuDraggable_Interdit(lInstance._objetDrag.source));}}
if(ObjetHint&&lInstance.donneeTreeView.avecHintDeLibelle(aEvent.data.node)){lInstance._hintCourant=ObjetHint.start(lInstance.donneeTreeView.getHintDeLibelle(aEvent.data.node));}}
function _surMouseOutLibelle(aEvent){const lInstance=aEvent.data.instance;if(lInstance._objetDrag&&lInstance._objetDrag.visible){delete lInstance._objetDrag.surSurvolDrop;if(lInstance.donneeTreeView.dropAutorise(lInstance._objetDrag.source,aEvent.data.node,null)){lInstance._objetDrag.setContenuHtml(lInstance.donneeTreeView.getContenuDraggable_Interdit(lInstance._objetDrag.source));GStyle.setStyle(aEvent.data.node.DOM.libelle,lInstance.donneeTreeView.getStyleLibelle(aEvent.data.node,false));} else{lInstance._objetDrag.setContenuHtml(lInstance.donneeTreeView.getContenuDraggable_Interdit(lInstance._objetDrag.source));}}
if(lInstance._hintCourant){ObjetHint.stop(lInstance._hintCourant);lInstance._hintCourant=null;}}
function _surDblClickLibelle(aEvent){const lInstance=aEvent.data.instance;if(lInstance.donneeTreeView.avecEdition(aEvent.data.node)){lInstance.demarrerEdition(aEvent.data.node);} else if(lInstance.donneeTreeView.avecEvenementDeGenre(EGenreEvenementTreeView.selectionDblClick,aEvent.data.node)){lInstance.callback.appel(EGenreEvenementTreeView.selectionDblClick,aEvent.data.node,true);}}
function _surFocusLibelle(aEvent){const lNode=aEvent.data.instance.donneeTreeView.getSelectionFocus(aEvent.data.node);aEvent.data.instance.nodeSelectionFocus=lNode;}
function _surBlurLibelle(aEvent){aEvent.data.instance.nodeSelectionFocus=null;}
function _surMouseOverInterLigne(event){const lInstance=event.data.instance;if(lInstance._objetDrag&&lInstance._objetDrag.visible){lInstance._objetDrag.surSurvolDrop=true;GStyle.setCouleurFond(this,lInstance.couleurs.bordure);lInstance._objetDrag.setContenuHtml(lInstance.donneeTreeView.getContenuDraggable_Deplacement(lInstance._objetDrag.source));}}
function _surMouseOutInterLigne(event){const lInstance=event.data.instance;if(lInstance._objetDrag&&lInstance._objetDrag.visible){delete lInstance._objetDrag.surSurvolDrop;GStyle.setCouleurFond(this,'');lInstance._objetDrag.setContenuHtml(lInstance.donneeTreeView.getContenuDraggable_Interdit(lInstance._objetDrag.source));}}
function _surMouseUpInterLigne(event){const lInstance=event.data.instance;if(lInstance._objetDrag&&lInstance._objetDrag.visible){lInstance._objetDrag.cible=event.data.node;lInstance._objetDrag.insertionAvant=!event.data.dernierElement;lInstance._surDragFin();}}
function _surMouseUpLigne(aEvent){if((GNavigateur.estSourisBoutonDroit())&&aEvent.data.instance.donneeTreeView.avecMenuContextuel(aEvent.data.node)){aEvent.data.instance._ouvrirMenuContextuel(aEvent.data.node);aEvent.data.instance._bloquerMenuContextuelTreeView=true;}}
function _surMouseUpTreeView(event){const lInstance=event.data.instance;if(!lInstance._bloquerMenuContextuelTreeView&&(GNavigateur.estSourisBoutonDroit())&&lInstance.donneeTreeView.avecMenuContextuel(null)){lInstance._ouvrirMenuContextuel(null);}
delete lInstance._bloquerMenuContextuelTreeView;if(lInstance._objetDrag&&lInstance._objetDrag.visible){lInstance._surDragFin();}}
function _surMouseEnterTreeView(event){const lInstance=event.data.instance;if(lInstance._objetDrag&&lInstance._objetDrag.visible){if(lInstance._objetDrag.horsZone){GHtml.delClass(lInstance._objetDrag.elementDrag,'Liste_Rouge Blanc');lInstance._objetDrag.setContenuHtml(lInstance.donneeTreeView.getContenuDraggable_Interdit(lInstance._objetDrag.source));lInstance._objetDrag.horsZone=false;}
if(!lInstance._objetDrag.surSurvolDrop&&lInstance._objetDrag.source&&lInstance.donneeTreeView.surDeplacement(lInstance._objetDrag.source,null,null)){lInstance._objetDrag.setContenuHtml(lInstance.donneeTreeView.getContenuDraggable_Inclusion(lInstance._objetDrag.source,null));}}}
function _surMouseLeaveTreeView(event){const lInstance=event.data.instance;if(lInstance._objetDrag&&lInstance._objetDrag.visible){const lAvecSuppression=lInstance.donneeTreeView.avecSuppression(lInstance._objetDrag.source);const lContenu=lAvecSuppression?lInstance.donneeTreeView.getContenuDraggable_Suppression(lInstance._objetDrag.source):lInstance.donneeTreeView.getContenuDraggable_Interdit(lInstance._objetDrag.source);if(lAvecSuppression){GHtml.addClass(lInstance._objetDrag.elementDrag,'Liste_Rouge Blanc');}
lInstance._objetDrag.setContenuHtml(lContenu);lInstance._objetDrag.horsZone=true;}}
function _surKeyDownTreeView(event){const lInstance=event.data.instance;if(!lInstance.donneeTreeView){return;}
let lNode;if(GNavigateur.IsToucheSupprimer()&&!lInstance._enEdition){lInstance.surSuppression(lInstance.nodeSelection);} else if(GNavigateur.IsToucheFlecheBas()){lNode=lInstance.donneeTreeView.selectionFocusSuivant(lInstance.nodeSelectionFocus,true);if(lNode&&lNode.DOM.libelle){lInstance.apiScroll.scrollV.scrollToElement(lNode.DOM.libelle);lInstance.apiScroll.scrollH.scrollToElement(lNode.DOM.libelle);GHtml.setFocus(lNode.DOM.libelle,true);}} else if(GNavigateur.IsToucheFlecheHaut()){lNode=lInstance.donneeTreeView.selectionFocusSuivant(lInstance.nodeSelectionFocus,false);if(lNode&&lNode.DOM.libelle){lInstance.apiScroll.scrollToElement(lNode.DOM.libelle);GHtml.setFocus(lNode.DOM.libelle,true);}} else if(GNavigateur.IsToucheSelection()){lInstance._setSelectionNode(lInstance.nodeSelectionFocus);}}
function _surMouseMove(event){if(!event.data.instance.donneeTreeView){return;}
event.data.instance._surDraggableAfficher();}
function _surMouseUp(event){if(!event.data.instance.donneeTreeView){return;}
event.data.instance._surDragFin();}
function _surKeyDownEdition(aEvent){if(GNavigateur.IsToucheRetourChariot()){aEvent.data.instance.sortirEdition(aEvent.data.node);GNavigateur.StopperEvenement(aEvent);}}
function _surKeyUpEdition(aEvent){aEvent.data.instance.enEdition(aEvent.data.node,GHtml.getValue(this));}
function _surBlurEdition(aEvent){aEvent.data.instance.sortirEdition(aEvent.data.node);}
class ObjetBoutonTreeView extends Identite{constructor(aNom,aPere,aEvenement){super(aNom,null,aPere,aEvenement);}
setParametres(aGenreEvenement,aDeplacementHaut,aHint){this.hint=aHint?aHint:'';this.genreEvenement=aGenreEvenement;this.deplacementHaut=aDeplacementHaut;this.couleurs=GCouleur;}
getControleur(aInstance){return $.extend(true,super.getControleur(this),{btn:{event:function(){aInstance.callback.appel(aInstance.genreEvenement,aInstance.deplacementHaut);},getDisabled:function(){return!aInstance.Actif;}}});}
RecupererDonnees(){this._construireBouton();}
_construireBouton(){const lElement=GHtml.getElement(this.Nom);if(!GHtml.elementExiste(lElement)){return;}
let lImage='';switch(this.genreEvenement){case EGenreEvenementTreeView.creation:lImage='icon_plus';break;case EGenreEvenementTreeView.edition:lImage='icon_pencil';break;case EGenreEvenementTreeView.deplacement:lImage=this.deplacementHaut?'icon_chevron_up':'icon_chevron_down';break;case EGenreEvenementTreeView.suppression:lImage='icon_trash';break;default:;}
const H=['<ie-btnimage ie-model="btn" class="btnImageIcon ',lImage,'"',(this.hint?' title="'+(this.hint)+'"':''),'></ie-btnimage>'
];GHtml.setHtml(lElement,H.join(''),{controleur:this.controleur});}}
module.exports=ObjetTreeView;},fn:"objettreeview.js"});;
IE.fModule({f:function(exports,require,module,global){const MethodesTableau=require('MethodesTableau.js');const GStyle=require('GStyle.js');const GTraductions=require('ObjetTraduction.js');class _ObjetDonneesTreeView{constructor(aDonnees){this.donnees=aDonnees;this.options={};this.setOptionsTreeView({avecCreation:false,avecEdition:false,avecSuppression:false,avecEtatSaisie:true});}
setOptionsTreeView(aOptions){Object.assign(this.options,aOptions);return this;}
vider(){this._compteurIdent=0;this.listeNodes=[];}
construireNodes(){this.vider();}
avecEtatSaisie(){return this.options.avecEtatSaisie;}
getLibelle(aNode){return this.getLibelleNode(aNode);}
getLibelleNode(aNode){return aNode.contenu&&aNode.contenu.GetLibelle?aNode.contenu.GetLibelle():'';}
estlibelleHtmlNode(){return false;}
getStyleLibelle(aNode,aSelectionne){const lHauteurLigneMin=this.getHauteurLigneMin(aNode)-2;return GStyle.composeHeight(lHauteurLigneMin)+'line-height:'+lHauteurLigneMin+'px;'+
GStyle.composeCouleur((aSelectionne?GCouleur.selection.getFond():GCouleur.blanc),(aSelectionne?GCouleur.selection.getTexte():GCouleur.noir));}
getClassLibelle(){return'Insecable';}
getIndent(){return 20;}
getVisible(){return true;}
getAvecDeploiement(aNode){return aNode.existeFils();}
getHauteurLigneMin(){return 16;}
getClassIcon(){return null;}
avecMultiSelection(){return false;}
getSelection(aNode){return aNode;}
getSelectionFocus(aNode){return aNode&&aNode.visible()?aNode:null;}
selectionFocusSuivant(aNode,aSensCroissant){let lNode=aNode;if(!lNode){lNode=aSensCroissant?this.getPemierNode():this.listeNodes[this.listeNodes.length-1];} else{lNode=aSensCroissant?lNode.suivant():lNode.precedent();}
let lCompteur=0;while((lCompteur<=this.listeNodes.length)&&!this.getSelectionFocus(lNode)){if(lNode){lNode=aSensCroissant?lNode.suivant():lNode.precedent();} else{lNode=aSensCroissant?this.getPemierNode():this.listeNodes[this.listeNodes.length-1];}
lCompteur++;}
return this.getSelectionFocus(lNode);}
avecSuppression(aNode){return this.options.avecSuppression&&!!aNode;}
avecEvenementDeGenre(){return false;}
avecBoutonsEvenementDuGenre(){return false;}
getHintBoutonsEvenementDuGenre(){return'';}
avecCreation(){return this.options.avecCreation;}
surCreation(){return false;}
avecEdition(aNode){return this.options.avecEdition&&!!aNode;}
avecEditionApresCreation(){return false;}
surEdition(aNode,aValue){return aValue;}
surEditionFin(){return true;}
surSuppression(){return null;}
surSuppression_Confirmation(){return true;}
getMessage_Suppression_Confirmation(){return GTraductions.getValeur('liste.suppressionSelection');}
avecDragNDrop(){return false;}
dragAutorise(){return false;}
dropAutorise(aNodeSource,aNodeCible,aInsertionAvant){if(aInsertionAvant===null||aInsertionAvant===undefined){return this.dropNodeAutorise(aNodeSource,aNodeCible);} else if(aInsertionAvant){const lNodeAvant=aNodeCible?aNodeCible.frerePrecedent():null;return this.dropInterNodeAutorise(aNodeSource,lNodeAvant,aNodeCible);} else{const lNodeApres=aNodeCible?aNodeCible.frereSuivant():null;return this.dropInterNodeAutorise(aNodeSource,aNodeCible,lNodeApres);}}
dropNodeAutorise(){return false;}
dropInterNodeAutorise(){return false;}
surDeplacement(){return null;}
getContenuDraggable_Interdit(){return'<table cellpadding="0" cellspacing="0" border="0"><tr><td class="Image_Arbre_Drag_Interdit"></td><td class="PetitEspaceGauche">'+GTraductions.getValeur('treeview.interdit')+'</td></tr></table>';}
getContenuDraggable_Suppression(){return GTraductions.getValeur('treeview.supprimer');}
getContenuDraggable_Inclusion(aNodeSource,aNodeDestination){const H=[];H.push('<table cellpadding="0" cellspacing="0" border="0"><tr><td class="Image_Arbre_Drag_Inclusion"></td>');H.push('<td class="PetitEspaceGauche">');if(aNodeDestination){H.push(GTraductions.getValeur('treeview.InclureDans'));} else{H.push(GTraductions.getValeur('treeview.InclureDansRacine'));}
H.push('</td></tr></table>');return H.join('');}
getContenuDraggable_Deplacement(){return'<table cellpadding="0" cellspacing="0" border="0"><tr><td class="Image_Arbre_Drag_Deplacement"></td><td class="PetitEspaceGauche">'+GTraductions.getValeur('treeview.Deplacer')+'</td></tr></table>';}
avecMenuContextuel(){return false;}
avecMenuContextuelSurBouton(){return false;}
initialisationMenuContextuel(){}
initialisationMenuContextuelSurBouton(){}
evenementMenuContextuel(){return null;}
avecHintDeLibelle(){return false;}
getHintDeLibelle(){return null;}
creerNode(aNodePere,aContenu,aDeploye){this._compteurIdent++;return new ObjetTreeNode(this,this._compteurIdent,aNodePere,aContenu,aDeploye);}
ajouterNode(aNode){this.listeNodes.push(aNode);}
supprimerNode(aNode){if(!aNode){return;}
const lIndex=this.listeNodes.indexOf(aNode);if(lIndex>=0){const lFils=aNode.listeFils();for(let i=0;i<lFils.length;i++){this.supprimerNode(lFils[i]);}
MethodesTableau.supprimerElement(this.listeNodes,lIndex);}}
listeRacines(){const lListe=[];for(let i=0,lnb=this.listeNodes.length;i<lnb;i++){if(!this.listeNodes[i].pere){lListe.push(this.listeNodes[i]);}}
return lListe;}
getPemierNode(){return this.listeNodes[0];}
_getIndexNodeParIdent(aIdent){for(let i=0,lnb=this.listeNodes.length;i<lnb;i++){if(this.listeNodes[i]._ident===aIdent){return i;}}
return-1;}
_getIndexNodeParNode(aNode){if(aNode){return this._getIndexNodeParIdent(aNode._ident);}
return-1;}
_getNodeParIdent(aIdent){const lIndex=this._getIndexNodeParIdent(aIdent);return lIndex>=0?this.listeNodes[lIndex]:null;}
getNodeParContenu(aContenu){for(let i=0,lnb=this.listeNodes.length;i<lnb;i++){if(this.contenusIdentiques(aContenu,this.listeNodes[i].contenu)){return this.listeNodes[i];}}
return null;}
contenusIdentiques(aContenu1,aContenu2){return(aContenu1.GetNumero()===aContenu2.GetNumero())&&(aContenu1.GetGenre()===aContenu2.GetGenre());}
dernierDescendantVisible(aNode){if(!aNode){return null;}
let lNodeResult=aNode;const lIndex=this._getIndexNodeParIdent(aNode._ident);for(let i=lIndex+1;i<this.listeNodes.length;i++){const lNode=this.listeNodes[i];const lEstVisible=lNode&&lNode.visible();if(lNode&&lNode.estFrere(aNode)){return lNodeResult;} else if(!aNode.estAncetreDuNoeud(lNode)){return lNodeResult;} else if(lEstVisible){lNodeResult=lNode;}}
return lNodeResult;}
getDifferenceIndexDernierDescendantVisible(aNode){const lIndex=this._getIndexNodeParIdent(aNode._ident);return this._getIndexNodeParNode(this.dernierDescendantVisible(aNode))-lIndex;}
static ObjetInfosMenuContextuel(aEvenementTreeView,aAvecActualisation,aAvecEtatSaisie,aNodePere,aContenu){return{evenementTreeView:aEvenementTreeView,avecActualisation:aAvecActualisation,avecEtatSaisie:aAvecEtatSaisie,nodePere:aNodePere,contenu:aContenu};}}
class ObjetTreeNode{constructor(aDonneesTreeView,aIdent,aPere,aContenu,aDeploye){this.donneesTreeView=aDonneesTreeView;this._ident=aIdent;this.pere=aPere;this.contenu=aContenu;this.deploye=aDeploye===null?true:!!aDeploye;}
suivant(){const lIndexCourant=this.donneesTreeView._getIndexNodeParIdent(this._ident);return this.donneesTreeView.listeNodes[lIndexCourant+1];}
precedent(){const lIndexCourant=this.donneesTreeView._getIndexNodeParIdent(this._ident);return this.donneesTreeView.listeNodes[lIndexCourant-1];}
frereSuivant(){const lFreres=this.pere?this.pere.listeFils():this.listeRacines();let lNode=null;for(let i=0,lnb=lFreres.length;i<lnb;i++){lNode=lFreres[i];if(this.identique(lNode)){return lFreres[i+1];}}
return null;}
frerePrecedent(){const lFreres=this.pere?this.pere.listeFils():this.listeRacines();let lNode=null;for(let i=0,lnb=lFreres.length;i<lnb;i++){lNode=lFreres[i];if(this.identique(lNode)){return lFreres[i-1];}}
return null;}
listeRacines(){return this.donneesTreeView.listeRacines();}
listeFils(){const lListe=[];for(let i=0,lnb=this.donneesTreeView.listeNodes.length;i<lnb;i++){if(this.donneesTreeView.listeNodes[i].pere&&(this.donneesTreeView.listeNodes[i].pere._ident===this._ident)){lListe.push(this.donneesTreeView.listeNodes[i]);}}
return lListe;}
existeFils(){for(let i=0,lnb=this.donneesTreeView.listeNodes.length;i<lnb;i++){if(this.donneesTreeView.listeNodes[i].pere&&(this.donneesTreeView.listeNodes[i].pere._ident===this._ident)){return true;}}
return false;}
getNiveau(){let lNiveau=0;let lNode=this;while(lNode.pere){lNiveau++;lNode=lNode.pere;}
return lNiveau;}
visible(){let lVisible=true;let lNode=this;while(lVisible&&lNode.pere){lNode=lNode.pere;lVisible=lNode.deploye;}
return lVisible;}
identique(aNode){return aNode&&(aNode._ident===this._ident);}
estFrere(aNode){if(!aNode){return false;}
if(!this.pere&&!aNode.pere){return true;}
return this.pere&&this.pere.identique(aNode.pere);}
estAncetreDuNoeud(aNode){if(!aNode){return false;}
let lNode=aNode.pere;while(lNode){if(this.identique(lNode)){return true;}
lNode=lNode.pere;}
return false;}}
module.exports=_ObjetDonneesTreeView;},fn:"_objetdonneestreeview.js"});;
IE.fModule({f:function(exports,require,module,global){const _ObjetDonneesTreeView=require('_ObjetDonneesTreeView.js');const EGenreEvenementTreeView=require('Enumere_EvenementTreeView.js');const EGenreRessource=require('Enumere_Ressource.js');const TTypeElementCloud=require('TTypeElementCloud.js').TTypeElementCloud;class ObjetDonneesTreeView_FichiersCloud extends _ObjetDonneesTreeView{constructor(aListeElements){super(aListeElements);this.toutDeploye=true;}
construireNodes(){this.vider();this.construireNodesDeRacine(this.donnees,null);}
construireNodesDeRacine(aRacine,aPere,aNodeAModifier,aConstructionFilsRecursif){let lNode;if(!aNodeAModifier){lNode=this.creerNode(aPere,aRacine,true);this.ajouterNode(lNode);} else{lNode=aNodeAModifier;lNode.pere=aPere;if(aRacine.listeFichier){lNode.contenu.listeFichier=aRacine.listeFichier;}
if(aConstructionFilsRecursif){lNode.listeFils().forEach((aNodeFils) =>{this.supprimerNode(aNodeFils);});}}
for(let i=0,lNb=(aRacine.listeFichier?aRacine.listeFichier.GetNbrElements():0);i<lNb;i++){let lElement=aRacine.listeFichier.GetElement(i);if(lElement.GetGenre()===TTypeElementCloud.tec_Dossier){const lFilsMemeId=lNode?lNode.listeFils().filter(function(e){return e.contenu.idPartage===lElement.idPartage;}):[];this.construireNodesDeRacine(lElement,lNode,(lFilsMemeId.length===1?lFilsMemeId[0]:undefined),true);}}}
getLibelleNode(aNode){return aNode.contenu.GetLibelle();}
getClassLibelle(aNode){if(aNode.contenu.GetGenre()===EGenreRessource.Progression){return'Insecable Gras';} else{return'Insecable';}}
getClassIcon(aNode){switch(aNode.contenu.GetGenre()){case TTypeElementCloud.tec_Dossier:return aNode.deploye&&aNode.existeFils()?'icon_folder_open':'icon_folder_close';case TTypeElementCloud.tec_Fichier:return'icon_contenu_cours';}}
avecEvenementDeGenre(aGenreEvenement){if(aGenreEvenement===EGenreEvenementTreeView.selection){return true;}
return false;}}
module.exports=ObjetDonneesTreeView_FichiersCloud;},fn:"objetdonneestreeviewfichierscloud.js"});;
IE.fModule({f:function(exports,require,module,global){const UtilitaireBoutonBandeau={getHtmlBtnParametrer(aNomIEModel){return`<ie-btnicon ie-model="${aNomIEModel}" class="bt-activable icon_cog"></ie-btnicon>`;},getHtmlBtnAssistantSaisie(aNomIEModel){return`<ie-btnicon ie-model="${aNomIEModel}" class="bt-activable icon_pencil mix-icon_star i-top"></ie-btnicon>`;},getHtmlBtnTriOrdreChronologique(aNomIEModel){return`<ie-btnicon ie-model="${aNomIEModel}" class="bt-activable icon_ordre_chronologique"></ie-btnicon>`;},getHtmlBtnCompacterColonnes(aNomIEModel){return`<ie-btnicon ie-model="${aNomIEModel}" class="bt-activable icon_table mix-icon_resize_horizontal i-top"></ie-btnicon>`;},getHtmlBtnCompacterLignes(aNomIEModel){return`<ie-btnicon ie-model="${aNomIEModel}" class="bt-activable icon_table mix-icon_resize_vertical i-top"></ie-btnicon>`;},getHtmlBtnGrapheAraignee(aNomIEModel){return`<ie-btnicon ie-model="${aNomIEModel}" class="bt-activable icon_graphe_araigne"></ie-btnicon>`;},getHtmlBtnAvecListeEleves(aNomIEModel){return`<ie-btnicon ie-model="${aNomIEModel}" class="bt-activable icon_liste_etudiant"></ie-btnicon>`;},getHtmlBtnAfficherCoursAnnules(aNomIEModel){return`<ie-btnicon ie-model="${aNomIEModel}" class="bt-activable icon_fiche_T i-small" ie-class="${aNomIEModel}.getClassesMixIcon"></ie-btnicon>`;},getClassesMixIconAfficherCoursAnnules(aAvecCoursAnnules){const lClasses=['i-top'];if(aAvecCoursAnnules){lClasses.push('mix-icon_ok','i-green');} else{lClasses.push('mix-icon_remove','i-red');}
return lClasses.join(' ');},getHtmlBtnAfficherCahiersDeTextesDetaches(aNomIEModel){return`<ie-btnicon ie-model="${aNomIEModel}" class="bt-activable icon_Defaut_de_carnet"></ie-btnicon>`;},getHtmlBtnAfficherMasquerZone(aNomIEModel){return`<ie-btnicon ie-model="${aNomIEModel}" class="bt-activable icon_pushpin"></ie-btnicon>`;},getHtmlBtnMonsieurFiche(aNomIEModel){return`<ie-btnicon ie-model="${aNomIEModel}" class="bt-activable icon_question"></ie-btnicon>`;},getHtmlBtnSaisieHorizontalVertical(aNomIEModel){return`<ie-btnicon ie-model="${aNomIEModel}" class="bt-activable icon_pencil i-small" ie-class="${aNomIEModel}.getClassesMixIcon"></ie-btnicon>`;},getClassesMixIconSaisieHorizontalVertical(aSaisieVerticale){const lClasses=['i-bottom'];if(aSaisieVerticale){lClasses.push('mix-icon_arrow_down');} else{lClasses.push('mix-icon_arrow_right');}
return lClasses.join(' ');},getHtmlBtnAfficherPhotoEleve(aNomIEModel){return`<ie-btnicon ie-model="${aNomIEModel}" class="bt-activable icon_photo"></ie-btnicon>`;},getHtmlBtnAfficherFicheEleve(aNomIEModel){return`<ie-btnicon ie-model="${aNomIEModel}" class="bt-activable icon_fiche_eleve"></ie-btnicon>`;},getHtmlBtnAfficherEmploiDuTemps(aNomIEModel){return`<ie-btnicon ie-model="${aNomIEModel}" class="bt-activable icon_fiche_T_triple"></ie-btnicon>`;},getHtmlBtnChargeDeTravail(aNomIEModel){return`<ie-btnicon ie-model="${aNomIEModel}" class="bt-activable icon_charge_travail"></ie-btnicon>`;},getHtmlBtnICal(aNomIEModel){return`<ie-btnicon ie-model="${aNomIEModel}" class="bt-activable icon_ical"></ie-btnicon>`;},getHtmlBtnMiseEnFormeTexte(aNomIEModel){return`<ie-btnicon ie-model="${aNomIEModel}" class="bt-activable icon_font"></ie-btnicon>`;},getHtmlBtnCloud(aNomIEModel){return`<ie-btnicon ie-model="${aNomIEModel}" class="bt-activable icon_cloud"></ie-btnicon>`;},getHtmlBtnSitesInternet(aNomIEModel){return`<ie-btnicon ie-model="${aNomIEModel}" class="bt-activable icon_globe"></ie-btnicon>`;},getHtmlBtnPiecesJointes(aNomIEModel,aId){return`<ie-btnicon ${!!aId?`id="${aId}"`:''} ie-model="${aNomIEModel}" class="bt-activable icon_piece_jointe"></ie-btnicon>`;},getHtmlBtnQCM(aNomIEModel){return`<ie-btnicon ie-model="${aNomIEModel}" class="bt-activable icon_qcm"></ie-btnicon>`;},getHtmlBtnKiosque(aNomIEModel){return`<ie-btnicon ie-model="${aNomIEModel}" class="bt-activable icon_exercice_numerique"></ie-btnicon>`;},getHtmlBtnZoomPlusMoins(aNomIEModel){return`<ie-btnicon ie-model="${aNomIEModel}" class="bt-activable" ie-class="${aNomIEModel}.getClassesIcon"></ie-btnicon>`;},getClassesIconZoomPlusMoins(aEtatAgrandi){const lClasses=[];if(aEtatAgrandi){lClasses.push('icon_zoom_out');} else{lClasses.push('icon_zoom_in');}
return lClasses.join(' ');},getHtmlBtnSupprimer(aNomIEModel){return`<ie-btnicon ie-model="${aNomIEModel}" class="bt-activable icon_trash"></ie-btnicon>`;},getHtmlBtnCrayonMagique(aNomIEModel){return`<ie-btnicon ie-model="${aNomIEModel}" class="bt-activable icon_magic"></ie-btnicon>`;},getHtmlBtnListesDiffusion(aNomIEModel){return`<ie-btnicon ie-model="${aNomIEModel}" class="bt-activable icon_groupes_accompagnement_personnalise"></ie-btnicon>`;},getHtmlBtnDiffuserInformation(aNomIEModel){return`<ie-btnicon ie-model="${aNomIEModel}" class="bt-activable icon_diffuser_information"></ie-btnicon>`;},getHtmlBtnRecapitulatifAbsences(aNomIEModel){return`<ie-btnicon ie-model="${aNomIEModel}" class="bt-activable icon_competence_absent"></ie-btnicon>`;}};module.exports=UtilitaireBoutonBandeau;},fn:"utilitaireboutonbandeau.js"});;
IE.fModule({f:function(exports,require,module,global){const DonneesListe_FichiersCloud=require('DonneesListe_FichiersCloud.js');const{ObjetInvocateur,Invocateur}=require('Invocateur.js');const MethodesObjet=require('MethodesObjet.js');const EGenreBoiteMessage=require('Enumere_BoiteMessage.js');const EGenreDocumentJoint=require('Enumere_DocumentJoint.js');const EGenreEtat=require('Enumere_Etat.js');const EGenreEvenementListe=require('Enumere_EvenementListe.js');const ObjetFenetre=require('ObjetFenetre.js');const ObjetListe=require('ObjetListe.js');const ObjetElement=require('ObjetElement.js');const ObjetListeElements=require('ObjetListeElements.js');const GTraductions=require('ObjetTraduction.js');const ObjetTreeView=require('ObjetTreeView.js');const{TTypeElementCloud,TypeFormatPublication}=require('TTypeElementCloud.js');const TypeStatutInterrogationCloud=require('TypeStatutInterrogationCloud.js').TypeStatutInterrogationCloud;const EGenreEvenementTreeView=require('Enumere_EvenementTreeView.js');const ObjetDonneesTreeView_FichiersCloud=require('ObjetDonneesTreeViewFichiersCloud.js');const TypeThemeBouton=require('Type_ThemeBouton.js');const EGenreAction=require('Enumere_Action.js');const UtilitaireBoutonBandeau=require('UtilitaireBoutonBandeau.js');const ObjetRequeteCloudAttente=require('ObjetRequeteCloudAttente.js');const UtilitaireOAuth2=require('UtilitaireOAuth2.js');class ObjetFenetre_FichiersCloud extends ObjetFenetre{constructor(...aParams){super(...aParams);this.Titre=GTraductions.getValeur('FenetreCloud.TitreFichierCloud');this.setOptionsFenetre({largeur:625,hauteur:420,modale:false,listeBoutons:[{libelle:GTraductions.getValeur('principal.fermer'),theme:TypeThemeBouton.secondaire},{theme:TypeThemeBouton.primaire,estValider:true}
],listeBoutonsInactifs:[false,true],modeSelectionRepertoirePourUpload:false});}
ConstruireInstances(){this.idTreeView=this.Add(ObjetTreeView,_evntTreeView.bind(this),_initTreeView.bind(this));this.idListe=this.Add(ObjetListe,_evntListe.bind(this),_initListe.bind(this));}
SetDonnees(aParam){this.listeCloud=GEtatUtilisateur.listeCloud;if(aParam.idPartage){const lNodeDossier=this.getNodeDossier(this.donneesTreeView,aParam.idPartage);if(lNodeDossier&&aParam.racineFichier){const lElementService=this.listeCloud.GetElementParNumeroEtGenre(null,aParam.service);const lPere=lNodeDossier.pere;this.donneesTreeView.construireNodesDeRacine(aParam.racineFichier,lPere,lNodeDossier);const lNodeSelection=this.GetInstance(this.idTreeView).nodeSelection;this.GetInstance(this.idTreeView).actualiser();this.GetInstance(this.idTreeView)._appliquerSelection(lNodeSelection,false,false);if(lNodeSelection.contenu.idPartage===aParam.idPartage&&aParam.racineFichier&&aParam.racineFichier.listeFichier&&aParam.racineFichier.listeFichier.GetNbrElements()>0){this.GetInstance(this.idListe).SetDonnees(new DonneesListe_FichiersCloud(aParam.racineFichier.listeFichier).setOptions({estMonoSelection:this.optionsFenetre.modeSelectionRepertoirePourUpload,uniquementRepertoireVisible:this.optionsFenetre.modeSelectionRepertoirePourUpload,avecSelectionRepertoire:(lElementService&&lElementService.avecPartageDossier)||this.optionsFenetre.modeSelectionRepertoirePourUpload}));const lColonnesCachees=[];if(!lElementService||!lElementService.avecChoixFormat){lColonnesCachees.push(DonneesListe_FichiersCloud.genreColonne.formatPub);}
this.GetInstance(this.idListe).setOptionsListe({colonnesCachees:lColonnesCachees});}}} else if(aParam.racineFichier){const lElementService=this.listeCloud.GetElementParNumeroEtGenre(null,aParam.service);this.param=aParam;this.donneesTreeView=new ObjetDonneesTreeView_FichiersCloud(this.param.racineFichier);this.GetInstance(this.idTreeView).SetDonnees(this.donneesTreeView);this.GetInstance(this.idListe).SetDonnees(new DonneesListe_FichiersCloud(this.param.racineFichier.listeFichier).setOptions({estMonoSelection:this.optionsFenetre.modeSelectionRepertoirePourUpload,uniquementRepertoireVisible:this.optionsFenetre.modeSelectionRepertoirePourUpload,avecSelectionRepertoire:(lElementService&&lElementService.avecPartageDossier)||this.optionsFenetre.modeSelectionRepertoirePourUpload}));const lColonnesCachees2=[];if(!lElementService||!lElementService.avecChoixFormat){lColonnesCachees2.push(DonneesListe_FichiersCloud.genreColonne.formatPub);}
this.GetInstance(this.idListe).setOptionsListe({colonnesCachees:lColonnesCachees2});} else{this.param=aParam;if(!aParam.inscriptionSeule){this.setOptionsFenetre({titre:GTraductions.getValeur('FenetreCloud.TitreFichierCloud',[this.listeCloud.GetElementParNumeroEtGenre(null,aParam.service).GetLibelle()])});}
new ObjetRequeteCloudAttente(this).lancerRequete({service:aParam.service,recupFichiers:true}).then((aParams) =>{_surReponseCloudAttente.call(this,aParams);});}
if(!this.param.inscriptionSeule){this.Afficher();this.GetInstance(this.idTreeView).surResize();this.GetInstance(this.idListe).Actualiser();}}
getControleur(aInstance){return $.extend(true,super.getControleur(aInstance),{btnMrFiche:{event(){GApplication.getMessage().afficher({idRessource:'mficheliencloud'});},getTitle(){return GTraductions.getTitreMFiche('mficheliencloud');}},fenetreBtn:{getLibelle(aBoutonRepeat){if(aBoutonRepeat.element.estValider){return aInstance.optionsFenetre.modeSelectionRepertoirePourUpload?GTraductions.getValeur('FenetreCloud.ChoisirRepertoire_FichierCloud'):GTraductions.getValeur('FenetreCloud.PartagerFichierCloud');}
return aBoutonRepeat.element.libelle;}}});}
SurValidation(aGenreBouton){if(aGenreBouton===1&&this.param.racineFichier){const lListeSelection=this.getSelection(this.param.racineFichier);if(this.listeCloud.GetElementParNumeroEtGenre(null,this.param.service).avecChoixFormat&&lListeSelection.getListeElements(function(aEle){return aEle.pubPdf;}).GetNbrElements()>0){GApplication.getMessage().afficher({type:EGenreBoiteMessage.Confirmation,titre:GTraductions.getValeur('FenetreCloud.TitreFenetreFormat'),message:_composeMessage(lListeSelection.getListeElements(function(aEle){return aEle.pubPdf;})),controleur:{radioFormat:{getValue:function(aIdPartage,aFormat){return lListeSelection.getListeElements(function(aEle){return aEle.idPartage===aIdPartage;}).GetElement(0).formatPub===aFormat;},setValue:function(aIdPartage,aFormat){lListeSelection.getListeElements(function(aEle){return aEle.idPartage===aIdPartage;}).GetElement(0).formatPub=aFormat;}}},callback:function(aGenreAction){if(aGenreAction===EGenreAction.Valider){this.callback.appel(ObjetFenetre_FichiersCloud.genreAction.bouton,{bouton:aGenreBouton,service:this.param.service,listeSelection:lListeSelection});}}.bind(this)});} else{this.callback.appel(ObjetFenetre_FichiersCloud.genreAction.bouton,{bouton:aGenreBouton,service:this.param.service,listeSelection:lListeSelection});}}
this.Fermer();}
ComposeContenu(){const T=[];T.push('<div class="NoWrap">');T.push('<div id="',this.GetNomInstance(this.idTreeView),'" class="InlineBlock AlignementHaut" style="width:300px;height:350px;margin-right:10px;"></div>');T.push('<div id="',this.GetNomInstance(this.idListe),'" class="InlineBlock AlignementHaut" style="width:300px;height:350px;"></div>');T.push('</div>');return T.join('');}
ComposeBas(){const T=[];if(!this.optionsFenetre.modeSelectionRepertoirePourUpload){T.push('<div>',UtilitaireBoutonBandeau.getHtmlBtnMonsieurFiche('btnMrFiche'),'</div>');}
return T.join('');}
getNodeDossier(aDonneeTreeView,aId){let lResult;for(let i=0,lNb=aDonneeTreeView.listeNodes.length;i<lNb;i++){const lElement=aDonneeTreeView.listeNodes[i];if(lElement.contenu.GetGenre()===TTypeElementCloud.tec_Dossier&&lElement.contenu.idPartage===aId){lResult=lElement;break;}}
return lResult;}
getDossier(aRacine,aId){let lResult;if(aRacine.GetGenre()===TTypeElementCloud.tec_Dossier&&aRacine.idPartage===aId){lResult=aRacine;} else{const lNb=(aRacine.listeFichier?aRacine.listeFichier.GetNbrElements():0);for(let i=0;i<lNb;i++){const lElement=aRacine.listeFichier.GetElement(i);if(lElement.GetGenre()===TTypeElementCloud.tec_Dossier){lResult=this.getDossier(lElement,aId);}
if(lResult!==undefined){break;}}}
return lResult;}
getNbSelection(aRacine){let lResult=0;if(aRacine.selection){lResult+=1;}
const lNb=(aRacine.listeFichier?aRacine.listeFichier.GetNbrElements():0);for(let i=0;i<lNb;i++){const lElement=aRacine.listeFichier.GetElement(i);if(lElement.selection){lResult+=1;}
if(lElement.GetGenre()===TTypeElementCloud.tec_Dossier){lResult+=this.getNbSelection(lElement);}}
return lResult;}
getSelection(aRacine){const lResult=new ObjetListeElements();const lNb=(aRacine.listeFichier?aRacine.listeFichier.GetNbrElements():0);for(let i=0;i<lNb;i++){const lElement=aRacine.listeFichier.GetElement(i);if(lElement.selection){const lNewElement=new ObjetElement(lElement.GetLibelle(),lElement.GetGenre());lNewElement.idPartage=lElement.idPartage;lNewElement.formatPub=lElement.formatPub;lNewElement.pubPdf=lElement.pubPdf;lResult.AddElement(lNewElement);}
if(lElement.GetGenre()===TTypeElementCloud.tec_Dossier){lResult.FusionnerListe(this.getSelection(lElement));}}
if(lResult.GetNbrElements()>0){return lResult;} else{return false;}}
interrompre(){Invocateur.evenement(ObjetInvocateur.events.modification_RequeteAttente,{nomRequete:'Cloud',donnees:{interrompre:true}});}
static eventFenetreFichierCloud(aAction,aParam,aCallbackElement,aCallbackGlobal){if(aAction===ObjetFenetre_FichiersCloud.genreAction.bouton&&aParam.bouton===1){if(aParam.listeSelection&&aParam.listeSelection.GetNbrElements()){for(let i=0,lNb=aParam.listeSelection.GetNbrElements();i<lNb;i++){const lElement=aParam.listeSelection.GetElement(i);const lNewElement=new ObjetElement(lElement.GetLibelle(),null,EGenreDocumentJoint.Cloud);lNewElement.service=aParam.service;lNewElement.idPartage=lElement.idPartage;lNewElement.url=lElement.url;lNewElement.publiPdf=lElement.pubPdf?lElement.formatPub:TypeFormatPublication.FP_Natif;lNewElement.SetEtat(EGenreEtat.Creation);aCallbackElement(lNewElement);}
aCallbackGlobal();}}}}
ObjetFenetre_FichiersCloud.genreAction={listeFichiers:0,bouton:1};function _surReponseCloudAttente(aParamCloud,aEnAuthCloud){if(aParamCloud.status===TypeStatutInterrogationCloud.sic_OK&&!aEnAuthCloud){if(!this.param.inscriptionSeule){this.SetDonnees(aParamCloud);this.setOptionsFenetre({titre:GTraductions.getValeur('FenetreCloud.TitreFichierCloud',[this.listeCloud.GetElementParNumeroEtGenre(null,aParamCloud.service).GetLibelle()])});} else{if(MethodesObjet.isFunction(this.param.callbackInscriptionSeule)){this.param.callbackInscriptionSeule();}
this.Fermer();}} else if(aParamCloud.status===TypeStatutInterrogationCloud.sic_TokenInvalide&&!aEnAuthCloud){UtilitaireOAuth2.authentification_promise(aParamCloud.idOAuth2).then(() =>{new ObjetRequeteCloudAttente(this).lancerRequete(aParamCloud).then((aParamsReponse) =>{let lService=GEtatUtilisateur.listeCloud.GetElementParNumeroEtGenre(null,aParamCloud.service);if(!!lService){lService.idOAuth2=aParamCloud.idOAuth2;}
lService=GEtatUtilisateur.listeCloudDepotServeur.GetElementParNumeroEtGenre(null,aParamCloud.service);if(!!lService){lService.idOAuth2=aParamCloud.idOAuth2;}
if(aParamCloud.partageFichier){this.Valider(aParamsReponse);} else{_surReponseCloudAttente.call(this,aParamsReponse,aParamCloud.oauth);}});},() =>{this.Fermer();});} else{GApplication.getMessage().afficher({message:aParamCloud.message||GTraductions.getValeur('requete.erreur')}).then(() =>{this.Fermer();});}}
function _evntTreeView(aGenreEvenement,aNode){switch(aGenreEvenement){case EGenreEvenementTreeView.selection:if(aNode&&aNode.contenu&&(aNode.contenu.GetGenre()===TTypeElementCloud.tec_Dossier)){this.GetInstance(this.idListe).Reset();this.SetBoutonActif(1,false);new ObjetRequeteCloudAttente(this).lancerRequete({service:this.param.service,idPartage:aNode.contenu.idPartage,recupFichiers:true}).then((aParams) =>{aParams.idPartage=aNode.contenu.idPartage;_surReponseCloudAttente.call(this,aParams);});}
break;}}
function _initTreeView(aInstance){aInstance.SetParametres();}
function _initListe(aInstance){aInstance.setOptionsListe({colonnes:[{titre:'',taille:25},{titre:GTraductions.getValeur('FenetreCloud.NomFichierCloud'),taille:'100%'},{titre:GTraductions.getValeur('FenetreCloud.FormatPublication'),taille:50},{titre:GTraductions.getValeur('FenetreCloud.TailleFichierCloud'),taille:50}
]});}
function _evntListe(aParametres){if(aParametres.genreEvenement===EGenreEvenementListe.ApresEdition){const lNbSelection=this.getNbSelection(this.param.racineFichier);this.SetBoutonActif(1,lNbSelection>0);}}
function _composeMessage(aListeFichiers){const H=[];H.push('<div class="Gras">',GTraductions.getValeur('FenetreCloud.ExplicationFenetreFormat'),'</div>');H.push('<div class="EspaceHaut EspaceGauche">');aListeFichiers.parcourir(function(aEle){H.push('<div><span>'+aEle.GetLibelle()+'</span><ie-radio ie-model="radioFormat(\''+aEle.idPartage+'\','+TypeFormatPublication.FP_Natif,')" class="EspaceHaut">',GTraductions.getValeur('FenetreCloud.FormatOrigine'),'</ie-radio><ie-radio ie-model="radioFormat(\''+aEle.idPartage+'\','+TypeFormatPublication.FP_Pdf,')" class="EspaceHaut">',GTraductions.getValeur('FenetreCloud.FormatPdf'),'</ie-radio></div>');});H.push('</div>');H.push('<div class="GrandEspaceHaut">',GTraductions.getValeur('FenetreCloud.ConfirmationFenetreFormat'),'</div>');return H.join('');}
module.exports=ObjetFenetre_FichiersCloud;},fn:"objetfenetre_fichierscloud.js"});;
IE.fModule({f:function(exports,require,module,global){const ObjetFenetre=require('ObjetFenetre.js');const ObjetElement=require('ObjetElement.js');const GTraductions=require('ObjetTraduction.js');const tag=require('tag.js');const EGenreEtat=require('Enumere_Etat.js');const MethodesObjet=require('MethodesObjet.js');class ObjetFenetre_EditionDossierMediatheque extends ObjetFenetre{constructor(...aParams){super(...aParams);this.setOptionsFenetre({largeur:300,hauteur:null,avecTailleSelonContenu:true});this.enCreation=false;}
getControleur(aInstance){return $.extend(true,super.getControleur(aInstance),{LibelleDossier:{getValue:function(){aInstance.SetBoutonActif(1,!!aInstance.dossier&&!!aInstance.dossier.GetLibelle()?true:false);return aInstance.dossier?aInstance.dossier.GetLibelle():'';},setValue:function(aValue){if(aInstance.dossier){aInstance.dossier.SetLibelle(aValue);aInstance.enModification=true;}}}});}
ComposeContenu(){const T=[];T.push(tag('textarea',{type:'text','ie-model':'LibelleDossier',class:'round-style EspaceInput',style:'width:100%;',title:GTraductions.getValeur('FenetreCategorieEvaluation.TitreLibelle'),'placeholder':GTraductions.getValeur('FenetreCategorieEvaluation.TitreLibelle')}));return T.join('');}
SetDonnees(aDossier){this.dossier=aDossier?MethodesObjet.dupliquer(aDossier):new ObjetElement();if(!aDossier){this.enCreation=true;}
this.enModification=false;this.Afficher();this.positionnerFenetre();}
SurValidation(aGenreBouton){if(aGenreBouton===1){this.Fermer();if(this.enCreation){this.dossier.SetEtat(EGenreEtat.Creation);} else if(this.enModification&&this.dossier.Etat!==EGenreEtat.Creation){this.dossier.SetEtat(EGenreEtat.Modification);}
this.callback.appel(this.dossier);} else{this.Fermer();}}}
module.exports=ObjetFenetre_EditionDossierMediatheque;},fn:"objetfenetre_editiondossiermediatheque.js"});;
IE.fModule({f:function(exports,require,module,global){const ObjetElement=require('ObjetElement.js');const ObjetListeElements=require('ObjetListeElements.js');const GTraductions=require('ObjetTraduction.js');const TypeThemeBouton=require('Type_ThemeBouton.js');const EGenreBoiteMessage=require('Enumere_BoiteMessage.js');const EGenreAction=require('Enumere_Action.js');const EGenreEtat=require('Enumere_Etat.js');const{GDate}=require('ObjetDate.js');const ObjetTri=require('ObjetTri.js');const GHtml=require('GHtml.js');const GStyle=require('GStyle.js');const EGenreTriElement=require('Enumere_TriElement.js');const TypeEtatCommentaireBillet=require('TypeEtatCommentaireBillet.js').TypeEtatCommentaireBillet;const GChaine=require('GChaine.js');const EGenreDocumentJoint=require('Enumere_DocumentJoint.js');const ObjetFenetre=require('ObjetFenetre.js');const ObjetFenetre_FichiersCloud=require('ObjetFenetre_FichiersCloud.js');const{TypeDroits}=require('ObjetDroitsPN.js');const EFormatDocJoint=require('Enumere_FormatDocJoint.js');const tag=require('tag.js');const EGenreRessource=require('Enumere_Ressource.js');const EGenreEspace=require('Enumere_Espace.js');const MethodesTableau=require('MethodesTableau.js');const EGenreEvenementListe=require('Enumere_EvenementListe.js');const ObjetFenetre_EditionDossierMediatheque=require('ObjetFenetre_EditionDossierMediatheque.js');require('produit/css/ObjetBlocBillet.css');const EGenreActionBlog={creerCommentaire:1,annulerCreationCommentaire:2,accepterCommentaire:3,refuserCommentaire:4,supprimerCommentaire:5};const EGenreEvntBillet={SurEdition:1,SurModifPublication:2,SurEditionCommentaire:3,SurSuppression:4};EGenreActionBlog.getLibelle=function(aGenre){let lClef;switch(aGenre){case EGenreActionBlog.creerCommentaire:lClef='Valider';break;case EGenreActionBlog.annulerCreationCommentaire:lClef='Annuler';break;case EGenreActionBlog.accepterCommentaire:lClef='blog.accepter';break;case EGenreActionBlog.refuserCommentaire:lClef='blog.refuser';break;default:return'';}
return GTraductions.getValeur(lClef);};EGenreActionBlog.getTheme=function(aGenre){switch(aGenre){case EGenreActionBlog.annulerCreationCommentaire:case EGenreActionBlog.refuserCommentaire:return TypeThemeBouton.secondaire;case EGenreActionBlog.creerCommentaire:case EGenreActionBlog.accepterCommentaire:return TypeThemeBouton.primaire;default:return TypeThemeBouton.secondaire;}};class ObjetMoteurBlog{creerBilletParDefaut(aParam){const lResult=new ObjetElement();lResult.titre='';lResult.contenu='';lResult.datePublication=new Date();lResult.dateDerniereModif=new Date();lResult.auteur=GEtatUtilisateur.getUtilisateur();lResult.listeCoAuteurs=new ObjetListeElements();lResult.categorie=new ObjetElement('',0);let lDiffusionEcole=false;if((aParam!==null)&&(aParam!==undefined)&&(aParam.estTypeDiffEcole!==null)&&(aParam.estTypeDiffEcole!==undefined)){lDiffusionEcole=aParam.estTypeDiffEcole;}
lResult.estTypeDiffEcole=lDiffusionEcole;lResult.autoriseCommentaires=true;lResult.listeCommentaires=new ObjetListeElements();lResult.listeDocuments=new ObjetListeElements();return lResult;}
copierBillet(aBillet){const lResult=new ObjetElement(aBillet.GetLibelle(),aBillet.GetNumero(),aBillet.GetGenre());const lAuteur=aBillet.auteur;lResult.auteur=new ObjetElement(lAuteur.GetLibelle(),lAuteur.GetNumero(),lAuteur.GetGenre());if((lAuteur.libelleAffichage!==null)&&(lAuteur.libelleAffichage!==undefined)){lResult.auteur.libelleAffichage=lAuteur.libelleAffichage;}
lResult.listeCoAuteurs=new ObjetListeElements();aBillet.listeCoAuteurs.parcourir(function(D){const lCoAuteur=new ObjetElement(D.GetLibelle(),D.GetNumero(),D.GetGenre());if((D.libelleAffichage!==null)&&(D.libelleAffichage!==undefined)){lCoAuteur.libelleAffichage=D.libelleAffichage;}
lResult.listeCoAuteurs.AddElement(lCoAuteur);}.bind(this));lResult.listeDocuments=new ObjetListeElements();aBillet.listeDocuments.parcourir(function(D){const lDocRelation=new ObjetElement(D.GetLibelle(),D.GetNumero(),D.GetGenre());lDocRelation.documentCasier=new ObjetElement(D.documentCasier.GetLibelle(),D.documentCasier.GetNumero(),D.documentCasier.GetGenre());if(D.documentCasier.miniature!==null&&D.documentCasier.miniature!==undefined){lDocRelation.documentCasier.miniature=D.documentCasier.miniature;}
lDocRelation.libelle=D.documentCasier.commentaire;lResult.listeDocuments.AddElement(lDocRelation);}.bind(this));const lCategorie=aBillet.categorie;lResult.categorie=new ObjetElement(lCategorie.GetLibelle(),lCategorie.GetNumero(),lCategorie.GetGenre());if(lCategorie.eltAucun!==null&&lCategorie.eltAucun!==undefined){lResult.categorie.eltAucun=lCategorie.eltAucun;}
lResult.titre=aBillet.titre;lResult.contenu=aBillet.contenu;lResult.aDejaEtePublie=aBillet.aDejaEtePublie;lResult.autoriseCommentaires=aBillet.autoriseCommentaires;lResult.estEditable=aBillet.estEditable;lResult.estPublie=aBillet.estPublie;lResult.estTypeDiffEcole=aBillet.estTypeDiffEcole;lResult.dateAffichage=aBillet.dateAffichage;lResult.datePublication=aBillet.datePublication;lResult.dateDerniereModif=aBillet.dateDerniereModif;lResult.nbCommentairesAModerer=aBillet.nbCommentairesAModerer;lResult.nbCommentairesTotal=aBillet.nbCommentairesTotal;lResult.couleurClaire=aBillet.couleurClaire;lResult.couleurFoncee=aBillet.couleurFoncee;return lResult;}
estBilletPublie(aBillet){return(aBillet.estPublie!==undefined)&&(aBillet.estPublie!==null)?aBillet.estPublie:false;}
estBilletEditable(aBillet){return aBillet.estEditable;}
estBilletAvecCoAuteurs(aBillet){return(aBillet.listeCoAuteurs!==null)&&(aBillet.listeCoAuteurs!==undefined)&&aBillet.listeCoAuteurs.GetNbrElements()>0;}
nbRedacteursBillet(aBillet){const lNbCoAuteurs=(aBillet.listeCoAuteurs!==null)&&(aBillet.listeCoAuteurs!==undefined)?aBillet.listeCoAuteurs.GetNbrElementsExistes():0;return lNbCoAuteurs+1;}
getLibelleAuteur(aAuteur){return((aAuteur.libelleAffichage!==null)&&(aAuteur.libelleAffichage!==undefined))?aAuteur.libelleAffichage:aAuteur.GetLibelle();}
composeChipsAuteur(aParam){const T=[];const lAuteur=aParam.auteur;const lLibelle=this.getLibelleAuteur(lAuteur);T.push('<div style="display:flex; border-radius:10px; background-color:',GCouleur.themeNeutre.claire,'; color:',GCouleur.themeNeutre.sombre,'; margin: 3px 5px 3px 5px; padding : 0px 10px 0px 10px;">');T.push('<div ie-ellipsis>',lLibelle,'</div>');if(aParam.avecSuppression){T.push('<ie-btnimage ie-model="btnSupprCoAuteur(\'',lAuteur.GetNumero(),'\')" style="margin-left:5px; align-self:flex-end;" class="btnImageIcon icon_remove"></ie-btnimage>');}
T.push('</div>');return T.join('');}
getHintCoAuteurs(aListe){const H=[];aListe.parcourir(function(D){const lLibelle=this.getLibelleAuteur(D);H.push(lLibelle);}.bind(this));return H.join(', ');}
composeHtmlPortrait(aParam){const T=[];const lSize=aParam.cssSize?aParam.cssSize:'size-l';const lColor=aParam.cssTheme?aParam.cssTheme:'';T.push('<div class="portrait ',lSize,' ',lColor,'">');if((aParam.estGroupe===true)||(aParam.eltPortrait===null)||(aParam.eltPortrait===undefined)||(aParam.eltPortrait.avecPhoto!==true)){T.push('<i class="',aParam.estGroupe===true?'icon_group group':'icon_user user','"></i>');} else{const lSrcPhoto=GChaine.creerUrlBruteLienExterne(aParam.eltPortrait,{libelle:'photo.jpg'});T.push('<img src="',lSrcPhoto,'" ',(aParam.estCtxFantome===true?'':GHtml.composeAttr('ie-node','nodePhoto',aParam.eltPortrait.GetNumero())),' />');T.push('<div class="ibe_util_photo_i"',(lSrcPhoto?' style="display:none"':''),'>','<i class="icon_user user"></i>','</div>');}
T.push('</div>');return T.join('');}
composeResumeBillet(aBillet,aParam){const lAvecCoAuteurs=this.estBilletAvecCoAuteurs(aBillet);const H=[];H.push('<div style="display:flex; align-items : center; margin-right:15px;">');H.push('<div>',this.composeHtmlPortrait({cssSize:' size-l ',estGroupe:lAvecCoAuteurs,eltPortrait:aBillet.auteur,estCtxFantome:aParam.estCtxFantome}),'</div>');H.push('<div style="margin-left:10px;">');H.push('<div>',this.composeChipsAuteur({auteur:aBillet.auteur,avecSuppression:false}),'</div>');H.push('<div style="margin-left:15px;">',GDate.FormatDate(aBillet.dateAffichage,'%JJJ %JJ %MMM'),'</div>');H.push('</div>');H.push('<div style="margin-left:10px;">',this.composeIconeTypeDiffusion(aBillet),aBillet.titre,'</div>');H.push('</div>');return H.join('');}
getIconeTypeDiffusion(aEstTypeDiffEcole){return aEstTypeDiffEcole?'icon_pour_ecole':'icon_ecole';}
getCouleurTypeDiffusion(aEstTypeDiffEcole){return aEstTypeDiffEcole?'#7cb744':'#AB96E4';}
getHintTypeDiffusion(aEstTypeDiffEcole){return aEstTypeDiffEcole?GTraductions.getValeur('blog.billet.typeDiff_Ecole'):GTraductions.getValeur('blog.billet.typeDiff_Classe');}
composeIconeTypeDiffusion(aBillet){const lEstTypeDiffEcole=aBillet.estTypeDiffEcole;const lIcon=this.getIconeTypeDiffusion(lEstTypeDiffEcole);const lColor=this.getCouleurTypeDiffusion(lEstTypeDiffEcole);const lHint=this.getHintTypeDiffusion(lEstTypeDiffEcole);const T=[];T.push('<i title="',lHint,'" class="',lIcon,'" style="font-size:20px; color:',lColor,'; margin:5px;"></i>');return T.join('');}
composeHtmlBtnCreerBillet(){const H=[];const lBtnCreerBillet=['<ie-bouton ie-model="btnCreerBillet" ie-icon="icon_edit" class="themeBoutonPrimaire">',GTraductions.getValeur('blog.nouveauBillet'),'</ie-bouton>'];H.push('<div ie-style="visibiliteBtnCreerBillet">',lBtnCreerBillet.join(''),'</div>');return H.join('');}
ouvrirFenetreSurCreerBillet(aParam){const lInstance=aParam.instanceFenetre;if(lInstance){lInstance.setOptionsFenetre({titre:GTraductions.getValeur('blog.creerBillet')});lInstance.SetDonnees({donnee:null,listeCategories:aParam.listeCategories.getListeElements(function(aElt){return(aElt.toutesLesCategories!==true);}),categorieParDefaut:aParam.categorieParDefaut,listeEleves:aParam.listeEleves,elevesAvecCumulParClasse:aParam.elevesAvecCumulParClasse,creation:true,avecCocheAutorisationCommentaires:aParam.avecCocheAutorisationCommentaires,avecEditionCategories:aParam.avecEditionCategories,avecEditionEtatPublication:aParam.avecEditionEtatPublication,avecEditionRedacteurs:aParam.avecEditionRedacteurs,avecEditionDiffusion:aParam.avecEditionDiffusion,avecMediatheque:aParam.avecMediatheque,estTypeDiffEcole:aParam.estTypeDiffEcole,tailleMaxCommentaires:aParam.tailleMaxCommentaires,listeClasses:aParam.listeClasses,avecFichiersJoints:aParam.avecFichiersJoints});}}
ouvrirFenetreSurEditerBillet(aParam){const lInstance=aParam.instanceFenetre;if(lInstance){lInstance.setOptionsFenetre({titre:GTraductions.getValeur('blog.creerBillet')});lInstance.SetDonnees({donnee:aParam.billet,listeCategories:aParam.listeCategories.getListeElements(function(aElt){return(aElt.toutesLesCategories!==true);}),listeEleves:aParam.listeEleves,elevesAvecCumulParClasse:aParam.elevesAvecCumulParClasse,creation:false,avecCocheAutorisationCommentaires:aParam.avecCocheAutorisationCommentaires,avecEditionCategories:aParam.avecEditionCategories,avecEditionEtatPublication:aParam.avecEditionEtatPublication,avecEditionRedacteurs:aParam.avecEditionRedacteurs,avecEditionDiffusion:aParam.avecEditionDiffusion,avecMediatheque:aParam.avecMediatheque,estTypeDiffEcole:aParam.estTypeDiffEcole,tailleMaxCommentaires:aParam.tailleMaxCommentaires,listeClasses:aParam.listeClasses,avecFichiersJoints:aParam.avecFichiersJoints});}}
existeCommentairesSurBillet(aBillet){return(aBillet!==null)&&(aBillet!==undefined)&&(aBillet.listeCommentaires!==null)&&(aBillet.listeCommentaires!==undefined)&&(aBillet.listeCommentaires.GetNbrElements()>0);}
initEditionBillet(aInstance){aInstance.setOptionsFenetre({titre:GTraductions.getValeur('blog.creerBillet'),largeur:850,hauteur:700,listeBoutons:[{libelle:GTraductions.getValeur('Annuler'),theme:TypeThemeBouton.secondaire},{libelle:GTraductions.getValeur('Valider'),theme:TypeThemeBouton.primaire}
],avecComposeBasInFooter:true});aInstance.avecEtatSaisie=false;}
initEditionCommentaires(aInstance){aInstance.setOptionsFenetre({titre:GTraductions.getValeur('blog.editerCommentaires'),largeur:500,hauteurMaxContenu:600,avecScroll:true,listeBoutons:[{libelle:GTraductions.getValeur('Fermer'),theme:TypeThemeBouton.secondaire}
]});aInstance.avecEtatSaisie=false;}
evntsurSuppressionBillet(aBillet,aClbck){GApplication.getMessage().afficher({type:EGenreBoiteMessage.Confirmation,message:GTraductions.getValeur('blog.msgConfirmSuppression',[aBillet.titre]),callback:function(aBillet ,aGenreBouton){if(aGenreBouton===EGenreAction.Valider){aBillet.SetEtat(EGenreEtat.Suppression);aClbck();}}.bind(this,aBillet)});}
getCategorieAucune(aListeCategories){const lListeEltAucun=aListeCategories.getListeElements(function(aElt){return(aElt.eltAucun===true);});if(lListeEltAucun.GetNbrElements()>0){return lListeEltAucun.GetElement(0);}}
estAuteurOuCoAuteurDuBillet(aUser,aBillet){if((aUser===null)||(aUser===undefined)||(aBillet===null)||(aBillet===undefined)||(aBillet.auteur===null)||(aBillet.auteur===undefined)||(aBillet.listeCoAuteurs===null)||(aBillet.listeCoAuteurs===undefined)){return false;}
let lResult=false;if(aUser.GetNumero()===aBillet.auteur.GetNumero()){lResult=true;} else{aBillet.listeCoAuteurs.parcourir(function(aCoAuteur){if(aCoAuteur.GetNumero()===aUser.GetNumero()){lResult=true;}});}
return lResult;}
estBilletDeListeEleves(aBillet,aListeEleves){if((aBillet===null)||(aBillet===undefined)||(aBillet.auteur===null)||(aBillet.auteur===undefined)||(aBillet.listeCoAuteurs===null)||(aBillet.listeCoAuteurs===undefined)){return false;}
let lResult=false;const lAuteur=aBillet.auteur;lResult=_estUserDansListeEleves.call(this,lAuteur,aListeEleves);if(lResult===false){aBillet.listeCoAuteurs.parcourir(function(aCoAuteur){if(lResult===false){lResult=_estUserDansListeEleves.call(this,aCoAuteur,aListeEleves);}});}
return lResult;}
estBilletDeMembreDUtilisateur(aBillet){let lResult=false;const lListeMembres=GEtatUtilisateur.Identification.ListeRessources;lListeMembres.parcourir(function(aMembre){if(lResult===false){lResult=this.estAuteurOuCoAuteurDuBillet(aMembre,aBillet);}}.bind(this));return lResult;}
estCommentaireDeMembreDUtilisateur(aCommentaire){let lResult=false;const lListeMembres=GEtatUtilisateur.Identification.ListeRessources;lListeMembres.parcourir(function(aMembre){if(lResult===false){lResult=this.estCommentaireDUser(aCommentaire,aMembre);}}.bind(this));return lResult;}
estBilletDUtilisateurConnecte(aBillet){const lUserConnecte=GEtatUtilisateur.getUtilisateur();return this.estAuteurOuCoAuteurDuBillet(lUserConnecte,aBillet);}
surValidationBillet(aParam){const lBillet=aParam.billet;if((lBillet.estPublie===true)&&(lBillet.aDejaEtePublie!==null)&&(lBillet.aDejaEtePublie!==undefined)&&(lBillet.aDejaEtePublie===true)&&!GDate.estJourEgal(lBillet.datePublication,new Date())){const lOptionsPublication={conserverDate:true};lBillet.conserverDate=lOptionsPublication.conserverDate;GApplication.getMessage().afficher({type:EGenreBoiteMessage.Confirmation,message:GTraductions.getValeur('blog.msgConfirmDecisionDate_1')+'<br/>'+'<br/>'+'<ie-checkbox ie-model="surCheckbox">'+GTraductions.getValeur('blog.msgConfirmDecisionDate_Option')+'</ie-checkbox>'+'<br/>'+'<br/>'+
GTraductions.getValeur('blog.msgConfirmDecisionDate_2'),callback:function(aGenreBouton){if(aGenreBouton===EGenreAction.Valider){lBillet.conserverDate=lOptionsPublication.conserverDate;aParam.clbck();} else{if((aParam.clbckSurNon!==null)&&(aParam.clbckSurNon!==undefined)){aParam.clbckSurNon();}}}.bind(this),controleur:{surCheckbox:{getValue:function(){return lOptionsPublication.conserverDate;},setValue:function(aValue){lOptionsPublication.conserverDate=aValue;}}}});} else{aParam.clbck();}}
deserialiserListeCategories(aListeDonnees,aAvecToutes){const lListeCategories=aListeDonnees;lListeCategories.parcourir(function(aCategorie){if(!aCategorie.existeNumero()){aCategorie.SetLibelle(GTraductions.getValeur('fenetre.Aucune'));aCategorie.Genre=0;aCategorie.eltAucun=true;aCategorie.estEditable=false;aCategorie.couleur='#ffffff';} else{aCategorie.estEditable=true;aCategorie.SetLibelle(aCategorie.libelle);}});if(aAvecToutes===true){const lCategorie=new ObjetElement(GTraductions.getValeur('blog.ToutesCategories'),0);lCategorie.toutesLesCategories=true;lListeCategories.AddElement(lCategorie);}
lListeCategories.setTri([
ObjetTri.init(function(D){return!D.toutesLesCategories;}),ObjetTri.init(function(D){return!D.eltAucun;}),ObjetTri.init('Libelle')
]);lListeCategories.trier();return lListeCategories;}
getListeElevesDeClasses(aListeClasses){const lListeEleves=new ObjetListeElements();if(aListeClasses!==null&&aListeClasses!==undefined){aListeClasses.parcourir(function(aClasse){aClasse.listeEleves.parcourir(function(aEleve){aEleve.classes=new ObjetListeElements().AddElement(new ObjetElement(aClasse.GetLibelle(),aClasse.GetNumero(),aClasse.GetGenre()));});lListeEleves.FusionnerListe(aClasse.listeEleves);});}
return lListeEleves;}
estBilletCommentable(aBillet){return(aBillet.autoriseCommentaires===true)&&this.estBilletPublie(aBillet);}
estCommentaireDUser(aCommentaire,aUser){if(aCommentaire===null||aCommentaire===undefined||aUser===null||aUser===undefined){return false;}
return aUser.GetNumero()===aCommentaire.auteur.GetNumero();}
creerCommentaireParDefaut(){const lResult=new ObjetElement();lResult.texte='';lResult.date=new Date();lResult.auteur=GEtatUtilisateur.getUtilisateur();lResult.estModeEditable=true;lResult.estAdministrable=false;lResult.estAModerer=false;lResult.estSupprimableDefinitif=false;lResult.estSupprimableEtat=false;return lResult;}
getInfosEtatCommentaire(aCommentaire){return{afficherEtat:!aCommentaire.estModeEditable&&(aCommentaire.afficherEtat===true),etat:aCommentaire.etatCommentaire,iconEtat:TypeEtatCommentaireBillet.getIcon(aCommentaire.etatCommentaire),str:TypeEtatCommentaireBillet.getStrEtat(aCommentaire.etatCommentaire),class:TypeEtatCommentaireBillet.getClass(aCommentaire.etatCommentaire)};}
composeMsgAucun(aParam){const H=[];H.push(tag('div',{class:'zone-msg-aucun'},function(aTabMsgAucun){aTabMsgAucun.push(tag('div',{},aParam.str));}.bind(this)));return H.join('');}
initCarrousel(aParams){aParams.instance.setOptions({dimensionPhoto:aParams.avecEdition&&!IE.estMobile?300:200,nbMaxDiaposEnZoneVisible:aParams.avecEdition?1:4,avecSuppression:aParams.avecEdition,avecEditionLegende:aParams.avecEdition});const lListeDocs=aParams.donnee.listeDocuments;const lListeImages=new ObjetListeElements();if(!!lListeDocs&&lListeDocs.GetNbrElementsExistes()){lListeDocs.parcourir(function(aDoc){if(aDoc.Existe()){if(this.docCasierEstUneImage(aDoc.documentCasier)){lListeImages.add(aDoc);}}}.bind(this));}
aParams.instance.Initialiser();aParams.instance.setDonnees({listeDiapos:lListeImages,ressourceDocJoint:EGenreRessource.DocumentJoint});}
composeCardBillet(aParam){const lBillet=aParam.billet;const H=[];H.push(tag('article',{class:'zone-billet'},function(aTabContenuBillet){if(this.estBilletEditable(lBillet)&&!lBillet.estPublie){aTabContenuBillet.push(tag('header',{class:'header-billet'},tag('i',{class:'icon_edt_permanence m-right-l'}),tag('div',{class:'Italique'},this.avecGestionPublication(GEtatUtilisateur.GenreEspace)?GTraductions.getValeur('blog.BilletAPublier'):GTraductions.getValeur('blog.filtre.enAttentePublication')),tag('ie-btnicon',{class:'avecFond icon_pencil m-right-l','ie-model':tag.funcAttr('btnEditerBillet',[lBillet.GetNumero()]),title:GTraductions.getValeur('blog.EditerBillet')}),this.avecGestionPublication(GEtatUtilisateur.GenreEspace)?tag('ie-btnicon',{class:'avecFond icon_check_fin m-right-l','ie-model':tag.funcAttr('btnPublierBillet',[lBillet.GetNumero()]),title:GTraductions.getValeur('blog.Publier')}):'',tag('ie-btnicon',{class:'avecFond icon_trash','ie-model':tag.funcAttr('btnSupprimerBillet',[lBillet.GetNumero()]),title:GTraductions.getValeur('blog.SupprimerBillet')})));}
aTabContenuBillet.push('<div class="',!lBillet.estPublie?'nonPublie':'','">');aTabContenuBillet.push(tag('div',{class:'zone-entete',tabIndex:0},function(aTabZoneEntete){aTabZoneEntete.push(tag('div',{class:'flex-contain'},tag('time',{class:'agenda'},GDate.FormatDate(lBillet.dateAffichage,'%JJ %MMM')),tag('div',{class:'m-left-l'},tag('div',{class:'ie-titre','ie-ellipsis':false},lBillet.titre),tag('div',{class:'ie-sous-titre','ie-ellipsis':false},this.getHintTypeDiffusion(lBillet.estTypeDiffEcole)))));if((this.estBilletEditable(lBillet)||this.estBilletCommentable(lBillet))&&lBillet.estPublie){aTabZoneEntete.push(tag('ie-btnicon',{class:'icon_ellipsis_vertical','ie-model':'btnActionsBillet',title:GTraductions.getValeur('blog.ActionsSurBillet')}));}}.bind(this)));aTabContenuBillet.push(tag('div',{class:'zone-contenu'},this.getContenuBillet(lBillet)));const lListeDocs=lBillet.listeDocuments;if(!!lListeDocs&&lListeDocs.GetNbrElementsExistes()){const lListeDocumentsCasier=new ObjetListeElements();let lAvecImage=false;lListeDocs.parcourir(function(aDoc){if(aDoc.Existe()){if(!this.docCasierEstUneImage(aDoc.documentCasier)){lListeDocumentsCasier.add(aDoc);} else{lAvecImage=true;}}}.bind(this));const lAvecCarrousel=aParam.idGalerieCarrousel!==null&&aParam.idGalerieCarrousel!==undefined&&lAvecImage;if(lAvecCarrousel){aTabContenuBillet.push(tag('div',{id:aParam.idGalerieCarrousel}));}
const lListePJ=lAvecCarrousel?lListeDocumentsCasier:lListeDocs;aTabContenuBillet.push(tag('div',{class:'zone-docs'},function(aTabZoneDocs){lListePJ.parcourir(function(D){if(D.Existe()){aTabZoneDocs.push(GChaine.composerUrlLienExterne({documentJoint:D.documentCasier,genreRessource:EGenreRessource.DocumentJoint,maxWidth:GNavigateur.EcranL-40}));}}.bind(this));}.bind(this)));}
aTabContenuBillet.push(tag('div',{class:'zone-redacteurs'},function(aTabZoneRedact){aTabZoneRedact.push(tag('div',{class:'ie-titre-petit'},GTraductions.getValeur('blog.redigePar')));aTabZoneRedact.push(tag('div',{},function(aTabListeRedac){const lNbRedacteurs=this.nbRedacteursBillet(lBillet);if(lNbRedacteurs>aParam.nbRedacteursMax){const lStrBtn=GTraductions.getValeur('blog.redacteursN',[lNbRedacteurs]);aTabListeRedac.push(tag('ie-bouton',{'ie-model':'btnVoirRedacteurs',class:'themeBoutonNeutre'},lStrBtn));} else{let lEstSpe=false;if((aParam.listeUsrSpe!==null)&&(aParam.listeUsrSpe!==undefined)){aParam.listeUsrSpe.parcourir(function(aUsr){if(lBillet.auteur.GetNumero()===aUsr.GetNumero()){lEstSpe=true;}}.bind(this));}
aTabListeRedac.push(tag('span',{class:[(lEstSpe?'favori':'')]},lBillet.auteur.GetLibelle()));lBillet.listeCoAuteurs.parcourir(function(D){if(D.Existe()){lEstSpe=false;if((aParam.listeUsrSpe!==null)&&(aParam.listeUsrSpe!==undefined)){aParam.listeUsrSpe.parcourir(function(aUsr){if(D.GetNumero()===aUsr.GetNumero()){lEstSpe=true;}});}
aTabListeRedac.push(', ');aTabListeRedac.push(tag('span',{class:[(lEstSpe?'favori':'')]},D.GetLibelle()));}}.bind(this));}}.bind(this)));}.bind(this)));if(this.estBilletCommentable(lBillet)){const lExisteCommentaires=this.existeCommentairesSurBillet(lBillet);let lCommentairesAffiches,lNbrCommentaires;if(lExisteCommentaires){lCommentairesAffiches=lBillet.listeCommentaires.getListeElements(function(aCommentaire){return(aParam.ignorerCreation!==true)||(aCommentaire.Etat!==EGenreEtat.Creation);});lNbrCommentaires=lCommentairesAffiches.GetNbrElements();}
aTabContenuBillet.push(tag('div',{class:'zone-btns-commentaires'},function(aTabZoneBtnCommentaires){if(lExisteCommentaires){if(lNbrCommentaires>0){const lStrBtn=lNbrCommentaires;aTabZoneBtnCommentaires.push(tag('ie-bouton',{'ie-model':'btnVoirCommentaires','ie-icon':'icon_conversation_cours',class:'themeBoutonNeutre'},lStrBtn));}}
aTabZoneBtnCommentaires.push(tag('ie-bouton',{'ie-model':'btnCommenter',class:'themeBoutonPrimaire'},GTraductions.getValeur('blog.commenter')));}.bind(this)));if(lExisteCommentaires&&lNbrCommentaires>0){let lCommentaire=lCommentairesAffiches.GetElement(0);lCommentairesAffiches.parcourir(aCommentaire =>{if(aCommentaire.estAdministrable&&aCommentaire.estAModerer&&lCommentaire.etatCommentaire!==TypeEtatCommentaireBillet.ECB_Supprime&&!GApplication.droits.get(TypeDroits.estEnConsultation)){lCommentaire=aCommentaire;return false;}});const lEstMien=this.estCommentaireDUser(lCommentaire,GEtatUtilisateur.getUtilisateur())||(this.allumerCommentairesDeMembres(GEtatUtilisateur.GenreEspace)&&this.estCommentaireDeMembreDUtilisateur(lCommentaire));aTabContenuBillet.push(this.composeCardCommentaire({commentaire:lCommentaire,tailleMaxCommentaires:this.tailleMaxCommentaires,styleOn:lEstMien,estTypeDiffEcole:lBillet.estTypeDiffEcole}));}}
aTabContenuBillet.push('</div>');}.bind(this)));return H.join('');}
composeIndicationFiltreCategorie(aCategorie){const H=[];H.push(tag('div',{class:'tag-filtre'},GTraductions.getValeur('blog.contenuFiltrePar',[aCategorie.GetLibelle()])));return H.join('');}
composeEditionCommentaire(aParam){const H=[];const lCommentaire=aParam.commentaire;H.push(tag('div',{class:'editComment-conteneur'},function(aTabEditComment){aTabEditComment.push(tag('ie-textareamax',{'ie-model':tag.funcAttr('saisieCommentaireBlog',[lCommentaire.GetNumero()]),'maxlength':aParam.tailleMaxCommentaires,class:'style-input editComment-input'}));aTabEditComment.push(tag('ie-btnicon',{class:'icon_envoyer editComment-btnEnvoi','ie-model':tag.funcAttr('btnEnvoyerCommentaire',[lCommentaire.GetNumero()]),title:GTraductions.getValeur('blog.envoyer')}));}.bind(this)));return H.join('');}
composeCardCommentaire(aParam){const H=[];const lCommentaire=aParam.commentaire;const lEstAllume=aParam.styleOn===true;const lSansMargeTop=aParam&&(aParam.sansMargeTop===true);const lEstTypeDiffEcole=aParam.estTypeDiffEcole;if((lCommentaire!==null)&&(lCommentaire!==undefined)){const lInfosEtat=this.getInfosEtatCommentaire(lCommentaire);const lAvecAffichageEtat=lInfosEtat.afficherEtat&&(lInfosEtat.etat!==TypeEtatCommentaireBillet.ECB_Publie||(lCommentaire.estAdministrable&&!lCommentaire.estSupprimableDefinitif&&!lCommentaire.estSupprimableEtat));const lAvecModeration=lCommentaire.estAdministrable&&(lCommentaire.etatCommentaire!==TypeEtatCommentaireBillet.ECB_Supprime)&&!GApplication.droits.get(TypeDroits.estEnConsultation);const lEstGrise=(MethodesTableau.existe(lCommentaire.etatCommentaire,[TypeEtatCommentaireBillet.ECB_EnAttenteValidation,TypeEtatCommentaireBillet.ECB_Refuse]));H.push(tag('article',{class:'cardComment-conteneur '+(lEstAllume?'on':!lEstGrise?'accepte':'')+(lSansMargeTop===true?' sansMargeTop ':'')+(lCommentaire.estAModerer?' estAModerer':'')},function(aTabCommentaire){if(lAvecAffichageEtat||lAvecModeration){aTabCommentaire.push(tag('div',{class:'cardComment-header'},function(aTabHeader){if(lAvecAffichageEtat){aTabHeader.push(tag('i',{class:[lInfosEtat.iconEtat,lInfosEtat.class,'m-right-l']}));aTabHeader.push(tag('div',{class:'Italique'},lInfosEtat.str));if(lAvecModeration){aTabHeader.push(tag('ie-btnicon',{class:'avecFond icon_check_fin','ie-model':tag.funcAttr('btnAcceptCommentaire',[lCommentaire.GetNumero()]),title:GTraductions.getValeur('blog.accepterCommentaire')}));aTabHeader.push(tag('ie-btnicon',{class:'avecFond icon_fermeture_widget m-left-l','ie-model':tag.funcAttr('btnRejetCommentaire',[lCommentaire.GetNumero()]),title:GTraductions.getValeur('blog.refuserCommentaire')}));}}
if(lCommentaire.estSupprimableDefinitif||lCommentaire.estSupprimableEtat){aTabHeader.push(tag('ie-btnicon',{class:'avecFond icon_trash','ie-model':tag.funcAttr('btnSupprCommentaire',[lCommentaire.GetNumero()]),title:GTraductions.getValeur('blog.supprimerCommentaire')}));}}.bind(this)));}
aTabCommentaire.push(tag('section',{class:'cardComment-info'+(lEstGrise?' grise':'')},function(aTabZoneInfo){if(lCommentaire.auteur){aTabZoneInfo.push(tag('div',{class:'flex-contain'},this.composeHtmlPortrait({estGroupe:false,eltPortrait:lCommentaire.auteur,cssSize:' size-m ',cssTheme:lEstAllume?' color-cat ':' color-neutre '}),tag('div',tag('div',{class:'m-left m-right flex-contain','ie-ellipsis':false},this.getLibelleAuteur(lCommentaire.auteur),tag('div',{class:'m-left-l ie-sous-titre'},GDate.FormatDate(lCommentaire.date,'%JJJ %JJ %MMM - %hh%sh%mm'))),lCommentaire.auteur.classe&&lEstTypeDiffEcole?tag('div',{class:'m-left m-right','ie-ellipsis':false},lCommentaire.auteur.classe):'')));}}.bind(this)));aTabCommentaire.push(tag('footer',{class:'cardComment-content'+(lEstGrise?' grise':'')},lCommentaire.texte));}.bind(this)));}
return H.join('');}
composeCommentaire(aParam){const H=[];const lCommentaire=aParam.commentaire;const lFondGris=lCommentaire.estModeEditable===true?'background-color:'+GCouleur.themeNeutre.legere+';':'';const lId=(aParam.id!==null)&&(aParam.id!==undefined)?'id="'+aParam.id+'"':'';H.push('<div ',lId,' style="border:1px solid ',GCouleur.bordure,'; margin-top:15px; border-radius:7px; box-shadow: 0 2px 4px -3px #555555; ',lFondGris,'">');H.push('<div style="display:flex; margin:5px;">');H.push('<div style="align-self:center">',this.composeHtmlPortrait({cssSize:' size-l ',estGroupe:false,eltPortrait:lCommentaire.auteur}),'</div>');if(lCommentaire.estModeEditable!==true){H.push('<div style="margin:5px; width:100%;">');H.push(_composeLigneTitreCommentaire.call(this,lCommentaire));H.push('<div style="margin-left:5px;">',lCommentaire.texte,'</div>');H.push('</div>');} else{H.push('<ie-textareamax ',GHtml.composeAttr('ie-model','saisieCommentaireBlog',[lCommentaire.GetNumero()]),' maxlength="',aParam.tailleMaxCommentaires,'"',' class="Texte10 CelluleTexte FondBlanc" style="flex-basis:auto; width:100%; margin:5px; border:1px solid ',GCouleur.bordure,'; ',GStyle.composeHeight(60),'"></ie-textareamax>');}
H.push('</div>');H.push(_composeLignePiedCommentaire.call(this,lCommentaire));H.push('</div>');return H.join('');}
deserialiserListeCommentaires(aListeDonnees){const lListe=aListeDonnees;lListe.parcourir(function(aCommentaire){aCommentaire.estModeEditable=false;});lListe.setTri([
ObjetTri.init('date',EGenreTriElement.Decroissant)
]);lListe.trier();return lListe;}
composeCardsCommentairesBillet(aParam){const H=[];const lBillet=aParam.billet;let lEstPremier=true;if(this.existeCommentairesSurBillet(lBillet)){lBillet.listeCommentaires.parcourir(function(aCommentaire){if(aParam.ignorerCreation!==true||aCommentaire.Etat!==EGenreEtat.Creation){const lEstMien=this.estCommentaireDUser(aCommentaire,GEtatUtilisateur.getUtilisateur())||(this.allumerCommentairesDeMembres(GEtatUtilisateur.GenreEspace)&&this.estCommentaireDeMembreDUtilisateur(aCommentaire));H.push(this.composeCardCommentaire({commentaire:aCommentaire,tailleMaxCommentaires:aParam.tailleMaxCommentaires,sansMargeTop:lEstPremier,styleOn:lEstMien,estTypeDiffEcole:lBillet.estTypeDiffEcole}));lEstPremier=false;}}.bind(this));}
return H.join('');}
surActionRefuserCommentaire(aParam){_modifierEtatCommentaire.call(this,aParam,TypeEtatCommentaireBillet.ECB_Refuse);}
surActionAccepterCommentaire(aParam){_modifierEtatCommentaire.call(this,aParam,TypeEtatCommentaireBillet.ECB_Publie);}
surActionSupprimerCommentaire(aParam){const lNumCommentaire=aParam.numeroCommentaire;const lBillet=aParam.billet;const lCommentaire=lBillet.listeCommentaires.GetElementParNumero(lNumCommentaire);if(lCommentaire.estSupprimableDefinitif||lCommentaire.estSupprimableEtat){GApplication.getMessage().afficher({type:EGenreBoiteMessage.Confirmation,message:GTraductions.getValeur('blog.msgConfirmSuppr'),callback:function(aGenreBouton){if(aGenreBouton===EGenreAction.Valider){if(lCommentaire.estSupprimableDefinitif){lCommentaire.SetEtat(EGenreEtat.Suppression);aParam.evntClbck({billet:lBillet});} else if(lCommentaire.estSupprimableEtat){lCommentaire.etatCommentaire=TypeEtatCommentaireBillet.ECB_Supprime;lCommentaire.SetEtat(EGenreEtat.Modification);aParam.evntClbck({billet:lBillet});}}}.bind(this)});}}
getCouleursBlog(aGenreCouleur,aEstClaire){if(aEstClaire===true){switch(aGenreCouleur){case ObjetMoteurBlog.genreCouleur.nonPublie:return'#eed2e0';case ObjetMoteurBlog.genreCouleur.publie:return'#cce1d5';case ObjetMoteurBlog.genreCouleur.aModerer:return'#d1cde5';case ObjetMoteurBlog.genreCouleur.refuse:return'#C0392B';}} else{switch(aGenreCouleur){case ObjetMoteurBlog.genreCouleur.nonPublie:return'#C6397d';case ObjetMoteurBlog.genreCouleur.publie:return'#1e8348';case ObjetMoteurBlog.genreCouleur.aModerer:return'#341f97';case ObjetMoteurBlog.genreCouleur.refuse:return'#C0392B';}}}
choisirFichierCloud(aParams){const lParams=Object.assign({instance:null,element:null,numeroService:-1,listeDocumentsJoints:null},aParams);return new Promise(function(){ObjetFenetre.creerInstance(ObjetFenetre_FichiersCloud,{pere:lParams.instance,evenement:function(aAction,aParam){ObjetFenetre_FichiersCloud.eventFenetreFichierCloud(aAction,aParam,function(aNewElement){aParams.evntSelectFichierCloud.call(lParams.instance,{element:lParams.element,eltCloud:aNewElement,listeDocumentsJoints:lParams.listeDocumentsJoints});}.bind(this),function(){aParams.evntValidFichierCloud.call(lParams.instance,{listeDocumentsJoints:lParams.listeDocumentsJoints});}.bind(this));}}).SetDonnees({service:lParams.numeroService});});}
docCasierEstUneImage(aDocCasier){let lResult=false;const lGenreDocCasier=aDocCasier.GetGenre();if((lGenreDocCasier===EGenreDocumentJoint.Fichier)&&(EFormatDocJoint.getGenreDeFichier(GChaine.extraireExtensionFichier(aDocCasier.GetLibelle()))===EFormatDocJoint.Image)){lResult=true;}
return lResult;}
estEspaceAvecBlog(aGenreEspace){return MethodesTableau.existe(aGenreEspace,[EGenreEspace.PrimProfesseur,EGenreEspace.Mobile_PrimProfesseur,EGenreEspace.PrimParent,EGenreEspace.Mobile_PrimParent,EGenreEspace.PrimEleve,EGenreEspace.Mobile_PrimEleve,EGenreEspace.PrimAccompagnant,EGenreEspace.Mobile_PrimAccompagnant,EGenreEspace.Professeur,EGenreEspace.Mobile_Professeur,EGenreEspace.Parent,EGenreEspace.Mobile_Parent,EGenreEspace.Eleve,EGenreEspace.Mobile_Eleve,EGenreEspace.Accompagnant,EGenreEspace.Mobile_Accompagnant,EGenreEspace.Tuteur,EGenreEspace.Mobile_Tuteur
]);}
estProfNonReferent(aGenreEspace,aListeClasses){return MethodesTableau.existe(aGenreEspace,[EGenreEspace.PrimProfesseur,EGenreEspace.Mobile_PrimProfesseur,EGenreEspace.Professeur,EGenreEspace.Mobile_Professeur
])&&((aListeClasses===null)||(aListeClasses===undefined)||(aListeClasses.GetNbrElements()===0));}
avecGestionPublication(aGenreEspace){return MethodesTableau.existe(aGenreEspace,[EGenreEspace.PrimProfesseur,EGenreEspace.Mobile_PrimProfesseur
]);}
avecFiltreSelonMembre(aGenreEspace){return MethodesTableau.existe(aGenreEspace,[EGenreEspace.PrimParent,EGenreEspace.Mobile_PrimParent,EGenreEspace.Parent,EGenreEspace.Mobile_Parent,EGenreEspace.PrimAccompagnant,EGenreEspace.Mobile_PrimAccompagnant,EGenreEspace.Accompagnant,EGenreEspace.Mobile_Accompagnant,EGenreEspace.Tuteur,EGenreEspace.Mobile_Tuteur
]);}
allumerCommentairesDeMembres(aGenreEspace){return MethodesTableau.existe(aGenreEspace,[EGenreEspace.PrimParent,EGenreEspace.Mobile_PrimParent,EGenreEspace.Parent,EGenreEspace.Mobile_Parent,EGenreEspace.PrimAccompagnant,EGenreEspace.Mobile_PrimAccompagnant,EGenreEspace.Accompagnant,EGenreEspace.Mobile_Accompagnant,EGenreEspace.Tuteur,EGenreEspace.Mobile_Tuteur
]);}
avecFiltreLesMiens(aGenreEspace){return MethodesTableau.existe(aGenreEspace,[EGenreEspace.PrimProfesseur,EGenreEspace.Mobile_PrimProfesseur,EGenreEspace.PrimEleve,EGenreEspace.Mobile_PrimEleve,EGenreEspace.PrimParent,EGenreEspace.Mobile_PrimParent,EGenreEspace.Professeur,EGenreEspace.Mobile_Professeur,EGenreEspace.Eleve,EGenreEspace.Mobile_Eleve,EGenreEspace.Parent,EGenreEspace.Mobile_Parent
]);}
strFiltreLesMiens(aGenreEspace){switch(aGenreEspace){case EGenreEspace.Professeur:case EGenreEspace.Mobile_Professeur:case EGenreEspace.PrimProfesseur:case EGenreEspace.Mobile_PrimProfesseur:return GTraductions.getValeur('blog.uniquMaClasse');case EGenreEspace.Eleve:case EGenreEspace.Mobile_Eleve:case EGenreEspace.PrimEleve:case EGenreEspace.Mobile_PrimEleve:return GTraductions.getValeur('blog.uniquLesMiens');case EGenreEspace.Parent:case EGenreEspace.Mobile_Parent:case EGenreEspace.PrimParent:case EGenreEspace.Mobile_PrimParent:return GTraductions.getValeur('blog.uniquMesEnfants');default:return'';}}
estBilletVisibleSelonFiltreMien(aParam){const lBillet=aParam.billet;const lGenreEspace=aParam.genreEspace;switch(lGenreEspace){case EGenreEspace.Eleve:case EGenreEspace.Mobile_Eleve:case EGenreEspace.PrimEleve:case EGenreEspace.Mobile_PrimEleve:return this.estBilletDUtilisateurConnecte(lBillet);case EGenreEspace.Parent:case EGenreEspace.Mobile_Parent:case EGenreEspace.PrimParent:case EGenreEspace.Mobile_PrimParent:return this.estBilletDeMembreDUtilisateur(lBillet);case EGenreEspace.Professeur:case EGenreEspace.Mobile_Professeur:case EGenreEspace.PrimProfesseur:case EGenreEspace.Mobile_PrimProfesseur:return this.estBilletDUtilisateurConnecte(lBillet)||this.estBilletDeListeEleves(lBillet,this.getListeElevesDeClasses(aParam.listeClasses));}}
estBilletVisibleSelonFiltreModerer(aParam){const lBillet=aParam.billet;const lGenreEspace=aParam.genreEspace;switch(lGenreEspace){case EGenreEspace.Professeur:case EGenreEspace.Mobile_Professeur:case EGenreEspace.PrimProfesseur:case EGenreEspace.Mobile_PrimProfesseur:return lBillet.nbCommentairesAModerer>0||!lBillet.estPublie;}}
estBilletDeClasseDuMembre(aBillet){let lResult=false;const lMembre=GEtatUtilisateur.getMembre();const lClasseDeMembre=lMembre.Classe;const lNumeroClasseDeMembre=lClasseDeMembre.GetNumero();aBillet.listeClasses.parcourir(function(aClasse){if(lResult===false){lResult=(aClasse.GetNumero()===lNumeroClasseDeMembre);}}.bind(this));return lResult;}
strTitreCommentaires(aParam){const lNbComment=aParam.billet.listeCommentaires.GetNbrElements();return GTraductions.getValeur(lNbComment>1?'blog.commentaireN':'blog.commentaire1',[lNbComment]);}
getContenuBillet(aBillet){return aBillet.contenu?aBillet.contenu.replace(/<img src="/gi,'<img ie-load-src="'):aBillet.contenu;}
initMenuCtxDossierMediatheque(aParametres){aParametres.menuContextuel.add(GTraductions.getValeur('blog.renommer'),true,function(){ObjetFenetre.creerInstance(ObjetFenetre_EditionDossierMediatheque,{pere:this,evenement:function(aDossier){this.callback.appel({article:aDossier,genreEvenement:EGenreEvenementListe.ApresEdition});}.bind(this),initialiser:function(aInstance){aInstance.setOptionsFenetre({titre:GTraductions.getValeur('blog.editerCategorieMediatheque'),listeBoutons:[GTraductions.getValeur('Fermer'),{theme:TypeThemeBouton.primaire,libelle:GTraductions.getValeur('Modifier')}]});}}).SetDonnees(aParametres.article);},{icon:'icon_pencil'});aParametres.menuContextuel.add(GTraductions.getValeur('Supprimer'),(aParametres.article.nbDocs!==null)&&(aParametres.article.nbDocs!==undefined)&&(aParametres.article.nbDocs===0),function(){GApplication.getMessage().afficher({type:EGenreBoiteMessage.Confirmation,message:GTraductions.getValeur('blog.msgConfirmSupprCategorieMediatheque'),callback:function(aGenreAction){if(aGenreAction===EGenreAction.Valider){this.callback.appel({article:aParametres.article,genreEvenement:EGenreEvenementListe.Suppression});}}.bind(this)});},{icon:'icon_trash'});aParametres.menuContextuel.SetDonnees();}
avecGestionAppareilPhoto(){return IE.estMobile&&!(GNavigateur.isAndroid&&GApplication.estAppliMobile);}}
function _estUserDansListeEleves(aUser,aListeUsers){const lInd=aListeUsers.GetIndiceParNumeroEtGenre(aUser.GetNumero());return(lInd!==null)&&(lInd!==undefined);}
function _composeLigneTitreCommentaire(aCommentaire){const H=[];H.push('<div style="display:flex; justify-content:space-between;">');H.push('<div>',this.composeChipsAuteur({auteur:aCommentaire.auteur,avecSuppression:false}),'</div>');H.push('<div>',GDate.FormatDate(aCommentaire.date,'%JJJ %JJ %MMM'),' - ',GDate.FormatDate(aCommentaire.date,'%hh%sh%mm'),'</div>');H.push('</div>');return H.join('');}
function _composeEtatCommentaire(aCommentaire){const H=[];if(!aCommentaire.estModeEditable&&(aCommentaire.afficherEtat===true)){const lColor=_getCouleurEtatCommentaire.call(this,aCommentaire.etatCommentaire);H.push('<div class="Italique GrisTresFonce" style="display:flex; align-items:center; font-weight:500; color:',lColor,'">');const lIconEtat=TypeEtatCommentaireBillet.getIcon(aCommentaire.etatCommentaire);if(lIconEtat!==''){H.push('<i class="',lIconEtat,' EspaceDroit" style="font-size:18px;"></i>');}
H.push('<div class="Texte12">',TypeEtatCommentaireBillet.getStrEtat(aCommentaire.etatCommentaire),'</div>');H.push('</div>');}
return H.join('');}
function _getCouleurEtatCommentaire(aEtat){let lColor='#000000';if(aEtat!==null&&aEtat!==undefined){switch(aEtat){case TypeEtatCommentaireBillet.ECB_EnAttenteValidation:lColor=this.getCouleursBlog(ObjetMoteurBlog.genreCouleur.aModerer,false);break;case TypeEtatCommentaireBillet.ECB_Publie:lColor=this.getCouleursBlog(ObjetMoteurBlog.genreCouleur.publie,false);break;case TypeEtatCommentaireBillet.ECB_Refuse:lColor=this.getCouleursBlog(ObjetMoteurBlog.genreCouleur.refuse,false);break;}}
return lColor;}
function _composeHtmlBoutonCommentaire(aParam){const H=[];H.push('<ie-bouton style="margin-left:5px;"',GHtml.composeAttr('ie-model','btnCommentaireBlog',[aParam.typeAction,aParam.commentaire.GetNumero()]),GHtml.composeAttr('class',aParam.themeBtn),'>',aParam.libelle,'</ie-bouton>');return H.join('');}
function _composeHtmlBtnImage(aParam){const H=[];H.push('<ie-btnimage title="',aParam.title,'" style="margin-left:5px; align-self:flex-end; font-size:20px; color:',GCouleur.themeCouleur.foncee,';" class="btnImageIcon ',aParam.icone,'"',GHtml.composeAttr('ie-model','btnCommentaireBlog',[aParam.typeAction,aParam.commentaire.GetNumero()]),'>');H.push('</ie-btnimage>');return H.join('');}
function _composeBtnGenreAction(aGenreAction,aCommentaire){if(aGenreAction===EGenreActionBlog.supprimerCommentaire){return _composeHtmlBtnImage.call(this,{typeAction:aGenreAction,commentaire:aCommentaire,icone:'icon_trash',title:GTraductions.getValeur('Supprimer')});} else{return _composeHtmlBoutonCommentaire.call(this,{typeAction:aGenreAction,commentaire:aCommentaire,libelle:EGenreActionBlog.getLibelle(aGenreAction),themeBtn:((aGenreAction===EGenreActionBlog.accepterCommentaire)&&(aCommentaire.etatCommentaire!==TypeEtatCommentaireBillet.ECB_EnAttenteValidation))?TypeThemeBouton.secondaire:EGenreActionBlog.getTheme(aGenreAction)});}}
function _composeBoutonsActionCommentaire(aCommentaire){const H=[];if(aCommentaire.estModeEditable){H.push(_composeBtnGenreAction.call(this,EGenreActionBlog.annulerCreationCommentaire,aCommentaire));H.push(_composeBtnGenreAction.call(this,EGenreActionBlog.creerCommentaire,aCommentaire));} else{if(aCommentaire.estSupprimableDefinitif||aCommentaire.estSupprimableEtat){H.push(_composeBtnGenreAction.call(this,EGenreActionBlog.supprimerCommentaire,aCommentaire));} else if(aCommentaire.estAdministrable&&(aCommentaire.etatCommentaire!==TypeEtatCommentaireBillet.ECB_Supprime)){H.push(_composeBtnGenreAction.call(this,EGenreActionBlog.refuserCommentaire,aCommentaire));H.push(_composeBtnGenreAction.call(this,EGenreActionBlog.accepterCommentaire,aCommentaire));}}
return H.join('');}
function _composeLignePiedCommentaire(aCommentaire){const H=[];const lCouleurFond=aCommentaire.estAModerer?'background-color:'+GCouleur.themeNeutre.claire+';':'';H.push('<div style="display:flex; align-items:center; justify-content:space-between; width:calc(100% - 4px); margin:2px; margin-top:10px; border-radius:5px; ',lCouleurFond,'">');H.push('<div style="padding:5px;">',_composeEtatCommentaire.call(this,aCommentaire),'</div>');H.push('<div style="padding:5px;">',_composeBoutonsActionCommentaire.call(this,aCommentaire),'</div>');H.push('</div>');return H.join('');}
function _modifierEtatCommentaire(aParam,aEtatCommentaire){const lNumCommentaire=aParam.numeroCommentaire;const lBillet=aParam.billet;const lCommentaire=lBillet.listeCommentaires.GetElementParNumero(lNumCommentaire);lCommentaire.etatCommentaire=aEtatCommentaire;lCommentaire.SetEtat(EGenreEtat.Modification);aParam.evntClbck({billet:lBillet});}
ObjetMoteurBlog.genreCouleur={nonPublie:0,publie:1,aModerer:2,refuse:3};module.exports={ObjetMoteurBlog,EGenreActionBlog,EGenreEvntBillet};},fn:"objetmoteurblog.js"});;
IE.fModule({f:function(exports,require,module,global){const Identite=require('ObjetIdentite.js');const ObjetTri=require('ObjetTri.js');const EGenreTriElement=require('Enumere_TriElement.js');const{GDate}=require('ObjetDate.js');const ObjetMoteurBlog=require('ObjetMoteurBlog.js').ObjetMoteurBlog;const EGenreOnglet=require('Enumere_Onglet.js');const GTraductions=require('ObjetTraduction.js');const MethodesTableau=require('MethodesTableau.js');const EGenreEspace=require('Enumere_Espace.js');class WidgetBlog_FilActu extends Identite{constructor(...aParams){super(...aParams);this.moteur=new ObjetMoteurBlog();this.avecFiltreSelonMembre=this.moteur.avecFiltreSelonMembre(GEtatUtilisateur.GenreEspace);}
construire(aParams){this.donnees=aParams.donnees;const lDonneesFiltrees=this.donnees.listeBillets.getListeElements(function(aElt){return aElt.estPublie&&((this.avecFiltreSelonMembre===false)||aElt.estTypeDiffEcole||this.moteur.estBilletDeClasseDuMembre(aElt));}.bind(this));this.donneesFiltrees=lDonneesFiltrees;const lNbrElements=lDonneesFiltrees.GetNbrElements();lDonneesFiltrees.setTri([
ObjetTri.init(function(D){return D.dateAffichage;}.bind(this),EGenreTriElement.Decroissant),ObjetTri.init('dateCreation',EGenreTriElement.Decroissant)
]);lDonneesFiltrees.trier();const lWidget={html:this.composeWidgetBlogFilActu(lDonneesFiltrees),nbrElements:lNbrElements,liste:lDonneesFiltrees,afficherMessage:lNbrElements===0};$.extend(true,aParams.donnees,lWidget);aParams.construireWidget(this.donnees);}
composeWidgetBlogFilActu(aDonneesFiltrees){const H=[];if(aDonneesFiltrees.GetNbrElements()>0){H.push('<ul role="list" class="liste-clickable">');for(let i=0,lNbr=aDonneesFiltrees.GetNbrElements();i<lNbr;i++){let lElt=aDonneesFiltrees.GetElement(i);H.push('<li tabindex="0" role="link" onclick="'+this.Nom+'._surClickBillet('+i+')" onkeyup="if(GNavigateur.IsToucheSelection())'+this.Nom+'._surClickBillet('+i+')">');H.push(_composeLigneBillet.call(this,lElt));H.push('</li>');}
H.push('</ul>');}
return H.join('');}
_surClickBillet(i){const lBillet=this.donneesFiltrees.GetElement(i);const lPage={Onglet:EGenreOnglet.Blog_FilActu};GEtatUtilisateur.setBilletBlog(lBillet);if(GEtatUtilisateur.estEspaceMobile()){this.evenementPage({genreOngletDest:lPage.Onglet});} else{this.evenementPage(this.genreEvenement.selectionPage,lPage);}}}
function _composeLigneBillet(aBillet){const H=[];let lHint;H.push('<div class="wrap">');H.push('<h4>',aBillet.titre,'</h4>');H.push('<div class="infos-conteneur">');H.push('<span>');H.push(GDate.FormatDate(aBillet.dateAffichage,'%JJ/%MM/%AA'),' - ',aBillet.auteur.GetLibelle());if(this.moteur.estBilletAvecCoAuteurs(aBillet)){const lSeuilMaxCoAuteurs=2;if(aBillet.listeCoAuteurs.GetNbrElements()<=lSeuilMaxCoAuteurs){H.push(' '+GTraductions.getValeur('blog.billet.avecCoAuteur'));let lNbrCo=0;aBillet.listeCoAuteurs.parcourir(function(aCoAuteur){if(aCoAuteur.Existe()){lNbrCo++;if(lNbrCo>1){H.push(',');}
H.push(' ',this.moteur.getLibelleAuteur(aCoAuteur));}}.bind(this));} else{H.push('</span>');lHint=this.moteur.getHintCoAuteurs(aBillet.listeCoAuteurs);H.push('<span title="',lHint,'" class="as-offset">',GTraductions.getValeur('blog.billet.avecNbCoAuteurs',[aBillet.listeCoAuteurs.GetNbrElements()]));}}
H.push('</span>');H.push('</div>');H.push('</div>');H.push('<div class="conteneur-icones">');if(this.moteur.estBilletCommentable(aBillet)){const lNbComment=aBillet.nbCommentairesPublies;if(lNbComment>0){H.push('<i class="icon_comment with-label">');const lFontSize=lNbComment>9999?'is-xs':(lNbComment>999?'is-s':'');H.push('<span class="is-label ',lFontSize,'"> ',lNbComment,'</span>');H.push('</i>');}} else{if(MethodesTableau.existe(GEtatUtilisateur.GenreEspace,[EGenreEspace.PrimProfesseur,EGenreEspace.Mobile_PrimProfesseur])){H.push('<i class="icon_comment off with-label"></i>');}}
H.push('</div>');return H.join('');}
module.exports=WidgetBlog_FilActu;},fn:"espace/script/widget/widgetblog_filactu.js"});;
IE.fModule({f:function(exports,require,module,global){const TypeNote=require('TypeNote.js');const MethodesTableau=require('MethodesTableau.js');const GChaine=require('GChaine.js');require('NiveauAcquisition.css');const EGenreNiveauDAcquisition={Multiple:100,Utilisateur:0,Expert:1,Acquis:2,PresqueAcquis:3,EnCoursAcquisition:4,DebutAcquisition:5,NonAcquis:6,Absent:7,NonEvalue:8,Dispense:9,NonRendu:10};EGenreNiveauDAcquisition.getNombrePointsBrevet=function(aParams){return!!aParams.niveauDAcquisition&&!!aParams.niveauDAcquisition.nombrePointsBrevet?aParams.niveauDAcquisition.nombrePointsBrevet:new TypeNote('');};EGenreNiveauDAcquisition.getPonderation=function(aNiveauDAcquisition){return!!aNiveauDAcquisition?aNiveauDAcquisition.ponderation:new TypeNote('');};EGenreNiveauDAcquisition.estUneAnnotation=function(aNiveauAcquisition){return MethodesTableau.existe(aNiveauAcquisition.GetGenre(),[EGenreNiveauDAcquisition.Absent,EGenreNiveauDAcquisition.Dispense,EGenreNiveauDAcquisition.NonRendu]);};function getHtmlPastille(aParams){const H=[];const lClassesNiveauAcquisition=['NiveauAcquisition'];if(!!aParams.nomIcone){lClassesNiveauAcquisition.push('NiveauAcquisition_Annotation');} else{lClassesNiveauAcquisition.push('NiveauAcquisition_Pastille');}
if(aParams.estPastillePositionnement){lClassesNiveauAcquisition.push('NiveauAcquisition_Positionnement');}
const lAttributTitle=!!aParams.title?' title="'+aParams.title+'"':'';const lAriaLabel=aParams.libelleImage?` aria-label="${GChaine.toTitle(aParams.libelleImage)}"`:'';if(!!aParams.nomIcone){H.push('<span class="',lClassesNiveauAcquisition.join(' '),'"',(lAttributTitle||''),lAriaLabel,'>','<i class="',aParams.nomIcone,'"></i>','</span>');} else{let lContenu='&nbsp;';let lCouleurContenu='';if(!!aParams.contenu){lContenu=aParams.contenu.valeur;lCouleurContenu=aParams.contenu.couleur;}
let lCouleurPastille='white';if(!!aParams.couleurIcone){lCouleurPastille=aParams.couleurIcone;}
const lStyles=[];lStyles.push('background-color:',lCouleurPastille,';');if(!!lCouleurContenu){lStyles.push('color: ',lCouleurContenu,';');}
H.push('<span class="',lClassesNiveauAcquisition.join(' '),'" style="',lStyles.join(''),'"',(lAttributTitle||''),lAriaLabel,'>',lContenu,'</span>');}
return H.join('');}
function getNomIcone(aNiveauAcquisition){let lNomIcone;if(!!aNiveauAcquisition){switch(aNiveauAcquisition.GetGenre()){case(EGenreNiveauDAcquisition.Absent):return'icon_competence_absent';case(EGenreNiveauDAcquisition.Dispense):return'icon_competence_dispense';case(EGenreNiveauDAcquisition.NonRendu):return'icon_competence_non_rendu';default:return'';}}
return lNomIcone;}
function getCouleurIcone(aNiveauAcquisition){let lCouleurIcon;if(!!aNiveauAcquisition){if(EGenreNiveauDAcquisition.estUneAnnotation(aNiveauAcquisition)){lCouleurIcon='#009ee1';} else{lCouleurIcon=EGenreNiveauDAcquisition.getCouleur(aNiveauAcquisition);}}
return lCouleurIcon;}
EGenreNiveauDAcquisition.getImage=function(aNiveauAcquisition,aParams){const H=[];if(!!aNiveauAcquisition){const lLibelleNiveau=this.getLibelle(aNiveauAcquisition);const lValeurTitle=(!aParams||aParams.avecTitle||aParams.avecTitle===null||aParams.avecTitle===undefined?lLibelleNiveau:null);if(GParametres.afficherAbbreviationNiveauDAcquisition||GEtatUtilisateur.estAvecCodeCompetences()){H.push('<span',(lValeurTitle?' title="'+lValeurTitle+'"':''),(lLibelleNiveau?` aria-label="${GChaine.toTitle(lLibelleNiveau)}"`:''),'>',EGenreNiveauDAcquisition.getAbbreviation(aNiveauAcquisition,aParams),'</span>');} else if(aNiveauAcquisition.GetGenre()>=EGenreNiveauDAcquisition.Expert){const lCouleurIcon=getCouleurIcone(aNiveauAcquisition);let lContenuPastille;if(aNiveauAcquisition.GetGenre()===EGenreNiveauDAcquisition.Expert){lContenuPastille={valeur:'+',couleur:GCouleur.getCouleurCorrespondance(lCouleurIcon)};}
H.push(getHtmlPastille({title:lValeurTitle,libelleImage:lLibelleNiveau,nomIcone:getNomIcone(aNiveauAcquisition),couleurIcone:lCouleurIcon,contenu:lContenuPastille}));}}
return H.join('');};EGenreNiveauDAcquisition.getAbbreviation=function(aNiveauAcquisition,aParams){return!!aNiveauAcquisition&&(aNiveauAcquisition.existeNumero()||(!!aParams&&aParams.afficherValeurPourNonRempli))?(aNiveauAcquisition.abbreviation||''):'';};EGenreNiveauDAcquisition.getLibelle=function(aNiveauDAcquisition){return!!aNiveauDAcquisition?aNiveauDAcquisition.GetLibelle():'';};EGenreNiveauDAcquisition.getCouleur=function(aNiveauDAcquisition){return!!aNiveauDAcquisition?aNiveauDAcquisition.couleur:'white';};EGenreNiveauDAcquisition.ordre=function(){return[
this.Expert,this.Acquis,this.PresqueAcquis,this.EnCoursAcquisition,this.DebutAcquisition,this.NonAcquis,this.Absent,this.NonEvalue,this.Dispense,this.NonRendu,this.Utilisateur
];};EGenreNiveauDAcquisition.getImagePositionnement=function(aParams){const H=[];if(aParams.niveauDAcquisition){const lNiveauDAcquisition=aParams.niveauDAcquisition;const lLibelle=this.getLibellePositionnement(aParams);const lValeurTitle=(aParams.avecTitle||aParams.avecTitle===null||aParams.avecTitle===undefined?lLibelle:null);if(GParametres.afficherAbbreviationNiveauDAcquisition||GEtatUtilisateur.estAvecCodeCompetences()){H.push('<span',(lValeurTitle?' title="'+lValeurTitle+'"':''),(lLibelle?` aria-label="${GChaine.toTitle(lLibelle)}"`:''),'>',getAbbreviationPositionnement(lNiveauDAcquisition,aParams),'</span>');} else if(lNiveauDAcquisition.GetGenre()>=EGenreNiveauDAcquisition.Expert){const lCouleurIcone=getCouleurIcone(lNiveauDAcquisition);let lContenuPastille;if(lNiveauDAcquisition.GetGenre()===EGenreNiveauDAcquisition.Expert){lContenuPastille={valeur:4};} else if(lNiveauDAcquisition.GetGenre()===EGenreNiveauDAcquisition.Acquis){lContenuPastille={valeur:3};} else if(lNiveauDAcquisition.GetGenre()===EGenreNiveauDAcquisition.EnCoursAcquisition){lContenuPastille={valeur:2};} else if(lNiveauDAcquisition.GetGenre()===EGenreNiveauDAcquisition.NonAcquis){lContenuPastille={valeur:1};}
if(!!lContenuPastille){lContenuPastille.couleur=GCouleur.getCouleurCorrespondance(lCouleurIcone);}
H.push(getHtmlPastille({estPastillePositionnement:true,title:lValeurTitle,libelleImage:lLibelle,nomIcone:getNomIcone(lNiveauDAcquisition),couleurIcone:lCouleurIcone,contenu:lContenuPastille}));}}
return H.join('');};EGenreNiveauDAcquisition.getLibellePositionnement=function(aParams){const lPositionnement=!!aParams.niveauDAcquisition.listePositionnements.GetNbrElements()?aParams.niveauDAcquisition.listePositionnements.GetElementParGenre(aParams.genrePositionnement):null;return(!!lPositionnement&&(lPositionnement.GetLibelle()||!!aParams.avecPositionnementVide)?lPositionnement.GetLibelle():aParams.niveauDAcquisition.GetLibelle());};function getAbbreviationPositionnement(aNiveauAcquisition,aParams){const lPositionnement=aNiveauAcquisition.listePositionnements?aNiveauAcquisition.listePositionnements.GetElementParGenre(aParams.genrePositionnement):null;let result='';if((!!lPositionnement&&lPositionnement.abbreviation)||aParams.avecPositionnementVide){result=(aParams.avecPrefixe?lPositionnement.abbreviationAvecPrefixe:lPositionnement.abbreviation);} else{result=EGenreNiveauDAcquisition.getAbbreviation(aNiveauAcquisition,aParams);}
return result;}
module.exports=EGenreNiveauDAcquisition;},fn:"enumere_niveaudacquisition.js"});;
IE.fModule({f:function(exports,require,module,global){const TypeFichierExterneHttpSco={Aucun:'Aucun',EvaluationSujet:'EvaluationSujet',EvaluationCorrige:'EvaluationCorrige',DevoirSujet:'DevoirSujet',DevoirCorrige:'DevoirCorrige',TAFRenduEleve:'TAFRenduEleve',TAFCorrigeRenduEleve:'TAFCorrigeRenduEleve',EtablissementReglement:'EtablissementReglement',EtablissementCharte:'EtablissementCharte',DocJointInscription:'DocJointInscription'};module.exports.TypeFichierExterneHttpSco=TypeFichierExterneHttpSco;},fn:"typefichierexternehttpsco.js"});;
IE.fModule({f:function(exports,require,module,global){const Identite=require('ObjetIdentite.js');const EGenreTriElement=require('Enumere_TriElement.js');const GChaine=require('GChaine.js');const{GDate}=require('ObjetDate.js');const GTraductions=require('ObjetTraduction.js');const ObjetTri=require('ObjetTri.js');const EGenreNiveauDAcquisition=require('Enumere_NiveauDAcquisition.js');const EGenreRessource=require('Enumere_Ressource.js');const EGenreDocumentJoint=require('Enumere_DocumentJoint.js');const ObjetElement=require('ObjetElement.js');const TypeFichierExterneHttpSco=require('TypeFichierExterneHttpSco.js').TypeFichierExterneHttpSco;class WidgetCompetences extends Identite{creerObjetstCompetences(){}
initialiserObjetsCompetences(){}
construire(aParams){this.donnees=aParams.donnees;this.creerObjetstCompetences();this.ordre=EGenreNiveauDAcquisition.ordre();this.donnees.listeEvaluations.setTri([ObjetTri.init('date',EGenreTriElement.Decroissant),ObjetTri.init('matiere.Libelle')]);this.donnees.listeEvaluations.trier();const H=[];H.push('<ul role="listitem" class="liste-clickable">');for(let i=0;i<this.donnees.listeEvaluations.GetNbrElements();i++){const lEvaluation=this.donnees.listeEvaluations.GetElement(i);H.push(this.composeEvaluation(lEvaluation,i));}
H.push('</ul>');const lWidget={html:H.join(''),nbrElements:this.donnees.listeEvaluations.GetNbrElements(),afficherMessage:this.donnees.listeEvaluations.GetNbrElements()===0,getPage:function(){if(this.donnees.listeEvaluations.GetNbrElements()){this.donnees.page.periode=this.donnees.listeEvaluations.GetPremierElement().periode;}
return this.donnees.page;}.bind(this)};$.extend(true,this.donnees,lWidget);aParams.construireWidget(this.donnees);this.initialiserObjetsCompetences();}
composeEvaluation(aEvaluation,aIndex){const H=[];aEvaluation.listeNiveauxDAcquisitions.setTri([ObjetTri.init('ordre')]);aEvaluation.listeNiveauxDAcquisitions.trier();const lStrDate=[];if(aEvaluation.date){lStrDate.push(GDate.FormatDate(aEvaluation.date,'['+GTraductions.getValeur('Le')+' '+'%J %MMM'+']'));}
if(GEtatUtilisateur.pourPrimaire()&&aEvaluation.coefficient===0){if(lStrDate.length>0){lStrDate.push(' ');}
lStrDate.push('(',GTraductions.getValeur('evaluations.NonComptabiliseDansBilan'),')');}
H.push('<li role="link" tabIndex="0" onclick="'+this.Nom+'._surDernieresEvaluationClick(event, '+aIndex+')" onkeyup="if(GNavigateur.IsToucheSelection())'+this.Nom+'._surDernieresEvaluationClick (event, '+aIndex+')">','<div class="wrap">','<h4><span>',aEvaluation.matiere.GetLibelle(),'</span></h4>','<div class="infos-conteneur">','<span class="date">',lStrDate.join(''),'</span>');const lArrayLiensSujetCorrige=[];if(!!aEvaluation.libelleSujet){const lDocumentJointSujet=new ObjetElement(aEvaluation.libelleSujet,aEvaluation.GetNumero(),EGenreDocumentJoint.Fichier);lArrayLiensSujetCorrige.push(GChaine.composerUrlLienExterne({documentJoint:lDocumentJointSujet,genreRessource:TypeFichierExterneHttpSco.EvaluationSujet,libelleEcran:GTraductions.getValeur('AfficherSujet')}));}
if(!!aEvaluation.libelleCorrige){const lDocumentJointCorrige=new ObjetElement(aEvaluation.libelleCorrige,aEvaluation.GetNumero(),EGenreDocumentJoint.Fichier);lArrayLiensSujetCorrige.push(GChaine.composerUrlLienExterne({documentJoint:lDocumentJointCorrige,genreRessource:TypeFichierExterneHttpSco.EvaluationCorrige,libelleEcran:GTraductions.getValeur('AfficherCorrige')}));}
if(lArrayLiensSujetCorrige.length>0){H.push(`<div class="flex-contain flex-center full-width flex-gap-l m-top">${lArrayLiensSujetCorrige.join(' ')} </div>`);}
H.push('</div>','</div>');H.push('<div class="evaluations-conteneur">');aEvaluation.listeNiveauxDAcquisitions.parcourir(function(D){let lHintNiveauDAcquisition='';if(!!D.item){lHintNiveauDAcquisition=D.item.GetLibelle();} else if(!!D.domaine){lHintNiveauDAcquisition=D.domaine.GetLibelle();}
const lNiveauDAcquisitionGlobal=GParametres.listeNiveauxDAcquisitions.GetElementParNumero(D.GetNumero());const lImage=EGenreNiveauDAcquisition.getImage(lNiveauDAcquisitionGlobal,{avecTitle:false});H.push('<span',(!!lHintNiveauDAcquisition?' title="'+GChaine.toTitle(lHintNiveauDAcquisition)+'"':''),'>',lImage,'</span>');});H.push('</div>');H.push('</li>');return H.join('');}
surCorrige(i){const lEvaluation=this.donnees.listeEvaluations.GetElement(i);if(!!lEvaluation){this.afficherExecutionQCM(lEvaluation.executionQCM);}}
_surDernieresEvaluationClick(aEvent,i){if($(aEvent.target).parentsUntil(aEvent.currentTarget).addBack().filter('a').length===0){const lEvaluation=this.donnees.listeEvaluations.GetElement(i);GEtatUtilisateur.Navigation.SetRessource(EGenreRessource.Evaluation,lEvaluation);if(!!this.donnees.page){this.donnees.page.periode=lEvaluation.periode;}
if(GEtatUtilisateur.estEspaceMobile()){this.evenementPage({genreOngletDest:this.donnees.page.Onglet,page:this.donnees.page});} else{this.evenementPage(this.genreEvenement.selectionPage,this.donnees.page);}}}}
module.exports=WidgetCompetences;},fn:"espace/script/widget/widgetcompetences.js"});;
IE.fModule({f:function(exports,require,module,global){const EGenreAffichageCahierDeTextes={TravailAFaire:0,ContenuDeCours:1,QCM:2,CahierDeTextes:3};module.exports=EGenreAffichageCahierDeTextes;},fn:"enumere_affichagecahierdetextes.js"});;
IE.fModule({f:function(exports,require,module,global){const TypeModeCorrectionQCM={FBQ_CorrigeSans:0,FBQ_CorrigeApresQuestion:1,FBQ_CorrigeALaFin:2};module.exports.TypeModeCorrectionQCM=TypeModeCorrectionQCM;},fn:"typemodecorrectionqcm.js"});;
IE.fModule({f:function(exports,require,module,global){const MethodesObjet=require('MethodesObjet.js');const MethodesTableau=require('MethodesTableau.js');const ObjetElement=require('ObjetElement.js');const ObjetListeElements=require('ObjetListeElements.js');const GTraductions=require('ObjetTraduction.js');const ObjetTri=require('ObjetTri.js');const TypeGenreRenduTAF={GRTAF_AucunRendu:0,GRTAF_RenduPapier:1,GRTAF_RenduPronote:2,GRTAF_RenduKiosque:3,GRTAF_RenduPronoteEnregistrementAudio:4};module.exports.TypeGenreRenduTAF=TypeGenreRenduTAF;TypeGenreRenduTAF.estGenreValable=function(aGenre){let lResult=true;if(GParametres&&GParametres.general&&GParametres.general.genresRenduTAFValable){lResult=GParametres.general.genresRenduTAFValable.contains(aGenre);}
return lResult;};TypeGenreRenduTAF.getDureeMaxEnregistrementAudio=function(){let lTailleMax=30;if(GParametres&&GParametres.general&&GParametres.general.tailleMaxEnregistrementAudioRenduTAF){lTailleMax=GParametres.general.tailleMaxEnregistrementAudioRenduTAF*60;}
return lTailleMax;};TypeGenreRenduTAF.getLibelle=function(aGenre){switch(aGenre){case this.GRTAF_AucunRendu:return GTraductions.getValeur('CahierDeTexte.TAFARendre.AucunRenduPrevu');case this.GRTAF_RenduPapier:return GTraductions.getValeur('CahierDeTexte.TAFARendre.ARemettre');case this.GRTAF_RenduPronote:return GTraductions.getValeur('CahierDeTexte.TAFARendre.ADeposer');case this.GRTAF_RenduKiosque:return GTraductions.getValeur('CahierDeTexte.TAFARendre.ACompleterEditeur');case this.GRTAF_RenduPronoteEnregistrementAudio:return GTraductions.getValeur('CahierDeTexte.TAFARendre.EnregistrementADeposer');default:;return'';}};TypeGenreRenduTAF.getOrdre=function(aGenre){return[0,1,2,3,4][aGenre];};TypeGenreRenduTAF.toElement=function(aGenre){const lElement=new ObjetElement(TypeGenreRenduTAF.getLibelle(aGenre),0,aGenre);lElement.ordre=TypeGenreRenduTAF.getOrdre(aGenre);return lElement;};TypeGenreRenduTAF.fromElement=function(aElt){return(aElt!==null)&&(aElt!==undefined)?aElt.GetGenre():TypeGenreRenduTAF.GRTAF_AucunRendu;};TypeGenreRenduTAF.toListe=function(aGenresAExclure){const lListe=new ObjetListeElements();for(const iRendu in TypeGenreRenduTAF){const lRendu=TypeGenreRenduTAF[iRendu];if(MethodesObjet.isNumber(lRendu)&&TypeGenreRenduTAF.estGenreValable(lRendu)&&(!aGenresAExclure||!MethodesTableau.existe(lRendu,aGenresAExclure))){let lElement=TypeGenreRenduTAF.toElement(lRendu);lListe.AddElement(lElement);}}
lListe.setTri([ObjetTri.init('ordre')]);lListe.trier();return lListe;};TypeGenreRenduTAF.estUnRenduEnligne=function(aGenre,aInclureKiosque){if((aGenre===undefined)||(aGenre===null)){return false;}
const lArrTypes=[this.GRTAF_RenduPronote,this.GRTAF_RenduPronoteEnregistrementAudio];if(aInclureKiosque!==false){lArrTypes.push(this.GRTAF_RenduKiosque);}
return MethodesTableau.existe(aGenre,lArrTypes);};TypeGenreRenduTAF.estUnRenduPapier=function(aGenre){if((aGenre===undefined)||(aGenre===null)){return false;}
return MethodesTableau.existe(aGenre,[this.GRTAF_RenduPapier]);};TypeGenreRenduTAF.estSansRendu=function(aGenre){if((aGenre===undefined)||(aGenre===null)){return true;}
return MethodesTableau.existe(aGenre,[this.GRTAF_AucunRendu]);};TypeGenreRenduTAF.estUnRenduKiosque=function(aGenre){if((aGenre===undefined)||(aGenre===null)){return false;}
return MethodesTableau.existe(aGenre,[this.GRTAF_RenduKiosque]);};TypeGenreRenduTAF.estUnRenduMedia=function(aGenre){if((aGenre===undefined)||(aGenre===null)){return false;}
return MethodesTableau.existe(aGenre,[this.GRTAF_RenduPronoteEnregistrementAudio]);};TypeGenreRenduTAF.getLibelleConsultation=function(aGenre,aPourEleve){switch(aGenre){case this.GRTAF_AucunRendu:return'';case this.GRTAF_RenduPapier:return'';case this.GRTAF_RenduPronote:return GTraductions.getValeur('CahierDeTexte.TAFARendre.Eleve.CopieDeposee');case this.GRTAF_RenduKiosque:return aPourEleve?GTraductions.getValeur('CahierDeTexte.TAFARendre.Eleve.ConsulterMesReponses'):GTraductions.getValeur('CahierDeTexte.TAFARendre.Eleve.ConsulterLesReponses');case this.GRTAF_RenduPronoteEnregistrementAudio:return GTraductions.getValeur('CahierDeTexte.TAFARendre.Eleve.CopieDeposee');default:return'';}};TypeGenreRenduTAF.getLibelleDeposer=function(aGenre,aPourEleve){switch(aGenre){case this.GRTAF_AucunRendu:return'';case this.GRTAF_RenduPapier:return GTraductions.getValeur('CahierDeTexte.TAFARendre.Eleve.RenduPapier');case this.GRTAF_RenduPronote:return aPourEleve?GTraductions.getValeur('CahierDeTexte.TAFARendre.Eleve.RenduPronote'):GTraductions.getValeur('CahierDeTexte.TAFARendre.Eleve.RenduNumerique');case this.GRTAF_RenduKiosque:return aPourEleve?GTraductions.getValeur('CahierDeTexte.TAFARendre.ACompleterEditeurSite'):GTraductions.getValeur('CahierDeTexte.TAFARendre.ACompleterEditeur');case this.GRTAF_RenduPronoteEnregistrementAudio:return aPourEleve?GTraductions.getValeur('CahierDeTexte.TAFARendre.Eleve.RendreEnregistrement'):GTraductions.getValeur('CahierDeTexte.TAFARendre.Eleve.RenduNumerique');default:return'';}};},fn:"typegenrerendutaf.js"});;
IE.fModule({f:function(exports,require,module,global){const TypeHttpMarqueurContenuCours={hmcc_ReservePar:0,hmcc_LibelleHoraire:1,hmcc_TitreCDT:2,hmcc_Remplacant:3,hmcc_PeriodeAnnuel:4,hmcc_PartiesCours:5,hmcc_ElevesAccompagnes:6};module.exports.TypeHttpMarqueurContenuCours=TypeHttpMarqueurContenuCours;},fn:"typehttpmarqueurcontenucours.js"});;
IE.fModule({f:function(exports,require,module,global){const GLog=require('IELog.js');const MethodesObjet=require('MethodesObjet.js');const MethodesTableau=require('MethodesTableau.js');const GChaine=require('GChaine.js');const EGenreDocumentJoint=require('Enumere_DocumentJoint.js');const EGenreEtat=require('Enumere_Etat.js');const EGenreTriElement=require('Enumere_TriElement.js');const{GDate}=require('ObjetDate.js');const ObjetElement=require('ObjetElement.js');const ObjetListeElements=require('ObjetListeElements.js');const GTraductions=require('ObjetTraduction.js');const ObjetTri=require('ObjetTri.js');const TypeEtatExecutionQCMPourRepondant=require('TypeEtatExecutionQCMPourRepondant.js').TypeEtatExecutionQCMPourRepondant;const TypeModeCorrectionQCM=require('TypeModeCorrectionQCM.js').TypeModeCorrectionQCM;const EGenreEspace=require('Enumere_Espace.js');const EGenreRessource=require('Enumere_Ressource.js');const TypeGenrePunition=require('TypeGenrePunition.js').TypeGenrePunition;const TypeGenreRenduTAF=require('TypeGenreRenduTAF.js').TypeGenreRenduTAF;const TypeHttpMarqueurContenuCours=require('TypeHttpMarqueurContenuCours.js').TypeHttpMarqueurContenuCours;class ObjetDeserialiser{constructor(){}
listeEvenementsVS(aListe,aPourAccueil){this.pourAccueil=aPourAccueil;aListe.parcourir(_enrichirEvenementVS.bind(this,aListe));aListe.setTri([ObjetTri.init('aRegulariser',EGenreTriElement.Decroissant),ObjetTri.init(function(D){return D.dateDebut?D.dateDebut:D.dateDemande;},EGenreTriElement.Decroissant)]);aListe.trier();return aListe;}
_formaterEvenementVS(aParam){aParam.element.avecSaisie=aParam.element.avecSaisie?true:false;if(aParam.element.date){aParam.element.dateDebut=aParam.element.date;aParam.element.dateFin=aParam.element.date;}
if(!aParam.element.dateFin){aParam.element.dateFin=aParam.element.dateDebut;}
aParam.element.estDemiJournee=aParam.element.estMatin?true:false;if(aParam.element.GetGenre()===EGenreRessource.Punition&&((aParam.element.nature.GetGenre()===TypeGenrePunition.GP_ExclusionCours)||!aParam.pourAccueil)){aParam.element.dateDebut=aParam.element.dateDemande;aParam.element.dateFin=aParam.element.dateDemande;aParam.element.place=aParam.element.placeDemande;if(!aParam.pourAccueil&&aParam.liste){for(let I=0;aParam.element.programmation&&(I<aParam.element.programmation.GetNbrElements());I++){const lNewElement=MethodesObjet.dupliquer(aParam.element);const lProg=aParam.element.programmation.GetElement(I);lNewElement.dateDebut=lProg.date;lNewElement.dateFin=lProg.date;lNewElement.estProgrammation=true;if((lProg.place!==null&&lProg.place!==undefined)){lNewElement.place=lProg.place;}
if(lProg.duree){lNewElement.duree=lProg.duree;} else{lNewElement.duree=aParam.element.duree;}
lNewElement.Position=EGenreRessource.getPositionAbsence({genre:lNewElement.GetGenre(),genreObservation:lNewElement.genreObservation,genreNature:lNewElement.nature.GetGenre()});aParam.liste.AddElement(lNewElement);}}}
if(aParam.element.programmation){aParam.element.programmation.setTri([ObjetTri.init('date')]);aParam.element.programmation.trier();}
const lObjet={genre:aParam.element.GetGenre(),estLue:aParam.element.estLue};if((aParam.element.nature!==null&&aParam.element.nature!==undefined)){lObjet.genreNature=aParam.element.nature.GetGenre();}
if(aParam.element.GetGenre()===EGenreRessource.ObservationProfesseurEleve){lObjet.genreObservation=aParam.element.genreObservation;}
aParam.element.Position=EGenreRessource.getPositionAbsence(lObjet);aParam.element.aRegulariser=this._evenementVSARegulariser(aParam.element);}
_evenementVSARegulariser(aElement){switch(aElement.GetGenre()){case(EGenreRessource.Absence):case(EGenreRessource.Retard):return aElement.avecSaisie&&!aElement.motifParent;case(EGenreRessource.ObservationProfesseurEleve):return!aElement.estLue;case(EGenreRessource.Punition):return aElement.nature&&aElement.nature.estAvecARParent&&!aElement.parentAAccuseDeReception?true:false;default:return false;}}
listeCours(aJSON){const lListe=new ObjetListeElements().fromJSON(aJSON.ListeCours,this._ajouterCours.bind(this));lListe.setTri([ObjetTri.init('DateDuCours')]);lListe.trier();return lListe;}
_ajouterCours(aJSON,aElement){aElement.copieJSON(aJSON);aElement.Debut=aElement.place;aElement.Fin=aElement.place+aElement.duree-1;aElement.AppelFait=(aElement.NomImageAppelFait==='AppelFait')||(aElement.NomImageAppelFait==='AppelVerrouFait');aElement.estAppelVerrouille=(aElement.NomImageAppelFait==='AppelVerrouNonFait')||(aElement.NomImageAppelFait==='AppelVerrouFait');if(aJSON.estSortiePedagogique){aElement.couleurFondHorsBordure='#FFFFFF';aElement.ListeContenus=new ObjetListeElements();let lElement=Object.assign(new ObjetElement(GTraductions.getValeur('EDT.AbsRess.SortiePedagogique')),{marqueur:'titreSortie',estLibelleTitreSortie:true});aElement.ListeContenus.AddElement(lElement);lElement=Object.assign(new ObjetElement(aElement.strDateDebut),{marqueur:'titreSortie'});aElement.ListeContenus.AddElement(lElement);if(aElement.strDateFin){lElement=Object.assign(new ObjetElement(aElement.strDateFin),{marqueur:'titreSortie'});aElement.ListeContenus.AddElement(lElement);}
const lMotif=new ObjetElement(aElement.motif,0,EGenreRessource.Matiere);aElement.matiere=lMotif;aElement.ListeContenus.AddElement(lMotif);if(aElement.pourAcc&&aElement.strRess){aElement.ListeContenus.AddElement(new ObjetElement(aElement.strRess,0,EGenreRessource.Classe));}
if(aElement.accompagnateurs&&aElement.accompagnateurs.forEach){aElement.accompagnateurs.forEach(function(aStr){aElement.ListeContenus.AddElement(new ObjetElement(aStr,0,EGenreRessource.Enseignant));});}
if(aElement.forcerAppelVerrou){aElement.estAppelVerrouille=true;}} else if(aJSON.estRetenue){aElement.CouleurFond='#FF0000';aElement.couleurFondHorsBordure='#FFFFFF';} else{aElement.estAnnule=!!aJSON.estAnnule;aElement.estPermanence=!!aJSON.estPermanence;aElement.AvecCdT=aElement.cahierDeTextes&&aElement.cahierDeTextes.existeNumero();aElement.utilisable=aJSON.utilisable===false?false:true;aElement.utilisableCDT=aJSON.utilisableCDT===false?false:true;aElement.utilisableAppel=aJSON.utilisableAppel===false?false:true;aElement.modifiable=!!aJSON.modifiable;aElement.ressourcesModifiables=!!aJSON.ressourcesModifiables;aElement.verrouDeplacement=!!aJSON.verrouDeplacement;aElement.cdtAffecte=aJSON.CahierDeTextes&&aJSON.CahierDeTextes.Affecte;aElement.avecTafPublie=aJSON.AvecTafPublie;aElement.avecChargeTAF=!!aJSON.AvecChargeTAF;aElement.estGAEV=!!aJSON.estGAEV;aElement.estCoEnseignement=!!aJSON.estCoEnseignement;aElement.ListeContenus.parcourir(function(aContenu){if(aContenu.GetGenre()===EGenreRessource.Matiere){aElement.matiere=aContenu;}
if(aContenu.GetGenre()===EGenreRessource.Materiel||aContenu.GetGenre()===EGenreRessource.Salle){aContenu.nombre=aContenu.nombre||1;}});aElement.ListeContenus.setTri([
ObjetTri.init(function(D){switch(D.GetGenre()){case EGenreRessource.Matiere:return-1;case EGenreRessource.LibelleCours:return-0.4;case EGenreRessource.Enseignant:return 0;case EGenreRessource.Groupe:return 1;case EGenreRessource.Classe:return 2;case EGenreRessource.PartieDeClasse:return 3;case EGenreRessource.Salle:return 4;case EGenreRessource.Site:return 5;case EGenreRessource.Personnel:return 6;case EGenreRessource.Materiel:return 7;case EGenreRessource.Service:return 8;}
switch(D.marqueur){case TypeHttpMarqueurContenuCours.hmcc_ReservePar:return-0.6;case TypeHttpMarqueurContenuCours.hmcc_LibelleHoraire:return 99999;case TypeHttpMarqueurContenuCours.hmcc_TitreCDT:return-0.5;case TypeHttpMarqueurContenuCours.hmcc_ElevesAccompagnes:return-0.3;case TypeHttpMarqueurContenuCours.hmcc_Remplacant:return 4.5;case TypeHttpMarqueurContenuCours.hmcc_PeriodeAnnuel:return-9999;case TypeHttpMarqueurContenuCours.hmcc_PartiesCours:return-10;}
;return 1000;}),ObjetTri.init('Libelle')
]);aElement.ListeContenus.trier();if(aElement.matiere){aElement.matiere.CouleurFond=aElement.CouleurFond;}}
if(aElement.DateDuCours){aElement.numeroSemaine=IE.Cycles.cycleDeLaDate(aElement.DateDuCours);}}
_ajouterQCM(aJSON,aElement){aElement.copieJSON(aJSON);if(aElement.GetGenre()===EGenreRessource.ExecutionQCM){aElement.QCM=new ObjetElement().fromJSON(aJSON.QCM);aElement.QCM.copieJSON(aJSON.QCM);const lEspaceQCMConsult=MethodesTableau.existe(GEtatUtilisateur.GenreEspace,[EGenreEspace.Parent,EGenreEspace.PrimParent,EGenreEspace.Mobile_Parent,EGenreEspace.Mobile_PrimParent,EGenreEspace.Accompagnant,EGenreEspace.PrimAccompagnant,EGenreEspace.Mobile_Accompagnant,EGenreEspace.Mobile_PrimAccompagnant,EGenreEspace.Tuteur,EGenreEspace.Mobile_Tuteur,EGenreEspace.Entreprise]);if(lEspaceQCMConsult&&(aElement.etatCloture===undefined||aElement.etatCloture===TypeEtatExecutionQCMPourRepondant.EQR_EnCours)){aElement.modeDiffusionCorrige=TypeModeCorrectionQCM.FBQ_CorrigeSans;GLog.addLog('modification modeDiffusionCorrige');}} else{aElement.niveau=new ObjetElement().fromJSON(aJSON.niveau);aElement.proprietaire=new ObjetElement().fromJSON(aJSON.proprietaire);}
if(!aElement.matiere||!MethodesObjet.isFunction(aElement.matiere.existeNumero)){aElement.matiere=new ObjetElement().fromJSON(aJSON.matiere);}}
getListeEvenements(aJSON,aCroissant){const lListeEvenements=new ObjetListeElements().fromJSON(aJSON,_ajouterEvenement);lListeEvenements.setTri([
ObjetTri.init(function(D){return D.sansHoraire?new Date(D.DateDebut.getFullYear(),D.DateDebut.getMonth(),D.DateDebut.getDate()):D.DateDebut;},aCroissant?EGenreTriElement.Croissant:EGenreTriElement.Decroissant),ObjetTri.init(function(D){return D.sansHoraire?new Date(D.DateFin.getFullYear(),D.DateFin.getMonth(),D.DateFin.getDate()):D.DateFin;},aCroissant?EGenreTriElement.Croissant:EGenreTriElement.Decroissant),ObjetTri.init('Libelle')
]);lListeEvenements.trier();lListeEvenements._getLibelleEvenement=_getLibelleEvenement;lListeEvenements._getDateEvenement=_getDateEvenement;return lListeEvenements;}
deserialiserTAF(aTAF){if(aTAF.avecMiseEnForme===undefined||aTAF.avecMiseEnForme===null){aTAF.avecMiseEnForme=true;}
aTAF.descriptif=GChaine.nettoyerCommentaire(aTAF.descriptif);aTAF.estVide=false;if(!aTAF.genreRendu){aTAF.genreRendu=TypeGenreRenduTAF.GRTAF_AucunRendu;}
if(!aTAF.ListePieceJointe){aTAF.ListePieceJointe=new ObjetListeElements();}
aTAF.ListePieceJointe.parcourir(function(aPieceJointeDeTAF){aPieceJointeDeTAF.Url=GChaine.creerUrlBruteLienExterne(aPieceJointeDeTAF);});if(!!aTAF.executionQCM){const lExecutionQCMaRemplir=new ObjetElement();new ObjetDeserialiser()._ajouterQCM(aTAF.executionQCM,lExecutionQCMaRemplir);aTAF.executionQCM=lExecutionQCMaRemplir;}}
deserialiserContenuDeCours(aContenuCours){aContenuCours.descriptif=GChaine.nettoyerCommentaire(aContenuCours.descriptif);aContenuCours.objectifs=GChaine.nettoyerCommentaire(aContenuCours.objectifs||'');if(!aContenuCours.categorie){aContenuCours.categorie=new ObjetElement('',0);}
aContenuCours.estVide=false;if(!aContenuCours.ListePieceJointe){aContenuCours.ListePieceJointe=new ObjetListeElements();}
aContenuCours.ListePieceJointe.parcourir(function(aPieceJointeDeContenuDeCours){aPieceJointeDeContenuDeCours.Url=GChaine.creerUrlBruteLienExterne(aPieceJointeDeContenuDeCours);});aContenuCours.ListePieceJointe.setTri([
ObjetTri.init(function(D){return D.GetGenre()!==EGenreDocumentJoint.Fichier;}),ObjetTri.init('Libelle'),ObjetTri.init('Numero')
]).trier();aContenuCours.listeExecutionQCM=new ObjetListeElements();if(!!aContenuCours.training){const lDeserialiser=new ObjetDeserialiser();aContenuCours.listeExecutionQCM=new ObjetListeElements().fromJSON(aContenuCours.training.ListeExecutionsQCM,lDeserialiser._ajouterQCM.bind(lDeserialiser));}}
deserialiserCahierDeTexte(aCahierDeTexte){const lThis=this;if(!aCahierDeTexte.listeContenus){aCahierDeTexte.listeContenus=new ObjetListeElements();}
aCahierDeTexte.listeContenus.parcourir(function(aContenu){lThis.deserialiserContenuDeCours(aContenu);});aCahierDeTexte.listeContenus.aUnElementVide=ObjetDeserialiser._aUnElementVide;aCahierDeTexte.listeContenus.verifierAvantValidation=ObjetDeserialiser._verifierAvantValidation;if(!!aCahierDeTexte.Matiere){aCahierDeTexte.Matiere.CouleurFond=aCahierDeTexte.CouleurFond;}
if(!aCahierDeTexte.ListeTravailAFaire){aCahierDeTexte.ListeTravailAFaire=new ObjetListeElements();}
aCahierDeTexte.ListeTravailAFaire.parcourir(function(aTaf){lThis.deserialiserTAF(aTaf);});aCahierDeTexte.ListeTravailAFaire.setTri([ObjetTri.init('DonneLe'),ObjetTri.init('Genre')]);aCahierDeTexte.ListeTravailAFaire.trier();aCahierDeTexte.ListeTravailAFaire.aUnElementVide=ObjetDeserialiser._aUnElementVide;aCahierDeTexte.ListeTravailAFaire.verifierAvantValidation=ObjetDeserialiser._verifierAvantValidation;}
static _aUnElementVide(){let lResult=false;for(let I=0;I<this.GetNbrElements()&&!lResult;I++){if(this.Existe(I)&&(this.GetElement(I).estVide)){lResult=true;}}
return lResult;}
static _verifierAvantValidation(){for(let I=0;I<this.GetNbrElements();I++){if(this.Existe(I)&&(this.GetElement(I).estVide)){if(!this.GetElement(I).executionQCM){this.GetElement(I).SetEtat(EGenreEtat.Suppression);}}}}}
function _enrichirEvenementVS(aListe,aElement){new ObjetDeserialiser()._formaterEvenementVS({element:aElement,pourAccueil:this.pourAccueil,liste:aListe});}
function _ajouterEvenement(aJSON,aElement){aElement.DateDebut=aJSON.DateDebut;aElement.DateFin=aJSON.DateFin;aElement.sansHoraire=aJSON.sansHoraire;aElement.Commentaire=aJSON.Commentaire;aElement.CouleurCellule=aJSON.CouleurCellule;aElement.estConseilClasse=aJSON.estConseilClasse;aElement.famille=aJSON.famille;aElement.strAuteur=aJSON.strAuteur;aElement.estPeriodique=aJSON.estPeriodique;aElement.periodicite=aJSON.Periodicite;aElement.publie=!aJSON.nonPublie;aElement.proprietaire=aJSON.Proprietaire;aElement.listeEleves=aJSON.listeEleves;aElement.genresPublicEntite=aJSON.genresPublicEntite;aElement.avecElevesRattaches=aJSON.avecElevesRattaches;aElement.listePublicEntite=aJSON.listePublicEntite;aElement.listePublicIndividu=aJSON.listePublicIndividu;aElement.presidentCC=aJSON.presidentCC;aElement.listeProfsPrincipaux=aJSON.listeProfsPrincipaux;aElement.listeDeleguesParents=aJSON.listeDeleguesParents;aElement.listeDeleguesEleves=aJSON.listeDeleguesEleves;aElement.avecDirecteur=!!aJSON.avecDirecteur;aElement.publicationPageEtablissement=!!aJSON.publicationPageEtablissement;aElement.listeDocJoints=new ObjetListeElements().fromJSON(aJSON.PiecesJointes,_ajouterDocJoint);aElement.navigation=aJSON.navigation;aElement.visio=aJSON.visio;}
function _ajouterDocJoint(aJSON,aElement){aElement.url=aJSON.url;aElement.Url=GChaine.creerUrlBruteLienExterne(aElement);}
function _composeListeDelegues(aTitre,aListe){let lResult='';lResult+=aTitre+' : ';const lArrayDelegues=[];for(let I=0;I<aListe.GetNbrElements()&&I<2;I++){const lElement=aListe.GetElement(I);lArrayDelegues.push(lElement.GetLibelle());}
lResult+=lArrayDelegues.join(', ');if(aListe.GetNbrElements()>2){lResult+=', ...';}
return lResult;}
function _getLibelleEvenement(aParam){const lTab=[],lParam={evenement:null,avecTitre:false,avecDetailConseil:false,avecDateDuJour:true,formatDateDuJour:'['+GTraductions.getValeur('Le').ucfirst()+' %J %MMMM'+']'};$.extend(lParam,aParam);if(lParam.avecTitre){lTab.push(lParam.evenement.GetLibelle());}
const lChaine=GDate.strDates(lParam.evenement.DateDebut,lParam.evenement.DateFin,{sansHoraire:lParam.evenement.sansHoraire});lTab.push(lChaine.trim());lTab.push(lParam.evenement.Commentaire);if(lParam.avecDetailConseil){if(lParam.evenement.salle){lTab.push(GTraductions.getValeur('Agenda.Salle')+' : '+lParam.evenement.salle);}
if(lParam.evenement.president&&lParam.evenement.president.GetLibelle()){lTab.push(GTraductions.getValeur('Agenda.President')+' : '+lParam.evenement.president.GetLibelle());}
if(lParam.evenement.listeParentsDelegues&&lParam.evenement.listeParentsDelegues.GetNbrElements()>0){lTab.push(_composeListeDelegues(GTraductions.getValeur('Agenda.ParentsDelegues'),lParam.evenement.listeParentsDelegues));}
if(lParam.evenement.listeElevesDelegues&&lParam.evenement.listeElevesDelegues.GetNbrElements()>0){lTab.push(_composeListeDelegues(GTraductions.getValeur('Agenda.ElevesDelegues'),lParam.evenement.listeElevesDelegues));}}
return lTab;}
function _getDateEvenement(aParam){const lParam={evenement:null,avecDateDuJour:true,formatDateDuJour:'['+GTraductions.getValeur('Le')+' %J %MMM'+']'};$.extend(lParam,aParam);const lChaine=GDate.strDates(lParam.evenement.DateDebut,lParam.evenement.DateFin,{sansHoraire:lParam.evenement.sansHoraire,formatDate:' %J %MMM'});return lChaine.toLowerCase().ucfirst();}
module.exports=ObjetDeserialiser;},fn:"objetdeserialiser.js"});;
IE.fModule({f:function(exports,require,module,global){const{ObjetRequeteConsultation}=require('ObjetRequeteJSON.js');const Requetes=require('CollectionRequetes.js');const ObjetElement=require('ObjetElement.js');const EGenreAffichageCahierDeTextes=require('Enumere_AffichageCahierDeTextes.js');const ObjetDeserialiser=require('ObjetDeserialiser.js');class ObjetRequeteFicheCDT extends ObjetRequeteConsultation{constructor(...aParams){super(...aParams);}
lancerRequete(aParametres){const lParametres={pourCDT:false,pourTAF:false,cahierDeTextes:undefined,cours:undefined,numeroSemaine:undefined,matiere:undefined,date:undefined,contenu:undefined,TAF:undefined};$.extend(lParametres,aParametres);this.JSON={pourCDT:lParametres.pourCDT,pourTAF:lParametres.pourTAF,cahierDeTextes:lParametres.cahierDeTextes,cours:lParametres.cours,numeroSemaine:lParametres.numeroSemaine,matiere:lParametres.matiere,date:lParametres.date,contenu:lParametres.contenu,TAF:lParametres.TAF};return this.appelAsynchrone();}
actionApresRequete(){let lGenreAffichageCDT;if(this.JSON.pourTAF){lGenreAffichageCDT=EGenreAffichageCahierDeTextes.TravailAFaire;} else{lGenreAffichageCDT=EGenreAffichageCahierDeTextes.ContenuDeCours;}
const lObjetDeserialiser=new ObjetDeserialiser();let lCahierDeTexte=new ObjetElement();if(!!this.JSONReponse.listeCahiersDeTexte&&this.JSONReponse.listeCahiersDeTexte.GetNbrElements()>0&&!!this.JSONReponse.listeCahiersDeTexte.GetElement(0)){lCahierDeTexte=this.JSONReponse.listeCahiersDeTexte.GetElement(0);}
lObjetDeserialiser.deserialiserCahierDeTexte(lCahierDeTexte);this.callbackReussite.appel(lGenreAffichageCDT,lCahierDeTexte,this.JSON);}}
Requetes.inscrire('FicheCDT',ObjetRequeteFicheCDT);module.exports=ObjetRequeteFicheCDT;},fn:"objetrequetefichecdt.js"});;
IE.fModule({f:function(exports,require,module,global){const Identite=require('ObjetIdentite.js');const{GDate}=require('ObjetDate.js');const GTraductions=require('ObjetTraduction.js');const ObjetTri=require('ObjetTri.js');const EGenreLienDS=require('Enumere_LienDS.js');const ObjetRequeteFicheCDT=require('ObjetRequeteFicheCDT.js');const EGenreOnglet=require('Enumere_Onglet.js');class WidgetDS extends Identite{construire(aParams){this.donnees=aParams.donnees;if(this.donnees.listeDS){this.donnees.listeDS.setTri([ObjetTri.init('dateDebut')]);this.donnees.listeDS.trier();}
var lWidget={html:this.composeWidgetDS(EGenreLienDS.tGL_Devoir),nbrElements:this.donnees.listeDS.GetNbrElements()};$.extend(true,this.donnees,lWidget);aParams.construireWidget(this.donnees);}
composeWidgetDS(aGenreLienDS){var H=[];this.donnees.listeDS=this.donnees.listeDS?this.donnees.listeDS:(this.donneesSurveille?this.donneesSurveille.listeDS:null);if(this.donnees.listeDS){H.push('<ul class="liste-clickable" role="list">');for(var i=0;i<this.donnees.listeDS.GetNbrElements();i++){var lDS=this.donnees.listeDS.GetElement(i);if(lDS.GetGenre()===aGenreLienDS){var lStrDate=GDate.FormatDate(lDS.dateDebut,'['+GTraductions.getValeur('Le')+' '+'%JJJJ %J %MMM'+']'+' '+GTraductions.getValeur('De')+' '+'%hh%sh%mm')+GDate.FormatDate(lDS.dateFin,' '+GTraductions.getValeur('A')+' '+'%hh%sh%mm');H.push('<li role="link" tabIndex="0" onclick="',this.Nom,'.surDS (',i,')" onkeyup="if (GNavigateur.IsToucheSelection ()) ',this.Nom,'.surDS (',i,')">','<div class="wrap">','<div class="bloc-date-conteneur">',GDate.FormatDate(lDS.dateDebut,'<div>%JJ</div><div>%MMM</div>'),'</div>','<div class="infos-ds-conteneur">','<h4>',lDS.matiere.GetLibelle(),'</h4>','<h5 class="as-libelle">',lDS.GetLibelle(),'</h5>','<span class="date">',lStrDate.ucfirst(),'</span>',lDS.listeSalles?'<span> - '+(lDS.listeSalles.GetNbrElements()?GTraductions.getValeur('Salle'):GTraductions.getValeur('Salles'))+' '+lDS.listeSalles.getTableauLibelles().join(', ')+'</span>':'','</div>','</div>','</li>');}}
H.push('</ul>');}
return H.join('');}
surDS(i){var lDS=this.donnees.listeDS?this.donnees.listeDS.GetElement(i):this.donneesSurveille.listeDS.GetElement(i);if(this._actionSurRequeteFicheCDT){new ObjetRequeteFicheCDT(this,this._actionSurRequeteFicheCDT.bind(this)).lancerRequete({pourCDT:true,contenu:lDS});} else{GEtatUtilisateur.setNavigationDate(lDS.dateDebut);this.evenementPage({genreOngletDest:EGenreOnglet.CDT_Contenu});}}}
module.exports=WidgetDS;},fn:"espace/script/widget/widgetds.js"});;
IE.fModule({f:function(exports,require,module,global){const WidgetDS=require('espace/script/widget/WidgetDS.js');const ObjetTri=require('ObjetTri.js');const EGenreLienDS=require('Enumere_LienDS.js');class WidgetDSEvaluation extends WidgetDS{construire(aParams){this.donnees=aParams.donnees;this.donneesSurveille=aParams.instance.donnees.devoirSurveille;if(this.donneesSurveille.listeDS){this.donneesSurveille.listeDS.setTri([ObjetTri.init('dateDebut')]);this.donneesSurveille.listeDS.trier();}
var lWidget={html:this.composeWidgetDS(EGenreLienDS.tGL_Evaluation),nbrElements:this.donnees.listeDS.GetNbrElements()};$.extend(true,this.donnees,lWidget);aParams.construireWidget(this.donnees);}}
module.exports=WidgetDSEvaluation;},fn:"espace/script/widget/widgetdsevaluations.js"});;
IE.fModule({f:function(exports,require,module,global){const TypeStatutCours={EnseignementNormal:0,ConseilDeClasse:1,EnseignementRemplacement:2,EnseignementHistorique:3,EnseignementSuppleant:4};module.exports.TypeStatutCours=TypeStatutCours;TypeStatutCours.getCouleur=function(aCours){if(!aCours){return'';}
if(!aCours.estAnnule&&(aCours.estPermanence||aCours.GetGenre()===TypeStatutCours.EnseignementRemplacement)){return'blue';}
if(aCours.GetGenre()===TypeStatutCours.ConseilDeClasse){return'white';}
return'#c00000';};TypeStatutCours.getCouleurFond=function(aCours){return aCours&&aCours.GetGenre()===TypeStatutCours.ConseilDeClasse?'green':'white';};},fn:"typestatutcours.js"});;
IE.fModule({f:function(exports,require,module,global){const MethodesObjet=require('MethodesObjet.js');const MethodesTableau=require('MethodesTableau.js');const ObjetElement=require('ObjetElement.js');const ObjetListeElements=require('ObjetListeElements.js');const ObjetTri=require('ObjetTri.js');const{GDate}=require('ObjetDate.js');const TypeStatutCours=require('TypeStatutCours.js').TypeStatutCours;class ObjetCalculCoursMultiple{calculer(aParametres){let I,lCours,lPlaceDebut,lPlaceFin;this.parametres=$.extend({listeCours:null,avecCoursAnnules:true,avecCoursAnnulesSuperposes:true,avecCoursPrevus:true,getPlaceDebutCours:null,getPlaceFinCours:null,estCoursDansGrille:null,estEDTAnnuel:false},aParametres);this.listeCours=this.parametres.listeCours;if(this.listeCours.__listeCoursBackup){this.listeCours.ListeElements=this.listeCours.__listeCoursBackup.ListeElements;delete this.listeCours.__listeCoursBackup;}
this.listeCours.__listeCoursBackup=MethodesObjet.dupliquer(this.listeCours);this.listeCoursMultiples=new ObjetListeElements();if(!this.parametres.avecCoursAnnules){this.listeCours.parcourir(function(aCours){if(aCours.estAnnule){aCours.Visible=false;}});}
if(!this.parametres.avecCoursPrevus){this.listeCours.parcourir(function(aCours){if(aCours.Visible!==false&&!aCours.estAnnule&&[TypeStatutCours.EnseignementNormal,TypeStatutCours.EnseignementHistorique,TypeStatutCours.EnseignementSuppleant].indexOf(aCours.GetGenre())>=0){aCours.Visible=false;}});}
if(this.parametres.avecCoursAnnules&&!this.parametres.avecCoursAnnulesSuperposes){let lTrouveAnnuleInvisble=_rendreInvisibleCoursAnnulesSuperposes.bind(this)();while(lTrouveAnnuleInvisble){lTrouveAnnuleInvisble=_rendreInvisibleCoursAnnulesSuperposes.bind(this)();}}
this.placesOccupees=[];this.listeCours.parcourir(function(aCours,aIndex){if(aCours.Visible!==false&&!aCours.horsHoraire&&_estCoursDansGrille.call(this,aCours)){lPlaceDebut=this.parametres.getPlaceDebutCours(aCours);if(lPlaceDebut>=0){lPlaceFin=this.parametres.getPlaceFinCours(aCours);for(let lPlace=lPlaceDebut;lPlace<=lPlaceFin;lPlace++){if(MethodesObjet.isUndefined(this.placesOccupees[lPlace])){this.placesOccupees[lPlace]=aIndex;} else{_creationCoursMultiSeances.bind(this)(aIndex);break;}}}}}.bind(this));for(I=0;I<this.listeCoursMultiples.GetNbrElements();I++){lCours=this.listeCoursMultiples.GetElement(I);if(lCours){const lTris=[
ObjetTri.init(function(D){return!!D.estAnnule;}),ObjetTri.init(function(D){return!D.estSortiePedagogique;}),ObjetTri.init(function(D){return!D.estRetenue;})
];if(this.parametres.estEDTAnnuel){lTris.push(ObjetTri.init('numeroSemaine'));}
lTris.push(ObjetTri.init('Debut'),ObjetTri.init(function(E){return E.Fin-E.Debut;}),ObjetTri.init(function(E){return E.Statut?E.Statut:'';}),ObjetTri.init('Position'),ObjetTri.init('Numero'));lCours.listeCours.setTri(lTris).trier();_calculerPositionnementCouloir.bind(this)(lCours);this.listeCours.AddElement(lCours);}}}}
function _unePlaceEstOccupee(aPlacesCours,aPlacesCouloir){for(const I in aPlacesCours){if(aPlacesCouloir[I]){return true;}}
return false;}
function _calculerPositionnementCouloir(aCoursMultiple){aCoursMultiple.listeCours.nbCouloirs=0;aCoursMultiple.numeroCouloir=0;const lCouloirs=[];for(let I=0;I<aCoursMultiple.listeCours.GetNbrElements();I++){lCouloirs[I]=[];}
for(let I=0;I<aCoursMultiple.listeCours.GetNbrElements();I++){const lTabOccupation=[];const lCours=aCoursMultiple.listeCours.GetElement(I);const lPlaceDebut=this.parametres.getPlaceDebutCours(lCours),lPlaceFin=this.parametres.getPlaceFinCours(lCours);for(let lPlace=lPlaceDebut;lPlace<=lPlaceFin;lPlace++){lTabOccupation[lPlace]=true;}
let lNumeroCouloir=0;while(_unePlaceEstOccupee(lTabOccupation,lCouloirs[lNumeroCouloir])){lNumeroCouloir++;aCoursMultiple.listeCours.nbCouloirs=Math.max(aCoursMultiple.listeCours.nbCouloirs,lNumeroCouloir+1);}
for(const J in lTabOccupation){if(lTabOccupation[J]){lCouloirs[lNumeroCouloir][J]=true;}}
lCours.numeroCouloir=lNumeroCouloir;}}
function _rendreInvisibleCoursAnnulesSuperposes(){const lNb=this.listeCours.GetNbrElements();let lCours;let lCoursSuperpose;let lPlaceOccupees=[];for(let I=0;I<lNb;I++){lCours=this.listeCours.GetElement(I);const lPlaceDebut=this.parametres.getPlaceDebutCours(lCours),lPlaceFin=this.parametres.getPlaceFinCours(lCours);if(lCours.Visible!==false&&_estCoursDansGrille.call(this,lCours)){for(let lPlace=lPlaceDebut;lPlace<=lPlaceFin;lPlace++){if(MethodesObjet.isUndefined(lPlaceOccupees[lPlace])){lPlaceOccupees[lPlace]=I;} else{const lCoursSuperposees=_getTableauIndicesCoursSuperposesDeCours.bind(this)(I,lPlaceOccupees);let lAvecCoursAnnule=false;let lAvecCoursNormal=false;for(let j=0;j<lCoursSuperposees.length;j++){lCoursSuperpose=this.listeCours.GetElement(lCoursSuperposees[j]);if(!lAvecCoursNormal){lAvecCoursNormal=!lCoursSuperpose.estAnnule;}
if(!lAvecCoursAnnule){lAvecCoursAnnule=lCoursSuperpose.estAnnule;}}
if(lAvecCoursNormal&&lAvecCoursAnnule){for(let j=0;j<lCoursSuperposees.length;j++){lCoursSuperpose=this.listeCours.GetElement(lCoursSuperposees[j]);if(lCoursSuperpose&&lCoursSuperpose.estAnnule){lCoursSuperpose.Visible=false;return true;}}}
break;}}}}
return false;}
function _getTableauIndicesCoursSuperposesDeCours(aIndiceCours,aPlaceOccupees){const lCours=this.listeCours.GetElement(aIndiceCours);const lCoursSuperposees=[aIndiceCours];const lPlaceDebut=this.parametres.getPlaceDebutCours(lCours),lPlaceFin=this.parametres.getPlaceFinCours(lCours);for(let lPlace=lPlaceDebut;lPlace<=lPlaceFin;lPlace++){const lIndiceCours=aPlaceOccupees[lPlace];if(!MethodesObjet.isUndefined(lIndiceCours)){if((lIndiceCours!==aIndiceCours)&&(!MethodesTableau.existe(lIndiceCours,lCoursSuperposees))){lCoursSuperposees.push(lIndiceCours);}}}
return lCoursSuperposees;}
function _creationCoursMultiSeances(aIndiceCours){let lCours=this.listeCours.GetElement(aIndiceCours);const lCoursSuperposees=_getTableauIndicesCoursSuperposesDeCours.bind(this)(aIndiceCours,this.placesOccupees);let lPlaceDebut=lCours.Debut;let lPlaceFin=lCours.Fin;const lListeCoursDansCoursMultiple=new ObjetListeElements();const lSemaine=lCours.numeroSemaine;const lRessource=lCours.ressource;let lDateDuCoursFin=MethodesObjet.isDate(lCours.DateDuCoursFin)?lCours.DateDuCoursFin:0;for(let I=0;I<lCoursSuperposees.length;I++){if(lCoursSuperposees[I]<0){const lIndice= -lCoursSuperposees[I]-1;lCours=this.listeCoursMultiples.GetElement(lIndice);for(let J=0;J<lCours.listeCours.GetNbrElements();J++){lListeCoursDansCoursMultiple.AddElement(lCours.listeCours.GetElement(J));}
this.listeCoursMultiples.AddElement(null,lIndice);} else{lCours=this.listeCours.GetElement(lCoursSuperposees[I]);const lCoursDuplique=MethodesObjet.dupliquer(lCours);lCoursDuplique.coursOrigine=lCours;lCoursDuplique.indiceCoursOrigine=lCoursSuperposees[I];lCoursDuplique.Visible=true;lListeCoursDansCoursMultiple.AddElement(lCoursDuplique);lCours.Visible=false;lCours.estCoursMS=true;lCours.coursCopie=lCoursDuplique;}
lPlaceDebut=Math.min(lPlaceDebut,lCours.Debut);lPlaceFin=Math.max(lPlaceFin,lCours.Fin);if(MethodesObjet.isDate(lCours.DateDuCoursFin)&&(!lDateDuCoursFin||lCours.DateDuCoursFin>lDateDuCoursFin)){lDateDuCoursFin=lCours.DateDuCoursFin;}}
const lCoursMultiple=new ObjetElement(lCours.GetLibelle(),0);lCoursMultiple.coursMultiple=true;lCoursMultiple.place=lPlaceDebut;lCoursMultiple.Debut=lCoursMultiple.place;lCoursMultiple.Fin=lPlaceFin;lCoursMultiple.duree=lPlaceFin-lPlaceDebut+1;lCoursMultiple.CouleurFond=GCouleur.nonEditable.fond;lCoursMultiple.numeroSemaine=lSemaine;lCoursMultiple.ressource=lRessource;lCoursMultiple.DateDuCours=GDate.placeEnDate(lSemaine,lPlaceDebut,false);if(lDateDuCoursFin&&lDateDuCoursFin.getTime){lCoursMultiple.DateDuCoursFin=new Date(lDateDuCoursFin.getTime());}
lCoursMultiple.listeCours=lListeCoursDansCoursMultiple;lCoursMultiple.ListeContenus=new ObjetListeElements();this.listeCoursMultiples.AddElement(lCoursMultiple);const lIndiceCoursMultiple=this.listeCoursMultiples.GetNbrElements();const lPlaceDebutCoursGrille=this.parametres.getPlaceDebutCours(lCoursMultiple),lPlaceFinCoursGrille=this.parametres.getPlaceFinCours(lCoursMultiple);for(let lPlace=lPlaceDebutCoursGrille;lPlace<=lPlaceFinCoursGrille;lPlace++){this.placesOccupees[lPlace]= -lIndiceCoursMultiple;}}
function _estCoursDansGrille(aCours){if(this.parametres.estCoursDansGrille){return this.parametres.estCoursDansGrille(aCours);}
return true;}
module.exports=ObjetCalculCoursMultiple;},fn:"objetcalculcoursmultiple.js"});;
IE.fModule({f:function(exports,require,module,global){const TypeGenreDisponibilite={GD_Voeu:0,GD_IndisponibiliteSouple:1,GD_IndisponibiliteDure:2,GD_Priorite1:3,GD_Priorite2:4,GD_DebutImpose:5,GD_Priorite3:6};module.exports.TypeGenreDisponibilite=TypeGenreDisponibilite;const TypeGenreDisponibiliteUtil={getClass(aType){switch(aType){case TypeGenreDisponibilite.GD_Priorite1:return'priorite-1';case TypeGenreDisponibilite.GD_Priorite2:return'priorite-2';case TypeGenreDisponibilite.GD_Priorite3:return'priorite-3';default:;return'';}}};module.exports.TypeGenreDisponibiliteUtil=TypeGenreDisponibiliteUtil;},fn:"typegenredisponibilite.js"});;
IE.fModule({f:function(exports,require,module,global){const GTraductions=require('ObjetTraduction.js');const{GDate}=require('ObjetDate.js');const ObjetListeElements=require('ObjetListeElements.js');const tag=require('tag.js');const ObjetElement=require('ObjetElement.js');const ObjetTri=require('ObjetTri.js');const EGenreRessource=require('Enumere_Ressource.js');const EGenreDomaineFrequence=require('Enumere_DomaineFrequence.js');const MethodesTableau=require('MethodesTableau.js');const GHtml=require('GHtml.js');const GChaine=require('GChaine.js');const ObjetFenetre=require('ObjetFenetre.js');const ObjetCalculCoursMultiple=require('ObjetCalculCoursMultiple.js');const TypeStatutCours=require('TypeStatutCours.js').TypeStatutCours;const UtilitaireVisios=require('UtilitaireVisiosSco.js').UtilitaireVisios;const TypeGenreDisponibiliteUtil=require('TypeGenreDisponibilite.js').TypeGenreDisponibiliteUtil;const TypeExclusion={demipension:'demipension',etablissement:'etablissement',classe:'classe'};class UtilitaireEDTJournalier{constructor(){}
static formaterDonnees(aParams){const lPlaceCourante=GDate.DateEnPlaceHebdomadaire(new Date());const lEstJourCourant=GDate.estJourCourant(aParams.date);const lExclusions=aParams.absences?_getExclusion(aParams.absences.joursCycle):null;let lSsTitre='';if(lExclusions){lExclusions.parcourir((aExclusion) =>{lSsTitre=aExclusion;});aParams.exclusions=lExclusions;}
let lListeDonnees=new ObjetListeElements();const lListeCours=aParams.listeCours;new ObjetCalculCoursMultiple().calculer({listeCours:lListeCours,avecCoursAnnules:true,avecCoursAnnulesSuperposes:!GEtatUtilisateur.estEspacePourEleve(),getPlaceDebutCours:function(aCours){return _getPlaceDebutCours(aCours);}.bind(this),getPlaceFinCours:function(aCours){return _getPlaceFinCours(aCours);}.bind(this)});lListeCours.trier();let aCoursPrecedent=null;lListeCours.parcourir((aCours) =>{const lElement=_formatCours(aCours,aCoursPrecedent,{placeCourante:lPlaceCourante,estJourCourant:lEstJourCourant,avecTrouEDT:aParams.avecTrouEDT,exclusions:aParams.exclusions,joursStage:aParams.joursStage,avecIconeAppel:aParams.avecIconeAppel});if(lSsTitre===''&&lElement&&lElement.enStage){lSsTitre={libelle:GTraductions.getValeur('TypeDispenseEleveDeCours.enStage'),type:'stage'};}
if(lElement){lListeDonnees.AddElement(lElement);aCoursPrecedent=lElement;}});lListeDonnees.setTri([ObjetTri.init('debutPlaceJour')]);lListeDonnees.trier();if(aParams.avecTrouEDT){if(aParams.disponibilites){_ajouterDisponibilite(lListeDonnees,aParams.disponibilites);lListeDonnees.trier();}
_completerDonnees(lListeDonnees,aParams);}
lListeDonnees.trier();return{soustitre:lSsTitre,listeDonnees:lListeDonnees};}
static surClicVisioCours(aCours){var lVisioCours=null;if(!!aCours&&!!aCours.listeVisios&&aCours.listeVisios.GetNbrElementsExistes()>0){lVisioCours=aCours.listeVisios.GetPremierElement();}
if(!!lVisioCours&&!!lVisioCours.url){const lOptions={titre:aCours&&aCours.GetGenre()===TypeStatutCours.ConseilDeClasse?GTraductions.getValeur('FenetreSaisieVisiosCours.URLAssocieeAuConseil'):GTraductions.getValeur('FenetreSaisieVisiosCours.URLAssocieeAuCours')};UtilitaireVisios.ouvrirFenetreConsultVisio(lVisioCours,lOptions);}}
static getTitreSemaine(aNumeroSemaine){let lTitre=GTraductions.getValeur('Semaine')+' ';if(GParametres.frequences&&GParametres.frequences[aNumeroSemaine]){lTitre+=(MethodesTableau.existe(GParametres.frequences[aNumeroSemaine].genre,[EGenreDomaineFrequence.QZ1,EGenreDomaineFrequence.QZ2])?GParametres.frequences[aNumeroSemaine].libelle:GTraductions.getValeur('Feriee').toLowerCase());} else{lTitre+=aNumeroSemaine;}
return lTitre;}
static composeCours(aCours,aParams){if(aCours.masquerCours){return'';}
const lCliquable=(aParams.forcerClickCours||aParams.estRetenue||aParams.estSortiePedagogique);const lNodeCours=aCours.listeCours||lCliquable?GHtml.composeAttr('ie-node','getNodeCours',[aParams.indexCours,aParams.indexCoursMultiple]):'';const lWaiLabel=[GTraductions.getValeur('Dates.DeHeureDebutAHeureFin',[aCours.heureDebut,aCours.heureFin]),aCours.GetLibelle()];const H=[];H.push(`<li ${lNodeCours} class="flex-contain ${aCours.styleCours?aCours.styleCours.join(' '):''}" tabindex="0" aria-description="${lWaiLabel.join(' ')}">`);H.push(tag('div',{class:'container-heures','aria-hidden':'true'},tag('div',{class:`${aCours.estEnCours?'Gras':''}`},aCours.heureDebut),(aCours.masquerHeureFin?'':tag('div',aCours.heureFin))));H.push(tag('div',{class:'trait-matiere',style:`${aCours.couleur&&!aCours.estPasse?'background-color :'+aCours.couleur+';':''}`}));H.push(tag('ul',{class:`container-cours ${aCours.classCss?aCours.classCss.join(' '):''}`,'aria-label':aCours.ariaLabel?aCours.ariaLabel:''},_composeContenuCours(aCours,!lCliquable,aParams)));H.push('</li>');return H.join('');}
static popupCoursMultiple(aInstance,aCoursMultiple,aParams){var lContenu=[];lContenu.push('<div class="edtJournalier"><ul class="liste-cours">');if(aCoursMultiple.listeCours){aCoursMultiple.listeCours.parcourir((aCours,aIndex) =>{aParams.indexCoursMultiple=aIndex;lContenu.push(UtilitaireEDTJournalier.composeCours(aCours,aParams));});}
lContenu.push('</ul></div>');var lTitreModale=[];lTitreModale.push(GChaine.Format(GTraductions.getValeur('EDT.coursMultipleEntreEt'),[aCoursMultiple.listeCours.GetNbrElements(),aCoursMultiple.heureDebut,aCoursMultiple.heureFin]));UtilitaireEDTJournalier.fermerFenetreCours.call(aInstance);aInstance.fenetreCours=ObjetFenetre.creerInstance(ObjetFenetre,{pere:aInstance},{titre:lTitreModale.join(''),largeur:400,fermerFenetreSurClicHorsFenetre:true,callbackFermer:function(){aInstance.fenetreCours=null;if(aInstance.callbackPopup){aInstance.callbackPopup();}}.bind(aInstance)});$.extend(aInstance.fenetreCours.controleur,aInstance.controleur);aInstance.fenetreCours.Afficher(lContenu.join(''));}
static fermerFenetreCours(){if(this.fenetreCours){this.fenetreCours.Fermer();}}}
function _formatCours(aCours,aCoursPrecedent,aParams){if(aCours.Visible===false){return;}
const lElement=new ObjetElement('',aCours.GetNumero());lElement.coursOriginal=aCours;if(aCours.listeCours){lElement.SetLibelle(GTraductions.getValeur('EDT.seancesDifferentes',[aCours.listeCours.GetNbrElements()]));let lListeCours=new ObjetListeElements();let lCoursPrecedent=null;aCours.listeCours.parcourir((aCoursMultiple) =>{const lCoursCourant=_formatCours(aCoursMultiple,lCoursPrecedent,aParams);lListeCours.AddElement(lCoursCourant);lCoursPrecedent=lCoursCourant;});lElement.listeCours=lListeCours;}
lElement.place=aCours.place;lElement.etiquettes=new ObjetListeElements();lElement.couleur=aCours.CouleurFond;lElement.memo=aCours.memo;lElement.DateDuCours=aCours.DateDuCours;if(aCours.horsHoraire){lElement.debutPlaceJour=GDate.DateEnPlaceHebdomadaire(aCours.DateDuCours,false)+1;} else{lElement.debutPlaceJour=aCours.place;}
lElement.finPlaceJour=lElement.debutPlaceJour+aCours.duree;lElement.heureDebut=GDate.FormatDate(aCours.DateDuCours||GDate.placeEnDateHeure(aCours.Debut),'%xh%sh%mm');lElement.heureFin=GDate.FormatDate(aCours.DateDuCoursFin?aCours.DateDuCoursFin:GDate.placeEnDateHeure(aCours.Fin,true),'%xh%sh%mm');if(aCoursPrecedent){aCoursPrecedent.masquerHeureFin=lElement.heureDebut===aCoursPrecedent.heureFin;}
if(aCours.Statut){lElement.etiquettes.AddElement({Libelle:aCours.Statut,theme:aCours.estAnnule?'gd-util-rouge-foncee':'gd-util-bleu-moyen'});}
const lEtiquetteVisio={Libelle:'',theme:'gd-util-vert-foncee',icone:aCours.listeVisios&&aCours.listeVisios.GetNbrElements()>0?'icon_cours_virtuel':'',estVisio:true,numeroCours:aCours.GetNumero(),coursMultiple:aCours.coursMultiple};if(aCours.dispenseEleve){if(aCours.dispenseEleve.maison){lElement.etiquettes.AddElement({Libelle:GTraductions.getValeur('WidgetEDTJournalier.ALaMaison'),theme:'gd-util-vert-foncee'});} else{lElement.etiquettes.AddElement({Libelle:GTraductions.getValeur('WidgetEDTJournalier.Dispense'),theme:'gd-util-orange-moyen'});}}
if(aCours.listeVisios&&aCours.listeVisios.GetNbrElements()>0){lElement.etiquettes.AddElement(lEtiquetteVisio);}
lElement.estEnCours=aParams.estJourCourant&&aParams.placeCourante>=aCours.Debut&&aParams.placeCourante<=aCours.Fin;lElement.estPasse=aParams.avecTrouEDT&&aParams.estJourCourant&&aCours.numeroSemaine&&aParams.placeCourante>aCours.place&&!lElement.estEnCours;lElement.professeurs=[];lElement.classes=[];lElement.groupes=[];lElement.partieDeClasse=[];lElement.salles=[];lElement.materiels=[];lElement.accompagnants=[];lElement.personnels=[];aCours.ListeContenus.parcourir((aContenu) =>{switch(aContenu.GetGenre()){case EGenreRessource.Matiere:lElement.SetLibelle(aContenu.GetLibelle());break;case EGenreRessource.Enseignant:lElement.professeurs.push(aContenu.GetLibelle());break;case EGenreRessource.Classe:lElement.classes.push(aContenu.GetLibelle());break;case EGenreRessource.Groupe:lElement.groupes.push(aContenu.GetLibelle());break;case EGenreRessource.PartieDeClasse:lElement.partieDeClasse.push(aContenu.GetLibelle());break;case EGenreRessource.Salle:lElement.salles.push(aContenu.GetLibelle());break;case EGenreRessource.Materiel:lElement.materiels.push(aContenu.GetLibelle());break;case EGenreRessource.Personnel:if(aContenu.estAccompagnant){lElement.accompagnants.push(aContenu.GetLibelle());} else{lElement.personnels.push(aContenu.GetLibelle());}
break;default:lElement.autreContenu=aContenu.GetLibelle();break;}
if(aCours.estRetenue&&aContenu.estHoraire){lElement.SetLibelle('<i class="icon_punition self-center" ></i>'+aContenu.GetLibelle());}});lElement.styleCours=[];lElement.classCss=[];if(aCours.estAnnule){lElement.styleCours.push('cours-annule');} else if(lElement.estPasse){lElement.styleCours.push('Gris');}
if(lElement.estEnCours){lElement.styleCours.push('en-cours');}
if(aCours.estRetenue){lElement.classCss.push('est-retenue');}
if(aParams.joursStage){let lEnStage=false;const lStageAM=aParams.joursStage.am;const lStagePM=aParams.joursStage.pm;const lJourAnnee=GDate.getNbrJoursEntreDeuxDates(IE.Cycles.dateDebutPremierCycle(),aCours.DateDuCours)+1;if(aCours.Debut<=GParametres.debutDemiPension){lEnStage=lStageAM?lStageAM.contains(lJourAnnee):false;} else if(aCours.Fin>=GParametres.finDemiPension){lEnStage=lStagePM?lStagePM.contains(lJourAnnee):false;}
lElement.enStage=lEnStage;if(lEnStage){lElement.styleCours.push('en-stage');}}
lElement.styleCours.push(_estExcluDuCours(aCours,aParams.exclusions));if(aCours.NomImageAppelFait&&aParams.avecIconeAppel){lElement.NomImageAppelFait=aCours.NomImageAppelFait;}
aCoursPrecedent=lElement;return lElement;}
function _getPlaceDebutCours(aCours){return!aCours||aCours.horsHoraire?-1:aCours.Debut;}
function _getPlaceFinCours(aCours){var lPlace=aCours.Fin;var lJourDebut=Math.floor(aCours.Debut/GParametres.PlacesParJour);if(Math.floor(aCours.Fin/GParametres.PlacesParJour)!==lJourDebut){lPlace=lJourDebut*GParametres.PlacesParJour+GParametres.PlacesParJour-1;}
return lPlace;}
function _composeContenuCours(aCours,aAvecCoursReduit,aParams){const lAvecNomProfesseur=GEtatUtilisateur.estEspacePourEleve();const lEtiquettes=[];if(aCours.etiquettes){aCours.etiquettes.parcourir((aEtiquette) =>{lEtiquettes.push(_composeEtiquette(aEtiquette,aParams.indexCours));});}
const H=[];let lHintImageAppel='';switch(aCours.NomImageAppelFait){case'AppelFait':lHintImageAppel=GTraductions.getValeur('EDT.AppelFait');break;case'AppelNonFait':lHintImageAppel=GTraductions.getValeur('EDT.AppelNonFait');break;case'AppelVerrouNonFait':lHintImageAppel=GTraductions.getValeur('EDT.AppelVerrouNonFait');break;}
H.push(tag('li',{class:[!aCours.estPasDeCours?'libelle-cours':'','flex-contain'],'aria-hidden':'true'},aCours.estDemiPension?'':aCours.GetLibelle(),(aCours.NomImageAppelFait?tag('div',{class:['m-left',`Image_${aCours.NomImageAppelFait}`],'ie-hint':lHintImageAppel}):'')));H.push(aCours.autreContenu?tag('li',aCours.autreContenu):'');if(!aCours.estPasse||!aAvecCoursReduit){if(lAvecNomProfesseur){H.push(aCours.professeurs&&aCours.professeurs.length>0?tag('li',aCours.professeurs.join(', ')):'');} else{H.push(aCours.classes&&aCours.classes.length>0?tag('li',aCours.classes.join(', ')):'');}
H.push(aCours.groupes&&aCours.groupes.length>0?tag('li',aCours.groupes.join(', ')):'');H.push(aCours.partieDeClasse&&aCours.partieDeClasse.length>0?tag('li',aCours.partieDeClasse.join(', ')):'');H.push(aCours.personnels&&aCours.personnels.length>0?tag('li',aCours.personnels.join(', ')):'');H.push(aCours.accompagnants&&aCours.accompagnants.length>0?tag('li',tag('i',{class:['icon_accompagnant p-right-s']}),aCours.accompagnants.join(', ')):'');H.push(aCours.salles&&aCours.salles.length>0?tag('li',aCours.salles.join(', ')):'');H.push(aCours.materiels&&aCours.materiels.length>0?tag('li',aCours.materiels.join(', ')):'');if(aCours.memo){H.push(tag('li',tag('i',{class:'icon_post_it_rempli'}),aCours.memo));}}
H.push(lEtiquettes&&lEtiquettes.length>0?tag('li',{class:'container-etiquette'},lEtiquettes.join('')):'');return H.join('');}
function _composeEtiquette(aEtiquette,aIndexCours){const lBtnVisio=(aEtiquette.estVisio&&aEtiquette.numeroCours?GHtml.composeAttr('ie-node','getNodeVisioCours',[aEtiquette.numeroCours,aIndexCours]):'');const H=[];if(aEtiquette.Libelle!==''){H.push(tag('div',{class:`m-left-s tag-style ie-chips ${aEtiquette.theme}`},aEtiquette.Libelle));}
if(aEtiquette.icone){H.push(`<ie-btnicon class="${aEtiquette.icone} self-center m-right bt-large" ${lBtnVisio}></ie-btnicon>`);}
return H.join('');}
function _getExclusion(aJoursCycle){const lExclusions=new ObjetListeElements();if(aJoursCycle){aJoursCycle.parcourir((aJour) =>{if(aJour.DP){if(aJour.DP.exclusion){lExclusions.AddElement({libelle:GTraductions.getValeur('EDT.Exclusion.DemiPension'),type:TypeExclusion.demipension});} else if(aJour.DP.MC){lExclusions.AddElement({libelle:GTraductions.getValeur('AbsenceVS.mesureConservatoire'),type:TypeExclusion.demipension});}}
if(aJour.exclusionsClasse){lExclusions.AddElement({libelle:GTraductions.getValeur('EDT.Exclusion.Classe'),type:TypeExclusion.classe,debut:aJour.exclusionsClasse.placeDebut,fin:aJour.exclusionsClasse.placeFin});}
if(aJour.exclusionsEtab){lExclusions.AddElement({libelle:aJour.exclusionsEtab.MC?GTraductions.getValeur('AbsenceVS.mesureConservatoire'):GTraductions.getValeur('EDT.Exclusion.Etablissement'),type:TypeExclusion.etablissement,debut:aJour.exclusionsEtab.placeDebut,fin:aJour.exclusionsEtab.placeFin});}});}
return lExclusions;}
function _estExcluDuCours(aCours,aExclusions){let lVoileExlusion="";if(aExclusions){aExclusions.parcourir((aExclusion) =>{if(aExclusion.type===TypeExclusion.demipension){lVoileExlusion=aCours.estDemiPension?'exclusion-'+aExclusion.type:'';return;}
if(aCours.Debut>=aExclusion.debut&&aCours.Debut<=aExclusion.fin){lVoileExlusion='exclusion-'+aExclusion.type;}});}
return lVoileExlusion;}
function _ajouterTrou(aTrou,aParams){const lElement=new ObjetElement('');lElement.heureDebut=GDate.FormatDate(GDate.placeEnDateHeure(aTrou.debut),'%xh%sh%mm');lElement.heureFin=GDate.FormatDate(GDate.placeEnDateHeure(aTrou.fin),'%xh%sh%mm');lElement.debutPlaceJour=aTrou.debut;lElement.styleCours=[];lElement.styleCours.push('Gris');if(aTrou.estDemiPension){lElement.estDemiPension=true;lElement.classCss=['demi-pension'];lElement.SetLibelle(GTraductions.getValeur('EDT.PauseDejeuner'));lElement.ariaLabel=GTraductions.getValeur('EDT.PauseDejeuner');lElement.styleCours.push(_estExcluDuCours(lElement,aParams.exclusions));} else if(aTrou.genrePriorite!==undefined){lElement.ignorerTrou=true;lElement.finPlaceJour=lElement.debutPlaceJour+(aTrou.fin-aTrou.debut);lElement.heureFin=lElement.finPlaceJour<GParametres.LibellesHeures.GetNbrElements()?GParametres.LibellesHeures.GetLibelle(lElement.finPlaceJour):'';lElement.SetLibelle(aTrou.libelle);lElement.masquerHeureFin=false;lElement.styleCours=[TypeGenreDisponibiliteUtil.getClass(aTrou.genrePriorite)];} else{lElement.SetLibelle(GTraductions.getValeur('EDT.PasDeCours'));lElement.masquerHeureFin=true;lElement.classCss=['pas-de-cours'];}
return lElement;}
function _ajouterDisponibilite(aListe,aListeDisponibilites){if(aListeDisponibilites){aListeDisponibilites.forEach((aDisponibilite) =>{aListe.AddElement(_ajouterTrou({debut:aDisponibilite.placeDebut,fin:(aDisponibilite.placeFin+1),date:aDisponibilite.date,estDemiPension:false,genrePriorite:aDisponibilite.genre,libelle:aDisponibilite.libelle}));});}}
function _completerDonnees(aListe,aParams){let aCoursPrecedent=null;const lTableauTrou=[];aListe.parcourir((aCours) =>{if(aCoursPrecedent&&!aCoursPrecedent.ignorerTrou&&aCours.debutPlaceJour!==aCoursPrecedent.finPlaceJour&&!aCours.ignorerTrou){aCoursPrecedent.masquerHeureFin=true;const lDebut=aCoursPrecedent.finPlaceJour;const lFin=aCours.debutPlaceJour;const lEstDP=(lDebut>=aParams.debutDemiPensionHebdo&&lDebut<aParams.finDemiPensionHebdo)||(lFin>aParams.debutDemiPensionHebdo&&lFin<=aParams.finDemiPensionHebdo)||(lDebut<aParams.debutDemiPensionHebdo&&lFin>aParams.finDemiPensionHebdo);if(lEstDP){if(lDebut<aParams.debutDemiPensionHebdo&&lFin>aParams.finDemiPensionHebdo){lTableauTrou.push({debut:lDebut,fin:aParams.debutDemiPensionHebdo,estDemiPension:false});lTableauTrou.push({debut:aParams.debutDemiPensionHebdo,fin:aParams.finDemiPensionHebdo,estDemiPension:true});lTableauTrou.push({debut:aParams.finDemiPensionHebdo,fin:lFin,estDemiPension:false});} else if(lDebut<aParams.debutDemiPensionHebdo&&lFin>aParams.debutDemiPensionHebdo){lTableauTrou.push({debut:lDebut,fin:aParams.debutDemiPensionHebdo,estDemiPension:false});lTableauTrou.push({debut:aParams.debutDemiPensionHebdo,fin:lFin,estDemiPension:true});} else if(lDebut<aParams.finDemiPensionHebdo&&lFin>aParams.finDemiPensionHebdo){lTableauTrou.push({debut:lDebut,fin:aParams.finDemiPensionHebdo,estDemiPension:true});lTableauTrou.push({debut:aParams.finDemiPensionHebdo,fin:lFin,estDemiPension:false});} else{lTableauTrou.push({debut:lDebut,fin:lFin,estDemiPension:lEstDP});}} else{lTableauTrou.push({debut:lDebut,fin:lFin,estDemiPension:lEstDP});}}
aCoursPrecedent=aCours;});lTableauTrou.forEach((aTrou) =>{if(!isNaN(aTrou.debut)){aListe.AddElement(_ajouterTrou(aTrou,aParams));}});}
module.exports=UtilitaireEDTJournalier;},fn:"utilitaireedtjournalier.js"});;
IE.fModule({f:function(exports,require,module,global){const Identite=require('ObjetIdentite.js');const ObjetCelluleDate=require('ObjetCelluleDate.js');const{TypeDroits}=require('ObjetDroitsPN.js');const tag=require('tag.js');const UtilitaireEDTJournalier=require('UtilitaireEDTJournalier.js');const GTraductions=require('ObjetTraduction.js');const{GDate}=require('ObjetDate.js');require('WidgetEdtJournalier.css');class WidgetEDTJournalier extends Identite{constructor(...aParams){super(...aParams);this.optionsFenetre={};this.parametres={avecCoursAnnule:true,avecCoursAnnulesSuperposes:!GEtatUtilisateur.estEspacePourEleve(),avecNomProfesseur:GEtatUtilisateur.estEspacePourEleve()};}
getControleur(aInstance){return $.extend(true,super.getControleur(aInstance),{getNodeCours:function(aIndex){$(this.node).on('click',function(){if(aInstance.listeCoursFormate){const lCours=aInstance.listeCoursFormate.GetElement(aIndex);if(lCours.listeCours){UtilitaireEDTJournalier.popupCoursMultiple(aInstance,lCours,{indexCours:aIndex,forcerClickCours:false});}
;}});},getNodeVisioCours:function(aNumeroCours,aIndexCours){$(this.node).on('click',function(){const lCours=aInstance.listeCoursFormate.GetElement(aIndexCours);if(lCours&&lCours.coursOriginal){let lCopieCours=lCours.coursOriginal;if(lCours.coursOriginal.coursMultiple){lCopieCours=lCours.coursOriginal.listeCours.GetElementParNumero(aNumeroCours);}
UtilitaireEDTJournalier.surClicVisioCours(lCopieCours);}});}});}
construire(aParams){this.donnees=aParams.instance.donnees;this.donneesRequete=aParams.instance.donneesRequete;this.donnees.EDT.jourSelectionne=this.donneesRequete.EDT.date||this.donnees.EDT.dateSelection;_creerObjetsEDT.call(this);const lWidget={html:_composeWidgetEDTJournalier.call(this),titre:'',hint:GTraductions.getValeur('accueil.emploiDuTemps'),nbrElements:null,afficherMessage:false,listeElementsGraphiques:[{id:this.dateEDT?this.dateEDT.GetNom():null}
]};$.extend(true,this.donnees.EDT,lWidget);aParams.construireWidget(this.donnees.EDT);_initialiserObjetsEDT.call(this);}
_initialiserDateEDT(aInstance){aInstance.setOptions_ObjetCelluleDate({formatDate:'[%JJJ %JJ %MMM]',avecBoutonsPrecedentSuivant:true,classeCSSTexte:'Maigre',largeurComposant:100});aInstance.setParametres_Fenetre(GParametres.PremierLundi,GParametres.PremiereDate,GParametres.DerniereDate,GParametres.JoursOuvres,GApplication.droits.get(TypeDroits.cours.domaineConsultationEDT));}
_evenementDateEDT(aDate){this.donneesRequete.EDT.date=aDate;this.donneesRequete.EDT.numeroSemaine=IE.Cycles.cycleDeLaDate(aDate);this.donnees.EDT.jourSelectionne=aDate;this.RecupererDonnees([this.donnees.EDT.genre]);}
evenementProchaineDate(){if(this.donnees&&this.donnees.EDT&&this.donnees.EDT.prochaineDate){this._evenementDateEDT(this.donnees.EDT.prochaineDate);}}}
function _composeWidgetEDTJournalier(){const lParams={listeCours:this.donnees.EDT.listeCours,date:this.donneesRequete.EDT.date||this.donnees.EDT.dateSelection,absences:this.donnees.EDT.absences,joursStage:this.donnees.EDT.joursStage,disponibilites:this.donnees.EDT.disponibilites,avecTrouEDT:true,avecIconeAppel:true,debutDemiPensionHebdo:this.donnees.EDT.debutDemiPensionHebdo,finDemiPensionHebdo:this.donnees.EDT.finDemiPensionHebdo};if(this.donnees.EDT.prochaineDate){const lPlaceCourante=GDate.DateEnPlaceHebdomadaire(new Date());const lEstJourCourant=GDate.estJourCourant(lParams.date);if(this.donnees.EDT.listeCours.GetNbrElements()===0){this.evenementProchaineDate();return;} else{const lDernierCours=this.donnees.EDT.listeCours.GetElement(this.donnees.EDT.listeCours.GetNbrElements()-1);if(lDernierCours){const lEstEnCours=lEstJourCourant&&lPlaceCourante>=lDernierCours.Debut&&lPlaceCourante<=lDernierCours.Fin;if(lEstJourCourant&&lDernierCours.numeroSemaine&&lPlaceCourante>lDernierCours.place&&!lEstEnCours){this.evenementProchaineDate();return;}}}}
const lDonnees=UtilitaireEDTJournalier.formaterDonnees(lParams);this.listeCoursFormate=lDonnees.listeDonnees;const lNumeroSemaine=this.donneesRequete.EDT&&this.donneesRequete.EDT.numeroSemaine?this.donneesRequete.EDT.numeroSemaine:this.numeroSemaineParDefaut;const H=[];H.push(tag('h3',{class:'text-center ie-titre-couleur-lowercase m-top','tabindex':0},UtilitaireEDTJournalier.getTitreSemaine(lNumeroSemaine)));if(this.listeCoursFormate&&this.listeCoursFormate.GetNbrElements()>0){H.push(lDonnees.soustitre?tag('h4',{class:['text-center ie-sous-titre',lDonnees.soustitre.type]},lDonnees.soustitre.libelle):'');H.push('<ul class="liste-cours m-top-l" role="list">');this.listeCoursFormate.parcourir((aCours,aIndex) =>{H.push(UtilitaireEDTJournalier.composeCours(aCours,{indexCours:aIndex}));});H.push('</ul>');} else{}
return H.join('');}
function _creerObjetsEDT(){this.dateEDT=Identite.creerInstance(ObjetCelluleDate,{pere:this,evenement:this._evenementDateEDT});this._initialiserDateEDT(this.dateEDT);}
function _initialiserObjetsEDT(){if(this.dateEDT){this.dateEDT.Initialiser();this.dateEDT.SetDonnees(this.donneesRequete.EDT.date||this.donnees.EDT.dateSelection);}}
module.exports=WidgetEDTJournalier;},fn:"espace/script/widget/widgetedtjournalier.js"});;
IE.fModule({f:function(exports,require,module,global){const{ObjetRequeteSaisie}=require('ObjetRequeteJSON.js');const Requetes=require('CollectionRequetes.js');class ObjetRequeteSaisieElectionVotant extends ObjetRequeteSaisie{constructor(...aParams){super(...aParams);}
lancerRequete(aParam){this.JSON.election=aParam.election.toJSONAll();aParam.election.vote.setSerialisateurJSON({ignorerEtatsElements:true});this.JSON.election.vote=aParam.election.vote;return this.appelAsynchrone();}}
Requetes.inscrire('SaisieElectionVotant',ObjetRequeteSaisieElectionVotant);module.exports=ObjetRequeteSaisieElectionVotant;},fn:"objetrequetesaisieelectionvotant.js"});;
IE.fModule({f:function(exports,require,module,global){const TypeGenreCandidatElection={GCE_Liste:0,GCE_Individu:1,GCE_Blanc:2};module.exports.TypeGenreCandidatElection=TypeGenreCandidatElection;},fn:"typegenrecandidatelection.js"});;
IE.fModule({f:function(exports,require,module,global){const Identite=require('ObjetIdentite.js');const ObjetRequeteSaisieElectionVotant=require('ObjetRequeteSaisieElectionVotant.js');const GTraductions=require('ObjetTraduction.js');const ObjetTri=require('ObjetTri.js');const{GObjetWAI,EGenreRole,EGenreAttribut}=require('ObjetWAI.js');const{GDate}=require('ObjetDate.js');const MethodesTableau=require('MethodesTableau.js');const MethodesObjet=require('MethodesObjet.js');const ObjetListeElements=require('ObjetListeElements.js');const ObjetElement=require('ObjetElement.js');const GChaine=require('GChaine.js');const EGenreRessource=require('Enumere_Ressource.js');const EGenreBoiteMessage=require('Enumere_BoiteMessage.js');const EGenreAction=require('Enumere_Action.js');const TypeThemeBouton=require('Type_ThemeBouton.js');const{EGenreReponseSaisie}=require('ObjetRequeteJSON.js');const TypeGenreCandidatElection=require('TypeGenreCandidatElection.js').TypeGenreCandidatElection;const EformatDocJoint=require('Enumere_FormatDocJoint.js');class WidgetElections extends Identite{composeWidgetElections(){const H=[];if(!!this.donnees.listeElections&&this.donnees.listeElections.GetNbrElements()>0){for(let I=0;I<this.donnees.listeElections.GetNbrElements();I++){const lElement=this.donnees.listeElections.GetElement(I);H.push(this.composeElection(lElement,I));}}
return H.join('');}
composeElection(aElection,aIndiceElection){const H=[];const lID=this.donnees.id+'_div_'+aIndiceElection;const lTitre=aElection.GetLibelle()||GTraductions.getValeur('accueil.elections.sansTitre');H.push('<div id="',lID,'" ',GObjetWAI.composeRole(EGenreRole.Treeitem),GObjetWAI.composeAttribut({genre:EGenreAttribut.expanded,valeur:(aIndiceElection===0?'true':'false')}),GObjetWAI.composeAttribut({genre:EGenreAttribut.labelledby,valeur:lID+'_wai'}),aIndiceElection===0?GObjetWAI.composeAttribut({genre:EGenreAttribut.describedby,valeur:lID+'_detail'}):'',' tabIndex="-1">');const lFormat='%JJ %MMMM %AAAA';if(aElection.ouvert){H.push('<div class="vote-header">','<h4>',lTitre,'</h4>','<p>',GTraductions.getValeur('accueil.elections.voteOuvertDuAu',[GDate.FormatDate(aElection.dateDebut,lFormat),GDate.FormatDate(aElection.dateFin,lFormat)]),'</p>');if(aElection.description){H.push(aElection.description);}
if(aElection.nbMaxChoix>1){H.push('<p class="nombre-choix">',GTraductions.getValeur('accueil.elections.nbMaxChoix',['<span>'+aElection.nbMaxChoix+'</span>']),'</p>');}
H.push('</div>');if(aElection.documents&&aElection.documents.GetNbrElements()>0){H.push('<div class="vote-files">');aElection.documents.parcourir(function(aDocument){const lSuffixe=GChaine.extraireExtensionFichier(aDocument.GetLibelle());const lTypefile=EformatDocJoint.getClassIconDeGenre(EformatDocJoint.getGenreDeFichier(lSuffixe));const lLienDocument=GChaine.creerUrlBruteLienExterne(aDocument,{genreRessource:EGenreRessource.DocJointEtablissement});H.push('<a href="',lLienDocument,'" class="icon '+lTypefile+'">',aDocument.GetLibelle(),'</a>');});H.push('</div>');}
H.push(this.composeListeCandidats(aElection,aIndiceElection));H.push('<div class="vote-footer">','<ie-bouton  ie-model="btnVote(',aIndiceElection,')">',GTraductions.getValeur('accueil.elections.voter'),'</ie-bouton>','</div>');} else{H.push('<div class="vote-header">','<h4>',GTraductions.getValeur('accueil.elections.prochainementOuverture'),' : <br />',lTitre,'</h4>','<p>',GTraductions.getValeur('accueil.elections.leVoteSeraOuvertDuAu',[GDate.FormatDate(aElection.dateDebut,lFormat),GDate.FormatDate(aElection.dateFin,lFormat)]),'</p>','</div>');}
H.push(GObjetWAI.composeSpan(lTitre,lID+'_wai'));H.push('</div>');return H.join('');}
composeListeCandidats(aElection,aIndiceElection){const H=[];if(!!aElection.candidats&&aElection.candidats.GetNbrElements()>0){H.push('<ul role="list" class="liste-clickable one-line">');aElection.candidats.parcourir(function(aCandidat,aIndiceCandidat){H.push('<li role="listitem" tabindex="0">',_composeCandidat(aCandidat,aIndiceElection,aIndiceCandidat,(aElection.nbMaxChoix>1)),'</li>');});H.push('</ul>');}
return H.join('');}
construire(aParams){this.donnees=aParams.donnees;if(this.donnees.listeElections&&this.donnees.listeElections.GetNbrElements()>0){this.donnees.listeElections.setTri([ObjetTri.init('dateDebut'),ObjetTri.init('dateFin')]);this.donnees.listeElections.trier();const lWidget={html:this.composeWidgetElections(),nbrElements:this.donnees.listeElections.GetNbrElements(),afficherMessage:this.donnees.listeElections.GetNbrElements()===0};$.extend(true,this.donnees,lWidget);const lThis=this;$.extend(this.controleur,{rdChoixCandidat:{getValue:function(aIndiceElection,aIndiceCandidat){if(!lThis.donnees){return false;}
const lElection=lThis.donnees.listeElections.GetElement(aIndiceElection);const lCandidat=lElection.candidats.GetElement(aIndiceCandidat);if(!lElection.vote||lElection.vote.GetNbrElements()===0){return false;} else{return MethodesTableau.existe(lCandidat.GetNumero(),lElection.vote.getTableauNumeros());}},setValue:function(aIndiceElection,aIndiceCandidat,aValue){if(!lThis.donnees){return false;}
const lElection=lThis.donnees.listeElections.GetElement(aIndiceElection);const lCandidat=lElection.candidats.GetElement(aIndiceCandidat);if(aValue){lElection.vote=new ObjetListeElements();lElection.vote.AddElement(lCandidat);}}},cbChoixCandidat:{getValue:function(aIndiceElection,aIndiceCandidat){if(!lThis.donnees){return false;}
const lElection=lThis.donnees.listeElections.GetElement(aIndiceElection);const lCandidat=lElection.candidats.GetElement(aIndiceCandidat);if(!lElection.vote||lElection.vote.GetNbrElements()===0){return false;} else{return MethodesTableau.existe(lCandidat.GetNumero(),lElection.vote.getTableauNumeros());}},setValue:function(aIndiceElection,aIndiceCandidat,aValue){if(!lThis.donnees){return false;}
const lElection=lThis.donnees.listeElections.GetElement(aIndiceElection);const lCandidat=lElection.candidats.GetElement(aIndiceCandidat);if(!lElection.vote){lElection.vote=new ObjetListeElements();}
const lNumero=lCandidat.GetNumero();const lIndice=lElection.vote.getIndiceElementParFiltre(function(aElement){return aElement.GetNumero()===lNumero;});if(aValue){if(lIndice=== -1){lElection.vote.AddElement(lCandidat);}} else{if(lIndice!== -1){lElection.vote.remove(lIndice);}}},getDisabled:function(aIndiceElection,aIndiceCandidat){if(!lThis.donnees||!lThis.donnees.listeElections){return false;}
const lElection=lThis.donnees.listeElections.GetElement(aIndiceElection);if(!lElection||!lElection.vote){return false;} else{const lCandidat=lElection.candidats.GetElement(aIndiceCandidat);const lNumero=lCandidat.GetNumero();const lCandidatEstSelectionne=lElection.vote.getIndiceElementParFiltre(function(aElement){return aElement.GetNumero()===lNumero;})> -1;return(lElection.vote.GetNbrElements()>=lElection.nbMaxChoix)&&!lCandidatEstSelectionne;}}},btnAfficherConstitutionListe:function(aIndiceElection,aIndiceCandidat){$(this.node).on({'click':function(){if(lThis.donnees&&lThis.donnees.listeElections){const lElection=lThis.donnees.listeElections.GetElement(aIndiceElection);const lListeCandidate=lElection.candidats.GetElement(aIndiceCandidat);if(lListeCandidate&&lListeCandidate.membres&&lListeCandidate.membres.GetNbrElements()>0){lListeCandidate.membres.trier();const lHtml=[];lHtml.push('<div>',GTraductions.getValeur('accueil.elections.constitutionDeLaListe',[lListeCandidate.GetLibelle()]),'</div>');lHtml.push('<div class="Espace">');lHtml.push('<ul>');lListeCandidate.membres.parcourir(function(aMembreDeListeCandidate){lHtml.push('<li>');lHtml.push(aMembreDeListeCandidate.GetLibelle());if(!!aMembreDeListeCandidate.statut){lHtml.push(' - <span class="Gras">',aMembreDeListeCandidate.statut,'</span>');}
lHtml.push('</li>');});lHtml.push('</ul>');lHtml.push('</div>');GApplication.getMessage().afficher({type:EGenreBoiteMessage.Information,titre:GTraductions.getValeur('accueil.elections.candidatsConstitutifsDesListes'),message:lHtml.join('')});}}
return false;}});},btnVote:{event:function(aIndiceElection){if(lThis.donnees&&lThis.donnees.listeElections){const lElection=lThis.donnees.listeElections.GetElement(aIndiceElection);if((lElection.nbMaxChoix===1)&&(!lElection.vote||lElection.vote.GetNbrElements()===0)){GApplication.getMessage().afficher({type:EGenreBoiteMessage.Information,message:GTraductions.getValeur('accueil.elections.aucunChoixEffectue')});} else{const lElectionPourVote=new ObjetElement(lElection.GetLibelle(),lElection.GetNumero(),lElection.GetGenre());if(!lElection.vote&&lElection.nbMaxChoix>1){lElection.vote=new ObjetListeElements();}
lElectionPourVote.vote=MethodesObjet.dupliquer(lElection.vote);const lHtml=[];lHtml.push('<div>',GTraductions.getValeur('accueil.elections.confirmationVote',[lElection.GetLibelle()]),'</div>');lHtml.push('<div class="Espace">');lHtml.push('<ul>');if(lElection.vote.GetNbrElements()===0&&lElection.nbMaxChoix>1){lHtml.push('<li>',GTraductions.getValeur('accueil.elections.neSePrononcePas'),'</li>');}
for(let i=0;i<lElection.vote.GetNbrElements();i++){lHtml.push('<li>',lElection.vote.GetLibelle(i),'</li>');}
lHtml.push('</ul>');lHtml.push('</div>');GApplication.getMessage().afficher({type:EGenreBoiteMessage.Confirmation,message:lHtml.join(''),listeBoutons:[{libelle:GTraductions.getValeur('Oui'),theme:TypeThemeBouton.primaire,genreAction:EGenreAction.Valider},{libelle:GTraductions.getValeur('Non'),theme:TypeThemeBouton.secondaire,genreAction:EGenreAction.NePasValider}],callback:function(aElection,aAccepte){if(aAccepte===EGenreAction.Valider){this.titreElection=aElection.GetLibelle();new ObjetRequeteSaisieElectionVotant(lThis,lThis.actionApresSaisieVotant).lancerRequete({election:aElection});}}.bind(lThis,lElectionPourVote)});}}}}});}
aParams.construireWidget(this.donnees);}
actionApresSaisieVotant(aJSONRapport){if(aJSONRapport.genreReponse===EGenreReponseSaisie.succes&&aJSONRapport.JSONRapportSaisie.vote){GApplication.getMessage().afficher({type:EGenreBoiteMessage.Information,titre:this.titreElection?this.titreElection:undefined,message:GTraductions.getValeur('accueil.elections.votePrisEnCompte')+'<br />'+GTraductions.getValeur('accueil.elections.merciParticipation'),callback:function(){this.RecupererDonnees([this.donnees.genre]);}.bind(this)});}}}
function _composeCandidat(aCandidat,aIndiceElection,aIndiceCandidat,aAvecChoixMultiple){let lChoixCandidat;if(!aAvecChoixMultiple){lChoixCandidat=_composeRadioCandidat(aCandidat,aIndiceElection,aIndiceCandidat);} else{lChoixCandidat=_composeCBCandidat(aCandidat,aIndiceElection,aIndiceCandidat);}
return lChoixCandidat;}
function _composeCBCandidat(aCandidat,aIndiceElection,aIndiceCandidat){const H=[];H.push('<ie-checkbox ie-textleft ie-model="cbChoixCandidat(',aIndiceElection,', ',aIndiceCandidat,')">','<span class="libelle">',aCandidat.GetLibelle(),'</span>');if(aCandidat.GetGenre()===TypeGenreCandidatElection.GCE_Liste){H.push('<i class="icon icon_info_sign" ie-node="btnAfficherConstitutionListe(',aIndiceElection,', ',aIndiceCandidat,')"></i>');}
H.push('</ie-checkbox>');return H.join('');}
function _composeRadioCandidat(aCandidat,aIndiceElection,aIndiceCandidat){const lNameGroupeRadio='election_'+aIndiceElection;const H=[];H.push('<ie-radio ie-textleft ie-model="rdChoixCandidat(',aIndiceElection,', ',aIndiceCandidat,')" name="',lNameGroupeRadio,'">','<span class="libelle">',aCandidat.GetLibelle(),'</span>');if(aCandidat.GetGenre()===TypeGenreCandidatElection.GCE_Liste){H.push('<i class="icon icon_info_sign" ie-node="btnAfficherConstitutionListe(',aIndiceElection,', ',aIndiceCandidat,')" ></i>');}
H.push('</ie-checkbox>');return H.join('');}
module.exports=WidgetElections;},fn:"espace/script/widget/widgetelections.js"});;
IE.fModule({f:function(exports,require,module,global){const EGenreDemiJours={Matin:0,ApresMidi:1};module.exports=EGenreDemiJours;},fn:"enumere_demijours.js"});;
IE.fModule({f:function(exports,require,module,global){const Identite=require('ObjetIdentite.js');const MethodesTableau=require('MethodesTableau.js');const{GDate}=require('ObjetDate.js');const GTraductions=require('ObjetTraduction.js');const EGenreDemiJours=require('Enumere_DemiJours.js');const UtilitaireVisios=require('UtilitaireVisiosSco.js').UtilitaireVisios;const GChaine=require('GChaine.js');const ObjetTri=require('ObjetTri.js');class WidgetEnseignementADistance extends Identite{existeWidgetEnseignementADistance(){return!this.donnees||!!this.donnees.actif;}
construire(aParams){this.donnees=aParams.donnees;var lWidget={html:this.composeWidgetEnseignementADistance(),nbrElements:compterNombreLignesWidget(this.donnees),afficherMessage:false};$.extend(true,this.donnees,lWidget);aParams.construireWidget(this.donnees);}
composeLigneEnseignement(aEnseignement){var H=[];if(!!aEnseignement){var lLibelleEnseignement;var lClassEnseignement;if(!aEnseignement.estALaMaison){lLibelleEnseignement=GTraductions.getValeur('accueil.enseignementADistance.enEtablissement');lClassEnseignement='at-school';} else{lLibelleEnseignement=GTraductions.getValeur('accueil.enseignementADistance.aLaMaison');lClassEnseignement='at-home';}
H.push('<li tabindex="0">','<div class="wrap-as-column">');H.push('<div class="wrap">','<div class="date">',aEnseignement.libelleDate,'</div>','<div class="infos-presence ',lClassEnseignement,'">',lLibelleEnseignement.toUpperCase(),'</div>','</div>');if(!!aEnseignement.listeLiensVisio&&aEnseignement.listeLiensVisio.GetNbrElements()>0){aEnseignement.listeLiensVisio.setTri([ObjetTri.init('dateDebutCours')]).trier();H.push('<div class="liste-visios">');aEnseignement.listeLiensVisio.parcourir(function(aLienVisio){if((aLienVisio.estMatin&&!!aEnseignement.estEnseignementMatin)||(!aLienVisio.estMatin&&!!aEnseignement.estEnseignementAprem)){H.push(composeLienVisio(aLienVisio));}});H.push('</div>');}
H.push('</div>','</li>');}
return H.join('');}
composeWidgetEnseignementADistance(){var H=[];H.push('<ul class="one-line">');if(this.donnees&&this.donnees.jours&&(this.donnees.jours.GetNbrElements()>0)){for(var lIdx=0;lIdx<this.donnees.jours.GetNbrElements();lIdx++){var lJour=this.donnees.jours.GetElement(lIdx);var lLibelleDate=GDate.FormatDate(lJour.date,'['+'%JJJ %J %MMM'+']');var lEstALaMaison=false;if(lJour.jourEntier){if(lJour.enEtablissement){lEstALaMaison=false;} else if(lJour.aDistance){lEstALaMaison=true;} else{}
H.push(this.composeLigneEnseignement({libelleDate:lLibelleDate,estALaMaison:lEstALaMaison,listeLiensVisio:lJour.listeVisios,estEnseignementMatin:true,estEnseignementAprem:true}));} else{if(lJour.enEtablissement&&lJour.aDistance){if(MethodesTableau.existe(EGenreDemiJours.Matin,lJour.setOfDJTravaille)){lEstALaMaison=false;} else if(MethodesTableau.existe(EGenreDemiJours.Matin,lJour.setOfDJADistance)){lEstALaMaison=true;} else{}
H.push(this.composeLigneEnseignement({libelleDate:lLibelleDate+' '+GTraductions.getValeur('accueil.enseignementADistance.matin'),estALaMaison:lEstALaMaison,listeLiensVisio:lJour.listeVisios,estEnseignementMatin:true}));if(MethodesTableau.existe(EGenreDemiJours.ApresMidi,lJour.setOfDJTravaille)){lEstALaMaison=false;} else if(MethodesTableau.existe(EGenreDemiJours.ApresMidi,lJour.setOfDJADistance)){lEstALaMaison=true;} else{}
H.push(this.composeLigneEnseignement({libelleDate:lLibelleDate+' '+GTraductions.getValeur('accueil.enseignementADistance.aprem'),estALaMaison:lEstALaMaison,listeLiensVisio:lJour.listeVisios,estEnseignementAprem:true}));} else{if(lJour.enEtablissement){lEstALaMaison=false;} else if(lJour.aDistance){lEstALaMaison=true;} else{}
var lEstCoursMatin=MethodesTableau.existe(EGenreDemiJours.Matin,lJour.setOfDJCours);H.push(this.composeLigneEnseignement({libelleDate:lLibelleDate+' '+(lEstCoursMatin?GTraductions.getValeur('accueil.enseignementADistance.matin'):GTraductions.getValeur('accueil.enseignementADistance.aprem')),estALaMaison:lEstALaMaison,listeLiensVisio:lJour.listeVisios,estEnseignementMatin:lEstCoursMatin,estEnseignementAprem:!lEstCoursMatin}));}}}}
H.push('</ul>');return H.join('');}}
function compterNombreLignesWidget(aDonnees){var lNbLignes=0;if(aDonnees&&aDonnees.jours){aDonnees.jours.parcourir(function(aJourEnseignements){if(aJourEnseignements.jourEntier){lNbLignes++;} else{if(aJourEnseignements.enEtablissement&&aJourEnseignements.aDistance){lNbLignes++;lNbLignes++;} else{lNbLignes++;}}});}
return lNbLignes;}
function composeLienVisio(aLienVisio){var H=[];if(!!aLienVisio&&!!aLienVisio.url){var lLibelleLien;if(!!aLienVisio.libelleLien){lLibelleLien=aLienVisio.libelleLien;}
if(!lLibelleLien){lLibelleLien=GTraductions.getValeur('FenetreSaisieVisiosCours.AccederAuCoursVirtuel');}
H.push('<div class="lien-visio"',(aLienVisio.commentaire?(' title="'+aLienVisio.commentaire+'"'):''),'>','<div class="heure-matiere-conteneur">','<span class="horaires">',GTraductions.getValeur('Dates.DeHeureDebutAHeureFin',[GDate.FormatDate(aLienVisio.dateDebutCours,'%xh%sh%mm'),GDate.FormatDate(aLienVisio.dateFinCours,'%xh%sh%mm')]),'</span>',(aLienVisio.matiere?('<span class="matiere">'+aLienVisio.matiere.GetLibelle()+'</span>'):''),'</div>','<a class="',UtilitaireVisios.getNomIconePresenceVisios(),'" href="',GChaine.verifierURLHttp(aLienVisio.url),'" target="_blank">',lLibelleLien,'</a>','</div>');}
return H.join('');}
module.exports=WidgetEnseignementADistance;},fn:"espace/script/widget/widgetenseignementadistance.js"});;
IE.fModule({f:function(exports,require,module,global){const TypeGenreApiKiosque={Api_AjoutPanier:0,Api_RenduPJTAF:1,Api_EnvoiNote:2};module.exports.TypeGenreApiKiosque=TypeGenreApiKiosque;},fn:"typegenreapikiosque.js"});;
IE.fModule({f:function(exports,require,module,global){const GTraductions=require('ObjetTraduction.js');const GChaine=require('GChaine.js');const GHtml=require('GHtml.js');const GImage=require('ObjetImage.js');const ObjetListeElements=require('ObjetListeElements.js');const ObjetElement=require('ObjetElement.js');const ObjetTri=require('ObjetTri.js');const MethodesObjet=require('MethodesObjet.js');const TypeGenreApiKiosque=require('TypeGenreApiKiosque.js').TypeGenreApiKiosque;const UtilitaireManuelsNumeriques={};UtilitaireManuelsNumeriques.formatDonnees=function(aDonnees,aOptions){const lResult={liste:new ObjetListeElements(),avecCumulMatiere:false};let lMatiere,lNewElm;if(aOptions.avecCumulMatiere){for(let i=0;i<aDonnees.GetNbrElements();i++){const lRessource=aDonnees.GetElement(i);if(lRessource.listeMatieres&&lRessource.listeMatieres.GetNbrElements()>0){for(let j=0;j<lRessource.listeMatieres.GetNbrElements();j++){lMatiere=lRessource.listeMatieres.GetElement(j);lNewElm=MethodesObjet.dupliquer(lRessource);lNewElm.matiere=lMatiere;lResult.avecCumulMatiere=true;lResult.liste.AddElement(lNewElm);}} else{lNewElm=MethodesObjet.dupliquer(lRessource);lNewElm.matiere=new ObjetElement(GTraductions.getValeur('Kiosque.AutresMatieres'),0,-1);lResult.liste.AddElement(lNewElm);}}
const lTris=[
ObjetTri.init(function(D){return D.matiere?!D.matiere.existeNumero():false;}),ObjetTri.init(function(D){return D.matiere?D.matiere.GetLibelle():'';})
];if(!!aOptions.avecNomEditeur){lTris.push(ObjetTri.init('editeur'));}
lTris.push(ObjetTri.init('titre'));lResult.liste.setTri(lTris).trier();} else{lResult.liste=aDonnees;}
return lResult;};UtilitaireManuelsNumeriques.composeListeManuelsNumeriques_Mobile=function(aDonnees,aOptions,aControleur){const lHtml=[];const lDonnees=UtilitaireManuelsNumeriques.formatDonnees(aDonnees,aOptions);let lMatiere;let lRessource;$.extend(aControleur,{nodeDescription:function(aDescription){$(this.node).on({click:function(){if(!!aDescription){GApplication.getMessage().afficher({message:GChaine.ToHTML(GChaine.ajouterEntites(aDescription))});}}});},nodeNonResponsive:function(){$(this.node).on({click:function(){GApplication.getMessage().afficher({message:GChaine.toTitle(GTraductions.getValeur('Kiosque.ContenuNonResponsive'))});}});}});lHtml.push('<ul class="collection with-header bg-white">');if(!!lDonnees.liste&&lDonnees.liste.GetNbrElements()>0){for(let i=0;i<lDonnees.liste.GetNbrElements();i++){lRessource=lDonnees.liste.GetElement(i);if(lDonnees.avecCumulMatiere){if(!lMatiere||(lMatiere.GetNumero()!==lRessource.matiere.GetNumero())){lMatiere=lRessource.matiere;lHtml.push('<li class="collection-header">',GChaine.AvecEspaceSiVide(lMatiere.GetLibelle()),'</li>');}}
const lHtmlManuel=[];lHtml.push('<li class="collection-item with-action">');if(aOptions.avecNomEditeur){lHtmlManuel.push('<div class="manuels-titre-contain">');if(lRessource.logo){lHtmlManuel.push('<div class="logo" ',(lRessource.avecLien?' ie-hint="'+GTraductions.getValeur('CahierDeTexte.avecLien')+'"':''),'>',GImage.composeImage(lRessource.logo),'</div>');}
lHtmlManuel.push('<div class="libelle">',GChaine.Insecable(lRessource.editeur),'</div>');lHtmlManuel.push('</div>');}
lHtmlManuel.push('<div class="manuels-description-contain">');const lAvecApiRenduTAF=!!lRessource&&!!lRessource.apiSupport&&lRessource.apiSupport.contains(TypeGenreApiKiosque.Api_RenduPJTAF);const lAvecApiEnvoiNote=!!lRessource&&!!lRessource.apiSupport&&lRessource.apiSupport.contains(TypeGenreApiKiosque.Api_EnvoiNote);if(aOptions.avecDetailsRessources){if(GEtatUtilisateur.activerKiosqueRenduTAF&&lAvecApiRenduTAF){lHtmlManuel.push('<div style="float:right; width: 16px;" title="',GChaine.toTitle(GTraductions.getValeur('FenetrePanierKiosque.hint.ManuelTAF')),'" class="AlignementMilieuVertical ',(lAvecApiRenduTAF?'Image_Kiosque_ListeCahierTexte AvecMain':''),'"></div>');}
if(GEtatUtilisateur.activerKiosqueEnvoiNote&&lAvecApiEnvoiNote){lHtmlManuel.push('<div style="float:right; width: 16px;" title="',GChaine.toTitle(GTraductions.getValeur('FenetrePanierKiosque.hint.ManuelDevoir')),'" class="AlignementMilieuVertical ',(lAvecApiEnvoiNote?'Image_Kiosque_ListeDevoir AvecMain':''),'"></div>');}}
lHtmlManuel.push('<div class="titre">',lRessource.titre);if(!!lRessource.description){lHtmlManuel.push('<div class="infos" ',GHtml.composeAttr('ie-node','nodeDescription',[lRessource.description]),'><i class="icon_info_sign"></i></div>');}
lHtmlManuel.push('</div></div>');if(lRessource.avecUrlAppliMobile){lHtmlManuel.push('<div class="flex-contain flex-center m-bottom">');lHtmlManuel.push('<div class="fluid-bloc">',GChaine.composerUrlLienExterne({documentJoint:lRessource,title:lRessource.description,libelleEcran:GTraductions.getValeur('Kiosque.OuvrirAppli'),libelle:lRessource.titre,iconeOverride:'icon_th_large',infoSupp:{universalLink:true}}),'</div>');lHtmlManuel.push('</div>');}
lHtmlManuel.push('<div class="manuels-liens-contain">');lHtmlManuel.push('<div class="infos" style="width:20px;"');if(!lRessource.responsive){lHtmlManuel.push(GHtml.composeAttr('ie-node','nodeNonResponsive'),'>');lHtmlManuel.push('<i class="icon_exclamation" style="color:',GCouleur.rougeClair,'"></i>');} else{lHtmlManuel.push('>');}
lHtmlManuel.push('</div>');lHtmlManuel.push('<div>'+GChaine.composerUrlLienExterne({documentJoint:lRessource,title:lRessource.description,libelleEcran:GTraductions.getValeur('Kiosque.OuvrirManuel'),libelle:lRessource.titre,iconeOverride:'icon_book'})+'</div>');lHtmlManuel.push('</div>');lHtml.push(lHtmlManuel.join(''));lHtml.push('</li>');}}
lHtml.push('</ul>');return lHtml.join('');};module.exports=UtilitaireManuelsNumeriques;},fn:"utilitairemanuelsnumeriques.js"});;
IE.fModule({f:function(exports,require,module,global){const{ObjetRequeteConsultation}=require('ObjetRequeteJSON.js');const Requetes=require('CollectionRequetes.js');class ObjetRequetePanierRessourceKiosque extends ObjetRequeteConsultation{constructor(...aParams){super(...aParams);}
lancerRequete(aParametres){$.extend(this.JSON,aParametres);return this.appelAsynchrone();}
actionApresRequete(){this.callbackReussite.appel(this.JSONReponse);}}
Requetes.inscrire('listeRessourceKiosque',ObjetRequetePanierRessourceKiosque);module.exports=ObjetRequetePanierRessourceKiosque;},fn:"objetrequetepanierressourcekiosque.js"});;
IE.fModule({f:function(exports,require,module,global){const GChaine=require('GChaine.js');const EGenreEtat=require('Enumere_Etat.js');const ObjetFenetre=require('ObjetFenetre.js');const GTraductions=require('ObjetTraduction.js');const TypeThemeBouton=require('Type_ThemeBouton.js');const EGenreAction=require('Enumere_Action.js');const EGenreBoiteMessage=require('Enumere_BoiteMessage.js');require('espace/css/ObjetFenetre_EditionRessourceNumerique.css');class ObjetFenetre_EditionRessourceNumerique extends ObjetFenetre{constructor(...aParams){super(...aParams);this.ressourceNumerique;const lOptionsFenetre={titre:GTraductions.getValeur('Fenetre_EditionRessourceNumerique.titre'),largeur:460,hauteurMin:280,listeBoutons:[{libelle:GTraductions.getValeur('Annuler'),theme:TypeThemeBouton.secondaire,action:ObjetFenetre_EditionRessourceNumerique.genreAction.annuler},{libelle:GTraductions.getValeur('Valider'),valider:true,theme:TypeThemeBouton.primaire,action:ObjetFenetre_EditionRessourceNumerique.genreAction.valider}
]};this.boutonOuvrir={libelle:GTraductions.getValeur('Fenetre_EditionRessourceNumerique.ouvrir'),theme:TypeThemeBouton.primaire,action:ObjetFenetre_EditionRessourceNumerique.genreAction.ouvrir};this.boutonSupprimer={libelle:GTraductions.getValeur('Supprimer'),theme:TypeThemeBouton.secondaire,action:ObjetFenetre_EditionRessourceNumerique.genreAction.supprimer};this.setOptionsFenetre(lOptionsFenetre);}
setOptions(aOptions){$.extend(this.options,aOptions);}
getControleur(aInstance){return $.extend(true,super.getControleur(this),{fenetreBtn:{getDisabled:function(aBoutonRepeat){if(aBoutonRepeat.element.action===ObjetFenetre_EditionRessourceNumerique.genreAction.valider){return!aInstance.ressourceNumerique||(aInstance.ressourceNumerique.Etat===EGenreEtat.Aucun);}
return false;}},btnSupprimer:{event:function(){GApplication.getMessage().afficher({type:EGenreBoiteMessage.Confirmation,message:GTraductions.getValeur('Fenetre_EditionRessourceNumerique.suppression')}).then(function(aAccepte){if(aAccepte===EGenreAction.Valider){this.SurValidation(ObjetFenetre_EditionRessourceNumerique.genreAction.supprimer);}}.bind(aInstance));}},btnOuvrir:{event:function(){if(!!aInstance.ressourceNumerique){window.open(GChaine.creerUrlBruteLienExterne(aInstance.ressourceNumerique));}}},titre:{getValue:function(){return aInstance&&aInstance.ressourceNumerique?aInstance.ressourceNumerique.GetLibelle():'';},setValue:function(aValue){if(aInstance&&aInstance.ressourceNumerique&&aInstance.ressourceNumerique.GetLibelle()!==aValue){aInstance.ressourceNumerique.SetLibelle(aValue);aInstance.ressourceNumerique.SetEtat(EGenreEtat.Modification);}},getDisabled:function(){return!aInstance||!aInstance.ressourceNumerique;}},commentaire:{getValue:function(){return aInstance&&aInstance.ressourceNumerique?aInstance.ressourceNumerique.commentaire:'';},setValue:function(aValue){if(aInstance&&aInstance.ressourceNumerique&&aInstance.ressourceNumerique.commentaire!==aValue){aInstance.ressourceNumerique.commentaire=aValue;aInstance.ressourceNumerique.SetEtat(EGenreEtat.Modification);}},getDisabled:function(){return!aInstance||!aInstance.ressourceNumerique;}}});}
SetDonnees(aRessource){this.ressourceNumerique=aRessource;this.Actualiser();this.Afficher();}
ComposeBas(){const H=[];H.push('<span class="OFERN_Obligatoire">* ',GTraductions.getValeur('Fenetre_EditionRessourceNumerique.champObligatoire'),'</span>');if(this.boutonSupprimer){const lBouton=this.boutonSupprimer;H.push('<ie-bouton class="'+lBouton.theme+'"',' ie-model="btnSupprimer">',lBouton.libelle,'</ie-bouton>');}
return H.join('');}
ComposeContenu(){const T=[];T.push('<div class="OFERN_Main">');T.push('<div class="OFERN_LigneTitre"><span>',GTraductions.getValeur('Fenetre_EditionRessourceNumerique.label'),' : *</span><ie-bouton class="'+this.boutonOuvrir.theme+'"',' ie-model="btnOuvrir">',this.boutonOuvrir.libelle,'</ie-bouton></div>');T.push('<div class="OFERN_Titre"><input ie-model="titre" /></div>');T.push('<div class="OFERN_LigneCommentaire">',GTraductions.getValeur('Fenetre_EditionRessourceNumerique.commentaire'),' :</div>');T.push('<div class="OFERN_Commentaire"><textarea ie-model="commentaire"></textarea></div>');T.push('</div>');return T.join('');}
SurValidation(aNumeroBouton){const lResult={genreBouton:aNumeroBouton,ressource:this.ressourceNumerique};this.callback.appel(lResult);this.Fermer();}
static ouvrir(aParams){const lFenetre=ObjetFenetre.creerInstance(ObjetFenetre_EditionRessourceNumerique,{pere:aParams.instance,evenement:aParams.callback});lFenetre.SetDonnees(aParams.ressource);}}
ObjetFenetre_EditionRessourceNumerique.genreAction={annuler:0,valider:1,supprimer:2,ouvrir:3};module.exports=ObjetFenetre_EditionRessourceNumerique;},fn:"objetfenetre_editionressourcenumerique.js"});;
IE.fModule({f:function(exports,require,module,global){const{ObjetRequeteConsultation,ObjetRequeteSaisie}=require('ObjetRequeteJSON.js');const MethodesTableau=require('MethodesTableau.js');const GChaine=require('GChaine.js');const{GDate}=require('ObjetDate.js');const GImage=require('ObjetImage.js');const{Invocateur}=require('Invocateur.js');const MethodesObjet=require('MethodesObjet.js');const _ObjetCommunication=require('_ObjetCommunication.js');const Requetes=require('CollectionRequetes.js');const EGenreEspace=require('Enumere_Espace.js');const EGenreBoiteMessage=require('Enumere_BoiteMessage.js');const EGenreEtat=require('Enumere_Etat.js');const EGenreEvenementListe=require('Enumere_EvenementListe.js');const ObjetFenetre=require('ObjetFenetre.js');const ObjetListe=require('ObjetListe.js');const ObjetListeElements=require('ObjetListeElements.js');const ObjetTri=require('ObjetTri.js');const GTraductions=require('ObjetTraduction.js');const TypeEnsembleNombre=require('TypeEnsembleNombre.js');const EGenreRessource=require('Enumere_Ressource.js');const ObjetRequetePanierRessourceKiosque=require('ObjetRequetePanierRessourceKiosque.js');const TypeGenreApiKiosque=require('TypeGenreApiKiosque.js').TypeGenreApiKiosque;const TypeThemeBouton=require('Type_ThemeBouton.js');const ObjetDonneesListe=require('ObjetDonneesListe.js');const ObjetFenetre_EditionRessourceNumerique=require('ObjetFenetre_EditionRessourceNumerique.js');require('espace/css/ObjetFenetre_ManuelsNumeriques.css');Requetes.inscrire('SaisiePanierRessourceKiosque',ObjetRequeteSaisie);Requetes.inscrire('listeManuelsRessourcesGranulaires',ObjetRequeteConsultation);const cDureeTimerKiosque=20000;class ObjetFenetre_ManuelsNumeriques extends ObjetFenetre{constructor(...aParams){super(...aParams);this.options={avecMultiSelection:false,sansAjouterLien:false,avecRessourcesGranulaire:MethodesTableau.existe(GEtatUtilisateur.GenreEspace,[EGenreEspace.Professeur,EGenreEspace.PrimProfesseur,EGenreEspace.Mobile_Professeur,EGenreEspace.Mobile_PrimProfesseur]),avecNomEditeur:true};this.listeSelectionnes=new ObjetListeElements();this.manuelSelectionne;const lOptionsFenetre={titre:GTraductions.getValeur('FenetrePanierKiosque.titreManuelsNumeriques'),largeur:342,hauteurMin:200,listeBoutons:[{libelle:GTraductions.getValeur('Fermer'),theme:TypeThemeBouton.secondaire,action:ObjetFenetre_ManuelsNumeriques.genreAction.fermer}]};if(this.options.avecRessourcesGranulaire||this.options.modeTest){lOptionsFenetre.largeur=780;lOptionsFenetre.hauteur=540;if(!this.options.sansAjouterLien){lOptionsFenetre.listeBoutons.push({libelle:GTraductions.getValeur('FenetrePanierKiosque.bouton.ajouterLien'),valider:true,theme:TypeThemeBouton.primaire,action:ObjetFenetre_ManuelsNumeriques.genreAction.ajouter});}
lOptionsFenetre.titre=GTraductions.getValeur('FenetrePanierKiosque.titreRessourcesIssuesManuelsNumeriques');}
this.setOptionsFenetre(lOptionsFenetre);}
setOptions(aOptions){$.extend(this.options,aOptions);}
ConstruireInstances(){this.identListeManuels=this.Add(ObjetListe,_evenementListeManuels.bind(this),_initialiserListeManuels.bind(this));this.identListe=this.Add(ObjetListe,_evenementListeRessources.bind(this),_initialiserListeRessources.bind(this));if(this.options.avecRessourcesGranulaire){Invocateur.abonner('notification_Kiosque',this._notificationKiosque,this);}}
DetruireInstances(){if(this.options.avecRessourcesGranulaire){Invocateur.desabonner('notification_Kiosque',this);GApplication.getCommunication().setDureeTimerPresence(_ObjetCommunication.cDureeTimerPresence);}}
_notificationKiosque(){this.actualiserRessourcesGranulaire();GApplication.getCommunication().setDureeTimerPresence(_ObjetCommunication.cDureeTimerPresence);}
getControleur(aInstance){return $.extend(true,super.getControleur(this),{fenetreBtn:{getDisabled:function(aBoutonRepeat){if(aBoutonRepeat.element.action===ObjetFenetre_ManuelsNumeriques.genreAction.ajouter){return!aInstance._mettreAJourBoutonAjouter();}
return false;}},execManuel:function(aNumero){$(this.node).eventValidation(function(){const lManuel=aInstance.listeManuels.GetElementParNumero(aNumero);_actionSelectionManuel.call(aInstance,lManuel);$(this).siblings().removeClass('mn-selected');$(this).addClass('mn-selected');});},getClass:function(){const lClass=['OFManuelsNumeriques'];if(aInstance.options.avecRessourcesGranulaire||aInstance.options.modeTest){lClass.push('avecRessources');} else{lClass.push('sansRessources');}
return lClass.join(' ');},btnNouveau:{event:function(){if(aInstance.manuelSelectionne&&(aInstance.manuelSelectionne.GetGenre()===EGenreRessource.RessourceNumeriqueKiosque)){GApplication.getCommunication().setDureeTimerPresence(cDureeTimerKiosque);window.open(GChaine.creerUrlBruteLienExterne(aInstance.manuelSelectionne));}},getDisabled:function(){return!aInstance.manuelSelectionne||aInstance.manuelSelectionne.GetGenre()!==EGenreRessource.RessourceNumeriqueKiosque;}},btnActualiser:{event:function(){if(aInstance.manuelSelectionne){aInstance.actualiserRessourcesGranulaire();}},getDisabled:function(){return!aInstance.manuelSelectionne;}}});}
afficherFenetre(aParams){this.listeManuels=aParams.listeManuels;if(!!aParams.manuel){this.manuelSelectionne=aParams.manuel;}
this.genresApiKiosque=aParams.genresApiKiosque||new TypeEnsembleNombre();this.pouriDevoir=this.genresApiKiosque.contains(TypeGenreApiKiosque.Api_EnvoiNote)&&GEtatUtilisateur.activerKiosqueEnvoiNote;this.pourExerciceNum=this.genresApiKiosque.contains(TypeGenreApiKiosque.Api_RenduPJTAF)&&GEtatUtilisateur.activerKiosqueRenduTAF;this.actualiserDonneesKiosque(true);}
actualiserDonneesKiosque(){if(this.options.avecRessourcesGranulaire){Requetes('listeManuelsRessourcesGranulaires',this).lancerRequete({genresApi:this.genresApiKiosque}).then(function(aJSON){this.listeManuels=aJSON.listeRessources;new ObjetRequetePanierRessourceKiosque(this,this.apresRequeteDonnees).lancerRequete({genresApi:new TypeEnsembleNombre()});}.bind(this));} else{this.apresRequeteDonnees();}}
actualiserRessourcesGranulaire(){if(this.options.avecRessourcesGranulaire){new ObjetRequetePanierRessourceKiosque(this,this.apresActualisationDonnees).lancerRequete({genresApi:new TypeEnsembleNombre()});}}
apresActualisationDonnees(aJSON){this.listeRessourcesGranulaire=new ObjetListeElements();if(aJSON){this.listeRessourcesGranulaire=new ObjetListeElements();this.listeRessourceKiosque=aJSON.listeRessourceKiosque;this.listeRessourceKiosque.parcourir(function(aElement,aIndice,alisteRessourceKiosque){aElement.estSelectionne=false;if(!!aElement.pere){const lPere=alisteRessourceKiosque.GetElementParGenre(aElement.pere.GetGenre());aElement.pere=lPere;if(aElement.ressource){const lRessourcePere=lPere&&lPere.ressource?lPere.ressource:null;const lRessource=MethodesObjet.dupliquer(aElement.ressource);lRessource.pere=lRessourcePere;lRessource.estDeGenreApi=_estDeGenreApi.call(this,lRessource);this.listeRessourcesGranulaire.AddElement(lRessource);}} else{aElement.estUnDeploiement=true;aElement.estDeploye=true;}}.bind(this));}
_actionSelectionManuel.call(this,this.manuelSelectionne);}
apresRequeteDonnees(aJSON){const lObj={listeRessourceKiosque:null,message:'',listeRessourcesGranulaire:new ObjetListeElements(),ressourcesSansManuel:null};if(aJSON){lObj.message=aJSON.message;lObj.listeRessourceKiosque=aJSON.listeRessourceKiosque;lObj.listeRessourceKiosque.parcourir(function(aObj,aElement,aIndice,alisteRessourceKiosque){aElement.estSelectionne=false;if(!!aElement.pere){const lPere=alisteRessourceKiosque.GetElementParGenre(aElement.pere.GetGenre());aElement.pere=lPere;if(aElement.ressource){const lRessourcePere=lPere&&lPere.ressource?lPere.ressource:null;const lRessource=MethodesObjet.dupliquer(aElement.ressource);lRessource.pere=lRessourcePere;lRessource.estDeGenreApi=_estDeGenreApi.call(this,lRessource);aObj.listeRessourcesGranulaire.AddElement(lRessource);if(!aObj.ressourcesSansManuel&&lRessourcePere&&lRessourcePere.GetGenre()===EGenreRessource.Aucune){aObj.ressourcesSansManuel=MethodesObjet.dupliquer(lPere.ressource);aObj.ressourcesSansManuel.titre=GTraductions.getValeur('FenetrePanierKiosque.anciensManuels');}}} else{aElement.estUnDeploiement=true;aElement.estDeploye=true;}}.bind(this,lObj));}
this.SetDonnees(lObj);}
SetDonnees(aParam){if(aParam.message){const lThis=this;GApplication.getMessage().afficher({type:EGenreBoiteMessage.Information,message:aParam.message,callback:function(){lThis.callback.appel(0);}});} else{this.listeRessourceKiosque=aParam.listeRessourceKiosque;this.listeRessourcesGranulaire=aParam.listeRessourcesGranulaire;if(aParam.ressourcesSansManuel){this.listeManuels.add(aParam.ressourcesSansManuel);}
if(!this._actualisationDesDonnees){this.Actualiser();this.Afficher();this.listeManuels.setTri([ObjetTri.init(function(D){return D.GetGenre()===EGenreRessource.Aucune?2:1;}),ObjetTri.init('Genre'),ObjetTri.init('Libelle')]);this.listeManuels.trier();this.GetInstance(this.identListeManuels).SetDonnees(new DonneesListe_ManuelsNumeriques(this.listeManuels,this));if(!this.manuelSelectionne&&this.options.avecRessourcesGranulaire&&this.listeManuels.GetNbrElements()>0){this.manuelSelectionne=this.listeManuels.GetElement(0);}
if(!!this.manuelSelectionne){const lIndice=this.listeManuels.GetIndiceParElement(this.manuelSelectionne);if((lIndice> -1)&&(lIndice!==null)&&(lIndice!==undefined)){this.GetInstance(this.identListeManuels).SelectionnerLigne({ligne:lIndice,avecScroll:true,avecEvenement:true});}}} else{this._actualisationDesDonnees=undefined;}
this.SetBoutonActif(1,false);}}
ComposeContenu(){const T=[];T.push('<div ie-class="getClass">');T.push('<div class="OFMN_InfoAjout">',GChaine.ToHTML(GTraductions.getValeur('FenetrePanierKiosque.infoAjoutRessourcesGranulaires',['<i class="icon_exercice_numerique"></i>'])),'</div>');T.push('<div class="OFMN_SectionListes">');T.push('  <div class="OFMN_SectionManuels" id="',this.GetInstance(this.identListeManuels).GetNom(),'">','</div>');T.push('  <div class="OFMN_SectionRessourcesGranulaires">');T.push('    <div class="OFMN_SectionBoutons">');T.push(_createIEBoutonImage({libelle:GTraductions.getValeur('FenetrePanierKiosque.ajouterUneRessource'),ieModel:'btnNouveau',ieIcon:'icon_nouveau_qcm'}));T.push(_createIEBoutonImage({libelle:GTraductions.getValeur('FenetrePanierKiosque.actualiser'),ieModel:'btnActualiser',ieIcon:'icon_refresh'}));T.push('    </div>');T.push('    <div class="OFMN_SectionListe" id="',this.GetInstance(this.identListe).GetNom(),'"></div>');T.push('  </div>');T.push('</div>');T.push('</div>');return T.join('');}
composeManuels(){const T=[];if(this.listeManuels){T.push('<ul role="list" class="liste-clickable grouped-like">');this.listeManuels.parcourir(function(aElement){T.push(_composeManuel.call(this,aElement));}.bind(this));T.push('</ul>');}
return T.join('');}
SurValidation(aNumeroBouton){const lResult={genreBouton:aNumeroBouton,liste:this.listeRessourcesGranulaire,selection:this.listeSelectionnes};this.callback.appel(lResult);this.Fermer();}
apresRequeteSaisie(){this._actualisationDesDonnees=true;this.actualiserRessourcesGranulaire();}
_mettreAJourBoutonAjouter(){const lActif=this.options.avecMultiSelection?this.listeSelectionnes.GetNbrElements()>0:this.listeSelectionnes.GetNbrElements()===1;if(this.options.avecMultiSelection){let lLibelle=GTraductions.getValeur('FenetrePanierKiosque.bouton.ajouterLien');if(this.listeSelectionnes.GetNbrElements()>1){lLibelle=GTraductions.getValeur('FenetrePanierKiosque.bouton.ajouterLiens',[this.listeSelectionnes.GetNbrElements()]);}
this.setBoutonLibelle(1,lLibelle);}
return lActif;}
static ouvrir(aParams){const lFenetre=ObjetFenetre.creerInstance(ObjetFenetre_ManuelsNumeriques,{pere:aParams.instance,evenement:aParams.callback});if(aParams.sansAjouterLien){lFenetre.setOptions({sansAjouterLien:true});const lOptionsFenetre={listeBoutons:[{libelle:GTraductions.getValeur('Fermer'),theme:TypeThemeBouton.secondaire,action:ObjetFenetre_ManuelsNumeriques.genreAction.fermer}]};if(lFenetre.options.avecRessourcesGranulaire||lFenetre.options.modeTest){if(!lFenetre.options.sansAjouterLien){lOptionsFenetre.listeBoutons.push({libelle:GTraductions.getValeur('FenetrePanierKiosque.bouton.ajouterLien'),valider:true,theme:TypeThemeBouton.primaire,action:ObjetFenetre_ManuelsNumeriques.genreAction.ajouter});}}
lFenetre.setOptionsFenetre(lOptionsFenetre);}
lFenetre.afficherFenetre(aParams);}}
ObjetFenetre_ManuelsNumeriques.genreAction={fermer:0,ajouter:1};function _initialiserListeManuels(aInstance){const lColonnes=[{id:'',taille:'100%'}
];aInstance.setOptionsListe({colonnes:lColonnes,skin:ObjetListe.skin.alternance,hauteurZoneContenuListeMin:100,hauteurAdapteContenu:!(this.options.avecRessourcesGranulaire||this.options.modeTest),hauteurMaxAdapteContenu:400,piedDeListe:{}});}
function _evenementListeManuels(aParametres){switch(aParametres.genreEvenement){case EGenreEvenementListe.Selection:{const lManuel=this.listeManuels.GetElementParNumero(aParametres.article.GetNumero());_actionSelectionManuel.call(this,lManuel);break;}}}
function _actionSelectionManuel(aManuel){this.manuelSelectionne=aManuel;if(this.options.avecRessourcesGranulaire||this.options.modeTest){this.listeAffRessourcesGranulaire=this.listeRessourcesGranulaire.getListeElements(function(aElement){return aElement.pere.GetGenre()===this.GetGenre()&&aElement.pere.GetNumero()===this.GetNumero();}.bind(this.manuelSelectionne));this.GetInstance(this.identListe).SetDonnees(new DonneesListe_Ressources(this.listeAffRessourcesGranulaire,{instance:this,avecMultiSelection:this.options.avecMultiSelection}));} else{window.open(GChaine.creerUrlBruteLienExterne(aManuel));}}
function _initialiserListeRessources(aInstance){const lColonnes=[{id:DonneesListe_Ressources.colonnes.description,taille:'100%'},{id:DonneesListe_Ressources.colonnes.icon,taille:26},{id:DonneesListe_Ressources.colonnes.date,taille:80}];aInstance.setOptionsListe({colonnes:lColonnes,skin:ObjetListe.skin.alternance,hauteurAdapteContenu:false,nonEditable:false});}
function _evenementFenetreEdition(aParams){switch(aParams.genreBouton){case ObjetFenetre_EditionRessourceNumerique.genreAction.valider:if(!!aParams.ressource){const lListeATraiter=new ObjetListeElements();const lRessource=this.listeRessourcesGranulaire.GetElementParNumero(aParams.ressource.GetNumero());if(!!lRessource){lRessource.SetLibelle(aParams.ressource.GetLibelle());lRessource.commentaire=aParams.ressource.commentaire;lRessource.SetEtat(EGenreEtat.Modification);lListeATraiter.AddElement(lRessource);lListeATraiter.setSerialisateurJSON({methodeSerialisation:_serialiserRessource.bind(this)});Requetes('SaisiePanierRessourceKiosque',this,this.apresRequeteSaisie).lancerRequete({ressources:lListeATraiter});}}
break;case ObjetFenetre_EditionRessourceNumerique.genreAction.supprimer:if(!!aParams.ressource){const lListeASupprimer=new ObjetListeElements();aParams.ressource.SetEtat(EGenreEtat.Suppression);lListeASupprimer.AddElement(aParams.ressource);_suppressionRessources.call(this,lListeASupprimer);}
break;default:break;}}
function _suppressionRessources(aListeASupprimer){Requetes('SaisiePanierRessourceKiosque',this,this.apresRequeteSaisie).lancerRequete({ressources:aListeASupprimer});}
function _evenementListeRessources(aParametres){switch(aParametres.genreEvenement){case EGenreEvenementListe.Selection:this.listeSelectionnes=this.GetInstance(this.identListe).getListeElementsSelection();this._mettreAJourBoutonAjouter();break;case EGenreEvenementListe.Edition:if(!!aParametres.article){const lRessource=MethodesObjet.dupliquer(aParametres.article);ObjetFenetre_EditionRessourceNumerique.ouvrir({ressource:lRessource,instance:this,callback:_evenementFenetreEdition.bind(this)});}
break;case EGenreEvenementListe.Suppression:{const lListeASupprimer=new ObjetListeElements();aParametres.listeSuppressions.parcourir(function(aElement){if(!!aElement&&(aElement.GetGenre()===EGenreRessource.PanierRessourceKiosque)){aElement.SetEtat(EGenreEtat.Suppression);this.AddElement(aElement);}}.bind(lListeASupprimer));_suppressionRessources.call(this,lListeASupprimer);return EGenreEvenementListe.Suppression;}}}
function _estDeGenreApi(aRessource){let lResult=false;if(this.pouriDevoir){lResult=aRessource.apiSupport.contains(TypeGenreApiKiosque.Api_EnvoiNote);}
if(!lResult&&this.pourExerciceNum){lResult=aRessource.apiSupport.contains(TypeGenreApiKiosque.Api_RenduPJTAF);}
if(!lResult&&this.genresApiKiosque.contains(TypeGenreApiKiosque.Api_AjoutPanier)&&aRessource.apiSupport.contains(TypeGenreApiKiosque.Api_AjoutPanier)){if(!this.pouriDevoir&&!this.pourExerciceNum){lResult=!aRessource.apiSupport.contains(TypeGenreApiKiosque.Api_EnvoiNote)&&!aRessource.apiSupport.contains(TypeGenreApiKiosque.Api_RenduPJTAF);} else{lResult=true;}}
return lResult;}
function _createIEBoutonImage(aParam){let lPosition='';if(aParam.estADroit){lPosition=' style="margin-left: auto;"';}
const H=['<ie-bouton class="MargeDroit AlignementMilieuVertical bouton-carre" ie-model="',aParam.ieModel,'" ie-icon="',aParam.ieIcon,'" ie-iconsize="2.4rem"',(aParam.ieSelecFile?' ie-selecfile':''),lPosition,'>',aParam.libelle,'</ie-bouton>'];return H.join('');}
function _composeManuel(aManuel){const T=[];if(aManuel.GetGenre()===EGenreRessource.Aucune){T.push('<div class="OFMN_Manuel SansManuel" ie-hint="',GChaine.toTitle(GTraductions.getValeur('FenetrePanierKiosque.infoAnciensManuels')),'">');T.push(aManuel.titre);T.push('</div>');} else{T.push('<div class="OFMN_Manuel">');if(this.options.avecNomEditeur){T.push('<span ');if(aManuel.logo){if(aManuel.avecLien){T.push(' ie-hint="'+GTraductions.getValeur('CahierDeTexte.avecLien')+'"');}
T.push(' class="logo-contain">',GImage.composeImage(aManuel.logo));} else{T.push(' class="libelle-contain">',GChaine.Insecable(aManuel.editeur));}
T.push('</span>');}
T.push('<div class="contain-wrapper" title="',GChaine.toTitle(aManuel.description),'" >','<span>',aManuel.titre,'</span>');T.push('</div>');T.push('</div>');}
return T.join('');}
function _serialiserRessource(aElement,aJSON){aJSON.commentaire=aElement.commentaire;}
class DonneesListe_ManuelsNumeriques extends ObjetDonneesListe{constructor(aDonnees,aInstance){super(aDonnees);this.instance=aInstance;this.setOptions({avecEdition:false,avecSuppression:false,avecEvnt_Selection:true});}
GetValeur(I,D,aParams){return _composeManuel.call(this.instance,aParams.article);}}
class DonneesListe_Ressources extends ObjetDonneesListe{constructor(aDonnees,aParam){super(aDonnees);this.instance=aParam.instance;this.setOptions({avecEdition:true,avecSuppression:true,avecEvnt_Suppression:true,avecEvnt_Selection:true,avecEvnt_Edition:true,alignVCenter:true,editionApresSelection:true});}
GetTypeValeur(){return ObjetDonneesListe.ETypeCellule.Html;}
avecBordureDroite(){return false;}
avecBordureBas(){return false;}
GetValeur(I,D,aParams){switch(aParams.idColonne){case DonneesListe_Ressources.colonnes.description:{const lHtmlText=[];if(!!aParams.article){lHtmlText.push('<div class="OFMN_Ressource">');lHtmlText.push('<div class="OFMN_Ressource_Titre">',aParams.article.GetLibelle(),'</div>');lHtmlText.push('<div class="OFMN_Ressource_Commentaire">',GChaine.ToHTML(aParams.article.commentaire),'</div>');lHtmlText.push('</div>');}
return lHtmlText.join('');}
case DonneesListe_Ressources.colonnes.icon:{const lHtmlIcon=[];lHtmlIcon.push('<div class="OFMN_Icon">');if(GEtatUtilisateur.activerKiosqueRenduTAF&&aParams.article.apiSupport.contains(TypeGenreApiKiosque.Api_RenduPJTAF)){const lIcon=GEtatUtilisateur.pourPrimaire()?'icon_work':'icon_home';lHtmlIcon.push('<i class="material-icons ',lIcon,'"></i>');}
if(GEtatUtilisateur.activerKiosqueEnvoiNote&&aParams.article.apiSupport.contains(TypeGenreApiKiosque.Api_EnvoiNote)){lHtmlIcon.push('<i class="material-icons icon_saisie_note"></i>');}
lHtmlIcon.push('</div>');return lHtmlIcon.join('');}
case DonneesListe_Ressources.colonnes.date:{let lStrDate='';if(!!aParams.article&&!!aParams.article.dateAjout){lStrDate='<div class="OFMN_Date">'+GDate.FormatDate(aParams.article.dateAjout,'[%JJ/%MM/%AAAA]')+'</div>';}
return lStrDate;}}
return'';}}
DonneesListe_Ressources.colonnes={description:"ofmn_Description",icon:"ofmn_icon",date:"ofmn_date"};module.exports=ObjetFenetre_ManuelsNumeriques;},fn:"objetfenetre_manuelsnumeriques.js"});;
IE.fModule({f:function(exports,require,module,global){const IEHtml=require('IEHtml.js');const GHtml=require('GHtml.js');const GStyle=require('GStyle.js');require('IEHtml.BtnImage.js');const GTraductions=require('ObjetTraduction.js');IEHtml.addAttribut('ie-mrfiche',function(aContexteCourant,aNodeName,aAttributValue,aOutils){_creerMrFiche(aContexteCourant,aNodeName,aAttributValue,aOutils,{class:'icon_question btnImageIcon'});});IEHtml.addAttribut('ie-mrficheblanc',function(aContexteCourant,aNodeName,aAttributValue,aOutils){_creerMrFiche(aContexteCourant,aNodeName,aAttributValue,aOutils,{class:'Image_MrFicheFenetre',width:18});});IEHtml.addAttribut('ie-mrfichewidget',function(aContexteCourant,aNodeName,aAttributValue,aOutils){_creerMrFiche(aContexteCourant,aNodeName,aAttributValue,aOutils,{class:'icon as-button bt-widget icon_info_widget btnImageIcon'});});function _creerMrFiche(aContexteCourant,aNodeName,aAttributValue,aOutils,aImage){if(!aAttributValue){return true;}
;const lControleur={btnMrFiche:{event:function(){const lNode=this.node;GApplication.getMessage().afficher({idRessource:aAttributValue}).then(function(){GHtml.setFocus(lNode);});}}};const H=['<ie-btnimage ie-model="btnMrFiche" class="'+aImage.class+' AvecMain"',' style="',GStyle.composeWidth(aImage.width),'"',GHtml.composeAttr('title',GTraductions.getTitreMFiche(aAttributValue)),'></ie-btnimage>'
];aOutils.addCommentaireDebug(aContexteCourant.node,'ie-mrfiche="'+aAttributValue+'"');aOutils.injectHTML({element:aContexteCourant.node,html:H.join(''),controleur:lControleur,ignorerScroll:true,contexte:aContexteCourant.contexte});return{node:aContexteCourant.node,avecCompileFils:false};}
module.exports=IEHtml;},fn:"iehtml.mrfiche.js"});;
IE.fModule({f:function(exports,require,module,global){const GChaine=require('GChaine.js');const Identite=require('ObjetIdentite.js');const GImage=require('ObjetImage.js');const GTraductions=require('ObjetTraduction.js');const EGenreEspace=require('Enumere_Espace.js');const EGenreOnglet=require('Enumere_Onglet.js');const TypeGenreApiKiosque=require('TypeGenreApiKiosque.js').TypeGenreApiKiosque;const MethodesTableau=require('MethodesTableau.js');const UtilitaireManuelsNumeriques=require('UtilitaireManuelsNumeriques.js');const TypeEnsembleNombre=require('TypeEnsembleNombre.js');const ObjetFenetre_ManuelsNumeriques=require('ObjetFenetre_ManuelsNumeriques.js');require('IEHtml.MrFiche.js');class WidgetKiosque extends Identite{constructor(...aParams){super(...aParams);}
initialiserObjetsKiosque(){}
_notificationKiosque(){this.RecupererDonnees([this.donnees.genre]);}
construire(aParams){this.donnees=aParams.donnees;this.optionsKiosque={avecNomEditeur:MethodesTableau.existe(GEtatUtilisateur.GenreEspace,[EGenreEspace.Professeur,EGenreEspace.PrimProfesseur,EGenreEspace.Mobile_Professeur,EGenreEspace.Mobile_PrimProfesseur]),avecDetailsRessources:MethodesTableau.existe(GEtatUtilisateur.GenreEspace,[EGenreEspace.Professeur,EGenreEspace.PrimProfesseur,EGenreEspace.Mobile_Professeur,EGenreEspace.Mobile_PrimProfesseur]),avecPanierRessources:MethodesTableau.existe(GEtatUtilisateur.GenreEspace,[EGenreEspace.PrimProfesseur]),avecInformationNonResponsive:IE.estMobile,avecCumulMatiere:MethodesTableau.existe(GEtatUtilisateur.GenreEspace,[EGenreEspace.Eleve,EGenreEspace.PrimEleve,EGenreEspace.Parent,EGenreEspace.PrimParent,EGenreEspace.Accompagnant,EGenreEspace.PrimAccompagnant,EGenreEspace.Mobile_Eleve,EGenreEspace.Mobile_PrimEleve,EGenreEspace.Mobile_Parent,EGenreEspace.Mobile_PrimParent,EGenreEspace.Mobile_Accompagnant,EGenreEspace.Mobile_PrimAccompagnant,EGenreEspace.Tuteur,EGenreEspace.Mobile_Tuteur])};var lWidget={html:this.composeWidgetKiosque(),nbrElements:this.donnees.listeRessources.GetNbrElements(),afficherMessage:false,listeElementsGraphiques:[{htmlMrFiche:'<span class="as-mrfiche" ie-mrfichewidget="accueil.kiosques.mrFiche"></span>'}
]};$.extend(true,this.donnees,lWidget);aParams.construireWidget(this.donnees);this.initialiserObjetsKiosque();}
composeWidgetKiosque(){if(this.modeAncien||!GEtatUtilisateur.pourPrimaire()){return this.composeWidgetKiosque_New();} else{return this.composeWidgetKiosque_New();}}
getControleur(){return $.extend(true,super.getControleur(this),{nodeNonResponsive:function(){$(this.node).on({click:function(aEvent){GApplication.getMessage().afficher({message:GChaine.toTitle(GTraductions.getValeur('Kiosque.ContenuNonResponsive'))});aEvent.stopPropagation();}});},nodeMessageHint:function(aMessage){$(this.node).on({click:function(aEvent){var lMessage=GChaine.ToHTML(GChaine.ajouterEntites(aMessage));GApplication.getMessage().afficher({message:lMessage});aEvent.stopPropagation();}});}});}
composeWidgetKiosque_New(){var lDonnees=UtilitaireManuelsNumeriques.formatDonnees(this.donnees.listeRessources,this.optionsKiosque);var H=[],lMatiere,lRessource,i,lLien;for(i=0;i<lDonnees.liste.GetNbrElements();i++){lRessource=lDonnees.liste.GetElement(i);if(lRessource.matiere&&lRessource.matiere.existeNumero()){lDonnees.avecCumulMatiere=true;}}
H.push('<ul role="list" class="liste-clickable">');for(i=0;i<lDonnees.liste.GetNbrElements();i++){lRessource=lDonnees.liste.GetElement(i);if(lDonnees.avecCumulMatiere){if(!lMatiere||(lMatiere.GetNumero()!==lRessource.matiere.GetNumero())){lMatiere=lRessource.matiere;H.push('<li aria-level="4" class="has-title">','<h4>',GChaine.AvecEspaceSiVide(lRessource.matiere.GetLibelle()),'</h4>','</li>');}}
lLien=GChaine.creerUrlBruteLienExterne(lRessource,{forcerURLComplete:true});H.push('<li tabIndex="0" role="link" onclick="window.open(\'',lLien,'\')" onkeyup="if(GNavigateur.IsToucheSelection())window.open(\'',lLien,'\')"'+(!this.optionsKiosque.avecNomEditeur?' class="has-bullet"':'')+'>');if(this.optionsKiosque.avecNomEditeur){H.push('<span ');if(lRessource.logo){if(lRessource.avecLien){H.push(' ie-hint="'+GTraductions.getValeur('CahierDeTexte.avecLien')+'"');}
H.push(' class="logo-contain">',GImage.composeImage(lRessource.logo));} else{H.push(' class="libelle-contain">',GChaine.Insecable(lRessource.editeur));}
H.push('</span>');}
H.push('<div class="contain-wrapper">','<a class="link-as-wrapper" title="',GChaine.toTitle(lRessource.description),'" >','<span'+(!this.optionsKiosque.avecNomEditeur?' class="with-bullet"':'')+'>',lRessource.titre,'</span></a>');H.push('</div>');var lAvecApiAjout=!!lRessource&&!!lRessource.apiSupport&&lRessource.apiSupport.contains(TypeGenreApiKiosque.Api_AjoutPanier);var lAvecApiRenduTAF=!!lRessource&&!!lRessource.apiSupport&&lRessource.apiSupport.contains(TypeGenreApiKiosque.Api_RenduPJTAF)&&GEtatUtilisateur.activerKiosqueRenduTAF;var lAvecApiEnvoiNote=!!lRessource&&!!lRessource.apiSupport&&lRessource.apiSupport.contains(TypeGenreApiKiosque.Api_EnvoiNote)&&GEtatUtilisateur.activerKiosqueEnvoiNote;var lNbrApiAjout=0,lNbrApiRenduTAF=0,lNbrApiEnvoiNote=0;if(lAvecApiAjout&&lRessource.listeRessourcesAtomiques){for(var k=0;k<lRessource.listeRessourcesAtomiques.GetNbrElements();k++){var lElement=lRessource.listeRessourcesAtomiques.GetElement(k);if(lElement.apiSupport&&lElement.apiSupport.contains(TypeGenreApiKiosque.Api_AjoutPanier)){lNbrApiAjout++;}
if(lElement.apiSupport&&lElement.apiSupport.contains(TypeGenreApiKiosque.Api_RenduPJTAF)){lNbrApiRenduTAF++;}
if(lElement.apiSupport&&lElement.apiSupport.contains(TypeGenreApiKiosque.Api_EnvoiNote)){lNbrApiEnvoiNote++;}}}
if(this.optionsKiosque.avecDetailsRessources&&(lAvecApiAjout||lAvecApiRenduTAF||lAvecApiEnvoiNote)){var lIcon=GEtatUtilisateur.pourPrimaire()?'icon_work':'icon_home';var lHint=[];lHint.push('<div class="infobulle-kiosque">');var lTtitre=lNbrApiAjout>0?GTraductions.getValeur('WidgetKiosque.infoRessourcesExtrait.titre',[lNbrApiAjout]):GTraductions.getValeur('WidgetKiosque.infoRessourcesExtrait.aucune');lHint.push('<div class="infobulle-titre"><i class="material-icons icon_taf"></i> ',lTtitre,'</div>');if(lAvecApiRenduTAF||lAvecApiEnvoiNote){lHint.push('<div>',GTraductions.getValeur('WidgetKiosque.infoRessourcesExtrait.type'),'</div>');if(lAvecApiRenduTAF){var lTypeTAF=GEtatUtilisateur.pourPrimaire()?GTraductions.getValeur('WidgetKiosque.infoRessourcesExtrait.tafpp'):GTraductions.getValeur('WidgetKiosque.infoRessourcesExtrait.taf');lHint.push('<div class="infobulle-type"><i class="material-icons ',lIcon,'"></i> ',lTypeTAF,((lNbrApiAjout>0)?' : '+lNbrApiRenduTAF:''),'</div>');}
if(lAvecApiEnvoiNote){lHint.push('<div class="infobulle-type"><i class="material-icons icon_saisie_note"></i> ',GTraductions.getValeur('WidgetKiosque.infoRessourcesExtrait.idevoir'),((lNbrApiAjout>0)?' : '+lNbrApiEnvoiNote:''),'</div>');}}
lHint.push('</div>');var lEventPanier=this.optionsKiosque.avecPanierRessources?'onclick="'+this.Nom+'._evntPanier(\''+lRessource.GetNumero()+'\'); event.stopPropagation();"':'';var lNode='';H.push('<div class="summary-wrapper" ie-hint="',GChaine.toTitle(lHint.join('')),'" ',lNode,lEventPanier,'>');var lClassSummary=['item-summary'];if(this.optionsKiosque.avecPanierRessources){lClassSummary.push('with-action');}
if(lAvecApiAjout){H.push('<div class="',lClassSummary.join(' '),'">');H.push('<i class="material-icons icon_taf"></i>');if(lNbrApiAjout>0){H.push('<span>'+lNbrApiAjout+'</span>');}
H.push('</div>');}
if(lAvecApiRenduTAF){H.push('<div class="',lClassSummary.join(' '),'">');H.push('<i class="material-icons ',lIcon,'"></i>');if(lNbrApiRenduTAF>0){H.push('<span>'+lNbrApiRenduTAF+'</span>');}
H.push('</div>');}
if(lAvecApiEnvoiNote){H.push('<div class="',lClassSummary.join(' '),'">');H.push('<i class="material-icons icon_saisie_note"></i>');if(lNbrApiEnvoiNote>0){H.push('<span>'+lNbrApiEnvoiNote+'</span>');}
H.push('</div>');}
H.push('</div>');}
H.push('</li>');}
H.push('</ul>');return H.join('');}
composeWidgetKiosque_Old(){var lDonnees=UtilitaireManuelsNumeriques.formatDonnees(this.donnees.listeRessources,this.optionsKiosque);var H=[],lMatiere,lRessource,i,lLien;for(i=0;i<lDonnees.liste.GetNbrElements();i++){lRessource=lDonnees.liste.GetElement(i);if(lRessource.matiere&&lRessource.matiere.existeNumero()){lDonnees.avecCumulMatiere=true;}}
H.push('<ul role="list" class="liste-clickable grouped-like">');for(i=0;i<lDonnees.liste.GetNbrElements();i++){lRessource=lDonnees.liste.GetElement(i);if(lDonnees.avecCumulMatiere){if(!lMatiere||(lMatiere.GetNumero()!==lRessource.matiere.GetNumero())){lMatiere=lRessource.matiere;H.push('<li aria-level="4" class="has-title">','<h4>',GChaine.AvecEspaceSiVide(lRessource.matiere.GetLibelle()),'</h4>','</li>');}}
lLien=GChaine.creerUrlBruteLienExterne(lRessource);H.push('<li role="link" tabIndex="0" onclick="window.open(\'',lLien,'\')" onkeyup="if(GNavigateur.IsToucheSelection())window.open(\'',lLien,'\')"'+(!this.optionsKiosque.avecNomEditeur?' class="has-bullet"':'')+'>');if(this.optionsKiosque.avecNomEditeur){H.push('<span ');if(lRessource.logo){if(lRessource.avecLien){H.push(' ie-hint="'+GTraductions.getValeur('CahierDeTexte.avecLien')+'"');}
H.push(' class="logo-contain">',GImage.composeImage(lRessource.logo));} else{H.push(' class="libelle-contain">',GChaine.Insecable(lRessource.editeur));}
H.push('</span>');}
H.push('<div class="contain-wrapper">','<a class="link-as-wrapper" title="',GChaine.toTitle(lRessource.description),'" >','<span'+(!this.optionsKiosque.avecNomEditeur?' class="with-bullet"':'')+'>',lRessource.titre,'</span></a>');var lAvecApiRenduTAF=!!lRessource&&!!lRessource.apiSupport&&lRessource.apiSupport.contains(TypeGenreApiKiosque.Api_RenduPJTAF);var lAvecApiEnvoiNote=!!lRessource&&!!lRessource.apiSupport&&lRessource.apiSupport.contains(TypeGenreApiKiosque.Api_EnvoiNote);if(this.optionsKiosque.avecDetailsRessources){if(GEtatUtilisateur.activerKiosqueRenduTAF){H.push('<span',(lAvecApiRenduTAF?' title="'+GChaine.toTitle(GTraductions.getValeur('FenetrePanierKiosque.hint.ManuelTAF'))+'" ':''),(lAvecApiRenduTAF?' onclick="'+this.Nom+'._evntGenreApiKiosque('+TypeGenreApiKiosque.Api_RenduPJTAF+')'+'" ':''),(lAvecApiRenduTAF?' class="ico-btn kiosque-liste-cdt"':''),'></span>');}
if(GEtatUtilisateur.activerKiosqueEnvoiNote){H.push('<span',(lAvecApiEnvoiNote?' title="'+GChaine.toTitle(GTraductions.getValeur('FenetrePanierKiosque.hint.ManuelDevoir'))+'" ':''),(lAvecApiEnvoiNote?' onclick="'+this.Nom+'._evntGenreApiKiosque('+TypeGenreApiKiosque.Api_EnvoiNote+')'+'" ':''),(lAvecApiEnvoiNote?' class="ico-btn kiosque-liste-devoir"':''),'></span>');}}
H.push('</div>','</li>');for(var j=0;j<lRessource.listeRessourcesAtomiques.GetNbrElements();j++){var lRessourceAtomique=lRessource.listeRessourcesAtomiques.GetElement(j);lLien=GChaine.creerUrlBruteLienExterne(lRessourceAtomique);H.push('<li role="link" tabIndex="0" onclick="window.open(\'',lLien,'\')" onkeyup="if(GNavigateur.IsToucheSelection())window.open(\'',lLien,'\')">','<a class="link-as-wrapper atomic-rsc" title="',lRessourceAtomique.description,'"><span>',lRessourceAtomique.titre,'</span></a>');var lRAAvecApiRenduTAF=!!lRessourceAtomique&&!!lRessourceAtomique.apiSupport&&lRessourceAtomique.apiSupport.contains(TypeGenreApiKiosque.Api_RenduPJTAF);var lRAAvecApiEnvoiNote=!!lRessourceAtomique&&!!lRessourceAtomique.apiSupport&&lRessourceAtomique.apiSupport.contains(TypeGenreApiKiosque.Api_EnvoiNote);if(this.optionsKiosque.avecDetailsRessources){if(GEtatUtilisateur.activerKiosqueRenduTAF){H.push('<span',(lRAAvecApiRenduTAF?' title="'+GChaine.toTitle(GTraductions.getValeur('FenetrePanierKiosque.hint.LienTAF'))+'" ':''),(lRAAvecApiRenduTAF?' onclick="'+this.Nom+'._evntGenreApiKiosque('+TypeGenreApiKiosque.Api_RenduPJTAF+')'+'" ':''),(lRAAvecApiRenduTAF?' class="ico-btn kiosque-liste-cdt"':''),'></span>');}
if(GEtatUtilisateur.activerKiosqueEnvoiNote){H.push('<span',(lRAAvecApiEnvoiNote?' title="'+GChaine.toTitle(GTraductions.getValeur('FenetrePanierKiosque.hint.LienDevoir'))+'" ':''),(lRAAvecApiEnvoiNote?' onclick="'+this.Nom+'._evntGenreApiKiosque('+TypeGenreApiKiosque.Api_EnvoiNote+')':''),(lRAAvecApiEnvoiNote?' class="ico-btn kiosque-liste-devoir"':''),'></span>');}}
H.push('</li>');}}
H.push('</ul>');return H.join('');}
_evntPanier(aNumero){var lGenresApi=new TypeEnsembleNombre();lGenresApi.add(TypeGenreApiKiosque.Api_AjoutPanier);var lManuel=this.donnees.listeRessources.GetElementParNumero(aNumero);ObjetFenetre_ManuelsNumeriques.ouvrir({instance:this,callback:function(){this._notificationKiosque();}.bind(this),genresApiKiosque:lGenresApi,sansAjouterLien:true,manuel:lManuel});}
_evntGenreApiKiosque(aGenre){var lPage={};switch(aGenre){case TypeGenreApiKiosque.Api_RenduPJTAF:lPage.Onglet=EGenreOnglet.SaisieCahierDeTextes;if(GEtatUtilisateur.estEspaceMobile()){this.evenementPage({genreOngletDest:lPage.Onglet});} else{this.evenementPage(this.genreEvenement.selectionPage,lPage);}
break;case TypeGenreApiKiosque.Api_EnvoiNote:lPage.Onglet=EGenreOnglet.SaisieNotes;if(GEtatUtilisateur.estEspaceMobile()){this.evenementPage({genreOngletDest:lPage.Onglet});} else{this.evenementPage(this.genreEvenement.selectionPage,lPage);}
break;default:;break;}}}
module.exports=WidgetKiosque;},fn:"espace/script/widget/widgetkiosque.js"});;
IE.fModule({f:function(exports,require,module,global){const{ObjetRequeteConsultation}=require('ObjetRequeteJSON.js');const Requetes=require('CollectionRequetes.js');class ObjetRequeteGenerationURLRecherchePartenaire extends ObjetRequeteConsultation{constructor(...aParams){super(...aParams);}
lancerRequete(aDonnees){this.JSON=aDonnees;return this.appelAsynchrone();}
actionApresRequete(){this.callbackReussite.appel(this.JSONReponse.urlRecherche);}}
Requetes.inscrire('GenerationURLRecherchePartenaire',ObjetRequeteGenerationURLRecherchePartenaire);module.exports=ObjetRequeteGenerationURLRecherchePartenaire;},fn:"objetrequetegenerationurlrecherchepartenaire.js"});;
IE.fModule({f:function(exports,require,module,global){const{ObjetRequeteSaisie}=require('ObjetRequeteJSON.js');const Requetes=require('CollectionRequetes.js');const GTraductions=require('ObjetTraduction.js');class ObjetRequeteSaisieURLPartenaire extends ObjetRequeteSaisie{constructor(...aParams){super(...aParams);this.setOptions({avecControleModeExclusif:false});}
lancerRequete(aDonnees){this.JSON.SSO=aDonnees.SSO;return this.appelAsynchrone({messageDetail:GTraductions.getValeur('requete.VeuillezPatienter')});}
actionApresRequete(){this.callbackReussite.appel(this.JSONRapportSaisie.urlSSO);}}
Requetes.inscrire('SaisieURLPartenaire',ObjetRequeteSaisieURLPartenaire);module.exports=ObjetRequeteSaisieURLPartenaire;},fn:"objetrequetesaisieurlpartenaire.js"});;
IE.fModule({f:function(exports,require,module,global){const{ObjetRequeteSaisie}=require('ObjetRequeteJSON.js');const Requetes=require('CollectionRequetes.js');const GTraductions=require('ObjetTraduction.js');class ObjetRequeteSaisieURLPartenaireCDI extends ObjetRequeteSaisie{constructor(...aParams){super(...aParams);this.setOptions({avecControleModeExclusif:false});}
lancerRequete(aDonnees){this.JSON.url=aDonnees.url;return this.appelAsynchrone({messageDetail:GTraductions.getValeur('requete.VeuillezPatienter')});}
actionApresRequete(){this.callbackReussite.appel(this.JSONRapportSaisie.urlSSO);}}
Requetes.inscrire('SaisieURLPartenaireCDI',ObjetRequeteSaisieURLPartenaireCDI);module.exports=ObjetRequeteSaisieURLPartenaireCDI;},fn:"objetrequetesaisieurlpartenairecdi.js"});;
IE.fModule({f:function(exports,require,module,global){const ObjetRequeteGenerationURLRecherchePartenaire=require('ObjetRequeteGenerationURLRecherchePartenaire.js');const ObjetRequeteSaisieURLPartenaire=require('ObjetRequeteSaisieURLPartenaire.js');const ObjetRequeteSaisieURLPartenaireCDI=require('ObjetRequeteSaisieURLPartenaireCDI.js');function TUtilitairePartenaire(){this.windowURLPartenaire=null;}
TUtilitairePartenaire.ouvrirPatience=function(){try{this.windowURLPartenaire=window.open('message.html?G=patiencePartenaire','_blank');} catch(e){this.windowURLPartenaire=null;}};TUtilitairePartenaire.fermerPatience=function(){if(this.windowURLPartenaire){this.windowURLPartenaire.close();}};TUtilitairePartenaire.ouvrirUrl=function(aUrl){if(this.windowURLPartenaire){this.windowURLPartenaire.location.replace(aUrl);} else{window.open(aUrl);}};TUtilitairePartenaire.ouvrirURLPartenaireCDI=function(aLien){TUtilitairePartenaire.ouvrirPatience();new ObjetRequeteSaisieURLPartenaireCDI(this,this._actionSurLienPartenaire).lancerRequete(aLien);};TUtilitairePartenaire.ouvrirURLPartenaire=function(aLien){TUtilitairePartenaire.ouvrirPatience();new ObjetRequeteSaisieURLPartenaire(this,this._actionSurLienPartenaire).lancerRequete(aLien);};TUtilitairePartenaire.ouvrirURLPartenaireRecherche=function(aObjetPartenaire,aTexteRecherche){TUtilitairePartenaire.ouvrirPatience();new ObjetRequeteGenerationURLRecherchePartenaire(this,this._actionSurLienPartenaire).lancerRequete({portailCDI:aObjetPartenaire,recherche:aTexteRecherche});};TUtilitairePartenaire._actionSurLienPartenaire=function(aUrlSSO){if(aUrlSSO){if(this.windowURLPartenaire){setTimeout(function(){this.windowURLPartenaire.location.replace(aUrlSSO);}.bind(this),0);} else{window.open(aUrlSSO);}} else{TUtilitairePartenaire.fermerPatience();}};module.exports=TUtilitairePartenaire;},fn:"utilitairepartenaire.js"});;
IE.fModule({f:function(exports,require,module,global){const Identite=require('ObjetIdentite.js');const GChaine=require('GChaine.js');const TUtilitairePartenaire=require('UtilitairePartenaire.js');class WidgetLienUtile extends Identite{construire(aParams){this.donnees=aParams.donnees;const lWidget={html:this.composeWidgetLienUtile(),nbrElements:this.donnees.listeLiens.GetNbrElements(),afficherMessage:this.donnees.listeLiens.GetNbrElements()===0};$.extend(true,this.donnees,lWidget);aParams.construireWidget(this.donnees);}
composeWidgetLienUtile(){const H=[];H.push('<ul class="liste-clickable one-line" role="list">');for(let i=0;i<this.donnees.listeLiens.GetNbrElements();i++){const lLien=this.donnees.listeLiens.GetElement(i);if(!!lLien.estFavori){continue;}
if(lLien.SSO){H.push('<li role="link" tabIndex="0" class="has-sso" onclick="',this.Nom,'._surLienPartenaire (',i,')" onkeyup="if(GNavigateur.IsToucheSelection())',this.Nom,'._surLienPartenaire (',i,')">','<div>','<a ',(lLien.commentaire?' ie-hint="'+lLien.commentaire+'"':''),'>',lLien.GetLibelle(),'</a>',lLien.commentaire?'<p>'+lLien.commentaire+'</p>':'','</div>','</li>');} else{H.push('<li role="link" tabIndex="0" class="no-sso" onclick="window.open(\'',GChaine.verifierURLHttp(lLien.url),'\')" onkeyup="if(GNavigateur.IsToucheSelection())window.open(\'',GChaine.verifierURLHttp(lLien.url),'\')">','<div>','<a class="LienAccueil"',(lLien.commentaire?' ie-hint="'+lLien.commentaire+'"':''),'>',lLien.GetLibelle(),'</a>',lLien.commentaire?'<p>'+lLien.commentaire+'</p>':'','</div>','</li>');}}
H.push('</ul>');return H.join('');}
_surLienPartenaire(i){const lLien=this.donnees.listeLiens.GetElement(i);TUtilitairePartenaire.ouvrirURLPartenaire(lLien);}}
module.exports=WidgetLienUtile;},fn:"espace/script/widget/widgetlienutile.js"});;
IE.fModule({f:function(exports,require,module,global){const GChaine=require('GChaine.js');const EGenreTriElement=require('Enumere_TriElement.js');const{GDate}=require('ObjetDate.js');const GTraductions=require('ObjetTraduction.js');const ObjetTri=require('ObjetTri.js');const{GObjetWAI,EGenreAttribut}=require('ObjetWAI.js');const EGenreRessource=require('Enumere_Ressource.js');const EGenreDocumentJoint=require('Enumere_DocumentJoint.js');const ObjetElement=require('ObjetElement.js');const TypeFichierExterneHttpSco=require('TypeFichierExterneHttpSco.js').TypeFichierExterneHttpSco;const Identite=require('ObjetIdentite.js');class WidgetNotes extends Identite{construire(aParams){this.donnees=aParams.donnees;const H=[];if(this.donnees.listeDevoirs.GetNbrElements()>0){this.donnees.listeDevoirs.setTri([ObjetTri.init('date',EGenreTriElement.Decroissant),ObjetTri.init('service.Libelle')]);this.donnees.listeDevoirs.trier();const lAvecLien=this.donnees.avecDetailDevoir;H.push('<ul role="list" class="liste-clickable">');for(let I=0;I<this.donnees.listeDevoirs.GetNbrElements();I++){H.push(this.composeNote(this.donnees.listeDevoirs.GetElement(I),I,lAvecLien));}
H.push('</ul>');}
const lWidget={html:H.join(''),nbrElements:this.donnees.listeDevoirs.GetNbrElements(),afficherMessage:this.donnees.listeDevoirs.GetNbrElements()===0,getPage:function(){if(this.donnees.listeDevoirs.GetNbrElements()){this.donnees.page.periode=this.donnees.listeDevoirs.GetPremierElement().periode;}
return this.donnees.page;}.bind(this)};$.extend(true,this.donnees,lWidget);aParams.construireWidget(this.donnees);}
composeNote(aDevoir,aIndex,aAvecLienDetail){const lNoteAuDessusBareme=(aDevoir.note&&aDevoir.bareme&&aDevoir.note.getValeur()>aDevoir.bareme.getValeur());const lEstBaremeParDefaut=aDevoir.bareme.getValeur()===aDevoir.baremeParDefaut.getValeur()&&!lNoteAuDessusBareme;const lStrDate=GDate.FormatDate(aDevoir.date,'['+GTraductions.getValeur('Le')+' '+'%J %MMM'+']');const lStrClasse=aDevoir.moyenne?' - '+(aDevoir.estEnGroupe?GTraductions.getValeur('accueil.moyGroupe'):GTraductions.getValeur('accueil.moyClasse'))+'  '+aDevoir.moyenne.getNote()+(lEstBaremeParDefaut?'':' '+aDevoir.bareme.getBaremeEntierSansSlash()):'';const lStrClasseAria=aDevoir.moyenne?(aDevoir.estEnGroupe?GTraductions.getValeur('accueil.moyGroupe')+' ':GTraductions.getValeur('accueil.moyClasse')+' ')+aDevoir.moyenne.getNote()+(lEstBaremeParDefaut?'':' '+aDevoir.bareme.getBaremeEntier()):'';const lStrEtoile=lNoteAuDessusBareme?'<i class="EspaceDroit icon icon_star"></i>':'';const lStrNote=aDevoir.note.getNote()+(lEstBaremeParDefaut||isNaN(parseFloat(aDevoir.note.getNote()))?'':'<span class="bareme"> '+aDevoir.bareme.getBaremeEntier()+'</span>');const lStrNoteAria=aDevoir.note.getNote()+(lEstBaremeParDefaut||isNaN(parseFloat(aDevoir.note.getNote()))?'':GTraductions.getValeur('Notes.NoteSur',[aDevoir.bareme.getBaremeEntierSansSlash()]));const lWAI=GObjetWAI.composeAttribut({genre:EGenreAttribut.label,valeur:GTraductions.getValeur('Matiere')+' : '+aDevoir.service.GetLibelle()+' ; '+GTraductions.getValeur('Notes.Note')+' : '+lStrNoteAria+' ; '+GTraductions.getValeur('Date')+' : '+lStrDate+(lStrClasseAria?' ; '+lStrClasseAria:'')});const H=[];H.push('<li ',aAvecLienDetail?'role="link" ':'','class="justify-between" id="',this.Nom,'_notes_',aIndex,'" tabIndex="0"',lWAI,aAvecLienDetail?'onclick="'+this.Nom+'._surDernieresNoteMatiereClick(event, '+aIndex+')" onkeyup="if(GNavigateur.IsToucheSelection())'+this.Nom+'._surDernieresNoteMatiereClick(event, '+aIndex+')"':'','>','<div class="wrap">','<h4><span>',aDevoir.service.GetLibelle(),'</span></h4>','<div class="infos-conteneur">','<span class="date">',lStrDate,'</span>',lStrClasse?'<span class="as-link"> - '+lStrClasse+'</span>':'');const lArrayLiensSujetCorrige=[];if(!!aDevoir.libelleSujet){const lDocumentJointSujet=new ObjetElement(aDevoir.libelleSujet,aDevoir.GetNumero(),EGenreDocumentJoint.Fichier);lArrayLiensSujetCorrige.push(GChaine.composerUrlLienExterne({documentJoint:lDocumentJointSujet,genreRessource:TypeFichierExterneHttpSco.DevoirSujet,libelleEcran:GTraductions.getValeur('AfficherSujet')}));}
if(!!aDevoir.libelleCorrige){const lDocumentJointCorrige=new ObjetElement(aDevoir.libelleCorrige,aDevoir.GetNumero(),EGenreDocumentJoint.Fichier);lArrayLiensSujetCorrige.push(GChaine.composerUrlLienExterne({documentJoint:lDocumentJointCorrige,genreRessource:TypeFichierExterneHttpSco.DevoirCorrige,libelleEcran:GTraductions.getValeur('AfficherCorrige')}));}
if(lArrayLiensSujetCorrige.length>0){H.push(`<div class="flex-contain flex-center full-width flex-gap-l m-top">${lArrayLiensSujetCorrige.join(' ')}</div>`);}
H.push('</div>','</div>');H.push('<div class="p-top ',IE.estMobile?'fixed-mobile':'fixed','">',lStrEtoile,'</div>');H.push('<div class="as-info ',IE.estMobile?'fixed-mobile':'fixed','" aria-label="',lStrNoteAria,'">',lStrNote,'</div>');H.push('</li>');return H.join('');}
_surDernieresNoteMatiereClick(aEvent,i){if($(aEvent.target).parentsUntil(aEvent.currentTarget).addBack().filter('a').length===0){const lDevoir=this.donnees.listeDevoirs.GetElement(i);GEtatUtilisateur.Navigation.SetRessource(EGenreRessource.Devoir,lDevoir);if(!!this.donnees.page){this.donnees.page.periode=lDevoir.periode;}
if(GEtatUtilisateur.estEspaceMobile()){this.evenementPage({genreOngletDest:this.donnees.page.Onglet,page:this.donnees.page});} else{this.evenementPage(this.genreEvenement.selectionPage,this.donnees.page);}}}
surQCM(I){const lDevoir=this.donnees.listeDevoirs.GetElement(I);this.afficherExecutionQCM(lDevoir.executionQCM);}}
module.exports=WidgetNotes;},fn:"espace/script/widget/widgetnotes.js"});;
IE.fModule({f:function(exports,require,module,global){const Identite=require('ObjetIdentite.js');const GTraductions=require('ObjetTraduction.js');const TUtilitairePartenaire=require('UtilitairePartenaire.js');class WidgetPartenaireARD extends Identite{construire(aParams){this.donnees=aParams.donnees;var lWidget={html:this.composeWidgetPartenaireArd(),nbrElements:null,titre:GTraductions.getValeur('accueil.ard.titre'),avecActualisation:!!this.donnees.avecActualisation};$.extend(true,this.donnees,lWidget);aParams.construireWidget(this.donnees);}
composeWidgetPartenaireArd(){var H=[];if(!this.donnees||this.donnees.porteMonnaie.GetNbrElements()>0){H.push('<table>','<thead>','<tr>','<th scope="col">',GTraductions.getValeur('accueil.ard.porteMonnaie'),'</th>','<th scope="col">',GTraductions.getValeur('accueil.ard.dernierSolde'),'</th>','<tr>','</thead>');for(var i=0;i<this.donnees.porteMonnaie.GetNbrElements();i++){var lPrix=this.donnees.porteMonnaie.GetElement(i);var lClass=lPrix.avecWarning?'class="date-alert"':'';var lSolde=lPrix.avecWarning?GTraductions.getValeur('accueil.ard.attentionSolde')+': '+lPrix.hintSolde:lPrix.hintSolde;H.push('<tr>','<td title="',lPrix.hintPorteMonnaie,'">',lPrix.libellePorteMonnaie,'</td>','<td ',lClass,' title="',lSolde,'">','<span class="info-montant">',lPrix.valeurSolde,'</span></td>','</tr>');}
H.push('</table>');} else{H.push('<div class="no-events"><p>',GTraductions.getValeur('accueil.ard.msgAucun'),'</p></div>');}
if(this.donnees.SSO&&this.donnees.SSO.intituleLien){H.push('<div class="link-contain" onclick="'+this.Nom+'._surPartenaireArd ()">','<label>',this.donnees.SSO.intituleLien,'</label>','<p>',this.donnees.SSO.description,'</p>','</div>');}
return H.join('');}
_surPartenaireArd(){TUtilitairePartenaire.ouvrirURLPartenaire(this.donnees);}}
module.exports=WidgetPartenaireARD;},fn:"espace/script/widget/widgetpartenaireard.js"});;
IE.fModule({f:function(exports,require,module,global){const TypeGenrePret={GP_EnCours:0,GP_EnRetard:1,GP_Historique:2};module.exports.TypeGenrePret=TypeGenrePret;},fn:"typegenrepret.js"});;
IE.fModule({f:function(exports,require,module,global){const GChaine=require('GChaine.js');const EGenreEvenementObjetSaisie=require('Enumere_EvenementObjetSaisie.js');const{GDate}=require('ObjetDate.js');const ObjetFenetre=require('ObjetFenetre.js');const ObjetFiche=require('ObjetFiche.js');const Identite=require('ObjetIdentite.js');const ObjetSaisie=require('ObjetSaisie.js');const GTraductions=require('ObjetTraduction.js');const UtilitaireWidget=require('UtilitaireWidget.js');const TypeGenrePret=require('TypeGenrePret.js').TypeGenrePret;const TUtilitairePartenaire=require('UtilitairePartenaire.js');class WidgetPartenaireCDI extends Identite{creerObjetstPartenaireCDI(){this.comboCDI=Identite.creerInstance(ObjetSaisie,{pere:this,evenement:this._evenementSurComboCDI});this._initialiserComboCDI(this.comboCDI);this.ficheHistorique=ObjetFenetre.creerInstance(ObjetFiche,{pere:this,initialiser:false});this.ficheHistorique.destructionSurFermeture=false;}
initialiserObjetsPartenaireCDI(){this.comboCDI.Initialiser();this.comboCDI.SetDonnees(this.donnees.listeCDI,0);this.comboCDI.SetVisible(this.donnees.listeCDI.GetNbrElements()>1);this.ficheHistorique.Initialiser();}
construire(aParams){this.donnees=aParams.donnees;this.creerObjetstPartenaireCDI();var lWidget={listeElementsGraphiques:[{id:this.comboCDI.GetNom()}
],nbrElements:null,afficherMessage:false,avecActualisation:true,fermerFiches:function(){this.ficheHistorique.Fermer();}.bind(this)};$.extend(true,this.donnees,lWidget);this.idInputRecherche=this.Nom+'_inputSearch';this.avecHistorique=false;aParams.construireWidget(this.donnees);this.initialiserObjetsPartenaireCDI();}
actualiserPartenaireCDI(aCDI){this.CDI=aCDI;var lTitre=aCDI.avecDelegationAuth?'<span class="AvecMain" onclick="'+this.Nom+'._surPartenaireCDI ()">'+(this.donnees.listeCDI.GetNbrElements()===1?aCDI.GetLibelle():GTraductions.getValeur('accueil.CDI.titre'))+'</span>':'<a href="'+GChaine.verifierURLHttp(aCDI.url)+'" target="_blank">'+(this.donnees.listeCDI.GetNbrElements()===1?aCDI.GetLibelle():GTraductions.getValeur('accueil.CDI.titre'))+'</a>';var lWidget={html:this.composeWidgetPartenaireCDI(aCDI),nbrElements:null,afficherMessage:false,titre:lTitre,avecActualisation:!!aCDI.avecActualisation};$.extend(true,this.donnees,lWidget);UtilitaireWidget.actualiserWidget(this.donnees);}
composeWidgetPartenaireCDI(aCDI){var H=[];this.donneesRequete.partenaireCDI.CDI=aCDI;H.push('<div class="input-wrapper fullsize">','<div class="as-search">','<label class="Italique wai_hidden" for="',this.idInputRecherche,'">',GTraductions.getValeur('accueil.CDI.recherche'),'</label>','<input id="',this.idInputRecherche,'" type="text" placeholder="',GTraductions.getValeur('accueil.CDI.recherche'),'" onkeypress="',this.Nom,'._onKeyPress(event)"/>','<span onclick="',this.Nom,'._surRechercheCDI ()"></span>','</div>','</div>');if(!!aCDI.listePrets&&aCDI.listePrets.GetNbrElements()){H.push(this.composeListePrets(aCDI,false));if(this.avecHistorique){H.push('<div class="LienAccueil PetitEspace" style="float: right" onclick="',this.Nom,'._surHistorique ()">',GTraductions.getValeur('accueil.CDI.voirHistorique'),'</div>');}}
return H.join('');}
composeListePrets(aCDI,aPourHistorique){var H=[];if(!!aCDI.listePrets&&aCDI.listePrets.GetNbrElements()){H.push('<table class="is-clickable">');H.push('<thead>','<tr>','<th scope="col">',GTraductions.getValeur('accueil.CDI.ressourcesEmpruntees'),'</th>','<th scope="col">',GTraductions.getValeur('accueil.CDI.emprunteLe'),'</th>','<th scope="col">',aPourHistorique?GTraductions.getValeur('accueil.CDI.renduLe'):GTraductions.getValeur('accueil.CDI.aRendreLe'),'</th>','</tr>','</thead>');for(var i=0;i<aCDI.listePrets.GetNbrElements();i++){var lPret=aCDI.listePrets.GetElement(i);var lAfficher=aPourHistorique?(lPret.GetGenre()===TypeGenrePret.GP_Historique):(lPret.GetGenre()===TypeGenrePret.GP_EnCours)||(lPret.GetGenre()===TypeGenrePret.GP_EnRetard);if(lPret.GetGenre()===TypeGenrePret.GP_Historique){this.avecHistorique=true;}
if(lAfficher){H.push('<tr>','<td>','<a href="',GChaine.verifierURLHttp(lPret.url),'" target="_blank" class=LienAccueil"',(lPret.commentaire?' ie-hint="'+lPret.commentaire+'"':''),'>',lPret.titre,'</a>','</td>','<td>',GDate.FormatDate(lPret.dateEmprunt,'[%JJ/%MM/%AA]'),'</td>','<td',lPret.GetGenre()===TypeGenrePret.GP_EnRetard?' class="date-alert"':'','>',GDate.FormatDate(aPourHistorique?lPret.dateRetourEffectif:lPret.dateRetourPrevue,'[%JJ/%MM/%AA]'),'</td>','</tr>');}}
H.push('</table>');}
return H.join('');}
_surHistorique(){this.ficheHistorique.setOptionsFenetre({titre:GTraductions.getValeur('accueil.CDI.historique'),htmlContenu:this.composeListePrets(this.donneesRequete.partenaireCDI.CDI,true)});this.ficheHistorique.Afficher();}
_onKeyPress(aEvent){if(aEvent.keyCode===require('ToucheClavier.js').RetourChariot){this._surRechercheCDI();}}
_surRechercheCDI(){var lValeurRecherchee=$('#'+this.idInputRecherche.escapeJQ()).val();if(!!lValeurRecherchee){lValeurRecherchee=lValeurRecherchee.trim();}
if(!!lValeurRecherchee&&lValeurRecherchee.length>0){TUtilitairePartenaire.ouvrirURLPartenaireRecherche(this.donneesRequete.partenaireCDI.CDI,lValeurRecherchee);}}
_initialiserComboCDI(aObjet){aObjet.setOptions_ObjetSaisie({longueur:80,avecBoutonsPrecSuiv:false,avecBoutonsPrecSuivVisiblesInactifs:false});}
_evenementSurComboCDI(aGenre,aElement){if(aGenre===EGenreEvenementObjetSaisie.selection){this.actualiserPartenaireCDI(aElement);}}
_surPartenaireCDI(){TUtilitairePartenaire.ouvrirURLPartenaireCDI(this.CDI);}}
module.exports=WidgetPartenaireCDI;},fn:"espace/script/widget/widgetpartenairecdi.js"});;
IE.fModule({f:function(exports,require,module,global){const Identite=require('ObjetIdentite.js');const GChaine=require('GChaine.js');const{GDate}=require('ObjetDate.js');const GTraductions=require('ObjetTraduction.js');const ObjetTri=require('ObjetTri.js');const EGenreRessource=require('Enumere_Ressource.js');const UtilitaireQCM=require('UtilitaireQCM.js').UtilitaireQCM;class WidgetQCM extends Identite{construire(aParams){this.donnees=aParams.donnees;var H=[];if(this.donnees.listeExecutionsQCM&&this.donnees.listeExecutionsQCM.GetNbrElements()>0){this.donnees.listeExecutionsQCM.setTri([ObjetTri.init('dateDebutPublication'),ObjetTri.init('Position')]);H.push('<ul class="sub-liste" role="list">');for(var I=0;I<this.donnees.listeExecutionsQCM.GetNbrElements();I++){var lExecution=this.donnees.listeExecutionsQCM.GetElement(I);var lStrInfosComplementaires;if(GEtatUtilisateur.pourPrimaire()&&lExecution.coefficientEvaluation===0){lStrInfosComplementaires='('+GTraductions.getValeur('evaluations.NonComptabiliseDansBilan')+')';}
H.push('<li');if(!lExecution.fichierDispo){H.push(' title="'+GTraductions.getValeur('ExecutionQCM.FichierIndispo')+'"');}
H.push('>','<div class="wrap">','<div class="bloc-date-conteneur">',GDate.FormatDate(lExecution.dateDebutPublication,'<div>%JJ</div><div>%MMM</div>'),'</div>','<div class="infos-ds-conteneur">');if(lExecution.GetGenre()===EGenreRessource.ExecutionQCM){H.push('<h4>',lExecution.service.GetLibelle(),'</h4>','<div class="date">',GDate.strDates(lExecution.dateDebutPublication,lExecution.dateFinPublication,true).ucfirst(),(!!lStrInfosComplementaires?(' '+lStrInfosComplementaires):''),'</div>','<div><i class="icon_qcm avecCouleurTheme"></i>',lExecution.QCM.GetLibelle(),' (',UtilitaireQCM.getStrResumeModalites(lExecution),') </div>');if(lExecution.estEnPublication){H.push('<div class="flex-contain btn-qcm"><ie-bouton onclick="'+this.Nom+'.surExecutionQCM(\''+lExecution.GetNumero()+'\')" class="themeBoutonSecondaire">',GTraductions.getValeur('TAFEtContenu.executerQCM'),'</ie-bouton></div>');}} else{H.push('<span class="date">',GDate.strDates(lExecution.dateDebutPublication,lExecution.dateFinPublication,true).ucfirst(),(!!lStrInfosComplementaires?(' '+lStrInfosComplementaires):''),'</span>');H.push(this.composeExecutionKiosque(lExecution,I));}
H.push('</div>','</div>','</li>');}}
var lWidget={html:H.join(''),nbrElements:this.donnees.listeExecutionsQCM?this.donnees.listeExecutionsQCM.GetNbrElements():0,afficherMessage:this.donnees.listeExecutionsQCM?this.donnees.listeExecutionsQCM.GetNbrElements()===0:true};$.extend(true,this.donnees,lWidget);aParams.construireWidget(this.donnees);}
composeExecutionKiosque(aExecutionKiosque){var H=[];if(!!aExecutionKiosque){H.push('<div>');H.push(GChaine.composerUrlLienExterne({documentJoint:aExecutionKiosque,avecLien:aExecutionKiosque.estEnPublication,title:(aExecutionKiosque.estEnPublication?GTraductions.getValeur('CahierDeTexte.TAFARendre.ACompleterEditeur'):''),libelleEcran:aExecutionKiosque.service.GetLibelle()}));H.push('<div>','&nbsp;-&nbsp;',aExecutionKiosque.titre,'</div>');H.push('</div>');}
return H.join('');}
surExecutionQCM(aNumeroExecution){var lExecutionsQCM=this.donnees.listeExecutionsQCM.GetElementParNumero(aNumeroExecution);this.afficherExecutionQCM(lExecutionsQCM);}}
module.exports=WidgetQCM;},fn:"espace/script/widget/widgetqcm.js"});;
IE.fModule({f:function(exports,require,module,global){const GChaine=require('GChaine.js');const GTraductions=require('ObjetTraduction.js');const EGenreRessource=require('Enumere_Ressource.js');const TypeFichierExterneHttpSco=require('TypeFichierExterneHttpSco.js').TypeFichierExterneHttpSco;const EGenreDocumentJoint=require('Enumere_DocumentJoint.js');const EGenreRessourcePedagogique={documentJoint:0,site:1,QCM:2,sujet:3,corrige:4,travailRendu:5,kiosque:6,documentCloud:7};const EGenreRessourcePedagogiqueUtil={getLibelleDeGenreEtNombre(aGenreRessource,aNombre){let lChaine='';switch(aGenreRessource){case EGenreRessourcePedagogique.documentJoint:lChaine=((aNombre===1)||(aNombre===undefined))?GTraductions.getValeur('RessourcePedagogique.DocJoint_S'):GTraductions.getValeur('RessourcePedagogique.DocJoint');break;case EGenreRessourcePedagogique.site:lChaine=((aNombre===1)||(aNombre===undefined))?GTraductions.getValeur('RessourcePedagogique.SitesWeb_S'):GTraductions.getValeur('RessourcePedagogique.SitesWeb');break;case EGenreRessourcePedagogique.QCM:lChaine=((aNombre===1)||(aNombre===undefined))?GTraductions.getValeur('RessourcePedagogique.IDevoirs_S'):GTraductions.getValeur('RessourcePedagogique.IDevoirs');break;case EGenreRessourcePedagogique.sujet:lChaine=((aNombre===1)||(aNombre===undefined))?GTraductions.getValeur('RessourcePedagogique.Sujets_S'):GTraductions.getValeur('RessourcePedagogique.Sujets');break;case EGenreRessourcePedagogique.corrige:lChaine=((aNombre===1)||(aNombre===undefined))?GTraductions.getValeur('RessourcePedagogique.Corriges_S'):GTraductions.getValeur('RessourcePedagogique.Corriges');break;case EGenreRessourcePedagogique.travailRendu:lChaine=((aNombre===1)||(aNombre===undefined))?GTraductions.getValeur('RessourcePedagogique.TravauxRendus_S'):GTraductions.getValeur('RessourcePedagogique.TravauxRendus');break;case EGenreRessourcePedagogique.kiosque:lChaine=((aNombre===1)||(aNombre===undefined))?GTraductions.getValeur('RessourcePedagogique.Kiosque_S'):GTraductions.getValeur('RessourcePedagogique.Kiosque');break;}
return lChaine;},composerURL(aGenreRessourcePedagogique,aRessource,aLibelleEcran,aUrlBrute,aMaxWidth){let lGenreRessource=TypeFichierExterneHttpSco.Aucun;let lLibelle;switch(aGenreRessourcePedagogique){case(EGenreRessourcePedagogique.sujet):if(aRessource.GetGenre()===EGenreRessource.Devoir){lGenreRessource=TypeFichierExterneHttpSco.DevoirSujet;}
if(aRessource.GetGenre()===EGenreRessource.Evaluation){lGenreRessource=TypeFichierExterneHttpSco.EvaluationSujet;}
break;case(EGenreRessourcePedagogique.corrige):if(aRessource.GetGenre()===EGenreRessource.Devoir){lGenreRessource=TypeFichierExterneHttpSco.DevoirCorrige;}
if(aRessource.GetGenre()===EGenreRessource.Evaluation){lGenreRessource=TypeFichierExterneHttpSco.EvaluationCorrige;}
if(aRessource.GetGenre()===EGenreRessource.RelationTravailAFaireEleve){lGenreRessource=TypeFichierExterneHttpSco.TAFCorrigeRenduEleve;}
break;case(EGenreRessourcePedagogique.site):aLibelleEcran=aRessource.GetLibelle();aRessource.Genre=EGenreDocumentJoint.Url;break;case(EGenreRessourcePedagogique.kiosque):case(EGenreRessourcePedagogique.documentJoint):case(EGenreRessourcePedagogique.documentCloud):break;case(EGenreRessourcePedagogique.travailRendu):lGenreRessource=TypeFichierExterneHttpSco.TAFRenduEleve;break;default:;break;}
let lUrlResult='';if(aUrlBrute){lUrlResult=GChaine.creerUrlBruteLienExterne(aRessource,{genreRessource:lGenreRessource,libelle:lLibelle});} else{lUrlResult=GChaine.composerUrlLienExterne({documentJoint:aRessource,genreRessource:lGenreRessource,libelleEcran:aLibelleEcran,libelle:lLibelle,maxWidth:aMaxWidth?aMaxWidth:0});}
return lUrlResult;},getIcone(aGenreRessource){return['icon_file_text_alt','icon_globe','icon_qcm','icon_sujet','icon_check','icon_devoir_rendre','icon_book','icon_cloud'][aGenreRessource];}};module.exports={EGenreRessourcePedagogique,EGenreRessourcePedagogiqueUtil};},fn:"enumere_ressourcepedagogique.js"});;
IE.fModule({f:function(exports,require,module,global){const GChaine=require('GChaine.js');const EGenreTriElement=require('Enumere_TriElement.js');const{GDate}=require('ObjetDate.js');const GTraductions=require('ObjetTraduction.js');const ObjetTri=require('ObjetTri.js');const{EGenreRessourcePedagogique,EGenreRessourcePedagogiqueUtil}=require('Enumere_RessourcePedagogique.js');const EformatDocJoint=require('Enumere_FormatDocJoint.js');const UtilitaireQCM=require('UtilitaireQCM.js').UtilitaireQCM;const Identite=require('ObjetIdentite.js');const TypeFichierExterneHttpSco=require('TypeFichierExterneHttpSco.js').TypeFichierExterneHttpSco;class WidgetRessourcePedagogique extends Identite{creerObjetstRessourcePedagogique(){}
initialiserObjetsRessourcePedagogique(){}
composeWidgetRessourcePedagogique(){for(var i=0;i<this.donnees.listeRessources.GetNbrElements();i++){var lRessource=this.donnees.listeRessources.GetElement(i);var lMatiere=this.donnees.listeMatieres.GetElementParNumero(lRessource.matiere.GetNumero());if(lMatiere&&(!lMatiere.date||(lRessource.date>lMatiere.date))){lMatiere.date=lRessource.date;}}
this.donnees.listeMatieres.setTri([ObjetTri.init('date',EGenreTriElement.Decroissant)]);this.donnees.listeMatieres.trier();this.donnees.listeRessources.setTri([ObjetTri.init('date',EGenreTriElement.Decroissant)]);this.donnees.listeRessources.trier();var H=[];H.push(this.composeWidgetRessourcePedagogique_Matiere());return H.join('');}
composeWidgetRessourcePedagogique_Matiere(){var lExisteDocument=[],H=[];H.push('<ul class="one-line">');for(var i=0;i<this.donnees.listeRessources.GetNbrElements();i++){var lRessource=this.donnees.listeRessources.GetElement(i);var lCle=lRessource.GetGenre()+'_'+(lRessource.ressource?lRessource.ressource.GetNumero():'');lExisteDocument[lCle]=true;H.push(this.composeWidgetRessourcePedagogique_Ressource(i,lRessource));}
H.push('</ul>');return H.join('');}
composeWidgetRessourcePedagogique_Ressource(i,aDocument){var lMatiere=this.donnees.listeMatieres.GetElementParNumero(aDocument.matiere.GetNumero());var H=[];var lSuffixe=GChaine.extraireExtensionFichier(aDocument.ressource.GetLibelle());var lTypefile=EformatDocJoint.getClassIconDeGenre(EformatDocJoint.getGenreDeFichier(lSuffixe));var lAriaLabel=(lMatiere?lMatiere.GetLibelle():'')+' '+GChaine.Format(GTraductions.getValeur('accueil.ressourcePedagogique.deposeLe'),[GDate.FormatDate(aDocument.date,'%J %MMMM')])+' ';H.push(`<li tabIndex="0" role="listitem" aria-label="${lAriaLabel}">\n    <div class="wrap">\n      ${lMatiere?`<h4 class="with-color" style="--couleur-matiere: ${lMatiere.couleur};">${lMatiere.GetLibelle()}</h4>`:``}
      <div class="pj-date-contain">`);if(aDocument.GetGenre()===EGenreRessourcePedagogique.QCM){H.push(`  <ie-chips class="iconic avec-event icon_qcm" ${UtilitaireQCM.estCliquable(aDocument.ressource)?`onclick="${this.Nom}._surRessourceQCM (${i})"`:``}>${aDocument.ressource.QCM.GetLibelle()} (${UtilitaireQCM.getStrResumeModalites(aDocument.ressource)})</ie-chips>`);} else{var lLien=null;if(aDocument.GetGenre()===EGenreRessourcePedagogique.travailRendu&&!!aDocument.ressource.documentCorrige){lLien=GChaine.creerUrlBruteLienExterne(aDocument.ressource.documentCorrige,{genreRessource:TypeFichierExterneHttpSco.TAFCorrigeRenduEleve});} else{lLien=EGenreRessourcePedagogiqueUtil.composerURL(aDocument.GetGenre(),aDocument.ressource,(aDocument.ressource.GetLibelle&&aDocument.ressource.GetLibelle()!==''?aDocument.ressource.GetLibelle():(!!aDocument.ressource.url?aDocument.ressource.url:aDocument.ressource)),true);}
H.push(`  <ie-chips style="max-width:35rem;" class="iconic avec-event ${lTypefile}" href="${lLien}">${(aDocument.ressource.GetLibelle&&aDocument.ressource.GetLibelle()!==''?aDocument.ressource.GetLibelle():(!!aDocument.ressource.url?aDocument.ressource.url:aDocument.ressource))}</ie-chips>`);}
H.push(' </div>',`<div class="date m-left-l m-top p-left">${GChaine.Format(GTraductions.getValeur('accueil.ressourcePedagogique.deposeLe'),[GDate.FormatDate(aDocument.date,'%J %MMMM')])}</div>`,'</div>','</li>');return H.join('');}
_surRessourceQCM(i){var lRessource=this.donnees.listeRessources.GetElement(i);this.afficherExecutionQCM(lRessource.ressource);}
construire(aParams){this.donnees=aParams.donnees;this.creerObjetstRessourcePedagogique();var lWidget={html:this.composeWidgetRessourcePedagogique(),nbrElements:this.donnees.listeRessources.GetNbrElements(),afficherMessage:this.donnees.listeRessources.GetNbrElements()===0};$.extend(true,this.donnees,lWidget);aParams.construireWidget(this.donnees);this.initialiserObjetsRessourcePedagogique();}}
module.exports=WidgetRessourcePedagogique;},fn:"espace/script/widget/widgetressourcepedagogique.js"});;
IE.fModule({f:function(exports,require,module,global){const GTraductions=require('ObjetTraduction.js');const UtilitaireRedirection=require('UtilitaireRedirection.js');const Identite=require('ObjetIdentite.js');class WidgetRetourEspace extends Identite{construire(aParams){this.donnees=aParams.donnees;const lWidget={html:this.composeWidgetRetourEspace()};$.extend(true,this.donnees,lWidget);aParams.construireWidget(this.donnees);}
composeWidgetRetourEspace(){return'<div class="message-conteneur" onclick="'+this.Nom+'.retourEspaceBureau()">'+'<span class="IconeRetourEspace">&nbsp</span>'+
GTraductions.getValeur('mobile.accederVersionClassique')+'</div>';}
retourEspaceBureau(){window.location.assign(GParametres.URLEspace+new UtilitaireRedirection().getParametresUrl({parametres:[{parametre:'fd',valeur:'1'}],parametresASupprimer:['redirect']}));}}
module.exports=WidgetRetourEspace;},fn:"mobile/script/widget/widgetretourespace.js"});;
IE.fModule({f:function(exports,require,module,global){const{ObjetRequeteSaisie}=require('ObjetRequeteJSON.js');const Requetes=require('CollectionRequetes.js');class ObjetRequeteSaisieTAFFaitEleve extends ObjetRequeteSaisie{constructor(...aParams){super(...aParams);}
lancerRequete(aParam){this.JSON.listeTAF=aParam.listeTAF.setSerialisateurJSON({methodeSerialisation:_serialiserTAF});return this.appelAsynchrone();}
actionApresRequete(aXml,aGenreReponse){this.callbackReussite.appel(aXml,aGenreReponse,this.JSONRapportSaisie);}}
Requetes.inscrire('SaisieTAFFaitEleve',ObjetRequeteSaisieTAFFaitEleve);function _serialiserTAF(aElement,aJSON){aJSON.TAFFait=aElement.TAFFait;}
module.exports=ObjetRequeteSaisieTAFFaitEleve;},fn:"objetrequetesaisietaffaiteleve.js"});;
IE.fModule({f:function(exports,require,module,global){const EGenreRessource=require('Enumere_Ressource.js');const EGenreBloc={Actu:1,Agenda:2,Discussion:3,Casier:4,Absence:5,Retard:6,TravailAFaire:7,ContenuDeCours:8,SaisiePrim_CDC:9,CahiersDeTexte:10,Billet:11,Activite_Prim:12,InfoSondage:13,CahierJournal:14,EvenementRappel:15};EGenreBloc.associerGenreBlocAListeElements=function(aGenreBloc,aListeElements){for(let i=0,lNbr=aListeElements.GetNbrElements();i<lNbr;i++){const lElement=aListeElements.GetElement(i);lElement.genreBloc=aGenreBloc;}};EGenreBloc.estBlocVS=function(aGenreBloc){switch(aGenreBloc){case EGenreBloc.Absence:case EGenreBloc.Retard:return true;default:return false;}};EGenreBloc.getGenreBlocDeRessource=function(aGenreRessource){switch(aGenreRessource){case EGenreRessource.Absence:return EGenreBloc.Absence;case EGenreRessource.Retard:return EGenreBloc.Retard;default:;}};EGenreBloc.associerGenreBlocAListeElementsVS=function(aListeElements){for(let i=0,lNbr=aListeElements.GetNbrElements();i<lNbr;i++){const lElement=aListeElements.GetElement(i);lElement.genreBloc=EGenreBloc.getGenreBlocDeRessource(lElement.Genre);}};module.exports.EGenreBloc=EGenreBloc;},fn:"enumere_bloc.js"});;
IE.fModule({f:function(exports,require,module,global){const{ObjetRequeteSaisie}=require('ObjetRequeteJSON.js');const Requetes=require('CollectionRequetes.js');class ObjetRequeteSaisieTAFARendreEleve extends ObjetRequeteSaisie{constructor(...aParams){super(...aParams);}
lancerRequete(aListeFichiers){if(aListeFichiers){this.JSON.listeFichiers=aListeFichiers.setSerialisateurJSON({methodeSerialisation:_serialiserFichier});}
return this.appelAsynchrone();}
actionApresRequete(aXml,aGenreReponse){this.callbackReussite.appel(aXml,aGenreReponse,this.JSONRapportSaisie);}}
Requetes.inscrire('SaisieTAFARendreEleve',ObjetRequeteSaisieTAFARendreEleve);function _serialiserFichier(aElement,aJSON){aJSON.idFichier=aElement.idFichier;aJSON.TAF=aElement.TAF;}
module.exports=ObjetRequeteSaisieTAFARendreEleve;},fn:"objetrequetesaisietafarendreeleve.js"});;
IE.fModule({f:function(exports,require,module,global){const MethodesObjet=require('MethodesObjet.js');const ObjetElement=require('ObjetElement.js');const ObjetListeElements=require('ObjetListeElements.js');const GTraductions=require('ObjetTraduction.js');const ObjetTri=require('ObjetTri.js');const TypeNiveauDifficulte={ND_NonPrecise:0,ND_Facile:1,ND_Moyen:2,ND_Difficile:3};module.exports.TypeNiveauDifficulte=TypeNiveauDifficulte;TypeNiveauDifficulte.typeToStr=function(aNiveauDifficulte,aAvecValPourNonPrecise){if(!aAvecValPourNonPrecise&&aNiveauDifficulte===TypeNiveauDifficulte.ND_NonPrecise){return'';}
return GTraductions.getValeur('TypeNiveauDifficulte.'+aNiveauDifficulte);};TypeNiveauDifficulte.getImage=function(aParams){return aParams.niveauDifficulte?['<div',(aParams.alignementMilieu||aParams.enInlineBlock?' class="'+(aParams.alignementMilieu?'AlignementMilieu':'')+' '+(aParams.enInlineBlock?'InlineBlock':'')+'" ':''),(aParams.avecTitle||aParams.avecTitle===null||aParams.avecTitle===undefined?' title="'+this.typeToStr(aParams.niveauDifficulte,aParams.avecValPourNonPrecise)+'"':''),'>',this.construireIcon(aParams),'</div>'
].join(''):'';};TypeNiveauDifficulte.construireIcon=function(aParams){switch(aParams.niveauDifficulte){case TypeNiveauDifficulte.ND_Facile:return creerIconEtoile([1,0,0],aParams.color);case TypeNiveauDifficulte.ND_Moyen:return creerIconEtoile([1,1,0],aParams.color);case TypeNiveauDifficulte.ND_Difficile:return creerIconEtoile([1,1,1],aParams.color);default:return'';}};function creerIconEtoile(aArrayEtoiles,aColor){const lResult=[];let lStyle='';if(aColor){lStyle=' style="color:'+aColor+';"';}
for(const i in aArrayEtoiles){let lIcon='icon_star_empty';if(aArrayEtoiles[i]){lIcon='icon_star';}
lResult.push('<i class="material-icons ',lIcon,'"',lStyle,'></i>');}
return lResult.join('');}
TypeNiveauDifficulte.toElement=function(aGenre,aAvecValPourNonPrecise){return new ObjetElement(TypeNiveauDifficulte.typeToStr(aGenre,aAvecValPourNonPrecise),0,aGenre);};TypeNiveauDifficulte.fromElement=function(aElement){return(aElement!==null)&&(aElement!==undefined)?aElement.GetGenre():TypeNiveauDifficulte.ND_NonPrecise;};TypeNiveauDifficulte.toListe=function(aAvecValPourNonPrecise){const lListeNiveaux=new ObjetListeElements();for(const iNiveau in TypeNiveauDifficulte){const lNiveau=TypeNiveauDifficulte[iNiveau];if(MethodesObjet.isNumber(lNiveau)){lListeNiveaux.AddElement(TypeNiveauDifficulte.toElement(lNiveau,aAvecValPourNonPrecise));}}
lListeNiveaux.setTri([ObjetTri.init('Genre')]);lListeNiveaux.trier();return lListeNiveaux;};},fn:"typeniveaudifficulte.js"});;
IE.fModule({f:function(exports,require,module,global){const TypeOrigineCreationCategorieCahierDeTexte={OCCCDT_Utilisateur:0,OCCCDT_Pre_Cours:1,OCCCDT_Pre_Correction:2,OCCCDT_Pre_Devoir:3,OCCCDT_Pre_Interro:4,OCCCDT_Pre_TD:5,OCCCDT_Pre_TP:6,OCCCDT_Pre_Evaluation:7,OCCCDT_Pre_EPI:8,OCCCDT_Pre_AP:9,OCCCDT_Pre_Mod_Peda_Oral:10,OCCCDT_Pre_Mod_Peda_Ecrit:11,OCCCDT_Pre_LienVisio:12};module.exports.TypeOrigineCreationCategorieCahierDeTexte=TypeOrigineCreationCategorieCahierDeTexte;const MethodesTableau=require('MethodesTableau.js');class TypeOrigineCreationCategorieCahierDeTexteUtil{static getImage(aGenre){switch(aGenre){case TypeOrigineCreationCategorieCahierDeTexte.OCCCDT_Pre_Devoir:return'Image_IconeDS';case TypeOrigineCreationCategorieCahierDeTexte.OCCCDT_Pre_Evaluation:return'Image_IconeEvaluation';case TypeOrigineCreationCategorieCahierDeTexte.OCCCDT_Pre_EPI:return'Image_IconeEPI';case TypeOrigineCreationCategorieCahierDeTexte.OCCCDT_Pre_AP:return'Image_IconeAP';case TypeOrigineCreationCategorieCahierDeTexte.OCCCDT_Pre_LienVisio:return'Image_CoursVirtuelCDT';}
return'';}
static getListeTypesAvecImage(){return[
TypeOrigineCreationCategorieCahierDeTexte.OCCCDT_Pre_Devoir,TypeOrigineCreationCategorieCahierDeTexte.OCCCDT_Pre_Evaluation,TypeOrigineCreationCategorieCahierDeTexte.OCCCDT_Pre_EPI,TypeOrigineCreationCategorieCahierDeTexte.OCCCDT_Pre_AP,TypeOrigineCreationCategorieCahierDeTexte.OCCCDT_Pre_LienVisio
];}
static estTypeAvecImage(aType){return MethodesTableau.existe(aType,TypeOrigineCreationCategorieCahierDeTexteUtil.getListeTypesAvecImage());}}
module.exports.TypeOrigineCreationCategorieCahierDeTexteUtil=TypeOrigineCreationCategorieCahierDeTexteUtil;},fn:"typeoriginecreationcategoriecahierdetexte.js"});;
IE.fModule({f:function(exports,require,module,global){const ObjetFenetre=require('ObjetFenetre.js');const GTraductions=require('ObjetTraduction.js');const TypeThemeBouton=require('Type_ThemeBouton.js');const GPosition=require('GPosition.js');const GHtml=require('GHtml.js');class ObjetFenetre_Bloc extends ObjetFenetre{constructor(...aParams){super(...aParams);this._donnees={element:null,gestionnaireBloc:null};this._idBloc=this.Nom+'_fenetre_bloc';this.idScroll=this.Nom+'_scroll';this.setOptionsFenetre({avecTitre:false,largeur:600,hauteur:150,marge:7,listeBoutons:[{libelle:GTraductions.getValeur('Fermer'),index:0,theme:TypeThemeBouton.secondaire}],avecPaddingContenu:false,positionnerFenetreSurAfficher:false});this.setLargeurMin(this.optionsFenetre.largeurMin);this.hauteurMax=GNavigateur.EcranH-120;}
setLargeurMin(aValeur){if(aValeur!==this.optionsFenetre.largeurMin){this.setOptionsFenetre({largeurMin:aValeur});}
this.largeurMax=GNavigateur.EcranL-100;if(this.largeurMax<this.optionsFenetre.largeurMin){this.largeurMax=this.optionsFenetre.largeurMin;}}
SetDonnees(aDonnees){$.extend(this._donnees,aDonnees);this.Actualiser();this.Afficher();this.remplirBlocs();this.apresAfficher();this.$refreshSelf();}
remplirBlocs(){if(!!this._donnees.liste){const nbElements=this._donnees.liste.GetNbrElements();for(let i=0;i<nbElements;i++){const aElement=this._donnees.liste.GetElement(i);this.ajouterElementAuBloc(aElement,i);}} else{this.ajouterElementAuBloc(this._donnees.element,0);}}
ajouterElementAuBloc(aElement,aIndice){const lEltBloc=this.composeElementBloc(aElement);if(lEltBloc){let lElementAvecMarge='';if(aIndice>0){lElementAvecMarge='<div style="margin: 2px 10px 5px 10px;" ><hr style="border-color: '+GCouleur.themeNeutre.light+';" /></div>';}
lElementAvecMarge+='<div>'+lEltBloc.html+'</div>';GHtml.addHtml(this._idBloc,lElementAvecMarge,{controleur:lEltBloc.controleur});}}
composeElementBloc(aElement){if(this._donnees.gestionnaireBloc!==null){return this._donnees.gestionnaireBloc.composeBlocComplet(aElement);}}
infoOverflow(aWidthBtnAction){const lResult={avecOverflow:false,scrollWidth:this.optionsFenetre.largeurMin-aWidthBtnAction,scrollHeight:0};const lJqElm=$('#'+this._idBloc.escapeJQ()).find('.PourFenetreBloc_Contenu');lJqElm.each(function(index,element){if(lResult.scrollWidth<element.scrollWidth){if(element.scrollWidth===this.largeurMax-20-aWidthBtnAction){$(element).width(lResult.scrollWidth);if(element.scrollWidth>lResult.scrollWidth){lResult.scrollWidth=element.scrollWidth;}
$(element).css('width','auto');} else{lResult.scrollWidth=element.scrollWidth;}}
if(lResult.scrollHeight<element.scrollHeight){lResult.scrollHeight=element.scrollHeight;}}.bind(this));if(lResult.scrollWidth>this.largeurMax-20-aWidthBtnAction){lResult.avecOverflow=true;}
return lResult;}
apresAfficher(){if(!!this._donnees.gestionnaireBloc){this._donnees.gestionnaireBloc.refresh();GPosition.placer(this.Nom,0,0);if(this.idScroll){const lJqScroll=$('#'+this.idScroll.escapeJQ());if(lJqScroll.length===1){let lNewWidth=this.largeurMax;const lJqBloc=$('#'+this._idBloc.escapeJQ());const lHeight=lJqBloc.outerHeight(true);const lWidth=lJqBloc.outerWidth(true)+5;const lRatioHeight=((lHeight+this.hauteurMax)/(this.hauteurMax*2));const lRatioWidth=(lWidth+this.largeurMax)/(this.largeurMax*2);const lWidthBtnAction=this._donnees.gestionnaireBloc._instances&&this._donnees.gestionnaireBloc._instances.length>0?this._donnees.gestionnaireBloc._instances[0].getWidthBtnAction():0;const lInfoOverflow=this.infoOverflow(lWidthBtnAction);const lJqContenu=lJqBloc.find('.PourFenetreBloc_Contenu');if((((lHeight<this.hauteurMax)&&(lWidth>=this.largeurMax))||(lRatioHeight<lRatioWidth)||((lRatioHeight>1)&&(lRatioWidth<1)))&&!lInfoOverflow.avecOverflow){lNewWidth=Math.max(Math.ceil(this.largeurMax*lRatioHeight),this.optionsFenetre.largeurMin,lInfoOverflow.scrollWidth+20+lWidthBtnAction);lNewWidth=Math.min(lNewWidth,this.largeurMax);lJqScroll.css({"maxWidth":lNewWidth});lJqContenu.css({"maxWidth":lNewWidth-20-lWidthBtnAction});}
if(lInfoOverflow.avecOverflow){lJqContenu.each(function(index,element){$(element).css({"overflow":""});$(element).css({"maxWidth":""});$(element).width(lInfoOverflow.scrollWidth);$(element).parents('.UtilitaireBloc_containerNormal').first().css({"justify-content":"flex-start"});});}}}
if(this._donnees.coordonnees){GPosition.placer(this.Nom,this._donnees.coordonnees.left,this._donnees.coordonnees.top);this.setCoordonnees();} else{GPosition.centrer(this.Nom);}}}
ComposeContenu(){const T=[];const lHauteurZoneDeplacement=this.optionsFenetre.marge+16;T.push('<div class="ZoneDeplacementFenetre" style="position:absolute;width:100%; height: ',lHauteurZoneDeplacement,'px; top: -',lHauteurZoneDeplacement,'px; left:0px; z-index:100;"></div>');T.push('<div id="',this.idScroll,'" class="overflow-auto" style="width:100%; height:100%; max-height:',this.hauteurMax,'px; max-width:',this.largeurMax,'px;">');T.push('<div id="',this._idBloc,'"></div>');T.push('</div>');return T.join('');}}
module.exports=ObjetFenetre_Bloc;},fn:"objetfenetre_bloc.js"});;
IE.fModule({f:function(exports,require,module,global){const Identite=require('ObjetIdentite.js');const GStyle=require('GStyle.js');const{GDate}=require('ObjetDate.js');const GTraductions=require('ObjetTraduction.js');const ObjetFenetre=require('ObjetFenetre.js');const EModeAffichage=require('Enumere_ModeAffichageTimeline.js');const ObjetFenetre_Bloc=require('ObjetFenetre_Bloc.js');function TUtilitaireCDT(){}
TUtilitaireCDT.strtMatiere=function(aMatiere,aListeGroupes,aPourFiche){const H=[];H.push('<div class="InlineBlock" style="float: left; margin-right: 3px; width: 8px; height: 12px; ',GStyle.composeCouleurFond(aMatiere.CouleurFond),'"></div>','<div class="InlineBlock',aPourFiche?' Move':'','">','<span class="Gras">',aMatiere.GetLibelle()?aMatiere.GetLibelle():'&nbsp;','</span>',aListeGroupes?(' ('+aListeGroupes.getTableauLibelles().join(', ')+')'):'','</div>');return H.join('');};TUtilitaireCDT.strtDate=function(aDate){const H=[];H.push(aDate?GTraductions.getValeur('CahierDeTexte.le')+GDate.FormatDate(aDate,' %JJ %MMMM %AAAA '+GTraductions.getValeur('CahierDeTexte.a')+' %hh%sh%mm'):'');return H.join('');};TUtilitaireCDT.afficheFenetreDetail=function(aObjetDonnee,aParams,aOptions){if(this.fenetreCDT){this._coordonneesFenetreCDT=this.fenetreCDT.coordonnees;this.fenetreCDT.Fermer();} else{this._coordonneesFenetreCDT=null;}
let lGestionnaireBloc;const lParams={fenetre:true};if(aParams){$.extend(lParams,aParams);}
lGestionnaireBloc=Identite.creerInstance(aObjetDonnee.gestionnaire,{pere:this,evenement:lParams.evenementSurBlocCDT?lParams.evenementSurBlocCDT.bind(this,lParams):this.evenementSurBlocCDT.bind(this,lParams)});const lOptions={avecPastille:false,modeAffichage:EModeAffichage.classique,formatDate:'%JJJ %JJ %MMM',avecZoneAction:false,avecBordure:false,avecOmbre:false,initPlie:false,callBackTitre:undefined};if(aOptions){$.extend(lOptions,aOptions);}
lGestionnaireBloc.setOptions(lOptions);const lObjDonnees={gestionnaireBloc:lGestionnaireBloc};if(aObjetDonnee){lObjDonnees.element=aObjetDonnee;}
if(this._coordonneesFenetreCDT&&this._coordonneesFenetreCDT.left!==null&&this._coordonneesFenetreCDT.top!==null){lObjDonnees.coordonnees=this._coordonneesFenetreCDT;}
this.fenetreCDT=ObjetFenetre.creerInstance(ObjetFenetre_Bloc,{pere:this,initialiser:false});this.fenetreCDT.setOptionsFenetre({modale:false});this.fenetreCDT.Initialiser();this.fenetreCDT.SetDonnees(lObjDonnees);};module.exports=TUtilitaireCDT;},fn:"utilitairecdt.js"});;
IE.fModule({f:function(exports,require,module,global){require('video.min.js');require('video-js.min.css');require('RecordRTC.js');require('adapter.js');require('wavesurfer.min.js');require('wavesurfer.microphone.min.js');require('videojs.wavesurfer.min.js');require('videojs.wavesurfer.min.css');require('videojs.record.min.js');require('videojs.record.min.css');require('lang/fr.js')
;require('videojs.record.vmsg.min.js');require('IEHtml.VideoJS.css');const deferLoadingScript=require('deferLoadingScript.js');const IEHtml=require('IEHtml.js');const GUID=require('GUID.js');IEHtml.addBalise('ie-videojs',function(aContexteCourant,aOutils){const lId=aContexteCourant.node&&aContexteCourant.node.id?aContexteCourant.node.id:GUID.getId(),lDebug=true,lInfosApi=aOutils.getAccesParametresModel('api',aContexteCourant),lInfosGetOptions=aOutils.getAccesParametresModel('getOptions',aContexteCourant),lInfosFinishRecordCallback=aOutils.getAccesParametresModel('getFinishRecordCallback',aContexteCourant),lJqDivConteneur=$('<video id="'+lId+'" class="video-js vjs-skin-colors-pronote" controls preload="auto"><p class="vjs-no-js"><a href="https://videojs.com/html5-video-support/" target="_blank"></a></p></video>'),lDivConteneur=lJqDivConteneur.get(0);let lPlayer=null;let lOptions={controls:true,controlBar:{children:['playToggle','volumePanel','currentTimeDisplay','timeDivider','durationDisplay','progressControl','image'
]},liveui:true,bigPlayButton:false,loop:false,fluid:false,width:320,height:130,plugins:{record:{image:false,audio:true,video:false,maxLength:5,debug:lDebug,audioEngine:'vmsg',audioWebAssemblyURL:'vmsg.wasm'}}};lJqDivConteneur.on('destroyed',function(){const lPlayerRecord=!!lPlayer&&lPlayer.record();if(!!lPlayerRecord&&!!lPlayerRecord.stopDevice){lPlayerRecord.stopDevice();}
if(lInfosApi.estFonction){lInfosApi.callback([null]);}});const lApi={getRecordedData:function(){return!!lPlayer&&lPlayer.recordedData;},getDuration:function(){const lPlayerRecord=!!lPlayer&&lPlayer.record();return!!lPlayerRecord&&!!lPlayerRecord.getDuration&&lPlayerRecord.getDuration();},getPlayer:function(){return lPlayer;}};const lInit=function(){if(lInfosGetOptions.estFonction){const lOptionsPerso=lInfosGetOptions.callback();if(lOptionsPerso){lOptions=videojs.mergeOptions(lOptions,lOptionsPerso);}}
if(lOptions.plugins.record.audio&&!lOptions.plugins.record.video){lOptions.plugins.wavesurfer={backend:'WebAudio',backgroundColor:'#ffffff',waveColor:'#222222',progressColor:'black',displayMilliseconds:true,debug:lDebug,cursorWidth:1,hideScrollbar:true,plugins:[
WaveSurfer.microphone.create({bufferSize:4096,numberOfInputChannels:1,numberOfOutputChannels:1,constraints:{video:false,audio:true}})
]};}
lPlayer=videojs(lId,lOptions,function(){if(lDebug){const msg='Using video.js '+videojs.VERSION+' with videojs-record '+videojs.getPluginVersion('record')+', videojs-wavesurfer '+videojs.getPluginVersion('wavesurfer')+', wavesurfer.js '+WaveSurfer.VERSION+' and recordrtc '+
RecordRTC.version;videojs.log(msg);console.log("videojs-record is ready!");}
lPlayer.controlBar.getChild('playToggle').handlePause();setTimeout(function(){lPlayer.deviceButton.trigger('click');lPlayer.controlBar.getChild('playToggle').show();},200);});if(lInfosApi.estFonction){lInfosApi.callback([lApi]);}};Promise.all([
deferLoadingScript.loadPromise('videojs'),aOutils.surInjectionHtml_promise(aContexteCourant)
]).then(function(){if(lPlayer===null){lInit();lPlayer.on('finishRecord',function(){if(lInfosFinishRecordCallback.estFonction){lInfosFinishRecordCallback.callback();}
IEHtml.refresh();});}});aOutils.replaceNode(aContexteCourant.node,lDivConteneur);aOutils.addCommentaireDebug(lDivConteneur,'ie-videojs');aOutils.copyAttributs(aContexteCourant.node,lDivConteneur);return{node:aContexteCourant.node,avecCompileFils:false};});module.exports=IEHtml;},fn:"iehtml.videojs.js"});;
IE.fModule({f:function(exports,require,module,global){const ObjetFenetre=require('ObjetFenetre.js');const GTraductions=require('ObjetTraduction.js');const TypeThemeBouton=require('Type_ThemeBouton.js');const{GDate}=require('ObjetDate.js');const ObjetListeElements=require('ObjetListeElements.js');const UtilitaireTraitementImage=require('UtilitaireTraitementImage.js');const TUtilitaireUrl=require('UtilitaireUrl.js');const EGenreEtat=require('Enumere_Etat.js');const UtilitaireSelecFile=require('UtilitaireSelecFile.js');const EGenreDocumentJoint=require('Enumere_DocumentJoint.js');const EGenreAction=require('Enumere_Action.js');const UtilitaireAudio=require('UtilitaireAudio.js');require('IEHtml.VideoJS.js');const GUID=require('GUID.js');require('ObjetFenetre_UploadFichiers.css');class ObjetFenetre_UploadFichiers extends ObjetFenetre{constructor(...aParams){super(...aParams);this.setOptionsFenetre({modale:true,titre:GTraductions.getValeur('FenetreUploadFichiers.Titre'),largeur:400,hauteur:320,listeBoutons:[]});this.optionsFenetreUpload={libelleContexteFenetre:null,tailleMaxUploadFichier:0,avecRetaillageImage:true,avecGenerationPDFImages:true,functionGetNomPdfGenere:null,avecEnregistrement:false,avecAudioUniquement:false,avecUploadPlusieursImages:true,maxLengthAudio:30};this.idvideo=GUID.getId();this.donnees={genreRessourcePJ:null,listeFichiersEnAttente:new ObjetListeElements()};}
setOptions(aOptions){$.extend(this.optionsFenetreUpload,aOptions);}
getControleur(aInstance){return $.extend(true,super.getControleur(this),{BoutonFichierAudio:{getDisabled:function(){return!aInstance.api_videoJS||!!aInstance.api_videoJS.getDuration()===false;},event:function(){const lListeFichier=new ObjetListeElements();UtilitaireSelecFile.addFileDansListe(aInstance.api_videoJS.getRecordedData(),lListeFichier,aInstance.donnees.genreRessourcePJ);aInstance.callback.appel(EGenreAction.Valider,lListeFichier);}},BoutonUnSeulFichier:{getLibelle:function(){if(aInstance.optionsFenetreUpload.avecAudioUniquement&&!aInstance.optionsFenetreUpload.avecUploadPlusieursImages){return GTraductions.getValeur('FenetreUploadFichiers.BoutonFichierAudio');} else{return GTraductions.getValeur('FenetreUploadFichiers.BoutonUnSeulFichier');}},getOptionsSelecFile:function(){const lObjet={maxSize:aInstance.optionsFenetreUpload.tailleMaxUploadFichier};if(aInstance.optionsFenetreUpload.avecAudioUniquement&&!aInstance.optionsFenetreUpload.avecUploadPlusieursImages){lObjet.accept=UtilitaireAudio.getTypeMimeAudio();lObjet.avecTransformationFlux=false;}
return lObjet;},addFiles:function(aParams){aInstance.callback.appel(EGenreAction.Valider,new ObjetListeElements().AddElement(aParams.eltFichier));}},BoutonPlusieursImages:{getOptionsSelecFile:function(){const lOptionsSelecFile={maxSize:aInstance.optionsFenetreUpload.tailleMaxUploadFichier,multiple:true,maxFiles:20,avecResizeImage:aInstance.optionsFenetreUpload.avecRetaillageImage};if(!aInstance.optionsFenetreUpload.avecGenerationPDFImages){lOptionsSelecFile.accept='image/*';}
if(aInstance.optionsFenetreUpload.avecGenerationPDFImages){lOptionsSelecFile.genererPDFImages=true;lOptionsSelecFile.nomPDFaGenerer=_getNomPdfGenere.call(aInstance);lOptionsSelecFile.avecTransformationFlux=false;}
return lOptionsSelecFile;},addFiles:function(aParams){aInstance.callback.appel(EGenreAction.Valider,aParams.listeFichiers);}},BoutonAjoutImageUnique:{getOptionsSelecFile:function(){const lOptionsSelectFile={avecResizeImage:aInstance.optionsFenetreUpload.avecRetaillageImage,maxSize:aInstance.optionsFenetreUpload.tailleMaxUploadFichier,multiple:false,avecTransformationFlux:false};if(aInstance.optionsFenetreUpload.avecGenerationPDFImages){lOptionsSelectFile.accept=UtilitaireTraitementImage.getTabMIME_PDFImage().join(', ');}
return lOptionsSelectFile;},addFiles:function(aParams){const lFichier=aParams.eltFichier;aInstance.donnees.listeFichiersEnAttente.AddElement(lFichier);}},getHtmlFichiersEnAttente:function(){return TUtilitaireUrl.construireListeUrls(aInstance.donnees.listeFichiersEnAttente,{genreRessource:aInstance.donnees.genreRessourcePJ,separateur:'<div class="InlineBlock" style="width:1rem;"> </div>',IEModelChips:'ChipsFichierEnAttente'});},ChipsFichierEnAttente:{eventBtn:function(aIndice){const lFichierASupp=aInstance.donnees.listeFichiersEnAttente.GetElement(aIndice);if(!!lFichierASupp){lFichierASupp.SetEtat(EGenreEtat.Suppression);}}},BoutonEnvoiFichiersEnAttente:{event:function(){if(!!aInstance.donnees.listeFichiersEnAttente){let lListeFichiersAEnvoyer=new ObjetListeElements();lListeFichiersAEnvoyer=aInstance.donnees.listeFichiersEnAttente.getListeElements(function(aElement){return aElement.Existe();});if(lListeFichiersAEnvoyer.GetNbrElements()>0){if(aInstance.optionsFenetreUpload.avecGenerationPDFImages){const lNomPDF=_getNomPdfGenere.call(aInstance);const lMessagesErreur=[];UtilitaireSelecFile.genererPdfPromise(lListeFichiersAEnvoyer,lMessagesErreur,lNomPDF,EGenreDocumentJoint.Fichier).then(function(){lListeFichiersAEnvoyer=UtilitaireSelecFile.controleTailleFichiers(lListeFichiersAEnvoyer,lMessagesErreur,aInstance.optionsFenetreUpload.tailleMaxUploadFichier);if(lMessagesErreur.length>0){return GApplication.getMessage().afficher({message:lMessagesErreur.join('<br>')});} else{const lFichierPdfGenere=lListeFichiersAEnvoyer.GetElement(0);aInstance.callback.appel(EGenreAction.Valider,new ObjetListeElements().AddElement(lFichierPdfGenere));}});} else{aInstance.callback.appel(EGenreAction.Valider,lListeFichiersAEnvoyer);}}}},getDisabled:function(){return!aInstance.donnees.listeFichiersEnAttente||aInstance.donnees.listeFichiersEnAttente.GetNbrElementsExistes()===0;}},GetVideo:{api:function(aApi){aInstance.api_videoJS=aApi;},getOptions:function(){return{plugins:{record:{image:false,audio:true,video:false,maxLength:aInstance.optionsFenetreUpload.maxLengthAudio}}};}}});}
Fermer(){super.Fermer();if(this.optionsFenetreUpload.avecEnregistrement&&this.idvideo){const lPlayer=videojs(this.idvideo);const lPlayerRecord=!!lPlayer&&lPlayer.record();if(!!lPlayerRecord&&!!lPlayerRecord.stopDevice){lPlayerRecord.stopDevice();}}}
setDonnees(aGenreRessourcePieceJointe,aOptionsFenetre){this.donnees.genreRessourcePJ=aGenreRessourcePieceJointe;if(!!aOptionsFenetre){Object.assign(this.optionsFenetreUpload,aOptionsFenetre);}}
afficher(){const lContenuFenetre=composeContenuFenetre.call(this);this.Afficher(lContenuFenetre);}}
function _getNomPdfGenere(){let lNomPDF;if(!!this.optionsFenetreUpload.functionGetNomPdfGenere){lNomPDF=this.optionsFenetreUpload.functionGetNomPdfGenere();if(!!lNomPDF){lNomPDF=lNomPDF.replace(/ /g,"");}}
if(!lNomPDF){lNomPDF=GDate.FormatDate(GDate.getDateHeureCourante(),'%JJ%MM%AAAA_%hh%mm%ss')+'.pdf';}
return lNomPDF;}
function _composeZoneAjoutImageUnique(){const H=[];H.push('<div id="libelleExplicationSelectionUnique">',GTraductions.getValeur('FenetreUploadFichiers.SelectionUneParUne'),'</div>');H.push('<div>','<ie-bouton ie-model="BoutonAjoutImageUnique" ie-selecfile class="BoutonSelecteurFichier ',TypeThemeBouton.secondaire,'">',GTraductions.getValeur('FenetreUploadFichiers.BoutonUneImage'),'</ie-bouton>','</div>');H.push('<div id="listeFichiersEnAttente" ie-html="getHtmlFichiersEnAttente"></div>');H.push('<div id="wrapperBoutonEnvoiFichiersEnAttente">','<ie-bouton ie-model="BoutonEnvoiFichiersEnAttente" class="',TypeThemeBouton.secondaire,'">',GTraductions.getValeur('FenetreUploadFichiers.EnvoyerImages'),'</ie-bouton>','</div>');return H.join('');}
function composeContenuFenetre(){const H=[];H.push('<div class="FenetreUploadFichiers">');if(!!this.optionsFenetreUpload.libelleContexteFenetre){H.push('<div id="libelleContexte">',this.optionsFenetreUpload.libelleContexteFenetre,'</div>');}
H.push('<div id="ChoixTypeUpload">');if(this.optionsFenetreUpload.avecEnregistrement||this.optionsFenetreUpload.avecUploadPlusieursImages){H.push('<div>',GTraductions.getValeur('FenetreUploadFichiers.ChoisissezNatureFichier'),'</div>');}
if(this.optionsFenetreUpload.avecEnregistrement){H.push('<div style="display: flex; flex-direction: column; align-items: center;">','<ie-videojs id="',this.idvideo,'" ie-model="GetVideo"></ie-videojs>','<ie-bouton ie-model="BoutonFichierAudio" class="BoutonSelecteurFichier ',TypeThemeBouton.secondaire,'">',GTraductions.getValeur('FenetreUploadFichiers.deposerAudio'),'</ie-bouton>','</div>');H.push('<div id="libelleOu">',GTraductions.getValeur('FenetreUploadFichiers.ou'),'</div>');}
H.push('<div>','<ie-bouton ie-model="BoutonUnSeulFichier" ie-selecfile class="BoutonSelecteurFichier ',TypeThemeBouton.secondaire,'">','</ie-bouton>','</div>');if(this.optionsFenetreUpload.avecUploadPlusieursImages){H.push('<div id="libelleOu">',GTraductions.getValeur('FenetreUploadFichiers.ou'),'</div>');H.push('<div>','<ie-bouton ie-model="BoutonPlusieursImages" ie-selecfile class="BoutonSelecteurFichier ',TypeThemeBouton.secondaire,'">',GTraductions.getValeur('FenetreUploadFichiers.BoutonPlusieursImages'),'</ie-bouton>','</div>');H.push('</div>');H.push('<div id="SelectionUnitaire">',_composeZoneAjoutImageUnique.call(this),'</div>');}
H.push('</div>');return H.join('');}
module.exports=ObjetFenetre_UploadFichiers;},fn:"objetfenetre_uploadfichiers.js"});;
IE.fModule({f:function(exports,require,module,global){const ObjetFenetre=require('ObjetFenetre.js');const TUtilitaireUrl=require('UtilitaireUrl.js');const ObjetListeElements=require('ObjetListeElements.js');const GTraductions=require('ObjetTraduction.js');const TypeFichierExterneHttpSco=require('TypeFichierExterneHttpSco.js').TypeFichierExterneHttpSco;class ObjetFenetre_CorrectionTaf extends ObjetFenetre{constructor(...aParams){super(...aParams);this.setOptionsFenetre({modale:true,titre:GTraductions.getValeur('CahierDeTexte.TAFARendre.Eleve.CorrectionDeLEnseignant'),largeur:400,hauteur:150,fermerFenetreSurClicHorsFenetre:true,avecCroixFermeture:!GEtatUtilisateur.estEspaceMobile()});this.donnees={taf:null};}
setTAF(aTaf){this.donnees.taf=aTaf;}
getControleur(aInstance){return $.extend(true,super.getControleur(this),{estDocumentCorrigeVisible:function(){return!!aInstance.donnees.taf&&!!aInstance.donnees.taf.documentCorrige;},getHtmlDocumentCorrige:function(){const lHtml=[];if(!!aInstance.donnees.taf&&!!aInstance.donnees.taf.documentCorrige){lHtml.push(TUtilitaireUrl.construireListeUrls(new ObjetListeElements().add(aInstance.donnees.taf.documentCorrige),{genreRessource:TypeFichierExterneHttpSco.TAFCorrigeRenduEleve}));}
return lHtml.join('');},estCommentaireCorrigeVisible:function(){return!!aInstance.donnees.taf&&!!aInstance.donnees.taf.commentaireCorrige;},getHtmlCommentaireCorrige:function(){const lHtml=[];if(!!aInstance.donnees.taf&&!!aInstance.donnees.taf.commentaireCorrige){lHtml.push(aInstance.donnees.taf.commentaireCorrige);}
return lHtml.join('');}});}
ComposeContenu(){const T=[];T.push('<div>');T.push('<div ie-if="estDocumentCorrigeVisible" ie-html="getHtmlDocumentCorrige"></div>');T.push('<div ie-if="estCommentaireCorrigeVisible" ie-html="getHtmlCommentaireCorrige" class="EspaceHaut10"></div>');T.push('</div>');return T.join('');}}
module.exports=ObjetFenetre_CorrectionTaf;},fn:"objetfenetre_correctiontaf.js"});;
IE.fModule({f:function(exports,require,module,global){const{TypeDroits}=require('ObjetDroitsPN.js');const Callback=require('Callback.js');const GUID=require('GUID.js');const MethodesObjet=require('MethodesObjet.js');const MethodesTableau=require('MethodesTableau.js');const GChaine=require('GChaine.js');const GHtml=require('GHtml.js');const GStyle=require('GStyle.js');const EGenreEtat=require('Enumere_Etat.js');const EGenreBloc=require('Enumere_Bloc.js').EGenreBloc;const{GDate}=require('ObjetDate.js');const GImage=require('ObjetImage.js');const ObjetElement=require('ObjetElement.js');const ObjetListeElements=require('ObjetListeElements.js');const GTraductions=require('ObjetTraduction.js');const ObjetTri=require('ObjetTri.js');const{GObjetWAI,EGenreRole}=require('ObjetWAI.js');const EGenreAffichageCahierDeTextes=require('Enumere_AffichageCahierDeTextes.js');const EGenreEspace=require('Enumere_Espace.js');const EGenreRessource=require('Enumere_Ressource.js');const ObjetRequeteSaisieTAFARendreEleve=require('ObjetRequeteSaisieTAFARendreEleve.js');const TypeGenreRenduTAF=require('TypeGenreRenduTAF.js').TypeGenreRenduTAF;const TypeNiveauDifficulte=require('TypeNiveauDifficulte.js').TypeNiveauDifficulte;const{TypeOrigineCreationCategorieCahierDeTexte,TypeOrigineCreationCategorieCahierDeTexteUtil}=require('TypeOrigineCreationCategorieCahierDeTexte.js');const TUtilitaireCDT=require('UtilitaireCDT.js');const UtilitaireQCM=require('UtilitaireQCM.js').UtilitaireQCM;const TypeFichierExterneHttpSco=require('TypeFichierExterneHttpSco.js').TypeFichierExterneHttpSco;const ObjetFenetre=require('ObjetFenetre.js');const EGenreAction=require('Enumere_Action.js');const ObjetFenetre_UploadFichiers=require('ObjetFenetre_UploadFichiers.js');const ObjetFenetre_CorrectionTaf=require('ObjetFenetre_CorrectionTaf.js');const EGenreBoiteMessage=require('Enumere_BoiteMessage.js');const UtilitaireAudio=require('UtilitaireAudio.js');class ObjetUtilitaireCahierDeTexte{constructor(aNom,aPere,aEvenement){this.Nom=aNom;this.pere=aPere;this.evenement=aEvenement;this.callback=new Callback(this.pere,aEvenement);this.peuFaireTAF=MethodesTableau.existe(GEtatUtilisateur.GenreEspace,[EGenreEspace.Eleve]);this.idTAFARendre=GUID.getId();}
composeCDC(aElement,aParam){const lHtml=[];for(let i=0;i<aElement.listeContenus.GetNbrElements();i++){const lContenu=aElement.listeContenus.GetElement(i);lHtml.push('<div class="Espace">','<div class="Espace" style="',GStyle.composeCouleur(GCouleur.blanc,GCouleur.noire,GCouleur.themeNeutre.claire),'">');if(MethodesTableau.existe(lContenu.categorie.GetGenre(),[TypeOrigineCreationCategorieCahierDeTexte.OCCCDT_Pre_Devoir,TypeOrigineCreationCategorieCahierDeTexte.OCCCDT_Pre_Evaluation])){lHtml.push('<div style="float: right">',_composeSymboleCategorie(lContenu.categorie.GetGenre()),'</div>');}
lHtml.push('<div>',lContenu.Libelle,(lContenu.categorie.Libelle?(lContenu.Libelle?' - ':'')+lContenu.categorie.Libelle:''),'</div>');lHtml.push('<div>',lContenu.descriptif,'</div>');if(lContenu.ListePieceJointe.GetNbrElements()>0){lHtml.push('<div>',this.composePiecesJointes(lContenu.ListePieceJointe),'</div>');}
if(lContenu.listeExecutionQCM.GetNbrElements()>0){const nbExecutionQCM=lContenu.listeExecutionQCM.GetNbrElements();for(let j=0;j<nbExecutionQCM;j++){const lExecutionQCM=lContenu.listeExecutionQCM.GetElement(j);lHtml.push('<div>',this.getTitreExecutionQCMContenu(aElement.GetNumero()+'_'+lContenu.GetNumero()+'_'+j,lExecutionQCM,aParam.nom),'</div>');}}
lHtml.push('</div>','</div>');}
let lElementProgrammeCDT;if(aElement.listeElementsProgrammeCDT&&aElement.listeElementsProgrammeCDT.GetNbrElements()){lHtml.push('<div class="Espace">','<div class="Espace" style="',GStyle.composeCouleur(GCouleur.blanc,GCouleur.noire,GCouleur.themeNeutre.claire),'">','<div class="Gras">',GTraductions.getValeur('CahierDeTexte.ElementsProgramme'),' :','</div>','<ul>');for(let i=0;i<aElement.listeElementsProgrammeCDT.GetNbrElements();i++){lElementProgrammeCDT=aElement.listeElementsProgrammeCDT.GetElement(i);lHtml.push('<li>',lElementProgrammeCDT.GetLibelle(),'</li>');}
lHtml.push('</ul>','</div>','</div>');}
if(aElement.ListeTravailAFaire.GetNbrElements()){lHtml.push('<div>',this.composeTAF(aElement,aElement.ListeTravailAFaire,true),'</div>');}
return lHtml.join('');}
getTitreExecutionQCM(I,aExecutionQCM,aNom){const H=[];const lAvecAction=aNom&&
UtilitaireQCM.estCliquable(aExecutionQCM);const lAction=lAvecAction?' class="AvecMain Souligne" onclick="'+aNom+'.surExecutionQCM (event, \''+I+'\')"':'';H.push('<div>',aExecutionQCM.estEnPublication===true?GTraductions.getValeur('ExecutionQCM.RepondreQCM'):GDate.FormatDate(aExecutionQCM.dateDebutPublication,''+GTraductions.getValeur('ExecutionQCM.QCMPublieLe')+' %J %MMMM'),' : ','<span',lAction,'>',aExecutionQCM.QCM.GetLibelle(),'</span>','</div>');return H.join('');}
getTitreExecutionQCMContenu(I,aExecutionQCM,aNom){const H=[];const lAvecAction=aNom&&
UtilitaireQCM.estCliquable(aExecutionQCM);const lAction=lAvecAction?' class="AvecMain Souligne" onclick="'+aNom+'.surExecutionQCMContenu (event, \''+I+'\')"':'';H.push('<div>',GTraductions.getValeur('ExecutionQCM.RepondreQCMContenu'),' : ','<span',lAction,'>',aExecutionQCM.QCM.GetLibelle(),'</span>','</div>');return H.join('');}
composePiecesJointes(aListePiecesJointes){const lHtml=[];if(!!aListePiecesJointes){const nbPiecesJointes=aListePiecesJointes.GetNbrElements();for(let I=0;I<nbPiecesJointes;I++){const lPieceJointe=aListePiecesJointes.GetElement(I);lHtml.push('<div>',GChaine.composerUrlLienExterne({documentJoint:lPieceJointe}),'</div>');}}
return lHtml.join('');}
composeTAF(aElement,aListeTAF,aParam,aPourLe){const T=[];const lNbrElements=aElement.ressources?aElement.ressources.GetNbrElements():aListeTAF.GetNbrElements();let lElement,lRessource;let lBandeauDS;let lDonneLe,lNewDonneLe;let lPourLe,lNewPourLe;for(let I=0;I<lNbrElements;I++){if(aElement.ressources){lRessource=aElement.ressources.GetElement(I);lElement=lRessource.estUnDS?lRessource:aListeTAF.GetElementParNumero(lRessource.GetNumero());} else{lElement=aListeTAF.GetElement(I);}
if(lElement.estUnDS){if(!lBandeauDS){T.push('<div style="height:4px; ',GStyle.composeCouleur(GCouleur.themeNeutre.legere,GCouleur.noire),'">&nbsp;</div>');lBandeauDS=true;}
if(lElement.estDevoir){T.push('<div class="NoWrap PetitEspace EspaceGauche">','<div class="InlineBlock GrandEspaceDroit AlignementMilieuVertical" >',lElement.GetLibelle(),'</div>',_composeSymboleCategorie(TypeOrigineCreationCategorieCahierDeTexte.OCCCDT_Pre_Devoir),'</div>');}
if(lElement.estEval){T.push('<div class="NoWrap PetitEspace EspaceGauche">','<div class="InlineBlock GrandEspaceDroit AlignementMilieuVertical" >',lElement.GetLibelle(),'</div>',_composeSymboleCategorie(TypeOrigineCreationCategorieCahierDeTexte.OCCCDT_Pre_Evaluation),'</div>');}} else{const lNbJours=lElement.DonneLe?GDate.GetDifferenceJours(lElement.PourLe,lElement.DonneLe):0;const lStrJours=(lNbJours>1?GTraductions.getValeur('TAFEtContenu.jours'):GTraductions.getValeur('TAFEtContenu.jour')).toLowerCase();lNewDonneLe=GTraductions.getValeur('TAFEtContenu.donneLe')+GDate.FormatDate(lElement.DonneLe,' %JJ/%MM');lNewPourLe=GTraductions.getValeur('CahierDeTexte.pourLe')+GDate.FormatDate(lElement.PourLe,' %JJ/%MM');T.push('<div class="Espace">');if(aPourLe){if(!lPourLe||lPourLe!==lNewPourLe){T.push('<div class="EspaceBas">','<span class="Gras">'+lNewPourLe+'</span><span>','</div>');}} else{if(!lDonneLe||lDonneLe!==lNewDonneLe){T.push('<div class="EspaceBas">','<span class="Gras">'+lNewDonneLe+'</span><span>'+' ['+lNbJours+' '+lStrJours+']</span>','</div>');}}
T.push(this.composeInformationsTAF(lElement,aParam));T.push('<div class="Espace" style="margin-top: 3px; ',GStyle.composeCouleur(GCouleur.blanc,GCouleur.noire,GCouleur.themeNeutre.claire),'">');const lEstQCM=lElement.executionQCM&&lElement.executionQCM.existeNumero();T.push('<div class="NoWrap" style="','position:relative; overflow:auto','">',_composeCBTAFFait.call(this,lElement),'<div class="InlineBlock AlignementHaut" style="',(_estAvecCocheTAFFait.call(this,lElement)?GStyle.composeWidthCalc(14):''),'">',(lEstQCM?this.getTitreExecutionQCM(lElement.GetNumero(),lElement.executionQCM,aParam.nom):lElement.descriptif),(lElement.ListePieceJointe.GetNbrElements()>0?this.composePiecesJointes(lElement.ListePieceJointe):''),'</div>',!aParam||aParam.ignorerTAFFait!==true?_composeLabelTAFFait.call(this,lElement):'','</div>');if(!aParam.listeTAF){aParam.listeTAF=aListeTAF;}
T.push(this.composeTAFARendre(lElement,aParam));T.push('</div>');T.push('</div>');lDonneLe=lNewDonneLe;lPourLe=lNewPourLe;}}
return T.join('');}
composeInformationsTAF(aTaf,aParam){if(!(aTaf.duree||aTaf.niveauDifficulte||(!!aTaf.ListeThemes&&aTaf.ListeThemes.GetNbrElements()))){return'';}
const T=[];let lAvecMargeGauche=false;T.push('<div style="margin-top: 3px; line-height: 14px;">');if(aParam&&aParam.avecDetailTAF){if(aTaf.nomPublic){T.push('<span class="InlineBlock">',GImage.composeImage('Image_TAF_Public'),'</span>','<span class="PetitEspaceGauche InlineBlock">',aTaf.pourTousLesEleves?aTaf.nomPublic:GTraductions.getValeur('CahierDeTexte.TAFARendre.eleves',[aTaf.nbrEleves]),'</span>');}
if(aTaf.avecRendu){T.push(getInfoTAFRendu(aTaf.GetNumero(),aTaf,aParam.nom));}
lAvecMargeGauche=true;}
if(aTaf.duree){const lFormatMin=aTaf.duree>60?'%mm':'%xm';const lStrDuree=GDate.FormatDureeEnMillisecondes(aTaf.duree*60*1000,aTaf.duree>60?'%xh%sh'+lFormatMin:lFormatMin+'mn');T.push('<div class="InlineBlock SansMain" title="',GTraductions.getValeur('CahierDeTexte.DureeEstimee'),'">','<span class="',lAvecMargeGauche?'GrandEspaceGauche ':'','InlineBlock">',GImage.composeImage('Image_TAF_Duree'),'</span>','<span class="PetitEspaceGauche InlineBlock">',lStrDuree,'</span>','</div>');lAvecMargeGauche=true;}
if(aTaf.niveauDifficulte){T.push('<div class="InlineBlock SansMain" title="',GTraductions.getValeur('CahierDeTexte.NiveauDifficulte'),'">','<span class="',lAvecMargeGauche?'GrandEspaceGauche ':'','InlineBlock">',GImage.composeImage('Image_TAF_Niveau'),'</span>','<span class="PetitEspaceGauche InlineBlock">',TypeNiveauDifficulte.typeToStr(aTaf.niveauDifficulte),'</span>','</div>');lAvecMargeGauche=true;}
T.push('</div>');if(!!aTaf.ListeThemes&&aTaf.ListeThemes.GetNbrElements()){T.push('<div style="margin-top: 3px; line-height: 14px;">',GTraductions.getValeur('Themes'),' : ',aTaf.ListeThemes.getTableauLibelles().join(', '),'</div>');}
return T.join('');}
surSupprimer(aNumeroTAF){const lFichier=new ObjetElement(),lListeFichiers=new ObjetListeElements();lListeFichiers.AddElement(lFichier,0);lFichier.TAF=new ObjetElement('',aNumeroTAF);lFichier.SetEtat(EGenreEtat.Suppression);new ObjetRequeteSaisieTAFARendreEleve(this,this.actionSurRequeteSaisieTAFARendreEleve).lancerRequete(lListeFichiers);}
actionSurRequeteSaisieTAFARendreEleve(){this.callback.appel();}
surSurvol(aElement,aSurSurvol,aAvecSouligne){if(aSurSurvol){GHtml.setClass(aElement,'InlineBlock AlignementMilieuVertical LienAccueil AvecMain Souligne');} else{GHtml.setClass(aElement,'InlineBlock AlignementMilieuVertical LienAccueil AvecMain'+(aAvecSouligne?' Souligne':''));}}
execFicheSelecFile(aTaf){return _executerDepotFichierPourTAF.call(this,aTaf);}
utilFicheFileTAF(aInstance,aNumero,aTaf,aParam){let lTaf=aTaf;let lListeTaf=aParam.listeTAF;if(!lListeTaf&&this.instance&&this.instance.donnees){lListeTaf=this.instance.donnees.listeTAF||(!!this.instance.donnees.travailAFaire?this.instance.donnees.travailAFaire.listeTAF:undefined);}
if(lListeTaf){lTaf=lListeTaf.GetElementParNumero(aNumero);}
$(this.node).eventValidation(function(aTaf,aEvent){aEvent.stopPropagation();_executerDepotFichierPourTAF.call(this,aTaf);}.bind(aInstance,lTaf));}
composeTAFARendrePourWidget(aTaf,aParam){const H=[];if(MethodesTableau.existe(GEtatUtilisateur.GenreEspace,[EGenreEspace.Eleve,EGenreEspace.Parent,EGenreEspace.Mobile_Eleve,EGenreEspace.Mobile_Parent,EGenreEspace.PrimEleve,EGenreEspace.Mobile_PrimEleve,EGenreEspace.Mobile_PrimParent,EGenreEspace.Accompagnant,EGenreEspace.Mobile_Accompagnant,EGenreEspace.PrimAccompagnant,EGenreEspace.Mobile_PrimAccompagnant,EGenreEspace.Tuteur,EGenreEspace.Mobile_Tuteur])&&aTaf.avecRendu){const lEstSurEspaceEleve=MethodesTableau.existe(GEtatUtilisateur.GenreEspace,[EGenreEspace.Eleve,EGenreEspace.PrimEleve,EGenreEspace.Mobile_Eleve,EGenreEspace.Mobile_PrimEleve]);H.push('<div class="taf-btn-conteneur">');switch(aTaf.genreRendu){case TypeGenreRenduTAF.GRTAF_RenduPapier:H.push('<span class="as-info-light',(aTaf.TAFFait?' done':''),'">',TypeGenreRenduTAF.getLibelleDeposer(aTaf.genreRendu),'</span>');break;case TypeGenreRenduTAF.GRTAF_RenduPronote:case TypeGenreRenduTAF.GRTAF_RenduPronoteEnregistrementAudio:{if(aTaf.peuRendre&&!aTaf.documentRendu){const lLibelle=TypeGenreRenduTAF.getLibelleDeposer(aTaf.genreRendu,lEstSurEspaceEleve);if(lEstSurEspaceEleve){const lIconEnregistrer=TypeGenreRenduTAF.estUnRenduMedia(aTaf.genreRendu)?'<i class="icon_microphone EspaceDroit"></i>':'';H.push('<a role="button" tabIndex="0" id="',getIdTAFARendre.call(this,aTaf),'" ',_getFicheSelecFile.call(this,aTaf,aParam),' class="as-cta rendu-pn">',lIconEnregistrer,lLibelle,'</a>');} else{H.push('<span class="as-info-light',(aTaf.TAFFait?' done':''),'">',lLibelle,'</span>');}}
if(aTaf.documentRendu){let lIEModelChips=null;if(aTaf.peuRendre&&lEstSurEspaceEleve){lIEModelChips=_getIEModelChipsCopieDeposeeEleve.call(this,aTaf,aParam);}
if(TypeGenreRenduTAF.estUnRenduMedia(aTaf.genreRendu)){const lIEModelAudio=_getIEModelChipsCopieJouerSon.call(this,aTaf,aParam);const lUrl=GChaine.creerUrlBruteLienExterne(aTaf.documentRendu);H.push(UtilitaireAudio.construitChipsAudio({libelle:TypeGenreRenduTAF.getLibelleConsultation(aTaf.genreRendu),url:lUrl,ieModel:lIEModelAudio,argsIEModel:[aTaf.GetNumero(),(aTaf.peuRendre&&lEstSurEspaceEleve)],idAudio:aTaf.GetNumero(),estLien:true}));} else{H.push(GChaine.composerUrlLienExterne({documentJoint:aTaf.documentRendu,genreRessource:TypeFichierExterneHttpSco.TAFRenduEleve,libelleEcran:TypeGenreRenduTAF.getLibelleConsultation(aTaf.genreRendu),ieModelChips:lIEModelChips,argsIEModel:[aTaf.GetNumero()]}));}}
const lEstAvecUneCorrection=(!!aTaf.documentCorrige||!!aTaf.commentaireCorrige);if(lEstAvecUneCorrection){H.push('<span style="padding-left:0.4rem">');const lContientQueLaCopieCorrigee=(!!aTaf.documentCorrige&&!aTaf.commentaireCorrige);if(lContientQueLaCopieCorrigee){H.push(GChaine.composerUrlLienExterne({documentJoint:aTaf.documentCorrige,genreRessource:TypeFichierExterneHttpSco.TAFCorrigeRenduEleve,libelleEcran:GTraductions.getValeur('CahierDeTexte.TAFARendre.Eleve.CorrectionDeLEnseignant')}));} else{H.push('<ie-chips ',_composeIEModelChipsOuvrirFenetreCorrectionTAF.call(this,aTaf,aParam),'>',GTraductions.getValeur('CahierDeTexte.TAFARendre.Eleve.CorrectionDeLEnseignant'),'</ie-chips>');}
H.push('</span>');}
break;}
case TypeGenreRenduTAF.GRTAF_RenduKiosque:if(aTaf.peuRendre&&!aTaf.documentRendu){if(aTaf.avecUrlAppliMobile&&MethodesTableau.existe(GEtatUtilisateur.GenreEspace,[EGenreEspace.Mobile_PrimEleve,EGenreEspace.Mobile_Eleve])){H.push('<div>',GChaine.composerUrlLienExterne({documentJoint:aTaf,iconeOverride:'icon_th_large',infoSupp:{universalLink:true},libelleEcran:GTraductions.getValeur('CahierDeTexte.TAFARendre.ACompleterEditeurAppli'),title:(aTaf.titreKiosque||'')}),'</div>');}
const lTrad=TypeGenreRenduTAF.getLibelleDeposer(aTaf.genreRendu,MethodesTableau.existe(GEtatUtilisateur.GenreEspace,[EGenreEspace.Mobile_PrimEleve,EGenreEspace.Mobile_Eleve]));H.push('<div>',GChaine.composerUrlLienExterne({documentJoint:aTaf,iconeOverride:'icon_book',libelleEcran:lTrad,title:(aTaf.titreKiosque||'')}),'</div>');}
if(aTaf.documentRendu){let lIEModelChipsKiosque=null;if(aTaf.peuRendre&&lEstSurEspaceEleve){lIEModelChipsKiosque=_getIEModelChipsCopieDeposeeEleve.call(this,aTaf,aParam);}
H.push('<div class="InlineBlock AlignementMilieuVertical">',GChaine.composerUrlLienExterne({documentJoint:aTaf.documentRendu,genreRessource:TypeFichierExterneHttpSco.TAFRenduEleve,libelle:TypeGenreRenduTAF.getLibelleConsultation(aTaf.genreRendu,lEstSurEspaceEleve),ieModelChips:lIEModelChipsKiosque,argsIEModel:[aTaf.GetNumero()]}),'</div>');}
if(aTaf.peuRendre&&aTaf.documentRendu){if(lEstSurEspaceEleve){H.push('<span style="padding-left:0.4rem">',GChaine.composerUrlLienExterne({documentJoint:aTaf,libelleEcran:GTraductions.getValeur('CahierDeTexte.TAFARendre.Eleve.RepondreANouveau'),title:(aTaf.titreKiosque||'')}),'</span>');}}
break;}
H.push('</div>');}
return H.join('');}
composeTAFARendre(aTaf,aParam){const H=[];let lAvecImage=MethodesTableau.existe(GEtatUtilisateur.GenreEspace,[EGenreEspace.Mobile_Eleve,EGenreEspace.Eleve,EGenreEspace.Mobile_Parent,EGenreEspace.Parent,EGenreEspace.Accompagnant,EGenreEspace.Tuteur]);const lAvecSouligne=MethodesTableau.existe(GEtatUtilisateur.GenreEspace,[EGenreEspace.Mobile_Eleve,EGenreEspace.Mobile_Parent,EGenreEspace.Mobile_Accompagnant,EGenreEspace.Mobile_Tuteur])&&!aParam.pourAccueil;if(MethodesTableau.existe(GEtatUtilisateur.GenreEspace,[EGenreEspace.Eleve,EGenreEspace.Parent,EGenreEspace.Mobile_Eleve,EGenreEspace.Mobile_Parent,EGenreEspace.Mobile_PrimEleve,EGenreEspace.Mobile_PrimParent,EGenreEspace.Accompagnant,EGenreEspace.Mobile_Accompagnant,EGenreEspace.PrimAccompagnant,EGenreEspace.Mobile_PrimAccompagnant,EGenreEspace.Tuteur,EGenreEspace.Mobile_Tuteur])&&aTaf.avecRendu){H.push('<div style="float: right;">');switch(aTaf.genreRendu){case TypeGenreRenduTAF.GRTAF_RenduPapier:H.push(lAvecImage?'<i class="icon_punition EspaceDroit"></i>':'','<span class="InlineBlock AlignementMilieuVertical">',TypeGenreRenduTAF.getLibelleDeposer(aTaf.genreRendu),'</span>');break;case TypeGenreRenduTAF.GRTAF_RenduPronote:case TypeGenreRenduTAF.GRTAF_RenduPronoteEnregistrementAudio:if(aTaf.peuRendre&&!aTaf.documentRendu){if(MethodesTableau.existe(GEtatUtilisateur.GenreEspace,[EGenreEspace.Eleve,EGenreEspace.Mobile_Eleve,EGenreEspace.Mobile_PrimEleve])){H.push(lAvecImage?'<i class="icon_punition EspaceDroit"></i>':'','<div id="',getIdTAFARendre.call(this,aTaf),'" ',_getFicheSelecFile.call(this,aTaf,aParam),' tabIndex="0" class="InlineBlock LienAccueil AlignementMilieuVertical AvecMain'+(lAvecSouligne?' Souligne':'')+'" onmouseenter="',this.Nom,'.surSurvol (this, true)" onmouseleave="',this.Nom,'.surSurvol (this, false, '+lAvecSouligne+')">',TypeGenreRenduTAF.getLibelleDeposer(aTaf.genreRendu,true),'</div>');} else{H.push(lAvecImage?'<i class="icon_punition EspaceDroit"></i>':'','<span class="InlineBlock AlignementMilieuVertical">',TypeGenreRenduTAF.getLibelleDeposer(aTaf.genreRendu),'</span>');}}
if(aTaf.documentRendu){const lLibelleLienDocumentRendu=TypeGenreRenduTAF.getLibelleConsultation(aTaf.genreRendu);H.push(lAvecImage?'<i class="icon_punition EspaceDroit"></i>':'','<div class="InlineBlock AlignementMilieuVertical">',GChaine.composerUrlLienExterne({documentJoint:aTaf.documentRendu,genreRessource:TypeFichierExterneHttpSco.TAFRenduEleve,libelleEcran:lLibelleLienDocumentRendu,afficherIconeDocument:false}),'</div>');}
if(aTaf.documentCorrige){const lLibelleLienDocumentCorrige=GTraductions.getValeur('CahierDeTexte.TAFARendre.Eleve.CopieCorrigeeParEnseignant');H.push('<span class="InlineBlock AlignementMilieuVertical">','&nbsp;-&nbsp;','</span>');lAvecImage=false;H.push(lAvecImage?'<i class="icon_punition EspaceDroit"></i>':'','<div class="InlineBlock AlignementMilieuVertical">',GChaine.composerUrlLienExterne({documentJoint:aTaf.documentCorrige,genreRessource:TypeFichierExterneHttpSco.TAFCorrigeRenduEleve,libelleEcran:lLibelleLienDocumentCorrige,afficherIconeDocument:false}),'</div>');}
if(aTaf.peuRendre&&aTaf.documentRendu){if(MethodesTableau.existe(GEtatUtilisateur.GenreEspace,[EGenreEspace.Eleve,EGenreEspace.Mobile_Eleve,EGenreEspace.Mobile_PrimEleve])){H.push('<span class="InlineBlock AlignementMilieuVertical">','&nbsp;-&nbsp;','</span>','<a id="',getIdTAFARendre.call(this,aTaf),'" ',_getFicheSelecFile.call(this,aTaf,aParam),' tabIndex="0" class="InlineBlock AlignementMilieuVertical LienAccueil AvecMain'+(lAvecSouligne?' Souligne':'')+'" title="',GTraductions.getValeur('CahierDeTexte.TAFARendre.Eleve.NouveauRenduPronote'),'" onmouseenter="',this.Nom,'.surSurvol (this, true)" onmouseleave="',this.Nom,'.surSurvol (this, false, '+lAvecSouligne+')">',GTraductions.getValeur('CahierDeTexte.TAFARendre.Eleve.Deposer'),'</a>','<span class="InlineBlock AlignementMilieuVertical">','&nbsp;-&nbsp;','</span>','<a class="InlineBlock AlignementMilieuVertical LienAccueil AvecMain'+(lAvecSouligne?' Souligne':'')+'" tabIndex="0" title="',GTraductions.getValeur('CahierDeTexte.TAFARendre.Eleve.SupprimerRenduPronote'),'" ',_supprimerFichier.call(this,aTaf,aParam),'>',GTraductions.getValeur('CahierDeTexte.TAFARendre.Eleve.Supprimer'),'</a>');}}
break;case TypeGenreRenduTAF.GRTAF_RenduKiosque:if(aTaf.peuRendre&&!aTaf.documentRendu){if(aTaf.avecUrlAppliMobile&&MethodesTableau.existe(GEtatUtilisateur.GenreEspace,[EGenreEspace.Mobile_PrimEleve,EGenreEspace.Mobile_Eleve])){H.push('<div>',GChaine.composerUrlLienExterne({documentJoint:aTaf,iconeOverride:'icon_th_large',infoSupp:{universalLink:true},libelleEcran:GTraductions.getValeur('CahierDeTexte.TAFARendre.ACompleterEditeurAppli'),title:(aTaf.titreKiosque||'')}),'</div>');}
const lTrad=MethodesTableau.existe(GEtatUtilisateur.GenreEspace,[EGenreEspace.Mobile_PrimEleve,EGenreEspace.Mobile_Eleve])?GTraductions.getValeur('CahierDeTexte.TAFARendre.ACompleterEditeurSite'):GTraductions.getValeur('CahierDeTexte.TAFARendre.ACompleterEditeur');H.push('<div>',GChaine.composerUrlLienExterne({documentJoint:aTaf,iconeOverride:'icon_book',libelleEcran:lTrad,title:(aTaf.titreKiosque||'')}),'</div>');}
if(aTaf.documentRendu){H.push('<div class="InlineBlock AlignementMilieuVertical">',GChaine.composerUrlLienExterne({documentJoint:aTaf.documentRendu,genreRessource:TypeFichierExterneHttpSco.TAFRenduEleve,libelle:TypeGenreRenduTAF.getLibelleConsultation(aTaf.genreRendu,MethodesTableau.existe(GEtatUtilisateur.GenreEspace,[EGenreEspace.Eleve,EGenreEspace.Mobile_Eleve,EGenreEspace.Mobile_PrimEleve]))}),'</div>');}
if(aTaf.peuRendre&&aTaf.documentRendu){if(MethodesTableau.existe(GEtatUtilisateur.GenreEspace,[EGenreEspace.Eleve,EGenreEspace.Mobile_Eleve,EGenreEspace.Mobile_PrimEleve])){H.push('<span class="InlineBlock AlignementMilieuVertical">','&nbsp;-&nbsp;','</span>',GChaine.composerUrlLienExterne({documentJoint:aTaf,libelleEcran:GTraductions.getValeur('CahierDeTexte.TAFARendre.Eleve.RepondreANouveau'),title:(aTaf.titreKiosque||'')}),'<span class="InlineBlock AlignementMilieuVertical">','&nbsp;-&nbsp;','</span>','<a class="InlineBlock AlignementMilieuVertical LienAccueil AvecMain'+(lAvecSouligne?' Souligne':'')+'" title="',GTraductions.getValeur('CahierDeTexte.TAFARendre.Eleve.SupprimerMesReponses'),'" tabIndex="0" ',_supprimerFichier.call(this,aTaf,aParam),'>',GTraductions.getValeur('CahierDeTexte.TAFARendre.Eleve.Supprimer'),'</a>');}}
break;}
H.push('</div>');H.push('<div style="clear: both;"></div>');}
return H.join('');}
getListeDonneesBrute(aParam){if(aParam.modeAffichage===EGenreAffichageCahierDeTextes.TravailAFaire){if(aParam.avecDS&&aParam.listeDS){aParam.listeDS.parcourir(function(D){D.estUnDS=true;return true;});if(aParam.avecTAF){return new ObjetListeElements().FusionnerListe(aParam.listeTAF).FusionnerListe(aParam.listeDS);} else{return aParam.listeDS;}} else{return aParam.avecTAF?aParam.listeTAF:new ObjetListeElements();}} else{return aParam.listeCDT;}}
_getListeFusionnee(aMatieres,aDonnees,aAvecMatieresVides){let lMatiere;let lDateCourante=null;function _filtrerParMatiereEtDate(aElt){let lResult=false;if((aElt.GetNumero()===lMatiere)&&(GDate.estJourEgal(aElt.Date,lDateCourante))){aElt.estTraite=true;lResult=true;}
return lResult;}
function _filtrerDonneesParDateNonTraite(aElt){return(!aElt.estTraite)&&(GDate.estJourEgal(aElt.Date,lDateCourante));}
let lMatiereCourante;let lListeMatieresDuJour=[];let lDonneesNonTraitees;const lResult=new ObjetListeElements();for(let i=0,lNbr=aMatieres.GetNbrElements();i<lNbr;i++){let lElt=aMatieres.GetElement(i);const lDate=lElt.date;lMatiere=lElt.Matiere.GetNumero();if(!GDate.estJourEgal(lDate,lDateCourante)){let n=0;while(GDate.estDateJourAvant(lDateCourante,lDate)&&!!lDateCourante&&n<7){lDonneesNonTraitees=aDonnees.getListeElements(_filtrerDonneesParDateNonTraite);if(lDonneesNonTraitees.GetNbrElements()>0){lResult.FusionnerListe(lDonneesNonTraitees);}
lDateCourante=GDate.GetJourSuivant(lDateCourante);n++;}
lDateCourante=lDate;lMatiereCourante=null;lListeMatieresDuJour=[];}
if(lMatiere!==lMatiereCourante){lMatiereCourante=lMatiere;if(!MethodesTableau.existe(lMatiere,lListeMatieresDuJour)){lListeMatieresDuJour.push(lMatiere);const lDonneeFiltre=aDonnees.getListeElements(_filtrerParMatiereEtDate);if(lDonneeFiltre.GetNbrElements()===1){lResult.AddElement(lDonneeFiltre.GetElement(0));} else{if(aAvecMatieresVides){const lEltMatiere=new ObjetElement(lElt.Matiere.Libelle,lElt.Matiere.Numero,lElt.Matiere.Genre,lElt.Matiere.Position,lElt.Matiere.Actif);lEltMatiere.Date=lDateCourante;lEltMatiere.couleurBordure=GCouleur.liste.bordure;lEltMatiere.estUneSuite=false;lEltMatiere.aUneSuite=false;lEltMatiere.CouleurFond=lElt.CouleurFond;lEltMatiere.ressources=new ObjetListeElements();lResult.AddElement(lEltMatiere);}}}}}
if(!!lDateCourante&&!!aDonnees){lDonneesNonTraitees=aDonnees.getListeElements(_filtrerDonneesParDateNonTraite);if(!!lDonneesNonTraitees&&lDonneesNonTraitees.GetNbrElements()>0){lResult.FusionnerListe(lDonneesNonTraitees);}}
return lResult;}
formatDonnees(aParam){let I,lElt,elementRessource,newElement;const lModeTAF=(aParam.modeAffichage===EGenreAffichageCahierDeTextes.TravailAFaire);const lListeDonnees=this.getListeDonneesBrute(aParam);let lResult=new ObjetListeElements();let lDate=null;let lMatiere=null;let lElementPrecedent=null;lListeDonnees.setTri([
ObjetTri.init(function(D){if(lModeTAF){return D.PourLe;}
return D.Date;}),ObjetTri.init('Matiere.Libelle'),ObjetTri.init(function(D){if(lModeTAF&&!D.estUnDS){return GDate.GetJour(D.DonneLe);}
return null;}),ObjetTri.init(function(D){if(lModeTAF&&!D.estUnDS){return D.GetGenre();}
return null;}),ObjetTri.init(function(D){if(lModeTAF&&!D.estUnDS){return D.GetLibelle();}
return null;})
]);lListeDonnees.trier();for(I=0;I<lListeDonnees.GetNbrElements();I++){lElt=lListeDonnees.GetElement(I);if((lModeTAF)||(lElt.listeContenus&&(lElt.listeContenus.GetNbrElements()>0))){if(aParam.estChargeTAF&&lElementPrecedent&&GDate.estJourEgal(lElementPrecedent.Date,lElt.PourLe)&&(lElementPrecedent.Libelle===lElt.Matiere.Libelle)){newElement=lElementPrecedent;} else{newElement=new ObjetElement(lElt.Matiere.Libelle,lElt.Matiere.Numero,lElt.Matiere.Genre,lElt.Matiere.Position,lElt.Matiere.Actif);newElement.genreBloc=lModeTAF?EGenreBloc.TravailAFaire:EGenreBloc.ContenuDeCours;newElement.Date=lModeTAF?lElt.PourLe:lElt.Date;newElement.DateDebut=newElement.Date;newElement.couleurBordure=GCouleur.liste.bordure;newElement.estUneSuite=false;newElement.aUneSuite=false;newElement.CouleurFond=lElt.CouleurFond;if(lModeTAF){newElement.listeGroupes=MethodesObjet.dupliquer(lElt.listeGroupes);}}
elementRessource=new ObjetElement(lModeTAF?(lElt.estUnDS?lElt.horaires:lElt.Libelle):lElt.listeContenus.GetLibelle(0),lElt.Numero,lElt.Genre,lElt.Position,lElt.Actif);elementRessource.genreMatiere=lElt.Matiere.Genre;elementRessource.elementOriginal=lElt;if(lModeTAF){elementRessource.estUnDS=lElt.estUnDS;if(lElt.estUnDS){elementRessource.estDevoir=lElt.estDevoir;elementRessource.estEval=lElt.estEval;}
elementRessource.DonneLe=lElt.DonneLe;elementRessource.nomPublic=lElt.nomPublic;} else{for(let j=0,lNbr=lElt.listeContenus.GetNbrElements();j<lNbr;j++){let lContenu=lElt.listeContenus.GetElement(j);if(lContenu.categorie&&lContenu.categorie.GetGenre()===TypeOrigineCreationCategorieCahierDeTexte.OCCCDT_Pre_Devoir){elementRessource.estUnDS=true;}}}
if(lModeTAF&&!aParam.sansRegroupementTAF&&lDate&&GDate.estJourEgal(lDate,newElement.Date)&&(lMatiere===newElement.Libelle)){lElementPrecedent.ressources.AddElement(elementRessource);lElementPrecedent.ressources.setTri([
ObjetTri.init(function(D){return!D.estUnDS;}),ObjetTri.init('DonneLe'),ObjetTri.init('genreMatiere')
]);lElementPrecedent.ressources.trier();} else{newElement.ressources=new ObjetListeElements();newElement.ressources.AddElement(elementRessource);lResult.AddElement(MethodesObjet.dupliquer(newElement));lElementPrecedent=lResult.GetElement(lResult.GetNbrElements()-1);}
if(elementRessource.estUnDS){lElementPrecedent.estAvecDS=true;lElementPrecedent.estDevoir=lElt.estDevoir;lElementPrecedent.estEval=lElt.estEval;}
lDate=newElement.Date;lMatiere=newElement.Libelle;}}
lResult.setTri([
ObjetTri.init('Date'),ObjetTri.init('Libelle')
]);lResult.trier();if(lModeTAF&&aParam.listeMatieres){const lTri=[ObjetTri.init('place'),ObjetTri.init(function(D){return D.Matiere.GetLibelle();})];aParam.listeMatieres.setTri(lTri);aParam.listeMatieres.trier();lResult=this._getListeFusionnee(aParam.listeMatieres,lResult,aParam.avecMatieres);}
$.extend(aParam,{listeElements:lResult});if(aParam.estChargeTAF){_apresFormatterDonneesPourAffichage.call(this,aParam);}
return lResult;}}
function composeTitreTAF(aElement,aPourGrille){const T=[];T.push('<table ',GObjetWAI.composeRole(EGenreRole.Gridcell),' style="',GStyle.composeCouleur(GCouleur.themeNeutre.legere,GCouleur.noire),' width:100%; height:15px;" border="0" cellpadding="0" cellspacing="0">','<tr>','<td class="Texte10 ',(!aPourGrille?'AvecMove':''),'"><div class="PetitEspace Texte10">',TUtilitaireCDT.strtMatiere(aElement,aElement.groupe,false),'</td>','</tr>','</table>');return T.join('');}
function composeTitreCDC(aElement,aListeCDT){const T=[];const lElt=aListeCDT.GetElementParNumero(aElement.ressources.GetNumero(0));let lClasseSelectionnee=GEtatUtilisateur.Navigation.GetRessource(EGenreRessource.Classe);if(!lClasseSelectionnee&&GEtatUtilisateur.getMembre()){lClasseSelectionnee=GEtatUtilisateur.getMembre().Classe;}
const lAvecGroupe=!!lElt.listeGroupes&&lElt.listeGroupes.GetNbrElements()>0&&!!lElt.listeGroupes.GetElement(0)&&lClasseSelectionnee&&(lClasseSelectionnee.GetNumero()!==lElt.listeGroupes.GetElement(0).GetNumero());T.push('<table ',GObjetWAI.composeRole(EGenreRole.Gridcell),' style="',GStyle.composeCouleur(GCouleur.themeNeutre.legere,GCouleur.noire),' width:100%; height:15px;" border="0" cellpadding="0" cellspacing="0">','<tr>','<td class="Texte10 AvecMove"><div class="PetitEspace Texte10">','<div>',TUtilitaireCDT.strtMatiere(aElement,lAvecGroupe?lElt.listeGroupes:false,false),'</div>','<div>',TUtilitaireCDT.strtDate(aElement.Date),'</div>','</td>','</tr>','</table>');return T.join('');}
function _composeSymboleCategorie(aGenre){const T=[];T.push('<div class="InlineBlock ',TypeOrigineCreationCategorieCahierDeTexteUtil.getImage(aGenre),' AlignementMilieuVertical" style="width:17px"></div>');return T.join('');}
function _estAvecCocheTAFFait(aElement){const lAvecERendu=TypeGenreRenduTAF.estUnRenduEnligne(aElement.genreRendu);const lEstQCM=aElement.executionQCM&&aElement.executionQCM.existeNumero();if(!this.peuFaireTAF||lEstQCM||lAvecERendu){return false;}
return true;}
function _composeCBTAFFait(aElement){if(!_estAvecCocheTAFFait.call(this,aElement)){return'';}
const H=[];H.push('<div class="InlineBlock AlignementHaut"><ie-checkbox ie-hint="getHint" ie-model="cbxTAFFait (\'',aElement.GetNumero(),'\')">');H.push('</ie-checkbox></div>');return H.join('');}
function _composeLabelTAFFait(lElement){const H=[];const lTitle=!this.peuFaireTAF&&lElement.TAFFait?' title="'+GTraductions.getValeur('accueil.hintParentTravailFait',[GEtatUtilisateur.getMembre().GetLibelle()])+'"':'';H.push('<div class="InlineBlock AlignementHaut" style="float:right;"',lTitle,'><div ie-html="labelTAFFait (\'',lElement.GetNumero(),'\')"></div></div>');return H.join('');}
function getInfoTAFRendu(I,aTaf,aNom){const H=[];const lAvecAction=aNom&&aTaf&&aTaf.avecRendu;const lFoncExist=MethodesObjet.isFunction(aNom.surDetailRendu);const lAction=lAvecAction&&lFoncExist?' class="AvecMain LienAccueil" onclick="'+aNom+'.surDetailRendu (event, \''+I+'\')"':'';H.push('<span class="InlineBlock" style="line-height: 14px;">','&nbsp;-&nbsp;',GTraductions.getValeur('CahierDeTexte.TAFARendre.RenduPar'),'&nbsp;','</span>','<span',lAction,' class="InlineBlock" style="line-height: 14px;">',aTaf.nbrRendus+'/'+aTaf.nbrEleves,'</span>');return H.join('');}
function _executerDepotFichierPourTAF(aTaf){let lLibelle='';if(aTaf&&aTaf.matiere){lLibelle=aTaf.matiere.GetLibelle();} else if(aTaf&&aTaf.Matiere){lLibelle=aTaf.Matiere.GetLibelle();}
if(aTaf&&aTaf.pourLe){lLibelle+=' - '+(GDate.estDateParticulier(aTaf.pourLe)?GTraductions.getValeur('accueil.pour').ucfirst():GTraductions.getValeur('accueil.pourle').ucfirst())+' '+GDate.FormatDate(aTaf.pourLe,'['+'%JJJJ %J %MMM'+']');}
const lThis=this;const lNumeroTAF=aTaf.GetNumero();const lObjetFenetreAjoutMultiple=ObjetFenetre.creerInstance(ObjetFenetre_UploadFichiers,{pere:this,evenement:function(aGenreBouton,aListeFichiers){if(aGenreBouton===EGenreAction.Valider){if(!!aListeFichiers&&aListeFichiers.GetNbrElements()>0){const lSeulFichier=aListeFichiers.GetPremierElement();lSeulFichier.TAF=new ObjetElement('',lNumeroTAF);new ObjetRequeteSaisieTAFARendreEleve(lThis,lThis.actionSurRequeteSaisieTAFARendreEleve).addUpload({listeFichiers:aListeFichiers}).lancerRequete(aListeFichiers);}}
lObjetFenetreAjoutMultiple.Fermer();}});if(TypeGenreRenduTAF.estUnRenduMedia(aTaf.genreRendu)){lObjetFenetreAjoutMultiple.setOptions({avecEnregistrement:true,avecAudioUniquement:true,avecUploadPlusieursImages:false,maxLengthAudio:TypeGenreRenduTAF.getDureeMaxEnregistrementAudio()});}
lObjetFenetreAjoutMultiple.setOptionsFenetre({titre:GTraductions.getValeur('CahierDeTexte.TAFARendre.Eleve.DeposerCopie')});lObjetFenetreAjoutMultiple.setDonnees(EGenreRessource.DocumentJoint,{tailleMaxUploadFichier:GApplication.droits.get(TypeDroits.tailleMaxRenduTafEleve),libelleContexteFenetre:lLibelle,functionGetNomPdfGenere:function(){const lLibelleUtilisateur=GEtatUtilisateur.getMembre().GetLibelle();return lLibelleUtilisateur+'_'+GDate.FormatDate(GDate.getDateHeureCourante(),'%JJ%MM%AAAA_%hh%mm%ss')+'.pdf';}});lObjetFenetreAjoutMultiple.afficher();}
function _getFicheSelecFile(aTaf,aParam){const lThis=this;if(aTaf&&aTaf.avecRendu){if(!aParam.controleur){return'';}
aParam.controleur.utilFicheFileTAF=function(aNumero){lThis.utilFicheFileTAF.call(this,lThis,aNumero,aTaf,aParam);};return GHtml.composeAttr('ie-node','utilFicheFileTAF',[aTaf.GetNumero()]);}
return'';}
function _supprimerFichier(aTaf,aParam){const lThis=this;if(aTaf&&aTaf.avecRendu){if(!aParam.controleur){return'';}
if(!aParam.controleur.supprimerFichier){aParam.controleur.supprimerFichier=function(aNumero){$(this.node).eventValidation(function(aNumero){this.surSupprimer(aNumero);}.bind(lThis,aNumero));};}
return GHtml.composeAttr('ie-node','supprimerFichier',[aTaf.GetNumero()]);}
return'';}
function _composeIEModelChipsOuvrirFenetreCorrectionTAF(aTaf,aParam){const H=[];if(!!aTaf&&(!!aTaf.documentCorrige||!!aTaf.commentaireCorrige)){if(!aParam.controleur){return'';}
if(!aParam.listeTAF){return'';}
if(!aParam.controleur.chipsOuvrirFenetreCorrectionTAF){const lThis=this;aParam.controleur.chipsOuvrirFenetreCorrectionTAF={event:function(aNumeroTaf){const lListeTaf=aParam.listeTAF;const lTaf=lListeTaf.GetElementParNumero(aNumeroTaf);if(!!lTaf){const lFenetreCorrectionTaf=ObjetFenetre.creerInstance(ObjetFenetre_CorrectionTaf,{pere:lThis});lFenetreCorrectionTaf.setTAF(aTaf);lFenetreCorrectionTaf.Afficher();}}};}
H.push(GHtml.composeAttr('ie-model','chipsOuvrirFenetreCorrectionTAF',[aTaf.GetNumero()]));}
return H.join('');}
function _getIEModelChipsCopieDeposeeEleve(aTaf,aParam){let lNomIEModel=null;if(!!aTaf){if(!aParam.controleur){return'';}
if(!aParam.listeTAF){return'';}
if(!aParam.controleur.chipsCopieDeposeeEleve){const lThis=this;aParam.controleur.chipsCopieDeposeeEleve={eventBtn:function(aNumeroTaf){GApplication.getMessage().afficher({type:EGenreBoiteMessage.Confirmation,message:GTraductions.getValeur('TAFEtContenu.suppressionCopieEleve'),callback:function(aGenreAction){if(aGenreAction===EGenreAction.Valider){lThis.surSupprimer(aNumeroTaf);}}});}};}
lNomIEModel='chipsCopieDeposeeEleve';}
return lNomIEModel;}
function _getIEModelChipsCopieJouerSon(aTaf,aParam){let lNomIEModel=null;if(!!aTaf){if(!aParam.controleur){return'';}
if(!aParam.listeTAF){return'';}
const lStrCtrlAudio='chipsAudio';if(!(lStrCtrlAudio in aParam.controleur)){const lThis=this;aParam.controleur[lStrCtrlAudio]={event:function(){$(this.node).toggleClass(UtilitaireAudio.IconeLecture).toggleClass(UtilitaireAudio.IconeStop);const lElemAudio=$(this.node).find('audio')[0]
;if(UtilitaireAudio.estEnCoursDeLecture(lElemAudio)){UtilitaireAudio.stopAudio(lElemAudio);} else{try{UtilitaireAudio.jouerAudio(lElemAudio);} catch(error){if(error===UtilitaireAudio.ExceptionFichierNonValide){$(this.node).addClass(UtilitaireAudio.IconeLecture).removeClass(UtilitaireAudio.IconeStop);}}}},eventBtn:function(aNumeroTaf){GApplication.getMessage().afficher({type:EGenreBoiteMessage.Confirmation,message:GTraductions.getValeur('TAFEtContenu.suppressionCopieEleve'),callback:function(aGenreAction){if(aGenreAction===EGenreAction.Valider){lThis.surSupprimer(aNumeroTaf);}}});},node:function(){const $chips=$(this.node);const $audio=$chips.find('audio');$audio.on('play',function(){$chips.removeClass(UtilitaireAudio.IconeLecture).addClass(UtilitaireAudio.IconeStop);});$audio.on('pause',function(){$chips.removeClass(UtilitaireAudio.IconeStop).addClass(UtilitaireAudio.IconeLecture);});},getOptions:function(aNumeroTaf,aAvecBtnSuppr){return{avecBtn:aAvecBtnSuppr};}};}
lNomIEModel=lStrCtrlAudio;}
return lNomIEModel;}
function getIdTAFARendre(aTaf){return this.idTAFARendre+'_'+aTaf.GetNumero();}
function _apresFormatterDonneesPourAffichage(aParam){let lElt;let T=[];for(let i=0,lNbr=aParam.listeElements.GetNbrElements();i<lNbr;i++){lElt=aParam.listeElements.GetElement(i);T=[];if(lElt.estAvecDS){T.push('<div class="NoWrap">');T.push('<div class="InlineBlock AlignementMilieuVertical GrandEspaceDroit">');}
T.push('<div style="float: left; height: 100%; margin-top: 3px; margin-bottom: 3px; margin-left : 3px;" class="NoWrap">',TUtilitaireCDT.strtMatiere(lElt,false,false),'</div>');T.push('<div style="clear: both"></div>');if(lElt.estAvecDS){T.push('</div>');if(lElt.estDevoir){T.push('<div class="InlineBlock AlignementMilieuVertical" >',_composeSymboleCategorie(TypeOrigineCreationCategorieCahierDeTexte.OCCCDT_Pre_Devoir),'</div>');}
if(lElt.estEval){T.push('<div class="InlineBlock AlignementMilieuVertical',lElt.estDevoir?' PetitEspaceGauche':'','" >',_composeSymboleCategorie(TypeOrigineCreationCategorieCahierDeTexte.OCCCDT_Pre_Evaluation),'</div>');}
T.push('</div>');}
if(aParam.avecDonneeLe){let lRessource;let lDonneeLeCourant=null;for(let j=0,lNbr2=lElt.ressources.GetNbrElements();j<lNbr2;j++){lRessource=lElt.ressources.GetElement(j);if(!lRessource.estUnDS&&lRessource.DonneLe!==lDonneeLeCourant){lDonneeLeCourant=lRessource.DonneLe;const lNbJours=GDate.GetDifferenceJours(lElt.Date,lDonneeLeCourant);const lStrJours=(lNbJours>1?GTraductions.getValeur('TAFEtContenu.jours'):GTraductions.getValeur('TAFEtContenu.jour')).toLowerCase();T.push('<div class=" GrandEspaceGauche">');T.push('<ul style="padding: 0px; margin: 0px;"><li style="list-style-position: inside; padding: 0px 0px 5px 0px;">');T.push('<span class="EspaceGauche">'+GTraductions.getValeur('TAFEtContenu.donneLe')+GDate.FormatDate(lDonneeLeCourant,' %JJ/%MM')+'</span>');T.push('<span>'+' ['+lNbJours+' '+lStrJours+']</span>');T.push('</li></ul>');T.push('</div>');}}}
lElt.html=[];lElt.html[0]=T.join('');const lAffTAF=(aParam.modeAffichage===EGenreAffichageCahierDeTextes.TravailAFaire);T=[];T.push('<table ',GObjetWAI.composeRole(EGenreRole.Gridcell),' class="Texte10" style="width:100%;" border="0" cellpadding="0" cellspacing="0">');T.push('<tr><td>',lAffTAF?composeTitreTAF(lElt,true):composeTitreCDC(lElt,aParam.listeCDT),'</td></tr>');T.push('<tr><td height="100%;" class="FondBlanc" valign="top">');T.push('<table class="Texte10" style="width:100%;" border="0" cellpadding="0" cellspacing="0">');T.push('<tr>');T.push('<td class="AlignementHaut">');T.push('<div style=width:100%; height:100%;">');T.push('</div>');T.push(lAffTAF?this.composeTAF(lElt,aParam.listeTAF,{avecDetailTAF:aParam.avecDetailTAF,nom:aParam.nom,listeDS:aParam.listeDS,controleur:aParam.controleur}):this.composeCDC(aParam.listeCDT.GetElementParNumero(lElt.ressources.GetNumero(0)),aParam));T.push('</td>');T.push('</tr>');T.push('</table>');T.push('</td></tr>');T.push('</table>');lElt.html[1]=T.join('');}}
module.exports=ObjetUtilitaireCahierDeTexte;},fn:"objetutilitairecahierdetexte.js"});;
IE.fModule({f:function(exports,require,module,global){const Identite=require('ObjetIdentite.js');const MethodesTableau=require('MethodesTableau.js');const GChaine=require('GChaine.js');const EGenreEtat=require('Enumere_Etat.js');const{GDate}=require('ObjetDate.js');const GTraductions=require('ObjetTraduction.js');const ObjetTri=require('ObjetTri.js');const{GObjetWAI,EGenreRole,EGenreAttribut}=require('ObjetWAI.js');const EGenreEspace=require('Enumere_Espace.js');const ObjetRequeteSaisieTAFFaitEleve=require('ObjetRequeteSaisieTAFFaitEleve.js');const ObjetUtilitaireCahierDeTexte=require('ObjetUtilitaireCahierDeTexte.js');const TypeGenreRenduTAF=require('TypeGenreRenduTAF.js').TypeGenreRenduTAF;const UtilitaireQCM=require('UtilitaireQCM.js').UtilitaireQCM;const EGenreOnglet=require('Enumere_Onglet.js');class WidgetTAF extends Identite{creerObjetsTAF(){this.utilitaireCDT=new ObjetUtilitaireCahierDeTexte(this.Nom+'.utilitaireCDT',this,this.surUtilitaireCDT);}
surUtilitaireCDT(){this.RecupererDonnees([this.donnees.genre]);}
construire(aParams){this.donnees=aParams.donnees;this.peuFaireTAF=MethodesTableau.existe(GEtatUtilisateur.GenreEspace,[EGenreEspace.Eleve,EGenreEspace.Mobile_Eleve]);var lThis=this;$.extend(this.controleur,{cbTAFFait:{getValue:function(aNumeroTaf){var lTAF=lThis.donnees.listeTAF.GetElementParNumero(aNumeroTaf);return!!lTAF&&lTAF.TAFFait;},setValue:function(aNumeroTaf,aValue){var lTAF=lThis.donnees.listeTAF.GetElementParNumero(aNumeroTaf);if(!!lTAF){lTAF.TAFFait=aValue;lTAF.SetEtat(EGenreEtat.Modification);new ObjetRequeteSaisieTAFFaitEleve(lThis,lThis.surUtilitaireCDT).lancerRequete({listeTAF:lThis.donnees.listeTAF});}},getHint:function(aNumeroTaf){var lHint='';var lTAF=lThis.donnees.listeTAF.GetElementParNumero(aNumeroTaf);if(!!lTAF){lHint=(lTAF.TAFFait?GTraductions.getValeur('accueil.hintTravailFait'):GTraductions.getValeur('accueil.hintTravailAFaire'));}
return lHint;},getDisabled:function(){return!lThis.peuFaireTAF;}}});this.creerObjetsTAF();if(this.donnees.listeTAF){this.donnees.listeTAF.setTri([ObjetTri.init('ordre'),ObjetTri.init(function(aElement){return aElement.matiere.GetLibelle();})]);this.donnees.listeTAF.trier();}
var H=[];var lDate,lTaf,i;var T=[];if(this.donnees.listeTAF&&this.donnees.listeTAF.GetNbrElements()>0){H.push('<div class="conteneur-liste-CDT">');H.push('<ul class="liste-imbriquee">');for(var I=0;I<this.donnees.listeTAF.GetNbrElements();I++){lTaf=this.donnees.listeTAF.GetElement(I);lTaf.indice=I;if(!T[lTaf.pourLe]){T[lTaf.pourLe]=[];}
T[lTaf.pourLe].push(lTaf);}
if(this.donnees.listeTAF.GetNbrElements()>0){for(lDate in T){var lDateConcernee=new Date(lDate);H.push('<li role="listitem" aria-labelledby="'+this.getIdDate(lDateConcernee)+'" tabIndex="0">');H.push(this.composeDate(lDateConcernee));this.indiceLigne=0;H.push('<ul class="sub-liste" role="list">');for(i in T[lDate]){lTaf=T[lDate][i];H.push(this.composeTAF(lTaf.indice,lTaf,lDateConcernee));}
H.push('</ul>');H.push('</li>');}}
H.push('</ul>');H.push('</div>');}
var lWidget={html:H.join(''),nbrElements:this.donnees.listeTAF?this.donnees.listeTAF.GetNbrElements():0,afficherMessage:!this.donnees.listeTAF||this.donnees.listeTAF.GetNbrElements()===0};$.extend(true,this.donnees,lWidget);aParams.construireWidget(this.donnees);}
getIdDate(aDate){var lIdDate=[this.donnees.id,'_date'];if(aDate){lIdDate.push('_',aDate.getFullYear());lIdDate.push('_',aDate.getMonth());lIdDate.push('_',aDate.getDate());}
return lIdDate.join('');}
composeDate(aDate){var H=[];H.push('<h4 id="',this.getIdDate(aDate),'">');H.push('<span>',(GTraductions.getValeur('accueil.pour')+'</span>'+' '+GDate.FormatDate(aDate,'['+'%JJJJ %J %MMM'+']')).toLowerCase().ucfirst());H.push('</h4>');return H.join('');}
composeMatiere(aTaf){var H=[];H.push('<span class="titre-matiere ',(!!aTaf.executionQCM?aTaf.QCMFait:aTaf.TAFFait)?'est-fait':'','">',aTaf.matiere.GetLibelle(),'</span>');return H.join('');}
composeTAF(i,aTaf,aDateConcernee){var H=[];var lAvecERendu=TypeGenreRenduTAF.estUnRenduEnligne(aTaf.genreRendu);var lEstQCM=!!aTaf.executionQCM;var lEstFait=(lEstQCM?aTaf.QCMFait:aTaf.TAFFait);var lOnclick='onclick="'+this.Nom+'._surTAF(\''+aTaf.GetNumero()+'\')" ';const lOnKeyUp='onkeyup="if(GNavigateur.IsToucheSelection())'+this.Nom+'._surTAF(\''+aTaf.GetNumero()+'\')" ';H.push('<li ',GObjetWAI.composeRole(EGenreRole.Listitem),' ',GObjetWAI.composeAttribut({genre:EGenreAttribut.labelledby,valeur:this.getIdDate(aDateConcernee)}),'>');H.push('<div class="wrap conteneur-item">');var lTitleTafFait='';if(!this.peuFaireTAF&&aTaf.TAFFait){lTitleTafFait=GTraductions.getValeur('accueil.hintParentTravailFait',[GEtatUtilisateur.getMembre().GetLibelle()]);}
H.push('<div tabIndex="0" role="link" ',lOnclick,lOnKeyUp,' class="as-header"',lTitleTafFait?'title="'+lTitleTafFait+'"':'','>','<div aria-label="',aTaf.matiere.GetLibelle(),'" class="with-color" style="--couleur-matiere:',aTaf.couleurFond,';margin-left:.8rem;">',this.composeMatiere(aTaf),'</div>');H.push(' <ie-chips class="tag-style ',lEstFait?'theme-cat-pedagogie':'','">',lEstFait?GTraductions.getValeur('TAFEtContenu.TAFFait'):GTraductions.getValeur('TAFEtContenu.TAFNonFait'),'</ie-chips>');H.push('</div>');H.push(' <div class="m-left">','<div tabIndex="0" class="as-content ',' avecAction' ,(lEstFait&&!lEstQCM?' done':''),'" aria-labelledby="'+this.Nom+'_'+i+'">');if(aTaf.listeDocumentJoint){aTaf.listeDocumentJoint.trier();}
H.push('<div class="description widgetTAF ',!lEstQCM?'init-html ':'',lEstFait?'est-fait':'','" id="'+this.Nom+'_'+i+'">',lEstQCM?'<i class="icon_qcm avecCouleurTheme"></i>'+(lEstFait?aTaf.descriptifCourt:aTaf.descriptif):aTaf.descriptif,'</div>');if(aTaf.listeDocumentJoint&&(aTaf.listeDocumentJoint.GetNbrElements()>0)){H.push(this.composePiecesJointes(aTaf));}
H.push('</div>','</div>');if(!lEstQCM&&!lAvecERendu){if(aTaf.genreRendu===TypeGenreRenduTAF.GRTAF_RenduPapier&&!aTaf.TAFFait){H.push('<div class="taf-a-rendre">');H.push('<div class="taf-btn-conteneur">','<span class="as-info-light">',TypeGenreRenduTAF.getLibelleDeposer(aTaf.genreRendu),'</span></div>');H.push('</div>');}
if(GEtatUtilisateur.estEspaceEleve()){H.push('<div class="flex-contain conteneur-cb"><ie-checkbox class="cb-termine colored-label" ie-textleft ie-model="cbTAFFait(\'',aTaf.GetNumero(),'\')">',GTraductions.getValeur('TAFEtContenu.cbTermine'),'</ie-checkbox></div>');}} else if(lEstQCM){var lAvecAction=UtilitaireQCM.estCliquable(aTaf.executionQCM);if(lAvecAction){H.push('<div class="flex-contain btn-qcm"><ie-bouton onclick="'+this.Nom+'._surQCMTAF(\''+aTaf.GetNumero()+'\')" class="',lEstFait?'themeBoutonNeutre':'themeBoutonSecondaire','">',lEstFait?GTraductions.getValeur('TAFEtContenu.voirQCM'):GTraductions.getValeur('TAFEtContenu.executerQCM'),'</ie-bouton></div>');}} else{H.push('<div class="taf-a-rendre">');H.push(this.utilitaireCDT.composeTAFARendrePourWidget(aTaf,{nom:this.Nom,controleur:this.controleur,listeTAF:this.donnees.listeTAF}));H.push('</div>');}
H.push('</div>');H.push('</li>');return H.join('');}
composePiecesJointes(aElement){var lHtml=[],lListe=aElement.listeDocumentJoint;lHtml.push('<div class="piece-jointe">');for(var I=0;I<lListe.GetNbrElements();I++){var lPieceJointe=lListe.GetElement(I);lHtml.push('<span class="chips-pj">',GChaine.composerUrlLienExterne({documentJoint:lPieceJointe,maxWidth:300}),'</span>');}
lHtml.push('</div>');return lHtml.join('');}
_surQCMTAF(aNumeroTaf){var lTaf=this.donnees.listeTAF.GetElementParNumero(aNumeroTaf);this.afficherExecutionQCM(lTaf.executionQCM);}
_surTAF(aNumeroTaf){var lTaf=this.donnees.listeTAF.GetElementParNumero(aNumeroTaf);if(GEtatUtilisateur.estEspaceMobile()){this.evenementPage({genreOngletDest:EGenreOnglet.CDT_TAF,taf:lTaf});} else{var lPage={Onglet:EGenreOnglet.CDT_TAF,taf:lTaf};this.evenementPage(this.genreEvenement.selectionPage,lPage);}}}
module.exports=WidgetTAF;},fn:"espace/script/widget/widgettaf.js"});;
IE.fModule({f:function(exports,require,module,global){const{GObjetWAI,EGenreRole,EGenreAttribut}=require('ObjetWAI.js');const GHtml=require('GHtml.js');const Identite=require('ObjetIdentite.js');const ObjetElement=require('ObjetElement.js');const ObjetListeElements=require('ObjetListeElements.js');const ZoneFenetre=require('IEZoneFenetre.js');class PopUpListeSelection extends Identite{constructor(...aParams){super(...aParams);this.identList=this.Nom+'_ZoneListe';this.listeRessources=new ObjetListeElements();this.elementCourant=new ObjetElement();}
_getInstanceModale(){const $objetSelection=$("#"+this.identList.escapeJQ());let lInstanceObjetSelection=M.Modal.getInstance($objetSelection);if(!lInstanceObjetSelection){M.Modal.init($objetSelection,{});lInstanceObjetSelection=M.Modal.getInstance($objetSelection);}
return lInstanceObjetSelection;}
afficherModaleListe(){if((this.listeRessources===null)||(this.listeRessources===undefined)||(this.listeRessources.GetNbrElements()===0)||(this.listeRessources.GetNbrElements()===1)){return;} else{this._getInstanceModale().open();}}
fermerModaleListe(){const lInstanceModale=this._getInstanceModale();if(lInstanceModale.isOpen){lInstanceModale.close();}}
Initialiser(){super.Initialiser(arguments);if(GHtml.elementExiste(this.identList)){$('#'+this.identList.escapeJQ()).remove();}
GHtml.addHtml(ZoneFenetre.getElementZoneFenetre(),['<div id="',this.identList,'" style="max-width:95%;" class="modal">',this.composeListe(),'</div>'].join(''),{controleur:this.controleur});}
free(){super.free(arguments);this.detruireListe();}
detruireListe(){if(GHtml.elementExiste(this.identList)){$('#'+this.identList.escapeJQ()).remove();}}
getControleur(aInstance){return $.extend(true,super.getControleur(aInstance),{selectionElement:function(aNumeroElement){$(this.node).eventValidation(function(aEvent){aEvent.stopPropagation();const lElement=aInstance.listeRessources.GetElementParNumero(aNumeroElement);aInstance.setElementSelected(lElement);aInstance.callback.appel({element:lElement});aInstance.fermerModaleListe();});},radioItem:{getValue:function(aNumeroElement){if(aInstance.listeRessources){const lElement=aInstance.listeRessources.GetElementParNumero(aNumeroElement);return lElement&&lElement.item_selected;}
return false;}}});}
SetDonnees(aListeRessources,aElementCourant){this.listeRessources=aListeRessources;if(aElementCourant){this.elementCourant=aElementCourant;} else{this.elementCourant=new ObjetElement();}
this.setElementSelected(this.elementCourant);}
setElementSelected(aElement){let lNumero;if(aElement&&aElement.existeNumero()){lNumero=aElement.GetNumero();}
this.listeRessources.parcourir(function(aRessource){aRessource.item_selected=aRessource.GetNumero()===lNumero;});}
composeListe(){const lHTML=[];lHTML.push('<ul id="',this.idListeSelection,'" style="padding-top: 0.4rem;" class="liste-clickable PopUpListeSelection">',this.composeItems(),'</ul>');return lHTML.join('');}
composeItems(){const lHTML=[];const lNbr=this.listeRessources.GetNbrElements();for(let i=0;i<lNbr;i++){const lElement=this.listeRessources.GetElement(i);if(lElement.Visible!==false){const lNode=GHtml.composeAttr('ie-node','selectionElement',[lElement.GetNumero()]);const lLibelle=lElement.GetLibelle();lHTML.push('<li tabindex="0" ',lNode,' style="padding: 1rem 0.2rem;" class="PopUpListeSelection-Item" ',GObjetWAI.composeRole(EGenreRole.Listitem),GObjetWAI.composeAttribut({genre:EGenreAttribut.label,valeur:lLibelle}),'>');lHTML.push('<ie-radio ',GHtml.composeAttr('ie-model','radioItem',[lElement.GetNumero()]),' ie-textright class="theme-viescolaire"><span style="padding-left:1rem;">',lLibelle,'</span></ie-radio>');lHTML.push('</li>');}}
return lHTML.join('');}
composeIDItem(i){return this.Nom+'_Item_'+(i);}
surClickElement(aIndiceElement){this.callback.appel({element:this.listeRessources.GetElement(aIndiceElement)});this.fermerModaleListe();}}
module.exports=PopUpListeSelection;},fn:"popuplisteselection.js"});;
IE.fModule({f:function(exports,require,module,global){const{TypeDroits}=require('ObjetDroitsPN.js');const MethodesObjet=require('MethodesObjet.js');const MethodesTableau=require('MethodesTableau.js');const EGenreDocumentJoint=require('Enumere_DocumentJoint.js');const EGenreEtat=require('Enumere_Etat.js');const EGenreEvenementObjetSaisie=require('Enumere_EvenementObjetSaisie.js');const{GDate}=require('ObjetDate.js');const GChaine=require('GChaine.js');const ObjetListeElements=require('ObjetListeElements.js');const GTraductions=require('ObjetTraduction.js');const EGenreEspace=require('Enumere_Espace.js');const EGenreRessource=require('Enumere_Ressource.js');const ObjetIdentite=require('ObjetIdentite.js');const PopUpListeSelection=require('PopUpListeSelection.js');const ObjetCelluleBouton=require('ObjetCelluleBouton.js').ObjetCelluleBouton;const EGenreBoutonCellule=require('ObjetCelluleBouton.js').EGenreBoutonCellule;const EEvent=require('Enumere_Event.js');const TypeThemeBouton=require('Type_ThemeBouton.js');const EGenreOnglet=require('Enumere_Onglet.js');class ObjetVSDetailElement extends ObjetIdentite{constructor(...aParams){super(...aParams);this.listeMotifs=new ObjetListeElements();this.identList=this.Nom+'_ZoneListe';this.options={avecValidation:true};this.estEspaceParent=MethodesTableau.existe(GEtatUtilisateur.GenreEspace,[EGenreEspace.Parent,EGenreEspace.PrimParent,EGenreEspace.Mobile_Parent,EGenreEspace.Mobile_PrimParent]);if(IE.estMobile){this.instanceSelectMotif=ObjetIdentite.creerInstance(ObjetCelluleBouton,{pere:this,evenement:_evntSelecteur.bind(this)});_initSelecteur.call(this,this.instanceSelectMotif);this.instanceListeSelection=ObjetIdentite.creerInstance(PopUpListeSelection,{pere:this,evenement:_evntSelectionMotif.bind(this)});}}
setOptions(aOptions){$.extend(this.options,aOptions);}
DetruireInstances(){if(IE.estMobile){this.instanceListeSelection.free();this.instanceSelectMotif.free();}}
getControleur(aInstance){return $.extend(true,super.getControleur(this),{btnAnnuler:{event:function(){if(IE.estMobile){const lOngletRetour=(GEtatUtilisateur.SaisieAbsence&&GEtatUtilisateur.SaisieAbsence.ongletProvenance)?GEtatUtilisateur.SaisieAbsence.ongletProvenance:EGenreOnglet.VieScolaire_Recapitulatif;GEtatUtilisateur.SaisieAbsence={};GInterface.evenementSurOnglet(lOngletRetour);}}.bind(aInstance)},btnValider:{event:function(){aInstance.callback.appel({element:aInstance.element,documents:aInstance.documents});},getDisabled:function(){return!aInstance.element||(aInstance.element.Etat===EGenreEtat.Aucun);},estVisible:function(){return(aInstance.element.Etat!==EGenreEtat.Aucun)||(aInstance.element.motifParent&&aInstance.element.motifParent.existeNumero())||(aInstance.element.justification)||(aInstance.element.documents&&aInstance.element.documents.GetNbrElementsExistes());}},btnTrash:{event:function(){aInstance.element.SetEtat(EGenreEtat.Suppression);aInstance.callback.appel({element:aInstance.element});},hint:function(){return GTraductions.getValeur('AbsenceVS.SupprimerDeclaration');},btnIf:function(){return aInstance.element&&aInstance.element.estUneCreationParent&&aInstance.element.enAttente;}},telechargerJustificatif:{getOptionsSelecFile:function(){return{genrePJ:EGenreDocumentJoint.Fichier,genreRessourcePJ:EGenreRessource.DocJointEleve,maxFiles:1,maxSize:GApplication.droits.get(TypeDroits.tailleMaxDocJointEtablissement)};},addFiles:function(aParams){aInstance.documents.AddElement(aParams.eltFichier);aInstance.element.documents.AddElement(aParams.eltFichier);aInstance.element.SetEtat(EGenreEtat.Modification);},getDisabled:function(){return!aInstance.element||(aInstance.element.documents&&aInstance.element.documents.GetNbrElementsExistes());}},getLibellePJ:function(){if(aInstance.element&&aInstance.element.documents&&aInstance.element.documents.GetNbrElementsExistes()){const lDocs=[];for(let i=0;i<aInstance.element.documents.GetNbrElements();i++){const lDocument=aInstance.element.documents.GetElement(i);if(lDocument.Existe()){lDocs.push(GChaine.composerUrlLienExterne({documentJoint:lDocument,genreRessource:EGenreRessource.DocumentJoint,avecLien:aInstance.estEspaceParent,afficherIconeDocument:false,ieChipsMinimal:true}));}}
return lDocs.join(', ');} else{return GTraductions.getValeur('AbsenceVS.TelechargerUnJustifcatif');}},getClassPJ:function(){const lClass=['icon_piece_jointe'];if(aInstance.element&&aInstance.element.documents&&aInstance.element.documents.GetNbrElementsExistes()){lClass.push('sansEdition');}
return lClass.join(' ');},btnSupprimer:{event:function(){if(aInstance.element&&aInstance.element.documents&&aInstance.element.documents.GetNbrElementsExistes()){for(let i=0;i<aInstance.element.documents.GetNbrElements();i++){const lDocument=aInstance.element.documents.GetElement(i);if(lDocument.Existe()){lDocument.SetEtat(EGenreEtat.Suppression);aInstance.element.SetEtat(EGenreEtat.Modification);}}}},estVisible:function(){return(aInstance.element.documents&&aInstance.element.documents.GetNbrElementsExistes());}},commentaire:{getValue:function(){return aInstance.element&&aInstance.element.justification?aInstance.element.justification:'';},setValue:function(aValue){if(aInstance.element.justification!==aValue){aInstance.element.justification=aValue;aInstance.element.SetEtat(EGenreEtat.Modification);}},getDisabled:function(){return!aInstance.element;}},getClassCommentaire:function(){return!aInstance.element.justification?'sansCommentaire':'';},comboMotif:{init:function(aInstance){aInstance.setOptions_ObjetSaisie(Object.assign({longueur:'100%',largeurListe:300},_getOptionsCombo.call(aInstance)));},getDonnees:function(aDonnees){if(!aDonnees){return aInstance.listeMotifs;}},getIndiceSelection:function(){const lElement=aInstance.element;if(!lElement||!lElement.motifParent||!lElement.motifParent.existeNumero()){return-1;}
let lIndice=aInstance.listeMotifs.GetIndiceParNumeroEtGenre(lElement.motifParent.GetNumero());if(lIndice<0||!MethodesObjet.isNumber(lIndice)){lIndice= -1;}
return lIndice;},event:function(aParametres){const lElement=aInstance.element;if(aParametres.genreEvenement===EGenreEvenementObjetSaisie.selection&&aParametres.element&&lElement&&(!lElement.motifParent||lElement.motifParent.GetNumero()!==aParametres.element.GetNumero())){aInstance.setElementMotif(aParametres.element);}},getDisabled:function(){return false;}}});}
setElementMotif(aElement){this.element.motifParent=aElement;this.element.SetEtat(EGenreEtat.Modification);this.actualiserLibelleMotif();}
actualiserLibelleMotif(){if(IE.estMobile){const lLibelle=this.element.motifParent&&this.element.motifParent.existeNumero()?this.element.motifParent.GetLibelle():GTraductions.getValeur('AbsenceVS.aPreciser');this.instanceSelectMotif.setLibelleHtml(_getContenuCombo(lLibelle));}}
SetDonnees(aElement){this.element=aElement;this.documents=new ObjetListeElements();this.listeMotifs=this.element.GetGenre()===EGenreRessource.Absence?GEtatUtilisateur.listeMotifsAbsences:GEtatUtilisateur.listeMotifsRetards;if(IE.estMobile){this.instanceListeSelection.SetDonnees(this.listeMotifs,this.element.motifParent);}
this.Afficher(' ');}
initialiserObjets(){if(IE.estMobile){this.instanceSelectMotif.Initialiser();this.instanceListeSelection.Initialiser();}}
afficher(){this.Afficher();this.initialiserObjets();this.actualiserObjets();}
actualiserObjets(){if(IE.estMobile){if(this.listeMotifs.GetNbrElements()===0){this.instanceSelectMotif.SetVisible(false);} else if(this.listeMotifs.GetNbrElements()===1){this.setElementMotif(this.listeMotifs.GetElement(0));} else{this.instanceSelectMotif.SetVisible(true);this.actualiserLibelleMotif();this.instanceSelectMotif.SetActif(true);}}}
ConstruireAffichage(){return this.composeAffichage();}
composeAffichage(){const lHtml=[];if(!!this.element){const lDocs=[];if(this.element.documents){for(let i=0;i<this.element.documents.GetNbrElements();i++){const lDocument=this.element.documents.GetElement(i);if(lDocument.Existe()){lDocs.push(GChaine.composerUrlLienExterne({documentJoint:lDocument,genreRessource:EGenreRessource.DocumentJoint,avecLien:this.estEspaceParent,afficherIconeDocument:false}));}}}
lHtml.push('<h4>',this.element.infosDate.strDate(),'</h4>');if(!!this.element.html.nbrHeures){lHtml.push('<div class="VSDetailDuree details">'+this.element.html.nbrHeures+'</div>');}
if(!!this.element.html.duree){lHtml.push('<div class="VSDetailDuree details">'+this.element.html.duree+'</div>');}
if(this.element.html&&this.element.html.avecSaisie){if(this.element.aJustifierParParents&&!this.element.estMotifNonEncoreConnu){if(!!this.element.infosMotif.texte){lHtml.push('<div class="VSmotif"><div class="VSSaisie">',this.element.infosMotif.texte,'</div></div>');}} else if(IE.estMobile){lHtml.push('<div id="',this.instanceSelectMotif.GetNom(),'" class="VSSaisie VSDetailComboMotif">','</div>');} else{lHtml.push('<div class="VSmotif"><ie-combo ie-model="comboMotif"></ie-combo></div>');}
if(this.element&&(this.element.GetGenre()===EGenreRessource.Absence)){lHtml.push('<div class="VSSaisie VSDetailPJ bt-pj-unique" ie-class="getClassPJ" ie-model="telechargerJustificatif" ie-selecfile><span class="libelle Gras"  ie-html="getLibellePJ"></span><ie-btnimage class="icon_info_sondage_non_publier btnImageIcon" ie-model="btnSupprimer" ie-display="btnSupprimer.estVisible" title="',GTraductions.getValeur('Supprimer'),'"></ie-btnimage></div>');}
lHtml.push('<div class="VSSaisie VSDetailCommentaire"><i class="icon_text"></i><div><ie-textareamax ie-model="commentaire" maxlength="200" ie-class="getClassCommentaire" placeholder="',GTraductions.getValeur('AbsenceVS.AjouterUnCommentaire'),'"></ie-textareamax></div></div>');if(!!this.element.infosMotif.message){lHtml.push('<div class="VSmessage">'+this.element.infosMotif.message+'</div>');}
if(this.options.avecValidation){lHtml.push('<div class="Espace" style="display:flex;justify-content: space-between;">');lHtml.push('<ie-bouton ie-icon="icon_trash" ie-model="btnTrash" ie-hint="btnTrash.hint" ie-if="btnTrash.btnIf" class="btn-flat-minimal ',TypeThemeBouton.secondaire,'"></ie-bouton>');lHtml.push('<div style="min-width: 20rem;display: flex;justify-content: space-evenly;">');lHtml.push('<ie-bouton ie-model="btnAnnuler" class="',TypeThemeBouton.secondaire,'">',GTraductions.getValeur('Annuler'),'</ie-bouton>');lHtml.push('<ie-bouton ie-model="btnValider" ie-display="btnValider.estVisible" class="theme-viescolaire ',TypeThemeBouton.primaire,'">',GTraductions.getValeur('Valider'),'</ie-bouton>');lHtml.push('</div>');lHtml.push('</div>');}} else{lHtml.push('<div class="motif-autre">'+this.element.html.motif+'</div>');if(this.element.html.avecDocuments){lHtml.push('<div class="sectionDocument"><i class="icon_piece_jointe sansEdition"></i><span class="colorTexte">'+lDocs.join(', ')+'</span></div>');}
if(!!this.element.html.commentaire){lHtml.push('<div class="sectionCommentaire"><span>'+GTraductions.getValeur('AbsenceVS.titres.commentaire').ucfirst()+' : </span><span class="colorTexte">'+this.element.html.commentaire+'</span></div>');}
if(!!this.element.infosMotif.message){lHtml.push('<div class="VSmessage">'+this.element.infosMotif.message+'</div>');}
if(!!this.element.dateAccepte){const lStrAccepte='<span class="colorTexte">'+GDate.FormatDate(this.element.dateAccepte,'%JJJ %J %MMM')+'</span>';let lStrAffichee;if(this.element.estUneCreationParent){lStrAffichee=(this.element.refusee)?GTraductions.getValeur('AbsenceVS.absenceRefuseeLe',[lStrAccepte]).ucfirst():GTraductions.getValeur('AbsenceVS.absenceConfirmeeLe',[lStrAccepte]).ucfirst();} else{lStrAffichee=GTraductions.getValeur('AbsenceVS.justificationAccepteLe',[lStrAccepte]).ucfirst();}
lHtml.push('<div class="sectionJustifie">'+(this.element.html.icon?'<span class="colorVS">'+this.element.html.icon+'</span>':'')+lStrAffichee+'</div>');} else if(this.element.justifie&&this.element.html.justifie){lHtml.push('<div class="sectionJustifie">'+(this.element.html.icon?'<span class="colorVS">'+this.element.html.icon+'</span>':'')+this.element.html.justifie+'</div>');}}}
return lHtml.join('');}}
function _initSelecteur(aInstance){aInstance.setOptions_ObjetCelluleBouton({estSaisissable:false,avecZoneSaisie:false,genreBouton:EGenreBoutonCellule.Aucun,largeur:'100%',hauteur:20});aInstance.SetActif(false);}
function _evntSelecteur(aGenreEvent){if((aGenreEvent===EEvent.SurKeyUp&&GNavigateur.IsToucheSelection())||(aGenreEvent===EEvent.SurMouseDown)){this.instanceListeSelection.afficherModaleListe();}}
function _evntSelectionMotif(aParams){this.setElementMotif(aParams.element);this.$refreshSelf();}
function _getContenuCombo(aLibelle){const T=['<div style="display:flex; align-items:center; height:20px; padding:1px 0; width:100%;">'];T.push('<i class="icon_ul" style="flex:none;"></i>');if(!!aLibelle){T.push('<div style="flex: 1 0; text-align: center;font-size:var(--taille-m)"><span class="colorTexte">',aLibelle,'</span></div>');}
T.push('</div>');return T.join('');}
function _getOptionsCombo(){return{placeHolder:{libelleHtml:_getContenuCombo(GTraductions.getValeur('AbsenceVS.aPreciser'))},initAutoSelectionAvecUnElement:false,getContenuCellule:function(aElement){return{libelleHtml:_getContenuCombo(aElement.GetLibelle()||'')};}.bind(this),getContenuElement:function(aParams){const T=['<div style="width:100%; text-align: center;">'];if(!!aParams.element){T.push(aParams.element.GetLibelle());}
T.push('</div>');return T.join('');}};}
module.exports=ObjetVSDetailElement;},fn:"objetvsdetailelement.js"});;
IE.fModule({f:function(exports,require,module,global){const ObjetFiche=require('ObjetFiche.js');const ObjetVSDetailElement=require('ObjetVSDetailElement.js');const EGenreEspace=require('Enumere_Espace.js');const MethodesTableau=require('MethodesTableau.js');const GTraductions=require('ObjetTraduction.js');const TypeThemeBouton=require('Type_ThemeBouton.js');const EGenreOnglet=require('Enumere_Onglet.js');const EGenreEtat=require('Enumere_Etat.js');const MethodesObjet=require('MethodesObjet.js');class ObjetFicheVSDetailElement extends ObjetFiche{constructor(...aParams){super(...aParams);this.largeurMax=500;this.hauteurMax=1250;this.idScroll=this.Nom+'_scroll';this.objetDetailVS=new ObjetVSDetailElement(this.Nom+".objetDetailVS",null,this,this.evntDetailVS);this.objetDetailVS.setOptions({avecValidation:false});this.setOptionsFenetre({largeur:350,hauteur:null,avecTailleSelonContenu:true,titre:function(){return'<div>'+this.titreFiche+'</div>';}.bind(this)});}
evntDetailVS(aParams){$.extend(aParams,{ongletRetour:EGenreOnglet.Accueil});this.callback.appel(aParams);this.Fermer();}
setOptions(aOptions){$.extend(this.options,aOptions);}
DetruireInstances(){this.objetDetailVS.DetruireInstances();}
SetDonnees(aParams){this.element=MethodesObjet.dupliquer(aParams.element);this.avecSaisie=this.element.avecSaisie;this.estCreationParent=this.element.estUneCreationParent;this.setTitreFiche(aParams.titre);const lEstEspaceParent=MethodesTableau.existe(GEtatUtilisateur.GenreEspace,[EGenreEspace.Parent,EGenreEspace.PrimParent,EGenreEspace.Mobile_Parent,EGenreEspace.Mobile_PrimParent]);$.extend(this.options,{autorisations:aParams.autorisations,avecSaisie:this.avecSaisie,sansSetEtatSaisie:!!aParams.sansSetEtatSaisie,avecJustificatifAbsence:lEstEspaceParent,avecSaisieObservation:lEstEspaceParent,avecARPunition:lEstEspaceParent});this.objetDetailVS.SetDonnees(this.element);this.afficherFiche({id:aParams.id,positionSurSouris:true,positionSurSourisSiAffiche:true});}
getControleur(aInstance){return $.extend(true,super.getControleur(this),{btnAnnuler:{event:function(){aInstance.Fermer();}},btnSupprimer:{event:function(){aInstance.element.SetEtat(EGenreEtat.Suppression);aInstance.callback.appel({element:aInstance.element});},hint:function(){return GTraductions.getValeur('AbsenceVS.SupprimerDeclaration');},btnIf:function(){return aInstance.element&&aInstance.element.estUneCreationParent&&aInstance.element.enAttente;}},btnValider:{event:function(){aInstance.callback.appel({element:aInstance.element,documents:aInstance.objetDetailVS.documents});},getDisabled:function(){return!aInstance.element||(aInstance.element.Etat===EGenreEtat.Aucun);},estVisible:function(){return aInstance.avecSaisie;}}});}
setTitreFiche(aTitre){this.titreFiche=aTitre;}
ComposeContenu(){const H=[];H.push('<div class="ifc_RecapVS details-element theme-cat-viescolaire">');H.push('<div id="',this.objetDetailVS.GetNom(),'" class="ifc_RecapVS_EcranElement_Content VSFiche"></div>');H.push('<div class="zone-bas">');H.push('<div class="Fenetre_Bas">');H.push('<ie-bouton ie-icon="icon_trash" ie-model="btnSupprimer" ie-hint="btnSupprimer.hint" ie-if="btnSupprimer.btnIf" class="btn-flat-minimal ',TypeThemeBouton.secondaire,'"></ie-bouton>');H.push('</div>');H.push('<div class="VSBoutonValiderFiche" ie-display="btnValider.estVisible">');H.push('<ie-bouton ie-model="btnAnnuler" class="',TypeThemeBouton.secondaire,'">',GTraductions.getValeur('Annuler'),'</ie-bouton><ie-bouton ie-model="btnValider" class="',TypeThemeBouton.primaire,'">',GTraductions.getValeur('Valider'),'</ie-bouton></div>');H.push('</div>');H.push('</div>');return H.join('');}
surPreAffichage(){this.objetDetailVS.Initialiser();}}
module.exports=ObjetFicheVSDetailElement;},fn:"objetfichevsdetailelement.js"});;
IE.fModule({f:function(exports,require,module,global){require('Produit/Css/ObjetRecapitulatifsVS.css');require('Produit/Css/FlatListeEvenementsVS.css');const MethodesTableau=require('MethodesTableau.js');const{GObjetWAI,EGenreRole,EGenreAttribut}=require('ObjetWAI.js');const GHtml=require('GHtml.js');const{GDate}=require('ObjetDate.js');const ObjetIdentite=require('ObjetIdentite.js');const GTraductions=require('ObjetTraduction.js');const EGenreRessource=require('Enumere_Ressource.js');const EGenreEspace=require('Enumere_Espace.js');const TypeGenreObservationVS=require('TypeGenreObservationVS.js').TypeGenreObservationVS;const GUID=require('GUID.js');class ObjetVSListeDetails extends ObjetIdentite{constructor(...aParams){super(...aParams);this.estEspaceParent=MethodesTableau.existe(GEtatUtilisateur.GenreEspace,[EGenreEspace.Parent,EGenreEspace.PrimParent,EGenreEspace.Mobile_Parent,EGenreEspace.Mobile_PrimParent]);this.idMessage=GUID.getId();}
getControleur(aInstance){return $.extend(true,super.getControleur(this),{selectionDetail:function(aEvenement,aNumeroElement){$(this.node).eventValidation(function(aEvent){aEvent.stopPropagation();const lElement=aInstance.objDonneesDuRecap.donnees.GetElementParNumero(aNumeroElement);aInstance.callback.appel({element:lElement,evenement:aEvenement});$(this).siblings().removeClass('detail-selected');$(this).addClass('detail-selected');});},suisInformee:{getValue:function(aNumeroElement){const lElement=aInstance.objDonneesDuRecap.donnees.GetElementParNumero(aNumeroElement);return lElement.estLue;},setValue:function(aNumeroElement,aValue){const lElement=aInstance.objDonneesDuRecap.donnees.GetElementParNumero(aNumeroElement);if(aValue){aInstance.callback.appel({element:lElement,evenement:ObjetVSListeDetails.evenement.validationObservation});}},getDisabled:function(aNumeroElement){const lElement=aInstance.objDonneesDuRecap.donnees.GetElementParNumero(aNumeroElement);return lElement&&lElement.estLue;}},ARPunition:{getValue:function(aNumeroElement){const lElement=aInstance.objDonneesDuRecap.donnees.GetElementParNumero(aNumeroElement);return lElement.parentAAccuseDeReception;},setValue:function(aNumeroElement,aValue){const lElement=aInstance.objDonneesDuRecap.donnees.GetElementParNumero(aNumeroElement);if(aValue){aInstance.callback.appel({element:lElement,evenement:ObjetVSListeDetails.evenement.validationARPunition});}},getDisabled:function(aNumeroElement){const lElement=aInstance.objDonneesDuRecap.donnees.GetElementParNumero(aNumeroElement);return lElement&&lElement.parentAAccuseDeReception;}},hintPJ:function(aNumeroElement){const lElement=aInstance.objDonneesDuRecap.donnees.GetElementParNumero(aNumeroElement);const lResult=[];for(let i=0;i<lElement.documents.GetNbrElements();i++){const lDocument=lElement.documents.GetElement(i);if(lDocument.Existe()){lResult.push(lDocument.hint);}}
return lResult.join('<br />');},hintCommentaire:function(aNumeroElement){const lElement=aInstance.objDonneesDuRecap.donnees.GetElementParNumero(aNumeroElement);let lHint='';if(lElement&&lElement.html&&lElement.html.commentaire){lHint=lElement.html.commentaire.replace(/\n/g,'<br />');}
return lHint;}});}
ConstruireAffichage(){const lHtml=[];if(this.objDonneesDuRecap){lHtml.push('<ul ',GObjetWAI.composeRole(EGenreRole.List),' class="liste-clickable ObjetVSListeDetails">');if(this.objDonneesDuRecap.genre===EGenreRessource.Aucune){lHtml.push(_composeTotaux.call(this,this.objDonneesDuRecap));} else{lHtml.push(_composeListeDetails.call(this,this.objDonneesDuRecap));}
lHtml.push('</ul>');} else{lHtml.push('<div id="',this.idMessage,'" class="message-vide ObjetVSListeDetails_message">',_getHtmlMessageVide(GTraductions.getValeur('RecapAbsenceEleve.SelectionnerUnRecap')),'</div>');}
return lHtml.join('');}
setHtmlMessageVide(aMessage){GHtml.setHtml(this.idMessage,_getHtmlMessageVide(aMessage));}
SetDonnees(aDonnees){this.objDonneesDuRecap=aDonnees;this.Afficher();}}
ObjetVSListeDetails.evenement={selection:'VSDetail_selection',validationObservation:'VSDetail_validationObservation',editionMotifParent:'VDetail_editionMotifParent',validationARPunition:'VDetail_validationARPunition'};function _getHtmlMessageVide(aMessage){return['<span class="message" >',aMessage,'</span><div class="Image_No_Data"></div>'].join('');}
function _getPlacesEnDuree(aPlaces){return aPlaces>=0?GDate.FormatDureeEnMillisecondes(aPlaces*1000,'%xh%sh%mm'):'';}
function _composeTotaux(aObjDonnees){const lHtml=[];if(aObjDonnees.totaux){lHtml.push('<li tabindex="0" class="listeHeures total">');lHtml.push('<h4>'+GTraductions.getValeur('RecapAbsenceEleve.ToutesLesMatieres')+'</h4>');lHtml.push('<div>');lHtml.push('<section>');lHtml.push('<div>','<span class="total">',_getPlacesEnDuree(aObjDonnees.totaux.absence),'</span>','<span> : ',GTraductions.getValeur('RecapAbsenceEleve.Absences'),'</span>','</div>');lHtml.push('<div>','<span class="total">',_getPlacesEnDuree(aObjDonnees.totaux.excluCours),'</span>','<span> : ',GTraductions.getValeur('RecapAbsenceEleve.ExclusionCours'),'</span>','</div>');lHtml.push('<div>','<span class="total">',_getPlacesEnDuree(aObjDonnees.totaux.excluEtab),'</span>','<span> : ',GTraductions.getValeur('RecapAbsenceEleve.ExclusionEtablissement'),'</span>','</div>');lHtml.push('</section>');lHtml.push('<aside>','<span><span class="total">',_getPlacesEnDuree(aObjDonnees.totaux.total),'</span><span style="padding: 0 0.1rem;">/</span></span><span>',_getPlacesEnDuree(aObjDonnees.totaux.suivi),'</span>','</aside>');lHtml.push('</div>');lHtml.push('</li>');}
if(aObjDonnees.donnees){for(let i=0;i<aObjDonnees.donnees.GetNbrElements();i++){const lElm=aObjDonnees.donnees.GetElement(i);const lClass=['listeHeures'];if(lElm.dansRegroupement>0){lClass.push('estItemDUnRegroupement');}
if(lElm.estUnDeploiement){lClass.push('estUnRegroupement');}
if(lElm.total>0){lHtml.push('<li tabindex="0" class="',lClass.join(' '),'">');lHtml.push('<h4>'+lElm.GetLibelle()+'</h4>');lHtml.push('<div>');lHtml.push('<section>');if(lElm.absence>0){lHtml.push('<div>','<span class="nombre">',_getPlacesEnDuree(lElm.absence),'</span>','<span> : ',GTraductions.getValeur('RecapAbsenceEleve.Absences'),'</span>','</div>');}
if(lElm.excluCours>0){lHtml.push('<div>','<span class="nombre">',_getPlacesEnDuree(lElm.excluCours),'</span>','<span> : ',GTraductions.getValeur('RecapAbsenceEleve.ExclusionCours'),'</span>','</div>');}
if(lElm.excluEtab>0){lHtml.push('<div>','<span class="nombre">',_getPlacesEnDuree(lElm.excluEtab),'</span>','<span> : ',GTraductions.getValeur('RecapAbsenceEleve.ExclusionEtablissement'),'</span>','</div>');}
lHtml.push('</section>');lHtml.push('<aside>','<span><span class="nombre">',_getPlacesEnDuree(lElm.total),'</span><span style="padding: 0 0.1rem;">/</span></span><span>',_getPlacesEnDuree(lElm.suivi),'</span>','</aside>');lHtml.push('</div>');lHtml.push('</li>');}}}
return lHtml.join('');}
function _composeListeDetails(aObjDonnees){const lHtml=[];let lRegroupement='';if(aObjDonnees.donnees){for(let i=0;i<aObjDonnees.donnees.GetNbrElements();i++){const lElement=aObjDonnees.donnees.GetElement(i);switch(aObjDonnees.genre){case EGenreRessource.ObservationProfesseurEleve:if((aObjDonnees.recapitulatif.genreObservation===TypeGenreObservationVS.OVS_Autres)&&(lElement.GetLibelle()!==lRegroupement)){lRegroupement=lElement.GetLibelle();lElement.estPremier=true;lHtml.push('<li class="listeDetails VSRegroupement"><h4>',lRegroupement,'</h4></li>');}
lHtml.push(_composeObservations.call(this,lElement,aObjDonnees));break;case EGenreRessource.Absence:lHtml.push(_composeAbsences.call(this,lElement,aObjDonnees));break;case EGenreRessource.AbsenceRepas:lHtml.push(_composeAbsences.call(this,lElement,aObjDonnees));break;case EGenreRessource.AbsenceInternat:lHtml.push(_composeAbsences.call(this,lElement,aObjDonnees));break;case EGenreRessource.Infirmerie:lHtml.push(_composeAutre.call(this,lElement,aObjDonnees));break;case EGenreRessource.Retard:lHtml.push(_composeAbsences.call(this,lElement,aObjDonnees));break;case EGenreRessource.Incident:lHtml.push(_composeIncident.call(this,lElement,aObjDonnees));break;case EGenreRessource.Punition:lHtml.push(_composePunition.call(this,lElement,aObjDonnees));break;case EGenreRessource.Sanction:lHtml.push(_composeAutre.call(this,lElement,aObjDonnees));break;case EGenreRessource.MesureConservatoire:lHtml.push(_composeAutre.call(this,lElement,aObjDonnees));break;default:;break;}}}
return lHtml.join('');}
function _composeObservations(aElement,aObjDonnees){const lAvecEvenement=this.estEspaceParent&&aElement.avecARObservation;aObjDonnees.utilitaireAbsence.remplirContentHtml({element:aElement,genre:aObjDonnees.genre,genreObservation:aObjDonnees.recapitulatif.genreObservation,node:lAvecEvenement?GHtml.composeAttr('ie-node','selectionDetail',[ObjetVSListeDetails.evenement.selection,aElement.GetNumero()]):null,model:lAvecEvenement?GHtml.composeAttr('ie-model','suisInformee',[aElement.GetNumero()]):null});return _composeHtml.call(this,aElement.html);}
function _composePunition(aElement,aObjDonnees){const lAvecEvenement=aElement.GetGenre()===EGenreRessource.Punition&&aElement.nature&&aElement.nature.estAvecARParent&&this.estEspaceParent;aObjDonnees.utilitaireAbsence.remplirContentHtml({element:aElement,genre:aObjDonnees.genre,model:lAvecEvenement?GHtml.composeAttr('ie-model','ARPunition',[aElement.GetNumero()]):null});return _composeHtml.call(this,aElement.html);}
function _composeIncident(aElement,aObjDonnees){const lAvecEvenement=aElement.GetGenre()===EGenreRessource.Incident&&aElement.estAvecARParent&&this.estEspaceParent;aObjDonnees.utilitaireAbsence.remplirContentHtml({element:aElement,genre:aObjDonnees.genre,model:lAvecEvenement?GHtml.composeAttr('ie-model','ARPunition',[aElement.GetNumero()]):null});return _composeHtml.call(this,aElement.html);}
function _composeAutre(aElement,aObjDonnees){aObjDonnees.utilitaireAbsence.remplirContentHtml({element:aElement,genre:aObjDonnees.genre});return _composeHtml.call(this,aElement.html);}
function _composeHtml(aInfos){const lHtml=[];lHtml.push('<li tabindex="0" ',aInfos.node,' class="',aInfos.class.join(' '),'" ',GObjetWAI.composeRole(EGenreRole.Listitem),(aInfos.aria?GObjetWAI.composeAttribut({genre:EGenreAttribut.label,valeur:aInfos.aria}):''),'>');if(aInfos.icon){lHtml.push(aInfos.icon);}
lHtml.push('<div class="detail-vs-item">');lHtml.push('<div class="detail-titre">');lHtml.push('<h4>',aInfos.titre,'</h4>');lHtml.push('</div>');const lClass=aInfos.classSection&&aInfos.classSection.length>0?' class="'+aInfos.classSection.join(' ')+'"':'';lHtml.push('<section',lClass,'>');lHtml.push(aInfos.content.join(''));lHtml.push('</section>');lHtml.push('</div>');lHtml.push('</li>');return lHtml.join('');}
function _composeAbsences(aElement,aObjDonnees){const lPourSaisieParent=this.estEspaceParent&&aObjDonnees.recapitulatif.avecAutorisation;let lEvenement=ObjetVSListeDetails.evenement.selection;const lGenreAvecDetailEdition=(aObjDonnees.genre===EGenreRessource.Absence||aObjDonnees.genre===EGenreRessource.Retard);let lNode=null;if(this.estEspaceParent){if(lPourSaisieParent&&lGenreAvecDetailEdition&&this.options.avecBascule){lEvenement=ObjetVSListeDetails.evenement.editionMotifParent;}
lNode=GHtml.composeAttr('ie-node','selectionDetail',[lEvenement,aElement.GetNumero()]);}
aObjDonnees.utilitaireAbsence.remplirContentHtml({element:aElement,genre:aObjDonnees.genre,pourParent:this.estEspaceParent,avecBascule:this.options.avecBascule,avecSaisie:lPourSaisieParent,node:lNode,nodeEdition:GHtml.composeAttr('ie-node','selectionDetail',[ObjetVSListeDetails.evenement.editionMotifParent,aElement.GetNumero()]),ieHintPJ:GHtml.composeAttr('ie-hint','hintPJ',[aElement.GetNumero()]),ieHintCommentaire:GHtml.composeAttr('ie-hint','hintCommentaire',[aElement.GetNumero()])});return _composeHtml.call(this,aElement.html);}
module.exports=ObjetVSListeDetails;},fn:"objetvslistedetails.js"});;
IE.fModule({f:function(exports,require,module,global){const Identite=require('ObjetIdentite.js');const MethodesTableau=require('MethodesTableau.js');const ObjetFenetre=require('ObjetFenetre.js');const ObjetListeElements=require('ObjetListeElements.js');const{GObjetWAI,EGenreRole,EGenreAttribut}=require('ObjetWAI.js');const EGenreEspace=require('Enumere_Espace.js');const EGenreRessource=require('Enumere_Ressource.js');const ObjetUtilitaireAbsence=require('ObjetUtilitaireAbsence.js');const TypeGenreObservationVS=require('TypeGenreObservationVS.js').TypeGenreObservationVS;const EGenreOnglet=require('Enumere_Onglet.js');const ObjetFicheVSDetailElement=require('ObjetFicheVSDetailElement.js');const ObjetVSListeDetails=require('ObjetVSListeDetails.js');const ObjetElement=require('ObjetElement.js');const GHtml=require('GHtml.js');const GTraductions=require('ObjetTraduction.js');class WidgetVieScolaire extends Identite{creerObjets(){this.utilitaireAbsence=new ObjetUtilitaireAbsence();}
initialiserObjets(){}
composeWidget(){var H=[];if(this.donnees.listeAbsences.GetNbrElements()>0){H.push('<ul role="list" class="liste-clickable">');for(var I=0;I<this.donnees.listeAbsences.GetNbrElements();I++){var lAbsence=this.donnees.listeAbsences.GetElement(I);H.push(this.composeAbsence(lAbsence,I));}
H.push('</ul>');}
return H.join('');}
construire(aParams){this.donnees=aParams.donnees;this.creerObjets();var lWidget={html:this.composeWidget(),nbrElements:this.donnees.listeAbsences.GetNbrElements(),afficherMessage:this.donnees.listeAbsences.GetNbrElements()===0,fermerFiches:function(){}.bind(this)};$.extend(true,this.donnees,lWidget);aParams.construireWidget(this.donnees);this.initialiserObjets();}
composeAbsence(aAbsence,i){var H=[];var lLibelle=this.utilitaireAbsence.getChaineTraductionGenreAbsence({genre:aAbsence.GetGenre(),genreObservation:aAbsence.genreObservation,libelle:aAbsence.GetLibelle(),singulier:true,justifie:aAbsence.justifie}).ucfirst();if(aAbsence.estUneCreationParent){if(!!aAbsence.dateAccepte){lLibelle=(aAbsence.refusee)?GTraductions.getValeur('AbsenceVS.absenceRefusee').ucfirst():GTraductions.getValeur('AbsenceVS.absenceConfirmee').ucfirst();} else{lLibelle=GTraductions.getValeur('AbsenceVS.absenceEnAttente');}}
var lDate=this.utilitaireAbsence.getDate(aAbsence,true);const lEstLue=aAbsence.genreObservation===TypeGenreObservationVS.OVS_Encouragement||aAbsence.estLue;var lClassIcon=EGenreRessource.getNomImageAbsence({genre:aAbsence.GetGenre(),genreObservation:aAbsence.genreObservation,genreNature:aAbsence.nature?aAbsence.nature.GetGenre():null,justifie:aAbsence.justifie,confirmee:aAbsence.confirmee,estLue:lEstLue,avecSursis:aAbsence.avecSursis,estUneCreationParent:aAbsence.estUneCreationParent,refusee:aAbsence.refusee,enAttente:aAbsence.enAttente});H.push('<li tabIndex="0" class="icon ',lClassIcon,'"',GObjetWAI.composeRole(EGenreRole.Link),' ',GObjetWAI.composeAttribut({genre:EGenreAttribut.label,valeur:lLibelle+' '+lDate}),' ',' onclick="',this.Nom,'._surAbsence (',i,')" onkeyup="if(GNavigateur.IsToucheSelection())',this.Nom,'._surAbsence (',i,')">');H.push('<div class="wrap">','<h4>',lLibelle,'</h4>','<span class="date">',lDate,'</span>','</div>','</li>');return H.join('');}
_surAbsence(i){var lListeAbsencesFiche=new ObjetListeElements();var lAbsence=this.donnees.listeAbsences.GetElement(i);lListeAbsencesFiche.AddElement(lAbsence);if((((lAbsence.GetGenre()===EGenreRessource.Absence)||(lAbsence.GetGenre()===EGenreRessource.Retard))&&(!lAbsence.justifie))&&(!IE.estMobile)&&!!lAbsence.avecSaisie&&(MethodesTableau.existe(GEtatUtilisateur.GenreEspace,[EGenreEspace.Parent,EGenreEspace.PrimParent]))){if(!!this.fiche){this.fiche.Fermer();}
this.fiche=ObjetFenetre.creerInstance(ObjetFicheVSDetailElement,{pere:this,evenement:this.utilitaireAbsence.eventApresFiche.bind(this,lAbsence),initialiser:false});this.fiche.setOptions({avecCallBackSurBouton:true});this.fiche.Initialiser();var lObjDonneesDuRecap=this.utilitaireAbsence.getDonneesAAfficher.call(this,{recapitulatif:new ObjetElement()});var lPourSaisieParent=this.estEspaceParent&&lObjDonneesDuRecap.recapitulatif.avecAutorisation;var lEvenement=ObjetVSListeDetails.evenement.selection;var lGenreAvecDetailEdition=(lObjDonneesDuRecap.genre===EGenreRessource.Absence||lObjDonneesDuRecap.genre===EGenreRessource.Retard);var lNode=null;if(this.estEspaceParent){if(lPourSaisieParent&&lGenreAvecDetailEdition&&this.options.avecBascule){lEvenement=ObjetVSListeDetails.evenement.editionMotifParent;}
lNode=GHtml.composeAttr('ie-node','selectionDetail',[lEvenement,lAbsence.GetNumero()]);}
this.utilitaireAbsence.remplirContentHtml({element:lAbsence,genre:EGenreRessource.Absence,pourParent:this.estEspaceParent,avecBascule:this.options.avecBascule,avecSaisie:true,node:lNode,nodeEdition:GHtml.composeAttr('ie-node','selectionDetail',[ObjetVSListeDetails.evenement.editionMotifParent,lAbsence.GetNumero()]),ieHintPJ:GHtml.composeAttr('ie-hint','hintPJ',[lAbsence.GetNumero()]),ieHintCommentaire:GHtml.composeAttr('ie-hint','hintCommentaire',[lAbsence.GetNumero()])});this.fiche.SetDonnees({element:lAbsence,titre:(lAbsence.GetGenre()===EGenreRessource.Absence?GTraductions.getValeur('AbsenceVS.JustifierAbsence'):GTraductions.getValeur('AbsenceVS.JustifierRetard'))});} else{GEtatUtilisateur.SaisieAbsence={ongletProvenance:GEtatUtilisateur.getGenreOnglet()};GEtatUtilisateur.setPage({Onglet:EGenreOnglet.VieScolaire_Recapitulatif,executerSaisieMotifAbsence:true,retourAccueil:true,element:lAbsence});GEtatUtilisateur.Navigation.OptionsOnglet={};if(GEtatUtilisateur.getGenreOnglet()){var lGenreOnglet=GEtatUtilisateur.getGenreOnglet();if(GEtatUtilisateur.listeOngletsInvisibles.indexOf(lGenreOnglet)=== -1){if(IE.estMobile){this.Pere.callback.appel({genreOngletDest:lGenreOnglet});} else{this.Pere.evenementPage(this.Pere.genreEvenement.selectionPage,{Onglet:EGenreOnglet.VieScolaire_Recapitulatif,executerSaisieMotifAbsence:true,element:lAbsence});}}}}}
majAbsenceApresSaisie(aAbsenceOrig,aAbsenceSaisie){this.utilitaireAbsence._majAbsenceApresSaisie(aAbsenceOrig,aAbsenceSaisie);}}
module.exports=WidgetVieScolaire;},fn:"espace/script/widget/widgetviescolaire.js"});;
IE.fModule({f:function(exports,require,module,global){
const GUID=require('GUID.js');const EGenreEspace=require('Enumere_Espace.js');const EGenreOnglet=require('Enumere_Onglet.js');const EGenreWidget=require('Enumere_Widget.js');const EGenreLienDS=require('Enumere_LienDS.js');const GTraductions=require('ObjetTraduction.js');const MethodesTableau=require('MethodesTableau.js');const WidgetAbsencesJustifieesParents=require('espace/script/widget/WidgetAbsencesJustifieesParents.js');const WidgetActualites=require('espace/script/widget/WidgetActualites.js');const WidgetAgenda=require('espace/script/widget/WidgetAgenda.js');const WidgetAide=require('espace/script/widget/WidgetAide.js');const WidgetAppelNonFait=require('espace/script/widget/WidgetAppelNonFait.js');const WidgetBlog_FilActu=require('espace/script/widget/WidgetBlog_FilActu.js');const WidgetCarnetDeCorrespondance=require('espace/script/widget/WidgetCarnetDeCorrespondance.js');const WidgetCasier=require('espace/script/widget/WidgetCasier.js');const WidgetCDC=require('espace/script/widget/WidgetCDC.js');const WidgetCDTNonSaisi=require('espace/script/widget/WidgetCDTNonSaisi.js');const WidgetCompetences=require('espace/script/widget/WidgetCompetences.js');const WidgetConnexionsEnCours=require('espace/script/widget/WidgetConnexionsEnCours.js');const WidgetCoursNonAssures=require('espace/script/widget/WidgetCoursNonAssures.js');const WidgetDiscussions=require('espace/script/widget/WidgetDiscussions.js');const WidgetDonneesProfs=require('espace/script/widget/WidgetDonneesProfs.js');const WidgetDonneesVS=require('espace/script/widget/WidgetDonneesVS.js');const WidgetDS=require('espace/script/widget/WidgetDS.js');const WidgetDSEvaluation=require('espace/script/widget/WidgetDSEvaluations.js');const WidgetEDT=require('espace/script/widget/WidgetEDT.js');const WidgetEDTJournalier=require('espace/script/widget/WidgetEDTJournalier.js');const WidgetElections=require('espace/script/widget/WidgetElections.js');const WidgetEnseignementADistance=require('espace/script/widget/WidgetEnseignementADistance.js');const WidgetIncidents=require('espace/script/widget/WidgetIncidents.js');const WidgetExclusions=require('espace/script/widget/WidgetExclusions.js');const WidgetIntendance_Execute=require('espace/script/widget/WidgetIntendance_Execute.js');const WidgetKiosque=require('espace/script/widget/WidgetKiosque.js');const WidgetLienUtile=require('espace/script/widget/WidgetLienUtile.js');const WidgetMenu=require('espace/script/widget/WidgetMenu.js');const WidgetNotes=require('espace/script/widget/WidgetNotes.js');const WidgetPartenaireAgate=require('espace/script/widget/WidgetPartenaireAgate.js');const WidgetPartenaireARD=require('espace/script/widget/WidgetPartenaireArd.js');const WidgetPartenaireApplicam=require('espace/script/widget/WidgetPartenaireApplicam.js');const WidgetPartenaireCDI=require('espace/script/widget/WidgetPartenaireCDI.js');const WidgetPenseBete=require('espace/script/widget/WidgetPenseBete.js');const WidgetPersonnelsAbsents=require('espace/script/widget/WidgetPersonnelsAbsents.js');const WidgetPlanning=require('WidgetPlanning.js');const WidgetQCM=require('espace/script/widget/WidgetQCM.js');const WidgetRessources=require('espace/script/widget/WidgetRessources.js');const WidgetRessourcePedagogique=require('espace/script/widget/WidgetRessourcePedagogique.js');const WidgetRetourEspace=require('mobile/script/Widget/WidgetRetourEspace.js');const WidgetTableauDeBord=require('espace/script/widget/WidgetTableauDeBord.js');const WidgetTAF=require('espace/script/widget/WidgetTAF.js');const WidgetTAFPrimaire=require('espace/script/widget/widgetTAFPrimaire.js');const WidgetTAFARendre=require('espace/script/widget/WidgetTAFARendre.js');const WidgetTAFEtActivites=require('espace/script/widget/WidgetTAFEtActivites.js');const WidgetVieScolaire=require('espace/script/widget/WidgetVieScolaire.js');const WidgetEvenementRappel=require('espace/script/widget/widgetEvenementRappel.js');const ObjetMoteurBlog=require('ObjetMoteurBlog.js').ObjetMoteurBlog;const TypeModeAff=require('TypeEtatPublication.js').TypeModeAff;class ObjetMoteurAccueil{constructor(){this.genreColonne={agendaEtInformations:{genre:0,position:4,actif:false,visible:true},notes:{genre:1,position:2,actif:false,visible:true},CDT:{genre:2,position:1,minWidth:360,maxWidth:500,actif:false,visible:true},emploiDuTemps:{genre:3,position:0,maximise:GEtatUtilisateur.GenreEspace===EGenreEspace.Professeur?true:false,actif:false,visible:true},absencesProf:{genre:4,position:3,actif:false,visible:true},aide:{genre:5,position:5,poids:1,actif:false,visible:true},tableauDeBord:{genre:6,position:0,minWidth:360,maxWidth:500,actif:false,visible:true},communications:{genre:7,position:2,minWidth:360,maxWidth:500,actif:false,visible:true},central:{genre:8,position:2,minWidth:360,maxWidth:500,actif:false,visible:true}};this.moteurBlog=new ObjetMoteurBlog();}
setDonnees(aDonnees){this.donnees=aDonnees;}
setDateParDefaut(aDate){this.dateParDefaut=aDate;}
setSemaineSelectionnee(aSemaineSelectionnee){this.semaineSelectionnee=aSemaineSelectionnee;}
existeDS(aGenreLienDS){if(this.donnees.devoirSurveille.listeDS){for(let i=0;i<this.donnees.devoirSurveille.listeDS.GetNbrElements();i++){if(this.donnees.devoirSurveille.listeDS.GetGenre(i)===aGenreLienDS){return true;}}}
return false;}
getDeclarationWidget(aGenreWidget){switch(aGenreWidget){case EGenreWidget.activite:return{nomDonnees:'activite',genre:EGenreWidget.activite,id:GUID.getId(),classWidget:WidgetTAFPrimaire,existe:function(){return!!this.donnees.activite&&!!this.donnees.activite.listeActivite&&!!this.donnees.activite.listeActivite.GetNbrElements();},isCollapsible:false,titre:GTraductions.getValeur('accueil.ActiviteDuJour'),page:{Onglet:EGenreOnglet.CDT_TAF},themeCategorie:'theme-cat-pedagogie'};case EGenreWidget.actualites:return{nomDonnees:'actualites',genre:EGenreWidget.actualites,genreColonne:GEtatUtilisateur.GenreEspace===EGenreEspace.Etablissement||GEtatUtilisateur.pourPrimaire()?this.genreColonne.absencesProf.genre:this.genreColonne.agendaEtInformations.genre,classWidget:WidgetActualites,id:GUID.getId(),page:{Onglet:EGenreOnglet.Informations},titre:GEtatUtilisateur.pourPrimaire()&&!MethodesTableau.existe(GEtatUtilisateur.GenreEspace,[EGenreEspace.PrimProfesseur,EGenreEspace.Mobile_PrimProfesseur,EGenreEspace.PrimPeriscolaire,EGenreEspace.Mobile_PrimPeriscolaire])?GTraductions.getValeur('accueil.actualitesPrimaire'):GTraductions.getValeur('accueil.actualites'),hint:GTraductions.getValeur('accueil.info.actualites'),message:GTraductions.getValeur('accueil.aucuneActualite'),existe:function(){return!this.donnees||(this.donnees.actualites&&this.donnees.actualites.listeModesAff&&this.donnees.actualites.listeModesAff[TypeModeAff.MA_Reception].listeActualites);}.bind(this),isCollapsible:true,position:GEtatUtilisateur.GenreEspace===EGenreEspace.Etablissement?13:12,poids:2,selecteurNavigationFleche:'[onclick]',classElementFocus:'ObjetAffichagePageAccueilElementAvecFocus',themeCategorie:'theme-cat-communication'};case EGenreWidget.agenda:return{nomDonnees:'agenda',genre:EGenreWidget.agenda,genreColonne:GEtatUtilisateur.GenreEspace===EGenreEspace.Etablissement||GEtatUtilisateur.pourPrimaire()?this.genreColonne.absencesProf.genre:this.genreColonne.agendaEtInformations.genre,classWidget:WidgetAgenda,id:GUID.getId(),page:{Onglet:EGenreOnglet.Agenda},titre:GTraductions.getValeur('accueil.agenda.titre'),hint:GTraductions.getValeur('accueil.info.agenda'),message:GTraductions.getValeur('accueil.aucuneAgenda'),existe:function(){return!this.donnees||this.donnees.agenda.listeEvenements;}.bind(this),isCollapsible:true,position:GEtatUtilisateur.GenreEspace===EGenreEspace.Etablissement?12:11,poids:1,selecteurNavigationFleche:'[onclick]',classElementFocus:'ObjetAffichagePageAccueilElementAvecFocus',semaineSelectionnee:this.numeroSemaineParDefaut,themeCategorie:'theme-cat-communication'};case EGenreWidget.aide:return{nomDonnees:'aide',genre:EGenreWidget.aide,genreColonne:this.genreColonne.aide.genre,classWidget:WidgetAide,id:GUID.getId(),titre:GTraductions.getValeur('accueil.aide.titre'),existe:function(){return false;},isCollapsible:false,position:1,poids:1,selecteurNavigationFleche:'[onclick]',classElementFocus:'ObjetAffichagePageAccueilElementAvecFocus',maximise:true,themeCategorie:'theme-cat-communication'};case EGenreWidget.appelNonFait:return{nomDonnees:'appelNonFait',genre:EGenreWidget.appelNonFait,genreColonne:this.genreColonne.absencesProf.genre,classWidget:WidgetAppelNonFait,id:GUID.getId(),page:{Onglet:GEtatUtilisateur.existeGenreOnglet(EGenreOnglet.SaisieAbsences_AppelEtSuivi)?EGenreOnglet.SaisieAbsences_AppelEtSuivi:EGenreOnglet.SaisieAbsences_Appel},titre:GTraductions.getValeur('accueil.appelNonFait.titre'),hint:'',message:GTraductions.getValeur('accueil.appelNonFait.message'),existe:function(){return!this.donnees||this.donnees.appelNonFait.listeAppelNonFait?true:false;},isCollapsible:true,nbrItemsVisible:3,position:GEtatUtilisateur.GenreEspace===EGenreEspace.Etablissement?5:2,poids:1,selecteurNavigationFleche:'[onclick]',jourSelectionne:this.dateParDefaut,classElementFocus:'ObjetAffichagePageAccueilElementAvecFocus',themeCategorie:'theme-cat-viescolaire'};case EGenreWidget.blog_filActu:if(this.moteurBlog.estEspaceAvecBlog(GEtatUtilisateur.GenreEspace)){return{nomDonnees:'blogFilActu',genre:EGenreWidget.blog_filActu,genreColonne:GEtatUtilisateur.pourPrimaire()?this.genreColonne.CDT.genre:this.genreColonne.agendaEtInformations.genre,classWidget:WidgetBlog_FilActu,id:GUID.getId(),page:{Onglet:EGenreOnglet.Blog_FilActu},titre:GTraductions.getValeur('blog.derniersBilletsPublies'),hint:GTraductions.getValeur('blog.filActuBlog'),message:GTraductions.getValeur('blog.aucunBilletPublie'),existe:function(){if(MethodesTableau.existe(GEtatUtilisateur.GenreEspace,[EGenreEspace.PrimProfesseur,EGenreEspace.Mobile_PrimProfesseur])){return true;}
const lExisteBillets=!!this.donnees.blogFilActu&&this.donnees.blogFilActu.listeBillets&&this.donnees.blogFilActu.listeBillets.GetNbrElements();if(lExisteBillets){const lListeBilletsPublies=this.donnees.blogFilActu.listeBillets.getListeElements(function(aElt){return aElt.estPublie&&((this.moteurBlog.avecFiltreSelonMembre(GEtatUtilisateur.GenreEspace)===false)||aElt.estTypeDiffEcole||this.moteurBlog.estBilletDeClasseDuMembre(aElt));}.bind(this));return lListeBilletsPublies.GetNbrElements()>0;} else{return false;}}.bind(this),isCollapsible:true,nbrItemsVisible:3,position:2,poids:1,selecteurNavigationFleche:'[onclick]',classElementFocus:'ObjetAffichagePageAccueilElementAvecFocus',themeCategorie:'theme-cat-communication'};} else{return{};}
case EGenreWidget.casier:return{nomDonnees:'casier',genre:EGenreWidget.casier,genreColonne:GEtatUtilisateur.pourPrimaire()?this.genreColonne.CDT.genre:GEtatUtilisateur.GenreEspace===EGenreEspace.Etablissement?this.genreColonne.absencesProf.genre:this.genreColonne.agendaEtInformations.genre,classWidget:WidgetCasier,id:GUID.getId(),page:{Onglet:EGenreOnglet.Casier_MonCasier},titre:GTraductions.getValeur('accueil.casier.titre'),hint:GTraductions.getValeur('accueil.casier.titre'),message:GTraductions.getValeur('accueil.casier.message'),existe:function(){return!this.donnees||this.donnees.casier.listeDocuments;},isCollapsible:true,position:GEtatUtilisateur.GenreEspace===EGenreEspace.Etablissement?15:14,poids:1,selecteurNavigationFleche:'[onclick]',classElementFocus:'ObjetAffichagePageAccueilElementAvecFocus',themeCategorie:'theme-cat-communication'};case EGenreWidget.carnetDeCorrespondance:return{nomDonnees:'carnetDeCorrespondance',genre:EGenreWidget.carnetDeCorrespondance,genreColonne:this.genreColonne.absencesProf.genre,classWidget:WidgetCarnetDeCorrespondance,id:GUID.getId(),page:{Onglet:EGenreOnglet.Saisie_CarnetCorrespondance},titre:GTraductions.getValeur('accueil.carnetDeCorrespondance.titre'),hint:GTraductions.getValeur('accueil.carnetDeCorrespondance.hint'),message:GTraductions.getValeur('accueil.carnetDeCorrespondance.message'),existe:function(){return!this.donnees||this.donnees.carnetDeCorrespondance.listeObservations;},isCollapsible:true,nbrItemsVisible:5,position:4,poids:1,selecteurNavigationFleche:'[onclick]',classElementFocus:'ObjetAffichagePageAccueilElementAvecFocus',semaineSelectionnee:IE.Cycles.cycleDeLaDate(GApplication.getDateDemo()?GApplication.getDateDemo():new Date()),themeCategorie:'theme-cat-viescolaire'};case EGenreWidget.conseilDeClasse:return{nomDonnees:'conseilDeClasse',genre:EGenreWidget.conseilDeClasse,genreColonne:this.genreColonne.emploiDuTemps.genre,classWidget:WidgetCDC,id:GUID.getId(),page:null,titre:GTraductions.getValeur('accueil.CDC.titre'),hint:'',existe:function(){return!this.donnees||(this.donnees.conseilDeClasse.listeClasses&&this.donnees.conseilDeClasse.listeClasses.GetNbrElements()>0);},isCollapsible:false,position:10,poids:1,selecteurNavigationFleche:'[onclick]',classElementFocus:'ObjetAffichagePageAccueilElementAvecFocus',themeCategorie:'theme-cat-resultat'};case EGenreWidget.CDTNonSaisi:return{nomDonnees:'CDTNonSaisi',genre:EGenreWidget.CDTNonSaisi,genreColonne:this.genreColonne.absencesProf.genre,classWidget:WidgetCDTNonSaisi,id:GUID.getId(),page:{Onglet:EGenreOnglet.SaisieCahierDeTextes},titre:GTraductions.getValeur('accueil.CDTNonSaisi.titre'),hint:'',message:GTraductions.getValeur('accueil.CDTNonSaisi.message'),existe:function(){return!this.donnees||this.donnees.CDTNonSaisi.listeCours?true:false;},isCollapsible:true,nbrItemsVisible:5,position:3,poids:1,selecteurNavigationFleche:'[onclick]',classElementFocus:'ObjetAffichagePageAccueilElementAvecFocus',jourSelectionne:GApplication.getDateDemo()?GApplication.getDateDemo():GParametres.JourOuvre,semaineSelectionnee:this.semaineSelectionnee,themeCategorie:'theme-cat-pedagogie'};case EGenreWidget.competences:return{nomDonnees:'competences',genre:aGenreWidget,genreColonne:this.genreColonne.notes.genre,classWidget:WidgetCompetences,id:GUID.getId(),page:{Onglet:EGenreOnglet.DernieresEvaluations},titre:GTraductions.getValeur('accueil.competences.titre'),hint:GTraductions.getValeur('accueil.competences.hint'),message:'',existe:function(){return(!this.donnees||(this.donnees.competences.listeEvaluations&&this.donnees.competences.listeEvaluations.GetNbrElements()));},isCollapsible:false,position:3,poids:1,selecteurNavigationFleche:'[onclick]',classElementFocus:'ObjetAffichagePageAccueilElementAvecFocus',feminin:true,themeCategorie:'theme-cat-resultat'};case EGenreWidget.connexionsEnCours:return{nomDonnees:'connexionsEnCours',genre:EGenreWidget.connexionsEnCours,genreColonne:this.genreColonne.absencesProf.genre,classWidget:WidgetConnexionsEnCours,id:GUID.getId(),titre:GTraductions.getValeur('accueil.connexionsEnCours.titre'),message:'',titreDansParametrage:GTraductions.getValeur('accueil.connexionsEnCours.titre'),existe:function(){return GEtatUtilisateur.GenreEspace===EGenreEspace.Administrateur||GEtatUtilisateur.GenreEspace===EGenreEspace.Mobile_Administrateur&&(!this.donnees||!!this.donnees.connexionsEnCours);},isCollapsible:false,position:14,poids:1,themeCategorie:'theme-cat-pedagogie'};case EGenreWidget.coursNonAssures:return{nomDonnees:'coursNonAssures',genre:EGenreWidget.coursNonAssures,genreColonne:this.genreColonne.absencesProf.genre,classWidget:WidgetCoursNonAssures,id:GUID.getId(),page:{Onglet:EGenreOnglet.CoursNonAssures},titre:GTraductions.getValeur('accueil.coursNonAssures.titre'),hint:'',message:GTraductions.getValeur('accueil.coursNonAssures.message'),existe:function(){return!this.donnees||(this.donnees.coursNonAssures.listeCoursNonAssures);},isCollapsible:false,position:GEtatUtilisateur.GenreEspace===EGenreEspace.Etablissement?9:8,poids:1,selecteurNavigationFleche:'[onclick]',classElementFocus:'ObjetAffichagePageAccueilElementAvecFocus',themeCategorie:'theme-cat-viescolaire'};case EGenreWidget.discussions:return{nomDonnees:'discussions',genre:aGenreWidget,genreColonne:GEtatUtilisateur.GenreEspace===EGenreEspace.Etablissement||GEtatUtilisateur.pourPrimaire()?this.genreColonne.absencesProf.genre:this.genreColonne.agendaEtInformations.genre,classWidget:WidgetDiscussions,id:GUID.getId(),page:{Onglet:EGenreOnglet.Messagerie},titre:GTraductions.getValeur('accueil.discussions.titre'),hint:GTraductions.getValeur('accueil.info.discussions'),message:GTraductions.getValeur('accueil.aucunMessage'),existe:function(){return!this.donnees||this.donnees.discussions.listeMessagerie;},isCollapsible:true,position:GEtatUtilisateur.GenreEspace===EGenreEspace.Etablissement?14:13,poids:1,selecteurNavigationFleche:'[onclick]',classElementFocus:'ObjetAffichagePageAccueilElementAvecFocus',feminin:true,themeCategorie:'theme-cat-communication'};case EGenreWidget.donneesProfs:return{nomDonnees:'donneesProfs',genre:aGenreWidget,genreColonne:this.genreColonne.absencesProf.genre,classWidget:WidgetDonneesProfs,id:GUID.getId(),titre:GTraductions.getValeur('accueil.donneesProfs.titre'),message:'',titreDansParametrage:GTraductions.getValeur('accueil.donneesProfs.titre'),existe:function(){return!this.donnees||(this.donnees.donneesProfs.listeDonneesProfs&&this.donnees.donneesProfs.listeDonneesProfs.GetNbrElements());},isCollapsible:false,position:13,poids:1,semaineSelectionnee:this.semaineSelectionnee,themeCategorie:'theme-cat-pedagogie'};case EGenreWidget.donneesVS:return{nomDonnees:'donneesVS',genre:aGenreWidget,genreColonne:this.genreColonne.absencesProf.genre,classWidget:WidgetDonneesVS,id:GUID.getId(),titre:GTraductions.getValeur('accueil.donneesVS.titre'),message:'',titreDansParametrage:GTraductions.getValeur('accueil.donneesVS.titre'),existe:function(){return!this.donnees||(this.donnees.donneesVS.listeDonneesVS&&this.donnees.donneesVS.listeDonneesVS.GetNbrElements());},isCollapsible:false,position:11,poids:1,semaineSelectionnee:this.semaineSelectionnee,themeCategorie:'theme-cat-viescolaire'};case EGenreWidget.DS:return{nomDonnees:'devoirSurveille',genre:EGenreWidget.DS,genreColonne:this.genreColonne.CDT.genre,classWidget:WidgetDS,id:GUID.getId(),titre:GTraductions.getValeur('accueil.DS.titre'),hint:GTraductions.getValeur('accueil.DS.hint'),existe:function(){return!this.donnees||this.moteur.existeDS(EGenreLienDS.tGL_Devoir);},isCollapsible:false,genreDS:EGenreLienDS.tGL_Devoir,position:0,poids:1,selecteurNavigationFleche:'[onclick]',classElementFocus:'ObjetAffichagePageAccueilElementAvecFocus',themeCategorie:'theme-cat-resultat'};case EGenreWidget.DSEvaluation:return{nomDonnees:'devoirSurveilleEvaluation',genre:EGenreWidget.DSEvaluation,genreColonne:this.genreColonne.CDT.genre,classWidget:WidgetDSEvaluation,id:GUID.getId(),titre:GTraductions.getValeur('accueil.DSEvaluation.titre'),hint:GTraductions.getValeur('accueil.DSEvaluation.hint'),existe:function(){return!this.donnees||this.moteur.existeDS(EGenreLienDS.tGL_Evaluation);},isCollapsible:false,genreDS:EGenreLienDS.tGL_Evaluation,position:1,poids:1,selecteurNavigationFleche:'[onclick]',classElementFocus:'ObjetAffichagePageAccueilElementAvecFocus',themeCategorie:'theme-cat-resultat'};case EGenreWidget.EDT:return{nomDonnees:'EDT',genre:EGenreWidget.EDT,genreColonne:this.genreColonne.emploiDuTemps.genre,classWidget:MethodesTableau.existe(GEtatUtilisateur.GenreEspace,[EGenreEspace.Parent,EGenreEspace.Eleve,EGenreEspace.Accompagnant,EGenreEspace.Mobile_Parent,EGenreEspace.Mobile_Eleve,EGenreEspace.Mobile_Accompagnant,EGenreEspace.Mobile_Professeur])?WidgetEDTJournalier:WidgetEDT,id:GUID.getId(),page:{Onglet:EGenreOnglet.EmploiDuTemps},titreDansParametrage:GTraductions.getValeur('accueil.emploiDuTemps'),existe:function(){return(!this.donnees||this.donnees.EDT.listeCours);}.bind(this),isCollapsible:false,position:1,poids:1,maximise:true,sansReduction:true,semaineSelectionnee:this.numeroSemaineParDefaut,jourSelectionne:this.dateParDefaut,coursSelectionne:null,themeCategorie:'theme-cat-edt'};case EGenreWidget.elections:return{nomDonnees:'elections',genre:EGenreWidget.elections,genreColonne:GEtatUtilisateur.GenreEspace===EGenreEspace.Etablissement?this.genreColonne.absencesProf.genre:this.genreColonne.agendaEtInformations.genre,classWidget:WidgetElections,id:GUID.getId(),titre:GTraductions.getValeur('accueil.elections.titre'),existe:function(){return!this.donnees||(this.donnees.elections.listeElections&&this.donnees.elections.listeElections.GetNbrElements()>0);},isCollapsible:false,position:GEtatUtilisateur.GenreEspace===EGenreEspace.Etablissement?1:10,poids:1,selecteurNavigationFleche:'[onclick]',classElementFocus:'ObjetAffichagePageAccueilElementAvecFocus',themeCategorie:'theme-cat-communication'};case EGenreWidget.enseignementADistance:return{nomDonnees:'enseignementADistance',genre:EGenreWidget.enseignementADistance,genreColonne:this.genreColonne.notes.genre,classWidget:WidgetEnseignementADistance,id:GUID.getId(),titre:GEtatUtilisateur.estEspaceEleve()?GTraductions.getValeur('accueil.enseignementADistance.titre'):GTraductions.getValeur('accueil.enseignementADistance.titreParent'),hint:GTraductions.getValeur('accueil.enseignementADistance.info'),existe:function(){return!this.donnees||!!this.donnees.enseignementADistance.actif;},position:0,poids:1,classElementFocus:'ObjetAffichagePageAccueilElementAvecFocus',isCollapsible:true,nbrItemsVisible:3,themeCategorie:'theme-cat-viescolaire'};case EGenreWidget.exclusions:return{nomDonnees:'exclusions',genre:EGenreWidget.exclusions,genreColonne:this.genreColonne.absencesProf.genre,id:GUID.getId(),classWidget:WidgetExclusions,titre:GTraductions.getValeur('accueil.exclusion.titre'),hint:GTraductions.getValeur('accueil.exclusion.hint'),message:GTraductions.getValeur('accueil.exclusion.msgAucun'),titreDansParametrage:GTraductions.getValeur('accueil.exclusion.titre'),existe:function(){return!this.donnees||(this.donnees.exclusions.listeExclusions);},isCollapsible:true,position:12,poids:1,semaineSelectionnee:this.numeroSemaineParDefaut,themeCategorie:'theme-cat-viescolaire'};case EGenreWidget.incidents:return{nomDonnees:'incidents',genre:EGenreWidget.incidents,genreColonne:this.genreColonne.absencesProf.genre,id:GUID.getId(),classWidget:WidgetIncidents,page:{Onglet:EGenreOnglet.Incidents},titre:GTraductions.getValeur('accueil.incident.titre'),message:GTraductions.getValeur('accueil.incident.msgAucun'),titreDansParametrage:GTraductions.getValeur('accueil.incident.titre'),existe:function(){return!this.donnees||(this.donnees.incidents.listeIncidents);},isCollapsible:false,position:GEtatUtilisateur.GenreEspace===EGenreEspace.Etablissement?11:10,poids:1,semaineSelectionnee:this.numeroSemaineParDefaut,themeCategorie:'theme-cat-viescolaire'};case EGenreWidget.Intendance_Execute:return{nomDonnees:'intendanceExecute',genre:EGenreWidget.Intendance_Execute,genreColonne:this.genreColonne.absencesProf.genre,id:GUID.getId(),classWidget:WidgetIntendance_Execute,titre:MethodesTableau.existe(GEtatUtilisateur.GenreEspace,[EGenreEspace.Administrateur,EGenreEspace.Mobile_Administrateur])?GTraductions.getValeur('TvxIntendance.Widget.Maintenance.TitreToutesDemandes'):GTraductions.getValeur('TvxIntendance.Widget.Maintenance.Titre'),hint:'',message:MethodesTableau.existe(GEtatUtilisateur.GenreEspace,[EGenreEspace.Administrateur,EGenreEspace.Mobile_Administrateur])?GTraductions.getValeur('TvxIntendance.Widget.Maintenance.MsgAucunToutesDemandes'):GTraductions.getValeur('TvxIntendance.Widget.Maintenance.MsgAucun'),existe:function(){return!this.donnees||this.donnees.intendanceExecute.listeLignes;},isCollapsible:false,position:MethodesTableau.existe(GEtatUtilisateur.GenreEspace,[EGenreEspace.Administrateur,EGenreEspace.Mobile_Administrateur])?16:6,poids:1,page:{Onglet:EGenreOnglet.Intendance_SaisieDemandesTravaux},classElementFocus:'ObjetAffichagePageAccueilElementAvecFocus',themeCategorie:'theme-cat-edt'};case EGenreWidget.tachesSecretariat_Execute:return{nomDonnees:'tachesSecretariatExecute',genre:EGenreWidget.tachesSecretariat_Execute,genreColonne:this.genreColonne.absencesProf.genre,id:GUID.getId(),classWidget:WidgetIntendance_Execute,titre:MethodesTableau.existe(GEtatUtilisateur.GenreEspace,[EGenreEspace.Administrateur,EGenreEspace.Mobile_Administrateur])?GTraductions.getValeur('TvxIntendance.Widget.Secretariat.TitreToutesDemandes'):GTraductions.getValeur('TvxIntendance.Widget.Secretariat.Titre'),hint:'',message:MethodesTableau.existe(GEtatUtilisateur.GenreEspace,[EGenreEspace.Administrateur,EGenreEspace.Mobile_Administrateur])?GTraductions.getValeur('TvxIntendance.Widget.Secretariat.MsgAucunToutesDemandes'):GTraductions.getValeur('TvxIntendance.Widget.Secretariat.MsgAucun'),existe:function(){return(!this.donnees||this.donnees.tachesSecretariatExecute.listeLignes)&&GEtatUtilisateur.GenreEspace!==EGenreEspace.Professeur&&GEtatUtilisateur.GenreEspace!==EGenreEspace.Mobile_Professeur;},isCollapsible:false,position:MethodesTableau.existe(GEtatUtilisateur.GenreEspace,[EGenreEspace.Administrateur])?17:7,poids:1,page:{Onglet:EGenreOnglet.Intendance_SaisieSecretariat},classElementFocus:'ObjetAffichagePageAccueilElementAvecFocus',themeCategorie:'theme-cat-edt'};case EGenreWidget.maintenanceInfoExecute:return{nomDonnees:'maintenanceInfoExecute',genre:EGenreWidget.maintenanceInfoExecute,genreColonne:this.genreColonne.absencesProf.genre,id:GUID.getId(),classWidget:WidgetIntendance_Execute,titre:MethodesTableau.existe(GEtatUtilisateur.GenreEspace,[EGenreEspace.Administrateur,EGenreEspace.Mobile_Administrateur])?GTraductions.getValeur('TvxIntendance.Widget.MaintenanceInfo.TitreToutesDemandes'):GTraductions.getValeur('TvxIntendance.Widget.MaintenanceInfo.Titre'),hint:'',message:MethodesTableau.existe(GEtatUtilisateur.GenreEspace,[EGenreEspace.Administrateur,EGenreEspace.Mobile_Administrateur])?GTraductions.getValeur('TvxIntendance.Widget.MaintenanceInfo.MsgAucunToutesDemandes'):GTraductions.getValeur('TvxIntendance.Widget.MaintenanceInfo.MsgAucun'),existe:function(){return(!this.donnees||(this.donnees.maintenanceInfoExecute&&this.donnees.maintenanceInfoExecute.listeLignes));},isCollapsible:false,position:MethodesTableau.existe(GEtatUtilisateur.GenreEspace,[EGenreEspace.Administrateur])?18:99,poids:1,page:{Onglet:EGenreOnglet.Intendance_SaisieDemandesInformatique},classElementFocus:'ObjetAffichagePageAccueilElementAvecFocus',themeCategorie:'theme-cat-edt'};case EGenreWidget.kiosque:return{nomDonnees:'kiosque',genre:aGenreWidget,genreColonne:GEtatUtilisateur.GenreEspace===EGenreEspace.PrimProfesseur?this.genreColonne.tableauDeBord.genre:GEtatUtilisateur.GenreEspace===EGenreEspace.Professeur?this.genreColonne.absencesProf.genre:this.genreColonne.CDT.genre,classWidget:WidgetKiosque,id:GUID.getId(),page:IE.estMobile?{Onglet:EGenreOnglet.ManuelsNumeriques}:null,titre:GTraductions.getValeur('accueil.kiosque.titre'),hint:'',existe:function(){return!this.donnees||(!!this.donnees.kiosque.listeRessources&&(this.donnees.kiosque.listeRessources.GetNbrElements()>0));},isCollapsible:false,position:GEtatUtilisateur.GenreEspace===EGenreEspace.PrimProfesseur?2:12,poids:1,selecteurNavigationFleche:'[onclick]',classElementFocus:'ObjetAffichagePageAccueilElementAvecFocus',themeCategorie:'theme-cat-pedagogie'};case EGenreWidget.lienUtile:return{nomDonnees:'lienUtile',genre:EGenreWidget.lienUtile,genreColonne:GEtatUtilisateur.GenreEspace===EGenreEspace.Etablissement||GEtatUtilisateur.pourPrimaire()?this.genreColonne.absencesProf.genre:this.genreColonne.agendaEtInformations.genre,id:GUID.getId(),classWidget:WidgetLienUtile,titre:GTraductions.getValeur('accueil.lienUtile.titre'),hint:GTraductions.getValeur('accueil.lienUtile.titre'),message:GTraductions.getValeur('accueil.lienUtile.message'),existe:function(){return!this.donnees||(this.donnees.lienUtile.listeLiens&&(this.donnees.lienUtile.listeLiens.GetNbrElements()>0));},isCollapsible:false,position:GEtatUtilisateur.GenreEspace===EGenreEspace.Etablissement?1:3,poids:1,classElementFocus:'ObjetAffichagePageAccueilElementAvecFocus',themeCategorie:'theme-cat-communication'};case EGenreWidget.menuDeLaCantine:return{nomDonnees:'menuDeLaCantine',genre:EGenreWidget.menuDeLaCantine,genreColonne:GEtatUtilisateur.GenreEspace===EGenreEspace.Etablissement?this.genreColonne.absencesProf.genre:this.genreColonne.agendaEtInformations.genre,id:GUID.getId(),classWidget:WidgetMenu,page:{Onglet:EGenreOnglet.Menus},titre:GTraductions.getValeur('accueil.menu'),hint:GTraductions.getValeur('accueil.info.menu'),message:GTraductions.getValeur('accueil.pasDeMenu'),existe:function(){return!this.donnees||this.donnees.menuDeLaCantine.listeRepas;},isCollapsible:false,position:GEtatUtilisateur.GenreEspace===EGenreEspace.Etablissement?16:15,poids:1,selecteurNavigationFleche:'[onclick]',classElementFocus:'ObjetAffichagePageAccueilElementAvecFocus',semaineSelectionnee:this.numeroSemaineParDefaut,themeCategorie:'theme-cat-communication'};case EGenreWidget.notes:return{nomDonnees:'notes',genre:aGenreWidget,genreColonne:this.genreColonne.notes.genre,classWidget:WidgetNotes,id:GUID.getId(),page:{Onglet:EGenreOnglet.DernieresNotes},titre:GTraductions.getValeur('accueil.dernieresNotes'),hint:GTraductions.getValeur('accueil.info.notes'),message:GTraductions.getValeur('accueil.aucuneNote'),existe:function(){return!this.donnees||this.donnees.notes.listeDevoirs;},isCollapsible:false,position:2,poids:1,selecteurNavigationFleche:'[onclick]',classElementFocus:'ObjetAffichagePageAccueilElementAvecFocus',feminin:true,themeCategorie:'theme-cat-resultat'};case EGenreWidget.partenaireAgate:return{nomDonnees:'partenaireAgate',genre:aGenreWidget,genreColonne:GEtatUtilisateur.GenreEspace===EGenreEspace.Etablissement?this.genreColonne.absencesProf.genre:this.genreColonne.agendaEtInformations.genre,classWidget:WidgetPartenaireAgate,id:GUID.getId(),titre:GTraductions.getValeur('accueil.agate.titre'),titreDansParametrage:GTraductions.getValeur('accueil.agate.titre'),hint:'',message:GTraductions.getValeur('accueil.agate.msgAucun'),existe:function(){return!this.donnees||this.donnees.partenaireAgate.listePrix;},isCollapsible:false,position:GEtatUtilisateur.GenreEspace===EGenreEspace.Etablissement?3:1,poids:1,classElementFocus:'ObjetAffichagePageAccueilElementAvecFocus',avecActualisation:true,themeCategorie:'theme-cat-communication'};case EGenreWidget.partenaireARD:return{nomDonnees:'partenaireArd',genre:aGenreWidget,genreColonne:GEtatUtilisateur.GenreEspace===EGenreEspace.Etablissement?this.genreColonne.absencesProf.genre:this.genreColonne.agendaEtInformations.genre,classWidget:WidgetPartenaireARD,id:GUID.getId(),titre:GTraductions.getValeur('accueil.ard.titre'),titreDansParametrage:GTraductions.getValeur('accueil.ard.titre'),hint:'',message:GTraductions.getValeur('accueil.ard.msgAucun'),existe:function(){return this.donnees&&this.donnees.partenaireArd&&this.donnees.partenaireArd.porteMonnaie;},isCollapsible:false,position:GEtatUtilisateur.GenreEspace===EGenreEspace.Etablissement?4:2,poids:1,classElementFocus:'ObjetAffichagePageAccueilElementAvecFocus',avecActualisation:true,themeCategorie:'theme-cat-communication'};case EGenreWidget.partenaireApplicam:return{nomDonnees:'partenaireApplicam',genre:aGenreWidget,genreColonne:this.genreColonne.agendaEtInformations.genre,classWidget:WidgetPartenaireApplicam,id:GUID.getId(),existe:function(){return this.donnees&&this.donnees.partenaireApplicam&&!!this.donnees.partenaireApplicam.libellePartenaire;},isCollapsible:true,position:2,poids:1,classElementFocus:'ObjetAffichagePageAccueilElementAvecFocus',themeCategorie:'theme-cat-communication'};case EGenreWidget.partenaireCDI:return{nomDonnees:'partenaireCDI',genre:aGenreWidget,genreColonne:GEtatUtilisateur.GenreEspace===EGenreEspace.Etablissement?this.genreColonne.absencesProf.genre:this.genreColonne.agendaEtInformations.genre,classWidget:WidgetPartenaireCDI,id:GUID.getId(),titre:GTraductions.getValeur('accueil.CDI.titre'),titreDansParametrage:GTraductions.getValeur('accueil.CDI.titre'),hint:'',message:'',existe:function(){return!this.donnees||(this.donnees.partenaireCDI.listeCDI&&(this.donnees.partenaireCDI.listeCDI.GetNbrElements()>0));},isCollapsible:false,position:GEtatUtilisateur.GenreEspace===EGenreEspace.Etablissement?2:0,poids:1,classElementFocus:'ObjetAffichagePageAccueilElementAvecFocus',avecActualisation:true,themeCategorie:'theme-cat-communication'};case EGenreWidget.penseBete:return{nomDonnees:'penseBete',genre:EGenreWidget.penseBete,genreColonne:this.genreColonne.absencesProf.genre,classWidget:WidgetPenseBete,id:GUID.getId(),titre:GTraductions.getValeur('accueil.penseBete.titre'),hint:'',message:'',position:GEtatUtilisateur.GenreEspace===EGenreEspace.Etablissement?0:1,poids:1,tailleFixe:true,selecteurNavigationFleche:'[onclick]',classElementFocus:'ObjetAffichagePageAccueilElementAvecFocus',themeCategorie:'theme-cat-pense-bete'};case EGenreWidget.personnelsAbsents:return{nomDonnees:'personnelsAbsents',genre:aGenreWidget,genreColonne:this.genreColonne.absencesProf.genre,classWidget:WidgetPersonnelsAbsents,id:GUID.getId(),titre:GTraductions.getValeur('accueil.personnelsAbsents.titre'),hint:'',message:GTraductions.getValeur('accueil.personnelsAbsents.message'),existe:function(){return!this.donnees||(this.donnees.personnelsAbsents.listePersonnelsAbsents);},isCollapsible:true,nbrItemsVisible:5,position:GEtatUtilisateur.GenreEspace===EGenreEspace.Etablissement?10:9,poids:1,selecteurNavigationFleche:'[onclick]',classElementFocus:'ObjetAffichagePageAccueilElementAvecFocus',themeCategorie:'theme-cat-viescolaire'};case EGenreWidget.Planning:return{genre:EGenreWidget.Planning,genreColonne:this.genreColonne.emploiDuTemps.genre,classWidget:WidgetPlanning,id:GUID.getId(),titreDansParametrage:GTraductions.getValeur('accueil.planning'),dateParDefaut:this.dateParDefaut,existe:function(){return this.donnees&&this.donnees.planning&&this.donnees.planning.listeRessourcesPlanning&&this.donnees.planning.listeRessourcesPlanning.GetNbrElements();},isCollapsible:false,position:0,poids:1,maximise:true,sansReduction:true,themeCategorie:'theme-cat-edt'};case EGenreWidget.QCM:return{nomDonnees:'QCM',genre:EGenreWidget.QCM,genreColonne:this.genreColonne.CDT.genre,classWidget:WidgetQCM,id:GUID.getId(),page:null,titre:GTraductions.getValeur('accueil.executionsQCM'),hint:GTraductions.getValeur('accueil.info.executionsQCM'),message:GTraductions.getValeur('accueil.AucuneExecutionsQCM'),existe:function(){return!this.donnees||(this.donnees.QCM.listeExecutionsQCM&&this.donnees.QCM.listeExecutionsQCM.GetNbrElements());},isCollapsible:false,position:2,poids:1,selecteurNavigationFleche:'[onclick]',classElementFocus:'ObjetAffichagePageAccueilElementAvecFocus',themeCategorie:'theme-cat-pedagogie'};case EGenreWidget.ressources:return{nomDonnees:'ressources',genre:EGenreWidget.ressources,genreColonne:this.genreColonne.emploiDuTemps.genre,id:GUID.getId(),page:null,titre:GEtatUtilisateur.existeGenreOnglet(EGenreOnglet.ProgrammesBO)?GTraductions.getValeur('accueil.ressources.titreAvecBO'):GTraductions.getValeur('accueil.ressources.titreSansBO'),hint:'',existe:function(){return this.donnees&&this.donnees.ressources&&this.donnees.ressources.listeMatieres&&this.donnees.ressources.listeMatieres.GetNbrElements();},classWidget:WidgetRessources,isCollapsible:false,position:11,poids:1,selecteurNavigationFleche:'[onclick]',classElementFocus:'ObjetAffichagePageAccueilElementAvecFocus',feminin:true,avecScroll:true,themeCategorie:'theme-cat-pedagogie'};case EGenreWidget.ressourcePedagogique:return{nomDonnees:'ressourcePedagogique',genre:aGenreWidget,genreColonne:this.genreColonne.CDT.genre,classWidget:WidgetRessourcePedagogique,id:GUID.getId(),page:{Onglet:EGenreOnglet.CDT_Contenu},titre:GTraductions.getValeur('accueil.ressourcePedagogique.titre'),message:GTraductions.getValeur('accueil.ressourcePedagogique.aucuneRessourcePedagogique'),hint:GTraductions.getValeur('accueil.ressourcePedagogique.info'),existe:function(){return!this.donnees||this.donnees.ressourcePedagogique.listeRessources;},isCollapsible:false,position:5,poids:1,selecteurNavigationFleche:'[onclick]',classElementFocus:'ObjetAffichagePageAccueilElementAvecFocus',feminin:true,themeCategorie:'theme-cat-pedagogie'};case EGenreWidget.RetourEspace:return{nomDonnees:'retourEspace',genre:EGenreWidget.RetourEspace,classWidget:WidgetRetourEspace,id:GUID.getId(),titre:GTraductions.getValeur('mobile.redirigeVersionMobile'),existe:function(){return window.location.search.search("redirect=1")>0&&(GApplication.acces.estConnexionCAS()||GApplication.acces.estConnexionCookie())&&GParametres.URLEspace;},themeCategorie:'theme-cat-communication'};case EGenreWidget.tableauDeBord:return{nomDonnees:'tableauDeBord',genre:EGenreWidget.tableauDeBord,genreColonne:this.genreColonne.tableauDeBord.genre,id:GUID.getId(),page:{Onglet:EGenreOnglet.TableauDeBord},titre:GTraductions.getValeur('accueil.tableauDeBord.titre'),message:GTraductions.getValeur('accueil.tableauDeBord.aucunEleveAbsent'),classWidget:WidgetTableauDeBord,position:0,poids:1,maximise:true,sansReduction:true,sansGabarit:true,isCollapsible:true,nbrItemsVisible:3,themeCategorie:'theme-cat-edt'};case EGenreWidget.travailAFaire:return{nomDonnees:'travailAFaire',genre:aGenreWidget,genreColonne:this.genreColonne?this.genreColonne.CDT.genre:null,classWidget:WidgetTAF,id:GUID.getId(),page:{Onglet:EGenreOnglet.CDT_TAF},titre:GTraductions.getValeur('accueil.TAFProchainsJours'),hint:GTraductions.getValeur('accueil.info.travailAFaire'),message:GTraductions.getValeur('accueil.aucunTAF'),existe:function(){return!GEtatUtilisateur.pourPrimaire()&&(!this.donnees||this.donnees.travailAFaire.listeTAF?true:false);},isCollapsible:false,position:4,poids:1,selecteurNavigationFleche:'.ElmMatierePourNavigation',classElementFocus:'ObjetAffichagePageAccueilElementAvecFocus',themeCategorie:'theme-cat-pedagogie'};case EGenreWidget.TAFPrimaire:return{nomDonnees:'travailAFairePrimaire',genre:EGenreWidget.TAFPrimaire,id:GUID.getId(),page:{Onglet:EGenreOnglet.CDT_TAF},titre:GTraductions.getValeur('accueil.TAFProchainsJours'),message:GTraductions.getValeur('accueil.aucunTAF'),classWidget:WidgetTAFPrimaire,existe:function(){return GEtatUtilisateur.pourPrimaire()&&(!!this.donnees.travailAFaire&&!!this.donnees.travailAFaire.listeTAF&&!!this.donnees.travailAFaire.listeTAF.GetNbrElements());},isCollapsible:false,themeCategorie:'theme-cat-pedagogie'};case EGenreWidget.TAFARendre:return{nomDonnees:'TAFARendre',genre:EGenreWidget.TAFARendre,genreColonne:this.genreColonne.absencesProf.genre,classWidget:WidgetTAFARendre,id:GUID.getId(),page:{Onglet:EGenreOnglet.RessourcePedagogique},titre:GTraductions.getValeur('accueil.TAFARendre.titre'),hint:'',message:GTraductions.getValeur('accueil.TAFARendre.msgAucun'),existe:function(){return!this.donnees||this.donnees.TAFARendre.listeTAF;},isCollapsible:false,position:5,poids:1,selecteurNavigationFleche:'[onclick]',classElementFocus:'ObjetAffichagePageAccueilElementAvecFocus',themeCategorie:'theme-cat-pedagogie'};case EGenreWidget.TAFEtActivites:return{nomDonnees:'TAFEtActivites',genre:EGenreWidget.TAFEtActivites,genreColonne:this.genreColonne.CDT.genre,classWidget:WidgetTAFEtActivites,id:GUID.getId(),page:{Onglet:EGenreOnglet.SaisieTravailAFaire},titre:GTraductions.getValeur('accueil.TAFEtActivites.titre'),hint:'',message:GTraductions.getValeur('accueil.TAFEtActivites.msgAucun'),existe:function(){return!this.donnees||(!!this.donnees.TAFEtActivites&&!!this.donnees.TAFEtActivites.listeTAFEtActivites);},isCollapsible:false,position:1,poids:1,selecteurNavigationFleche:'[onclick]',classElementFocus:'ObjetAffichagePageAccueilElementAvecFocus',themeCategorie:'theme-cat-pedagogie'};case EGenreWidget.vieScolaire:return{nomDonnees:'vieScolaire',genre:EGenreWidget.vieScolaire,genreColonne:GEtatUtilisateur.pourPrimaire()?this.genreColonne.absencesProf.genre:this.genreColonne.notes.genre,classWidget:WidgetVieScolaire,id:GUID.getId(),page:{Onglet:EGenreOnglet.VieScolaire_Recapitulatif},titre:GTraductions.getValeur('accueil.vieScolaire'),hint:GTraductions.getValeur('accueil.info.viescolaire'),message:GTraductions.getValeur('accueil.aucuneAbsence'),existe:function(){return!this.donnees||this.donnees.vieScolaire.listeAbsences;},isCollapsible:false,position:1,poids:1,selecteurNavigationFleche:'[onclick]',classElementFocus:'ObjetAffichagePageAccueilElementAvecFocus',themeCategorie:'theme-cat-viescolaire'};case EGenreWidget.absRetardsJustifiesParents:return{nomDonnees:'suiviJustifsARegler',genre:EGenreWidget.absRetardsJustifiesParents,genreColonne:this.genreColonne.absencesProf.genre,classWidget:WidgetAbsencesJustifieesParents,id:GUID.getId(),page:{Onglet:EGenreOnglet.SuiviJustificationsAbsencesRetards},titre:GTraductions.getValeur('accueil.absRetJustifieesParents.titre'),message:GTraductions.getValeur('accueil.absRetJustifieesParents.aucuneAbsRet'),existe:function(){return true;},position:8,themeCategorie:'theme-cat-viescolaire'};case EGenreWidget.evenementRappel:return{nomDonnees:'evenementsRappel',genre:EGenreWidget.evenementRappel,genreColonne:EGenreWidget.evenementRappel,classWidget:WidgetEvenementRappel,id:GUID.getId(),page:{Onglet:EGenreOnglet.CDT_TAF},titre:GTraductions.getValeur('accueil.evenementRappel.titre'),existe:function(){return!!this.donnees&&!!this.donnees.evenementsRappel&&!!this.donnees.evenementsRappel.listeEvent&&this.donnees.evenementsRappel.listeEvent.GetNbrElements()>0;},position:90,themeCategorie:'theme-cat-pense-bete'};default:;break;}}}
ObjetMoteurAccueil.WidgetMenu=WidgetMenu;module.exports=ObjetMoteurAccueil;},fn:"produit/script/objetmoteuraccueil.js"});;
IE.fModule({f:function(exports,require,module,global){const MethodesObjet=require('MethodesObjet.js');const ObjetIdentite_Mobile=require('ObjetIdentite_Mobile.js');const GTraductions=require('ObjetTraduction.js');const EGenreEspace=require('Enumere_Espace.js');const EGenreOnglet=require('Enumere_Onglet.js');const ObjetUtilitaireAbsence=require('ObjetUtilitaireAbsence.js');const EGenreWidget=require('Enumere_Widget.js');const GHtml=require('GHtml.js');const Identite=require('ObjetIdentite.js');const UtilitaireWidget=require('UtilitaireWidget.js');const MethodesTableau=require('MethodesTableau.js');const ObjetMoteurAccueil=require('produit/script/ObjetMoteurAccueil.js');const TUtilitaireMessagerie=require('UtilitaireMessagerie.js');const{TypeDroits}=require('ObjetDroitsPN.js');const ObjetDiscussion_Mobile=require('ObjetDiscussion_Mobile.js');const MoteurMessagerie=require('MoteurMessagerie.js');const TypeModeAff=require('TypeEtatPublication.js').TypeModeAff;class ObjetAccueil extends ObjetIdentite_Mobile{constructor(...aParams){super(...aParams);this.moteur=new ObjetMoteurAccueil();this.donneesRecues=false;this.autorisationVS=null;if(GEtatUtilisateur.pourPrimaire()){this.listeGenreWidgets=getListeWidgetsMobilePourPrimaire(GEtatUtilisateur.GenreEspace);} else{this.listeGenreWidgets=getListeWidgetsMobile(GEtatUtilisateur.GenreEspace);}
this.construireDeclarationsWidgets();this.utilitaireAbsence=new ObjetUtilitaireAbsence();this.premierChargement=true;this.instancesWidgets={};this.idEcranPrincipal=this.Nom+'_ecranPrincipal';this.idEcranSecondaire=this.Nom+'_ecranSecondaire';this.genreEvenement={selectionPage:0,saisie:1};}
construireDeclarationsWidgets(){this.donnees={};for(var i=0;i<this.listeGenreWidgets.length;i++){var lObjDeclarationWidget=getDeclarationWidget.call(this,this.listeGenreWidgets[i]);if(!!lObjDeclarationWidget){this.donnees[lObjDeclarationWidget.nomDonnees]=lObjDeclarationWidget;}}}
getDonneesDeWidget(aGenre){var lDeclarationWidget=getDeclarationWidget.call(this,aGenre)
;if(!!lDeclarationWidget&&!!lDeclarationWidget.nomDonnees){return this.donnees[lDeclarationWidget.nomDonnees];}
return null;}
_surActualiser(aGenre){this.Pere.RecupererDonnees([aGenre]);}
DetruireInstances(){}
SetDonnees(aDonnees,aNumeroSemaineParDefaut,aDonneesRequete,aDateParDefaut,aAutorisationsVS){$.extend(true,this.donnees,aDonnees);this.donneesRecues=true;this.moteur.setSemaineSelectionnee(aNumeroSemaineParDefaut);this.moteur.setDateParDefaut(aDateParDefaut);this.donneesRequete=aDonneesRequete;this.autorisationsVS=aAutorisationsVS;const lScroll=$("#div").get(0).scrollTop;this.Afficher();var $ulCollectionWidgets=$('#'+this.Nom.escapeJQ()).find('ul.collapsible');M.Collapsible.init($ulCollectionWidgets,{accordion:false});UtilitaireWidget.setParametres({avecFermer:false,avecToutVoir:true,avecCompteur:MethodesTableau.existe(GEtatUtilisateur.GenreEspace,[EGenreEspace.Mobile_Professeur,EGenreEspace.Mobile_Etablissement,EGenreEspace.Mobile_Administrateur,EGenreEspace.Mobile_PrimProfesseur])});Object.keys(this.donnees).forEach(function(aKey){var lWidget=this.donnees[aKey];if(lWidget&&lWidget.construireInstance&&!!lWidget.existe&&lWidget.existe.call(this)){lWidget.construireInstance(lWidget);}}.bind(this));GEtatUtilisateur.premierChargement=false;$("#div").get(0).scrollTop=lScroll;}
evenementSaisiePage(aSaisie){this.callback.appel({saisie:aSaisie});}
ConstruireAffichage(){if(!this.donneesRecues){return'';}
var lHtml=[];lHtml.push('<div id="',this.idEcranPrincipal,'" class="collapsible popout global-mobile-container">');if(GEtatUtilisateur.GenreEspace===EGenreEspace.Mobile_PrimParent){lHtml.push('<div class="bandeauBoutonsParent">');if(GApplication.droits.get(TypeDroits.absences.avecDeclarerUneAbsence)){lHtml.push('<ie-bouton  ie-icon="icon_absences_prevue" class="theme-bt-accueil-primaire" onclick="',this.Nom,'.ajouterAbsence()">',GTraductions.getValeur('AbsenceVS.SaisirAbsenceParentPrim'),'</ie-bouton>');}
if(GEtatUtilisateur.Identification.ListeRessources&&GEtatUtilisateur.Identification.ListeRessources.GetNbrElements()>0){lHtml.push('<ie-bouton ie-icon="icon_carnet_liaison mix-icon_plus i-top-spe" class="theme-bt-accueil-primaire"  onclick="',this.Nom,'.btnMessageCarnet()">',GTraductions.getValeur('fenetreCommunication.ecrireEnseignant'),'</ie-bouton>');}
lHtml.push('</div>');}
var i,lDonnees;for(i=0;i<this.listeGenreWidgets.length;i++){lDonnees=this.getDonneesDeWidget(this.listeGenreWidgets[i]);if(lDonnees){lHtml.push(this.composeSection(lDonnees));}}
lHtml.push('</div>');lHtml.push('<div id="',this.idEcranSecondaire,'" class="collapsible popout global-mobile-container" style="display:none;height:100%; background-color:white;"">');return lHtml.join('');}
ajouterAbsence(){GEtatUtilisateur.setPage({Onglet:EGenreOnglet.VieScolaire_Recapitulatif,executerSaisieAbsenceParent:true,retourAccueil:true});if(GEtatUtilisateur.getGenreOnglet()){var lGenreOnglet=GEtatUtilisateur.getGenreOnglet();if(GEtatUtilisateur.listeOngletsInvisibles.indexOf(lGenreOnglet)=== -1){this.callback.appel({genreOngletDest:lGenreOnglet});}}}
btnMessageCarnet(){GInterface.fermerMenuOnglet();var lEleve=GEtatUtilisateur.getMembre();var lListeDestinataires=TUtilitaireMessagerie.getListeDestCarnetLiaisonDEleve_PrimParent(lEleve.GetNumero());var lMessage={listeDestinataires:lListeDestinataires,estCreationCarnetLiaison:true};var lMoteurMessagerie=new MoteurMessagerie().setOptions({instance:this,estChat:false,avecPJ:false});var lAffDiscussion=Identite.creerInstance(ObjetDiscussion_Mobile,{pere:this,moteurMessagerie:lMoteurMessagerie});lAffDiscussion.setOptions({estSidePanel:true,estSidePanelAvecMenu:true,estChat:false,avecPJ:false,callbackEnvoyer:function(){lAffDiscussion.masquer();}}).setDonnees({message:MethodesObjet.dupliquer(lMessage),creationDiscussion:true,estPrimParentSurEtiquetteCL:true,listeDestinatairesCarnetLiaison:lListeDestinataires,eleveCarnetLiaison:lEleve,titre:GTraductions.getValeur('MessagerieCarnetLiaison.TitreFenetreNouveauPourLEleve',[lEleve.GetLibelle()])});}
composeSection(aWidget){var lHtml=[];function _composeCorps(aFonction,aAvecDonnees){var liResult=[];liResult.push('<article role="region" aria-labelledby="'+aWidget.id+'_TitreText" class="widget '+aWidget.themeCategorie+' '+aWidget.nomDonnees.toLowerCase()+'">');liResult.push('<div id="'+aWidget.id+'_contenu" class="','card-container',(!aAvecDonnees?' card-nodata':''),'" tabIndex="0">','</div>','</article>');return liResult.join('');}
if(!!aWidget&&!!aWidget.existe&&aWidget.existe.call(this)){var lEstAvecDonnees=aWidget.existeDonnees?aWidget.existeDonnees.call(this):true;lHtml.push(_composeCorps(aWidget.construire,lEstAvecDonnees));}
return lHtml.join('');}
_surToutVoir(aGenre){const lWidget=this.getDonneesDeWidget(aGenre);const lPage=lWidget.getPage?lWidget.getPage():lWidget.page;if(!!lWidget.dateSelectionnee){const lDateSelectionnee=lWidget.dateSelectionnee.call(this);if(!!lDateSelectionnee){GEtatUtilisateur.setDerniereDate(lDateSelectionnee);}}
if(!!lWidget.jourSelectionne){GEtatUtilisateur.setNavigationDate(lWidget.jourSelectionne);}
if(GEtatUtilisateur.listeOngletsInvisibles.indexOf(lPage.Onglet)=== -1){this.callback.appel({genreOngletDest:lPage.Onglet,page:lPage});}}
_surAction(aGenre){var lWidget=this.getDonneesDeWidget(aGenre);var lPage=lWidget.action;if(GEtatUtilisateur.listeOngletsInvisibles.indexOf(lPage.Onglet)=== -1){this.callback.appel({genreOngletDest:lPage.Onglet});}}
getAutorisationsVS(){return this.autorisationsVS;}
Valider(aListePJs){var lAvecValidationIncidents=this.donnees.incidents&&this.donnees.incidents.listeIncidents&&this.donnees.incidents.listeIncidents.existeElementPourValidation();var lAvecValidationActualitees=this.donnees.actualites&&this.donnees.actualites.listeModesAff[TypeModeAff.MA_Reception].listeActualites&&this.donnees.actualites.listeModesAff[TypeModeAff.MA_Reception].listeActualites.existeElementPourValidation();var lAvecValidationVieScolaire=this.donnees.vieScolaire&&this.donnees.vieScolaire.listeAbsences&&this.donnees.vieScolaire.listeAbsences.existeElementPourValidation();var lAvecValidationTravailAFaire=this.donnees.travailAFaire&&this.donnees.travailAFaire.listeFichiers&&this.donnees.travailAFaire.listeFichiers.existeElementPourValidation();var lAvecValidationEvenementRappel=this.donnees.evenementsRappel&&this.donnees.evenementsRappel.listeEvent&&this.donnees.evenementsRappel.listeEvent.existeElementPourValidation();if(lAvecValidationActualitees||
lAvecValidationVieScolaire||
lAvecValidationTravailAFaire||
lAvecValidationIncidents||
lAvecValidationEvenementRappel){this.callback.appel({saisie:this.genreEvenement.saisie,donnees:this.donnees,pieceJoints:aListePJs});}}
composeAucuneDonnees(aMessage){return'<div class="no-events"><p>'+aMessage+'</p></div>';}}
function getListeWidgetsMobilePourPrimaire(aGenreUtilisateur){var result=[];switch(aGenreUtilisateur){case EGenreEspace.Mobile_PrimProfesseur:result.push(EGenreWidget.penseBete,EGenreWidget.RetourEspace,EGenreWidget.lienUtile,EGenreWidget.tableauDeBord,EGenreWidget.blog_filActu,EGenreWidget.actualites,EGenreWidget.agenda,EGenreWidget.kiosque);break;case EGenreEspace.Mobile_PrimParent:result.push(EGenreWidget.RetourEspace,EGenreWidget.evenementRappel,EGenreWidget.TAFPrimaire,EGenreWidget.vieScolaire,EGenreWidget.competences,EGenreWidget.actualites,EGenreWidget.blog_filActu,EGenreWidget.agenda,EGenreWidget.lienUtile);break;case EGenreEspace.Mobile_PrimEleve:result.push(EGenreWidget.RetourEspace,EGenreWidget.QCM,EGenreWidget.TAFPrimaire,EGenreWidget.competences,EGenreWidget.blog_filActu,EGenreWidget.kiosque,EGenreWidget.activite,EGenreWidget.lienUtile);break;case EGenreEspace.Mobile_PrimAccompagnant:result.push(EGenreWidget.RetourEspace,EGenreWidget.lienUtile,EGenreWidget.TAFPrimaire,EGenreWidget.blog_filActu,EGenreWidget.competences,EGenreWidget.vieScolaire,EGenreWidget.EDT,EGenreWidget.kiosque);break;case EGenreEspace.Mobile_PrimPeriscolaire:result.push(EGenreWidget.RetourEspace,EGenreWidget.actualites,EGenreWidget.agenda);break;default:;break;}
return result;}
function getListeWidgetsMobile(aGenreUtilisateur){var result=[];switch(aGenreUtilisateur){case EGenreEspace.Mobile_Eleve:result.push(EGenreWidget.RetourEspace,EGenreWidget.elections,EGenreWidget.lienUtile,EGenreWidget.partenaireCDI,EGenreWidget.partenaireARD,EGenreWidget.DS,EGenreWidget.DSEvaluation,EGenreWidget.QCM,EGenreWidget.travailAFaire,EGenreWidget.enseignementADistance,EGenreWidget.EDT,EGenreWidget.notes,EGenreWidget.competences,EGenreWidget.vieScolaire,EGenreWidget.blog_filActu,EGenreWidget.agenda,EGenreWidget.kiosque);break;case EGenreEspace.Mobile_Parent:result.push(EGenreWidget.RetourEspace,EGenreWidget.elections,EGenreWidget.lienUtile,EGenreWidget.partenaireCDI,EGenreWidget.partenaireARD,EGenreWidget.partenaireAgate,EGenreWidget.DS,EGenreWidget.DSEvaluation,EGenreWidget.travailAFaire,EGenreWidget.enseignementADistance,EGenreWidget.vieScolaire,EGenreWidget.EDT,EGenreWidget.notes,EGenreWidget.competences,EGenreWidget.blog_filActu,EGenreWidget.agenda,EGenreWidget.kiosque);break;case EGenreEspace.Mobile_Professeur:result.push(EGenreWidget.penseBete,EGenreWidget.RetourEspace,EGenreWidget.elections,EGenreWidget.lienUtile,EGenreWidget.partenaireCDI,EGenreWidget.partenaireARD,EGenreWidget.partenaireAgate,EGenreWidget.EDT,EGenreWidget.personnelsAbsents,EGenreWidget.appelNonFait,EGenreWidget.CDTNonSaisi,EGenreWidget.Intendance_Execute,EGenreWidget.blog_filActu,EGenreWidget.agenda,EGenreWidget.kiosque);break;case EGenreEspace.Mobile_Administrateur:result.push(EGenreWidget.penseBete,EGenreWidget.RetourEspace,EGenreWidget.elections,EGenreWidget.lienUtile,EGenreWidget.agenda,EGenreWidget.incidents,EGenreWidget.donneesVS,EGenreWidget.donneesProfs,EGenreWidget.coursNonAssures,EGenreWidget.personnelsAbsents,EGenreWidget.connexionsEnCours,EGenreWidget.Intendance_Execute,EGenreWidget.tachesSecretariat_Execute,EGenreWidget.exclusions);break;case EGenreEspace.Mobile_Etablissement:result.push(EGenreWidget.penseBete,EGenreWidget.RetourEspace,EGenreWidget.elections,EGenreWidget.EDT,EGenreWidget.lienUtile,EGenreWidget.partenaireCDI,EGenreWidget.incidents,EGenreWidget.coursNonAssures,EGenreWidget.personnelsAbsents,EGenreWidget.appelNonFait,EGenreWidget.Intendance_Execute,EGenreWidget.tachesSecretariat_Execute,EGenreWidget.agenda);break;case EGenreEspace.Mobile_Accompagnant:result.push(EGenreWidget.RetourEspace,EGenreWidget.elections,EGenreWidget.lienUtile,EGenreWidget.partenaireARD,EGenreWidget.DS,EGenreWidget.DSEvaluation,EGenreWidget.travailAFaire,EGenreWidget.enseignementADistance,EGenreWidget.vieScolaire,EGenreWidget.EDT,EGenreWidget.notes,EGenreWidget.competences,EGenreWidget.blog_filActu,EGenreWidget.agenda,EGenreWidget.kiosque);break;case EGenreEspace.Mobile_Tuteur:break;default:;break;}
return result;}
function getDeclarationWidget(aGenreWidget){this.moteur.setDonnees(this.donnees);var result;switch(aGenreWidget){case EGenreWidget.EDT:case EGenreWidget.activite:case EGenreWidget.actualites:case EGenreWidget.aide:case EGenreWidget.agenda:case EGenreWidget.appelNonFait:case EGenreWidget.carnetDeCorrespondance:case EGenreWidget.casier:case EGenreWidget.CDTNonSaisi:case EGenreWidget.conseilDeClasse:case EGenreWidget.competences:case EGenreWidget.connexionsEnCours:case EGenreWidget.coursNonAssures:case EGenreWidget.DS:case EGenreWidget.DSEvaluation:case EGenreWidget.donneesProfs:case EGenreWidget.donneesVS:case EGenreWidget.elections:case EGenreWidget.enseignementADistance:case EGenreWidget.exclusions:case EGenreWidget.incidents:case EGenreWidget.Intendance_Execute:case EGenreWidget.kiosque:case EGenreWidget.lienUtile:case EGenreWidget.menuDeLaCantine:case EGenreWidget.notes:case EGenreWidget.partenaireCDI:case EGenreWidget.partenaireAgate:case EGenreWidget.partenaireARD:case EGenreWidget.penseBete:case EGenreWidget.personnelsAbsents:case EGenreWidget.QCM:case EGenreWidget.ressources:case EGenreWidget.ressourcePedagogique:case EGenreWidget.RetourEspace:case EGenreWidget.tableauDeBord:case EGenreWidget.tachesSecretariat_Execute:case EGenreWidget.travailAFaire:case EGenreWidget.TAFARendre:case EGenreWidget.TAFPrimaire:case EGenreWidget.vieScolaire:case EGenreWidget.blog_filActu:case EGenreWidget.evenementRappel:result=this.moteur.getDeclarationWidget(aGenreWidget);break;default:;break;}
if(result){if(!result.construire){result.construire=function(){return'';};}
if(result.classWidget!==undefined){result.construireInstance=_construireInstanceWidget.bind(this);var lExiste=result.existe;result.existe=function(){return!!result.classWidget&&(!lExiste||lExiste.call(this));}.bind(this);}}
return result;}
function _construireInstanceWidget(aDonneesWidget){if(this.instancesWidgets[aDonneesWidget.genre]){this.instancesWidgets[aDonneesWidget.genre].free();}
try{this.instancesWidgets[aDonneesWidget.genre]=Identite.creerInstance(aDonneesWidget.classWidget,{pere:this});} catch(e){this.instancesWidgets[aDonneesWidget.genre]=null
;return;}
Object.assign(this.instancesWidgets[aDonneesWidget.genre],{autorisationsVS:this.getAutorisationsVS.bind(this),donneesRequete:this.Pere.donneesRequete,evenementPage:this.Pere.evenementPage.bind(this.Pere),genreEvenement:this.genreEvenement,actionSurSaisie:this.Pere.actionSurSaisie.bind(this.Pere),dateParDefaut:this.Pere.dateParDefaut,NomInterface:this.Pere.Nom,numeroSemaineParDefaut:this.Pere.numeroSemaineParDefaut,RecupererDonnees:this.Pere.RecupererDonnees.bind(this),Valider:this.Valider.bind(this),afficherExecutionQCM:function(aExecutionsQCM){this.callback.appel({executionQCM:aExecutionsQCM});}.bind(this)});try{this.instancesWidgets[aDonneesWidget.genre].construire({instance:this,donnees:aDonneesWidget,construireWidget:_construireWidget.bind(this)});} catch(e){}}
function _construireWidget(aParams){var lInstanceWidget=this.instancesWidgets[aParams.genre];GHtml.setHtml(aParams.id+'_contenu',UtilitaireWidget.composeWidget(aParams,this.Nom),{instance:lInstanceWidget||this});UtilitaireWidget.afficherMasquerListe(aParams);}
module.exports=ObjetAccueil;},fn:"mobile/script/pageaccueil.js"});;
IE.fModule({f:function(exports,require,module,global){const{ObjetRequeteConsultation}=require('ObjetRequeteJSON.js');const MethodesTableau=require('MethodesTableau.js');const Requetes=require('CollectionRequetes.js');const EGenreTriElement=require('Enumere_TriElement.js');const ObjetElement=require('ObjetElement.js');const ObjetListeElements=require('ObjetListeElements.js');const ObjetTri=require('ObjetTri.js');const EGenreRessource=require('Enumere_Ressource.js');const ObjetDeserialiser=require('ObjetDeserialiser.js');const EGenreWidget=require('Enumere_Widget.js');class ObjetRequetePageAccueil extends ObjetRequeteConsultation{constructor(...aParams){super(...aParams);}
lancerRequete(aDonnees){this.JSON=$.extend({avecConseilDeClasse:true},aDonnees);return this.appelAsynchrone();}
actionApresRequete(){let lUtilitaireDeserialisation;let lVieScolaire;if(this._recupererDonneesWidget(EGenreWidget.vieScolaire)&&this.JSONReponse.vieScolaire){this.autorisationsVS=this.JSONReponse.vieScolaire.autorisations;const lListeAbsences=new ObjetDeserialiser().listeEvenementsVS(this.JSONReponse.vieScolaire.listeAbsences,true);lListeAbsences.libelle=this.JSONReponse.vieScolaire.L;lVieScolaire={listeAbsences:this.JSONReponse.vieScolaire.listeAbsences.getListeElements(function(aElement){return!MethodesTableau.existe(aElement.GetGenre(),[EGenreRessource.Incident])||!aElement.mesure||!aElement.mesure.publication||!lListeAbsences.GetElementParNumero(aElement.mesure.GetNumero());})};}
let lQCM;if(this._recupererDonneesWidget(EGenreWidget.QCM)){lUtilitaireDeserialisation=new ObjetDeserialiser();const lListeExecutionsQCM=this.JSONReponse.QCM?new ObjetListeElements().fromJSON(this.JSONReponse.QCM.listeExecutionsQCM,lUtilitaireDeserialisation._ajouterQCM.bind(lUtilitaireDeserialisation)):null;const lListeExecutionKiosque=this.JSONReponse.QCM?new ObjetListeElements().fromJSON(this.JSONReponse.QCM.listeDevoirs,this._ajouterDevoir.bind(this)):null;let lListeWidgetQCMKiosque=null;if(!!lListeExecutionsQCM||!!lListeExecutionKiosque){if(!!lListeExecutionsQCM){lListeWidgetQCMKiosque=lListeExecutionsQCM;} else{lListeWidgetQCMKiosque=new ObjetListeElements();}
if(!!lListeExecutionKiosque){lListeWidgetQCMKiosque.FusionnerListe(lListeExecutionKiosque);}}
lQCM={listeExecutionsQCM:lListeWidgetQCMKiosque};}
let lEDT;if(this._recupererDonneesWidget(EGenreWidget.EDT)&&this.JSONReponse.ListeCours){lEDT={listeCours:new ObjetDeserialiser().listeCours(this.JSONReponse),avecCoursAnnule:this.JSONReponse.AvecCoursAnnule,listeAbsRessources:this.JSONReponse.listeAbsRessources||null,joursStage:this.JSONReponse.joursStage||null,disponibilites:this.JSONReponse.disponibilites||null,prefsGrille:this.JSONReponse.prefsGrille||null,absences:this.JSONReponse.absences||null,debutDemiPensionHebdo:this.JSONReponse.debutDemiPensionHebdo||null,finDemiPensionHebdo:this.JSONReponse.finDemiPensionHebdo||null,dateSelection:this.JSONReponse.dateSelectionnee||null,prochaineDate:this.JSONReponse.prochaineDate||null};}
let lPlanning;if(this._recupererDonneesWidget(EGenreWidget.Planning)&&this.JSONReponse.planning){lPlanning={listeRessourcesPlanning:this.JSONReponse.planning.listeRessourcesPlanning};}
if(this._recupererDonneesWidget(EGenreWidget.agenda)&&this.JSONReponse.agenda){this.JSONReponse.agenda.listeEvenements=new ObjetDeserialiser().getListeEvenements(this.JSONReponse.agenda.listeEvenements,true);}
if(this._recupererDonneesWidget(EGenreWidget.Notes)&&!!this.JSONReponse.notes&&!!this.JSONReponse.notes.listeDevoirs){this.JSONReponse.notes.listeDevoirs.setTri([ObjetTri.init('date',EGenreTriElement.Decroissant)]);this.JSONReponse.notes.listeDevoirs.trier();}
if(this._recupererDonneesWidget(EGenreWidget.ressourcePedagogique)&&this.JSONReponse.ressourcePedagogique){lUtilitaireDeserialisation=new ObjetDeserialiser();this.JSONReponse.ressourcePedagogique.listeRessources.parcourir(function(aEle){if(aEle&&aEle.ressource&&aEle.ressource.QCM){const lTempEle=new ObjetElement();lUtilitaireDeserialisation._ajouterQCM(aEle.ressource,lTempEle);aEle.ressource=lTempEle;}});}
if(this._recupererDonneesWidget(EGenreWidget.travailAFaire)&&this.JSONReponse.travailAFaire){lUtilitaireDeserialisation=new ObjetDeserialiser();this.JSONReponse.travailAFaire.listeTAF.parcourir(function(aEle){if(aEle&&aEle.executionQCM){const lTempEle=new ObjetElement();lUtilitaireDeserialisation._ajouterQCM(aEle.executionQCM,lTempEle);aEle.executionQCM=lTempEle;}});}
if(this._recupererDonneesWidget(EGenreWidget.activite)&&this.JSONReponse.activite){lUtilitaireDeserialisation=new ObjetDeserialiser();this.JSONReponse.activite.listeActivite.parcourir(function(aEle){if(aEle&&aEle.executionQCM){const lTempEle=new ObjetElement();lUtilitaireDeserialisation._ajouterQCM(aEle.executionQCM,lTempEle);aEle.executionQCM=lTempEle;}});}
const lAutorisationKiosque=!!this.JSONReponse.autorisationKiosque;this.callbackReussite.appel({message:this.JSONReponse.message,QCM:lQCM,notes:this.JSONReponse.notes,vieScolaire:lVieScolaire,actualites:this.JSONReponse.actualites,discussions:this.JSONReponse.discussions,agenda:this.JSONReponse.agenda,menuDeLaCantine:this.JSONReponse.menuDeLaCantine,EDT:lEDT,planning:lPlanning,travailAFaire:this.JSONReponse.travailAFaire,travailAFairePrimaire:GEtatUtilisateur.pourPrimaire()?this.JSONReponse.travailAFaire:undefined,casier:this.JSONReponse.casier,appelNonFait:this.JSONReponse.appelNonFait,CDTNonSaisi:this.JSONReponse.CDTNonSaisi,conseilDeClasse:this.JSONReponse.conseilDeClasse,ressources:this.JSONReponse.ressources,kiosque:this.JSONReponse.kiosque,ressourcePedagogique:this.JSONReponse.ressourcePedagogique,devoirSurveille:this.JSONReponse.devoirSurveille,competences:this.JSONReponse.competences,penseBete:this.JSONReponse.penseBete,coursNonAssures:this.JSONReponse.coursNonAssures,personnelsAbsents:this.JSONReponse.personnelsAbsents,devoirSurveilleEvaluation:this.JSONReponse.devoirSurveilleEvaluation,carnetDeCorrespondance:this.JSONReponse.carnetDeCorrespondance,TAFARendre:this.JSONReponse.TAFARendre,intendanceExecute:this.JSONReponse.IntendanceExecute,tachesSecretariatExecute:this.JSONReponse.tachesSecretariatExecute,maintenanceInfoExecute:this.JSONReponse.maintenanceInfoExecute,lienUtile:this.JSONReponse.lienUtile,partenaireCDI:this.JSONReponse.partenaireCDI,partenaireAgate:this.JSONReponse.partenaireAgate,partenaireArd:this.JSONReponse.partenaireARD,partenaireApplicam:this.JSONReponse.partenaireApplicam,incidents:this.JSONReponse.incidents,exclusions:this.JSONReponse.exclusions,donneesVS:this.JSONReponse.donneesVS,donneesProfs:this.JSONReponse.donneesProfs,connexionsEnCours:this.JSONReponse.connexionsEnCours,elections:this.JSONReponse.elections,activite:this.JSONReponse.activite,enseignementADistance:this.JSONReponse.enseignementADistance,suiviAbsRetardsARegler:this.JSONReponse.suiviAbsRetardsARegler,blogFilActu:this.JSONReponse.blogFilActu,tableauDeBord:this.JSONReponse.tableauDeBord,TAFEtActivites:this.JSONReponse.TAFEtActivites,evenementsRappel:this.JSONReponse.evenementsRappel},this.autorisationsVS,lAutorisationKiosque);}
_ajouterDevoir(aJSON,aDevoir){aDevoir.copieJSON(aJSON);}
_recupererDonneesWidget(aGenreWidget){if(this.JSON.widgets){return MethodesTableau.existe(aGenreWidget,this.JSON.widgets);}
return true;}}
Requetes.inscrire('PageAccueil',ObjetRequetePageAccueil);module.exports=ObjetRequetePageAccueil;},fn:"objetrequetepageaccueil.js"});;
IE.fModule({f:function(exports,require,module,global){const{ObjetRequeteSaisie}=require('ObjetRequeteJSON.js');const Requetes=require('CollectionRequetes.js');const TypeGenreReponseInternetActualite=require('TypeGenreReponseInternetActualite.js').TypeGenreReponseInternetActualite;const TypeModeAff=require('TypeEtatPublication.js').TypeModeAff;class ObjetRequeteSaisieAccueil extends ObjetRequeteSaisie{constructor(...aParams){super(...aParams);}
lancerRequete(aDonnees){if(aDonnees.actualites&&aDonnees.actualites.listeModesAff[TypeModeAff.MA_Reception].listeActualites){const lListeActualites=aDonnees.actualites.listeModesAff[TypeModeAff.MA_Reception].listeActualites.getListeElements(function(aElement){return!aElement.estUnDeploiement;});lListeActualites.setSerialisateurJSON({methodeSerialisation:_serialiserActualite.bind(this)});this.JSON.listeActualites=lListeActualites;}
if(aDonnees.vieScolaire&&aDonnees.vieScolaire.listeAbsences){aDonnees.vieScolaire.listeAbsences.setSerialisateurJSON({methodeSerialisation:_serialiserAbsences.bind(this)});this.JSON.listeAbsences=aDonnees.vieScolaire.listeAbsences;}
if(aDonnees.incidents&&aDonnees.incidents.listeIncidents){aDonnees.incidents.listeIncidents.setSerialisateurJSON({methodeSerialisation:function(aElt,aJSON){aJSON.estVise=aElt.estVise;}});this.JSON.incidents=aDonnees.incidents.listeIncidents;}
return this.appelAsynchrone();}
actionApresRequete(aXml,aGenreReponse){this.callbackReussite.appel(aXml,aGenreReponse,this.JSONRapportSaisie);}}
Requetes.inscrire('SaisieAccueil',ObjetRequeteSaisieAccueil);function _serialiserActualite(aActualite,aJSON){aJSON.genrePublic=aActualite.genrePublic;aJSON.public=aActualite.public;aJSON.lue=aActualite.lue;aActualite.listeQuestions.setSerialisateurJSON({methodeSerialisation:_serialiserListeQuestions.bind(this)});aJSON.listeQuestions=aActualite.listeQuestions;}
function _serialiserListeQuestions(aQuestion,aJSON){aJSON.reponse=aQuestion.reponse.toJSONAll();aJSON.genreReponse=aQuestion.genreReponse;if(aQuestion.genreReponse>TypeGenreReponseInternetActualite.AvecAR&&aQuestion.reponse.avecReponse){aJSON.reponse.valeurReponse=aQuestion.reponse.valeurReponse;}
aJSON.reponse.avecReponse=aQuestion.reponse.avecReponse;}
function _serialiserAbsences(aAbsence,aJSON){aJSON.estLue=aAbsence.estLue;aJSON.justification=aAbsence.justification;if(!!aAbsence.documents){aAbsence.documents.setSerialisateurJSON({methodeSerialisation:_surValidation_Fichier.bind(this)});aJSON.documents=aAbsence.documents;}
aJSON.motifParent=aAbsence.motifParent;aJSON.parentAAccuseDeReception=aAbsence.parentAAccuseDeReception;}
function _surValidation_Fichier(aElement,aJSON){const lIdFichier=aElement.idFichier!==undefined?aElement.idFichier:(aElement.Fichier!==undefined?aElement.Fichier.idFichier:null);if(lIdFichier!==null){aJSON.idFichier=''+lIdFichier;}
aJSON.url=aElement.url;}
module.exports=ObjetRequeteSaisieAccueil;},fn:"objetrequetesaisieaccueil.js"});;
IE.fModule({f:function(exports,require,module,global){const ObjetAccueil=require('mobile/script/PageAccueil.js');const ObjetRequetePageAccueil=require('ObjetRequetePageAccueil.js');const ObjetRequeteSaisieAccueil=require('ObjetRequeteSaisieAccueil.js');const ObjetElement=require('ObjetElement.js');const{GDate}=require('ObjetDate.js');const InterfacePage_Mobile=require('InterfacePage_Mobile.js');const EGenreOnglet=require('Enumere_Onglet.js');const MethodesTableau=require('MethodesTableau.js');const EGenreEspace=require('Enumere_Espace.js');class InterfacePageAccueil extends InterfacePage_Mobile{constructor(...aParams){super(...aParams);this.dateParDefaut=GApplication.getDateDemo()?GApplication.getDateDemo():GParametres.JourOuvre;this.numeroSemaineParDefaut=IE.Cycles.cycleDeLaDate(this.dateParDefaut);this.avecPageFondBlanc=false;this.donneesRequete={dateGrille:null,EDT:{date:(MethodesTableau.existe(GEtatUtilisateur.GenreEspace,[EGenreEspace.Parent,EGenreEspace.Eleve,EGenreEspace.Accompagnant,EGenreEspace.Mobile_Parent,EGenreEspace.Mobile_Eleve,EGenreEspace.Mobile_Accompagnant,EGenreEspace.Mobile_Professeur]))?null:this.dateParDefaut},incidents:{numeroSemaine:this.numeroSemaineParDefaut},exclusions:{numeroSemaine:this.numeroSemaineParDefaut},donneesVS:{date:GDate.getDateBornee(GDate.aujourdhui)},donneesProfs:{date:GDate.getDateBornee(GDate.aujourdhui)},personnelsAbsents:{numeroSemaine:this.numeroSemaineParDefaut},coursNonAssures:{numeroSemaine:this.numeroSemaineParDefaut},menuDeLaCantine:{date:this.dateParDefaut},TAFARendre:{date:this.dateParDefaut},partenaireCDI:{CDI:new ObjetElement()},tableauDeBord:{date:this.dateParDefaut}};}
ConstruireInstances(){this.identPage=this.Add(ObjetAccueil,this.evenementPage);}
RecupererDonnees(aWidget){if(aWidget){this.donneesRequete.widgets=aWidget;}
this.donneesRequete.dateGrille=GApplication.getDateDemo()?GApplication.getDateDemo():GParametres.JourOuvre;if(this.actionSurRecupererDonnees!==undefined){new ObjetRequetePageAccueil(this,this.actionSurRecupererDonnees).lancerRequete(this.donneesRequete);} else{new ObjetRequetePageAccueil(this,this.Pere.actionSurRecupererDonnees.bind(this.Pere)).lancerRequete(this.donneesRequete);}}
actionSurRecupererDonnees(aDonnees,aAutorisationsVS){this.DonneesRecues=true;this.donnees=aDonnees;this.GetInstance(this.identPage).SetDonnees(aDonnees,this.numeroSemaineParDefaut,this.donneesRequete,this.dateParDefaut,aAutorisationsVS);}
evenementPage(aParam){if(aParam.saisie){var lRequete=new ObjetRequeteSaisieAccueil(this,this.actionSurSaisie);if(aParam.pieceJoints&&aParam.pieceJoints.GetNbrElements()){lRequete.addUpload({listeFichiers:aParam.pieceJoints});}
lRequete.lancerRequete(this.donnees);} else if(aParam.executionQCM){this.callback.appel({genreOnglet:EGenreOnglet.Accueil,executionQCM:aParam.executionQCM});} else{if(!!aParam.page){GEtatUtilisateur.setPage(aParam.page);GEtatUtilisateur.Navigation.OptionsOnglet=aParam.page;}
switch(aParam.genreOngletDest){case EGenreOnglet.CDT_TAF:if(aParam.taf){GEtatUtilisateur.setDerniereDate(aParam.taf.pourLe?aParam.taf.pourLe:aParam.taf.date);} else{GEtatUtilisateur.setDerniereDate(GDate.aujourdhui);}
break;default:break;}
this.callback.appel({genreOnglet:EGenreOnglet.Accueil,genreOngletDest:aParam.genreOngletDest});}}
Valider(){this.GetInstance(this.identPage).Valider();}
actionSurSaisie(){this.RecupererDonnees();}}
module.exports=InterfacePageAccueil;},fn:"mobile/script/interfacepageaccueil.js"});;
IE.fModule({f:function(exports,require,module,global){const TypeNotification={nOrpheline:0,nUnique:1,nCompteur:2,nRouleau:3};module.exports.TypeNotification=TypeNotification;const TypeActionBoutonNotif={abnLu:0,abnFermer:1,abnLien:2,abnNoAction:3};module.exports.TypeActionBoutonNotif=TypeActionBoutonNotif;const TypeModaliteAffichage={affZone:0,affHistorique:1,affModale:2,affPopup:3};module.exports.TypeModaliteAffichage=TypeModaliteAffichage;},fn:"typecentralenotifications.js"});;
IE.fModule({f:function(exports,require,module,global){require('script/css/ObjetCentraleNotifications.css');const Identite=require('ObjetIdentite.js');const{ObjetRequeteConsultation}=require('ObjetRequeteJSON.js');const Requetes=require('CollectionRequetes.js');const{Invocateur}=require('Invocateur.js');const ToucheClavier=require('ToucheClavier.js');const GTraductions=require('ObjetTraduction.js');const GHtml=require('GHtml.js');const{GDate}=require('ObjetDate.js');const TypeCentraleNotifications=require('TypeCentraleNotifications.js');const TypeNotification=TypeCentraleNotifications.TypeNotification;const TypeActionBoutonNotif=TypeCentraleNotifications.TypeActionBoutonNotif;const TypeModaliteAffichage=TypeCentraleNotifications.TypeModaliteAffichage;const EEvent=require('Enumere_Event.js');const ObjetDonneesCentraleNotifications=require('ObjetDonneesCentraleNotifications.js');const ObjetTri=require('ObjetTri.js');const EGenreTriElement=require('Enumere_TriElement.js');Requetes.inscrire('CentraleNotifications',ObjetRequeteConsultation);class ObjetCentraleNotifications extends Identite{constructor(...aParams){super(...aParams);this.idContenu=this.Nom+'_contenu';this.ajouterEvenementGlobal(EEvent.SurPostResize,function(){if(this.apiScroll){this.apiScroll.surResize();}});Invocateur.abonner(ObjetDonneesCentraleNotifications.typeNotif.surModification,function(aParams){if(!aParams.masquerNbNotifs){_requete(this);}},this);this.donneesCentraleNotifications=GApplication.donneesCentraleNotifications;this.setOptions({actionneur:null,estMobile:false,timerOuverture:null});}
free(){super.free();$('#'+this.Nom.escapeJQ()).remove();}
RecupererDonnees(){_requete(this,true);}
getControleur(aInstance){return $.extend(true,super.getControleur(this),{getNodeRacine:function(){$(this.node).on({'keyup':function(aEvent){if(aEvent.which===ToucheClavier.Echap){aInstance.fermer();}}});},btnFermer:{event:function(){aInstance.fermer();}},avecCompteurGeneral:function(){return aInstance.donneesCentraleNotifications.nbNotifs>0;},getHtmlNbNotifs:function(){return aInstance.donneesCentraleNotifications.nbNotifs>99?'99+':aInstance.donneesCentraleNotifications.nbNotifs;},btnSectionLu:{event:function(aIndexSection){const lSection=aInstance.donnees.liste.GetElement(aIndexSection);if(lSection){_afficherSectionLue(aInstance,lSection,aIndexSection);}}},getNodeNotif:function(aIndexSection,aIndexNotif){const lNotif=_getNotifDIndexs(aInstance,aIndexSection,aIndexNotif);if(lNotif){$(this.node).eventValidation(function(){_navigation(aInstance,lNotif);});}},btnNotifCoin:{event:function(aIndexSection,aIndexNotif){const lNotif=_getNotifDIndexs(aInstance,aIndexSection,aIndexNotif);if(lNotif&&lNotif.onBtnClick){_onBtnCoinClick(aInstance,lNotif,aIndexSection,aIndexNotif);}}},getNodeMessage:function(){$(this.node).find('*').each(function(){if(this.style&&this.style.fontWeight==='bold'){this.style.fontWeight='';$(this).addClass('sc_article_contenu_bold');}});},afficherAucuneNotif:function(){return aInstance.donneesCentraleNotifications.nbNotifs===0;},afficherPapillion:function(){return aInstance.donneesCentraleNotifications.nbNotifs>0;}});}
fermer(){$('#'+this.Nom.escapeJQ()+' .cn_scroll').addClass('cn_scroll_inactif');this.callback.appel();}
ConstruireAffichage(){const H=[];H.push('<div ie-node="getNodeRacine" class="ObjetCentraleNotifications">','<header tabindex="0">');if(this.options.estMobile){H.push('<div class="cn_flechegauche">','<ie-btnimage ie-model="btnFermer" class="icon_retour_mobile btnImageIcon"></ie-btnimage>','</div>');}
H.push('<div class="cn_titre_notif">',GTraductions.getValeur('CentraleNotifications.TitreNotifications'),'</div>','<div class="cn_compteurTotal" ie-if="avecCompteurGeneral"><div><label ie-html="getHtmlNbNotifs"></label></div></div>');if(!this.options.estMobile){H.push('<div class="cn_fermeture">','<ie-btnimage ie-model="btnFermer" class="icon_fermeture_widget btnImageIcon" title="',GTraductions.getValeur('Fermer'),'"></ie-btnimage>','</div>');}
H.push('</header>','<i ie-if="afficherPapillion" class="image_centrale_notification"></i>','<div ie-if="afficherAucuneNotif" class="cn_imgAucuneNouvelleNotif">','<div></div>',GTraductions.getValeur('CentraleNotifications.AucuneNotification'),'</div>','<div class="cn_liste_notifs" id="',this.idContenu,'">','</div>','</div>');return H.join('');}}
function _navigation(aInstance,aNotification){Promise.resolve().then(function(){if(aNotification.onNotifClick){return _notificationSaisieClick(aInstance,aNotification);}}).then(function(){aInstance.options.actionneur.actionNotification(aNotification);if(aNotification.action===TypeActionBoutonNotif.abnLien){aInstance.fermer();} else if(aNotification.onNotifClick){_actualiser(aInstance);}});}
function _onBtnCoinClick(aInstance,aNotification){return _notificationSaisie(aInstance,aNotification,{onBtnClick:true}).then(function(){_actualiser(aInstance);});}
function _notificationSaisieClick(aInstance,aNotification){return _notificationSaisie(aInstance,aNotification,{onNotifClick:true});}
function _notificationSaisie(aInstance,aNotification,aParams){const lParams=Object.assign(aParams,{estSaisie:true,idNotif:aNotification.id});return Requetes('CentraleNotifications',aInstance).lancerRequete(lParams).then(function(aDonnees){if(aDonnees.ok){const lAvecDecrementNotif=!aNotification.modalites.contains(TypeModaliteAffichage.affHistorique);if(lParams.onBtnClick){switch(aNotification.action){case TypeActionBoutonNotif.abnLu:aNotification.modalites.add(TypeModaliteAffichage.affHistorique);break;case TypeActionBoutonNotif.abnFermer:aInstance.donnees.liste.parcourir(function(aSection){aSection.liste=aSection.liste.getListeElements(function(aNotif){return aNotif.id!==aNotification.id;});});break;}}
if(lAvecDecrementNotif){Invocateur.evenement(ObjetDonneesCentraleNotifications.typeNotif.masquerNbNotifs,1);}}});}
function _getNotifDIndexs(aInstance,aIndexSection,aIndexNotif){const lSection=aInstance.donnees.liste.GetElement(aIndexSection);if(lSection){return lSection.liste.GetElement(aIndexNotif);}}
function _requete(aInstance,aSurDemarrage){if(aInstance._requeteEnCours){return;}
aInstance._requeteEnCours=true;const lDemarrageAnimation=aSurDemarrage&&aInstance.options.timerOuverture>0;const lPromises=[
Requetes('CentraleNotifications',aInstance).lancerRequete().then(function(aDonnees){aInstance.donnees=aDonnees;if(aInstance.donnees&&aInstance.donnees.liste){aInstance.donnees.liste.parcourir(function(aSection){if(aSection.avecTri&&aSection.liste){aSection.liste.setTri([
ObjetTri.init('type'),ObjetTri.init('date',EGenreTriElement.Decroissant),ObjetTri.init('id'),ObjetTri.init('titre')
]).trier();}});}
if(!aInstance._estDetruite){_actualiser(aInstance,aSurDemarrage);$('#'+aInstance.Nom.escapeJQ()+' .ObjetCentraleNotifications>header').focus();}})
];if(lDemarrageAnimation){lPromises.push(new Promise(function(aResolve){setTimeout(function(){aResolve();},aInstance.options.timerOuverture);}));}
Promise.all(lPromises).then(function(){$('#'+aInstance.Nom.escapeJQ()+' .cn_scroll').removeClass('cn_scroll_inactif');}).finally(function(){aInstance._requeteEnCours=false;});}
function _contruireEtiquetteArticle(aNotification){const H=[];switch(aNotification.type){case TypeNotification.nCompteur:H.push('<div>'+aNotification.compteur+'</div>');break;default:{let lJour='';let lEllipsis=false;const lDateCourante=new Date();if(GDate.estJourEgal(lDateCourante,aNotification.date)){lJour='<i class="icon_calendrier_aujourdhui"></i>';} else if(GDate.estJourEgal(GDate.GetJourSuivant(lDateCourante,-1),aNotification.date)){lJour=GTraductions.getValeur('Hier');lEllipsis=true;} else{lJour=GDate.FormatDate(aNotification.date,'%JJ/%MM');}
H.push('<div class="cn_etiquette_jour"',(lEllipsis?' ie-ellipsis':''),'>',lJour,'</div>','<div class="cn_etiquette_sep"></div>','<div>',GDate.FormatDate(aNotification.date,'%hh%sh%mm'),'</div>');}}
return H.join('');}
function _afficherSectionLue(aInstance,aSection){aSection._afficherhistorique=!aSection._afficherhistorique;_actualiser(aInstance);}
function _construireDateLue(aNotification){return['<div class="sc_datePied">','<i class="icon_eye_open,"></i>',GTraductions.getValeur('CentraleNotifications.HistoNotifLueLe',[GDate.FormatDate(aNotification.dateLue,'%JJ/%MM/%AAAA')]),'</div>'
].join('');}
function _construireDateExpiration(aNotification){return['<div class="sc_datePied">','<i class="icon_time"></i>',GTraductions.getValeur('CentraleNotifications.HistoNotifSuppr',[GDate.FormatDate(aNotification.dateExpiration,'%JJ/%MM/%AAAA')]),'</div>'
].join('');}
function _construireListeNotifications(aInstance,aSection,aIndexSection,aAfficherHistorique){const H=[];aSection.liste.parcourir(function(aNotification,aIndexNotif){const lEstHistorique=aNotification.modalites.contains(TypeModaliteAffichage.affHistorique);if((aAfficherHistorique&&!lEstHistorique)||(!aAfficherHistorique&&lEstHistorique)){return;}
let lBoutonCoin='';let lAvecActionArticle=false;switch(aNotification.action){case TypeActionBoutonNotif.abnLien:lBoutonCoin='<i class="sc_btnCoin icon_affichage_widget"></i>';lAvecActionArticle=true;break;case TypeActionBoutonNotif.abnLu:if(!aAfficherHistorique){lBoutonCoin=['<ie-btnimage class="sc_btnCoin btnImageIcon icon_eye_close"',' title="',GTraductions.getValeur('CentraleNotifications.MarquerLu'),'"',GHtml.composeAttr('ie-model','btnNotifCoin',[aIndexSection,aIndexNotif]),'></ie-btnimage>'].join('');}
break;case TypeActionBoutonNotif.abnFermer:lBoutonCoin=['<ie-btnimage class="sc_btnCoin btnImageIcon icon_fermeture_widget"',' title="',GTraductions.getValeur('Fermer'),'"',GHtml.composeAttr('ie-model','btnNotifCoin',[aIndexSection,aIndexNotif]),'></ie-btnimage>'].join('');break;}
const lClasses=[];if(lAvecActionArticle){lClasses.push('sc_article_action','waves-effect');}
if(aAfficherHistorique){lClasses.push('sc_article_histo');}
H.push('<article tabindex="0"',(lClasses.length>0?' class="'+lClasses.join(' ')+'"':''),(lAvecActionArticle?GHtml.composeAttr('ie-node','getNodeNotif',[aIndexSection,aIndexNotif,aNotification.id]):''),'>',lBoutonCoin,'<div class="sc_article_gauche">',_contruireEtiquetteArticle(aNotification),'</div>','<div class="sc_article_contenu">',aNotification.titre?'<div class="sc_article_contenu_titre'+(lBoutonCoin?' sc_article_contenu_titre_avecBtn':'')+'">'+aNotification.titre+'</div>':'','<div ie-node="getNodeMessage">',aNotification.message,'</div>',aNotification.dateLue?_construireDateLue(aNotification):'',aNotification.dateExpiration&&lEstHistorique?_construireDateExpiration(aNotification):'','</div>','</article>');});return H.join('');}
function _actualiser(aInstance,aSurDemarrage){const H=[];let lScrollTop=0;if(!aSurDemarrage){const lElement=$('#'+aInstance.idContenu.escapeJQ()+' .cn_scroll').get(0);if(lElement&&lElement.scrollTop>0){lScrollTop=lElement.scrollTop;}}
H.push('<div class="cn_scroll',aSurDemarrage?' cn_scroll_inactif':'','">');H.push('<div class="cb_contenu_scroll">');aInstance.donnees.liste.parcourir(function(aSection,aIndexSection){if(aSection.liste.GetNbrElements()===0){return;}
let lNbLus=0;let lNbNonLus=0;aSection.liste.parcourir(function(aNotification){if(aNotification.modalites.contains(TypeModaliteAffichage.affHistorique)){lNbLus+=aNotification.compteur;} else if(aNotification.modalites.contains(TypeModaliteAffichage.affZone)){lNbNonLus+=aNotification.compteur;}});H.push('<section class="cn_section cn_section_',aSection.ident,'">','<header>','<div class="cn_section_titre">','<i></i>','<label>',aSection.GetLibelle(),'</label>',lNbNonLus>0?'<div class="cn_section_lu">'+lNbNonLus+'</div>':'','</div>',lNbLus>0?['<div class="cn_section_btnLu">','<ie-btnimage class="icon_eye_open btnImageIcon"',GHtml.composeAttr('title',GTraductions.getValeur('CentraleNotifications.HistoSectionTitre',[aSection.GetLibelle()])),GHtml.composeAttr('ie-model','btnSectionLu',aIndexSection),'></ie-btnimage>','<label>'+lNbLus+'</label>','</div>'].join(''):'','</header>');H.push(_construireListeNotifications(aInstance,aSection,aIndexSection));if(aSection._afficherhistorique){H.push(_construireListeNotifications(aInstance,aSection,aIndexSection,true));}
H.push('</section>');});H.push('</div>');H.push('</div>');GHtml.setHtml(aInstance.idContenu,H.join(''),{instance:aInstance});if(lScrollTop>0){let lElement=$('#'+aInstance.idContenu.escapeJQ()+' .cn_scroll').get(0);if(lElement){lElement.scrollTop=lScrollTop;}}}
module.exports=ObjetCentraleNotifications;},fn:"objetcentralenotifications.js"});;
IE.fModule({f:function(exports,require,module,global){const ObjetCentraleNotifications=require('ObjetCentraleNotifications.js');const UtilitaireSideNav=require('UtilitaireSideNav.js');class ObjetWrapperCentraleNotifications_Mobile{constructor(aDonnees){this.donnees=aDonnees;this.options={actionneur:null};}
ouvrir(){if(!this.instanceNotif){this.instanceNotif=UtilitaireSideNav.createComplet(ObjetCentraleNotifications,{pere:this,evenement:function(){this.instanceNotif.fermer();this.instanceNotif=null;},options:{actionneur:this.donnees.actionneur,estMobile:true}});} else{this.instanceNotif.fermer();this.instanceNotif=null;}}}
module.exports=ObjetWrapperCentraleNotifications_Mobile;},fn:"objetwrappercentralenotifications_mobile.js"});;
IE.fModule({f:function(exports,require,module,global){require('script/css/ObjetAideContextuelle.css');const Identite=require('ObjetIdentite.js');const MethodesObjet=require('MethodesObjet.js');const{ObjetRequeteConsultation}=require('ObjetRequeteJSON.js');const Requetes=require('CollectionRequetes.js');const ToucheClavier=require('ToucheClavier.js');const GTraductions=require('ObjetTraduction.js');const GHtml=require('GHtml.js');const EEvent=require('Enumere_Event.js');const ObjetListeElements=require('ObjetListeElements.js');const ObjetElement=require('ObjetElement.js');Requetes.inscrire('AideContextuelleDyn',ObjetRequeteConsultation);class ObjetAideContextuelle extends Identite{constructor(...aParams){super(...aParams);this.idContenu=this.Nom+'_contenu';this.ajouterEvenementGlobal(EEvent.SurPostResize,function(){if(this.apiScroll){this.apiScroll.surResize();}});this.setOptions({estMobile:false,timerOuverture:null,onglet:null,nombre:0});}
free(){super.free();$('#'+this.Nom.escapeJQ()).remove();}
RecupererDonnees(){this.ecran='';if(!!this.options.onglet){const lGenre=this.options.onglet.GetGenre();if(MethodesObjet.isNumber(lGenre)){this.ecran=lGenre.toString();} else if(MethodesObjet.isString(lGenre)){this.ecran=lGenre;}
if(this.options.onglet.aides){_actualiser(this,true);$('#'+this.Nom.escapeJQ()+' .ObjetAideContextuelle>header').focus();} else{_requete(this,true);}}}
getControleur(aInstance){return $.extend(true,super.getControleur(this),{getNodeRacine:function(){$(this.node).on({'keyup':function(aEvent){if(aEvent.which===ToucheClavier.Echap){aInstance.fermer();}}});},btnFermer:{event:function(){aInstance.fermer();}},nodeFicheAide:function(aIndexFicheAide,aType){const lTypeAide=!!aInstance.options.onglet&&!!aInstance.options.onglet.aides?aInstance.options.onglet.aides.GetElementParGenre(aType):null;null;const lFicheAide=lTypeAide&&lTypeAide.fiches?lTypeAide.fiches.GetElement(aIndexFicheAide):null;$(this.node).eventValidation(function(){if(lFicheAide){window.open(lFicheAide.url);}});},nodeVoirPlus:function(){$(this.node).eventValidation(function(){window.open(GParametres.aideContextuelle.url_accueil);});},afficherAucuneAide:function(){return aInstance.options.nombre===0;},afficherAide:function(){return aInstance.options.nombre>0;}});}
fermer(){$('#'+this.Nom.escapeJQ()+' .cn_scroll').addClass('cn_scroll_inactif');this.callback.appel();}
ConstruireAffichage(){const H=[];H.push('<div ie-node="getNodeRacine" class="ObjetAideContextuelle">','<header tabindex="0">');if(this.options.estMobile){H.push('<div class="cn_flechegauche">','<ie-btnimage ie-model="btnFermer" class="icon_retour_mobile btnImageIcon"></ie-btnimage>','</div>');}
H.push('<div class="cn_titre_notif">',GTraductions.getValeur('AideContextuelle.Titre'),'</div>');if(!this.options.estMobile){H.push('<div class="cn_fermeture">','<ie-btnimage ie-model="btnFermer" class="icon_fermeture_widget btnImageIcon" title="',GTraductions.getValeur('Fermer'),'"></ie-btnimage>','</div>');}
H.push('</header>','<div ie-if="afficherAucuneAide" class="cn_imgAucuneAide">','<div></div>',GTraductions.getValeur('AideContextuelle.AucuneAide'),'</div>','<div class="cn_liste_aide" id="',this.idContenu,'">','</div>','</div>');return H.join('');}}
ObjetAideContextuelle.classSupport={1:'aide-tutoriel',2:'aide-mode-emploi',3:'aide-faq'};function _requete(aInstance,aSurDemarrage){if(aInstance._requeteEnCours){return;}
aInstance._requeteEnCours=true;const lDemarrageAnimation=aSurDemarrage&&aInstance.options.timerOuverture>0;const lPromises=[
Requetes('AideContextuelleDyn',aInstance).lancerRequete({ecran:aInstance.ecran}).then(function(aJSON){aInstance.options.onglet.aides={};if(aJSON&&aJSON.typesupport){aInstance.options.onglet.aides=new ObjetListeElements();aJSON.typesupport.forEach((aObjet) =>{const lElement=new ObjetElement().copieJSON(aObjet);lElement.Genre=lElement.id;lElement.Libelle=lElement.libelle;lElement.fiches=new ObjetListeElements();lElement.icone=aObjet.educFont?(aObjet.educFont.startsWith('C_')?aObjet.educFont.slice(2):aObjet.educFont):'';if(aObjet.fiches){aObjet.fiches.forEach((aFiche,index) =>{const lFiche=new ObjetElement().copieJSON(aFiche);lFiche.Genre=index;lFiche.Libelle=lElement.titre;if(aFiche.duree){const lMin=Math.floor(aFiche.duree/60);const lSec=aFiche.duree%60;lFiche.duree=lMin+'\''+lSec;}
lElement.fiches.AddElement(lFiche);});}
aInstance.options.onglet.aides.AddElement(lElement);});}
if(!aInstance._estDetruite){_actualiser(aInstance,aSurDemarrage);$('#'+aInstance.Nom.escapeJQ()+' .ObjetAideContextuelle>header').focus();}})
];if(lDemarrageAnimation){lPromises.push(new Promise(function(aResolve){setTimeout(function(){aResolve();},aInstance.options.timerOuverture);}));}
Promise.all(lPromises).then(function(){$('#'+aInstance.Nom.escapeJQ()+' .cn_scroll').removeClass('cn_scroll_inactif');}).finally(function(){aInstance._requeteEnCours=false;});}
function _actualiser(aInstance,aSurDemarrage){const H=[];let lScrollTop=0;if(!aSurDemarrage){const lElement=$('#'+aInstance.idContenu.escapeJQ()+' .cn_scroll').get(0);if(lElement&&lElement.scrollTop>0){lScrollTop=lElement.scrollTop;}}
H.push('<div class="cn_scroll',aSurDemarrage?' cn_scroll_inactif':'','">');H.push('<div class="cb_contenu_scroll">');if(aInstance.options.onglet.aides){const lPremierElement=aInstance.options.onglet.aides.GetElement(0);const lCouleurFoncee=lPremierElement.couleurFoncee;const lCouleurClaire=lPremierElement.couleurClaire;aInstance.options.onglet.aides.parcourir(function(aType){const lStyleHeader=`style="color:${aType.couleurFoncee}; background-color:${aType.couleurClaire}"`;H.push('<section class="cn_section cn_section_',aType.GetGenre(),'">','<header>',`<div class="cn_section_titre ${ObjetAideContextuelle.classSupport[aType.GetGenre()]}" ${lStyleHeader}>`,'<div class="sc_header_contenu" tabindex="0">',aType.GetLibelle(),'</div>','</div>','</header>','<div class="sc_contenu">');aType.fiches.parcourir((aFiche,aIndex) =>{H.push(`<article tabindex="0" ${GHtml.composeAttr('ie-node','nodeFicheAide',[aIndex,aType.GetGenre()])}>`,`<div class="sc_article_gauche ${ObjetAideContextuelle.classSupport[aType.GetGenre()]}"><i class="${aType.icone}" style="color:${aType.couleurFoncee};"></i></div>`,`<div class="sc_article_contenu" title="${aFiche.description}">${aFiche.titre}</div>`,(aFiche.duree?`<div class="sc_article_duree iconic icon_time" style="color:${aType.couleurFoncee};">${aFiche.duree}</div>`:''),'</article>');});H.push('</div>');H.push('</section>');});H.push(`<section class="cn_section voirplus" ${GHtml.composeAttr('ie-node','nodeVoirPlus')} style="color:${lCouleurFoncee}; background-color:${lCouleurClaire}">`,'<header>',`<div class="cn_section_titre ">`,`<div class="sc_header_contenu" tabindex="0"> ${GTraductions.getValeur('AideContextuelle.VoirPlus')}<i class="icon_angle_right m-left-xl"></i></div>`,'</div>','</header>','</section>');}
H.push('</div>');H.push('</div>');GHtml.setHtml(aInstance.idContenu,H.join(''),{instance:aInstance});if(lScrollTop>0){let lElement=$('#'+aInstance.idContenu.escapeJQ()+' .cn_scroll').get(0);if(lElement){lElement.scrollTop=lScrollTop;}}}
module.exports=ObjetAideContextuelle;},fn:"objetaidecontextuelle.js"});;
IE.fModule({f:function(exports,require,module,global){const ObjetAideContextuelle=require('ObjetAideContextuelle.js');const UtilitaireSideNav=require('UtilitaireSideNav.js');class ObjetWrapperAideContextuelle_Mobile{constructor(aDonnees){this.donnees=aDonnees;}
ouvrir(aOnglet,aNombre){this.onglet=aOnglet;this.nombre=aNombre;if(!this.instanceAide){this.instanceAide=UtilitaireSideNav.createComplet(ObjetAideContextuelle,{pere:this,evenement:function(){this.instanceAide.fermer();this.instanceAide=null;},options:{estMobile:true,onglet:this.onglet,nombre:this.nombre}});} else{this.instanceAide.fermer();this.instanceAide=null;}}}
module.exports=ObjetWrapperAideContextuelle_Mobile;},fn:"objetwrapperaidecontextuelle_mobile.js"});;
IE.fModule({f:function(exports,require,module,global){const Callback=require('Callback.js');const MethodesObjet=require('MethodesObjet.js');const EStructureAffichage=require('Enumere_StructureAffichage.js');const InterfacePage_Mobile=require('InterfacePage_Mobile.js');const ObjetListeElements=require('ObjetListeElements.js');const GTraductions=require('ObjetTraduction.js');const GChaine=require('GChaine.js');const IEHtml=require('IEHtml.js');const UtilitaireDeconnexion=require('UtilitaireDeconnexion.js');const ObjetWrapperCentraleNotifications_Mobile=require('ObjetWrapperCentraleNotifications_Mobile.js');const ObjetWrapperAideContextuelle_Mobile=require('ObjetWrapperAideContextuelle_Mobile.js');const tag=require('tag.js');const ObjetElement=require('ObjetElement.js');class _ObjetAffichagePageMenuOnglets extends InterfacePage_Mobile{constructor(...aParams){super(...aParams);this.idTitre=this.Nom+'_titre';this.idDerniereConnexion=this.Nom+'_derniereConnexion';this.idSeDeconnecter=this.Nom+'_Bouton_0';this.idDropDownContentRessources=this.Nom+'_dropdownContentRessources';this.listeOnglets=new ObjetListeElements();this.listeOngletsTraitee=new ObjetListeElements();this.listeRessources=new ObjetListeElements();this.avecListeRessources=false;this.GenreStructure=EStructureAffichage.Autre;const lActionneur=this.getActionneurCentraleNotification();if(lActionneur){this.wrapperNotifs=new ObjetWrapperCentraleNotifications_Mobile({pere:this,actionneur:lActionneur});}
if(!!GParametres.urlAide||!!GParametres.aideContextuelle){this.wrapperAide=new ObjetWrapperAideContextuelle_Mobile({pere:this,actionneur:lActionneur});}}
ConstruireInstances(){}
SetParametres(aParam){this.avecListeRessources=!!aParam.avecListeRessources;if(this.avecListeRessources){this.traiterListeRessource();}}
getControleur(aInstance){return $.extend(true,super.getControleur(this),{comboMembre:{init(aCombo){const lListe=new ObjetListeElements();aInstance.listeRessources.parcourir(function(aRessource,aIndex){const lArticle=new ObjetElement(aRessource.GetLibelle(),(aRessource.sousTitre?' ('+aRessource.sousTitre+')':''));lArticle.ressource=aRessource;lArticle.callbackSelection=(aParametres) =>{if(aParametres.estSelectionManuelle){GInterface.changementRessource(aIndex);}};lListe.add(lArticle);});aCombo.setDonnees_ObjetSaisie({liste:lListe,options:{avecDesignMobile:true,avecOuvertureDeroulantModale:false,getContenuCellule(aElement){return{libelleHtml:_construireEnteteRessource.call(aInstance,aElement.ressource)};}}});},getIndiceSelection(aCombo){let lIndex=0;const lNumeroMembre=GEtatUtilisateur.getMembre().GetNumero();aCombo.getListeElements().parcourir((aArticle,aIndex) =>{if(aArticle&&aArticle.ressource&&aArticle.ressource.GetNumero()===lNumeroMembre){lIndex=aIndex;return false;}});return lIndex;}},surClicOnglet:function(aGenreOnglet){aInstance.evenementListeOnglets(aGenreOnglet);},nodeClosePanel:function(){$(this.node).on('click',function(){GInterface.fermerMenuOnglet();});},getNodeAccueil:function(){$(this.node).on('click',function(){aInstance.evenementListeOnglets(aInstance.getGenreOngletAccueil());});},btnNotifications:{event:function(){GInterface.fermerMenuOnglet();aInstance.wrapperNotifs.ouvrir();},getHtmlBtnNotif:function(){return aInstance.composeBadgeBtn(GApplication.donneesCentraleNotifications.nbNotifs);}},aideContextuelle:{bouton:{event:function(){const lGenreOnglet=GEtatUtilisateur.getGenreOnglet();const lNombre=GParametres.aideContextuelle.getNombreDeGenreOnglet(lGenreOnglet);if((lNombre===0)&&GParametres.urlAide){window.open(GChaine.Format(GParametres.urlAide,[lGenreOnglet,'']));return;}
GInterface.fermerMenuOnglet();const lOnglet=GEtatUtilisateur.listeOnglets.GetElementParGenre(lGenreOnglet);aInstance.wrapperAide.ouvrir(lOnglet,lNombre);}},html:function(){const lGenreOnglet=GEtatUtilisateur.getGenreOnglet();const lNombre=GParametres.aideContextuelle?GParametres.aideContextuelle.getNombreDeGenreOnglet(lGenreOnglet):'';return aInstance.composeBadgeBtn(lNombre);}},nodeSeDeconnecter:function(){$(this.node).on('click',function(){aInstance.seDeconnecter();});}});}
ConstruireStructureAffichageAutre(){const lHtml=[];lHtml.push('<section class="global-menu-container ">');lHtml.push('<header class="user-container">','<div class="user-container-profil">',this.avecListeRessources?tag('ie-combo',{'ie-model':'comboMembre',class:'membre-combo'}):_construireEnteteRessource.call(this,GEtatUtilisateur.getMembre()),'</div>','<span id="',this.idDerniereConnexion,'" class="user-container-derniere-connexion"></span>','</header>');lHtml.push('<div class="menu-container">','<ul class="menu-liste collection collapsible" role="menubar">');lHtml.push(this.composeOngletMobileApp());lHtml.push('</ul>','</div>');lHtml.push('</section>','<section class="btn-commands-container">',_composeBoutonMenu.call(this),'</section>');return lHtml.join('');}
afficherListe(){const $ulParent=$('#'+this.Nom.escapeJQ()).find('ul.menu-liste.collapsible');$ulParent.find('li:not(.collection-static-item)').remove();IEHtml.injectHTMLParams({element:$ulParent.get(0),insererAvantLeNode:$ulParent.find('li').get(0),html:this.composeOnglets(),controleur:this.controleur});}
composeOnglets(){const lHtml=[];this.traiterListeOnglets();this.listeOngletsTraitee.parcourir(function(aEle){if(aEle.Actif&&aEle.Visible!==false){if(aEle.children&&aEle.children.GetNbrElements()>0){lHtml.push('<li class="is-collapse collapsible-item" role="menu" aria-label="',aEle.GetLibelle(),'">','<span',(aEle.idNotif?' id="'+aEle.idNotif+'"':''),' class="as-header collapsible-header" role="button" aria-expanded="false" tabIndex="0">',aEle.GetLibelle(),'</span>','<div class="collapsible-body">','<ul class="collection sub-liste" tabIndex="0">');aEle.children.parcourir(function(aChild){lHtml.push(this.composeOnglet(aChild,2));}.bind(this));lHtml.push('</ul>','</div>','</li>');} else{aEle.GetGenre()!==this.getGenreOngletAccueil()?lHtml.push(this.composeOnglet(aEle,1)):'';}}}.bind(this));return lHtml.join('');}
composeOnglet(aEle,aNiveau){return(['<li',(aEle.idNotif?' id="'+aEle.idNotif+'"':''),' class="collection-item with-action ',(aEle.imagePerso?aEle.imagePerso+'"':'"'),' ie-event="click->surClicOnglet(\'',aEle.GetGenre(),'\')"',' tabIndex="0" role="menuitem" aria-level="',(aNiveau||1),'">','<span>',aEle.GetLibelle(),'</span>','</li>']).join('');}
focusTitre(){$('#'+this.idTitre.escapeJQ()).focus();}
setOnglet(aGenreOnglet){this.actualiserTitre(aGenreOnglet);}
evenementListeOnglets(aGenre){this.callback.appel(aGenre,true ,true);}
RecupererDonnees(){this.actionSurRecupererDonnees();}
traiterListeOnglets(){const lThis=this;lThis.listeOnglets.parcourir(function(aElePere){if(!aElePere.onglet){const lElePere=MethodesObjet.dupliquer(aElePere);lThis.listeOngletsTraitee.AddElement(lElePere);lElePere.children=new ObjetListeElements();lThis.listeOnglets.parcourir(function(aEleFils){if(aEleFils.onglet&&aEleFils.onglet.GetGenre()===aElePere.GetGenre()){const lEleFils=MethodesObjet.dupliquer(aEleFils);lElePere.children.AddElement(lEleFils);}});}});}
traiterListeRessource(){}
actionSurRecupererDonnees(){}
evenementSelectionRessource(){}
actualiserTitre(){}
getEspaceIcone(){}
getGenreOngletAccueil(){return false;}
seDeconnecter(){if(GEtatUtilisateur.EtatSaisie){this.callback.appel(GEtatUtilisateur.getGenreOnglet(),null,null,null,new Callback(this,this.actionSeDeconnecter));} else{this.actionSeDeconnecter();}}
actionSeDeconnecter(){if(GApplication.estAppliMobile){UtilitaireDeconnexion.deconnexion().then(function(){this.seDeconnecterAppliMobile();}.bind(this));} else{UtilitaireDeconnexion.deconnexion();}}
surClickAccueil(){this.evenementListeOnglets(this.getGenreOngletAccueil());}
seDeconnecterAppliMobile(){}
composeOngletMobileApp(){return'';}
composeBoutonCentraleNotif(){if(this.wrapperNotifs){return['<ie-btnimage class="image_centrale_notification btnImageIcon badged-btn icon-title" ie-model="btnNotifications" ie-html="getHtmlBtnNotif"  title="',GTraductions.getValeur('Mobile.Menu.Notifs'),'" aria-label="',GTraductions.getValeur('CentraleNotifications.TitreNotifications'),'"><span style="color:red;">Notif</span></ie-btnimage>'].join('');}
return'';}
composeBoutonAideContextuelle(){if(this.wrapperAide){return['<ie-btnicon class="icon_question_sign btnImageIcon badged-btn icon-title" ie-model="aideContextuelle.bouton" ie-html="aideContextuelle.html"  title="',GTraductions.getValeur('Commande.Aide.Actif'),'" aria-label="',GTraductions.getValeur('Commande.Aide.Actif'),'"><span style="color:red;"></span></ie-btnicon>'].join('');}
return'';}
composeBadgeBtn(aNb,aWAI){return['<span class="WAI_hidden">',aWAI,'</span>',aNb>0?['<span class="as-tag">',aNb>99?'99+':aNb,'</span>'].join(''):''
].join('');}
getActionneurCentraleNotification(){}
composeBoutonMenuSupp(){}}
function _construireEnteteRessource(aRessource){const lInfos=this.getInfosComboMembre(aRessource);return tag('div',{class:'membre-photo_container'},tag('div',{class:['membre-photo',this.getEspaceIcone()],role:'presentation'},lInfos.photo||''),tag('span',{class:'label-membre',id:this.idTitre,role:"heading",tabIndex:"0"},lInfos.libelle));}
function _composeBoutonMenu(){const H=[];H.push('<div class="home-action-conteneur">','<div class="toggler-btn" ie-node="nodeClosePanel">','<i class="icon_menu_burger" aria-label="',GTraductions.getValeur('accueil.menuPrincipal'),'"><span class="WAI_hidden">',GTraductions.getValeur('accueil.menuPrincipal'),'</span></i></div>');H.push('</div>');H.push('<div class="notifs-conteneur">');H.push('<hr />');H.push(this.composeBoutonMenuSupp());H.push('</div>','<div class="cta-mobile-conteneur">');H.push('<hr />');if(!GApplication.estAppliMobile||GApplication.infoAppliMobile.avecExitApp){H.push('<ie-btnimage class="icon_off btnImageIcon badged-btn" ie-node="nodeSeDeconnecter" ie-hint="',GTraductions.getValeur('connexion.SeDeconnecter'),'" aria-label="',GTraductions.getValeur('connexion.SeDeconnecter'),'">','<span class="WAI_hidden">',GTraductions.getValeur('connexion.SeDeconnecter'),'</span>','</ie-btnimage>');}
H.push('</div>');return H.join('');}
module.exports=_ObjetAffichagePageMenuOnglets;},fn:"_interfacepagemenuonglets.js"});;
IE.fModule({f:function(exports,require,module,global){const EGenreOnglet=require('Enumere_Onglet.js');const MethodesObjet=require('MethodesObjet.js');const{ObjetInvocateur,Invocateur}=require('Invocateur.js');const ObjetListeElements=require('ObjetListeElements.js');const ControleSaisieEvenement=require('ControleSaisieEvenement.js');const C_IdDiscussions='Discussions';const C_IdCasiers='Casiers';const C_IdInformations='Informations';const C_IdSujetsForum='SujetsForum';class ActionneurCentraleNotificationsSco{constructor(aOptions){this.options=Object.assign({estMobile:false},aOptions);}
actionNotification(aNotification){let lOnglet=null;if(aNotification.ouvrirFicheEtab){if(global.GEtatUtilisateur&&GEtatUtilisateur.listeInformationsEtablissements&&GEtatUtilisateur.listeInformationsEtablissements.parcourir&&aNotification.etabNotif&&aNotification.etabNotif.GetNumero){GEtatUtilisateur.listeInformationsEtablissements.parcourir(function(aEtab){if(aNotification.etabNotif.GetNumero()===aEtab.GetNumero()){aEtab.relancerNotif=false;}});}
Invocateur.evenement('ouvrir_ficheEtab');return;}
if(Array.isArray(aNotification.navOnglets)&&aNotification.navOnglets.length>0){aNotification.navOnglets.every(function(aOnglet){if(_estOngletVisible(aOnglet)){lOnglet=aOnglet;return false;}
return true;});}
if(aNotification.detailMessage&&aNotification.detailPossession){GEtatUtilisateur.message=MethodesObjet.dupliquer(aNotification.detailMessage);GEtatUtilisateur.message.listePossessionsMessages=new ObjetListeElements().AddElement(aNotification.detailPossession);GEtatUtilisateur.message.estUneDiscussion=true;GEtatUtilisateur.message.__marquerLu__=true;}
if(aNotification.estDetailActu){GEtatUtilisateur.jeton_OngletInformation_dateNotification=aNotification.date;}
if(!MethodesObjet.isNumber(lOnglet)){switch(aNotification.id){case C_IdDiscussions:lOnglet=EGenreOnglet.Messagerie;break;case C_IdCasiers:lOnglet=EGenreOnglet.Casier_MonCasier;break;case C_IdInformations:lOnglet=EGenreOnglet.Informations;break;case C_IdSujetsForum:lOnglet=EGenreOnglet.ForumPedagogique;break;default:;}}
let lCallbackAvantNavigation=null;if(aNotification.estNotifCours){lCallbackAvantNavigation=() =>{if(!this.options.estMobile){if(!aNotification.domaine||!aNotification.domaine.getSemaines||aNotification.domaine.getSemaines().length===0){return;}
GEtatUtilisateur.SetDomaineSelectionne(aNotification.domaine);GEtatUtilisateur._coursASelectionner=aNotification.cours;} else{if(!aNotification.dateCours){return;}
GEtatUtilisateur.setDerniereDate(aNotification.dateCours);}};}
if(_estOngletVisible(lOnglet)){ControleSaisieEvenement(() =>{if(lCallbackAvantNavigation){if(lCallbackAvantNavigation()===false){return;}}
Invocateur.evenement(ObjetInvocateur.events.navigationOnglet,lOnglet);});} else{}}}
function _estOngletVisible(aOnglet){if(aOnglet===EGenreOnglet.Accueil){const lOngletAccueil=GEtatUtilisateur.listeOnglets.GetElementParGenre(EGenreOnglet.Accueil);if(lOngletAccueil&&lOngletAccueil.Actif){return true;}
return false;}
return GEtatUtilisateur.ongletEstVisible(aOnglet);}
module.exports=ActionneurCentraleNotificationsSco;},fn:"actionneurcentralenotificationssco.js"});;
IE.fModule({f:function(exports,require,module,global){const GTraductions=require('ObjetTraduction.js');const GChaine=require('GChaine.js');const EGenreDocumentJoint=require('Enumere_DocumentJoint.js');const ObjetElement=require('ObjetElement.js');const TypeFichierExterneHttpSco=require('TypeFichierExterneHttpSco.js').TypeFichierExterneHttpSco;class ObjetMoteurFicheEtablissement{constructor(aParam){this.estSurMobile=aParam!==null&&aParam!==undefined?aParam.estSurMobile:GEtatUtilisateur.estEspaceMobile();this.avecReglementAAccepter=aParam!==null&&aParam!==undefined?aParam.avecReglementAAccepter:false;}
composeInformations(aParam){const H=[];const lEtablissement=aParam;if(lEtablissement.urlLogo){H.push('<div  class="logo EspaceBas">','<img src="',lEtablissement.urlLogo,'" alt="" onerror="$(this).remove();" />','</div>');}
if(lEtablissement.Coordonnees.Adresse1||lEtablissement.Coordonnees.Adresse2){H.push('<div class="adresse">');H.push('<i class="icon_map_marker EspaceDroit"></i>');H.push('<div>');if(lEtablissement.Coordonnees.Adresse1){H.push('<div>',lEtablissement.Coordonnees.Adresse1,'</div>');}
if(lEtablissement.Coordonnees.Adresse2){H.push('<div>',lEtablissement.Coordonnees.Adresse2,'</div>');}
H.push('<div>');if(lEtablissement.Coordonnees.CodePostal&&!lEtablissement.Coordonnees.LibellePostal){H.push('<span class="EspaceDroit">',lEtablissement.Coordonnees.CodePostal,'</span>');}
if(lEtablissement.Coordonnees.LibellePostal){H.push('<span class="EspaceDroit">',lEtablissement.Coordonnees.LibellePostal,'</span>');}
if(lEtablissement.Coordonnees.LibelleVille){H.push('<span>',lEtablissement.Coordonnees.LibelleVille,'</span>');}
H.push('</div>');if(lEtablissement.Coordonnees.Province){H.push('<div>',lEtablissement.Coordonnees.Province,'</div>');}
if(lEtablissement.Coordonnees.Pays){H.push('<div>',lEtablissement.Coordonnees.Pays,'</div>');}
H.push('</div></div>');}
H.push('<div>');if(lEtablissement.Coordonnees.NumPersonnalise1&&lEtablissement.Coordonnees.NumPersonnalise1.Numero){H.push('<div class="telephone EspaceHaut">','<i class="icon_phone EspaceDroit"></i> ','<div>',(lEtablissement.Coordonnees.NumPersonnalise1.NomPersonnalise?lEtablissement.Coordonnees.NumPersonnalise1.NomPersonnalise+' : ':''),'<div>',_getTelephoneAvecEspaces.call(this,lEtablissement.Coordonnees.NumPersonnalise1.Numero),'</div></div></div>');}
if(lEtablissement.Coordonnees.NumPersonnalise2&&lEtablissement.Coordonnees.NumPersonnalise2.Numero){H.push('<div class="telephone EspaceHaut">','<i class="icon_phone EspaceDroit"></i> ','<div>',(lEtablissement.Coordonnees.NumPersonnalise2.NomPersonnalise?lEtablissement.Coordonnees.NumPersonnalise2.NomPersonnalise+' : ':''),'<div>',_getTelephoneAvecEspaces.call(this,lEtablissement.Coordonnees.NumPersonnalise2.Numero),'</div></div></div>');}
if(lEtablissement.Coordonnees.NumPersonnalise3&&lEtablissement.Coordonnees.NumPersonnalise3.Numero){H.push('<div class="telephone EspaceHaut">','<i class="icon_phone EspaceDroit"></i> ','<div>',(lEtablissement.Coordonnees.NumPersonnalise3.NomPersonnalise?lEtablissement.Coordonnees.NumPersonnalise3.NomPersonnalise+' : ':''),'<div>',_getTelephoneAvecEspaces.call(this,lEtablissement.Coordonnees.NumPersonnalise3.Numero),'</div></div></div>');}
H.push('</div>');H.push('<div>');if(lEtablissement.Coordonnees.SiteInternet){H.push('<div class="EspaceHaut telephone">','<i class="icon_curseur_souris EspaceDroit"></i> ','<a class="LienAcceuil AvecMain" target="_blank" href="',GChaine.verifierURLHttp(lEtablissement.Coordonnees.SiteInternet),'">',lEtablissement.Coordonnees.SiteInternet,'</a>','</div>');}
if(lEtablissement.Coordonnees.EMailPersonnalise1&&lEtablissement.Coordonnees.EMailPersonnalise1.Mail){H.push('<div class="EspaceHaut telephone">','<i class="icon_envelope EspaceDroit"></i>','<div>',(lEtablissement.Coordonnees.EMailPersonnalise1.NomPersonnalise?lEtablissement.Coordonnees.EMailPersonnalise1.NomPersonnalise+' : ':''),'<div>',_composeEmail.call(this,lEtablissement.Coordonnees.EMailPersonnalise1.Mail),'</div></div></div>');}
if(lEtablissement.Coordonnees.EMailPersonnalise2&&lEtablissement.Coordonnees.EMailPersonnalise2.Mail){H.push('<div class="EspaceHaut telephone">','<i class="icon_envelope EspaceDroit"></i>','<div>',(lEtablissement.Coordonnees.EMailPersonnalise2.NomPersonnalise?lEtablissement.Coordonnees.EMailPersonnalise2.NomPersonnalise+' : ':''),'<div>',_composeEmail.call(this,lEtablissement.Coordonnees.EMailPersonnalise2.Mail),'</div></div></div>');}
H.push('</div>');let lFichier;if(lEtablissement.avecFichierRI){lFichier=new ObjetElement(lEtablissement.LibelleFichierRI,lEtablissement.GetNumero(),EGenreDocumentJoint.Fichier);H.push('<div class="GrandEspaceHaut PetitEspaceBas">',GChaine.composerUrlLienExterne({documentJoint:lFichier,libelleEcran:GTraductions.getValeur('FicheEtablissement.ReglementInterieur'),genreRessource:TypeFichierExterneHttpSco.EtablissementReglement,afficherIconeDocument:true,iconeOverride:'icon_doc_telech'}),'</div>');}
if(lEtablissement.avecFichierCU){lFichier=new ObjetElement(lEtablissement.LibelleFichierCU,lEtablissement.GetNumero(),EGenreDocumentJoint.Fichier);H.push('<div class="EspaceHaut GrandEspaceBas">',GChaine.composerUrlLienExterne({documentJoint:lFichier,libelleEcran:GTraductions.getValeur('FicheEtablissement.CharteUtilisation'),genreRessource:TypeFichierExterneHttpSco.EtablissementCharte,afficherIconeDocument:true,iconeOverride:'icon_doc_telech'}),'</div>');}
if((lEtablissement.avecFichierRI||lEtablissement.avecFichierCU)&&
this.avecReglementAAccepter){H.push('<div class="GrandEspaceDroit">');H.push('<ie-checkbox ie-model="accepterReglement">'+GTraductions.getValeur('FicheEtablissement.Accepter')+'</ie-checkbox>');H.push('</div>');}
return H.join('');}}
function _composeEmail(aParam){if(this.estSurMobile){return'<a href="mailto:'+aParam+'" target="_blank">'+aParam+'</a>';} else{return GChaine.composerEmail(aParam);}}
function _getTelephoneAvecEspaces(aNumeroTelephone){if(!aNumeroTelephone||!aNumeroTelephone.length){return'';}
let lResult='';let lCompteur=0;for(let i=aNumeroTelephone.length-1;i>=0;i--){if((lCompteur%2)===0){lResult=' '+lResult;}
lResult=aNumeroTelephone.charAt(i)+lResult;lCompteur++;}
lResult=lResult.trim();if(this.estSurMobile){return'<a href="tel:'+aNumeroTelephone+'">'+lResult+'</a>';} else{return lResult;}}
module.exports=ObjetMoteurFicheEtablissement;},fn:"objetmoteurficheetablissement.js"});;
IE.fModule({f:function(exports,require,module,global){const{ObjetRequeteSaisie}=require('ObjetRequeteJSON.js');const Requetes=require('CollectionRequetes.js');class ObjetRequeteSaisieAccepterReglement extends ObjetRequeteSaisie{constructor(...aParams){super(...aParams);}
lancerRequete(aParams){$.extend(this.JSON,aParams);return this.appelAsynchrone();}
actionApresRequete(){this.callbackReussite.appel();}}
Requetes.inscrire('SaisieAccepterReglement',ObjetRequeteSaisieAccepterReglement);module.exports=ObjetRequeteSaisieAccepterReglement;},fn:"objetrequetesaisieaccepterreglement.js"});;
IE.fModule({f:function(exports,require,module,global){require('Produit/Css/general/Fiche-Etablissement.css');const ObjetIdentite_Mobile=require('ObjetIdentite_Mobile.js');const ObjetMoteurFicheEtablissement=require('ObjetMoteurFicheEtablissement.js');const GTraductions=require('ObjetTraduction.js');const{GObjetWAI,EGenreAttribut}=require('ObjetWAI.js');const ObjetListeElements=require('ObjetListeElements.js');const EGenreEspace=require('Enumere_Espace.js');const MethodesTableau=require('MethodesTableau.js');const ObjetRequeteSaisieAccepterReglement=require('ObjetRequeteSaisieAccepterReglement.js');class ObjetPanelFicheEtablissement_Mobile extends ObjetIdentite_Mobile{constructor(...aParams){super(...aParams);this.moteurEtablissement=new ObjetMoteurFicheEtablissement({estSurMobile:true,avecReglementAAccepter:MethodesTableau.existe(GEtatUtilisateur.GenreEspace,[EGenreEspace.Parent,EGenreEspace.Eleve,EGenreEspace.Mobile_Parent,EGenreEspace.Mobile_Eleve,EGenreEspace.PrimParent,EGenreEspace.Mobile_PrimParent,EGenreEspace.PrimEleve,EGenreEspace.Mobile_PrimEleve])});}
getControleur(aInstance){return $.extend(true,super.getControleur(this),{btnFermer:{event:function(){aInstance.options.closeSideNav();}},accepterReglement:{getValue:function(){return aInstance.etablissement.relancerNotif;},setValue:function(aValue){aInstance.etablissement.relancerNotif=true;new ObjetRequeteSaisieAccepterReglement(this,this.ActionSurValidation).lancerRequete({accepterReglement:aValue,etablissement:aInstance.etablissement});},getDisabled:function(){return aInstance.etablissement.relancerNotif;}},surSelection:function(I){$(this.node).on('click',function(){aInstance.indiceEtablissementAffiche=I;_afficherPage.call(aInstance);});}});}
SetDonnees(aParams){var lListeEtab=new ObjetListeElements();if(MethodesTableau.existe(GEtatUtilisateur.GenreEspace,[EGenreEspace.Mobile_Parent,EGenreEspace.Mobile_Accompagnant,EGenreEspace.Mobile_PrimParent,EGenreEspace.Mobile_PrimAccompagnant])){lListeEtab.add(aParams.listeInformationsEtablissements.GetElementParNumero(GEtatUtilisateur.getMembre().Etablissement.GetNumero()));} else{lListeEtab=aParams.listeInformationsEtablissements;}
this.listeEtablissements=new ObjetListeElements();if(lListeEtab){for(var i=0,lNbr=lListeEtab.GetNbrElements();i<lNbr;i++){if(lListeEtab.GetElement(i).avecInformations){this.listeEtablissements.add(lListeEtab.GetElement(i));}}}
if(this.listeEtablissements.GetNbrElements()){this.indiceEtablissementAffiche=0;_afficherPage.call(this);}}}
function _afficherPage(){var H=[];var lClass,lEtablissement,i;if(this.listeEtablissements){var lNbrEtablissement=this.listeEtablissements.GetNbrElements();H.push('<div class="navheader header-titre">','<ie-btnimage ie-model="btnFermer" class="icon_retour_mobile btnImageIcon"',GObjetWAI.composeAttribut({genre:EGenreAttribut.label,valeur:GTraductions.getValeur('Fermer')}),'></ie-btnimage>','<div class="Gras">',GTraductions.getValeur('FicheEtablissement.ContacterEtablissement'),'</div>','</div>');H.push('<div>');H.push('<div class="fiche-etablissement onglet">');for(i=0;i<lNbrEtablissement;i++){lClass=this.indiceEtablissementAffiche===i?'selectionne':'';H.push('<div class="'+lClass+' Espace Gras AvecMain" ie-node="surSelection('+i+')">',this.listeEtablissements.GetElement(i).GetLibelle()?this.listeEtablissements.GetElement(i).GetLibelle():GTraductions.getValeur('FicheEtablissement.Etablissement'),'</div>');}
H.push('</div>');lEtablissement=this.listeEtablissements.GetElement(this.indiceEtablissementAffiche);this.etablissement=lEtablissement;H.push('<div class="fiche-etablissement informations GrandEspaceHaut GrandEspaceGauche">');H.push(this.moteurEtablissement.composeInformations(lEtablissement));H.push('</div>');H.push('</div>');}
this.Afficher(H.join(''));}
module.exports=ObjetPanelFicheEtablissement_Mobile;},fn:"objetpanelficheetablissement_mobile.js"});;
IE.fModule({f:function(exports,require,module,global){const{Invocateur}=require('Invocateur.js');const MethodesObjet=require('MethodesObjet.js');const GHtml=require('GHtml.js');const GTraductions=require('ObjetTraduction.js');const ObjetListeElements=require('ObjetListeElements.js');const EGenreEspace=require('Enumere_Espace.js');const EGenreOnglet=require('Enumere_Onglet.js');const _ObjetAffichagePageMenuOnglets=require('_InterfacePageMenuOnglets.js');const GChaine=require('GChaine.js');const{TypeDroits}=require('ObjetDroitsPN.js');const UtilitaireContactVieScolaire_Mobile=require('UtilitaireContactVieScolaire_Mobile.js');const ActionneurCentraleNotificationsSco=require('ActionneurCentraleNotificationsSco.js');const ObjetDonneesCentraleNotifications=require('ObjetDonneesCentraleNotifications.js');const ObjetPanelFicheEtablissement_Mobile=require('ObjetPanelFicheEtablissement_Mobile.js');const UtilitaireSideNav=require('UtilitaireSideNav.js');const{GDate}=require('ObjetDate.js');const Identite=require('ObjetIdentite.js');const ObjetDiscussion_Mobile=require('ObjetDiscussion_Mobile.js');const TUtilitaireMessagerie=require('UtilitaireMessagerie.js');const tag=require('tag.js');const TypeGenreStatutConnexion=require('TypeStatutConnexion.js').TypeGenreStatutConnexion;const MoteurMessagerie=require('MoteurMessagerie.js');class ObjetAffichagePageMenuOnglets extends _ObjetAffichagePageMenuOnglets{constructor(...aParams){super(...aParams);this.idNotifInfo=this.Nom+'_NotifInfo';this.idNotifComm=this.Nom+'_NotifComm';this._cacheNbNotificationsOnglets={};Invocateur.abonner(ObjetDonneesCentraleNotifications.typeNotif.surModification,function(aDonnees){_actualiserBadge.call(this,aDonnees);},this);this.logoDepartementImage=GParametres.logoDepartementImage;this.logoDepartementLien=GParametres.logoDepartementLien;this.donneesCentraleNotifications=GApplication.donneesCentraleNotifications;Invocateur.abonner('ouvrir_ficheEtab',function(){UtilitaireSideNav.createComplet(ObjetPanelFicheEtablissement_Mobile,{pere:this,start:function(aInstanceFiche){aInstanceFiche.SetDonnees({listeInformationsEtablissements:GEtatUtilisateur.listeInformationsEtablissements});}});},this);}
getControleur(aInstance){return $.extend(true,super.getControleur(this),{btnAlertesPPMSEnCours:{event:function(){GInterface.fermerMenuOnglet();UtilitaireContactVieScolaire_Mobile.afficherAlertePPMS();},getHtml:function(){return aInstance.composeBadgeBtn(UtilitaireContactVieScolaire_Mobile.listeAlertePPMSEnCours.GetNbrElements(),GTraductions.getValeur('Messagerie.AlerteEnseignantsPersonnels'));},afficher:function(){return UtilitaireContactVieScolaire_Mobile.listeAlertePPMSEnCours&&UtilitaireContactVieScolaire_Mobile.listeAlertePPMSEnCours.GetNbrElements()>0;}},btnAlertesPPMSCreation:{event:function(){GInterface.fermerMenuOnglet();UtilitaireContactVieScolaire_Mobile.creerAlertePPMS();},afficher:function(){return GApplication.droits.get(TypeDroits.communication.lancerAlertesPPMS);}},btnMessageInstant:{event:function(){GInterface.fermerMenuOnglet();UtilitaireContactVieScolaire_Mobile.demarrerMessageInstantane();},getHtmlBtnMessageInstant:function(){var lHtml=aInstance.composeBadgeBtn(aInstance.donneesCentraleNotifications.nbConversationEnCours,GTraductions.getValeur('Messagerie.EnvoiMessageInstantane'));if(GApplication.donneesCentraleNotifications.nbConversationEnCours===0){lHtml+=tag('i',{class:['as-tag','TypeGenreStatutConnexion-double-icone',TypeGenreStatutConnexion.getClassIcon(GApplication.donneesCentraleNotifications.statutConnexionCommunication)]});}
return lHtml;},afficher:function(){return GApplication.droits.get(TypeDroits.communication.avecMessageInstantane);}},ajouterAbsence:{event:function(){GEtatUtilisateur.setPage({Onglet:EGenreOnglet.VieScolaire_Recapitulatif,executerSaisieAbsenceParent:true,retourAccueil:GEtatUtilisateur.getGenreOnglet()===EGenreOnglet.Accueil});if(GEtatUtilisateur.getGenreOnglet()){GInterface.evenementPageMobile({genreOnglet:EGenreOnglet.Accueil,genreOngletDest:EGenreOnglet.VieScolaire_Recapitulatif});}}},btnMessageCarnet:{event:function(){GInterface.fermerMenuOnglet();var lEleve=GEtatUtilisateur.getMembre();var lListeDestinataires=TUtilitaireMessagerie.getListeDestCarnetLiaisonDEleve_PrimParent(lEleve.GetNumero());var lMessage={listeDestinataires:lListeDestinataires,estCreationCarnetLiaison:true};var lMoteurMessagerie=new MoteurMessagerie().setOptions({instance:this,estChat:false,avecPJ:false});var lAffDiscussion=Identite.creerInstance(ObjetDiscussion_Mobile,{pere:this,moteurMessagerie:lMoteurMessagerie});lAffDiscussion.setOptions({estSidePanel:true,estSidePanelAvecMenu:true,estChat:false,avecPJ:false,callbackEnvoyer:function(){lAffDiscussion.masquer();}}).setDonnees({message:MethodesObjet.dupliquer(lMessage),creationDiscussion:true,estPrimParentSurEtiquetteCL:true,listeDestinatairesCarnetLiaison:lListeDestinataires,eleveCarnetLiaison:lEleve,titre:GTraductions.getValeur('MessagerieCarnetLiaison.TitreFenetreNouveauPourLEleve',[lEleve.GetLibelle()])});}},nodeFicheEtablissement:function(){$(this.node).on('click',function(){GInterface.fermerMenuOnglet();Invocateur.evenement('ouvrir_ficheEtab');});},nodeStopCovid:function(){$(this.node).on('click',function(){window.open(GParametres.urlStopCovid);});}});}
traiterListeRessource(){this.listeRessources=GInterface.getListeRessources();if(this.listeRessources.GetNbrElements()>1){for(var i=0;i<this.listeRessources.GetNbrElements();i++){this.listeRessources.GetElement(i).sousTitre=this.listeRessources.GetElement(i).Classe.GetLibelle();}}}
actionSurRecupererDonnees(){var i;this.listeOnglets=new ObjetListeElements();this.listeOngletsTraitee=new ObjetListeElements();if(GEtatUtilisateur.listeOnglets.GetNbrElements()>0){for(i=0;i<GEtatUtilisateur.listeOnglets.GetNbrElements();i++){var lElement=GEtatUtilisateur.listeOnglets.GetElement(i);if(lElement.Actif){this.listeOnglets.AddElement(lElement);if(lElement.GetLibelle().search(/<br\s?\/?>/gi)> -1){lElement.SetLibelle(lElement.GetLibelle().replace(/<br\s?\/?>/gi,' '));}
lElement.sousTitre='';lElement.imagePosition="left";switch(lElement.GetGenre()){case EGenreOnglet.EmploiDuTemps:lElement.imagePerso="icon_calendar";break;case EGenreOnglet.EmploiDuTempsClasse:lElement.imagePerso="icon_calendar";break;case EGenreOnglet.CDT_TAF:lElement.imagePerso="icon_taf";break;case EGenreOnglet.CDT_Contenu:lElement.imagePerso="icon_contenu_cours";break;case EGenreOnglet.ManuelsNumeriques:lElement.imagePerso="icon_book";break;case EGenreOnglet.ReleveDeCompetences:case EGenreOnglet.Bulletins:case EGenreOnglet.BulletinCompetences:case EGenreOnglet.BulletinAnneesPrec_Note:case EGenreOnglet.BulletinAnneesPrec_Competence:lElement.imagePerso="icon_bulletin";break;case EGenreOnglet.EquipePedagogique:lElement.imagePerso="icon_groupes_accompagnement_personnalise ";break;case EGenreOnglet.Releve:lElement.imagePerso="icon_releve_notes";break;case EGenreOnglet.Menus:lElement.imagePerso="icon_food";break;case EGenreOnglet.SaisieAbsences_AppelEtSuivi:lElement.imagePerso="icon_feuille_appel";break;case EGenreOnglet.GeneralVieEtablissement:break;case EGenreOnglet.Informations:lElement.imagePerso="icon_infos_sondages";lElement.idNotif=this.idNotifInfo;break;case EGenreOnglet.Messagerie:lElement.imagePerso="icon_comments";lElement.idNotif=this.idNotifComm;break;case EGenreOnglet.Incidents:lElement.imagePerso="icon_bolt";break;case EGenreOnglet.ListeEleves:lElement.imagePerso="icon_uniF2BC";break;case EGenreOnglet.Agenda:lElement.imagePerso="icon_calendar_empty";break;case EGenreOnglet.Rencontre:lElement.imagePerso="icon_projet_accompagnement";break;case EGenreOnglet.DernieresNotes:lElement.imagePerso="icon_notes_etoile";break;case EGenreOnglet.DernieresEvaluations:lElement.imagePerso="icon_dernieres_evals";break;case EGenreOnglet.VieScolaire_Recapitulatif:lElement.imagePerso="icon_vs";break;case EGenreOnglet.TableauDeBord:lElement.imagePerso='icon_th_large';break;case EGenreOnglet.SaisieNotes:lElement.imagePerso='icon_releve_notes';break;case EGenreOnglet.SaisieCahierDeTextes:lElement.imagePerso='icon_saisie_cahier_texte';break;case EGenreOnglet.InfosPerso:lElement.imagePerso='icon_th_large';break;case EGenreOnglet.ParametresUtilisateur:lElement.imagePerso='icon_th_large';break;case EGenreOnglet.CompteEleve:lElement.imagePerso='icon_th_large';break;case EGenreOnglet.DocumentsATelecharger:lElement.imagePerso='icon_th_large';break;case EGenreOnglet.SaisieOrientation:lElement.imagePerso='icon_th_large';break;default:}}}
this.afficherListe();}}
evenementSelectionRessource(aGenreEvenement,aElement){GEtatUtilisateur.SetNumeroEleve(aElement.GetNumero());this.actionSurRecupererDonnees();this.evenementListeOnglets(GEtatUtilisateur.getGenreOnglet());}
getInfosComboMembre(aMembre){const lLibelleClasse=(aMembre&&aMembre.Classe)?aMembre.Classe.GetLibelle():'';var lHtmlPhoto=[];if(aMembre&&aMembre.avecPhoto){var lUrlPhoto=GChaine.creerUrlBruteLienExterne(aMembre,{libelle:'photo.jpg'});lHtmlPhoto.push('<img src="',lUrlPhoto,'" style="width:100%;" onerror="$(this).remove();"  alt="',aMembre.GetLibelle(),'"/>');}
return{libelle:aMembre.GetLibelle()+' '+(lLibelleClasse?''+'('+lLibelleClasse+')':''),photo:lHtmlPhoto.join('')};}
actualiserTitre(){if(GEtatUtilisateur.derniereConnexion){var lDerniereConnexion=GTraductions.getValeur('accueil.PrecedenteConnection',[
GDate.FormatDate(GEtatUtilisateur.derniereConnexion,'%JJJ %JJ %MMM'),GDate.FormatDate(GEtatUtilisateur.derniereConnexion,'%hh%sh%mm')
]);GHtml.setHtml(this.idDerniereConnexion,lDerniereConnexion);}}
getEspaceIcone(){var lEspaceIcone='';switch(GApplication.acces.genreEspace){case EGenreEspace.Mobile_Eleve:lEspaceIcone='photoEspaceEtudiant';break;case EGenreEspace.Mobile_Professeur:lEspaceIcone='photoEspaceEnseignant';break;case EGenreEspace.Mobile_PrimProfesseur:lEspaceIcone='photoEspaceEnseignant';break;case EGenreEspace.Mobile_Parent:lEspaceIcone='photoEspaceParent';break;case EGenreEspace.Mobile_PrimParent:lEspaceIcone='photoEspaceParent';break;case EGenreEspace.Mobile_Etablissement:lEspaceIcone='photoEspaceVS';break;case EGenreEspace.Mobile_Administrateur:lEspaceIcone='photoEspaceDirection';break;case EGenreEspace.Mobile_Accompagnant:lEspaceIcone='photoEspaceVS';break;case EGenreEspace.Mobile_PrimAccompagnant:lEspaceIcone='photoEspaceVS';break;case EGenreEspace.Mobile_Tuteur:lEspaceIcone='photoEspaceVS';break;}
return lEspaceIcone;}
getGenreOngletAccueil(){return EGenreOnglet.Accueil;}
changementRessource(){this.evenementListeOnglets(false);}
seDeconnecterAppliMobile(){}
composeOngletMobileApp(){return'';}
composeBoutonMenuSupp(){var H=[];if(GApplication.droits.get(TypeDroits.communication.estDestinataireChat)){H.push('<ie-btnimage class="icon_alerte_ppms btnImageIcon badged-btn icon-title" title="',GTraductions.getValeur('Mobile.Menu.Alertes'),'" ie-model="btnAlertesPPMSEnCours" ie-html="getHtml" ie-if="afficher"></ie-btnimage>');}
H.push(this.composeBoutonCentraleNotif());var lAvecSep=false;if(GApplication.droits.get(TypeDroits.communication.estDestinataireChat)){H.push('<hr />');lAvecSep=true;H.push('<ie-btnimage class="icon_conversation_cours btnImageIcon badged-btn icon-title" title="',GTraductions.getValeur('Mobile.Menu.Chatter'),'" ie-model="btnMessageInstant" ie-if="afficher" ie-html="getHtmlBtnMessageInstant"></ie-btnimage>');H.push('<ie-btnimage class="icon_alerte_ppms btnImageIcon badged-btn icon-title" ie-model="btnAlertesPPMSCreation" title="',GTraductions.getValeur('Mobile.Menu.Alerter'),'" ie-if="afficher">','<span class="WAI_hidden">',GTraductions.getValeur('Messagerie.AlerteEnseignantsPersonnels'),'</span>','</ie-btnimage>');}
if(GEtatUtilisateur.GenreEspace===EGenreEspace.Mobile_PrimParent&&GEtatUtilisateur.Identification.ListeRessources&&GEtatUtilisateur.Identification.ListeRessources.GetNbrElements()>0){if(!lAvecSep){H.push('<hr />');lAvecSep=true;}
H.push('<ie-btnimage class="icon_carnet_liaison mix-icon_plus i-top-spe i-large btnImageIcon badged-btn icon-title" title="',GTraductions.getValeur('Mobile.Menu.Ecrire'),'" ie-model="btnMessageCarnet"></ie-btnimage>');}
if(GEtatUtilisateur.GenreEspace===EGenreEspace.Mobile_PrimParent&&GApplication.droits.get(TypeDroits.absences.avecDeclarerUneAbsence)){if(!lAvecSep){H.push('<hr />');lAvecSep=true;}
H.push('<ie-btnimage class="icon_absences_prevue btnImageIcon badged-btn icon-title" title="',GTraductions.getValeur('Mobile.Menu.Prevenir'),'" ie-model="ajouterAbsence"></ie-btnimage>');}
if(GEtatUtilisateur.avecFicheEtablissement()){if(!lAvecSep){H.push('<hr />');lAvecSep=true;}
H.push('<ie-btnimage class="icon_uniF2C3 btnImageIcon badged-btn icon-title" ie-node="nodeFicheEtablissement" title="',GTraductions.getValeur('Mobile.Menu.Contact'),'"  aria-label="',GTraductions.getValeur('FicheEtablissement.ContacterEtablissement'),'">','<span class="WAI_hidden">',GTraductions.getValeur('FicheEtablissement.ContacterEtablissement'),'</span>','</ie-btnimage>');}
if(GParametres.urlStopCovid){H.push('<ie-btnimage class="btnImageIcon Image_StopCovid" ie-node="nodeStopCovid"></ie-btnimage>');}
return H.join('');}
getActionneurCentraleNotification(){return new ActionneurCentraleNotificationsSco({estMobile:true});}}
function _actualiserBadge(aDonnees){[EGenreOnglet.Messagerie,EGenreOnglet.Informations].forEach(function(aGenreOnglet){var lSelecteur='';switch(aGenreOnglet){case EGenreOnglet.Messagerie:lSelecteur="#"+this.idNotifComm.escapeJQ();break;case EGenreOnglet.Informations:lSelecteur="#"+this.idNotifInfo.escapeJQ();break;default:;return;}
var lNombre=aDonnees.compteurNotifsParOnglet?aDonnees.compteurNotifsParOnglet[aGenreOnglet].nb||0:0;$(lSelecteur).find('.as-tag').remove();if(lNombre>0){$(lSelecteur).append('<span class="as-tag">'+(lNombre>999?'999+':lNombre)+'</span>');}}.bind(this));}
module.exports=ObjetAffichagePageMenuOnglets;},fn:"interfacepagemenuonglets.js"});;
IE.fModule({f:function(exports,require,module,global){const{GDate}=require('ObjetDate.js');const ObjetIdentite_Mobile=require('ObjetIdentite_Mobile.js');const GTraductions=require('ObjetTraduction.js');const EGenreDirectionSlide=require('EGenreDirectionSlide.js');const UtilitaireEDTJournalier=require('UtilitaireEDTJournalier.js');const tag=require('tag.js');require('WidgetEdtJournalier.css');class ObjetCours_Mobile extends ObjetIdentite_Mobile{constructor(...aParams){super(...aParams);this.baseprogressionId=this.Nom+'_progression';this.dateActive=null;this.callbackPopup=null;this.options={estCoursVisible:null,forcerClickCours:false,avecTrouEDT:true};}
setOptions(aOptions){Object.assign(this.options,aOptions);return this;}
getControleur(aInstance){return $.extend(true,super.getControleur(this),{getNodeCours:function(aIndex,aIndexMS){$(this.node).on('click',function(){let lCours=aInstance.listeCoursFormate.GetElement(aIndex);if(aIndexMS>=0&&lCours&&lCours.listeCours){lCours=lCours.listeCours.GetElement(aIndexMS);if(aInstance.options.forcerClickCours===true){UtilitaireEDTJournalier.fermerFenetreCours.call(aInstance);}}
;if(lCours.listeCours){UtilitaireEDTJournalier.popupCoursMultiple(aInstance,lCours,{indexCours:aIndex,indexCoursMultiple:aIndexMS,forcerClickCours:aInstance.options.forcerClickCours});} else{if(lCours&&lCours.coursOriginal){aInstance.callback.appel(lCours.coursOriginal);}}});},getNodeVisioCours:function(aNumeroCours,aIndexCours){$(this.node).on('click',function(){const lCours=aInstance.listeCoursFormate.GetElement(aIndexCours);if(lCours&&lCours.coursOriginal){let lCopieCours=lCours.coursOriginal;if(lCours.coursOriginal.coursMultiple){lCopieCours=lCours.coursOriginal.listeCours.GetElementParNumero(aNumeroCours);}
UtilitaireEDTJournalier.surClicVisioCours(lCopieCours);}});}});}
SetDonnees(aParams){if(aParams.listeCours){this.listeCours=aParams.listeCours;}
if(aParams.absences){this.absences=aParams.absences;}
if(aParams.joursStage){this.joursStage=aParams.joursStage;}
if(aParams.avecCoursAnnule){this.avecCoursAnnule=aParams.avecCoursAnnule;}
if(aParams.callbackPopup){this.callbackPopup=aParams.callbackPopup;}
this.avecIconeAppel=aParams.avecIconeAppel;var lSensInverse=!this.dateActive||GDate.estDateEgale(aParams.date,this.dateActive)?EGenreDirectionSlide.Aucune:(aParams.date<this.dateActive?EGenreDirectionSlide.Droite:EGenreDirectionSlide.Gauche);this.dateActive=aParams.date;this.numeroSemaine=aParams.numeroSemaine;this.disponibilites=aParams.disponibilites;this.debutDemiPensionHebdo=aParams.debutDemiPensionHebdo;this.finDemiPensionHebdo=aParams.finDemiPensionHebdo;this.Afficher(null,lSensInverse);}
slideProgression(aPositionCours){$("#"+(this.baseprogressionId+aPositionCours).escapeJQ()).toggleClass('progDiv-open');}
ConstruireAffichage(){if(!this.listeCours){return'';}
var lHtml=[];var lObjetCours={};lHtml.push(_composeEDTJournalier.call(this));if(lObjetCours.legendeDispenses){lObjetCours.legendeDispenses.forEach(function(aLegende,aIndex){lHtml.push('<div>','(',aIndex+1,') ',aLegende,'</div>');});}
if(this.listeCoursFormate===undefined||this.listeCoursFormate.GetNbrElements()===0){lHtml=[this.composeAucuneDonnee(GTraductions.getValeur('Mobile.AucunCours'))];}
return lHtml.join('');}
DeclencherEvenement(aNumeroCours){this.callback.appel(this.listeCours.GetElementParNumero(aNumeroCours));}}
function _composeEDTJournalier(){const lParams={listeCours:this.listeCours,date:this.dateActive,absences:this.absences,joursStage:this.joursStage,avecTrouEDT:this.options.avecTrouEDT,disponibilites:this.disponibilites,debutDemiPensionHebdo:this.debutDemiPensionHebdo,finDemiPensionHebdo:this.finDemiPensionHebdo,avecIconeAppel:this.avecIconeAppel};const lDonnees=UtilitaireEDTJournalier.formaterDonnees(lParams);this.listeCoursFormate=lDonnees.listeDonnees;const H=[];if(this.listeCoursFormate){H.push(tag('h3',{class:'text-center ie-titre-couleur-lowercase m-top'},UtilitaireEDTJournalier.getTitreSemaine(this.numeroSemaine)));H.push(lDonnees.soustitre?tag('h4',{class:['text-center ie-sous-titre',lDonnees.soustitre.type]},lDonnees.soustitre.libelle):'');H.push('<ul class="liste-cours m-top-l" role="list">');this.listeCoursFormate.parcourir((aCours,aIndex) =>{H.push(UtilitaireEDTJournalier.composeCours.call(this,aCours,{indexCours:aIndex,forcerClickCours:true}));});H.push('</ul>');}
return H.join('');}
module.exports=ObjetCours_Mobile;},fn:"objetcours_mobile.js"});;
IE.fModule({f:function(exports,require,module,global){const{ObjetRequeteConsultation}=require('ObjetRequeteJSON.js');const Requetes=require('CollectionRequetes.js');class ObjetRequeteRessourceEDT extends ObjetRequeteConsultation{constructor(...aParams){super(...aParams);}
lancerRequete(){return this.appelAsynchrone();}
actionApresRequete(){this.callbackReussite.appel(this.JSONReponse);}}
Requetes.inscrire('RessourceEDT',ObjetRequeteRessourceEDT);module.exports=ObjetRequeteRessourceEDT;},fn:"objetrequeteressourceedt.js"});;
IE.fModule({f:function(exports,require,module,global){const{ObjetRequeteConsultation}=require('ObjetRequeteJSON.js');const Requetes=require('CollectionRequetes.js');const ObjetDeserialiser=require('ObjetDeserialiser.js');class ObjetRequetePageEmploiDuTemps extends ObjetRequeteConsultation{constructor(...aParams){super(...aParams);}
lancerRequete(aParametres){this.JSON=$.extend({ressource:undefined,listeRessources:undefined,numeroSemaine:undefined,dateDebut:undefined,dateFin:undefined,ignorerHeures:undefined,domaine:undefined,matiere:undefined,niveau:undefined,dossierProgression:undefined,elementProgression:undefined,avecAbsencesEleve:false,avecConseilDeClasse:false,estEDTPermanence:false,estEDTAnnuel:undefined,avecAbsencesRessource:undefined,avecCoursSortiePeda:undefined,avecDisponibilites:undefined,avecRessourcesLibrePiedHoraire:undefined},aParametres);if(aParametres.ressource){this.JSON.Ressource=aParametres.ressource;}
if(this.JSON.listeRessources){this.JSON.listeRessources.setSerialisateurJSON({ignorerEtatsElements:true});}
if((aParametres.domaine!==null&&aParametres.domaine!==undefined)){this.JSON.Domaine=aParametres.domaine;} else if((aParametres.numeroSemaine!==null&&aParametres.numeroSemaine!==undefined)){this.JSON.NumeroSemaine=aParametres.numeroSemaine;} else if(!aParametres.estEDTAnnuel){this.JSON.DateDebut=aParametres.dateDebut;this.JSON.ignorerHeures=aParametres.ignorerHeures;if((aParametres.dateFin!==null&&aParametres.dateFin!==undefined)){this.JSON.DateFin=aParametres.dateFin;}}
return this.appelAsynchrone();}
actionApresRequete(){this.JSONReponse.listeCours=new ObjetDeserialiser().listeCours(this.JSONReponse);this.callbackReussite.appel(this.JSONReponse);}}
Requetes.inscrire('PageEmploiDuTemps',ObjetRequetePageEmploiDuTemps);module.exports=ObjetRequetePageEmploiDuTemps;},fn:"objetrequetepageemploidutemps.js"});;
IE.fModule({f:function(exports,require,module,global){const{ObjetRequeteConsultation}=require('ObjetRequeteJSON.js');const Requetes=require('CollectionRequetes.js');class ObjetRequetePageEmploiDuTemps_DomainePresence extends ObjetRequeteConsultation{constructor(...aParams){super(...aParams);}
lancerRequete(aRessource){this.JSON.Ressource=aRessource;return this.appelAsynchrone();}
actionApresRequete(){this.callbackReussite.appel(this.JSONReponse.Domaine,this.JSONReponse.joursPresence);}}
Requetes.inscrire('PageEmploiDuTemps_DomainePresence',ObjetRequetePageEmploiDuTemps_DomainePresence);module.exports=ObjetRequetePageEmploiDuTemps_DomainePresence;},fn:"objetrequetepageemploidutemps_domainepresence.js"});;
IE.fModule({f:function(exports,require,module,global){module.exports=function(aParams){require('produit/css/DetailSortiePedagogique.css');const GTraductions=require('ObjetTraduction.js');var H='';H+='<div class="DetailSortiePedagogique AvecSelectionTexte">';H+='<table class="dsp_champs">';H+='<tr>';H+='<td>'+aParams.strGenreRess+' :</td>';H+='<td>'+aParams.strRess+'</td>';H+='</tr>';H+='<tr>';H+='<td>';H+=GTraductions.getValeur('EDT.AbsRess.Motif');H+=' :</td>';H+='<td>'+aParams.motif+'</td>';H+='</tr>';H+='<tr>';H+='<td>';H+=GTraductions.getValeur('EDT.AbsRess.Date');H+=' :</td>';H+='<td>'+aParams.strDate+'</td>';H+='</tr>';H+='<tr>';H+='<td>';H+=GTraductions.getValeur('EDT.AbsRess.Duree');H+=' :</td>';H+='<td>'+aParams.duree+'</td>';H+='</tr>';H+='<tr>';H+='<td>';H+=GTraductions.getValeur('EDT.AbsRess.Accompagnateurs');H+=' :</td>';H+='<td>'+aParams.accompagnateurs+'</td>';H+='</tr>';H+='</table>';if(aParams.avecMemoVisible){H+='<div class="dsp_Memo">';H+='<div class="dsp_titreMemo">';H+=GTraductions.getValeur('EDT.AbsRess.TitreMemoAbsence');H+='</div>';H+='<div>'+aParams.getMemo()+'</div>';H+='</div>';}
H+='</div>';return H;};},fn:"detailsortiepedagogique.htmlmodele.js"});;
IE.fModule({f:function(exports,require,module,global){const GTraductions=require('ObjetTraduction.js');const{GDate}=require('ObjetDate.js');const ObjetFenetre=require('ObjetFenetre.js');const GChaine=require('_ObjetChaine.js').GChaine;function UtilitaireEDTSortiePedagogique(){}
UtilitaireEDTSortiePedagogique.strDate=function(aAbs){if(!aAbs){return'';}
if(aAbs.strDateFin){return aAbs.strDateDebut+' '+aAbs.strDateFin;}
return GTraductions.getValeur('Le')+' '+GDate.FormatDate(aAbs.DateDuCours,'%JJ/%MM')+' '+aAbs.strDateDebut;};UtilitaireEDTSortiePedagogique.afficherFenetreSortiePeda=function(aParams){const lParams=Object.assign({pere:null,cours:null,idCours:'',surFermerFenetre:null},aParams);const lFenetre=ObjetFenetre.creerInstance(ObjetFenetre,{pere:lParams.pere},{titre:GChaine.Insecable(GTraductions.getValeur('EDT.AbsRess.SortiePedagogique')+' '+UtilitaireEDTSortiePedagogique.strDate(lParams.cours)),modale:false,listeBoutons:[GTraductions.getValeur('Fermer')],idPositionnement:lParams.idCours,callbackApresFermer:function(){if(lParams.surFermerFenetre){lParams.surFermerFenetre(lFenetre);}
this.fenetre_SortiePedagogique=null;}});lFenetre.Afficher(require('DetailSortiePedagogique.htmlmodele.js')({strGenreRess:lParams.cours.strGenreRess,strRess:lParams.cours.strRess,motif:lParams.cours.motif,strDate:UtilitaireEDTSortiePedagogique.strDate(lParams.cours),duree:GDate.formatDureeEnPlaces(lParams.cours.dureeReelle),accompagnateurs:lParams.cours.accompagnateurs.join(', '),avecMemoVisible:lParams.cours.memo!==undefined,getMemo:function(){return lParams.cours.memo?'<div class="dsp_texteMemo" ie-scroll><div>'+GChaine.ToHTML(lParams.cours.memo)+'</div></div>':'';}}));return lFenetre;};module.exports=UtilitaireEDTSortiePedagogique;},fn:"utilitaireedtsortiepedagogique.js"});;
IE.fModule({f:function(exports,require,module,global){const TypeEnsembleNombre=require('TypeEnsembleNombre.js');const EGenreRessource=require('Enumere_Ressource.js');const MethodesObjet=require('MethodesObjet.js');const{GDate}=require('ObjetDate.js');function UtilitairePrefsGrilleStructure(){}
UtilitairePrefsGrilleStructure.modeles={defaut:-1,perso:-2};UtilitairePrefsGrilleStructure.getGenreRessource=function(aRessources){var lGenreRessource=null;if(aRessources&&aRessources.GetNbrElements()>0){aRessources.parcourir(function(aRessource){var lGenreRessourceCourante=aRessource.GetGenre();if(GEtatUtilisateur.pourPrimaire()&&(lGenreRessourceCourante===EGenreRessource.Groupe||lGenreRessourceCourante===EGenreRessource.Eleve)){lGenreRessourceCourante=EGenreRessource.Classe;}
if(lGenreRessource===null){lGenreRessource=lGenreRessourceCourante;} else if(lGenreRessource!==lGenreRessourceCourante){lGenreRessource=null;return false;}});}
return lGenreRessource;};UtilitairePrefsGrilleStructure.getPrefsGrille=function(aGenreRessource,aEstPlanning,aNumeroEtablisssement){var lPrefs;var lNumeroModele=UtilitairePrefsGrilleStructure.modeles.defaut;var lGenreRessource=aGenreRessource&&aGenreRessource.GetNbrElements?UtilitairePrefsGrilleStructure.getGenreRessource(aGenreRessource):aGenreRessource;if(lGenreRessource!==null&&lGenreRessource!==EGenreRessource.Aucune){lPrefs=GApplication.parametresUtilisateur.get(UtilitairePrefsGrilleStructure.getCleModelePrefsGrille(aGenreRessource,aEstPlanning));if(lPrefs&&lPrefs.joursOuvres){lNumeroModele=lPrefs.modele;}}
if(lNumeroModele===UtilitairePrefsGrilleStructure.modeles.perso){var lNbJours=IE.Cycles.indicesJoursOuvres().length;lPrefs.joursOuvres.items().forEach(function(aIndice){if(aIndice>=lNbJours){lPrefs.joursOuvres.remove(aIndice);}});return lPrefs;} else{lPrefs=null;var lNumeroEtablissement=null;if(lNumeroModele===UtilitairePrefsGrilleStructure.modeles.defaut){lNumeroEtablissement=aNumeroEtablisssement;} else{lNumeroEtablissement=lNumeroModele;}
if(GEtatUtilisateur.tabEtablissementsModeleGrille){GEtatUtilisateur.tabEtablissementsModeleGrille.forEach(function(aModeleEtab){if(aModeleEtab.numero===lNumeroEtablissement){lPrefs=aModeleEtab;return false;}});}
if(lPrefs){return lPrefs;}}
return UtilitairePrefsGrilleStructure.getPrefsGrilleDefaut();};UtilitairePrefsGrilleStructure.getPrefsGrilleDefaut=function(){var lJoursOuvres=new TypeEnsembleNombre();IE.Cycles.indicesJoursOuvres().forEach(function(aJour,aIndice){lJoursOuvres.add(aIndice);});return{placeDebut:0,placeFin:GParametres.PlacesParJour-1,nbPas:1,joursOuvres:lJoursOuvres};};UtilitairePrefsGrilleStructure.getCleModelePrefsGrille=function(aGenreRessource,aEstPlanning){return'EDT.Prefs.'+(aEstPlanning?1:0)+'.'+(aGenreRessource||EGenreRessource.Enseignant);};UtilitairePrefsGrilleStructure.getDomaineJoursOuvresDePrefsGrille=function(aPrefGrille){var lJoursOuvres=MethodesObjet.dupliquer(GParametres.JoursOuvres);if(!aPrefGrille){return lJoursOuvres;}
lJoursOuvres.getSemaines().forEach(function(aJour,aIndex){if(aPrefGrille.joursOuvres.items().indexOf(aIndex)<0){lJoursOuvres.SetValeur(false,aJour);}});return lJoursOuvres;};UtilitairePrefsGrilleStructure.getProchaineDateOuvreeDePrefsGrille=function(aDate,aPrefGrille){var lResult={date:aDate,trouve:false,dateChangee:false};if(!aPrefGrille){return lResult;}
while(!lResult.trouve&&GDate.estDateDansAnneeScolaire(lResult.date)){var lJourCycle=IE.Cycles.dateEnJourCycle(lResult.date);if(aPrefGrille.joursOuvres.indexOf(lJourCycle)<0){lResult.date=GDate.GetJourSuivant(lResult.date);lResult.dateChangee=true;} else{lResult.trouve=true;}}
return lResult;};module.exports=UtilitairePrefsGrilleStructure;},fn:"utilitaireprefsgrillestructure.js"});;
IE.fModule({f:function(exports,require,module,global){require('Produit/Css/ObjetBoutonFlottant.css');const Identite=require('ObjetIdentite.js');const GUID=require('GUID.js');class ObjetBoutonFlottant extends Identite{constructor(...aParams){super(...aParams);this.IdBouton=GUID.getId();_initOptionsBouton.call(this);this.iconeCommandeDefaut='icon_ellipsis_vertical';this.positionHorizontalDefaut="";this.positionVerticalDefaut="bottom";}
setOptionsBouton(aOptions){$.extend(this._optionsBouton,aOptions);}
getOptionsBouton(){return this._optionsBouton;}
Actualiser(lParam){if(!!lParam){this.setOptionsBouton(lParam);}
this.Afficher();}
getControleur(aInstance){return $.extend(true,super.getControleur(this),{nodeBtn:function(aIndex){const lBouton=aInstance._optionsBouton.listeBoutons[aIndex];if(!!lBouton){$(this.node).eventValidation(lBouton.callback);}},nodeBtnCommande:function(aIndexCommande,aIndex){const lBouton=aInstance._optionsBouton.listeBoutons[aIndexCommande].boutons[aIndex];if(!!lBouton){$(this.node).eventValidation(lBouton.callback);}}});}
ConstruireAffichage(){const lHtml=[];if(_validerListeBouton.call(this)){lHtml.push('<div class="floating-btn-position',_getClassPosition.call(this),(this._optionsBouton.fluid)?'fluid ':'',(this._optionsBouton.retractable)?'togglable ':'','">','<div class="float-global-conteneur">');lHtml.push(this.composeBoutons());lHtml.push('</div>','</div>');}
return lHtml.join('');}
composeUnSeulBouton(aBouton,aIndex){const lHtml=[];if(_validerParametreBouton(aBouton)){const aIdBtn=GUID.getId();lHtml.push('<input type="checkbox" id="',aIdBtn,'" class="on-off" />','<label for="',aIdBtn,'" id="',this.IdBouton,'" ie-node="nodeBtn(',aIndex,')" class="as-button ',(!!aBouton.disabled)?'disabled ':'',(aBouton.primaire)?'primary ':'','">','<i class="icon ',aBouton.icone,'"></i>','</label>');}
return lHtml.join('');}
composeBoutonCommande(aListeBouton,aIndexBoutonCommande){const lHtml=[];let lIdBtn=GUID.getId();lHtml.push('<input type="checkbox" id="',lIdBtn,'" class="on-off" />','<label for="',lIdBtn,'" class="as-button primary command',(!!aListeBouton.disabled)?' disabled':'',(this._optionsBouton.fluid)?' more':'','">','<i class="icon ',(aListeBouton.icone)?aListeBouton.icone:this.iconeCommandeDefaut,'"></i>','</label>','<ul class="sub-float-menu">');aListeBouton.boutons.forEach(function(aBouton,aIndex){if(_validerParametreBouton(aBouton)){lIdBtn=GUID.getId();lHtml.push('<li',(aBouton.callback)?'ie-node="nodeBtnCommande('+aIndexBoutonCommande+','+aIndex+')"':"",'"',(!!aBouton.disabled)?' class= "disabled "':'','">',(aBouton.libelle)?'<label>'+aBouton.libelle+'</label>':'','<i class="icon ',aBouton.icone,'"></i>','</li>');}});lHtml.push('</ul>');return lHtml.join('');}
composeBoutons(){const lHtml=[];const lInstance=this;this._optionsBouton.listeBoutons.forEach(function(aBouton,aIndex){if(!!aBouton.boutons&&aBouton.boutons.length>0){lHtml.push(lInstance.composeBoutonCommande(aBouton,aIndex));} else{lHtml.push(lInstance.composeUnSeulBouton(aBouton,aIndex));}});return lHtml.join(' ');}}
function _initOptionsBouton(){this._optionsBouton={fluide:false,retractable:false,position:{vertical:'bottom',horizontal:''},listeBoutons:[{primaire:false,icone:'icon_diffuser_information',callback:'',libelle:'',disabled:false,boutons:[{icone:'',callback:'',libelle:'',disabled:false}]}
]};}
function _getClassPosition(){const lHtml=[];const lHorizontal=(this._optionsBouton.position&&this._optionsBouton.position.horizontal)?this._optionsBouton.position.horizontal:this.positionHorizontalDefaut;const lVertical=(this._optionsBouton.position&&this._optionsBouton.position.vertical)?this._optionsBouton.position.vertical:this.positionVerticalDefaut;lHtml.push(lHorizontal?'h-'+lHorizontal:"");lHtml.push(lVertical?'v-'+lVertical:"");return lHtml.join(' ');}
function _validerListeBouton(){if(this._optionsBouton.listeBoutons.length===0){return false;} else if(!!this._optionsBouton.listeBoutons&&!Array.isArray(this._optionsBouton.listeBoutons)){return false;}
return true;}
function _validerParametreBouton(lBouton){if(!!lBouton.boutons&&!Array.isArray(lBouton.boutons)){return false;}
if(!lBouton.icone){return false;}
return true;}
module.exports=ObjetBoutonFlottant;},fn:"objetboutonflottant.js"});;
IE.fModule({f:function(exports,require,module,global){const{ObjetRequeteConsultation}=require('ObjetRequeteJSON.js');const Requetes=require('CollectionRequetes.js');class ObjetRequeteGenerationPDF extends ObjetRequeteConsultation{constructor(...aParams){super(...aParams);}
lancerRequete(aParametres,aOptionsPDF,aOptionsCloudCible){this.JSON={options:{}};this.cloudCible=aOptionsCloudCible;$.extend(this.JSON,aParametres);$.extend(this.JSON,{cloudcible:aOptionsCloudCible});$.extend(this.JSON.options,aOptionsPDF);return this.appelAsynchrone();}
actionApresRequete(){if(this.JSONReponse.OAuth2){this.callbackEchec.appel(this.JSONReponse);} else{this.callbackReussite.appel(this.JSONReponse);}}}
Requetes.inscrire('GenerationPDF',ObjetRequeteGenerationPDF);module.exports=ObjetRequeteGenerationPDF;},fn:"objetrequetegenerationpdf.js"});;
IE.fModule({f:function(exports,require,module,global){const ObjetRequeteGenerationPDF=require('ObjetRequeteGenerationPDF.js');const{Invocateur}=require('Invocateur.js');const GChaine=require('GChaine.js');const GTraductions=require('ObjetTraduction.js');const UtilitaireOAuth2=require('UtilitaireOAuth2.js');const GenerationPDF={};GenerationPDF.genererPDF=function(aParam){this.parametresSauvegardes=aParam;let lWindowPDF=null;const lParametresPDF=aParam.paramPDF;const lAvecProblemeOuvertureWindow=GNavigateur.isAndroid||GApplication.estAppliMobile;if((!lAvecProblemeOuvertureWindow)&&(aParam.cloudCible===null)){const EGenreMessageHtml=require('Enumere_MessageHtml.js').EGenreMessageHtml;const UtilitaireMessageHtml=require('Enumere_MessageHtml.js').UtilitaireMessageHtml;lWindowPDF=window.open(UtilitaireMessageHtml.construireUrl(EGenreMessageHtml.patiencePDF));}
if((aParam.cloudCible===null)||(aParam.cloudCible===undefined)){new ObjetRequeteGenerationPDF(this,_actionSurRequeteGenerationPDF.bind(this,lAvecProblemeOuvertureWindow,lWindowPDF),_surEchecRequetePDF.bind(this,lWindowPDF)).lancerRequete(lParametresPDF,aParam.optionsPDF,aParam.cloudCible);} else{new ObjetRequeteGenerationPDF(this,_actionSurRequeteGenerationPDFVersCloud.bind(this,lAvecProblemeOuvertureWindow,lWindowPDF),_surEchecRequetePDFVersCloud.bind(this,lWindowPDF)).lancerRequete(lParametresPDF,aParam.optionsPDF,aParam.cloudCible);}};function _actionSurRequeteGenerationPDF(aAvecProblemeOuvertureWindow,aWindowPDF ,aJSON){if(!!aJSON.message){if(aWindowPDF&&aWindowPDF.close){aWindowPDF.close();}
GApplication.getMessage().afficher({message:aJSON.message});return;} else if(!aJSON.url){if(aWindowPDF&&aWindowPDF.close){aWindowPDF.close();}
GApplication.getMessage().afficher({message:GTraductions.getValeur('requete.erreur')});return;}
const lUrl=GChaine.encoderUrl(aJSON.url);if(!aAvecProblemeOuvertureWindow){if(aWindowPDF&&aWindowPDF.location){let lTimeout=null;aWindowPDF.onbeforeunload=function(){clearTimeout(lTimeout);};lTimeout=setTimeout(function(){if(!aWindowPDF.location.href||!aWindowPDF.location.href.endsWith||!aWindowPDF.location.href.endsWith(lUrl)){if(aWindowPDF.close){aWindowPDF.close();}
Invocateur.evenement('OuvrirFenetreLienPDF',lUrl);}},2000);aWindowPDF.location.href=lUrl;} else{window.open(lUrl);}} else{Invocateur.evenement('OuvrirFenetreLienPDF',lUrl);}}
function _surEchecRequetePDF(aWindowPDF ,aMessage){const lMessage=aMessage&&(aMessage.length>0)?aMessage:GTraductions.getValeur('requete.erreur');GApplication.getMessage().afficher({message:lMessage});if(aWindowPDF&&aWindowPDF.close){aWindowPDF.close();}}
function _actionSurRequeteGenerationPDFVersCloud(aAvecProblemeOuvertureWindow,aWindowPDF ,aJSON){if(!!aJSON&&!!aJSON.message){GApplication.getMessage().afficher({message:aJSON.message});return;}}
function _surEchecRequetePDFVersCloud(aWindowPDF ,aMessage){if(!(aMessage&&aMessage.idOAuth2)){let lMessage=!!aMessage?aMessage:GTraductions.getValeur('requete.erreurGenerationPDF');GApplication.getMessage().afficher({message:lMessage});return;} else{UtilitaireOAuth2.authentification_promise(aMessage.idOAuth2).then(() =>{let lListe=GEtatUtilisateur.listeCloud;let lCloud=lListe.GetElementParGenre(aMessage.service);if(!!lCloud){lCloud.idOAuth2=aMessage.idOAuth2;}
lListe=GEtatUtilisateur.listeCloudDepotServeur;lCloud=lListe.GetElementParGenre(aMessage.service);if(!!lCloud){lCloud.idOAuth2=aMessage.idOAuth2;}
this.genererPDF(this.parametresSauvegardes);},() =>{});}
if(aWindowPDF&&aWindowPDF.close){aWindowPDF.close();}}
module.exports=GenerationPDF;},fn:"utilitairegenerationpdf.js"});;
IE.fModule({f:function(exports,require,module,global){const TypeGestionRenvoisImp={impRenvoisAucun:0,impRenvoisSousBloc:1,impRenvoisApresPage:2,impRenvoisCumulesALaFin:3};module.exports.TypeGestionRenvoisImp=TypeGestionRenvoisImp;},fn:"typegestionrenvoisimp.js"});;
IE.fModule({f:function(exports,require,module,global){const TypeGestionRenvoisImp=require('TypeGestionRenvoisImp.js').TypeGestionRenvoisImp;const EGenreCouleurTexte_EDT={aucune:0,fond:1,texte:2};const OptionsPDF={};OptionsPDF.defaut={portrait:true,taillePolice:8};OptionsPDF.EDT=Object.assign({portrait:false,taillePolice:8,taillePoliceMin:3,couleur:EGenreCouleurTexte_EDT.fond,renvoi:TypeGestionRenvoisImp.impRenvoisAucun,uneGrilleParSemaine:false,inversionGrille:false,ignorerLesPlagesSansCours:false});OptionsPDF.BulletinReleve={portrait:true,taillePolice:6.5,taillePoliceMin:5,taillePolicePied:6.5,taillePolicePiedMin:5,hauteurServiceMin:10,hauteurServiceMax:15};OptionsPDF.Bulletin=Object.assign({adapterHauteurService:false},OptionsPDF.BulletinReleve);module.exports={OptionsPDF:OptionsPDF,EGenreCouleurTexte_EDT:EGenreCouleurTexte_EDT};},fn:"optionspdf.js"});;
IE.fModule({f:function(exports,require,module,global){const OptionsPDF=require('OptionsPDF.js').OptionsPDF;OptionsPDF.EDT=Object.assign(OptionsPDF.EDT,{estEDTAnnuel:true});OptionsPDF.LivretScolaire=Object.assign({avecGraphe:false,portrait:false});OptionsPDF.Bulletin=Object.assign({piedMonobloc:true,gererRectoVerso:false,desEleves:false},OptionsPDF.Bulletin);OptionsPDF.ReleveDeNotes=Object.assign({avecPolices:true,libelleGroupePolices:''},OptionsPDF.BulletinReleve);OptionsPDF.BulletinDeCompetences=Object.assign({gererRectoVerso:false,adapterHauteur:false,avecGraphe:false,desEleves:false,taillePoliceMin:5,taillePolicePied:6.5,taillePolicePiedMin:5},OptionsPDF.defaut);OptionsPDF.ReleveDeCompetences=Object.assign({desEleves:false},OptionsPDF.defaut);OptionsPDF.RecapitulatifMensuelAbsences=Object.assign({avecDetailMotifs:true},OptionsPDF.defaut);module.exports=OptionsPDF;},fn:"optionspdfsco.js"});;
IE.fModule({f:function(exports,require,module,global){const TypeHttpGenerationPDFSco={EDT:0,ReleveDeNotes:1,Bulletin:2,LivretScolaire:3,LivretScolaire_Appreciations:4,Resultats:5,Trombinoscope:6,NiveauxDeMaitriseParMatiere:7,FeuilleAppel:8,EquipePedagogique:9,ListeStagiaires:10,CertificatScolarite:11,ListeRessources:12,ResultatsQCM:13,MenuCantine:14,Agenda:15,FicheBrevet:16,BulletinBIA:17,RecapAbsences:18,AppreciationsProfBulletin:19,RecapPunitionSanction:20,RecapFeuilleAppel:21,GraphiqueProfil:22,BulletinDeCompetences:23,ParcoursEducatifCompetences:24,CarnetDeCorrespondance:25,BilanFinDeCycle:26,Attestation:27,RecapMensuelAbsences:28,Etiquettes:29,ResultatsClasse:30,ReleveDeCompetences:31,PyramideDesAges:32,SuiviElevesTutores:33,AppreciationsProf:34,DocumentTelechargeable:35,DocumentTelechargeableMembre:36,TableauDeBord:37,RecapDemandeInscription:38,LivretCompetenceNumerique:39,ProjetAccompagnementPerso:40,RecapCahierJournal:41,SyntheseAcquis:42,CarnetDeSuivi:43,CalendrierScolaire:44,BilanCompetencesParMatiere:45,AppelPeriscolaire:46};module.exports.TypeHttpGenerationPDFSco=TypeHttpGenerationPDFSco;},fn:"typehttpgenerationpdfsco.js"});;
IE.fModule({f:function(exports,require,module,global){const GChaine=require('GChaine.js');const GHtml=require('GHtml.js');const Identite=require('ObjetIdentite.js');const ObjetElement=require('ObjetElement.js');const ObjetListeElements=require('ObjetListeElements.js');const tag=require('tag.js');const EGenreEvenementObjetSaisie=require('Enumere_EvenementObjetSaisie.js');class ObjetSelection extends Identite{constructor(...aParams){super(...aParams);this.idListeSelection=this.Nom+'_ListeObjetSelection';this.identList=this.Nom+'_ZoneListe';this.listeRessources=new ObjetListeElements();this.elementCourant=new ObjetElement();this.options={styles:'',avecEvenementAvantSelection:false,icone:'icon_ul',avecBoutonsPrecedentSuivant:true,height:null,getTitre:null,controleNavigation:false,textCenter:true,optionsCombo:null};this.actif=true;}
getControleur(aInstance){return $.extend(true,super.getControleur(this),{combo:{init(aCombo){_initCombo.call(aInstance,aCombo);},event(aParametres){if(aParametres.genreEvenement===EGenreEvenementObjetSaisie.selection){_setElementCourant.call(aInstance,aParametres.indice,true);}},getDisabled(){return!aInstance.actif;}}});}
estVisible(){return true;}
SetParametres(aParam){Object.assign(this.options,aParam);}
SetDonnees(aListeRessources,aIndiceParDefaut,aAvecEvnt){this.listeRessources=aListeRessources;this.donneesRecues=true;this.Afficher();if(this._combo){if(aIndiceParDefaut===null||aIndiceParDefaut===undefined){aIndiceParDefaut=0;}
const lAvecEvnt=aAvecEvnt!==false;if(lAvecEvnt){this._combo.SetSelection(aIndiceParDefaut);} else{this._combo.initSelection(aIndiceParDefaut);}}}
ConstruireAffichage(){if(this.donneesRecues){return this.composeSelecteur();} else{return'&nbsp;';}}
afficherMessage(aMessage){GHtml.setHtml(this.GetNom(),this.composeMessage(aMessage));}
surPrecedent(){this._combo.surPrecedentSuivant(true);}
surSuivant(){this._combo.surPrecedentSuivant(false);}
composeSelecteur(){return tag('ie-combo',{class:['combo-selecteur','nav-secondary-contain',this.options.textCenter?'':'text-align-inherit'],'ie-model':'combo','ie-controlesaisie':!!this.options.controleNavigation});}
setActif(aActif){if((aActif!==null)&&(aActif!==undefined)&&(aActif!==this.actif)){this.actif=aActif;this.$refreshSelf();}}
getCombo(){return this._combo;}}
function _initCombo(aCombo){this._combo=aCombo;aCombo.setDonnees_ObjetSaisie({liste:this.listeRessources,options:Object.assign({avecBoutonsPrecSuiv:this.options.avecBoutonsPrecedentSuivant,avecBoutonsPrecSuiv_boucle:true,initAutoSelectionAvecUnElement:false,avecBouton:false,iconeGauche:this.options.avecBoutonsPrecedentSuivant?false:this.options.icone,getContenuCellule:(aElement) =>{const lHtml=[];if(this.options.getTitre){lHtml.push(this.options.getTitre(aElement));} else if(aElement&&aElement.libelleHtmlTitre){lHtml.push(aElement.libelleHtmlTitre);} else{lHtml.push('<span>',aElement?aElement.GetLibelle():'','</span>',(aElement&&aElement.sousTitre?'&nbsp;<span>'+aElement.sousTitre+'</span>':''));}
return{libelleHtml:lHtml.join('')};},getContenuElement(aParams){const lElement=aParams.element;const H=[];if(lElement.AvecSelection===false){H.push('<div class=" ',(lElement.classeTitre?lElement.classeTitre:'Gras'),'" style="text-align:center">',lElement.libelleHtml?'<div style="width:100%;height:100%;">'+lElement.libelleHtml+'</div>':GChaine.Insecable(lElement.GetLibelle()),'</div>');} else{const lImagePerso=lElement.imagePerso?'<i class="material-icons '+lElement.imagePerso+'"></i>':'';H.push((lImagePerso&&lElement.imagePosition==="left"?lImagePerso:''),'<div class="truncate" '+(lElement.idNotif?' id="'+lElement.idNotif+'"':'')+' style="white-space: nowrap;position:relative;'+(lElement.idNotif?'padding-right:1.6em':'')+'">',lElement.libelleHtml?lElement.libelleHtml:GChaine.Insecable(lElement.GetLibelle()),'</div>',lElement.sousTitre?'<div style="margin-left:18px;" class="Texte12 Gris truncate">'+lElement.sousTitre+'</div>':'');}
return H.join('');}},this.options.optionsCombo)});}
function _setElementCourant(aIndice,aAvecEvenement){const lElement=this.listeRessources.GetElement(aIndice);if(lElement){this.elementCourant=lElement;if(aAvecEvenement){this.callback.appel({element:this.elementCourant});}}}
module.exports={ObjetSelection:ObjetSelection};},fn:"objetselection.js"});;
IE.fModule({f:function(exports,require,module,global){const TypeClientRest={crSupprime01:0,crDropBox:1,crGoogleDrive:2,crOneDrive:3,crSupprime02:4,crDigiposte:5,crOneNote:6,crPentila:7,crCloudIndex:8,crDigiposteCertifie:9};module.exports.TypeClientRest=TypeClientRest;},fn:"typeserviceoauth2.js"});;
IE.fModule({f:function(exports,require,module,global){const EGenreEvenementListe=require('Enumere_EvenementListe.js');const ObjetDonneesListeFlatDesign=require('ObjetDonneesListeFlatDesign.js');const ObjetFenetre=require('ObjetFenetre.js');const ObjetListe=require('ObjetListe.js');const GTraductions=require('ObjetTraduction.js');const TypeClientRest=require('TypeServiceOAuth2.js').TypeClientRest;const TypeThemeBouton=require('Type_ThemeBouton.js');const UtilitaireOAuth2=require('UtilitaireOAuth2.js');const GUID=require('GUID.js');const GHtml=require('GHtml.js');class ObjetFenetre_SelectionClouds extends ObjetFenetre{constructor(...aParams){super(...aParams);this.avecChoixFiltrageEnseignees=false;this.avecPDF=true;this.avecClouds=true;this.filtreEnseignees=false;this.autoriserEventCloud=0;this.idConteneurBouton=GUID.getId();this.idTexteExplicatif=GUID.getId();this.idConteneurBoutonBas=GUID.getId();this.idBtnParams=GUID.getId();}
ConstruireInstances(){this.identListe=this.Add(ObjetListe,this.evenementSurListe,_initialiserListe);}
getControleur(aInstance){return $.extend(true,super.getControleur(aInstance),{genererPDF:{event(){aInstance.callback.appel();aInstance.Fermer();}},surParametrage:{event(){aInstance.callbackParametrage();}},valider:{event(){aInstance.Fermer();}}});}
ComposeContenu(){const T=[];T.push('<div style="display:flex;flex-direction:column;height:100%;">');T.push('<div id="',this.idConteneurBouton,'" style="display:none">');T.push('<div  class="Espace" style="display:flex;flex-direction:column;">');T.push('<div data-usedAs="conteneurBoutonPDF" style="display:flex; flex-direction:row;justify-content: space-between;">');T.push('<ie-bouton style="flex: 1 0 25rem;" ie-model="genererPDF" class="'+TypeThemeBouton.primaire+' Espace">'+GTraductions.getValeur('ListeClouds.voirPDF')+'</ie-bouton>');if(!IE.estMobile){T.push('<ie-btnicon id="',this.idBtnParams,'" ie-hint="',GTraductions.getValeur('GenerationPDF.Titre'),'" style="font-size:2rem;" ie-model="surParametrage" class="icon_cog MargeDroit EspaceGauche"></ie-btnicon>');}
T.push('</div>');T.push('<div class="GrandEspaceHaut EspaceBas" id="',this.idTexteExplicatif,'" style="display:none">');T.push('<span > ',GTraductions.getValeur('ListeClouds.texteExplicatifClouds'),'</span>');T.push('</div>');T.push('</div>');T.push('</div>');T.push('<div style="width: 100%; height: 100%" id="',this.GetNomInstance(this.identListe),'">');T.push('</div>');T.push('<div id="',this.idConteneurBoutonBas,'" style="display:none">');T.push('<div style="align-self: flex-end;display:flex; flex-direction:row;justify-content:flex-end;width: 100%;">');T.push('</div>');T.push('</div>');T.push('</div>');return T.join('');}
SetDonnees(aParams){this.avecPDF=((aParams.avecPDF===undefined)||(aParams.avecPDF===null))?this.avecPDF:aParams.avecPDF;this.avecClouds=((aParams.avecClouds===undefined)||(aParams.avecClouds===null))?this.avecClouds:aParams.avecClouds;this.avecDepot=((aParams.avecDepot===undefined)||(aParams.avecDepot===null))?this.avecDepot:aParams.avecDepot;this.callbackParametrage=aParams.callbackParametrage;this.Actualiser();this.Afficher();GHtml.setDisplay(this.idConteneurBouton,this.avecPDF);GHtml.setDisplay(this.idConteneurBoutonBas,(!IE.estMobile&&this.avecPDF));GHtml.setDisplay(this.idTexteExplicatif,this.avecPDF&&this.avecClouds);GHtml.setDisplay(this.idBtnParams,!!this.callbackParametrage);if(this.avecClouds){let lListe=this.avecDepot?GEtatUtilisateur.listeCloudDepotServeur:GEtatUtilisateur.listeCloud;this.SetBoutonActif(1,false);this.GetInstance(this.identListe).SetDonnees(new DonneesListe_SelectionCloud(lListe).setOptions({addCommandesMenuContextuel:function(aParametres){_addCommandesMenuContextuel.call(this,{service:aParametres.article.idOAuth2,menuContextuel:aParametres.menuContextuel});}.bind(this)}));}}
SurValidation(){const lNiveauSelectionne=this.GetInstance(this.identListe).getElementSelection();if(!!lNiveauSelectionne){this.callback.appel(!!lNiveauSelectionne?lNiveauSelectionne.GetNumero():null);}
this.Fermer();}
evenementSurListe(aParametres){switch(aParametres.genreEvenement){case EGenreEvenementListe.Selection:this.callback.appel(aParametres.ligne,aParametres.article);this.Fermer();break;}}}
function _addCommandesMenuContextuel(aParametres){const lInstance=this;aParametres.menuContextuel.add(GTraductions.getValeur('ListeClouds.Deconnecter'),true,() =>{UtilitaireOAuth2.revocation(aParametres.service,_retour.bind(this,lInstance));});aParametres.menuContextuel.SetDonnees();}
function _retour(aInstance){let lListe=this.avecDepot?GEtatUtilisateur.listeCloudDepotServeur:GEtatUtilisateur.listeCloud;aInstance.SetDonnees({listeClouds:lListe});}
function _initialiserListe(aInstance){aInstance.setOptionsListe({skin:ObjetListe.skin.flatDesign,hauteurAdapteContenu:true,hauteurMaxAdapteContenu:400});}
class DonneesListe_SelectionCloud extends ObjetDonneesListeFlatDesign{constructor(aDonnees){super(aDonnees);this.setOptions({avecContenuTronque:false,avecEvnt_Selection:true,flatDesignMinimal:true});}
_estConnecte(aArticle){return!!aArticle&&!!aArticle.idOAuth2;}
getTitreZonePrincipale(aParams){return aParams.article.GetLibelle();}
getInfosSuppZonePrincipale(aParams){const lInfosSupp=[];if(this._estConnecte(aParams.article)){lInfosSupp.push(GTraductions.getValeur('ListeClouds.Connecte'));} else{lInfosSupp.push('&nbsp;');}
return lInfosSupp.join('');}
avecBoutonActionLigne(aParams){return this._estConnecte(aParams.article);}
getIconeGaucheContenuFormate(aParams){const lGenreCloud=aParams.article.GetGenre();if(lGenreCloud===TypeClientRest.crSupprime01){return'Image_Icone_CS_Box';} else if(lGenreCloud===TypeClientRest.crDropBox){return'Image_Icone_CS_DropBox';} else if(lGenreCloud===TypeClientRest.crGoogleDrive){return'Image_Icone_CS_GoogleDrive';} else if(lGenreCloud===TypeClientRest.crOneDrive){return'Image_Icone_CS_OneDrive';} else if(lGenreCloud===TypeClientRest.crHubic){return'Image_Icone_CS_Hubic';} else if(lGenreCloud===TypeClientRest.crDigiposte){return'Image_Icone_CS_Digiposte';} else if(lGenreCloud===TypeClientRest.crDigiposteCertifie){return'Image_Icone_CS_Digiposte';} else if(lGenreCloud===TypeClientRest.crCloudIndex){return'Image_Icone_CS_CloudIndex';} else if(lGenreCloud===TypeClientRest.crPentila){return'Image_Icone_CS_Pentila';}}
initialisationObjetContextuel(aParametres){if(!aParametres.menuContextuel){return;}
this.options.addCommandesMenuContextuel(aParametres);aParametres.menuContextuel.SetDonnees(aParametres.id);}}
module.exports=ObjetFenetre_SelectionClouds;},fn:"objetfenetre_selectionclouds.js"});;
IE.fModule({f:function(exports,require,module,global){const ObjetFenetre_SelectionClouds=require('ObjetFenetre_SelectionClouds.js');const ObjetFenetre=require('ObjetFenetre.js');const GTraductions=require('ObjetTraduction.js');function UtilitaireGestionCloudEtPDF(){}
UtilitaireGestionCloudEtPDF.modeGestion={PDF:'pdf',Cloud:'cloud',PDFEtCloud:'pdfEtCloud'};UtilitaireGestionCloudEtPDF.creerFenetreGestion=function(aParams){let lAvecPDF=(aParams.modeGestion===UtilitaireGestionCloudEtPDF.modeGestion.PDF)||(aParams.modeGestion===UtilitaireGestionCloudEtPDF.modeGestion.PDFEtCloud);let lAvecCloud=(aParams.modeGestion===UtilitaireGestionCloudEtPDF.modeGestion.Cloud)||(aParams.modeGestion===UtilitaireGestionCloudEtPDF.modeGestion.PDFEtCloud);if((aParams.modeGestion===UtilitaireGestionCloudEtPDF.modeGestion.Cloud)&&!(GEtatUtilisateur.listeCloud.GetNbrElements()>0)||((aParams.modeGestion===UtilitaireGestionCloudEtPDF.modeGestion.PDFEtCloud)&&!(GEtatUtilisateur.listeCloudDepotServeur.GetNbrElements()>0))){lAvecCloud=false;}
let lTitre;if(!!aParams.titre){lTitre=aParams.titre;} else if(aParams.avecTitreSelonOnglet){const lOnglet=GEtatUtilisateur.getOngletSelectionne();lTitre=lOnglet?(lOnglet.libelleLong?lOnglet.libelleLong:lOnglet.GetLibelle()):'';}
if(!lTitre){switch(aParams.modeGestion){case UtilitaireGestionCloudEtPDF.modeGestion.PDF:case UtilitaireGestionCloudEtPDF.modeGestion.PDFEtCloud:lTitre=GTraductions.getValeur('ListeClouds.TitrePDF');break;case UtilitaireGestionCloudEtPDF.modeGestion.Cloud:lTitre=GTraductions.getValeur('ListeClouds.TitreCloud');break;default:break;}}
let lHauteur=0;if(lAvecPDF){lHauteur+=150;}
if(lAvecCloud){lHauteur+=250;}
let lFenetre=ObjetFenetre.creerInstance(ObjetFenetre_SelectionClouds,{pere:this,evenement:function(aLigne,aService){aParams.callbaskEvenement.call(this,aLigne,aService);},initialiser:function(aInstance){aInstance.setOptionsFenetre({titre:lTitre,largeur:350,hauteurMaxContenu:600,hauteur:lHauteur,avecScroll:true});}});lFenetre.setOptionsFenetre({listeBoutons:[]});lFenetre.SetDonnees({avecPDF:lAvecPDF,avecClouds:lAvecCloud,callbackParametrage:aParams.callbackParametrage,avecDepot:aParams.avecDepot});lFenetre.Afficher();return lFenetre;};module.exports=UtilitaireGestionCloudEtPDF;},fn:"utilitairegestioncloudetpdf.js"});;
IE.fModule({f:function(exports,require,module,global){const{TypeDroits}=require('ObjetDroitsPN.js');const ObjetCours_Mobile=require('ObjetCours_Mobile.js');const GTraductions=require('ObjetTraduction.js');const MethodesObjet=require('MethodesObjet.js');const MethodesTableau=require('MethodesTableau.js');const GHtml=require('GHtml.js');const InterfacePage_Mobile=require('InterfacePage_Mobile.js');const{GDate}=require('ObjetDate.js');const ObjetTri=require('ObjetTri.js');const ObjetElement=require('ObjetElement.js');const ObjetListeElements=require('ObjetListeElements.js');const EGenreEspace=require('Enumere_Espace.js');const EGenreRessource=require('Enumere_Ressource.js');const ObjetRequeteRessourceEDT=require('ObjetRequeteRessourceEDT.js');const ObjetRequetePageEmploiDuTemps=require('ObjetRequetePageEmploiDuTemps.js');const ObjetRequetePageEmploiDuTemps_DomainePresence=require('ObjetRequetePageEmploiDuTemps_DomainePresence.js');const TypeDomaine=require('TypeDomaine.js');const GChaine=require('GChaine.js');const UtilitaireEDTSortiePedagogique=require('UtilitaireEDTSortiePedagogique.js');const EStructureAffichage=require('Enumere_StructureAffichage.js');const UtilitairePrefsGrilleStructure=require('UtilitairePrefsGrilleStructure.js');const ObjetBoutonFlottant=require('ObjetBoutonFlottant.js');const GenerationPDF=require('utilitairegenerationpdf.js');const OptionsPdf=require('OptionsPDFSco.js');const EGenreOnglet=require('Enumere_Onglet.js');const ObjetFenetre=require('ObjetFenetre.js');const TypeHttpGenerationPDFSco=require('TypeHttpGenerationPDFSco.js').TypeHttpGenerationPDFSco;const ObjetSelection=require('ObjetSelection.js').ObjetSelection;const ObjetCelluleDate=require('ObjetCelluleDate.js');const UtilitaireGestionCloudEtPDF=require('UtilitaireGestionCloudEtPDF.js');class ObjetAffichagePageEmploiDuTemps_Mobile extends InterfacePage_Mobile{constructor(...aParams){super(...aParams);this.NumeroSemaine=null;this.popupOuvert={};this.estEDTAnnuel=false;this.avecVerificationJoursPresence=true;this.GenreStructure=EStructureAffichage.Autre;this.forcerClickCours=false;this.AvecTrouEDT=true;if(GEtatUtilisateur.getNavigationDate()){GEtatUtilisateur.setDerniereDate(GEtatUtilisateur.getNavigationDate());}}
ConstruireInstances(){this.ressources=GEtatUtilisateur.getMembre();this.membre=GEtatUtilisateur.getMembre();this.ressourceSelectionnee=GEtatUtilisateur.getMembre();if(MethodesTableau.existe(GEtatUtilisateur.GenreEspace,[EGenreEspace.Mobile_Accompagnant,EGenreEspace.Mobile_PrimAccompagnant])&&(GEtatUtilisateur.getGenreOnglet()===EGenreOnglet.EmploiDuTemps)){this.ressourceSelectionnee=GEtatUtilisateur.getUtilisateur();}
this.identSelecteurDate=this.Add(ObjetCelluleDate,_evenementCalendrier,(aInstance) =>{aInstance.setOptions_ObjetCelluleDate({avecBoutonsPrecedentSuivant:true,selecteurMobile:true});if(this.initialiserMoteurDate){this.initialiserMoteurDate(aInstance);}});this.identPageListe=this.Add(ObjetCours_Mobile,this.evenementFicheCours,_initialiserPageListe.bind(this));this.identComboEdt=this.Add(ObjetSelection,_evntSelecteurEdt.bind(this),_initSelecteurEdt.bind(this));this.identComboRessource=this.Add(ObjetSelection,_evntSelecteurRessource.bind(this),_initSelecteurEdt.bind(this));this.edtSelectionne=null;this.AddSurZone=[this.identComboEdt,this.identComboRessource,this.identSelecteurDate];this.masquerComboSelectionEdt=(GEtatUtilisateur.getGenreOnglet()!==EGenreOnglet.EmploiDuTemps)||MethodesTableau.existe(GEtatUtilisateur.GenreEspace,[EGenreEspace.Mobile_Parent,EGenreEspace.Mobile_Eleve]);}
ConstruireStructureAffichageAutre(){var lHtml=[];if(!this.identBtnFlottant){$("#"+GInterface.idZonePrincipale).IEHtmlAppend('<div class="is-sticky" ie-identite="getIdentiteBouton" ></div>',{controleur:this.controleur,avecCommentaireConstructeur:false});}
this.identBtnFlottant.SetVisible(false);lHtml.push('<div>','<div class="edtJournalier" id="',this.GetInstance(this.identPageListe).GetNom(),'"></div>','</div>');return lHtml.join('');}
getControleur(aInstance){return $.extend(true,super.getControleur(this),{getIdentiteBouton:function(){return{class:ObjetBoutonFlottant,pere:this,init:function(aBtn){aInstance.identBtnFlottant=aBtn;var lParam={listeBoutons:[{primaire:true,icone:"icon_pdf",callback:aInstance.AfficherModalitesGenerationPDF.bind(this,aInstance,_genererPdf)}
]};aBtn.setOptionsBouton(lParam);}};}});}
AfficherModalitesGenerationPDF(aInstance){let lParams={callbaskEvenement:aInstance.surEvenementFenetre.bind(aInstance),modeGestion:UtilitaireGestionCloudEtPDF.modeGestion.PDFEtCloud,avecDepot:true,avecTitreSelonOnglet:true};UtilitaireGestionCloudEtPDF.creerFenetreGestion(lParams);}
surEvenementFenetre(aLigne){const lService=GEtatUtilisateur.listeCloudDepotServeur.GetElement(aLigne);_genererPdf.call(this,lService);}
evenementFicheCours(aCours){if(aCours.estSortiePedagogique){_afficherSortiePeda.call(this,aCours);return;}}
RecupererDonnees(){new ObjetRequeteRessourceEDT(this,this.reponseRessourceEDT).lancerRequete();}
reponseRessourceEDT(aJSON){this.donnees=aJSON.listeRessources;if(MethodesTableau.existe(GEtatUtilisateur.GenreEspace,[EGenreEspace.Mobile_Etablissement,EGenreEspace.Mobile_Administrateur])){const lElement=this.donnees.GetElementParGenre(EGenreOnglet.EmploiDuTempsClasse);const lListeClasseGroupe=GEtatUtilisateur.getListeClasses({avecClasse:true,avecGroupe:true});lListeClasseGroupe.setTri([ObjetTri.init('Genre')]);lListeClasseGroupe.trier();lElement.liste=lListeClasseGroupe;}
const lListeClasse=this.donnees.GetElementParGenre(EGenreOnglet.EmploiDuTempsClasse);if(lListeClasse&&lListeClasse.liste&&lListeClasse.liste.GetNbrElements()){let lAvecClasse=false;let lAvecGroupe=false;lListeClasse.liste.parcourir(aClasseGroupe =>{switch(aClasseGroupe.GetGenre()){case EGenreRessource.Classe:lAvecClasse=true;return;case EGenreRessource.Groupe:lAvecGroupe=true;return;default:break;}});if(lAvecClasse){let lElement=new ObjetElement(GTraductions.getValeur('Classe'),-1,EGenreRessource.Classe,null);lElement.AvecSelection=false;lListeClasse.liste.AddElement(lElement);}
if(lAvecGroupe){let lElement=new ObjetElement(GTraductions.getValeur('Groupe'),-1,EGenreRessource.Groupe,null);lElement.AvecSelection=false;lListeClasse.liste.AddElement(lElement);}
lListeClasse.liste.setTri([
ObjetTri.init(function(D){return D.GetGenre()!==EGenreRessource.Aucune;}),ObjetTri.init(function(D){return D.GetNumero()!==0;}),ObjetTri.init(function(D){return D.GetGenre()!==EGenreRessource.Classe;}),ObjetTri.init(function(D){return D.GetNumero()!== -1;}),ObjetTri.init('Libelle')
]);lListeClasse.liste.trier();}
const lListeProfesseur=this.donnees.GetElementParGenre(EGenreOnglet.EmploiDuTempsProfesseur);if(lListeProfesseur){lListeProfesseur.liste.trier();}
const lListeSalle=this.donnees.GetElementParGenre(EGenreOnglet.EmploiDuTempsSalle);if(lListeSalle){const lListeSalleTmp=new ObjetListeElements();lListeSalle.liste.parcourir(function(aSalle){_ajouterSalle(lListeSalleTmp,aSalle);});lListeSalle.liste=lListeSalleTmp;}
this.donnees=this.donnees.getListeElements(aEdt =>{return aEdt.GetGenre()===EGenreOnglet.EmploiDuTemps||(aEdt.liste&&aEdt.liste.GetNbrElements()>0);});this.GetInstance(this.identComboEdt).SetDonnees(this.donnees,0);}
retourSurAffichage(){if(this.avecRetourSurAffichage){GHtml.setDisplay(this.GetInstance(this.identPageListe).GetNom(),true);this.avecRetourSurAffichage=false;return true;} else{return false;}}
_getParamsRequeteEDT(){const lParam={ressource:this.ressourceSelectionnee,dateDebut:this.date,estEDTAnnuel:this.estEDTAnnuel,avecConseilDeClasse:true,avecInfosPrefsGrille:true,avecCoursSortiePeda:true,avecAbsencesEleve:true,avecAbsencesRessource:true,avecDisponibilites:GEtatUtilisateur.GenreEspace===EGenreEspace.Mobile_Professeur};if(GEtatUtilisateur.getGenreOnglet()===EGenreOnglet.EmploiDuTemps){lParam.edt=this.edtSelectionne;}
return lParam;}
lancerRequeteEDT(){if(this.edtSelectionne){return new ObjetRequetePageEmploiDuTemps(this).lancerRequete(Object.assign(this._getParamsRequeteEDT())).then(function(aParams){return _surReponseRequeteEDT.call(this,aParams);}.bind(this));}}
lancerRequeteEdtPourCdT(aParams){return new ObjetRequetePageEmploiDuTemps(this).lancerRequete(Object.assign(this._getParamsRequeteEDT(),aParams));}
lancerRequeteDomaine(){if(this.identBtnFlottant){this.identBtnFlottant.SetVisible(false);}
if(this.estEDTAnnuel){this.GetInstance(this.identSelecteurDate).SetDonnees(GEtatUtilisateur.getDerniereDate(),true);} else{if(this.edtSelectionne){const lRessource=this.ressourceSelectionnee&&this.edtSelectionne.GetGenre()!==EGenreOnglet.EmploiDuTemps?this.ressourceSelectionnee:this.membre;new ObjetRequetePageEmploiDuTemps_DomainePresence(this).lancerRequete(lRessource).then(function(aTabParams){this.domainePresence=aTabParams[0];this.joursPresence=this.avecVerificationJoursPresence?aTabParams[1]:null;this.GetInstance(this.identSelecteurDate).setOptions_ObjetCelluleDate({domaineValide:GApplication.droits.get(TypeDroits.cours.domaineConsultationEDT),joursValidesAnnuels:this.joursPresence,estJoursValidesAnnuelsSelonPremiereDate:true});this.GetInstance(this.identSelecteurDate).SetDonnees(GEtatUtilisateur.getDerniereDate(),true);}.bind(this));}}}
free(...aParams){super.free(...aParams);if(this.identBtnFlottant){$('#'+this.identBtnFlottant.GetNom().escapeJQ()).remove();}}
getDateCourante(){return this.date;}}
function _initSelecteurEdt(aInstance){aInstance.SetParametres({avecBoutonsPrecedentSuivant:false,optionsCombo:{getClassElement:function(aParams){return aParams&&aParams.element&&aParams.element.classeElement?aParams.element.classeElement:'';}}});}
function _evntSelecteurEdt(aEdt){if(aEdt.element){this.edtSelectionne=aEdt.element;if(this.edtSelectionne.avecRessource&&this.edtSelectionne.liste){this.GetInstance(this.identComboRessource).SetVisible(true);this.GetInstance(this.identComboRessource).SetDonnees(this.edtSelectionne.liste,0);} else{this.ressourceSelectionnee=GEtatUtilisateur.getMembre();this.GetInstance(this.identComboRessource).SetVisible(false);if(this.masquerComboSelectionEdt){this.GetInstance(this.identComboEdt).SetVisible(false);}
this.lancerRequeteDomaine();}} else{}}
function _evntSelecteurRessource(aRessource){this.ressourceSelectionnee=aRessource.element;this.lancerRequeteDomaine();}
function _genererPdf(aService){var lRessources=new ObjetListeElements().AddElement(this.ressourceSelectionnee);lRessources.setSerialisateurJSON({ignorerEtatsElements:true});var lParametrageAffichage={genreGenerationPDF:TypeHttpGenerationPDFSco.EDT,estPlanning:false,estPlanningParRessource:false,estPlanningOngletParJour:false,estPlanningParJour:false,indiceJour:0,domaine:new TypeDomaine().SetValeur(true,GDate.GetSemaine(this.date)),ressource:lRessources.GetElement(0),ressources:lRessources,avecCoursAnnules:true,grilleInverse:false,prefsGrille:this.lPrefsGrille};GenerationPDF.genererPDF({paramPDF:lParametrageAffichage,optionsPDF:OptionsPdf.EDT,cloudCible:!!aService?aService.GetGenre():null});}
function _afficherPopUp(aTitre,aContenu){_fermerFenetre.call(this);this.fenetre=ObjetFenetre.creerInstance(ObjetFenetre,{pere:this},{titre:aTitre,fermerFenetreSurClicHorsFenetre:true,callbackFermer:function(){this.fenetre=null;}.bind(this)});this.fenetre.Afficher(aContenu);}
function _fermerFenetre(){if(this.fenetre){this.fenetre.Fermer();}}
function _afficherSortiePeda(aCours){var H=[];H.push('<div class="Espace">');H.push(require('DetailSortiePedagogique.htmlmodele.js')({strGenreRess:aCours.strGenreRess,strRess:aCours.strRess,motif:aCours.motif,strDate:UtilitaireEDTSortiePedagogique.strDate(aCours),duree:GDate.formatDureeEnPlaces(aCours.dureeReelle),accompagnateurs:aCours.accompagnateurs.join(', '),avecMemoVisible:aCours.memo!==undefined,getMemo:function(){return aCours.memo?'<div>'+GChaine.ToHTML(aCours.memo)+'</div>':'';}}));H.push('</div>');_afficherPopUp.call(this,GTraductions.getValeur('EDT.AbsRess.SortiePedagogique')+' '+UtilitaireEDTSortiePedagogique.strDate(aCours),H.join(''));}
function _evenementCalendrier(aDate){this.date=GDate.GetJour(aDate);GEtatUtilisateur.setDerniereDate(this.date);if(this.estEDTAnnuel&&this._cacheRequeteAnnuel){_surReponseRequeteEDT.call(this,MethodesObjet.dupliquer(this._cacheRequeteAnnuel));} else{this.lancerRequeteEDT();}}
function _initialiserPageListe(aInstance){aInstance.setOptions({estCoursVisible:_estCoursVisible.bind(this),forcerClickCours:this.forcerClickCours,avecTrouEDT:this.AvecTrouEDT});}
function _estCoursVisible(aCours){if(this.estEDTAnnuel){return IE.Cycles.dateEnJourCycle(this.date)===Math.floor(aCours.Debut/GParametres.PlacesParJour);}
return GDate.estJourEgal(this.date,aCours.DateDuCours);}
function _surReponseRequeteEDT(aParam){if(aParam.prefsGrille&&[EGenreEspace.Eleve,EGenreEspace.PrimEleve,EGenreEspace.Parent,EGenreEspace.PrimParent,EGenreEspace.Accompagnant,EGenreEspace.PrimAccompagnant,EGenreEspace.Tuteur].indexOf(GEtatUtilisateur.GenreEspace)>=0){this.lPrefsGrille=UtilitairePrefsGrilleStructure.getPrefsGrille(aParam.prefsGrille.genreRessource,false ,aParam.prefsGrille.numEtablissement);} else{this.lPrefsGrille=UtilitairePrefsGrilleStructure.getPrefsGrilleDefaut();}
var lJoursOuvres=UtilitairePrefsGrilleStructure.getDomaineJoursOuvresDePrefsGrille(this.lPrefsGrille);var lProchaineDate=UtilitairePrefsGrilleStructure.getProchaineDateOuvreeDePrefsGrille(this.date,this.lPrefsGrille);var lSelecteurDate=this.GetInstance(this.identSelecteurDate);if((lProchaineDate.trouve&&lProchaineDate.dateChangee)||!lSelecteurDate.getOptionsCelluleDate().joursSemaineValide||!lSelecteurDate.getOptionsCelluleDate().joursSemaineValide.egal(lJoursOuvres)){lSelecteurDate.setOptions_ObjetCelluleDate({joursSemaineValide:lJoursOuvres});lSelecteurDate.SetDonnees(lProchaineDate.date,true);return;}
if(this.estEDTAnnuel&&!this._cacheRequeteAnnuel){this._cacheRequeteAnnuel=MethodesObjet.dupliquer(aParam);}
var lListeImages=new ObjetListeElements();lListeImages.AddElement(new ObjetElement('IconeTravailAFaire'));aParam.listeCours.parcourir(function(aCours){aCours.ListeContenus.parcourir(function(aContenu){if((aContenu.GetGenre()===EGenreRessource.Matiere)&&aCours.avecTafPublie){aContenu.Class='';aContenu.listeImages=lListeImages;}});});if(aParam.listeCours&&aParam.listeCours.GetNbrElements()>0){if(this.identBtnFlottant){this.identBtnFlottant.SetVisible(true);}}
this.GetInstance(this.identPageListe).SetDonnees({date:this.date,numeroSemaine:GDate.GetSemaine(this.date),listeCours:aParam.listeCours,absences:aParam.absences,joursStage:aParam.joursStage,disponibilites:aParam.disponibilites,avecCoursAnnule:!!aParam&&aParam.avecCoursAnnule,avecIconeAppel:GEtatUtilisateur.getGenreOnglet()===EGenreOnglet.SaisieAbsences_AppelEtSuivi,debutDemiPensionHebdo:aParam.debutDemiPensionHebdo,finDemiPensionHebdo:aParam.finDemiPensionHebdo,callback:_fermerFenetre.bind(this)});if(GEtatUtilisateur.getNavigationCours()){var lCoursNav=GEtatUtilisateur.getNavigationCours();GEtatUtilisateur.setNavigationCours(null);var lCours=aParam.listeCours.GetElementParNumero(lCoursNav.GetNumero());if((lCours!==null)&&(lCours!==undefined)){this.evenementFicheCours(lCours);}}
if(!!this.actionApresListeCours&&MethodesObjet.isFunction(this.actionApresListeCours)){this.actionApresListeCours(aParam);}}
function _ajouterSalle(aListe,aSalle,aProfondeur){const lProfondeur=aProfondeur||0;const lSalle=lProfondeur===0?MethodesObjet.dupliquer(aSalle):aSalle;lSalle.profondeur=lProfondeur;lSalle.classeElement=lProfondeur>0?'element-indentation':'element-distinct';aListe.AddElement(lSalle);if(lSalle.liste){lSalle.liste.trier();for(let j=0;j<lSalle.liste.GetNbrElements();j++){_ajouterSalle(aListe,lSalle.liste.GetElement(j),lProfondeur+1);}}}
module.exports=ObjetAffichagePageEmploiDuTemps_Mobile;},fn:"interfacepageemploidutemps_mobile.js"});;
IE.fModule({f:function(exports,require,module,global){const TypeGenreTravailAFaire={tGTAF_Travail:0,tGTAF_Activite:1};module.exports.TypeGenreTravailAFaire=TypeGenreTravailAFaire;},fn:"typegenretravailafaire.js"});;
IE.fModule({f:function(exports,require,module,global){require('UtilitaireTAFEtContenu.css');const GTraductions=require('ObjetTraduction.js');const{GDate}=require('ObjetDate.js');const TypeGenreRenduTAF=require('TypeGenreRenduTAF.js').TypeGenreRenduTAF;const TypeEtatExecutionQCMPourRepondant=require('TypeEtatExecutionQCMPourRepondant.js').TypeEtatExecutionQCMPourRepondant;const GChaine=require('GChaine.js');const TypeNiveauDifficulte=require('TypeNiveauDifficulte.js').TypeNiveauDifficulte;const TypeGenreTravailAFaire=require('TypeGenreTravailAFaire.js').TypeGenreTravailAFaire;const UtilitaireQCM=require('UtilitaireQCM.js').UtilitaireQCM;const EGenreEspace=require('Enumere_Espace.js');var EGenreOnglet=require('Enumere_Onglet.js');const GUID=require('GUID.js');class UtilitaireTAFEleves{constructor(){}
composePage_TravailAFaire(aListeTravailAFaire,aUtilititaire,aControleur,aAvecFiltrage){var lHtml=[];var lDateCourante=null;var lDateDonneLeCourante=null;var lEstPremierTafDeLaDate=false;lHtml.push('<ul class="liste-date" role="list" tabindex="-1">');for(var I=0;I<aListeTravailAFaire.GetNbrElements();I++){var lTravailAFaire=aListeTravailAFaire.GetElement(I);var lDate=lTravailAFaire.PourLe;var lLibelleMatiere=lTravailAFaire.Matiere.Libelle;var lDateDonneLe=lTravailAFaire.DonneLe;if(lDate&&(!lDateCourante||!GDate.estJourEgal(lDateCourante,lDate))){if(!!lDateCourante){lHtml.push('</ul>');lHtml.push('</li>');}
lDateCourante=lDate;lDateDonneLeCourante=null;lEstPremierTafDeLaDate=true;lHtml.push('<li role="listitem">');lHtml.push('<div data-idDate="',GDate.FormatDate(lDateCourante,"%JJ%MM%AAAA").toString(),'" tabindex="-1">','<h5 class="ie-titre-gros souligne"><span>',(GTraductions.getValeur('TAFEtContenu.pour')+' </span>'+GDate.FormatDate(lDateCourante,'['+'%JJJJ %JJ %MMMM'+']')).toLowerCase().ucfirst(),'</h5>','</div>');lHtml.push('<ul class="liste-element" role="list">');}
var lEstQCM=!(lTravailAFaire.executionQCM===null||lTravailAFaire.executionQCM===undefined),lEstFait=false;if(lEstQCM&&!!lTravailAFaire.executionQCM.etatCloture){lEstFait=lTravailAFaire.QCMFait;} else{lEstFait=lTravailAFaire.TAFFait;}
if(!!lLibelleMatiere){lHtml.push('</li>');}
lHtml.push('<li role="listitem">');lDateDonneLeCourante=null;lHtml.push('       <div class="conteneur-item',!lEstPremierTafDeLaDate?' ligne-separation':'','">');lEstPremierTafDeLaDate=false;lHtml.push('        <div class="entete-element">');lHtml.push('         <div class="flex-contain">','          <div style="background-color:',lTravailAFaire.CouleurFond,';margin-right:0.8rem;padding:0.2rem;border-radius:0.4rem;"></div>');lHtml.push('          <div>');if(!aAvecFiltrage){lHtml.push('          <div class="titre-matiere ',lEstFait?'est-fait':'','">'+lLibelleMatiere+'</div>');}
if(lDateDonneLe&&(!lDateDonneLeCourante||!GDate.estJourEgal(lDateDonneLeCourante,lDateDonneLe))){lDateDonneLeCourante=lDateDonneLe;lHtml.push(this.composeDonneLe(lTravailAFaire));}
lHtml.push(this.composeThemes(lTravailAFaire));lHtml.push('           </div>');lHtml.push('          </div>');if(GEtatUtilisateur.estEspacePourProf()||GEtatUtilisateur.GenreEspace===EGenreEspace.Etablissement){lHtml.push(this.composeDetailsClasse(lTravailAFaire));} else{lHtml.push('          <div><ie-chips class="tag-style ',lEstFait?'color-theme':'','">',lEstFait?GTraductions.getValeur('TAFEtContenu.TAFFait'):GTraductions.getValeur('TAFEtContenu.TAFNonFait'),'</ie-chips></div>');}
lHtml.push('        </div>');lHtml.push(this.composeTravailAFaire(lTravailAFaire,{utilitaire:aUtilititaire,listeTAF:aListeTravailAFaire,controleur:aControleur}));lHtml.push('      </div>');}
lHtml.push('</li>');lHtml.push('</ul>');lHtml.push('</li>');lHtml.push('</ul>');return lHtml.join('');}
composeFicheTAF(aListeTAF,aUtilititaire,aControleur,aEstChronologique=false){var lHtml=[];lHtml.push('<div class="conteneur-liste-CDT conteneur-fiche-CDT AvecSelectionTexte">');for(var i=0,lNbr=aListeTAF.GetNbrElements();i<lNbr;i++){var lTAF=aListeTAF.GetElement(i);var lEstQCM=!(lTAF.executionQCM===null||lTAF.executionQCM===undefined),lEstFait=false;if(lEstQCM&&!!lTAF.executionQCM.etatCloture){lEstFait=lTAF.QCMFait;} else{lEstFait=lTAF.TAFFait;}
lHtml.push('<div class="conteneur-item',i>0?' ligne-separation':'','">');lHtml.push('<div class="entete-element">');lHtml.push('<div class="flex-contain">',' <div style="background-color:',lTAF.CouleurFond,';margin-right:0.8rem;padding:0.2rem;border-radius:0.4rem;"></div>');lHtml.push(' <div>');lHtml.push('   <div class="titre-matiere ',lEstFait?'est-fait':'','">'+lTAF.Matiere.Libelle+'</div>');if(lTAF.DonneLe){lHtml.push(this.composeDonneLe(lTAF));}
if(lTAF.PourLe){lHtml.push(' <div class="ie-sous-titre">',GTraductions.getValeur('TAFEtContenu.pourLe'),GDate.FormatDate(lTAF.PourLe,' %JJJ %JJ %MMM'),'</div>');}
lHtml.push('  </div>');lHtml.push(' </div>');if(GEtatUtilisateur.estEspacePourProf()||GEtatUtilisateur.GenreEspace===EGenreEspace.Etablissement){lHtml.push(this.composeDetailsClasse(lTAF));} else{lHtml.push('<div><ie-chips class="tag-style ',lEstFait?'color-theme':'','">',lEstFait?GTraductions.getValeur('TAFEtContenu.TAFFait'):GTraductions.getValeur('TAFEtContenu.TAFNonFait'),'</ie-chips></div>');}
lHtml.push('</div>');lHtml.push(this.composeTravailAFaire(lTAF,{utilitaire:aUtilititaire,listeTAF:aListeTAF,controleur:aControleur},true,aEstChronologique));lHtml.push('</div>');}
lHtml.push('</div>');return lHtml.join('');}
composeDonneLe(aTravailAFaire,aEstPrimaire){var lPourLe=aEstPrimaire?aTravailAFaire.DateDebut:aTravailAFaire.PourLe;var lDonneLe=aEstPrimaire?aTravailAFaire.donneLe:aTravailAFaire.DonneLe;var lNbrJours=GDate.GetDifferenceJours(lPourLe,lDonneLe);var lHtml=[];lHtml.push('<div class="ie-sous-titre">',GTraductions.getValeur('TAFEtContenu.donneLe'),' ',GDate.FormatDate(lDonneLe,'%JJJ %JJ %MMM'),' [',lNbrJours,' ',lNbrJours?GTraductions.getValeur('TAFEtContenu.jours'):GTraductions.getValeur('TAFEtContenu.jour'),']','</div>');return lHtml.join('');}
composeThemes(aTAF){if(!aTAF.ListeThemes||aTAF.ListeThemes.GetNbrElements()===0){return'';}
const lHtml=[];lHtml.push('<div class="ie-sous-titre">');lHtml.push('<span>',GTraductions.getValeur('Themes'),' : ','</span>');const H=[];for(let i=0,lNbr=aTAF.ListeThemes.GetNbrElements();i<lNbr;i++){H.push(aTAF.ListeThemes.GetElement(i).GetLibelle());}
lHtml.push(H.join(', '));lHtml.push('</div>');return lHtml.join('');}
composeDetails(aTravailAFaire){if(!(aTravailAFaire.duree||aTravailAFaire.niveauDifficulte)){return'<div class="clear"></div>';}
var H=[];H.push('<div class="ie-sous-titre details">');if(aTravailAFaire.duree){var lFormatMin=aTravailAFaire.duree>60?'%mm':'%xm';var lStrDuree=GDate.FormatDureeEnMillisecondes(aTravailAFaire.duree*60*1000,aTravailAFaire.duree>60?'%xh%sh'+lFormatMin:lFormatMin+'mn');H.push('<span class="duree"><i class="icon_edt_permanence"></i>',lStrDuree,'</span>');}
if(!!aTravailAFaire.niveauDifficulte&&aTravailAFaire.niveauDifficulte!==TypeNiveauDifficulte.ND_NonPrecise){H.push('<span class="difficulte">',TypeNiveauDifficulte.construireIcon({niveauDifficulte:aTravailAFaire.niveauDifficulte}),TypeNiveauDifficulte.typeToStr(aTravailAFaire.niveauDifficulte),'</span>');}
H.push('</div>');return H.join('');}
composeTravailAFaire(aTravailAFaire,aParams,aEstFiche,aEstChronologique){var lEstPrimaire=aParams.estPrimaire,lHtml=[],lAvecERendu=TypeGenreRenduTAF.estUnRenduEnligne(aTravailAFaire.genreRendu),lEstQCM=!(aTravailAFaire.executionQCM===null||aTravailAFaire.executionQCM===undefined),lEstFait=false;if(lEstQCM&&!!aTravailAFaire.executionQCM.etatCloture){lEstFait=aTravailAFaire.QCMFait;} else{lEstFait=aTravailAFaire.TAFFait;}
lHtml.push('<div class="entete-element">');lHtml.push(this.composeDetails(aTravailAFaire));lHtml.push('</div>');if(TypeGenreRenduTAF.estUnRenduPapier(aTravailAFaire.genreRendu)){lHtml.push('<div class="ie-sous-titre rendu-papier details">',GTraductions.getValeur('CahierDeTexte.TAFARendre.Eleve.RenduPapier'),'</div>');}
lHtml.push('<div class="conteneur-descriptif">');if(aTravailAFaire.executionQCM===null||aTravailAFaire.executionQCM===undefined){const lIdPourAria=GUID.getId();lHtml.push('<div id="',lIdPourAria,'" class="description ',!lEstQCM?'init-html ':'',lEstFait?'est-fait':'','">',lEstPrimaire?aTravailAFaire.consigne:aTravailAFaire.descriptif,'</div>',lEstPrimaire?(aTravailAFaire.documents.GetNbrElements()?this.composePiecesJointes(aTravailAFaire,true,lIdPourAria):''):(aTravailAFaire.ListePieceJointe.GetNbrElements()?this.composePiecesJointes(aTravailAFaire,false,lIdPourAria):''));} else{lHtml.push('<div class="description ',lEstFait?'est-fait':'','"><i class="icon_qcm avecCouleurTheme"></i>',lEstPrimaire?aTravailAFaire.executionQCM.QCM.GetLibelle():aTravailAFaire.descriptif,' (',UtilitaireQCM.getStrResumeModalites(aTravailAFaire.executionQCM),') </div>');}
var lOngletPublie=GEtatUtilisateur.listeOnglets.GetElementParGenre(EGenreOnglet.CDT_Contenu);if(aTravailAFaire.cours&&!(aEstFiche&&(IE.estMobile||aEstChronologique))&&!!lOngletPublie&&!!lOngletPublie.Actif){lHtml.push('<div class="btnCours">','<ie-bouton ie-model="appelCours(\''+aTravailAFaire.GetNumero()+'\')" class="themeBoutonNeutre small-bt">',GTraductions.getValeur('CahierDeTexte.TAFARendre.VoirContenu'),'</ie-bouton>','</div>');}
if(!GEtatUtilisateur.estEspacePourProf()){if(!lEstQCM&&!lAvecERendu){if(GEtatUtilisateur.estEspaceEleve()){lHtml.push('<div class="flex-contain conteneur-cb"><ie-checkbox class="cb-termine colored-label" ie-textleft ie-model="evenementTafFait(\'',aTravailAFaire.GetNumero(),'\')">',GTraductions.getValeur('TAFEtContenu.cbTermine'),'</ie-checkbox></div>');}} else if(lEstQCM){var lAvecAction=UtilitaireQCM.estCliquable(aTravailAFaire.executionQCM);if(lAvecAction){lHtml.push('<div class="flex-contain btn-qcm"><ie-bouton ie-model="appelQCM(\''+aTravailAFaire.executionQCM.GetNumero()+'\')" class="',lEstFait?'themeBoutonNeutre':'themeBoutonSecondaire','">',lEstFait?GTraductions.getValeur('TAFEtContenu.voirQCM'):GTraductions.getValeur('TAFEtContenu.executerQCM'),'</ie-bouton></div>');}} else{aTravailAFaire.avecRendu=aTravailAFaire.avecRendu===undefined?lAvecERendu:aTravailAFaire.avecRendu;lHtml.push('<div class="taf-a-rendre">',aParams.utilitaire.composeTAFARendrePourWidget(aTravailAFaire,{controleur:aParams.controleur,listeTAF:aParams.listeTAF}),'</div>');}}
lHtml.push('</div>');return lHtml.join('');}
composePiecesJointes(aElement,aEstPrimaire,aIdPourAria){var lHtml=[],lListe=aEstPrimaire?aElement.documents:aElement.ListePieceJointe;lHtml.push('<div class="piece-jointe">');for(var I=0;I<lListe.GetNbrElements();I++){var lPieceJointe=lListe.GetElement(I);lHtml.push('<span class="chips-pj">',GChaine.composerUrlLienExterne({documentJoint:lPieceJointe,maxWidth:300,ariaLabelledby:aIdPourAria}),'</span>');}
lHtml.push('</div>');return lHtml.join('');}
composeDetailsClasse(aTAF){var lHtml=[];var lDonnee=aTAF;var lSansRendu=TypeGenreRenduTAF.estSansRendu(lDonnee.genreRendu);var lLibelle;if(lDonnee.avecRendu){lLibelle=GTraductions.getValeur('CahierDeTexte.TAFARendre.RenduPar')+' '+lDonnee.nbrRendus+'/'+lDonnee.nbrEleves;if(lDonnee.estProfDuCours){lHtml.push('<div class="detailsRendu">','<ie-bouton ie-model="appelDetailTAF(\''+aTAF.GetNumero()+'\')" class="themeBoutonSecondaire small-bt">',lLibelle,'</ie-bouton>','</div>');} else{lHtml.push('<div class="detailsRendu">',lLibelle,'</div>');}}
if(lSansRendu){lLibelle=GTraductions.getValeur('CahierDeTexte.TAFARendre.FaitPar')+' '+lDonnee.nbrFaitsSelonEleve+'/'+lDonnee.nbrEleves;if(lDonnee.estProfDuCours){lHtml.push('<div class="detailsRendu">','<ie-bouton ie-model="appelDetailTAF(\''+aTAF.GetNumero()+'\')" class="themeBoutonSecondaire small-bt">',lLibelle,'</ie-bouton>','</div>');} else{lHtml.push('<div class="detailsRendu">',lLibelle,'</div>');}}
return lHtml.join('');}
composePage_TravailAFairePrimaire(aListeTravailAFaire,aUtilititaire,aControleur){var lHtml=[];var lDateCourante=null;var lDateDonneLeCourante=null;var lEstPremierTafDeLaDate=false;lHtml.push('<ul class="liste-date" role="list" tabindex="-1">');for(var I=0;I<aListeTravailAFaire.GetNbrElements();I++){var lTravailAFaire=aListeTravailAFaire.GetElement(I);var lDate=lTravailAFaire.DateDebut;var lLibelleMatiere=lTravailAFaire.titre||(!!lTravailAFaire.matiere&&lTravailAFaire.matiere.Libelle);var lDateDonneLe=lTravailAFaire.donneLe;if(lDate&&(!lDateCourante||!GDate.estJourEgal(lDateCourante,lDate))){if(!!lDateCourante){lHtml.push('</ul>');lHtml.push('</li>');}
lDateCourante=lDate;lEstPremierTafDeLaDate=true;lHtml.push('<li role="listitem">');lHtml.push('<div data-idDate="',GDate.FormatDate(lDateCourante,"%JJ%MM%AAAA").toString(),'" tabindex="-1">','<h5 class="ie-titre-gros conteneur-date"><span>',(GTraductions.getValeur('TAFEtContenu.pour')+' </span>'+GDate.FormatDate(lDateCourante,'['+'%JJJJ %JJ %MMMM'+']')).toLowerCase().ucfirst(),'</h5>','</div>');lHtml.push('<div class="ligne-separation-date ',lTravailAFaire.estRappel?'conteneur-rappel':'','"></div>');lHtml.push('<ul class="liste-element" role="list">');}
var lEstQCM=!(lTravailAFaire.executionQCM===null||lTravailAFaire.executionQCM===undefined),lEstFait=false;if(lEstQCM&&!!lTravailAFaire.executionQCM.etatCloture){lEstFait=lTravailAFaire.executionQCM.etatCloture===TypeEtatExecutionQCMPourRepondant.EQR_Termine;} else{lEstFait=lTravailAFaire.TAFFait;}
if(!!lLibelleMatiere){lHtml.push('</li>');}
lHtml.push('<li role="listitem">');lDateDonneLeCourante=null;if(lTravailAFaire.estRappel){lHtml.push(this.composeRappel(lTravailAFaire,!lEstPremierTafDeLaDate));} else{lHtml.push('       <div class="conteneur-item',!lEstPremierTafDeLaDate?' ligne-separation':'','">');lHtml.push('        <div class="entete-element">');lHtml.push('          <div class="flex-contain">');var lInfoIcone;if(lTravailAFaire.GetGenre()===TypeGenreTravailAFaire.tGTAF_Activite){lInfoIcone={nom:'icon_ecole',hint:GTraductions.getValeur('CahierDeTexte.ActiviteEnClasse'),couleur:'#AB96E4',fontSize:'20px'};} else{lInfoIcone={nom:'icon_home',hint:GTraductions.getValeur('CahierDeTexte.TravailALaMaison'),couleur:'#7CB744',fontSize:'22px'};}
if(!!lInfoIcone){lHtml.push('          <div title="',lInfoIcone.hint,'" class="conteneur-icon">','<i class="material-icons ',lInfoIcone.nom,' AlignementMilieuVertical" style="font-size:',lInfoIcone.fontSize,'; color:',lInfoIcone.couleur,';"></i>','</div>');}
lHtml.push('           <div class="flex-contain">','            <div style="background-color:',lTravailAFaire.couleur,';margin-right:0.8rem;padding:0.2rem;border-radius:0.4rem;"></div>');lHtml.push('             <div>');lHtml.push('              <div class="titre-matiere ',lEstFait?'est-fait':'','">'+lLibelleMatiere+'</div>');if(lDateDonneLe&&(!lDateDonneLeCourante||!GDate.estJourEgal(lDateDonneLeCourante,lDateDonneLe))){lDateDonneLeCourante=lDateDonneLe;lHtml.push(this.composeDonneLe(lTravailAFaire,true));}
lHtml.push('             </div>');lHtml.push('            </div>');lHtml.push('          </div>');lHtml.push('          <div><ie-chips class="tag-style ',lEstFait?'color-theme':'','">',lEstFait?GTraductions.getValeur('TAFEtContenu.TAFFait'):GTraductions.getValeur('TAFEtContenu.TAFNonFait'),'</ie-chips></div>');lHtml.push('        </div>');lHtml.push(this.composeTravailAFaire(lTravailAFaire,{utilitaire:aUtilititaire,listeTAF:aListeTravailAFaire,controleur:aControleur,estPrimaire:true}));lHtml.push('</div>');}
lEstPremierTafDeLaDate=false;}
lHtml.push('</li>');lHtml.push('</ul>');lHtml.push('</li>');lHtml.push('</ul>');return lHtml.join('');}
composeRappel(aRappel,aAvecLigneSeparation){var lHtml=[];lHtml.push('<div class="conteneur-rappel',aAvecLigneSeparation?' ligne-separation':'','">');lHtml.push('  <div class="entete-element">');lHtml.push('    <div class="flex-contain">');lHtml.push('      <div class="conteneur-icon">','<i class="icon_bell"></i>','</div>');lHtml.push('      <div class="titre-matiere ',aRappel.estAccuse?'est-vu':'','">',aRappel.titre,'</div>');lHtml.push('    </div>');if(aRappel.estAccuse){lHtml.push('    <div><ie-chips class="tag-style theme-cat-resultat">',GTraductions.getValeur('CahierDeTexte.ChipsVu'),'</ie-chips></div>');}
lHtml.push('  </div>');lHtml.push('  <div class="conteneur-descriptif">');if(aRappel.detail){lHtml.push('    <div class="description ',aRappel.estAccuse?'est-vu':'','">',aRappel.detail,'</div>');}
if(!GDate.estAvantJourCourant(aRappel.DateDebut,true)){lHtml.push('      <div class="flex-contain conteneur-cb">','<ie-checkbox ie-textleft class="cb-termine cb-rappel theme-cat-resultat" ie-model="cbEventRappel(\'',aRappel.GetNumero(),'\')">',GTraductions.getValeur('CahierDeTexte.CBJeSuisInformee'),'</ie-checkbox></div>');}
lHtml.push('  </div>');lHtml.push('</div>');return lHtml.join('');}}
module.exports=UtilitaireTAFEleves;},fn:"utilitairetafeleves.js"});;
IE.fModule({f:function(exports,require,module,global){require('espace/css/UtilitaireTAFEtContenu.css');const GTraductions=require('ObjetTraduction.js');const{GDate}=require('ObjetDate.js');const GChaine=require('GChaine.js');const UtilitaireQCM=require('UtilitaireQCM.js').UtilitaireQCM;const TypeFichierExterneHttpSco=require('TypeFichierExterneHttpSco.js').TypeFichierExterneHttpSco;const ObjetElement=require('ObjetElement.js');const EGenreRessource=require('Enumere_Ressource.js');const{EGenreRessourcePedagogique,EGenreRessourcePedagogiqueUtil}=require('Enumere_RessourcePedagogique.js');const EGenreDocumentJoint=require('Enumere_DocumentJoint.js');const ObjetTri=require('ObjetTri.js');const EGenreOnglet=require('Enumere_Onglet.js');const ObjetFenetre=require('ObjetFenetre.js');const ObjetFenetre_CorrectionTaf=require('ObjetFenetre_CorrectionTaf.js');const GHtml=require('GHtml.js');const ObjetListeElements=require('ObjetListeElements.js');const tag=require('tag.js');class UtilitaireContenuDeCours{constructor(){this.idDate='TAF_BlocDate_';}
composePage_Contenu(aListeCahierDeTextes,aAvecFiltrage){const lHtml=[];let lDateCourante=null;let lEstPremierCDCDeLaDate=false;lHtml.push('<ul class="liste-date" role="list" tabindex="-1">');if(!IE.estMobile){lHtml.push('<li role="listitem">');lHtml.push('<div class="conteneur-titre-liste ',aAvecFiltrage?'titre-espaceBas-xxl':'','">','<i class="icon_th_large"></i>','<span class="ie-titre">',GTraductions.getValeur('CahierDeTexte.contenu'),'</span>','</div>');lHtml.push('</li>');}
const lListeProfesseursMatiere=new ObjetListeElements();if(aAvecFiltrage){aListeCahierDeTextes.parcourir(aCDT =>{aCDT.listeProfesseurs.parcourir(aProf =>{if(!lListeProfesseursMatiere.GetElementParElement(aProf)){lListeProfesseursMatiere.add(aProf);}});});}
for(let I=0;I<aListeCahierDeTextes.GetNbrElements();I++){const lCahierDeTextes=aListeCahierDeTextes.GetElement(I);if((lCahierDeTextes.listeContenus&&lCahierDeTextes.listeContenus.GetNbrElements()>0)||(lCahierDeTextes.listeElementsProgrammeCDT&&(lCahierDeTextes.listeElementsProgrammeCDT.GetNbrElements()>0))){const lDate=GDate.GetJour(lCahierDeTextes.Date);if(!lDateCourante||!GDate.estJourEgal(lDateCourante,lDate)){if(!!lDateCourante){lHtml.push('</ul>');lHtml.push('</li>');}
lDateCourante=lDate;lEstPremierCDCDeLaDate=true;lHtml.push('<li role="listitem">');if(!aAvecFiltrage||IE.estMobile){lHtml.push('<div id="',this.idDate,GDate.FormatDate(lDateCourante,"%JJ%MM%AAAA").toString(),'" tabindex="-1">','<h5 class="ie-titre-gros souligne">',GDate.FormatDate(lDateCourante,'['+'%JJJJ %JJ %MMMM'+']').ucfirst(),'</h5>','</div>');}
lHtml.push('<ul class="liste-element" role="list">');}
lHtml.push('<li role="listitem">');lHtml.push('       <div class="conteneur-item',((aAvecFiltrage&&!IE.estMobile&&I>0)||(!lEstPremierCDCDeLaDate)?' ligne-separation':''),'">');lEstPremierCDCDeLaDate=false;if(!aAvecFiltrage){lHtml.push('<div class="entete-element">');lHtml.push('<div class="flex-contain">','<div style="background-color:',lCahierDeTextes.Matiere.CouleurFond,';margin-right:0.8rem;padding:0.2rem;border-radius:0.4rem;"></div>');lHtml.push('<div>');lHtml.push('<div class="titre-matiere">',lCahierDeTextes.Matiere.Libelle,'</div>');lHtml.push(this.composeProfesseurs(lCahierDeTextes));lHtml.push('</div>');lHtml.push('</div>');lHtml.push('<div class="ie-titre-petit">',GDate.FormatDate(lCahierDeTextes.Date,'%hh%sh%mm'),(lCahierDeTextes.DateFin?GDate.FormatDate(lCahierDeTextes.DateFin,' '+GTraductions.getValeur('A')+' %hh%sh%mm'):''),'</div>');lHtml.push('</div>');} else if(lListeProfesseursMatiere.GetNbrElements()>1){lHtml.push(this.composeProfesseurs(lCahierDeTextes));}
lHtml.push(this.composeContenu(lCahierDeTextes,aAvecFiltrage));const lOngletPublie=GEtatUtilisateur.listeOnglets.GetElementParGenre(EGenreOnglet.CDT_TAF);if(lCahierDeTextes.dateTAF&&!!lOngletPublie&&!!lOngletPublie.Actif){lHtml.push('<div class="btnCours">','<ie-bouton ie-model="appelTAF(\''+lCahierDeTextes.GetNumero()+'\')" class="themeBoutonNeutre small-bt">',GTraductions.getValeur('CahierDeTexte.voirTAF'),'</ie-bouton>','</div>');}
lHtml.push('       </div>');lHtml.push(this.composeElementsProgramme(lCahierDeTextes));lHtml.push('</li>');}}
lHtml.push('</ul>');lHtml.push('</li>');lHtml.push('</ul>');return lHtml.join('');}
composeFicheCours(aCDT,aEstChronologique=false){const lHtml=[];lHtml.push('<div class="conteneur-liste-CDT conteneur-fiche-CDT AvecSelectionTexte">');lHtml.push('<div class="conteneur-item">');lHtml.push('<div class="flex-contain">','<div style="background-color:',aCDT.CouleurFond,';margin-right:0.8rem;padding:0.2rem;border-radius:0.4rem;"></div>');lHtml.push('<div>');lHtml.push(' <div class="titre-matiere">'+aCDT.Matiere.GetLibelle()+'</div>');lHtml.push(this.composeProfesseurs(aCDT));lHtml.push('</div>');lHtml.push('</div>');lHtml.push('<div class="ie-titre-petit details">',GDate.FormatDate(aCDT.Date,'%JJJ %JJ %MMM'),GDate.FormatDate(aCDT.Date,' '+GTraductions.getValeur('De')+' %hh%sh%mm'),(aCDT.DateFin?GDate.FormatDate(aCDT.DateFin,' '+GTraductions.getValeur('A')+' %hh%sh%mm'):''),'</div>');lHtml.push(this.composeContenu(aCDT));const lOngletPublie=GEtatUtilisateur.listeOnglets.GetElementParGenre(EGenreOnglet.CDT_TAF);if(aCDT.dateTAF&&!IE.estMobile&&!aEstChronologique&&!!lOngletPublie&&!!lOngletPublie.Actif){lHtml.push('<div class="btnCours">','<ie-bouton ie-model="appelTAF(\''+aCDT.GetNumero()+'\')" class="themeBoutonNeutre small-bt">',GTraductions.getValeur('CahierDeTexte.voirTAF'),'</ie-bouton>','</div>');}
lHtml.push('</div>');lHtml.push(this.composeElementsProgramme(aCDT));lHtml.push('</div>');return lHtml.join('');}
composeProfesseurs(aCDT){if(!aCDT.listeProfesseurs||aCDT.listeProfesseurs.GetNbrElements()===0){return'';}
const lHtml=[];lHtml.push('<div class="ie-sous-titre">');for(let i=0,lNbr=aCDT.listeProfesseurs.GetNbrElements();i<lNbr;i++){lHtml.push('<div>',aCDT.listeProfesseurs.GetElement(i).GetLibelle(),'</div>');}
lHtml.push('</div>');return lHtml.join('');}
composeThemes(aCDT){if(!aCDT.ListeThemes||aCDT.ListeThemes.GetNbrElements()===0){return'';}
const lHtml=[];lHtml.push('<div>');lHtml.push('<span>',GTraductions.getValeur('Themes'),' : ','</span>');const H=[];for(let i=0,lNbr=aCDT.ListeThemes.GetNbrElements();i<lNbr;i++){H.push(aCDT.ListeThemes.GetElement(i).GetLibelle());}
lHtml.push(H.join(', '));lHtml.push('</div>');return lHtml.join('');}
composeContenu(aCDT,aAvecFiltrage){if(!aCDT.listeContenus||aCDT.listeContenus.GetNbrElements()===0){return'';}
const lHtml=[];lHtml.push('<div class="',!aAvecFiltrage?'conteneur-descriptif':'','">');for(let i=0,lNbr=aCDT.listeContenus.GetNbrElements();i<lNbr;i++){const lContenu=aCDT.listeContenus.GetElement(i);lHtml.push('<div class="m-bottom-l ',i>0?' ligne-separation':'','">');lHtml.push('<div class="entete-element ',!aAvecFiltrage?'titre-contenu':'','">');lHtml.push('<div>');if(lContenu.Libelle){lHtml.push('<div class="titre-matiere">',lContenu.GetLibelle(),'</div>');}
if(aAvecFiltrage||aCDT.ListeThemes&&aCDT.ListeThemes.GetNbrElements()){lHtml.push('<div class="ie-titre-petit titre-date">');if(aAvecFiltrage){if(IE.estMobile){lHtml.push(GDate.FormatDate(aCDT.Date,'%hh%sh%mm'),(aCDT.DateFin?GDate.FormatDate(aCDT.DateFin,' '+GTraductions.getValeur('A')+' %hh%sh%mm'):''));} else{lHtml.push(GDate.FormatDate(aCDT.Date,'['+'%JJJ %JJ %MMM'+']'));}}
lHtml.push(this.composeThemes(lContenu));lHtml.push(' </div>');}
lHtml.push('</div>');if(lContenu.categorie&&lContenu.categorie.Libelle){lHtml.push('<div><ie-chips class="tag-style">',lContenu.categorie.GetLibelle(),'</ie-chips></div>');}
lHtml.push('</div>');lHtml.push('<div class="descriptif init-html">',lContenu.descriptif,'</div>',lContenu.ListePieceJointe.GetNbrElements()?this.composePiecesJointes(lContenu):'');for(let j=0,lNbr2=lContenu.listeExecutionQCM.GetNbrElements();lContenu.listeExecutionQCM&&j<lNbr2;j++){const lExecutionQCM=lContenu.listeExecutionQCM.GetElement(j);lHtml.push('<div class="revision">',GTraductions.getValeur('ExecutionQCM.RepondreQCMContenu'),' : <i class="icon_qcm avecCouleurTheme"></i>',lExecutionQCM.QCM.GetLibelle(),' (',UtilitaireQCM.getStrResumeModalites(lExecutionQCM),') </div>');const lAvecAction=UtilitaireQCM.estCliquable(lExecutionQCM);if(lAvecAction){lHtml.push('<div class="flex-contain qcm-revision">','<ie-bouton ie-model="appelQCM(\''+lExecutionQCM.GetNumero()+'\')" class="themeBoutonSecondaire">',GTraductions.getValeur('TAFEtContenu.executerQCM'),'</ie-bouton>','</div>');}}
lHtml.push('</div>');}
lHtml.push('</div>');return lHtml.join('');}
composeElementsProgramme(aCDT){const lHtml=[];let lElementProgrammeCDT;if(aCDT.listeElementsProgrammeCDT&&aCDT.listeElementsProgrammeCDT.GetNbrElements()){lHtml.push('<div class="programme ligne-separation">');lHtml.push('  <div class="Gras">',GTraductions.getValeur('CahierDeTexte.ElementsProgramme'),' :','</div>');for(let i=0,lNbr=aCDT.listeElementsProgrammeCDT.GetNbrElements();i<lNbr;i++){lElementProgrammeCDT=aCDT.listeElementsProgrammeCDT.GetElement(i);lHtml.push('<div>-&nbsp;',lElementProgrammeCDT.GetLibelle(),'</div>');}
lHtml.push('</div>');}
return lHtml.join('');}
composePiecesJointes(aElement){const lHtml=[],lListe=aElement.ListePieceJointe;lHtml.push('<div class="piece-jointe">');for(let I=0;I<lListe.GetNbrElements();I++){const lPieceJointe=lListe.GetElement(I);lHtml.push('<span class="chips-pj">',GChaine.composerUrlLienExterne({documentJoint:lPieceJointe,maxWidth:300}),'</span>');}
lHtml.push('</div>');return lHtml.join('');}
composeTitreRessourcesPeda(){return'<div class="conteneur-titre-liste titre-espaceBas-l"><i class="icon_folder_close"></i><span class="ie-titre">'+GTraductions.getValeur('CahierDeTexte.RessourcesPedagogiques')+'</span></div>';}
composeRPSujetOuCorrige(aListeRessPeda,estDeploye){const lHtml=[];if(aListeRessPeda&&aListeRessPeda.GetNbrElements()){const lHtmlListe=[];aListeRessPeda.setTri([ObjetTri.init('Genre')]).trier();const lCacheDevoirsEvaluations={};aListeRessPeda.parcourir(function(D){if(!!D.ressource){if(!lCacheDevoirsEvaluations[D.ressource.GetNumero()]){const lStrDevoirEvaluation=[];if(D.ressource.GetGenre()===EGenreRessource.Devoir){lStrDevoirEvaluation.push(GTraductions.getValeur('CahierDeTexte.ContenuCours.RessourcesPedagogiques.DevoirDu',[GDate.FormatDate(D.date,'%JJJ %JJ %MMM')]));} else{lStrDevoirEvaluation.push(GTraductions.getValeur('CahierDeTexte.ContenuCours.RessourcesPedagogiques.EvaluationDu',[GDate.FormatDate(D.date,'%JJJ %JJ %MMM')]));}
if(!!D.ressource.commentaire){lStrDevoirEvaluation.push(' - ',D.ressource.commentaire);}
lCacheDevoirsEvaluations[D.ressource.GetNumero()]={strDevoirEvaluation:lStrDevoirEvaluation.join(''),genreDevoirEvaluation:D.ressource.GetGenre(),listeDonnees:[]};}
lCacheDevoirsEvaluations[D.ressource.GetNumero()].listeDonnees.push(D);}});let lDonnee;let lDocumentJointLien;for(const lNumeroDevoirEvaluation in lCacheDevoirsEvaluations){const lDevoirEvaluation=lCacheDevoirsEvaluations[lNumeroDevoirEvaluation];const lHtmlListeRessources=[];const lThemes=new ObjetListeElements();for(let i=0;i<lDevoirEvaluation.listeDonnees.length;i++){lDonnee=lDevoirEvaluation.listeDonnees[i];let lGenreRessourceLien;if(lDevoirEvaluation.genreDevoirEvaluation===EGenreRessource.Devoir){if(lDonnee.GetGenre()===EGenreRessourcePedagogique.sujet){lGenreRessourceLien=TypeFichierExterneHttpSco.DevoirSujet;} else{lGenreRessourceLien=TypeFichierExterneHttpSco.DevoirCorrige;}} else{if(lDonnee.GetGenre()===EGenreRessourcePedagogique.sujet){lGenreRessourceLien=TypeFichierExterneHttpSco.EvaluationSujet;} else{lGenreRessourceLien=TypeFichierExterneHttpSco.EvaluationCorrige;}}
if(lDonnee.ListeThemes&&lDonnee.ListeThemes.GetNbrElements()){lDonnee.ListeThemes.parcourir((aTheme) =>{if(!lThemes.GetElementParNumero(aTheme.GetNumero())){lThemes.add(aTheme);}});}
lDocumentJointLien=new ObjetElement(lDonnee.ressource.GetLibelle(),lDonnee.ressource.GetNumero(),EGenreDocumentJoint.Fichier);lHtmlListeRessources.push('<div class="chips-pj">',GChaine.composerUrlLienExterne({documentJoint:lDocumentJointLien,genreRessource:lGenreRessourceLien,libelleEcran:EGenreRessourcePedagogiqueUtil.getLibelleDeGenreEtNombre(lDonnee.GetGenre()),title:lDocumentJointLien.GetLibelle(),maxWidth:IE.estMobile?200:300}),'</div>');}
lHtmlListe.push('<div class="ie-titre-petit titre-date">',lDevoirEvaluation.strDevoirEvaluation,'</div>');lHtmlListe.push('<div class="piece-jointe-ressource">','<div class="conteneur-chips-relies">',lHtmlListeRessources.join(''),'</div>',lThemes.GetNbrElements()?'<div class="pj-theme">'+GTraductions.getValeur('Themes')+' : '+lThemes.getTableauLibelles().join(', ')+'</div>':'','</div>');}
if(lHtmlListe.length){lHtml.push('<div ',IE.estMobile?'':'ie-node="nodeDeploiement" ','class="titre-matiere titre-ressource">',IE.estMobile?'':('<div class="conteneur-chevron"><i class="'+(!estDeploye?'icon_chevron_right':'icon_chevron_down')+'"></i></div>'),'<div>',GTraductions.getValeur('CahierDeTexte.ContenuCours.RessourcesPedagogiques.SujetsEtCorrige'),(IE.estMobile?'':' ('+aListeRessPeda.GetNbrElements()+')'),'</div></div>');lHtml.push('<div ',!estDeploye?'style="display:none"':'','>',lHtmlListe.join(''),'</div>');}}
return lHtml.join('');}
composeRPTravailRendu(aListeRessPeda,estDeploye,aControleur){const lHtml=[];if(aListeRessPeda&&aListeRessPeda.GetNbrElements()){const lHtmlListe=[];aListeRessPeda.parcourir(function(D){let lStrTravailARendre='';if(!!D.ressource&&!!D.ressource.pourLe){lStrTravailARendre=GDate.FormatDate(D.date,'[%JJJ %JJ %MMM]');}
const lHtmlListeRessources=[];lHtmlListeRessources.push('<div class="ie-titre-petit titre-date">',lStrTravailARendre,'</div>');if(!!D.ressource&&(!!D.ressource.documentCorrige||!!D.ressource.commentaireCorrige)){lHtmlListeRessources.push('<div class="conteneur-chips-relies">');}
lHtmlListeRessources.push('<div class="chips-pj">',GChaine.composerUrlLienExterne({documentJoint:D.ressource,genreRessource:TypeFichierExterneHttpSco.TAFRenduEleve,libelleEcran:GTraductions.getValeur('CahierDeTexte.TAFARendre.Eleve.CopieDeposee'),title:D.ressource.GetLibelle(),maxWidth:IE.estMobile?200:300}),'</div>');if(!!D.ressource&&(!!D.ressource.documentCorrige||!!D.ressource.commentaireCorrige)){lHtmlListeRessources.push('<div class="chips-pj">');if(!D.ressource.commentaireCorrige){lHtmlListeRessources.push(GChaine.composerUrlLienExterne({documentJoint:D.ressource.documentCorrige,genreRessource:TypeFichierExterneHttpSco.TAFCorrigeRenduEleve,libelleEcran:GTraductions.getValeur('CahierDeTexte.TAFARendre.Eleve.CopieCorrigeeParEnseignant'),afficherIconeDocument:false,maxWidth:IE.estMobile?200:300}));} else{lHtmlListeRessources.push('<ie-chips ',_composeIEModelChipsOuvrirFenetreCorrectionTAF.call(this,{documentCorrige:D.ressource.documentCorrige,commentaireCorrige:D.ressource.commentaireCorrige},aControleur),'>',GTraductions.getValeur('CahierDeTexte.TAFARendre.Eleve.CorrectionDeLEnseignant'),'</ie-chips>');}
lHtmlListeRessources.push('</div>','</div>');}
lHtmlListe.push('<div class="piece-jointe-ressource">',lHtmlListeRessources.join(''),D.ListeThemes&&D.ListeThemes.GetNbrElements()?'<div class="pj-theme">'+GTraductions.getValeur('Themes')+' : '+D.ListeThemes.getTableauLibelles().join(', ')+'</div>':'','</div>');});if(lHtmlListe.length){lHtml.push('<div ',IE.estMobile?'':'ie-node="nodeDeploiement" ','class="titre-matiere titre-ressource">',IE.estMobile?'':('<div class="conteneur-chevron"><i class="'+(!estDeploye?'icon_chevron_right':'icon_chevron_down')+'"></i></div>'),'<div>',GTraductions.getValeur('CahierDeTexte.ContenuCours.RessourcesPedagogiques.TravauxRendus'),(IE.estMobile?'':' ('+aListeRessPeda.GetNbrElements()+')'),'</div></div>');lHtml.push('<div ',!estDeploye?'style="display:none"':'','>',lHtmlListe.join(''),'</div>');}}
return lHtml.join('');}
composeRPQCM(aListeRessPeda,estDeploye){const lHtml=[];if(aListeRessPeda&&aListeRessPeda.GetNbrElements()){const lHtmlListe=[],lHtmlQCMCorrige=[],lHtmlQCMRevisionEtTAF=[];let lCptRevision=0,lCptCorrige=0;aListeRessPeda.parcourir(function(D){const lStrQCM=GDate.FormatDate(D.date,'[%JJJ %JJ %MMM]');const lHintQCM=GTraductions.getValeur('CahierDeTexte.ContenuCours.RessourcesPedagogiques.QCMDu',[GDate.FormatDate(D.date,'%JJJ %JJ %MMM')]);const lHtmlListeRessources=[];lHtmlListeRessources.push('<div class="chips-pj">','<ie-chips style="max-width:',IE.estMobile?'200':'300','px;" ie-model="appelQCMRessource(\'',D.ressource.GetNumero(),'\')"><i class="icon_qcm EspaceDroit AlignementMilieuVertical"></i>',D.ressource.QCM.GetLibelle(),'</ie-chips>','<span title="',lHintQCM,'" class="ie-titre-petit titre-date">',lStrQCM,'</span>','</div>');const lQCM=['<div class="piece-jointe-ressource pj-qcm">',lHtmlListeRessources.join(''),D.ressource.ListeThemes&&D.ressource.ListeThemes.GetNbrElements()?'<div class="pj-theme">'+GTraductions.getValeur('Themes')+' : '+D.ressource.ListeThemes.getTableauLibelles().join(', ')+'</div>':'','</div>'
];const lEstQCMRevision=!D.ressource.estLieADevoir&&!D.ressource.estLieAEvaluation&&!D.ressource.estUnTAF;if(lEstQCMRevision||(D.ressource.estUnTAF&&!D.ressource.publierCorrige)){lHtmlQCMRevisionEtTAF.push(lQCM.join(''));lCptRevision++;} else if(D.ressource.estLieADevoir||D.ressource.estLieAEvaluation||D.ressource.publierCorrige){lHtmlQCMCorrige.push(lQCM.join(''));lCptCorrige++;} else{}});if(lHtmlQCMRevisionEtTAF.length){lHtmlListe.push('<div class="titre-matiere sousCategorie titre-qcm">',GTraductions.getValeur('CahierDeTexte.ContenuCours.RessourcesPedagogiques.QCMRevisionEtTAF'),(IE.estMobile?'':' ('+lCptRevision+')'),'</div>');lHtmlListe.push(lHtmlQCMRevisionEtTAF.join(''));}
if(lHtmlQCMCorrige.length){lHtmlListe.push('<div class="titre-matiere sousCategorie titre-qcm">',GTraductions.getValeur('CahierDeTexte.ContenuCours.RessourcesPedagogiques.QCMCorriges'),(IE.estMobile?'':' ('+lCptCorrige+')'),'</div>');lHtmlListe.push(lHtmlQCMCorrige.join(''));}
if(lHtmlListe.length){lHtml.push('<div ',IE.estMobile?'':'ie-node="nodeDeploiement" ','class="titre-matiere titre-ressource">',IE.estMobile?'':('<div class="conteneur-chevron"><i class="'+(!estDeploye?'icon_chevron_right':'icon_chevron_down')+'"></i></div>'),'<div>',GTraductions.getValeur('CahierDeTexte.ContenuCours.RessourcesPedagogiques.QCMDEntrainement'),(IE.estMobile?'':' ('+aListeRessPeda.GetNbrElements()+')'),'</div></div>');lHtml.push('<div class="conteneur-qcm" ',!estDeploye?'style="display:none"':'','>',lHtmlListe.join(''),'</div>');}}
return lHtml.join('');}
composeRPForumPedagogique(aListeRessPeda,estDeploye){const lHtml=[];if(aListeRessPeda&&aListeRessPeda.GetNbrElements()){const lHtmlListe=[];aListeRessPeda.parcourir(function(D){lHtmlListe.push(tag('div',{class:'piece-jointe-ressource'},tag('div',{class:'chips-pj'},tag('ie-chips',{style:`max-width:${IE.estMobile?200:300}px;`,'ie-model':tag.funcAttr('appelForumRessource',[D.ressource.GetNumero()])},tag('i',{class:'icon_forum EspaceDroit AlignementMilieuVertical'}),D.ressource.GetLibelle()||GTraductions.getValeur('ForumPeda.SansTitre')),D.date?tag('span',{class:'ie-titre-petit titre-date'},GTraductions.getValeur('ForumPeda.DernierPost')+' : '+GDate.FormatDate(D.date,'[%JJJ %JJ %MMM]')):''),D.ListeThemes&&D.ListeThemes.GetNbrElements()?tag('div',{class:'pj-theme'},GTraductions.getValeur('Themes')+' : '+D.ListeThemes.getTableauLibelles().join(', ')):''));});if(lHtmlListe.length){lHtml.push('<div ',IE.estMobile?'':'ie-node="nodeDeploiement" ','class="titre-matiere titre-ressource">',IE.estMobile?'':('<div class="conteneur-chevron"><i class="'+(!estDeploye?'icon_chevron_right':'icon_chevron_down')+'"></i></div>'),'<div>',GTraductions.getValeur('CahierDeTexte.ContenuCours.RessourcesPedagogiques.MesForumsPedagogiques'),(IE.estMobile?'':' ('+aListeRessPeda.GetNbrElements()+')'),'</div></div>');lHtml.push('<div ',!estDeploye?'style="display:none"':'','>',lHtmlListe.join(''),'</div>');}}
return lHtml.join('');}
composeRPRessourcesGranulaires(aListeRessPeda,estDeploye){const lHtml=[];if(aListeRessPeda&&aListeRessPeda.GetNbrElements()){const lHtmlListe=[];aListeRessPeda.parcourir(function(D){let lStrDocumentDeposeLe='',lHintDocumentDeposeLe='';if(!!D.ressource&&!!D.date){lStrDocumentDeposeLe=GDate.FormatDate(D.date,'[%JJJ %JJ %MMM]');lHintDocumentDeposeLe=GTraductions.getValeur('CahierDeTexte.ContenuCours.RessourcesPedagogiques.DocumentDeposeLe',[GDate.FormatDate(D.date,'%JJJ %JJ %MMM')]);}
const lHtmlListeRessources=[];lHtmlListeRessources.push('<div class="chips-pj">',EGenreRessourcePedagogiqueUtil.composerURL(D.GetGenre(),D.ressource,(D.ressource.GetLibelle?D.ressource.GetLibelle():D.ressource),false,IE.estMobile?200:300),'<span title="',lHintDocumentDeposeLe,'" class="ie-titre-petit titre-date">',lStrDocumentDeposeLe,'</span>','</div>');lHtmlListe.push('<div class="piece-jointe-ressource">',lHtmlListeRessources.join(''),'</div>');});if(lHtmlListe.length){lHtml.push('<div ',IE.estMobile?'':'ie-node="nodeDeploiement" ','class="titre-matiere titre-ressource">',IE.estMobile?'':('<div class="conteneur-chevron"><i class="'+(!estDeploye?'icon_chevron_right':'icon_chevron_down')+'"></i></div>'),'<div>',GTraductions.getValeur('CahierDeTexte.ContenuCours.RessourcesPedagogiques.RessourcesGranulaires'),(IE.estMobile?'':' ('+aListeRessPeda.GetNbrElements()+')'),'</div></div>');lHtml.push('<div ',!estDeploye?'style="display:none"':'','>',lHtmlListe.join(''),'</div>');}}
return lHtml.join('');}
composeRPAutre(aListeRessPeda,estDeploye){const lHtml=[];if(aListeRessPeda&&aListeRessPeda.GetNbrElements()){const lHtmlListe=[];aListeRessPeda.parcourir(function(D){let lStrDocumentDeposeLe='',lHintDocumentDeposeLe='';if(!!D.ressource&&!!D.date){lStrDocumentDeposeLe=GDate.FormatDate(D.date,'[%JJJ %JJ %MMM]');lHintDocumentDeposeLe=GTraductions.getValeur('CahierDeTexte.ContenuCours.RessourcesPedagogiques.DocumentDeposeLe',[GDate.FormatDate(D.date,'%JJJ %JJ %MMM')]);}
const lHtmlListeRessources=[];lHtmlListeRessources.push('<div class="chips-pj">',EGenreRessourcePedagogiqueUtil.composerURL(D.GetGenre(),D.ressource,(D.ressource.GetLibelle?D.ressource.GetLibelle():D.ressource),false,IE.estMobile?200:300),'<span title="',lHintDocumentDeposeLe,'" class="ie-titre-petit titre-date">',lStrDocumentDeposeLe,'</span>','</div>');lHtmlListe.push('<div class="piece-jointe-ressource">',lHtmlListeRessources.join(''),D.ListeThemes&&D.ListeThemes.GetNbrElements()?'<div class="pj-theme">'+GTraductions.getValeur('Themes')+' : '+D.ListeThemes.getTableauLibelles().join(', ')+'</div>':'','</div>');});if(lHtmlListe.length){lHtml.push('<div ',IE.estMobile?'':'ie-node="nodeDeploiement" ','class="titre-matiere titre-ressource">',IE.estMobile?'':('<div class="conteneur-chevron"><i class="'+(!estDeploye?'icon_chevron_right':'icon_chevron_down')+'"></i></div>'),'<div>',GTraductions.getValeur('CahierDeTexte.ContenuCours.RessourcesPedagogiques.AutresDocuments'),(IE.estMobile?'':' ('+aListeRessPeda.GetNbrElements()+')'),'</div></div>');lHtml.push('<div ',!estDeploye?'style="display:none"':'','>',lHtmlListe.join(''),'</div>');}}
return lHtml.join('');}
composeMN(aListeManuelsNumeriques,aFiltreMatiere,estDeploye){const lHtml=[];if(aListeManuelsNumeriques&&aListeManuelsNumeriques.GetNbrElements()){const lHtmlListe=[];let lCptManuels=0;aListeManuelsNumeriques.parcourir(function(D){const lHtmlListeRessources=[];let lAccepteRessNum=false;if(!aFiltreMatiere&&(!D.listeMatieres||D.listeMatieres.GetNbrElements()===0)){lAccepteRessNum=true;} else if(!!aFiltreMatiere&&!!D.listeMatieres.GetElementParNumero(aFiltreMatiere.GetNumero())){lAccepteRessNum=true;}
if(lAccepteRessNum){lHtmlListeRessources.push('<div class="chips-pj">',GChaine.composerUrlLienExterne({documentJoint:D,title:D.description,libelleEcran:D.titre,libelle:'',maxWidth:IE.estMobile?200:300}),'</div>');lHtmlListe.push('<div class="piece-jointe-ressource">',lHtmlListeRessources.join(''),'</div>');lCptManuels++;}});if(lHtmlListe.length){lHtml.push('<div ',IE.estMobile?'':'ie-node="nodeDeploiement" ','class="titre-matiere titre-manuel">',IE.estMobile?'':('<div class="conteneur-chevron"><i class="'+(!estDeploye?'icon_chevron_right':'icon_chevron_down')+'"></i></div>'),'<div>',GTraductions.getValeur('CahierDeTexte.ConsulterLesManuelsNumeriques'),(IE.estMobile?'':' ('+lCptManuels+')'),'</div></div>');lHtml.push('<div ',!estDeploye?'style="display:none"':'','>',lHtmlListe.join(''),'</div>');}}
return lHtml.join('');}}
function _composeIEModelChipsOuvrirFenetreCorrectionTAF(aTaf,aControleur){const H=[];if(!!aTaf&&(!!aTaf.documentCorrige||!!aTaf.commentaireCorrige)){if(!aControleur){return'';}
if(!aControleur.chipsOuvrirFenetreCorrectionTAF){aControleur.chipsOuvrirFenetreCorrectionTAF={event:function(){if(!!aTaf){const lFenetreCorrectionTaf=ObjetFenetre.creerInstance(ObjetFenetre_CorrectionTaf,{pere:this});lFenetreCorrectionTaf.setTAF(aTaf);lFenetreCorrectionTaf.Afficher();}}};}
H.push(GHtml.composeAttr('ie-model','chipsOuvrirFenetreCorrectionTAF'));}
return H.join('');}
module.exports=UtilitaireContenuDeCours;},fn:"utilitairecontenudecours.js"});;
IE.fModule({f:function(exports,require,module,global){const{TypeDroits}=require('ObjetDroitsPN.js');const MethodesTableau=require('MethodesTableau.js');const{GDate}=require('ObjetDate.js');const GTraductions=require('ObjetTraduction.js');const TUtilitaireDuree=require('UtilitaireDuree.js');const GestionnaireBlocPN=require('GestionnaireBlocPN.js').GestionnaireBlocPN;const ObjetBlocPN=require('GestionnaireBlocPN.js').ObjetBlocPN;const EGenreBloc=require('Enumere_Bloc.js').EGenreBloc;const EModeAffichage=require('Enumere_ModeAffichageTimeline.js');const EGenreOnglet=require('Enumere_Onglet.js');const EGenreEspace=require('Enumere_Espace.js');const EGenreEtat=require('Enumere_Etat.js');const GChaine=require('GChaine.js');const TypeNiveauDifficulte=require('TypeNiveauDifficulte.js').TypeNiveauDifficulte;const TypeGenreRenduTAF=require('TypeGenreRenduTAF.js').TypeGenreRenduTAF;const EGenreBoutonBloc=require('UtilitaireBloc.js').EGenreBoutonBloc;const ObjetListeElements=require('ObjetListeElements.js');const ObjetElement=require('ObjetElement.js');const ObjetRequeteSaisieTAFFaitEleve=require('ObjetRequeteSaisieTAFFaitEleve.js');const ObjetRequeteSaisieTAFARendreEleve=require('ObjetRequeteSaisieTAFARendreEleve.js');const UtilitaireQCM=require('UtilitaireQCM.js').UtilitaireQCM;const TypeFichierExterneHttpSco=require('TypeFichierExterneHttpSco.js').TypeFichierExterneHttpSco;const ObjetFenetre=require('ObjetFenetre.js');const ObjetFenetre_CorrectionTaf=require('ObjetFenetre_CorrectionTaf.js');const EGenreBtnActionBlocTAF={documentRendu:1,executionQCM:2,consulter:3,tafFait:4,executionKiosque:5,voirQCM:6,voirContenu:7,detailTAF:8,consulterCorrige:9};class GestionnaireBlocTAF extends GestionnaireBlocPN{constructor(...aParams){super(...aParams);this.setGenreBloc(EGenreBloc.TravailAFaire);const lOptions={modeAffichage:EModeAffichage.classique,initPlie:false,callBackTitre:undefined};$.extend(this._options,lOptions);}
getParamsBloc(aDataBloc){const lInstanceMetier=this.getInstanceObjetMetier(aDataBloc,ObjetBlocTAF);const lParamBloc=lInstanceMetier.getParamsBloc();$.extend(lParamBloc,{htmlContenu:this.composeZoneInstance(lInstanceMetier)});return lParamBloc;}}
class ObjetBlocTAF extends ObjetBlocPN{constructor(...aParams){super(...aParams);this.peuFaireTAF=MethodesTableau.existe(GEtatUtilisateur.GenreEspace,[EGenreEspace.Eleve,EGenreEspace.Mobile_Eleve]);this.pourEleve=MethodesTableau.existe(GEtatUtilisateur.GenreEspace,[EGenreEspace.Eleve,EGenreEspace.Mobile_Eleve,EGenreEspace.Parent,EGenreEspace.Mobile_Parent,EGenreEspace.Accompagnant,EGenreEspace.Mobile_Accompagnant,EGenreEspace.Tuteur,EGenreEspace.Mobile_Tuteur]);this.avecDetailTAF=GEtatUtilisateur.GenreEspace===EGenreEspace.Professeur;this.utilitaireCDT=new(require('ObjetUtilitaireCahierDeTexte.js'))(this.Nom+'.utilitaireCDT',this);}
getControleur(aInstance){return $.extend(true,super.getControleur(this),{btnAction:{event:function(aIndice,aEvent){const lDonnee=aInstance.getDonnee();switch(aIndice){case EGenreBtnActionBlocTAF.documentRendu:aInstance.utilitaireCDT.execFicheSelecFile.call(aInstance,lDonnee);break;case EGenreBtnActionBlocTAF.voirQCM:case EGenreBtnActionBlocTAF.executionQCM:case EGenreBtnActionBlocTAF.voirContenu:case EGenreBtnActionBlocTAF.detailTAF:aInstance.declencherCallback({donnee:lDonnee,genreEvnt:aIndice,param:{event:aEvent}});break;case EGenreBtnActionBlocTAF.executionKiosque:if(!!lDonnee){aInstance.declencherCallback({donnee:lDonnee,genreEvnt:aIndice,param:{}});}
break;}}},chipsAction:{event:function(aGenreActionChips){const lDonnee=aInstance.getDonnee();switch(aGenreActionChips){case EGenreBtnActionBlocTAF.consulter:window.open(GChaine.creerUrlBruteLienExterne(lDonnee.documentRendu,{genreRessource:TypeFichierExterneHttpSco.TAFRenduEleve}));break;case EGenreBtnActionBlocTAF.consulterCorrige:if(!!lDonnee.documentCorrige||!!lDonnee.commentaireCorrige){if(!lDonnee.commentaireCorrige){window.open(GChaine.creerUrlBruteLienExterne(lDonnee.documentCorrige,{genreRessource:TypeFichierExterneHttpSco.TAFCorrigeRenduEleve}));} else{const lFenetreCorrectionTaf=ObjetFenetre.creerInstance(ObjetFenetre_CorrectionTaf,{pere:aInstance});lFenetreCorrectionTaf.setTAF(lDonnee);lFenetreCorrectionTaf.Afficher();}}
break;}},eventBtn:function(aGenreActionChips){const lDonnee=aInstance.getDonnee();switch(aGenreActionChips){case EGenreBtnActionBlocTAF.consulter:aInstance.surSupprimer(lDonnee.GetNumero());break;}},getOptions:function(aGenreActionChips){let lPeutSupprimer=false;switch(aGenreActionChips){case EGenreBtnActionBlocTAF.consulter:{const lDonnee=aInstance.getDonnee();lPeutSupprimer=(aInstance.peuFaireTAF&&lDonnee.peuRendre);break;}}
const lOptions={};if(!lPeutSupprimer){lOptions.avecBtn=false;}
return lOptions;}},cbFait:{getValue:function(){const lTAF=aInstance.getDonnee();return lTAF.TAFFait||lTAF.QCMFait;},getHint:function(){const lTAF=aInstance.getDonnee();return lTAF.TAFFait||lTAF.QCMFait?GTraductions.getValeur('accueil.hintTravailFait'):GTraductions.getValeur('accueil.hintTravailAFaire');},setValue:function(aValue){const lTAF=aInstance.getDonnee();lTAF.TAFFait=aValue;lTAF.SetEtat(EGenreEtat.Modification);const lListe=new ObjetListeElements();lListe.AddElement(lTAF);new ObjetRequeteSaisieTAFFaitEleve(aInstance,aInstance._actionSurRequeteSaisieTAFFaitEleve.bind(aInstance)).lancerRequete({listeTAF:lListe});},getDisabled:function(){const lTAF=aInstance.getDonnee();return!_estAvecCocheTAFFait.call(aInstance,lTAF);},node:function(){$(this.node).on({'click':function(event){event.stopPropagation();}});}},btnSelecFile:{getOptionsSelecFile:function(){return{maxSize:GApplication.droits.get(TypeDroits.tailleMaxRenduTafEleve)};},addFiles:this.evenementSurSelecFile.bind(this)}});}
_actionSurRequeteSaisieTAFFaitEleve(){this.declencherCallback({donnee:this.getDonnee(),genreEvnt:EGenreBtnActionBlocTAF.tafFait,param:{}});}
ConstruireStructureAffichage(){const H=[];if(this.donneesRecues&&this.donnee){const lDonnee=this.getDonnee();if(lDonnee){let lStyle=' style="overflow:auto; max-width:'+($('#'+this.Nom.escapeJQ()).outerWidth(true)-10)+'px;"';if(this._options.estfenetre){lStyle=' style="overflow:auto; max-width:'+(GNavigateur.EcranL-100-20-10-this.getWidthBtnAction())+'px;"';}
H.push('<div>');if(lDonnee.titreKiosque){H.push('<div class="Image_Kiosque_ListeCahierTexte InlineBlock AlignementMilieuVertical MargeGauche"></div>');}
if(lDonnee.executionQCM){H.push('<i class="icon_qcm avecCouleurTheme AlignementMilieuVertical"></i>');}
H.push('<div class="EspaceGauche EspaceDroit AlignementMilieuVertical PourFenetreBloc_Contenu AvecSelectionTexte"',lStyle,'>',lDonnee.descriptif,'</div>');H.push('</div>');}}
return H.join('');}
getDonnee(){const lRessource=this.donnee&&this.donnee.ressources&&this.donnee.ressources.GetPremierElement()?this.donnee.ressources.GetPremierElement():null;return lRessource?lRessource.elementOriginal:undefined;}
estBlocFerme(){return this._options.initPlie;}
eventPropagationTitre(event){if((this._options.modeAffichage===EModeAffichage.grille)&&event.target&&!event.target.className.includes('celluleMarqueur')){if(this._options.callBackTitre){this.callbackTitre();}
event.stopPropagation();}}
getCouleurMarqueur(){return this.donnee.CouleurFond;}
getTitre(){const lHtml=[];const lColor=this._options.modeAffichage===EModeAffichage.grille?GCouleur.themeNeutre.foncee:'#FFCC00';const lDonnee=this.getDonnee();if(lDonnee&&lDonnee.niveauDifficulte){lHtml.push('<div style="float:right;" class="AlignementMilieuVertical SansMain" title="',GTraductions.getValeur('CahierDeTexte.NiveauDifficulte'),'">',TypeNiveauDifficulte.getImage({niveauDifficulte:lDonnee.niveauDifficulte,color:lColor,avecTitle:true}),'</div>');}
if(this._options.modeAffichage!==EModeAffichage.compact){lHtml.push('<div class="AlignementMilieuVertical">',(this.donnee?this.donnee.GetLibelle():''),'</div>');}
return lHtml.join('');}
callbackTitre(){if(this._options.callBackTitre){this._options.callBackTitre(this.donnee);}}
getInfoSsTitre(){const T=[];const lDonnee=this.getDonnee();if(lDonnee){const lDonneeLe=lDonnee?lDonnee.DonneLe:null;const lPourLe=this.donnee.Date;const lNbJours=GDate.GetDifferenceJours(lPourLe,lDonneeLe);const lStrJours=(lNbJours>1?GTraductions.getValeur('TAFEtContenu.jours'):GTraductions.getValeur('TAFEtContenu.jour')).toLowerCase();if(lDonnee&&(lDonnee.duree||(lDonnee.executionQCM&&lDonnee.executionQCM.dureeMaxQCM))){let lDuree=lDonnee.duree;if(lDonnee.executionQCM&&lDonnee.executionQCM.dureeMaxQCM){const lMinutes=TUtilitaireDuree.dureeEnMin(lDonnee.executionQCM.dureeMaxQCM);const lMinutesSupplementaire=lDonnee.executionQCM.dureeSupplementaire>0?TUtilitaireDuree.dureeEnMin(lDonnee.executionQCM.dureeSupplementaire):0;lDuree=lMinutes+lMinutesSupplementaire;}
const lFormatMin=lDuree>60?'%mm':'%xm';const lStrDuree=GDate.FormatDureeEnMillisecondes(lDuree*60*1000,lDuree>60?'%xh%sh'+lFormatMin:lFormatMin+'mn');T.push('<div style="float:right;" class="AlignementMilieuVertical SansMain" title="',GTraductions.getValeur('CahierDeTexte.DureeEstimee'),'">',lStrDuree,'</div>');}
let lSpanDonneeLe='<span>'+GTraductions.getValeur('TAFEtContenu.donneLe')+GDate.FormatDate(lDonneeLe,' %JJ/%MM')+'</span>';const lLibelleSousTitre=[];if(this._options.pourLe){if(lDonnee.PourLe){lLibelleSousTitre.push('<span>',GTraductions.getValeur('CahierDeTexte.pourLe'),GDate.FormatDate(lDonnee.PourLe,' %JJ/%MM'),'</span>');}
if(this._options.avecPourLeEtDonneeLe){if(lLibelleSousTitre.length>0){lLibelleSousTitre.push(', ');lSpanDonneeLe=lSpanDonneeLe.toLowerCase();}
lLibelleSousTitre.push(lSpanDonneeLe);}} else{lLibelleSousTitre.push(lSpanDonneeLe);}
lLibelleSousTitre.push('<span> [',lNbJours,' ',lStrJours,']</span>');T.push('<div class="AlignementMilieuVertical">',lLibelleSousTitre.join(''),'</div>');}
return{avecInfo:true,strInfo:T.join('')};}
avecOmbre(){return this._options.modeAffichage!==EModeAffichage.grille&&(this._options.avecOmbre!==false);}
cacherBoutonContenu(){return this._options.cacherBoutonContenu;}
avecBordure(){return this._options.modeAffichage===EModeAffichage.grille&&this._options.avecBordure;}
getWidthColDroite(){return super.getWidthColDroite(190);}
getWidthBtnAction(){return super.getWidthBtnAction(165);}
getAvecDocuments(){const lDonnee=this.getDonnee();return lDonnee&&(lDonnee.ListePieceJointe!==undefined)&&(lDonnee.ListePieceJointe.GetNbrElements()>0);}
getListeDocuments(){const lDonnee=this.getDonnee();return lDonnee&&lDonnee.ListePieceJointe?lDonnee.ListePieceJointe:new ObjetListeElements();}
getDocument(I){const lDonnee=this.getDonnee();return lDonnee.ListePieceJointe.GetElement(I);}
getInfoTitre(){const lStrInfoTitre=[];lStrInfoTitre.push(_composeSliderTAFFait.call(this,this.getDonnee()));return{avecInfo:this.pourEleve&&this._options.modeAffichage!==EModeAffichage.grille,strInfo:lStrInfoTitre.join('')};}
getTabBtnActions(){if(this._options.modeAffichage===EModeAffichage.grille){return[];}
const lResult=[];const lDonnee=this.getDonnee();const lAvecERendu=TypeGenreRenduTAF.estUnRenduEnligne(lDonnee.genreRendu);const lAvecERenduPronote=lAvecERendu&&TypeGenreRenduTAF.estUnRenduEnligne(lDonnee.genreRendu,false);const lAvecPRendu=TypeGenreRenduTAF.estUnRenduPapier(lDonnee.genreRendu);const lSansRendu=TypeGenreRenduTAF.estSansRendu(lDonnee.genreRendu);let lLibelle,lGenre;if(lAvecERendu){if(!!lDonnee.documentRendu){lLibelle=TypeGenreRenduTAF.getLibelleConsultation(lDonnee.genreRendu);lGenre=EGenreBtnActionBlocTAF.consulter;lResult.push({libelle:_composeLibelleBouton.call(this,lDonnee.genreRendu,lLibelle),genreBtn:lGenre,genreAffichage:EGenreBoutonBloc.chips});}
if(!!lDonnee.documentCorrige||!!lDonnee.commentaireCorrige){if(!lDonnee.documentCorrige){lLibelle=GTraductions.getValeur('CahierDeTexte.TAFARendre.Eleve.CorrectionDeLEnseignant');} else{lLibelle=GTraductions.getValeur('CahierDeTexte.TAFARendre.Eleve.CopieCorrigeeParEnseignant');}
lGenre=EGenreBtnActionBlocTAF.consulterCorrige;lResult.push({libelle:_composeLibelleBouton.call(this,lDonnee.genreRendu,lLibelle),genreBtn:lGenre,genreAffichage:EGenreBoutonBloc.chips});}}
if(lAvecERendu&&((lDonnee.peuRendre&&!lDonnee.documentRendu)||!this.pourEleve)){if(this.avecDetailTAF&&lDonnee.avecRendu){lLibelle=GTraductions.getValeur('CahierDeTexte.TAFARendre.RenduPar')+' '+lDonnee.nbrRendus+'/'+lDonnee.nbrEleves;lGenre=EGenreBtnActionBlocTAF.detailTAF;lResult.push({libelle:_composeLibelleBouton.call(this,lDonnee.genreRendu,lLibelle),genreBtn:lGenre,genreAffichage:(lDonnee.estProfDuCours?EGenreBoutonBloc.bouton:EGenreBoutonBloc.texte)});} else{lLibelle=TypeGenreRenduTAF.getLibelleDeposer(lDonnee.genreRendu,this.peuFaireTAF);if(this.peuFaireTAF){lGenre=lAvecERenduPronote?EGenreBtnActionBlocTAF.documentRendu:EGenreBtnActionBlocTAF.executionKiosque;lResult.push({libelle:_composeLibelleBouton.call(this,lDonnee.genreRendu,lLibelle),genreBtn:lGenre,genreAffichage:EGenreBoutonBloc.bouton});} else{lResult.push({libelle:_composeLibelleBouton.call(this,lDonnee.genreRendu,lLibelle,true),genreAffichage:EGenreBoutonBloc.texte});}}}
if(lAvecPRendu){if(this.avecDetailTAF&&lDonnee.avecRendu){lLibelle=GTraductions.getValeur('CahierDeTexte.TAFARendre.RenduPar')+' '+lDonnee.nbrRendus+'/'+lDonnee.nbrEleves;lGenre=EGenreBtnActionBlocTAF.detailTAF;lResult.push({libelle:_composeLibelleBouton.call(this,lDonnee.genreRendu,lLibelle),genreBtn:lGenre,genreAffichage:(lDonnee.estProfDuCours?EGenreBoutonBloc.bouton:EGenreBoutonBloc.texte)});} else{lResult.push({libelle:_composeLibelleBouton.call(this,lDonnee.genreRendu,TypeGenreRenduTAF.getLibelleDeposer(lDonnee.genreRendu),true),genreAffichage:EGenreBoutonBloc.texte});}}
if(lSansRendu){if(this.avecDetailTAF){lLibelle=GTraductions.getValeur('CahierDeTexte.TAFARendre.FaitPar')+' '+lDonnee.nbrFaitsSelonEleve+'/'+lDonnee.nbrEleves;lGenre=EGenreBtnActionBlocTAF.detailTAF;lResult.push({libelle:_composeLibelleBouton.call(this,lDonnee.genreRendu,lLibelle),genreBtn:lGenre,genreAffichage:(lDonnee.estProfDuCours?EGenreBoutonBloc.bouton:EGenreBoutonBloc.texte)});}}
if(this.pourEleve&&lDonnee.executionQCM&&UtilitaireQCM.estCliquable(lDonnee.executionQCM)){if(!lDonnee.QCMFait){if(lDonnee.executionQCM.estEnPublication){lResult.push({libelle:GTraductions.getValeur('TAFEtContenu.executerQCM'),genreBtn:EGenreBtnActionBlocTAF.executionQCM});}} else{lResult.push({libelle:GTraductions.getValeur('TAFEtContenu.voirQCM'),genreBtn:EGenreBtnActionBlocTAF.voirQCM});}}
const lOngletPublie=GEtatUtilisateur.listeOnglets.GetElementParGenre(EGenreOnglet.CDT_Contenu);if(lDonnee&&lDonnee.cahierDeTextes&&lDonnee.cahierDeTextes.existeNumero()&&!this._options.cacherBoutonContenu&&!!lOngletPublie&&!!lOngletPublie.Actif){lResult.push({libelle:GTraductions.getValeur('CahierDeTexte.TAFARendre.VoirContenu'),genreBtn:EGenreBtnActionBlocTAF.voirContenu});}
return lResult;}
declencherCallback(aParam){if(this.Pere&&this.Evenement){this.callback.appel(aParam.donnee,aParam.genreEvnt,aParam.param);}}
surSupprimer(aNumeroTAF){const lFichier=new ObjetElement(),lListeFichiers=new ObjetListeElements();lListeFichiers.AddElement(lFichier,0);lFichier.TAF=new ObjetElement('',aNumeroTAF);lFichier.SetEtat(EGenreEtat.Suppression);new ObjetRequeteSaisieTAFARendreEleve(this,this.actionSurRequeteSaisieTAFARendreEleve).lancerRequete(lListeFichiers);}
evenementSurSelecFile(aParams,aParamsInput){const lFichier=aParamsInput?aParamsInput.eltFichier:new ObjetElement(),lListeFichiers=new ObjetListeElements();const lTAF=this.getDonnee();if(lFichier){lListeFichiers.AddElement(lFichier,0);lFichier.TAF=new ObjetElement('',lTAF.GetNumero());lFichier.SetEtat(EGenreEtat.Modification);}
new ObjetRequeteSaisieTAFARendreEleve(this,this.actionSurRequeteSaisieTAFARendreEleve).addUpload({listeFichiers:lListeFichiers}).lancerRequete(lListeFichiers);}
evenementSurSelecFilePhoto(aParams,aParamsInput){const lListeFichiers=new ObjetListeElements();const lFichiers=aParamsInput.listeFichiers;const lTAF=this.getDonnee();if(!!lFichiers&&(lFichiers.GetNbrElements()>0)){for(let x=0;x<lFichiers.GetNbrElements();x++){const lFichier=lFichiers.GetElement(x);lFichier.TAF=new ObjetElement('',lTAF.GetNumero());lFichier.SetEtat(EGenreEtat.Creation);lListeFichiers.AddElement(lFichier);}}}
actionSurRequeteSaisieTAFARendreEleve(){this.declencherCallback({donnee:this.getDonnee(),genreEvnt:EGenreBtnActionBlocTAF.documentRendu,param:{}});}}
function _composeLibelleBouton(aGenre,aLibelle,aAvecIcone){const T=[];T.push('<div class="NoWrap" style="margin-left:auto; margin-right:auto;">');if(aAvecIcone){T.push('<i class="icon_punition"></i>');}
T.push('<div class="InlineBlock AlignementMilieuVertical PetitEspaceGauche" style="line-height: 0.95em; max-width: ',(this.getWidthBtnAction()-3-13),'px;">',aLibelle,'</div>');T.push('</div>');return T.join('');}
function _estAvecCocheTAFFait(aElement){const lAvecRenduKiosque=!!aElement.genreRendu&&TypeGenreRenduTAF.estUnRenduKiosque(aElement.genreRendu);const lEstRendu=!!aElement.genreRendu&&TypeGenreRenduTAF.estUnRenduEnligne(aElement.genreRendu,false)&&!!aElement.documentRendu;const lEstQCM=aElement.executionQCM&&aElement.executionQCM.existeNumero();if(!this.peuFaireTAF||lEstQCM||lAvecRenduKiosque||lEstRendu){return false;}
return true;}
function _composeSliderTAFFait(aElement){const lHtml=[];if(!_estAvecCocheTAFFait.call(this,aElement)){const lEstFait=aElement.TAFFait||aElement.QCMFait;const lEstRendu=!!aElement.genreRendu&&TypeGenreRenduTAF.estUnRenduEnligne(aElement.genreRendu,false)&&!!aElement.documentRendu;if(lEstFait||this.peuFaireTAF){if(!lEstFait||!lEstRendu){lHtml.push('<div style="display:flex; justify-content: flex-end;">');lHtml.push('<div class="AlignementMilieu BorderBox SansMain" style="border-radius: 0.4rem; flex: 0 0 auto; margin: 0rem 0rem 0.4rem 0.8rem; padding: 0.4rem 0.8rem; color: ',GCouleur.themeCouleur.sombre,'; background: ',GCouleur.themeCouleur.claire,';">',((lEstFait)?GTraductions.getValeur('accueil.hintTravailFait'):GTraductions.getValeur('accueil.hintTravailNonFait')),'</div>');lHtml.push('</div>');}}} else{const lAvecERendu=!!aElement.genreRendu&&TypeGenreRenduTAF.estUnRenduEnligne(aElement.genreRendu,false);if(!lAvecERendu){lHtml.push('<div class="Espace AlignementDroit">','<ie-switch ie-model="cbFait" onclick="event.stopPropagation();" ie-hint="cbFait.getHint">','<span>',GTraductions.getValeur('accueil.hintTravailNonFait'),'</span>','<span>',GTraductions.getValeur('accueil.hintTravailFait'),'</span>','</ie-switch>','</div>');}}
return lHtml.join('');}
module.exports={GestionnaireBlocTAF,EGenreBtnActionBlocTAF};},fn:"gestionnairebloctaf.js"});;
IE.fModule({f:function(exports,require,module,global){const EGenreTypeRessourcesPedagogiques={SujetOuCorrige:0,TravailRendu:1,QCM:2,RessourcesGranulaires:3,ForumPedagogique:4,Autre:5};module.exports=EGenreTypeRessourcesPedagogiques;},fn:"enumere_typeressourcespedagogiques.js"});;
IE.fModule({f:function(exports,require,module,global){const TypeGenreModerationForum={GMF_APriori:'GMF_APriori',GMF_APosteriori:'GMF_APosteriori'};module.exports.TypeGenreModerationForum=TypeGenreModerationForum;const TypeEtatPub={EP_Ouvert:'EP_Ouvert',EP_Ferme:'EP_Ferme',EP_Verrou:'EP_Verrou',EP_Suspendu:'EP_Suspendu'};module.exports.TypeEtatPub=TypeEtatPub;const TypeHeaderEtatPost={HEP_Publie:'HEP_Publie',HEP_Refuse:'HEP_Refuse',HEP_SignaleModEnCours:'HEP_SignaleModEnCours',HEP_SignaleMod:'HEP_SignaleMod',HEP_Important:'HEP_Important',HEP_SupprimeAuteur:'HEP_SupprimeAuteur',HEP_AttenteValidation:'HEP_AttenteValidation',HEP_Aucun:'HEP_Aucun'};module.exports.TypeHeaderEtatPost=TypeHeaderEtatPost;const TypeActionPost={AP_Repondre:0,AP_Editer:1,AP_Supprimer:2,AP_SupprimerDefinitivement:3,AP_SignalerModeration:4,AP_Important:5,AP_NonImportant:6,AP_SignalerSPR:7,AP_ExclureAuteur:8,AP_Accepter:9,AP_Refuser:10,AP_TraiterSignalement:11};module.exports.TypeActionPost=TypeActionPost;const TypeGenreVisiteurForum={GVF_Responsable:0,GVF_Accompagnant:1,GVF_SPR:2};module.exports.TypeGenreVisiteurForum=TypeGenreVisiteurForum;const TypeRoleIndividuSujet={RIS_Auteur:0,RIS_Moderateur:1,RIS_Membre:2,RIS_Visiteur:3};module.exports.TypeRoleIndividuSujet=TypeRoleIndividuSujet;const TypeGenreActionSurPostForum={APF_Aucune:'APF_Aucune',APF_RefuserLePost:'APF_RefuserLePost',APF_RefuserTousLesPosts:'APF_RefuserTousLesPosts'};module.exports.TypeGenreActionSurPostForum=TypeGenreActionSurPostForum;const TypeForumPedaCommandeRequete={fpcr_Sujets:'fpcr_Sujets',fpcr_DetailSujet:'fpcr_DetailSujet',fpcr_Posts:'fpcr_Posts',fpcr_ExclusSujet:'fpcr_ExclusSujet'};module.exports.TypeForumPedaCommandeRequete=TypeForumPedaCommandeRequete;const TypeForumPedaCommandeSaisie={fpcs_CreerModifierSujet:'fpcs_CreerModifierSujet',fpcs_SupprimerSujet:'fpcs_SupprimerSujet',fpcs_DupliquerSujet:'fpcs_DupliquerSujet',fpcs_NettoyerSujet:'fpcs_NettoyerSujet',fpcs_ModifierEtatSujet:'fpcs_ModifierEtatSujet',fpcs_ModifierExclusSujet:'fpcs_ModifierExclusSujet',fpcs_ModifierConsigneVisibleSujet:'fpcs_ModifierConsigneVisibleSujet',fpcs_Post_Creer:'fpcs_Post_Creer',fpcs_Post_Editer:'fpcs_Post_Editer',fpcs_Post_Action:'fpcs_Post_Action',fpcs_Post_ModifierLu:'fpcs_Post_ModifierLu'};module.exports.TypeForumPedaCommandeSaisie=TypeForumPedaCommandeSaisie;},fn:"typesforumpedagogique.js"});;
IE.fModule({f:function(exports,require,module,global){require('Produit/Css/ObjetForumVisuPosts.css');const GTraductions=require('ObjetTraduction.js');const Identite=require('ObjetIdentite.js');const tag=require('tag.js');const{TypeHeaderEtatPost,TypeActionPost,TypeForumPedaCommandeSaisie,TypeEtatPub,TypeRoleIndividuSujet}=require('TypesForumPedagogique.js');const{TypeDroits}=require('ObjetDroitsPN.js');const ObjetMenuContextuel=require('ObjetMenuContextuel.js');const ObjetFenetre=require('ObjetFenetre.js');const ObjetBoutonFlottant=require('ObjetBoutonFlottant.js');const UtilitaireUrl=require('UtilitaireUrl.js');const GHtml=require('GHtml.js');const MethodesObjet=require('MethodesObjet.js');const TypeEnsembleNombre=require('TypeEnsembleNombre.js');const GPosition=require('GPosition.js');const c_Commande_MenuCntext= -1;const u_optionsSession={consigneVisibleVisiteur:true,modeVisuMembre:false,visuUniquementEnAttente:false};class ObjetForumVisuPosts extends Identite{constructor(...aParams){super(...aParams);this.moteurForum=null;this.setOptions({surBasculeEcran:null,visuModerateurPossible:true});this.donnees={};this.visuPostVisible=true;}
init(aMoteurForum){this.moteurForum=aMoteurForum;}
setSujet(aSujet,aParams){const lParams=Object.assign({forcerChangementSujet:false,avecBasculeEcran:false,typeSaisiePost:null},aParams);const lAvecBasculeEcranDisponible=!!this.moteurForum.getOptions().surBasculeEcran;const lAvecAffichage=!lAvecBasculeEcranDisponible||(lParams.avecBasculeEcran&&aSujet);const lEstSujetModifie=(this.donnees.sujet&&!aSujet)||(!this.donnees.sujet&&aSujet)||(this.donnees.sujet&&aSujet&&this.donnees.sujet.GetNumero()!==aSujet.GetNumero());if(lEstSujetModifie){u_optionsSession.modeVisuMembre=false;}
let lSurChangementSujet=false;if(lParams.forcerChangementSujet||lEstSujetModifie){lSurChangementSujet=true;}
return Promise.resolve().then(() =>{if(!lAvecBasculeEcranDisponible&&(lSurChangementSujet||!aSujet)){return this.moteurForum.requetePostsLu({ancienSujet:this.donnees.sujet,listePosts:this.donnees.listePosts,nouveauSujet:aSujet});}}).then((aResult) =>{if(aResult===true){return;}
if(lAvecBasculeEcranDisponible&&!lAvecAffichage&&!this.visuPostVisible){this.donnees={};this.Afficher(_construireAffichage.call(this));} else{this.moteurForum.setIndicePostLu(-1);return _actualiserListePosts_promise.call(this,{sujet:aSujet,avecSujet:true,surChangementSujet:lSurChangementSujet,avecAffichage:lAvecAffichage,typeSaisiePost:lParams.typeSaisiePost});}});}
free(){this.moteurForum.requetePostsLu({ancienSujet:this.donnees.sujet,listePosts:this.donnees.listePosts,sansActualisation:true});super.free();}
getControleur(aInstance){return $.extend(true,super.getControleur(this),{getNodeNavMobile(){$(this.node).eventValidation(() =>{aInstance.moteurForum.requetePostsLu({ancienSujet:aInstance.donnees.sujet,listePosts:aInstance.donnees.listePosts}).then(() =>{this.visuPostVisible=false;aInstance.setSujet(null);aInstance.moteurForum.getOptions().surBasculeEcran(false);});});},btnVisuConsigne:{event(){if(_estVisiteurDuSujet.call(aInstance)){u_optionsSession.consigneVisibleVisiteur=!u_optionsSession.consigneVisibleVisiteur;} else{aInstance.donnees.sujet.consigneVisible=!aInstance.donnees.sujet.consigneVisible;aInstance.moteurForum.requeteConsigneVisible(aInstance.donnees.sujet,aInstance.donnees.sujet.consigneVisible);}},getClass(){return _estConsigneVisible.call(aInstance)?'icon_chevron_up':'icon_chevron_down';},getTitle(){return _estConsigneVisible.call(aInstance)?GTraductions.getValeur('ForumPeda.CacherConsigne'):GTraductions.getValeur('ForumPeda.AfficherConsigne');}},btnModeVisuMembre:{event(){u_optionsSession.modeVisuMembre=!u_optionsSession.modeVisuMembre;aInstance.setSujet(aInstance.donnees.sujet,{forcerChangementSujet:true});},getClass(){return u_optionsSession.modeVisuMembre?'icon_eye_close':'icon_eye_open';},getTitle(){return u_optionsSession.modeVisuMembre?GTraductions.getValeur('ForumPeda.DesactiverVisuMembre'):GTraductions.getValeur('ForumPeda.ActiverVisuMembre');}},btnEditerSujet:{event(){aInstance.moteurForum.editerSujet(aInstance.donnees.sujet);},getDisabled(){return GApplication.droits.get(TypeDroits.estEnConsultation);}},getHtmlVisuPost(){if(!_estConsigneVisible.call(aInstance)){return'';}
const H=[aInstance.donnees.sujet.htmlPost];if(aInstance.donnees.sujet.listeFichiers&&aInstance.donnees.sujet.listeFichiers.GetNbrElements()>0){H.push(tag('div',{class:'post-pj'},UtilitaireUrl.construireListeUrls(aInstance.donnees.sujet.listeFichiers)));}
return H.join('');},btnParticip:{event(){_feneterEditionContenu.call(aInstance,TypeForumPedaCommandeSaisie.fpcs_Post_Creer,null);},getDisabled(){return!_peutPoster.call(aInstance);}},getNodeBtnParticipMobile(){$(this.node).eventValidation(function(){_feneterEditionContenu.call(aInstance,TypeForumPedaCommandeSaisie.fpcs_Post_Creer,null);});},cbFiltreModeration:{getValue(){return u_optionsSession.visuUniquementEnAttente;},setValue(aValue){u_optionsSession.visuUniquementEnAttente=aValue;aInstance.setSujet(aInstance.donnees.sujet,{forcerChangementSujet:true});}},getIdentiteBtnParticip(){return{class:ObjetBoutonFlottant,pere:aInstance,init:function(aBtn){aBtn.setOptionsBouton({listeBoutons:[{primaire:true,icone:'icon_plus_fin large',callback(){_feneterEditionContenu.call(aInstance,TypeForumPedaCommandeSaisie.fpcs_Post_Creer,null);}}]});}};},btnActionPost:{event(aNumeroPost,aGenreAction){const lPost=aInstance.donnees.listePosts.GetElementParNumero(aNumeroPost);if(lPost){_surCommandePost.call(aInstance,lPost,aGenreAction);}},getDisabled(aNumeroPost,aGenreAction){const lPost=aInstance.donnees.listePosts.GetElementParNumero(aNumeroPost);if(!lPost||GApplication.droits.get(TypeDroits.estEnConsultation)){return true;}
switch(aGenreAction){case TypeActionPost.AP_Accepter:case TypeActionPost.AP_Refuser:return!lPost.actions.contains(aGenreAction);}
return false;}},nodePostVisibility(aIndicePost,aVisible){if(aVisible){aInstance.ensemblePostsVisibles.add(aIndicePost);} else{aInstance.ensemblePostsVisibles.remove(aIndicePost);}},nodePostVisibilityNonLu(aNumeroPost,aVisible){if(aVisible){const lListe=aInstance.donnees.listePosts;const lIndice=lListe.GetIndiceParNumeroEtGenre(aNumeroPost);const lPost=lListe.GetElement(lIndice);if(lPost){aInstance.moteurForum.setIndicePostLu(lIndice);}
return false;}},nodeLoaderVisibility(aTypeLoader,aVisible){if(aVisible){_actualiserListePosts_promise.call(aInstance,{sujet:aInstance.donnees.sujet,avecSujet:false,typeLoader:aTypeLoader});return false;}}});}}
function _surCommandePost(aPost,aGenreAction){const lActifME=!GApplication.droits.get(TypeDroits.estEnConsultation);switch(aGenreAction){case c_Commande_MenuCntext:{ObjetMenuContextuel.afficher({pere:this,initCommandes(aMenu){if(aPost.actions.contains(TypeActionPost.AP_Editer)){aMenu.add(GTraductions.getValeur('ForumPeda.MenuAction_Editer'),lActifME,() =>{_feneterEditionContenu.call(this,TypeForumPedaCommandeSaisie.fpcs_Post_Editer,aPost);},{icon:'icon_pencil'});}
if(aPost.actions.contains(TypeActionPost.AP_Repondre)){aMenu.add(GTraductions.getValeur('ForumPeda.MenuAction_Repondre'),lActifME,() =>{_feneterEditionContenu.call(this,TypeForumPedaCommandeSaisie.fpcs_Post_Creer,aPost);},{icon:'icon_reply'});}
const lAvecImportant=aPost.actions.contains(TypeActionPost.AP_Important);if(lAvecImportant||aPost.actions.contains(TypeActionPost.AP_NonImportant)){aMenu.add(lAvecImportant?GTraductions.getValeur('ForumPeda.MenuAction_Important'):GTraductions.getValeur('ForumPeda.MenuAction_NonImportant'),lActifME,() =>{_surCommandePost.call(this,aPost,lAvecImportant?TypeActionPost.AP_Important:TypeActionPost.AP_NonImportant);},{icon:'icon_bookmark'});}
aMenu.avecSeparateurSurSuivant();if(aPost.actions.contains(TypeActionPost.AP_ExclureAuteur)){aMenu.add(GTraductions.getValeur('ForumPeda.MenuAction_ExclureAuteur'),lActifME,() =>{_surCommandePost.call(this,aPost,TypeActionPost.AP_ExclureAuteur);},{icon:'icon_user mix-icon_ne_pas_deranger i-red'});}
if(aPost.actions.contains(TypeActionPost.AP_SignalerModeration)){aMenu.add(GTraductions.getValeur('ForumPeda.MenuAction_SignalerModeration'),lActifME,() =>{_surCommandePost.call(this,aPost,TypeActionPost.AP_SignalerModeration);},{icon:'icon_warning_sign'});}
if(aPost.actions.contains(TypeActionPost.AP_SignalerSPR)){aMenu.add(GTraductions.getValeur('ForumPeda.MenuAction_SignalerSPR'),lActifME,() =>{_surCommandePost.call(this,aPost,TypeActionPost.AP_SignalerSPR);},{icon:'icon_warning_sign'});}
if(aPost.actions.contains(TypeActionPost.AP_SupprimerDefinitivement)){aMenu.add(GTraductions.getValeur('ForumPeda.MenuAction_SupprimerDefinitivement'),lActifME,() =>{_surCommandePost.call(this,aPost,TypeActionPost.AP_SupprimerDefinitivement);},{icon:'icon_trash'});}}});break;}
default:{return _saisieCommandePost.call(this,{type:TypeForumPedaCommandeSaisie.fpcs_Post_Action,action:aGenreAction,post:aPost});}}}
function _feneterEditionContenu(aType,aPost){const H=[];if(aType===TypeForumPedaCommandeSaisie.fpcs_Post_Creer&&aPost){H.push(tag('div',{class:'quotation'},tag('label',aPost.strAuteur),tag('div',aPost.contenu)));}
H.push(tag('ie-textareamax',{'ie-model':'textarea',class:'round-style post-saisie','maxlength':10000}));let lContenu=aType===TypeForumPedaCommandeSaisie.fpcs_Post_Editer&&aPost?aPost.contenu||'':'';ObjetFenetre.creerInstance(ObjetFenetre,{pere:this,initialiser(aFenetre){aFenetre.setOptionsFenetre({titre:aType===TypeForumPedaCommandeSaisie.fpcs_Post_Editer?GTraductions.getValeur('ForumPeda.ModifierPost'):aPost?GTraductions.getValeur('ForumPeda.RepondrePost'):GTraductions.getValeur('ForumPeda.NouveauPost'),largeur:500,listeBoutons:[GTraductions.getValeur('Annuler'),{libelle:GTraductions.getValeur('Valider'),valider:true}],cssFenetre:'ObjetForumVisuPosts-fenetrePost'});if(!IE.estMobile){aFenetre.FocusSurPremierElement=function(){$(`#${this.Nom.escapeJQ()} textarea`).focus();};}
$.extend(true,aFenetre.controleur,{textarea:{getValue(){return lContenu;},setValue(aValue){lContenu=aValue;}},fenetreBtn:{getDisabled:function(aBoutonRepeat){if(aBoutonRepeat.element.valider){return lContenu==='';}
return false;}}});}}).Afficher(H.join('')).then((aParams) =>{if(aParams.bouton&&aParams.bouton.valider){_saisieCommandePost.call(this,{type:aType,post:aPost,sujet:aType===TypeForumPedaCommandeSaisie.fpcs_Post_Creer?this.donnees.sujet:null,contenu:lContenu});}});}
function _saisieCommandePost(aParams){this.moteurForum.saisieCommandePost(aParams,this.donnees.sujet);}
function _construireHeaderSujet(){const H=[];const lAvecBasculeEcran=!!this.moteurForum.getOptions().surBasculeEcran;const lSujet=this.donnees.sujet;let lTitre=lSujet.titre;if(lSujet.listeThemes&&lSujet.listeThemes.GetNbrElements()>0&&this.moteurForum.avecGestionThemes()){lTitre+=` - ${GTraductions.getValeur('ForumPeda.Theme')} : ${lSujet.listeThemes.trier().getTableauLibelles().join(', ')}`;}
H.push(lAvecBasculeEcran?tag('div',{'ie-node':'getNodeNavMobile',tabindex:0,class:'nav-page-profonde-container'},tag('ie-btnicon',{class:'fleche-nav icon_retour_mobile'}),tag('div',{class:'label'},lTitre)):'',tag('div',{class:'titre'},tag('div',{class:'titre-texte'},lAvecBasculeEcran?'':tag('h5',{class:'ie-titre','ie-ellipsis':true},lTitre),tag('div',{class:'sous-titre'},() =>{return lSujet.strAuteur+(lAvecBasculeEcran?tag('br'):' - ')+this.moteurForum.getStrNbParticipantsSujet(lSujet);})),tag('div',{class:'titre-boutons'},tag('ie-btnicon',{class:'bt-activable bt-large','ie-model':'btnVisuConsigne','ie-class':'getClass'}),lSujet.roles.contains(TypeRoleIndividuSujet.RIS_Moderateur)?tag('ie-btnicon',{class:'icon_pencil bt-activable bt-large','ie-model':'btnEditerSujet',title:GTraductions.getValeur('ForumPeda.Menu_Modifier')}):'',lSujet.roles.contains(TypeRoleIndividuSujet.RIS_Moderateur)?tag('ie-btnicon',{class:'bt-activable bt-large','ie-model':'btnModeVisuMembre','ie-class':'getClass'}):'')));var lTabLigneSupp=[];if(!IE.estMobile&&!_estVisiteurDuSujet.call(this)){lTabLigneSupp.push(tag('ie-bouton',{class:'btn-particip','ie-model':'btnParticip'},GTraductions.getValeur('ForumPeda.Poster')));}
if(_modeVisuModerateur.call(this,lSujet)){lTabLigneSupp.push(tag('div',{class:'ecart'}),tag('ie-checkbox',{class:'cbFiltreModeration','ie-model':'cbFiltreModeration'},GTraductions.getValeur('ForumPeda.FiltreModeration')));}
if(lTabLigneSupp.length>0){H.push(tag('div',{class:'ligne-supp'},lTabLigneSupp.join('')));}
H.push(_construireMessageInformatifDeSujet.call(this,lSujet));H.push(tag('div',{class:'visu-post','ie-html':'getHtmlVisuPost'}));return H.join('');}
function _construireMessageInformatifDeSujet(aSujet){let H=[];switch(aSujet.etatPub){case TypeEtatPub.EP_Suspendu:{H.push(aSujet.roles.contains(TypeRoleIndividuSujet.RIS_Moderateur)?GTraductions.getValeur('ForumPeda.SujetSuspenduPourModeration'):GTraductions.getValeur('ForumPeda.SujetSuspenduConsult'));break;}
case TypeEtatPub.EP_Verrou:{H.push(GTraductions.getValeur('ForumPeda.ForumVerrouille'));break;}
case TypeEtatPub.EP_Ferme:{let lMsgPartFermee=this.moteurForum.getStrMessageParticipationFermee(aSujet);if(lMsgPartFermee){H.push(tag('span',{class:['ferme-horaire',aSujet.roles.contains(TypeRoleIndividuSujet.RIS_Moderateur)?'moderateur':'']},lMsgPartFermee));}
break;}}
if(aSujet.estExclu){H.push(GTraductions.getValeur('ForumPeda.ParticipationBloque'));}
if(H.length>0){return tag('div',{class:['message-sujet']},H.join(tag('br')));}
return'';}
function _modeVisuModerateur(aSujet){return aSujet.roles.contains(TypeRoleIndividuSujet.RIS_Moderateur)&&!u_optionsSession.modeVisuMembre&&this.options.visuModerateurPossible;}
function _construireTitreEtatPost(aPost){const H=[];if(aPost.etatHeader!==TypeHeaderEtatPost.HEP_Aucun){H.push(tag('i',{class:['icon-etat',aPost.etatHeader]}));H.push(tag('div',{class:'etat'},() =>{let lStrImportant='';let lStrSignalementSPR='';let lStrEtat='';let lStrSignalementModEnCours=aPost.strSignMOD;let lStrSignalementMod='';if(aPost.estImportant){lStrImportant=GTraductions.getValeur('ForumPeda.MisEnAvant');}
if(aPost.strSignSPR){lStrSignalementSPR=tag('label',{class:'sign-spr'},aPost.strSignSPR);}
if(aPost.strSign){lStrSignalementMod=tag('label',{class:'signale'},aPost.strSign);}
switch(aPost.etatHeader){case TypeHeaderEtatPost.HEP_Publie:lStrEtat=GTraductions.getValeur('ForumPeda.Publie');break;case TypeHeaderEtatPost.HEP_Refuse:lStrEtat=GTraductions.getValeur('ForumPeda.Refuse');break;case TypeHeaderEtatPost.HEP_Important:lStrEtat=lStrImportant;lStrImportant='';break;case TypeHeaderEtatPost.HEP_SupprimeAuteur:lStrEtat=GTraductions.getValeur('ForumPeda.SupprimeAuteur');break;case TypeHeaderEtatPost.HEP_AttenteValidation:lStrEtat=GTraductions.getValeur('ForumPeda.AttenteValidation');break;case TypeHeaderEtatPost.HEP_SignaleModEnCours:lStrEtat=lStrSignalementModEnCours;lStrSignalementModEnCours='';break;case TypeHeaderEtatPost.HEP_SignaleMod:lStrEtat=lStrSignalementMod;lStrSignalementMod='';break;}
let H=[];if(lStrEtat){H.push(lStrEtat);}
if(lStrSignalementModEnCours){H.push(lStrSignalementModEnCours);}
if(lStrImportant){H.push(lStrImportant);}
if(lStrSignalementMod){H.push(lStrSignalementMod);}
if(lStrSignalementSPR){H.push(lStrSignalementSPR);}
return H.join(' - ');}));}
return H.join('');}
function _construireTitreCommandesrPost(aPost){const H=[];const lSujet=this.donnees.sujet;const lModeVisuModerateur=_modeVisuModerateur.call(this,lSujet);H.push(tag('div',{class:'commandes'},(H) =>{if(lSujet.roles.contains(TypeRoleIndividuSujet.RIS_Moderateur)&&!aPost.estAuteur&&lModeVisuModerateur){let lActionAccepter=TypeActionPost.AP_Accepter;if(!aPost.actions.contains(TypeActionPost.AP_Accepter)&&aPost.actions.contains(TypeActionPost.AP_TraiterSignalement)){lActionAccepter=TypeActionPost.AP_TraiterSignalement;}
H.push(tag('ie-btnicon',{class:'icon_check_fin bt-activable bt-large','ie-model':tag.funcAttr('btnActionPost',[aPost.GetNumero(),lActionAccepter]),title:GTraductions.getValeur('ForumPeda.MenuAction_Accepter')}));let lActionRefuser=TypeActionPost.AP_Refuser;if(!aPost.actions.contains(TypeActionPost.AP_Refuser)&&aPost.actions.contains(TypeActionPost.AP_Supprimer)){lActionRefuser=TypeActionPost.AP_Supprimer;}
H.push(tag('ie-btnicon',{class:'icon_fermeture_widget bt-activable bt-large','ie-model':tag.funcAttr('btnActionPost',[aPost.GetNumero(),lActionRefuser]),title:GTraductions.getValeur('ForumPeda.MenuAction_Refuser')}));}
if(aPost.actions.count()>0){if(aPost.estAuteur&&aPost.actions.contains(TypeActionPost.AP_Supprimer)){H.push(tag('ie-btnicon',{class:'icon_trash bt-activable bt-large','ie-model':tag.funcAttr('btnActionPost',[aPost.GetNumero(),TypeActionPost.AP_Supprimer]),title:GTraductions.getValeur('ForumPeda.MenuAction_Supprimer')}));}
H.push(tag('ie-btnicon',{class:'icon_ellipsis_vertical','ie-model':tag.funcAttr('btnActionPost',[aPost.GetNumero(),c_Commande_MenuCntext]),title:GTraductions.getValeur('liste.BtnAction')}));} else{H.push(tag('div',{class:'gabarit-icon'}));}}));return H.join(' ');}
function _construireTitreAuteurPost(aPost){return tag('div',{class:'titre-auteur'},() =>{const H=[];H.push(tag('label',{class:'auteur'},aPost.strAuteur));if(aPost.exclu){H.push('('+tag('i',{class:'icon_ne_pas_deranger exclu'}),tag('label',GTraductions.getValeur('ForumPeda.EleveExclu'))+')');}
if(aPost.excluPerso){H.push('('+tag('i',{class:'icon_ne_pas_deranger exclu'}),tag('label',GTraductions.getValeur('ForumPeda.VousAvezEteExclu'))+')');}
H.push(tag('label',{class:'date'},aPost.strDate));if(aPost.editeAuteur||aPost.editeModeration){H.push(tag('label',{class:'edite'},`(${aPost.editeAuteur?GTraductions.getValeur('ForumPeda.ModifieAuteur'):GTraductions.getValeur('ForumPeda.ModifieModeration')})`));}
return H.join(' ');});}
function _construireTitrePost(aPost){const lEtat=_construireTitreEtatPost.call(this,aPost);const lCommandes=_construireTitreCommandesrPost.call(this,aPost);const lTitreAuteur=_construireTitreAuteurPost.call(this,aPost);if(lEtat){return tag('div',{class:'principal'},lEtat,lCommandes)+tag('div',{class:'secondaire'},lTitreAuteur);}
return tag('div',{class:'principal'},lTitreAuteur,lCommandes);}
function _construireListePosts(){const lListePosts=this.donnees.listePosts;if(lListePosts.GetNbrElements()===0){return _construireMessageVide(false);}
const H=[];let lSeparateurNonLu=false;if(this.donnees.loaderPostBefore){H.push(tag('div',{class:'posts-load','ie-visibility-observer':tag.funcAttr('nodeLoaderVisibility','before')},GTraductions.getValeur('ForumPeda.ChargementPosts')));}
this.ensemblePostsVisibles=new TypeEnsembleNombre();lListePosts.parcourir((aPost,aIndex) =>{if(!lSeparateurNonLu&&aPost.nonLu){lSeparateurNonLu=true;H.push(tag('h5',{class:'sep-nonLu'},GTraductions.getValeur('ForumPeda.NouveauxPosts')));}
H.push(tag('article',{class:['post',aPost.estAuteur?'auteur':'',aPost.etatHeader,'OmbreFocus'],'ie-visibility-observer':tag.funcAttr('nodePostVisibility',[aIndex]),id:`post_${aPost.GetNumero()}`,tabindex:0},aPost.nonLu?tag('div',{class:'pastille-nonLu',title:GTraductions.getValeur('ForumPeda.HintNouveauxPosts')}):'',tag('div',{class:'titre'},_construireTitrePost.call(this,aPost)),aPost.contenuSource?tag('div',{class:'quotation'},tag('label',aPost.strAuteurSource),tag('div',aPost.contenuSource)):'',tag('div',{class:'contenu'},aPost.contenu.toHTML()),aPost.nonLu?tag('div',{'ie-visibility-observer':tag.funcAttr('nodePostVisibilityNonLu',[aPost.GetNumero()])}):''));});if(this.donnees.loaderPostAfter){H.push(tag('div',{class:'posts-load','ie-visibility-observer':tag.funcAttr('nodeLoaderVisibility','after')},GTraductions.getValeur('ForumPeda.ChargementPosts')));}
if(IE.estMobile&&_peutPoster.call(this)){H.push(tag('div',{class:'ecart-btn-creation'}),tag('div',{class:'is-sticky btn-plus','ie-identite':'getIdentiteBtnParticip'}));}
return H.join('');}
function _construirePosts(){const H=[];H.push(tag('header',_construireHeaderSujet.call(this)),tag('section',tag('div',{class:'scroll-posts'},_construireListePosts.call(this))));return H.join('');}
function _construireMessageVide(aPourSujet){return tag('div',{class:'message-vide card card-nodata'},tag('div',{class:'message card-content'},aPourSujet?GTraductions.getValeur('ForumPeda.SelectionnerUnSujet'):GTraductions.getValeur('ForumPeda.AucunPost')),tag('div',{class:['Image_No_Data']}));}
function _construireAffichage(){const H=[];H.push(tag('div',{class:'ObjetForumVisuPosts'},() =>{if(this.donnees.sujet){return _construirePosts.call(this);}
return IE.estMobile?'':_construireMessageVide(true);}));return H.join('');}
function _peutPoster(){return this.donnees.sujet&&this.donnees.sujet.peutPoster&&!GApplication.droits.get(TypeDroits.estEnConsultation);}
function _actualiserListePosts_promise(aParams){const lParams=Object.assign({sujet:null,avecSujet:false,typeLoader:null,surChangementSujet:false,avecAffichage:false,typeSaisiePost:null},aParams);const lForcerBasListePosts=lParams.typeSaisiePost===TypeForumPedaCommandeSaisie.fpcs_Post_Creer;let lPostMarqueur;let lScrollArticle=null;if(!lParams.surChangementSujet&&!lForcerBasListePosts&&!lParams.typeLoader&&this.donnees.listePosts&&this.ensemblePostsVisibles&&this.ensemblePostsVisibles.count()>0){lPostMarqueur=this.donnees.listePosts.GetElement(this.ensemblePostsVisibles.items()[0]);const lIdNodeArticle=`post_${lPostMarqueur.GetNumero()}`;const lNodeArticle=GHtml.getElement(lIdNodeArticle);if(lNodeArticle){lScrollArticle={id:lIdNodeArticle,rect:GPosition.getClientRect(lNodeArticle)};}}
const lModeVisuMembre=u_optionsSession.modeVisuMembre||!this.options.visuModerateurPossible;const lParamsJSON={sujet:lParams.sujet,avecSujet:lParams.avecSujet,modeVisuMembre:lModeVisuMembre,uniquementModeration:this.options.visuModerateurPossible&&u_optionsSession.visuUniquementEnAttente};if(lParams.typeLoader==='before'&&this.donnees.loaderPostBefore){Object.assign(lParamsJSON,{postMarqueur:this.donnees.loaderPostBefore,marqueur:lParams.typeLoader});} else if(lParams.typeLoader==='after'&&this.donnees.loaderPostAfter){Object.assign(lParamsJSON,{postMarqueur:this.donnees.loaderPostAfter,marqueur:lParams.typeLoader});} else if(lPostMarqueur){Object.assign(lParamsJSON,{postMarqueur:lPostMarqueur,marqueur:'current'});} else if(lParams.surChangementSujet){lParamsJSON.marqueur='nonLu';}
this.ensemblePostsVisibles=new TypeEnsembleNombre();return this.moteurForum.requeteListePosts(lParamsJSON).then((aDonnees) =>{if(!aDonnees){this.donnees={};} else{if(aDonnees.sujet){this.donnees.sujet=aDonnees.sujet;}
if(aDonnees.listePosts){if(aDonnees.before){this.donnees.listePosts=aDonnees.listePosts.add(this.donnees.listePosts);} else if(aDonnees.after){this.donnees.listePosts.add(aDonnees.listePosts);} else{this.donnees.listePosts=aDonnees.listePosts;}}
if(!aDonnees.after){this.donnees.loaderPostBefore=aDonnees.loaderPostBefore;}
if(!aDonnees.before){this.donnees.loaderPostAfter=aDonnees.loaderPostAfter;}}
if(aDonnees===false){this.visuPostVisible=false;this.moteurForum.getOptions().surBasculeEcran(false);return false;}
const lBackupScroll=_getBackupScrollEtFocus.call(this,!lParams.surChangementSujet,aDonnees&&aDonnees.before);lBackupScroll.scrollArticle=lScrollArticle;if(lForcerBasListePosts){lBackupScroll.forcerScrollMax=true;}
this.Afficher(_construireAffichage.call(this));if(!!this.moteurForum.getOptions().surBasculeEcran&&lParams.avecAffichage){this.moteurForum.getOptions().surBasculeEcran(true);this.visuPostVisible=true;}
_positionnerScrollEtFocus.call(this,lBackupScroll);});}
function _getBackupScrollEtFocus(aConserverPosScroll,aSurLoadingPostsAvant){let lBackupScroll={};const lJScroll=$(`#${this.Nom.escapeJQ()} .scroll-posts`);if(lJScroll.length>0){const lScroll=lJScroll.get(0);if(aSurLoadingPostsAvant){lBackupScroll.scrollTopInverse=lScroll.scrollHeight-lScroll.scrollTop;} else if(aConserverPosScroll){lBackupScroll.scrollTop=lScroll.scrollTop;}}
try{const lElementFocus=document.activeElement;if(lElementFocus&&lElementFocus.closest){const lArticleFocus=lElementFocus.closest(`#${this.Nom.escapeJQ()}  article.post`);if(lArticleFocus){lBackupScroll.idFocusArticle=lArticleFocus.id;}}} catch(e){}
return lBackupScroll;}
function _positionnerScrollEtFocus(aBackupScroll){if(!aBackupScroll){return;}
var lJScroll=$(`#${this.Nom.escapeJQ()} .scroll-posts`);if(lJScroll.length===0){return;}
const lScroll=lJScroll.get(0);if(this.visuPostVisible){if(aBackupScroll.idFocusArticle){GHtml.setFocus(aBackupScroll.idFocusArticle);}}
if(!aBackupScroll.forcerScrollMax){if(aBackupScroll.scrollArticle&&GHtml.elementExiste(aBackupScroll.scrollArticle.id)){const lRectArticle=GPosition.getClientRect(aBackupScroll.scrollArticle.id);if(!lRectArticle.erreur){lScroll.scrollTop=lScroll.scrollTop+(lRectArticle.top-aBackupScroll.scrollArticle.rect.top);return;}}
if(MethodesObjet.isNumber(aBackupScroll.scrollTopInverse)){lScroll.scrollTop=lScroll.scrollHeight-aBackupScroll.scrollTopInverse;return;}
if(MethodesObjet.isNumber(aBackupScroll.scrollTop)){lScroll.scrollTop=aBackupScroll.scrollTop;return;}
var lJNonLu=lJScroll.find('.sep-nonLu');if(lJNonLu.length>=1){const lPosition=lJNonLu.eq(0).position();if(lPosition){lScroll.scrollTop=Math.max(0,lPosition.top-8);return;}}}
lScroll.scrollTop=lScroll.scrollHeight;}
function _estVisiteurDuSujet(){return this.donnees.sujet.roles.count()===1&&this.donnees.sujet.roles.contains(TypeRoleIndividuSujet.RIS_Visiteur);}
function _estConsigneVisible(){return _estVisiteurDuSujet.call(this)?u_optionsSession.consigneVisibleVisiteur:this.donnees.sujet.consigneVisible;}
module.exports=ObjetForumVisuPosts;},fn:"objetforumvisuposts.js"});;
IE.fModule({f:function(exports,require,module,global){const GStyle=require('GStyle.js');const ObjetDonneesListe=require('ObjetDonneesListe.js');class DonneesListe_SelectionRessource extends ObjetDonneesListe{constructor(aDonnees){super(aDonnees);this.setOptions({avecSuppression:false,avecDeploiement:true,avecEtatSaisie:false});}
AvecEdition(I,D){return I===0&&!D.nonEditable;}
getColonneTransfertEdition(aParams){if(!this.AvecSelection(aParams.colonne,aParams)&&!this.AvecEdition(aParams.colonne,aParams.article,aParams)){return 0;}}
AvecEvenement_ApresEdition(){return true;}
SurEdition(aParams,I,D,V){switch(aParams.colonne){case 0:if(aParams.article.estUnDeploiement){this.Donnees.parcourir(function(aFils){if(aFils.pere===aParams.article){aFils.selectionne=V;}});} else{aParams.article.selectionne=V;}
break;}}
GetValeur(I,D,aParams){switch(I){case 0:if(D.estUnDeploiement){return this.getEtatCocheSelonFils(aParams.article,aParams);}
return D.selectionne;case 1:return D.GetLibelle();}
return'';}
GetTypeValeur(aParams){switch(aParams.colonne){case 0:return ObjetDonneesListe.ETypeCellule.Coche;case 1:return ObjetDonneesListe.ETypeCellule.Texte;}
return ObjetDonneesListe.ETypeCellule.Texte;}
getStyle(aParams,I,D){switch(aParams.colonne){case 1:return D.GetActif()?'':GStyle.composeCouleurTexte(GCouleur.rouge);}
return'';}
getClass(aParams,I,D){switch(aParams.colonne){case 1:return this._options&&this._options.getClassRessource?this._options.getClassRessource(D):aParams.article&&aParams.article.estUnDeploiement?'Gras':'';}
return'';}
GetCouleurCellule(aParams,I,D){if(D.estUnDeploiement&&I!==0){return ObjetDonneesListe.ECouleurCellule.Deploiement;}}
getHintForce(aParams,I,D){switch(I){case 1:return this._options&&this._options.getHintRessource?this._options.getHintRessource(D):'';}
return'';}
GetVisible(D){if(!this._options||!this._options.filtres){return true;}
let lVisible=true;for(const i in this._options.filtres){const lFiltre=this._options.filtres[i];lVisible=lVisible&&lFiltre.filtre(D,lFiltre.checked);if(!lVisible){D.selectionne=false;return false;}}
return lVisible;}
avecImageSurColonneDeploiement(aParams){return aParams.colonne===1;}
getIndentationCellule(aParams){if(aParams.colonne===1){return this.getIndentationCelluleSelonParente(aParams);}
return 0;}}
module.exports=DonneesListe_SelectionRessource;},fn:"donneesliste_selectionressource.js"});;
IE.fModule({f:function(exports,require,module,global){const ObjetDonneesListeFlatDesign=require('ObjetDonneesListeFlatDesign.js');class DonneesListe_SelectionRessource_fd extends ObjetDonneesListeFlatDesign{constructor(aDonnees){super(aDonnees);this.setOptions({avecBoutonActionLigne:false,avecCB:true,avecCocheCBSurLigne:true,avecSelection:false});}
getValueCB(aParams){return aParams.article.selectionne;}
setValueCB(aParams,aValue){aParams.article.selectionne=aValue;}
getDisabledCB(aParams){return aParams.article.nonEditable;}
estLigneOff(aParams){return aParams.article.nonEditable;}
getStyle(aParams){return aParams.article.GetActif()?'':`color:${GCouleur.rouge};`;}
getClass(aParams){return this._options&&this._options.getClassRessource?this._options.getClassRessource(aParams.article):'';}
getHintForce(aParams){return this._options&&this._options.getHintRessource?this._options.getHintRessource(aParams.article):'';}
GetVisible(D){if(!this._options||!this._options.filtres){return true;}
let lVisible=true;for(const i in this._options.filtres){const lFiltre=this._options.filtres[i];lVisible=lVisible&&lFiltre.filtre(D,lFiltre.checked);if(!lVisible){D.selectionne=false;return false;}}
return lVisible;}}
module.exports=DonneesListe_SelectionRessource_fd;},fn:"donneesliste_selectionressource_fd.js"});;
IE.fModule({f:function(exports,require,module,global){const GUID=require('GUID.js');const MethodesObjet=require('MethodesObjet.js');const GHtml=require('GHtml.js');const GPosition=require('GPosition.js');const DonneesListe_SelectionRessource=require('DonneesListe_SelectionRessource.js');const DonneesListe_SelectionRessource_fd=require('DonneesListe_SelectionRessource_fd.js');const EGenreEvenementListe=require('Enumere_EvenementListe.js');const ObjetFenetre=require('ObjetFenetre.js');const ObjetListe=require('ObjetListe.js');const ObjetListeElements=require('ObjetListeElements.js');const GTraductions=require('ObjetTraduction.js');const ObjetTri=require('ObjetTri.js');const tag=require('tag.js');const GStyle=require('GStyle.js');class ObjetFenetre_SelectionRessource extends ObjetFenetre{constructor(...aParams){super(...aParams);this.setOptionsFenetre({largeur:350,hauteur:500,listeBoutons:[GTraductions.getValeur('Valider')]});this.indexBtnValider=0;const lId=GUID.getId();this.idConteneurFiltre=lId+'_Cfiltre';this.classFiltres=GUID.getClassCss();this._options={selectionObligatoire:false,autoriseEltAucun:false,filtres:null,gestionCumulRessource:null,triListe:null,avecCocheRessources:true,getClassRessource:null,getHintRessource:null,optionsDonneesListe:null,avecBarreTitre:true,listeFlatDesign:false};}
setOptions_Fenetre_SelectionRessource(aOptions){$.extend(this._options,aOptions);}
setSelectionObligatoire(aValeur){this.setOptions_Fenetre_SelectionRessource({selectionObligatoire:aValeur});}
setAutoriseEltAucun(aValeur){this.setOptions_Fenetre_SelectionRessource({autoriseEltAucun:aValeur});}
setDonnees(aParam){if(aParam.titre){this.setOptionsFenetre({titre:aParam.titre});}
this.SetDonnees(aParam.listeRessources,aParam.listeRessourcesSelectionnees,aParam.genreRessource);}
SetDonnees(aListeRessources,aListeRessourcesSelectionnees,aGenreRessource){this.listeRessourcesSelectionnees=aListeRessourcesSelectionnees;this.genreRessource=aGenreRessource;this.construireListeRessource(aListeRessources,aListeRessourcesSelectionnees);this._initialiserListe(this.GetInstance(this.identListe));this.Afficher();this._construireFiltres();if(!this.optionsFenetre.avecTailleSelonContenu){this.surFixerTaille();}
this._actualiserListe();if(this.optionsFenetre.avecTailleSelonContenu){this.positionnerFenetre();}}
getControleur(aInstance){return $.extend(true,super.getControleur(this),{cbFiltre:{getValue(aIndice){const lFiltre=aInstance._options.filtres[aIndice];return lFiltre.checked;},setValue(aIndice,aValue){aInstance._mettreAJourFiltre(aIndice,aValue);}}});}
_construireFiltres(){if(!this._options.filtres||this._options.filtres.length===0){return;}
const T=[];if(this._options.filtres){for(const i in this._options.filtres){const lFiltre=this._options.filtres[i];T.push('<div>');T.push(tag('ie-checkbox',{'ie-model':tag.funcAttr('cbFiltre',i)},lFiltre.libelle));T.push('</div>');}}
GHtml.setHtml(this.idConteneurFiltre,T.join(''),{instance:this});GHtml.setDisplay(this.idConteneurFiltre,true);}
_mettreAJourFiltre(aNumeroFiltre,aChecked){const lFiltre=this._options.filtres[aNumeroFiltre];lFiltre.checked=aChecked;if(lFiltre.callbackChecked){lFiltre.callbackChecked(aChecked);}
this._actualiserListe();}
forcerMajListeSelection(){if(!this._forcerMajListeSelection){this._ancienListeSelection=this.listeRessourcesSelectionnees;this._forcerMajListeSelection=true;}
_majListeSelection.bind(this)();}
SurValidation(ANumeroBouton){if(ANumeroBouton===this.indexBtnValider){_majListeSelection.bind(this)();}
this.Fermer();this.callback.appel(this.genreRessource,this.listeRessourcesSelectionnees,ANumeroBouton);}
ConstruireInstances(){this.identListe=this.Add(ObjetListe,this._evenementSurListe,this._initialiserListe);}
ComposeContenu(){const T=[];T.push('<div id="',this.idConteneurFiltre,'" style="display:none"></div>');T.push('<div id="'+this.GetNomInstance(this.identListe)+'" class="Table"></div>');return T.join('');}
construireListeRessource(aListeRessources,aListeRessourcesSelectionnees){this.listeRessources=new ObjetListeElements();if(aListeRessources){let lRessource;const lNbr=aListeRessources.GetNbrElements();for(let i=0;i<lNbr;i++){const lElt=aListeRessources.GetElement(i);if((this._options.autoriseEltAucun||lElt.existeNumero())&&!lElt.nePasAfficher){if(this._options.gestionCumulRessource){this._options.gestionCumulRessource(lElt,this.listeRessources);}
if(lElt.estUnDeploiement){lRessource=lElt;} else{lRessource=MethodesObjet.dupliquer(lElt,true);const lEltResSel=aListeRessourcesSelectionnees.GetElementParElement(lRessource);if(lEltResSel){lRessource.selectionne=true;lRessource.avecReponse=!!lEltResSel.avecReponse;lRessource.nonModifiable=!!lEltResSel.nonModifiable;} else{lRessource.selectionne=false;}}
this.listeRessources.AddElement(lRessource);}}}
if(this._options.triListe){this.listeRessources.setTri(this._options.triListe);} else{this.listeRessources.setTri(ObjetTri.initRecursif('pere',[ObjetTri.init('Position'),ObjetTri.init('Libelle')]));}
this.listeRessources.trier();}
_initialiserListe(aInstance){const lOptions={};if(this._options.listeFlatDesign){Object.assign(lOptions,{skin:ObjetListe.skin.flatDesign,avecCBToutCocher:this._options.avecCocheRessources&&this._options.selectionCumul!==false?true:false});} else{Object.assign(lOptions,{colonnes:[{taille:20,titre:this._options.avecBarreTitre&&this._options.avecCocheRessources&&this._options.selectionCumul!==false?{estCoche:true}:''},{taille:'100%',titre:this._options.avecBarreTitre?GTraductions.getValeur('Nom'):null}
]});}
if(this._options.optionsListe){$.extend(lOptions,this._options.optionsListe);}
aInstance.setOptionsListe(lOptions);}
_evenementSurListe(aParametres){switch(aParametres.genreEvenement){case EGenreEvenementListe.ModificationCBLigne:case EGenreEvenementListe.ApresEdition:{this.SetBoutonActif(this.indexBtnValider,!this._options.selectionObligatoire||this._nbRessourcesCochees()>0);break;}}}
_creerObjetDonneesListe(){return this._options.listeFlatDesign?new DonneesListe_SelectionRessource_fd(this.listeRessources):new DonneesListe_SelectionRessource(this.listeRessources);}
_actualiserListe(){this.SetBoutonActif(this.indexBtnValider,!this._options.selectionObligatoire||this._nbRessourcesCochees()>0);const lDonneesListe=this._creerObjetDonneesListe();lDonneesListe._options=this._options;if(this._options.optionsDonneesListe){lDonneesListe.setOptions(this._options.optionsDonneesListe);}
const lBoutons=[{genre:ObjetListe.typeBouton.rechercher}];if(this._options.gestionCumulRessource){lBoutons.push({genre:ObjetListe.typeBouton.deployer});}
this.GetInstance(this.identListe).setOptionsListe({boutons:lBoutons}).SetDonnees(lDonneesListe);if(this.optionsFenetre.avecTailleSelonContenu){this.positionnerFenetre();this.setCoordonnees();}}
_nbRessourcesCochees(){let lNombre=0;for(let i=0,lNb=this.listeRessources.GetNbrElements();i<lNb;i++){if(this.listeRessources.GetElement(i).selectionne){lNombre++;}}
return lNombre;}
_getNbRessourcesSelectionnables(){let lCompteur=0;for(let i=0,lNb=this.listeRessources.GetNbrElements();i<lNb;i++){if(!this.listeRessources.GetElement(i).estDeploiement){lCompteur++;}}
return lCompteur;}
surFixerTaille(){super.surFixerTaille();if(!this.optionsFenetre.avecTailleSelonContenu&&GPosition.declencherResize&&!GStyle.styleSheetDisabled()){GPosition.declencherResize(this.GetInstance(this.identListe).GetNom());}}}
function _majListeSelection(){this.listeRessourcesSelectionnees.vider();const lNb=this.listeRessources.GetNbrElements();for(let i=0;i<lNb;i++){const lRessource=this.listeRessources.GetElement(i);if(lRessource.selectionne&&!lRessource.estUnDeploiement&&!this.listeRessourcesSelectionnees.GetElementParElement(lRessource)){this.listeRessourcesSelectionnees.AddElement(MethodesObjet.dupliquer(lRessource));}}}
module.exports=ObjetFenetre_SelectionRessource;},fn:"objetfenetre_selectionressource.js"});;
IE.fModule({f:function(exports,require,module,global){const GTraductions=require('ObjetTraduction.js');const ObjetDonneesListeFlatDesign=require('ObjetDonneesListeFlatDesign.js');class DonneesListe_SelectionPublic extends ObjetDonneesListeFlatDesign{constructor(aDonnees){aDonnees.parcourir(function(D){if(!D.estUnDeploiement&&D.selectionne&&D.pere){D.pere.selectionne=true;}});super(aDonnees);this.setOptions({avecSelection:false,avecSuppression:false,avecEtatSaisie:false,avecTri:false,avecCB:true,avecEvnt_CB:true,avecCocheCBSurLigne:true,avecEvnt_Deploiement:true,avecEventDeploiementSurCellule:true,avecEvnt_ApresEdition:true,avecBoutonActionLigne:false});}
getDisabledCB(aParams){let D=aParams.article;return D.avecReponse||D.nonModifiable||D.refusMess||(D.estUnDeploiement&&!(this._options&&this._options.selectionCumul));}
getValueCB(aParams){return aParams.article?aParams.article.selectionne:false;}
setValueCB(aParams,aValue){aParams.article.selectionne=aValue;this.Donnees.parcourir(function(aElt){if(aElt.egalParNumeroEtGenre(aParams.article.GetNumero(),aParams.article.GetGenre())){aElt.selectionne=aValue;}});}
AvecDeploiement(){return true;}
surDeploiement(I,J,D){if(this._options.avecFiltreDelegues){return;}
D.estDeploye=!D.estDeploye;}
AvecEvenement_Deploiement(){return!this._options.avecFiltreDelegues;}
avecEventDeploiementSurCellule(){return!this._options.avecFiltreDelegues;}
getTitreZonePrincipale(aParams){let D=aParams.article;let lLibelleMatieres='';if(!D.estUnDeploiement&&D.pere&&D.eleves){const lEleve=D.eleves.GetElementParNumero(D.pere.GetNumero());if(lEleve&&lEleve.matieres){lLibelleMatieres='<div>'+lEleve.matieres.getTableauLibelles().join(', ')+'</div>';}}
let lIconDetaches='';if(this._options.avecIconElevesDetaches&&!D.estUnDeploiement&&D.estElevesDetachesDuCours){lIconDetaches='<i class="icon_eleve_detache EspaceGauche EspaceDroite"></i>';}
let lLibelle=(this._options&&this._options.avecIndicationDiscussionInterdit&&D.discussionInterdit?'<span style="line-height: 18px; vertical-align: middle;">'+D.GetLibelle()+'</span><div style="float:right;" class="EspaceGauche Image_MessagerieBloquee AlignementMilieuVertical" title="'+GTraductions.getValeur('Messagerie.HintReponseDicussionInterdite')+'"></div>':((D.libelleAffichage!==null)&&(D.libelleAffichage!==undefined)?D.libelleAffichage:D.GetLibelle()))+lIconDetaches+lLibelleMatieres;if(D.refusMess){lLibelle=`${lLibelle} - ${GTraductions.getValeur('Messagerie.RefuseDiscussions')}`;}
return lLibelle;}
getInfosSuppZonePrincipale(aParams){if(this._options&&this._options.getInfosSuppZonePrincipale){return this._options.getInfosSuppZonePrincipale(aParams);}
return'';}
getHintForce(aParams,I,D){if(this._options&&this._options.getHintRessource){return this._options.getHintRessource(D);}
return'';}
getClass(aParams,I,D){if(this._options&&this._options.getClassRessource){return this._options.getClassRessource(D);}
return'';}
GetVisible(D){if(!this._options||!this._options.filtres){return true;}
let lVisible=true;for(const i in this._options.filtres){const lFiltre=this._options.filtres[i];lVisible=lVisible&&lFiltre.filtre(D,lFiltre.checked);if(!lVisible){D.selectionne=false;return false;}}
return lVisible;}
desactiverIndentationParente(){return true;}}
module.exports=DonneesListe_SelectionPublic;},fn:"donneesliste_selectionpublic.js"});;
IE.fModule({f:function(exports,require,module,global){const MethodesObjet=require('MethodesObjet.js');const EGenreEvenementObjetSaisie=require('Enumere_EvenementObjetSaisie.js');const EGenreSaisie=require('Enumere_Saisie.js');const ObjetFenetre_SelectionRessource=require('ObjetFenetre_SelectionRessource.js');const ObjetListe=require('ObjetListe.js');const ObjetElement=require('ObjetElement.js');const ObjetListeElements=require('ObjetListeElements.js');const ObjetSaisie=require('ObjetSaisie.js');const GTraductions=require('ObjetTraduction.js');const ObjetTri=require('ObjetTri.js');const GHtml=require('GHtml.js');const TypeThemeBouton=require('Type_ThemeBouton.js');const DonneesListe_SelectionPublic=require('DonneesListe_SelectionPublic.js');const _ObjetListe=require('_ObjetListe.js');const TypeGenreCumulSelectionPublic={sans:0,classe:1,initial:2,nomEleves:3,lieuEnseignement:4,attendusEnCours:5,respDelegues:6,famille:7,servicesPeriscolaire:8};class ObjetFenetre_SelectionPublic extends ObjetFenetre_SelectionRessource{constructor(...aParams){super(...aParams);this.idMessage=this.Nom+'_message';this.setOptionsFenetre({largeur:340,hauteur:530,listeBoutons:[{libelle:GTraductions.getValeur('Annuler'),theme:TypeThemeBouton.secondaire},{libelle:GTraductions.getValeur('Valider'),theme:TypeThemeBouton.primaire}
],listeBoutonsInactifs:[],heightMax_mobile:true,masquerListeSiVide:true});this.setSelectionObligatoire(true);this.indexBtnValider=1;this.donnees={listeCumuls:null,cumulActif:null};this._options={afficherUtilisateurCourant:true,selectionCumul:true,avecIndicationDiscussionInterdit:false,avecFiltreDelegues:false,estDeploye:false,avecElevesDetaches:false};}
getGenreCumul(){return this.donnees.cumulActif?this.donnees.cumulActif.GetGenre():TypeGenreCumulSelectionPublic.sans;}
setGenreCumulActif(aGenreCumul){if(aGenreCumul){let lCumulDepuisListe=null;if(!!this.donnees.listeCumuls){lCumulDepuisListe=this.donnees.listeCumuls.GetElementParGenre(aGenreCumul);}
if(!lCumulDepuisListe){lCumulDepuisListe=new ObjetElement('',0,aGenreCumul,0);}
this.setCumulActif(lCumulDepuisListe);}}
setCumulActif(aCumul){this.donnees.cumulActif=aCumul;}
setListeCumuls(aListeCumuls){this.donnees.listeCumuls=aListeCumuls;}
setOptions(aOptions){$.extend(this._options,aOptions);}
ConstruireInstances(){this.identListe=this.Add(ObjetListe,this._evenementSurListe,this._initialiserListe);this.identCumul=this.Add(ObjetSaisie,_evntCumul.bind(this),_initialiserCumul.bind(this));}
ComposeContenu(){const T=[];T.push('<div id="',this.idConteneurFiltre,'" style="display:none"></div>');T.push('<div id="',this.GetNomInstance(this.identCumul),'" class="PetitEspaceBas GrandEspaceGauche" style="display:none"></div>');T.push('<div id="'+this.GetNomInstance(this.identListe)+'" class="Table"></div>');T.push('<div style="display:none" class="Espace" id="',this.idMessage,'">',GTraductions.getValeur('Fenetre_SelectionPublic.AucunDestinataire'),'</div>');return T.join('');}
setDonnees(aParam){this.titre=aParam.titre;this.estGenreRessourceDUtilisateurConnecte=aParam.estGenreRessourceDUtilisateurConnecte;this._options.avecIndicationDiscussionInterdit=aParam.avecIndicationDiscussionInterdit;this.SetDonnees(aParam.listeRessources,aParam.listeRessourcesSelectionnees,aParam.genreRessource);}
SetDonnees(aListeRessources,aListeRessourcesSelectionnees,aGenreRessource){this.listeRessourcesT=aListeRessources;this.listeRessourcesSelectionnees=aListeRessourcesSelectionnees;this.genreRessource=aGenreRessource;this._formatterDonneesSelonOptions();const lBoutons=[{genre:_ObjetListe.typeBouton.rechercher}];if(this.getGenreCumul()!==TypeGenreCumulSelectionPublic.sans){lBoutons.push({genre:_ObjetListe.typeBouton.deployer});}
this.GetInstance(this.identListe).setOptionsListe({avecCBToutCocher:this._options.avecCocheRessources?{libelle:GTraductions.getValeur('liste.toutCocher')}:false,boutons:lBoutons,nonEditable:false,avecCelluleEditableTriangle:false});this.actualiserAffichage();if(this.donnees.listeCumuls&&this.donnees.listeCumuls.GetNbrElements()>0){this.GetInstance(this.identCumul).SetDonnees(this.donnees.listeCumuls,0);} else{$('#'+this.GetInstance(this.identCumul).GetNom().escapeJQ()).hide();}
if(this._options.avecFiltreDelegues){$('#'+this.GetInstance(this.identCumul).GetNom().escapeJQ()).hide();}}
_formatterDonneesSelonOptions(){const lSelf=this;const lNumeroUtilisateur=GEtatUtilisateur.getUtilisateur().GetNumero();this.listeRessourcesT.parcourir(function(D){if(lSelf._options.afficherUtilisateurCourant===false&&lSelf.estGenreRessourceDUtilisateurConnecte&&D.GetNumero()===lNumeroUtilisateur){D.nePasAfficher=true;} else{delete D.nePasAfficher;}});}
actualiserAffichage(){switch(this.getGenreCumul()){case TypeGenreCumulSelectionPublic.sans:this.construireListeRessource(this.listeRessourcesT,this.listeRessourcesSelectionnees);break;case TypeGenreCumulSelectionPublic.classe:this._construireListeRessourceAvecCumulClasse(this.listeRessourcesT,this.listeRessourcesSelectionnees);break;case TypeGenreCumulSelectionPublic.initial:this._construireListeRessourceAvecCumulInitial(this.listeRessourcesT,this.listeRessourcesSelectionnees);break;case TypeGenreCumulSelectionPublic.nomEleves:_construireListeRessourceAvecCumulEleves.call(this,this.listeRessourcesT,this.listeRessourcesSelectionnees);break;case TypeGenreCumulSelectionPublic.lieuEnseignement:_construireListeRessourceAvecCumulLieuEnseignement.call(this,this.listeRessourcesT,this.listeRessourcesSelectionnees);break;case TypeGenreCumulSelectionPublic.attendusEnCours:_construireListeRessourceAvecCumulAttendusEnCours.call(this,this.listeRessourcesT,this.listeRessourcesSelectionnees);break;case TypeGenreCumulSelectionPublic.respDelegues:_construireListeRessourceAvecCumulRespDelegues.call(this,this.listeRessourcesT,this.listeRessourcesSelectionnees);break;case TypeGenreCumulSelectionPublic.famille:{const lFamilleConcernee=this.donnees.cumulActif?this.donnees.cumulActif.famille:null;_construireListeRessourceAvecCumulFamille.call(this,this.listeRessourcesT,this.listeRessourcesSelectionnees,lFamilleConcernee);break;}
case TypeGenreCumulSelectionPublic.servicesPeriscolaire:{_construireListeRessourceAvecCumulServicePeriscolaire.call(this,this.listeRessourcesT,this.listeRessourcesSelectionnees);break;}
default:;break;}
if(this.titre){this.setOptionsFenetre({titre:this.titre});}
this.Afficher();this._construireFiltres();this._actualiserListe();}
_initialiserListe(aInstance){let lOptions={skin:ObjetListe.skin.flatDesign,avecCBToutCocher:this._options.avecCocheRessources?{libelle:GTraductions.getValeur('liste.toutCocher')}:false};if(this._options.optionsListe){$.extend(lOptions,this._options.optionsListe);}
aInstance.setOptionsListe(lOptions);}
_actualiserListe(){this.SetBoutonActif(this.indexBtnValider,!this.selectionObligatoire||this._nbRessourcesCochees()>0);const lDonneesListe=new DonneesListe_SelectionPublic(this.listeRessources);lDonneesListe._options=this._options;lDonneesListe._options.avecIconElevesDetaches=this._options.avecElevesDetaches&&(this.getGenreCumul()!==TypeGenreCumulSelectionPublic.attendusEnCours);if(this.listeRessources.GetNbrElements()>0||!this.optionsFenetre.masquerListeSiVide){this.GetInstance(this.identListe).SetDonnees(lDonneesListe);} else{GHtml.setDisplay(this.idMessage,true);GHtml.setDisplay(this.GetNomInstance(this.identListe),false);}}
_construireListeRessourceAvecCumulClasse(aListeRessources,aListeRessourcesSelectionnees){const lCumulGroupe=new ObjetElement(GTraductions.getValeur('Fenetre_SelectionPublic.SansClasse'),0,0);lCumulGroupe.estDeploye=this._options.estDeploye||false;lCumulGroupe.estUnDeploiement=true;lCumulGroupe.__sansClasse__=true;lCumulGroupe.SetActif(true);const lListeCumul=new ObjetListeElements();let lAvecGroupe=false;this.listeRessources=new ObjetListeElements();let lEltResSel;for(let i=0,lNbr=aListeRessources.GetNbrElements();i<lNbr;i++){if(aListeRessources.GetElement(i).existeNumero()){const lRessource=MethodesObjet.dupliquer(aListeRessources.GetElement(i));if(!lRessource.classes||lRessource.classes.GetNbrElements()===0){lAvecGroupe=true;lRessource.pere=lCumulGroupe;lEltResSel=aListeRessourcesSelectionnees.GetElementParElement(lRessource);if(lEltResSel){lRessource.selectionne=true;lRessource.avecReponse=!!lEltResSel.avecReponse;lRessource.nonModifiable=!!lEltResSel.nonModifiable;} else{lRessource.selectionne=false;}
this.listeRessources.AddElement(lRessource);} else{for(let j=0,lNbr2=lRessource.classes.GetNbrElements();j<lNbr2;j++){const lMaRessource=MethodesObjet.dupliquer(lRessource);let lNiveau=lListeCumul.GetElement(lListeCumul.GetIndiceParNumeroEtGenre(lRessource.classes.GetNumero(j)));if(!lNiveau){const lSansClasse=!lRessource.classes.GetLibelle(j);lNiveau=new ObjetElement(lRessource.classes.GetLibelle(j)||GTraductions.getValeur('Fenetre_SelectionPublic.SansClasse'),lRessource.classes.GetNumero(j),0);lNiveau.estUnDeploiement=true;lNiveau.estDeploye=this._options.estDeploye||false;lNiveau.__sansClasse__=lSansClasse;lListeCumul.AddElement(lNiveau);}
lMaRessource.pere=lNiveau;lEltResSel=aListeRessourcesSelectionnees.GetElementParElement(lRessource);if(lEltResSel){lMaRessource.selectionne=true;lMaRessource.avecReponse=!!lEltResSel.avecReponse;lRessource.nonModifiable=!!lEltResSel.nonModifiable;} else{lMaRessource.selectionne=false;}
this.listeRessources.AddElement(lMaRessource);}}}}
if(lAvecGroupe){this.listeRessources.AddElement(lCumulGroupe);}
for(let i=0,lNbr=lListeCumul.GetNbrElements();i<lNbr;i++){this.listeRessources.AddElement(lListeCumul.GetElement(i));}
this.listeRessources.setTri([
ObjetTri.initRecursif('pere',[
ObjetTri.init(function(D){return!D.__sansClasse__;}),ObjetTri.init('Position'),ObjetTri.init('Libelle')
])
]);this.listeRessources.trier();}
_construireListeRessourceAvecCumulInitial(aListeRessources,aListeRessourcesSelectionnees){const lCumulGroupe=new ObjetElement(' ',0,0);lCumulGroupe.estDeploye=this._options.estDeploye||false;lCumulGroupe.estUnDeploiement=true;lCumulGroupe.SetActif(true);lCumulGroupe.__sansInitiale__=true;const lListeCumul=new ObjetListeElements();let lAvecGroupe=false;let lEltResSel;this.listeRessources=new ObjetListeElements();for(let i=0,lNbr=aListeRessources.GetNbrElements();i<lNbr;i++){if(aListeRessources.GetElement(i).existeNumero()){const lRessource=MethodesObjet.dupliquer(aListeRessources.GetElement(i));if(!lRessource.ini){lAvecGroupe=true;lRessource.pere=lCumulGroupe;} else{let lNiveau=lListeCumul.GetElement(lListeCumul.GetIndiceParLibelle(lRessource.ini));if(!lNiveau){lNiveau=new ObjetElement(lRessource.ini,ObjetElement.getNumeroCreation(),0);lNiveau.estUnDeploiement=true;lNiveau.estDeploye=this._options.estDeploye||false;lListeCumul.AddElement(lNiveau);}
lRessource.pere=lNiveau;}
lEltResSel=aListeRessourcesSelectionnees.GetElementParElement(lRessource);if(lEltResSel){lRessource.selectionne=true;lRessource.avecReponse=!!lEltResSel.avecReponse;lRessource.nonModifiable=!!lEltResSel.nonModifiable;} else{lRessource.selectionne=false;}
this.listeRessources.AddElement(lRessource);}}
if(lAvecGroupe){this.listeRessources.AddElement(lCumulGroupe);}
for(let i=0,lNbr=lListeCumul.GetNbrElements();i<lNbr;i++){this.listeRessources.AddElement(lListeCumul.GetElement(i));}
this.listeRessources.setTri([ObjetTri.init(function(D){return D.pere?!!D.pere.__sansInitiale__:!!D.__sansInitiale__;}),ObjetTri.init(function(D){return D.pere?D.pere.GetLibelle():D.GetLibelle();}),ObjetTri.init(function(D){return!!D.pere;}),ObjetTri.init('Position'),ObjetTri.init('Libelle')]);this.listeRessources.trier();}}
function _initialiserCumul(aInstance){aInstance.setOptions_ObjetSaisie({mode:EGenreSaisie.Combo,longueur:140,avecBouton:undefined,texteEdit:GTraductions.getValeur('Fenetre_SelectionPublic.Cumul.Label')});}
function _evntCumul(aGenreEvenement,aElement){if(aGenreEvenement===EGenreEvenementObjetSaisie.selection){this.setCumulActif(aElement);this.forcerMajListeSelection();this.actualiserAffichage();}}
function _construireListeRessourceAvecCumulEleves(aListeRessources,aListeRessourcesSelectionnees){this.listeRessources=new ObjetListeElements();aListeRessources.parcourir(function(aRessource){if(aRessource.eleves){aRessource.eleves.parcourir(function(aEleve){let lCumulEleve=this.listeRessources.GetElementParElement(aEleve);if(!lCumulEleve){lCumulEleve=MethodesObjet.dupliquer(aEleve);this.listeRessources.AddElement(lCumulEleve);lCumulEleve.estUnDeploiement=true;lCumulEleve.estDeploye=this._options.estDeploye||false;}
const lRessource=MethodesObjet.dupliquer(aRessource);this.listeRessources.AddElement(lRessource);lRessource.pere=lCumulEleve;const lEltResSel=aListeRessourcesSelectionnees.GetElementParElement(lRessource);if(lEltResSel){lRessource.selectionne=true;lRessource.avecReponse=!!lEltResSel.avecReponse;lRessource.nonModifiable=!!lEltResSel.nonModifiable;} else{lRessource.selectionne=false;}}.bind(this));}}.bind(this));this.listeRessources.setTri([
ObjetTri.initRecursif('pere',[
ObjetTri.init('Position'),ObjetTri.init('Libelle')
])
]).trier();}
function _construireListeRessourceAvecCumulRespDelegues(aListeRessources,aListeRessourcesSelectionnees){const lEstDeployeParDefaut=this._options.estDeploye||false;this.listeRessources=new ObjetListeElements();aListeRessources.parcourir(function(aCumul){if(aCumul.listeResp.GetNbrElements()>0){const lCumul=new ObjetElement(aCumul.GetLibelle());lCumul.estUnDeploiement=true;lCumul.estDeploye=lEstDeployeParDefaut;this.listeRessources.AddElement(lCumul);aCumul.listeResp.parcourir(function(aRessource){const lRessource=MethodesObjet.dupliquer(aRessource);if(!!aListeRessourcesSelectionnees.GetElementParElement(aRessource)){lRessource.selectionne=true;}
if(lRessource.delegueDesClasses){lRessource.SetLibelle(lRessource.GetLibelle()+' ('+lRessource.delegueDesClasses+')');}
lRessource.pere=lCumul;this.listeRessources.AddElement(lRessource);}.bind(this));}}.bind(this));this.listeRessources.setTri([
ObjetTri.initRecursif('pere',[
ObjetTri.init('Position'),ObjetTri.init('Libelle')
])
]);this.listeRessources.trier();}
function _construireListeRessourceAvecCumulServicePeriscolaire(aListeRessources,aListeRessourcesSelectionnees){const lEstDeployeParDefaut=this._options.estDeploye||false;this.listeRessources=new ObjetListeElements();let lTestElmAucuneExiste=false;if(aListeRessources&&(aListeRessources.GetNbrElements()>0)){const lCumulAucun=new ObjetElement(GTraductions.getValeur('Fenetre_SelectionPublic.CumulServicePeriscolaire.Sans'),0,-1,1);lCumulAucun.estUnDeploiement=true;lCumulAucun.estDeploye=false;aListeRessources.parcourir((aRessource) =>{if(!!aRessource.listeServicesPeriscolaire&&(aRessource.listeServicesPeriscolaire.GetNbrElements()>0)){aRessource.listeServicesPeriscolaire.parcourir((aServicePeriscolaire) =>{let lRessource=MethodesObjet.dupliquer(aRessource);if(!!aListeRessourcesSelectionnees.GetElementParElement(aRessource)){lRessource.selectionne=true;}
let lCumulSP=this.listeRessources.GetElementParElement(aServicePeriscolaire);if(!lCumulSP){lCumulSP=MethodesObjet.dupliquer(aServicePeriscolaire);this.listeRessources.AddElement(lCumulSP);lCumulSP.estUnDeploiement=true;lCumulSP.estDeploye=lEstDeployeParDefaut;}
lRessource.pere=lCumulSP;this.listeRessources.AddElement(lRessource);});} else{let lRessource=MethodesObjet.dupliquer(aRessource);if(!!aListeRessourcesSelectionnees.GetElementParElement(aRessource)){lRessource.selectionne=true;}
lTestElmAucuneExiste=lTestElmAucuneExiste||!!this.listeRessources.GetElementParElement(lCumulAucun);if(!lTestElmAucuneExiste){this.listeRessources.add(lCumulAucun);}
lRessource.pere=lCumulAucun;this.listeRessources.AddElement(lRessource);}});}
this.listeRessources.setTri([
ObjetTri.initRecursif('pere',[
ObjetTri.init('Position'),ObjetTri.init('Libelle')
])
]);this.listeRessources.trier();}
function _construireListeRessourceAvecCumulFamille(aListeRessources,aListeRessourcesSelectionnees,aFamilleConcernee){const lListeRessources=new ObjetListeElements();let lTestElmAucuneExiste=false;if(aListeRessources&&aListeRessources.GetNbrElements()>0){const lCumulAucun=new ObjetElement(GTraductions.getValeur('Fenetre_SelectionPublic.CumulFamille.SansRubrique'),0,-1,1);lCumulAucun.estUnDeploiement=true;lCumulAucun.estDeploye=false;aListeRessources.parcourir((aRessource) =>{const lRessource=MethodesObjet.dupliquer(aRessource);if(!!aListeRessourcesSelectionnees.GetElementParElement(aRessource)){lRessource.selectionne=true;}
let lAppartientAAuMoinsUneSousFamille=false;if(lRessource.listeFamilles){const lFamilleTrouvee=lRessource.listeFamilles.GetElementParElement(aFamilleConcernee);if(lFamilleTrouvee&&lFamilleTrouvee.listeSousFamilles&&lFamilleTrouvee.listeSousFamilles.GetNbrElements()>0){lAppartientAAuMoinsUneSousFamille=true;lFamilleTrouvee.listeSousFamilles.parcourir((aSousFamille) =>{let lCumulSousFamille=lListeRessources.GetElementParElement(aSousFamille);if(!lCumulSousFamille){lCumulSousFamille=aSousFamille;lCumulSousFamille.estUnDeploiement=true;lCumulSousFamille.estDeploye=false;lListeRessources.add(lCumulSousFamille);}
if(lListeRessources.GetElementParElement(lRessource)){const lRessourceDupliquee=MethodesObjet.dupliquer(lRessource);lRessourceDupliquee.pere=lCumulSousFamille;lListeRessources.AddElement(lRessourceDupliquee);} else{lRessource.pere=lCumulSousFamille;lListeRessources.AddElement(lRessource);}});}}
if(!lAppartientAAuMoinsUneSousFamille){lTestElmAucuneExiste=lTestElmAucuneExiste||!!lListeRessources.GetElementParElement(lCumulAucun);if(!lTestElmAucuneExiste){lListeRessources.add(lCumulAucun);}
lRessource.pere=lCumulAucun;lListeRessources.AddElement(lRessource);}});this.listeRessources=lListeRessources;this.listeRessources.setTri([
ObjetTri.initRecursif('pere',[
ObjetTri.init('Position'),ObjetTri.init('Libelle')
])
]);this.listeRessources.trier();}}
function _construireListeRessourceAvecCumulAttendusEnCours(aListeRessources,aListeRessourcesSelectionnees){const lThis=this;const lEstDeployeParDefaut=this._options.estDeploye||false;const lGenresCumuls={detaches:0,attendus:1};const lListeCumulsPossibles=new ObjetListeElements();lListeCumulsPossibles.AddElement(new ObjetElement(GTraductions.getValeur('Fenetre_SelectionPublic.CumulAttendusEnCours.Detaches'),lGenresCumuls.detaches,-1,1));lListeCumulsPossibles.AddElement(new ObjetElement(GTraductions.getValeur('Fenetre_SelectionPublic.CumulAttendusEnCours.Attendus'),lGenresCumuls.attendus,-1,2));this.listeRessources=new ObjetListeElements();aListeRessources.parcourir(function(aRessource){const lRessource=MethodesObjet.dupliquer(aRessource);if(!!aListeRessourcesSelectionnees.GetElementParElement(aRessource)){lRessource.selectionne=true;}
let lPere;if(!!lRessource.estElevesDetachesDuCours){lPere=lListeCumulsPossibles.GetElementParNumero(lGenresCumuls.detaches);} else{lPere=lListeCumulsPossibles.GetElementParNumero(lGenresCumuls.attendus);}
lPere.estUnDeploiement=true;lPere.estDeploye=lEstDeployeParDefaut;lRessource.pere=lPere;lThis.listeRessources.AddElement(lRessource);});lListeCumulsPossibles.parcourir(function(aCumul){if(aCumul.estUnDeploiement){lThis.listeRessources.AddElement(aCumul);}});this.listeRessources.setTri([
ObjetTri.initRecursif('pere',[
ObjetTri.init('Position'),ObjetTri.init('Libelle')
])
]);this.listeRessources.trier();}
function _construireListeRessourceAvecCumulLieuEnseignement(aListeRessources,aListeRessourcesSelectionnees){const lThis=this;const lEstDeployeParDefaut=this._options.estDeploye||false;const LieuEnseignement={ALEtablissement:0,ALaMaison:1};const lListeCumulsPossibles=new ObjetListeElements();lListeCumulsPossibles.AddElement(new ObjetElement(GTraductions.getValeur('Fenetre_SelectionPublic.CumulLieuEnseignement.Etablissement'),LieuEnseignement.ALEtablissement));lListeCumulsPossibles.AddElement(new ObjetElement(GTraductions.getValeur('Fenetre_SelectionPublic.CumulLieuEnseignement.ALaMaison'),LieuEnseignement.ALaMaison));this.listeRessources=new ObjetListeElements();aListeRessources.parcourir(function(aRessource){const lRessource=MethodesObjet.dupliquer(aRessource);if(!!aListeRessourcesSelectionnees.GetElementParElement(aRessource)){lRessource.selectionne=true;}
let lPere;if(!!lRessource.estEnEnseignementADistance){lPere=lListeCumulsPossibles.GetElementParNumero(LieuEnseignement.ALaMaison);} else{lPere=lListeCumulsPossibles.GetElementParNumero(LieuEnseignement.ALEtablissement);}
lPere.estUnDeploiement=true;lPere.estDeploye=lEstDeployeParDefaut;lRessource.pere=lPere;lThis.listeRessources.AddElement(lRessource);});lListeCumulsPossibles.parcourir(function(aCumul){if(aCumul.estUnDeploiement){lThis.listeRessources.AddElement(aCumul);}});this.listeRessources.setTri([
ObjetTri.initRecursif('pere',[
ObjetTri.init('Position'),ObjetTri.init('Libelle')
])
]);this.listeRessources.trier();}
module.exports={ObjetFenetre_SelectionPublic,TypeGenreCumulSelectionPublic};},fn:"objetfenetre_selectionpublic.js"});;
IE.fModule({f:function(exports,require,module,global){const{TypeGenreCumulSelectionPublic}=require('ObjetFenetre_SelectionPublic.js');const EGenreRessource=require('Enumere_Ressource.js');module.exports.getCumulPourFenetrePublic=function(aGenre,aChecked,aNombre){switch(aGenre){case EGenreRessource.Eleve:return aChecked===true?TypeGenreCumulSelectionPublic.initial:TypeGenreCumulSelectionPublic.classe;case EGenreRessource.Responsable:return aNombre>200?TypeGenreCumulSelectionPublic.initial:TypeGenreCumulSelectionPublic.sans;case EGenreRessource.Enseignant:case EGenreRessource.Personnel:case EGenreRessource.MaitreDeStage:case EGenreRessource.InspecteurPedagogique:return TypeGenreCumulSelectionPublic.sans;default:;return;}};},fn:"utilitairefenetreselectionpublic.js"});;
IE.fModule({f:function(exports,require,module,global){require('produit/css/MoteurForumPedagogique.css');const GTraductions=require('ObjetTraduction.js');const EGenreBoiteMessage=require('Enumere_BoiteMessage.js');const EGenreAction=require('Enumere_Action.js');const{ObjetRequeteConsultation,ObjetRequeteSaisie}=require('ObjetRequeteJSON.js');const Requetes=require('CollectionRequetes.js');const TypeChaineHtml=require('TypeChaineHtml.js');const ObjetElement=require('ObjetElement.js');const{TypeDroits}=require('ObjetDroitsPN.js');const{TypeGenreModerationForum,TypeForumPedaCommandeRequete,TypeForumPedaCommandeSaisie,TypeGenreVisiteurForum,TypeActionPost,TypeEtatPub,TypeRoleIndividuSujet,TypeGenreActionSurPostForum}=require('TypesForumPedagogique.js');const TypeEnsemblenombre=require('TypeEnsemblenombre.js');const ObjetListeElements=require('ObjetListeElements.js');const{GDate}=require('ObjetDate.js');const ObjetFenetre=require('ObjetFenetre.js');const{ObjetFenetre_SelectionPublic}=require('ObjetFenetre_SelectionPublic.js');const{getCumulPourFenetrePublic}=require('UtilitaireFenetreSelectionPublic.js');const EGenreRessource=require('Enumere_Ressource.js');const tag=require('tag.js');const{Invocateur}=require('Invocateur.js');const UtilsRequeteJSON=require('ObjetRequeteJSON.js').utils;const EGenreEspace=require('Enumere_Espace.js');const TypeCommandeSujet={modifier:'modifier',dupliquer:'dupliquer',verrouiller:'verrouiller',deverrouiller:'deverrouiller',nettoyer:'nettoyer',supprimer:'supprimer',modifierExclus:'modifierExclus'};class MoteurForumPedagogique{constructor(aParams){this.options=Object.assign({pere:null,ouvrirEditionSujet_promise:null,callbackActualisationSujets:null,callbackSaisiePost:null},aParams);this.indicePostLuEnCours= -1;if(this.options.pere){Invocateur.abonner(UtilsRequeteJSON.getIdentNotification('actualisation_postForum'),() =>{if(this.options.callbackActualisationSujets&&!this._callbackActualisationSujets_enCours){this.options.callbackActualisationSujets();}},this.options.pere);}}
getOptions(){return this.options;}
setOptions(aOptions){Object.assign(this.options,aOptions);return this;}
avecGestionThemes(){if(GApplication.estPrimaire){return false;}
if([EGenreEspace.Professeur,EGenreEspace.Mobile_Professeur].includes(GEtatUtilisateur.GenreEspace)){return GApplication.parametresUtilisateur.get('avecGestionDesThemes');}
return true;}
setIndicePostLu(aIndice){if(aIndice>=0){this.indicePostLuEnCours=Math.max(aIndice,this.indicePostLuEnCours);} else{this.indicePostLuEnCours=aIndice;}}
requetePostsLu(aParams){const lParams=Object.assign({ancienSujet:null,listePosts:null,nouveauSujet:null,sansActualisation:false},aParams);const lIndicePost=this.indicePostLuEnCours;this.setIndicePostLu(-1);const lPost=lIndicePost>=0&&lParams.listePosts?lParams.listePosts.GetElement(lIndicePost):null;if(lPost&&lParams.ancienSujet&&!GApplication.droits.get(TypeDroits.estEnConsultation)){return new ObjetRequeteSaisieForumPedagogique(this.options.pere).lancerRequete({type:TypeForumPedaCommandeSaisie.fpcs_Post_ModifierLu,post:lPost,sujet:lParams.ancienSujet}).then(() =>{if(!lParams.sansActualisation){return _callbackActualisationSujets(this,{sujetSelection:lParams.nouveauSujet||lParams.ancienSujet});}}).then(() =>{return true;});}
return Promise.resolve(false);}
requeteListeSujets(){return new ObjetRequeteForumPedagogique(this.options.pere).lancerRequete({type:TypeForumPedaCommandeRequete.fpcr_Sujets}).then((aJSON) =>{return aJSON.listeSujets;});}
requeteListePosts(aParams){const lParams=Object.assign({sujet:null,avecSujet:true,modeVisuMembre:false},aParams);if(!lParams.sujet){return Promise.resolve();}
return new ObjetRequeteForumPedagogique(this.options.pere).lancerRequete(Object.assign({type:TypeForumPedaCommandeRequete.fpcr_Posts},lParams)).then((aJSON) =>{return aJSON;},() =>{return _callbackActualisationSujets(this).then(() => false);});}
requeteConsigneVisible(aSujet,aConsigneVisible){if(aSujet&&!GApplication.droits.get(TypeDroits.estEnConsultation)&&!(aSujet.roles.count()===1&&aSujet.roles.contains(TypeRoleIndividuSujet.RIS_Visiteur))){return new ObjetRequeteSaisieForumPedagogique(this.options.pere).lancerRequete({type:TypeForumPedaCommandeSaisie.fpcs_ModifierConsigneVisibleSujet,sujet:aSujet,consigneVisible:!!aConsigneVisible});}
return Promise.resolve(false);}
editerSujet(aSujetEdition){const lSurCreationSujet=!aSujetEdition;if(!this.options.callbackActualisationSujets){return Promise.reject();}
return Promise.resolve().then(() =>{return new ObjetRequeteForumPedagogique(this.options.pere).lancerRequete({type:TypeForumPedaCommandeRequete.fpcr_DetailSujet,sujet:aSujetEdition,surCreationSujet:lSurCreationSujet}).then((aJSON) =>{if(lSurCreationSujet){return Object.assign(_getSujetParDefaut(),aJSON.sujet);}
return aJSON.sujet;},() =>{return _callbackActualisationSujets(this).then(() =>{throw new Error({erreurDetailSujet:true});});});}).then((aSujet) =>{return this.options.ouvrirEditionSujet_promise(aSujet,lSurCreationSujet);}).then((aParametresSaisie) =>{if(aParametresSaisie.sujet){const lParams={type:TypeForumPedaCommandeSaisie.fpcs_CreerModifierSujet,sujet:aParametresSaisie.sujet,estEdition:!lSurCreationSujet};const lListeFichiers=aParametresSaisie.sujet.listeFichiers||new ObjetListeElements();return new ObjetRequeteSaisieForumPedagogique(this.options.pere).addUpload({listeFichiers:lListeFichiers,listeDJCloud:lListeFichiers}).lancerRequete(lParams).then((aParamsRequete) =>{let lSujetASelectioner=null;if(lSurCreationSujet&&aParamsRequete.JSONRapportSaisie){lSujetASelectioner=aParamsRequete.JSONRapportSaisie.sujet;}
return _callbackActualisationSujets(this,{sujetSelection:lSujetASelectioner});});}}).catch(() =>{});}
getCommandesMenuContextuel_sujet(aSujet){if(!aSujet){return[];}
const lEstModerateur=aSujet.roles.contains(TypeRoleIndividuSujet.RIS_Moderateur);const lResult=[];if(lEstModerateur){lResult.push(TypeCommandeSujet.modifier);}
if(GApplication.droits.get(TypeDroits.forum.avecCreationSujetForum)){lResult.push(TypeCommandeSujet.dupliquer);}
if(lEstModerateur){lResult.push(TypeCommandeSujet.modifierExclus);}
if(lEstModerateur&&[TypeEtatPub.EP_Ouvert,TypeEtatPub.EP_Suspendu].includes(aSujet.etatPub)){lResult.push(TypeCommandeSujet.verrouiller);}
if(lEstModerateur&&[TypeEtatPub.EP_Verrou,TypeEtatPub.EP_Suspendu].includes(aSujet.etatPub)){lResult.push(TypeCommandeSujet.deverrouiller);}
if(aSujet.roles.contains(TypeRoleIndividuSujet.RIS_Auteur)){lResult.push(TypeCommandeSujet.nettoyer);lResult.push(TypeCommandeSujet.supprimer);}
return lResult;}
addCommandesMenuContextuel_sujet(aParametresListe){const lSujet=aParametresListe.article;const lCommandes=this.getCommandesMenuContextuel_sujet(lSujet);if(lCommandes.includes(TypeCommandeSujet.modifier)){aParametresListe.menuContextuel.add(GTraductions.getValeur('ForumPeda.Menu_Modifier'),!GApplication.droits.get(TypeDroits.estEnConsultation),() =>{return this.editerSujet(lSujet);},{icon:'icon_pencil'});}
if(lCommandes.includes(TypeCommandeSujet.dupliquer)){aParametresListe.menuContextuel.add(GTraductions.getValeur('ForumPeda.Menu_Dupliquer'),!GApplication.droits.get(TypeDroits.estEnConsultation),() =>{new ObjetRequeteSaisieForumPedagogique(this.options.pere).lancerRequete({type:TypeForumPedaCommandeSaisie.fpcs_DupliquerSujet,sujet:lSujet}).then((aParamsRequete) =>{let lSujetASelectioner=aParamsRequete.JSONRapportSaisie?aParamsRequete.JSONRapportSaisie.sujet:null;_callbackActualisationSujets(this,{sujetSelection:lSujetASelectioner});});},{icon:'icon_dupliquer'});}
if(lCommandes.includes(TypeCommandeSujet.modifierExclus)){aParametresListe.menuContextuel.add(GTraductions.getValeur('ForumPeda.Menu_ModifierBannis'),!GApplication.droits.get(TypeDroits.estEnConsultation),() =>{_modifierExclusSujet.call(this,lSujet);},{icon:'icon_user mix-icon_ne_pas_deranger i-red'});}
if(lCommandes.includes(TypeCommandeSujet.verrouiller)){aParametresListe.menuContextuel.add(GTraductions.getValeur('ForumPeda.Menu_Verrouiller'),!GApplication.droits.get(TypeDroits.estEnConsultation),() =>{new ObjetRequeteSaisieForumPedagogique(this.options.pere).lancerRequete({type:TypeForumPedaCommandeSaisie.fpcs_ModifierEtatSujet,sujet:lSujet,verrouiller:true}).then(() =>{_callbackActualisationSujets(this);});},{icon:'icon_lock'});}
if(lCommandes.includes(TypeCommandeSujet.deverrouiller)){aParametresListe.menuContextuel.add(GTraductions.getValeur('ForumPeda.Menu_Deverrouiller'),!GApplication.droits.get(TypeDroits.estEnConsultation),() =>{if(lSujet.etatPub===TypeEtatPub.EP_Suspendu){_confirmDeverrouillerSuspensionSujet.call(this,lSujet).then((aResult) =>{if(aResult!==false){_callbackActualisationSujets(this);}});} else{new ObjetRequeteSaisieForumPedagogique(this.options.pere).lancerRequete({type:TypeForumPedaCommandeSaisie.fpcs_ModifierEtatSujet,sujet:lSujet,verrouiller:false}).then(() =>{_callbackActualisationSujets(this);});}},{icon:'icon_unlock_alt'});}
if(lCommandes.includes(TypeCommandeSujet.nettoyer)){aParametresListe.menuContextuel.add(GTraductions.getValeur('ForumPeda.Menu_Nettoyer'),!GApplication.droits.get(TypeDroits.estEnConsultation),() =>{GApplication.getMessage().afficher({type:EGenreBoiteMessage.Confirmation,message:GTraductions.getValeur('ForumPeda.ConfirmationNettoyer')}).then((aGenreAction) =>{if(aGenreAction===EGenreAction.Valider){new ObjetRequeteSaisieForumPedagogique(this.options.pere).lancerRequete({type:TypeForumPedaCommandeSaisie.fpcs_NettoyerSujet,sujet:lSujet}).then(() =>{_callbackActualisationSujets(this,{sujetSelection:lSujet});});}});},{icon:'icon_purger_messages'});}
if(lCommandes.includes(TypeCommandeSujet.supprimer)){aParametresListe.menuContextuel.add(GTraductions.getValeur('ForumPeda.Menu_SupprimerSelection'),!GApplication.droits.get(TypeDroits.estEnConsultation),() =>{GApplication.getMessage().afficher({type:EGenreBoiteMessage.Confirmation,message:GTraductions.getValeur('ForumPeda.ConfirmationSuppression')}).then((aGenreAction) =>{if(aGenreAction===EGenreAction.Valider){new ObjetRequeteSaisieForumPedagogique(this.options.pere).lancerRequete({type:TypeForumPedaCommandeSaisie.fpcs_SupprimerSujet,sujet:lSujet}).then(() =>{_callbackActualisationSujets(this);});}});},{icon:'icon_trash'});}}
saisieCommandePost(aParams,aSujetSelection){const lParams=Object.assign({type:null},aParams)
;return Promise.resolve().then(() =>{let lMessageConfirmation='';let lControleur=null;if(lParams.type===TypeForumPedaCommandeSaisie.fpcs_Post_Action){switch(lParams.action){case TypeActionPost.AP_SignalerModeration:{lMessageConfirmation=GTraductions.getValeur('ForumPeda.ConfirmationSignalementModeration');break;}
case TypeActionPost.AP_SignalerSPR:{lMessageConfirmation=GTraductions.getValeur('ForumPeda.ConfirmationSignalementSPR');break;}
case TypeActionPost.AP_SupprimerDefinitivement:{lMessageConfirmation=GTraductions.getValeur('ForumPeda.ConfirmationSuppressionPost');break;}
case TypeActionPost.AP_ExclureAuteur:{lParams.typeBlocage=TypeGenreActionSurPostForum.APF_Aucune;lControleur={rb:{getValue(aType){return lParams.typeBlocage===aType;},setValue(aType){lParams.typeBlocage=aType;}}};lMessageConfirmation=[
GTraductions.getValeur('ForumPeda.ConfirmationExclureEleve1',[lParams.post.strAuteur]),tag('br'),GTraductions.getValeur('ForumPeda.ConfirmationExclureEleve2'),tag('br'),tag('div',{class:'p-top p-left large'},tag('ie-radio',{'ie-model':tag.funcAttr('rb',TypeGenreActionSurPostForum.APF_Aucune)},GTraductions.getValeur('ForumPeda.ConfirmationAucunPost')),tag('br'),tag('ie-radio',{'ie-model':tag.funcAttr('rb',TypeGenreActionSurPostForum.APF_RefuserLePost)},GTraductions.getValeur('ForumPeda.ConfirmationCePost')),tag('br'),tag('ie-radio',{'ie-model':tag.funcAttr('rb',TypeGenreActionSurPostForum.APF_RefuserTousLesPosts)},GTraductions.getValeur('ForumPeda.ConfirmationTousLesPosts')))
].join('');}}}
if(lMessageConfirmation){return GApplication.getMessage().afficher({type:EGenreBoiteMessage.Confirmation,message:lMessageConfirmation,controleur:lControleur}).then((aGenreAction) =>{if(aGenreAction===EGenreAction.Valider){return true;}});}
return true;}).then((aResult) =>{if(aResult===true){return new ObjetRequeteSaisieForumPedagogique(this.options.pere).lancerRequete(lParams).then((aParamsRequete) =>{if(aParamsRequete.JSONRapportSaisie&&aParamsRequete.JSONRapportSaisie.confirmDebloquerSuspension&&aParamsRequete.JSONRapportSaisie.sujet){return _confirmDeverrouillerSuspensionSujet.call(this,aParamsRequete.JSONRapportSaisie.sujet);}}).then(() =>{return _callbackActualisationSujets(this,{sujetSelection:aSujetSelection,typeSaisiePost:lParams.type});});}});}
getStrNbParticipantsSujet(aSujet){return aSujet.nbMembres>1?GTraductions.getValeur('ForumPeda.Participants_D',[aSujet.nbMembres]):GTraductions.getValeur('ForumPeda.Participant_D',[aSujet.nbMembres]);}
getStrMessageParticipationFermee(aSujet){if(aSujet.etatPub===TypeEtatPub.EP_Ferme&&aSujet.heureAvant&&aSujet.heureApres){return GTraductions.getValeur('ForumPeda.ParticipationPossibleDeA_SS',[GDate.FormatDate(aSujet.heureApres,'%hh%sh%mm'),GDate.FormatDate(aSujet.heureAvant,'%hh%sh%mm')]);}
return'';}}
function _getSujetParDefaut(){const lUtilisateur=GEtatUtilisateur.getUtilisateur();return new ObjetElement({titre:'',matiere:null,listeThemes:new ObjetListeElements(),htmlPost:'',listeFichiers:new ObjetListeElements(),listeMembres:new ObjetListeElements(),listeModerateurs:new ObjetListeElements().add(new ObjetElement({Numero:lUtilisateur.GetNumero(),Genre:lUtilisateur.GetGenre(),nonModifiable:true})),genreModeration:TypeGenreModerationForum.GMF_APriori,visiteurs:new TypeEnsemblenombre([TypeGenreVisiteurForum.GVF_SPR]),avecHoraires:false,heureApres:new Date(0,0,0,6,0,0,0),heureAvant:new Date(0,0,0,22,0,0,0)});}
function _confirmDeverrouillerSuspensionSujet(aSujet){return GApplication.getMessage().afficher({type:EGenreBoiteMessage.Confirmation,message:GTraductions.getValeur('ForumPeda.ConfirmationEnleverSuspensionSujet')}).then((aGenreAction) =>{if(aGenreAction===EGenreAction.Valider){return new ObjetRequeteSaisieForumPedagogique(this.options.pere).lancerRequete({type:TypeForumPedaCommandeSaisie.fpcs_ModifierEtatSujet,sujet:aSujet,verrouiller:false});}
return false;});}
function _modifierExclusSujet(aSujet){return new ObjetRequeteForumPedagogique(this.options.pere).lancerRequete({type:TypeForumPedaCommandeRequete.fpcr_ExclusSujet,sujet:aSujet}).then((aJSON) =>{const lListeRessources=aJSON.listeMembres;const lListeSelec=aJSON.listeExclus;const lGenreRessource=EGenreRessource.Eleve;const lFenetre=ObjetFenetre.creerInstance(ObjetFenetre_SelectionPublic,{pere:this.options.pere,evenement:(aGenre,aListe,aNumeroBouton) =>{if(aNumeroBouton===1){return new ObjetRequeteSaisieForumPedagogique(this.options.pere).lancerRequete({type:TypeForumPedaCommandeSaisie.fpcs_ModifierExclusSujet,sujet:aSujet,listeExclus:lListeSelec.setSerialisateurJSON({ignorerEtatsElements:true})}).then(() =>{return this.options.callbackActualisationSujets();});}}});lFenetre.setOptionsFenetre({masquerListeSiVide:false});lFenetre.setOptions_Fenetre_SelectionRessource({avecCocheRessources:true});lFenetre.setOptions({estDeploye:true});const lGenreCumul=getCumulPourFenetrePublic(lGenreRessource,false ,lListeRessources.GetNbrElements());if(lGenreCumul){lFenetre.setGenreCumulActif(lGenreCumul);}
lFenetre.setSelectionObligatoire(false);lFenetre.setDonnees({listeRessources:lListeRessources,listeRessourcesSelectionnees:lListeSelec,genreRessource:lGenreRessource,avecIndicationDiscussionInterdit:false,titre:EGenreRessource.getTitreFenetreSelectionRessource(lGenreRessource)});});}
function _callbackActualisationSujets(aInstance,aParams){if(aInstance.options.callbackActualisationSujets){aInstance._callbackActualisationSujets_enCours=true;return aInstance.options.callbackActualisationSujets(aParams).finally(() =>{aInstance._callbackActualisationSujets_enCours=false;});}
return Promise.reject();}
class ObjetRequeteForumPedagogique extends ObjetRequeteConsultation{}
Requetes.inscrire('ForumPedagogique',ObjetRequeteForumPedagogique);class ObjetRequeteSaisieForumPedagogique extends ObjetRequeteSaisie{lancerRequete(aParametres){Object.assign(this.JSON,aParametres);switch(this.JSON.type){case TypeForumPedaCommandeSaisie.fpcs_CreerModifierSujet:{this.JSON.sujet=this.JSON.sujet.toJSONAll();const lSujetJSON=this.JSON.sujet;lSujetJSON.htmlPost=new TypeChaineHtml(lSujetJSON.htmlPost);['listeThemes','listeMembres','listeModerateurs'].forEach((aProp) =>{if(lSujetJSON[aProp]){lSujetJSON[aProp].setSerialisateurJSON({ignorerEtatsElements:true});}});if(lSujetJSON.listeFichiers){lSujetJSON.listeFichiers=lSujetJSON.listeFichiers.setSerialisateurJSON({methodeSerialisation:(aElement,aJSON) =>{const lIdFichier=aElement.idFichier!==undefined?aElement.idFichier:(aElement.Fichier!==undefined?aElement.Fichier.idFichier:null);if(lIdFichier!==null){aJSON.idFichier=''+lIdFichier;}
aJSON.nomFichier=aElement.nomFichier;aJSON.url=aElement.url;}});}
break;}}
return this.appelAsynchrone();}}
Requetes.inscrire('SaisieForumPedagogique',ObjetRequeteSaisieForumPedagogique);module.exports=MoteurForumPedagogique;},fn:"moteurforumpedagogique.js"});;
IE.fModule({f:function(exports,require,module,global){const ObjetFenetre=require('ObjetFenetre.js');const GTraductions=require('ObjetTraduction.js');const ObjetElement=require('ObjetElement.js');const ObjetForumVisuPosts=require('ObjetForumVisuPosts.js');const MoteurForumPedagogique=require('MoteurForumPedagogique.js');const EGenreOnglet=require('Enumere_Onglet.js');class ObjetFenetre_ForumVisuPosts extends ObjetFenetre{constructor(...aParams){super(...aParams);this.setOptionsFenetre({titre:GTraductions.getValeur('Onglet.Libelle')[EGenreOnglet.ForumPedagogique],modale:false,largeur:600,hauteur:Math.max(400,Math.round(GNavigateur.EcranH*80/100)),heightMax_mobile:true,listeBoutons:[GTraductions.getValeur('Fermer')]});this.sujetCourant=null;this.moteurForum=new MoteurForumPedagogique({pere:this,callbackActualisationSujets:() =>{return _actualiser.call(this);},ouvrirEditionSujet_promise:null});}
ConstruireInstances(){this.identAff=this.Add(ObjetForumVisuPosts,null,(aVisuPost) =>{aVisuPost.setOptions({visuModerateurPossible:false});aVisuPost.init(this.moteurForum);});}
setDonnees(aNumeroSujet){this.Afficher();this.sujetCourant=new ObjetElement({Numero:aNumeroSujet});_actualiser.call(this);}
ComposeContenu(){const T=[];T.push('<div style="height: 100%;" id="'+this.GetNomInstance(this.identAff)+'"></div>');return T.join('');}
static afficher(aPere,aNumeroSujet){ObjetFenetre.creerInstance(ObjetFenetre_ForumVisuPosts,{pere:aPere}).setDonnees(aNumeroSujet);}}
function _actualiser(){return this.GetInstance(this.identAff).setSujet(new ObjetElement(this.sujetCourant));}
module.exports=ObjetFenetre_ForumVisuPosts;},fn:"objetfenetre_forumvisuposts.js"});;
IE.fModule({f:function(exports,require,module,global){const EGenreEtat=require('Enumere_Etat.js');const{GDate}=require('ObjetDate.js');const ObjetIdentite_Mobile=require('ObjetIdentite_Mobile.js');const GTraductions=require('ObjetTraduction.js');const ObjetTri=require('ObjetTri.js');const EGenreOnglet=require('Enumere_Onglet.js');const ObjetRequeteSaisieTAFFaitEleve=require('ObjetRequeteSaisieTAFFaitEleve.js');const ObjetUtilitaireCahierDeTexte=require('ObjetUtilitaireCahierDeTexte.js');const EGenreDirectionSlide=require('EGenreDirectionSlide.js');const UtilitaireTAFEleves=require('UtilitaireTAFEleves.js');const UtilitaireContenuDeCours=require('UtilitaireContenuDeCours.js');const EGenreBtnActionBlocTAF=require('GestionnaireBlocTAF.js').EGenreBtnActionBlocTAF;const{EGenreRessourcePedagogique}=require('Enumere_RessourcePedagogique.js');const ObjetListeElements=require('ObjetListeElements.js');const EGenreTypeRessourcesPedagogique=require('Enumere_TypeRessourcesPedagogiques.js');const ObjetFenetre_ForumVisuPosts=require('ObjetFenetre_ForumVisuPosts.js');class ObjetCahierDeTexte_Mobile extends ObjetIdentite_Mobile{constructor(...aParams){super(...aParams);this.cycleCourant=null;this.utilitaireCDT=new ObjetUtilitaireCahierDeTexte(this.Nom+'.utilitaireCDT',this,this.surUtilitaireCDT);this.utilitaireTAFEleves=new UtilitaireTAFEleves();this.utilitaireContenuDeCours=new UtilitaireContenuDeCours();this.idTaf=this.Nom+'_Taf_';}
getControleur(aInstance){return $.extend(true,super.getControleur(this),{appelQCM:{event:function(aNumero){aInstance.appelQCM(aNumero);}},appelQCMRessource:{event:function(aNumero){aInstance.appelQCMRessource(aNumero);}},appelForumRessource:{event(aNumero){ObjetFenetre_ForumVisuPosts.afficher(aInstance,aNumero);}},evenementTafFait:{getValue:function(aNumeroTaf){const lElement=aInstance.ListeTravailAFaire.GetElementParNumero(aNumeroTaf);return lElement.TAFFait;},setValue:function(aNumero){aInstance.evenementTafFait(aNumero);}},appelCours:{event:function(aNumero){aInstance.appelCours(aNumero);}},appelTAF:{event:function(aNumero){aInstance.appelTAF(aNumero);}}});}
SetDonnees(aGenreOnglet,aListe,aCycleCourant,aAvecFiltrage,aFiltreMatiere,aListeTAFComplet,aEstListeRessource){this.genreOnglet=aGenreOnglet;this.ListeTAFComplet=aListeTAFComplet;const lSensSwipe=!this.cycleCourant||aCycleCourant===this.cycleCourant?EGenreDirectionSlide.Aucune:(aCycleCourant<this.cycleCourant?EGenreDirectionSlide.Droite:EGenreDirectionSlide.Gauche);this.cycleCourant=aCycleCourant;this.avecFiltrage=aAvecFiltrage;this.filtreMatiere=aFiltreMatiere;this.estListeRessource=aEstListeRessource;if(this.genreOnglet===EGenreOnglet.CDT_TAF){this.ListeTravailAFaire=aListe;this.actualiser_TravailAFaire(this.ListeTravailAFaire);} else{this.ListeCahierDeTextes=aListe;if(!this.estListeRessource){this.actualiser_Contenu(this.ListeCahierDeTextes);}}
this.Afficher(null,lSensSwipe);return this.avecDonnees;}
actualiser_Contenu(){if(this.ListeCahierDeTextes){if(!this.estListeRessource){this.ListeCahierDeTextes.setTri([ObjetTri.init('Date')]).trier();} else{this.ListeCahierDeTextes.setTri([ObjetTri.init('matiere.Libelle')]).trier();}}}
actualiser_TravailAFaire(aListeTravailAFaire){if(aListeTravailAFaire){aListeTravailAFaire.setTri([
ObjetTri.init('PourLe'),ObjetTri.init('Matiere.Libelle'),ObjetTri.init('DonneLe'),ObjetTri.init('Genre')
]).trier();}}
ConstruireAffichage(){return this.genreOnglet===EGenreOnglet.CDT_TAF?this.composePage_TravailAFaire(this.ListeTravailAFaire):(this.estListeRessource?this.composePage_Ressource(this.ListeCahierDeTextes):this.composePage_Contenu(this.ListeCahierDeTextes));}
composePage_Contenu(aListeCahierDeTextes){if(!aListeCahierDeTextes){return'';}
const lHtml=[];lHtml.push('<div class="conteneur-liste-CDT">');if(!!aListeCahierDeTextes.GetNbrElements()&&!!aListeCahierDeTextes.getListeElements(function(aEle){return(aEle.listeContenus&&aEle.listeContenus.GetNbrElements()>0)||(aEle.listeElementsProgrammeCDT&&(aEle.listeElementsProgrammeCDT.GetNbrElements()>0));}).GetNbrElements()){lHtml.push(this.utilitaireContenuDeCours.composePage_Contenu(aListeCahierDeTextes,this.avecFiltrage));} else{lHtml.push(this.composeAucuneDonnee(GTraductions.getValeur('CahierDeTexte.AucunContenu')));}
lHtml.push('</div>');return lHtml.join('');}
composePage_Ressource(aListeCahierDeTextes){if(!aListeCahierDeTextes){return'';}
const lHtml=[];lHtml.push('<div class="conteneur-liste-CDT">');if(!!aListeCahierDeTextes.GetNbrElements()){lHtml.push('<div class="conteneur-ressource-mobile">');const lRessourcesPedagogiquesParMatiere=_regrouperRessourcesPedagogiquesParMatiere.call(this,aListeCahierDeTextes);for(const lMatiere in lRessourcesPedagogiquesParMatiere){if(!this.avecFiltrage){let lCouleur;for(let i=0;i<aListeCahierDeTextes.GetNbrElements();i++){const lElement=aListeCahierDeTextes.GetElement(i);if(lElement.matiere.GetLibelle()===lMatiere){lCouleur=lElement.matiere.CouleurFond;break;}}
lHtml.push('<div class="conteneur-ressource-journee">');lHtml.push('<div class="entete-element">');lHtml.push('<div class="flex-contain">','<div style="background-color:',lCouleur,';margin-right:0.8rem;padding:0.2rem;border-radius:0.4rem;"></div>');lHtml.push('<div>');lHtml.push('<div class="titre-matiere">',lMatiere,'</div>');lHtml.push('</div>');lHtml.push('</div>');lHtml.push('</div>');}
const lRessourcesPedagogiquesParType=_regrouperRessourcesPedagogiquesParType.call(this,lRessourcesPedagogiquesParMatiere[lMatiere],this.filtreMatiere);for(const lTypeRessource in EGenreTypeRessourcesPedagogique){const lType=EGenreTypeRessourcesPedagogique[lTypeRessource];lHtml.push(this.composeRessourcesPeda(lRessourcesPedagogiquesParType[lType],lType));}
lHtml.push('</div>');}
lHtml.push('</div>');} else{lHtml.push(this.composeAucuneDonnee(GTraductions.getValeur('CahierDeTexte.AucuneRessource')));}
lHtml.push('</div>');return lHtml.join('');}
composePage_TravailAFaire(aListeTravailAFaire){if(!aListeTravailAFaire){return'';}
const lHtml=[];lHtml.push('<div class="conteneur-liste-CDT">');GEtatUtilisateur.setNavigationDate(GDate.getDateCourante());if(!!aListeTravailAFaire.GetNbrElements()){lHtml.push(this.utilitaireTAFEleves.composePage_TravailAFaire(aListeTravailAFaire,this.utilitaireCDT,this.controleur,this.avecFiltrage));} else{lHtml.push(this.composeAucuneDonnee(GTraductions.getValeur('CahierDeTexte.AucunTAFSelonCriteres')));}
lHtml.push('</div>');return lHtml.join('');}
composeRessourcesPeda(aListeRessPeda,aType){const lHtml=[];switch(aType){case EGenreTypeRessourcesPedagogique.SujetOuCorrige:lHtml.push(this.utilitaireContenuDeCours.composeRPSujetOuCorrige(aListeRessPeda,true));break;case EGenreTypeRessourcesPedagogique.TravailRendu:lHtml.push(this.utilitaireContenuDeCours.composeRPTravailRendu(aListeRessPeda,true,this.controleur));break;case EGenreTypeRessourcesPedagogique.QCM:lHtml.push(this.utilitaireContenuDeCours.composeRPQCM(aListeRessPeda,true));break;case EGenreTypeRessourcesPedagogique.RessourcesGranulaires:lHtml.push(this.utilitaireContenuDeCours.composeRPRessourcesGranulaires(aListeRessPeda,true));break;case EGenreTypeRessourcesPedagogique.ForumPedagogique:lHtml.push(this.utilitaireContenuDeCours.composeRPForumPedagogique(aListeRessPeda,true));break;case EGenreTypeRessourcesPedagogique.Autre:lHtml.push(this.utilitaireContenuDeCours.composeRPAutre(aListeRessPeda,true));break;default:;break;}
return lHtml.join('');}
composeCours(aDonnees){return this.utilitaireContenuDeCours.composeFicheCours(aDonnees);}
composeTAF(aDonnees,aControleur){return this.utilitaireTAFEleves.composeFicheTAF(aDonnees.ListeTravailAFaire,this.utilitaireCDT,aControleur);}
appelQCM(aNumeroQCM){this.callback.appel({GenreBtnAction:EGenreBtnActionBlocTAF.executionQCM,executionQCM:aNumeroQCM});}
appelQCMRessource(aNumeroQCM){this.callback.appel({executionQCM:aNumeroQCM,estRessource:true});}
appelCours(aNumero){const lTAF=this.ListeTravailAFaire.GetElementParNumero(aNumero);this.callback.appel({GenreBtnAction:EGenreBtnActionBlocTAF.voirContenu,taf:lTAF});}
appelTAF(aNumero){const lCours=this.ListeCahierDeTextes.GetElementParNumero(aNumero);this.callback.appel({cours:lCours});}
surUtilitaireCDT(){this.callback.appel();}
surEvenementTafFait(aTaf){this.callback.appel({date:aTaf.PourLe});}
evenementTafFait(aNumeroTaf){const lElement=this.ListeTravailAFaire.GetElementParNumero(aNumeroTaf);if(!!lElement.TAFFait){lElement.TAFFait=false;} else{lElement.TAFFait=true;}
lElement.SetEtat(EGenreEtat.Modification);new ObjetRequeteSaisieTAFFaitEleve(this).lancerRequete({listeTAF:this.ListeTravailAFaire}).then(this.surEvenementTafFait(lElement));}}
function _regrouperRessourcesPedagogiquesParType(aListeRessources,aMatiereFiltrante){const lRessourcesPedagogiquesParType={};if(!!aListeRessources){aListeRessources.parcourir(function(D){if(!D.matiere||!aMatiereFiltrante||D.matiere.GetNumero()===aMatiereFiltrante.GetNumero()){let lTypeListe;if(D.GetGenre()===EGenreRessourcePedagogique.sujet||D.GetGenre()===EGenreRessourcePedagogique.corrige){lTypeListe=EGenreTypeRessourcesPedagogique.SujetOuCorrige;} else if(D.GetGenre()===EGenreRessourcePedagogique.travailRendu){lTypeListe=EGenreTypeRessourcesPedagogique.TravailRendu;} else if(D.GetGenre()===EGenreRessourcePedagogique.QCM){lTypeListe=EGenreTypeRessourcesPedagogique.QCM;} else if(D.estForumPeda){lTypeListe=EGenreTypeRessourcesPedagogique.ForumPedagogique;} else if(D.GetGenre()===EGenreRessourcePedagogique.kiosque){lTypeListe=EGenreTypeRessourcesPedagogique.RessourcesGranulaires;} else{lTypeListe=EGenreTypeRessourcesPedagogique.Autre;}
if(!lRessourcesPedagogiquesParType[lTypeListe]){lRessourcesPedagogiquesParType[lTypeListe]=new ObjetListeElements();}
lRessourcesPedagogiquesParType[lTypeListe].AddElement(D);}});}
return lRessourcesPedagogiquesParType;}
function _regrouperRessourcesPedagogiquesParMatiere(aListeRessources){const lRessourcesPedagogiquesParMatiere={};if(!!aListeRessources){aListeRessources.parcourir(function(D){let lMatiereListe;if(D.matiere){lMatiereListe=D.matiere.GetLibelle();} else{lMatiereListe=undefined;}
if(!lRessourcesPedagogiquesParMatiere[lMatiereListe]){lRessourcesPedagogiquesParMatiere[lMatiereListe]=new ObjetListeElements();}
lRessourcesPedagogiquesParMatiere[lMatiereListe].AddElement(D);});}
return lRessourcesPedagogiquesParMatiere;}
module.exports=ObjetCahierDeTexte_Mobile;},fn:"pagecahierdetexte_mobile.js"});;
IE.fModule({f:function(exports,require,module,global){const{ObjetRequeteConsultation}=require('ObjetRequeteJSON.js');const Requetes=require('CollectionRequetes.js');const ObjetTri=require('ObjetTri.js');const EGenreTriElement=require('Enumere_TriElement.js');const ObjetDeserialiser=require('ObjetDeserialiser.js');const ObjetListeElements=require('ObjetListeElements.js');class ObjetRequetePageCahierDeTexte extends ObjetRequeteConsultation{constructor(...aParams){super(...aParams);}
lancerRequete(aParametres){this.JSON={date:aParametres.date,domaine:aParametres.domaine,eleve:aParametres.eleve,ressource:aParametres.ressource,estRequeteRP:aParametres.estRequeteRP,sansRequeteRP:aParametres.sansRequeteRP};return this.appelAsynchrone();}
actionApresRequete(){const lObjetDeserialiser=new ObjetDeserialiser();const lListeTravauxAFaire=this.JSONReponse.ListeTravauxAFaire||new ObjetListeElements();lListeTravauxAFaire.parcourir(function(aTaf){lObjetDeserialiser.deserialiserTAF(aTaf);});lListeTravauxAFaire.setTri([ObjetTri.init('DonneLe'),ObjetTri.init('Genre')]);lListeTravauxAFaire.trier();const lListeCahiersDeTextes=this.JSONReponse.ListeCahierDeTextes||new ObjetListeElements();lListeCahiersDeTextes.parcourir(function(aCahierDeTexte){lObjetDeserialiser.deserialiserCahierDeTexte(aCahierDeTexte);});let lListeRessourcesPedagogiques;if(!!this.JSONReponse.ListeRessourcesPedagogiques&&!!this.JSONReponse.ListeRessourcesPedagogiques.listeRessources&&this.JSONReponse.ListeRessourcesPedagogiques.listeRessources.GetNbrElements()>0){lListeRessourcesPedagogiques=this.JSONReponse.ListeRessourcesPedagogiques.listeRessources;lListeRessourcesPedagogiques.setTri([ObjetTri.init('date',EGenreTriElement.Decroissant),ObjetTri.init('Libelle')]);lListeRessourcesPedagogiques.trier();const lListeMatieresRessourcesPeda=this.JSONReponse.ListeRessourcesPedagogiques.listeMatieres;if(!!lListeMatieresRessourcesPeda){lListeMatieresRessourcesPeda.parcourir(function(aMatiere){aMatiere.CouleurFond=aMatiere.couleur;});let lMatiereAvecDonneesCompletes=null;lListeRessourcesPedagogiques.parcourir(function(aRessource){if(!!aRessource.matiere&&!!aRessource.matiere.GetNumero()){lMatiereAvecDonneesCompletes=lListeMatieresRessourcesPeda.GetElementParNumero(aRessource.matiere.GetNumero());if(!!lMatiereAvecDonneesCompletes){aRessource.matiere=lMatiereAvecDonneesCompletes;}}});}}
let lListeRessourcesNumeriques;if(!!this.JSONReponse.ListeRessourcesNumeriques&&!!this.JSONReponse.ListeRessourcesNumeriques.listeRessources&&this.JSONReponse.ListeRessourcesNumeriques.listeRessources.GetNbrElements()>0){lListeRessourcesNumeriques=this.JSONReponse.ListeRessourcesNumeriques.listeRessources;lListeRessourcesNumeriques.setTri([ObjetTri.init('titre')]);lListeRessourcesNumeriques.trier();}
this.callbackReussite.appel({listeTAF:lListeTravauxAFaire,listeCDT:lListeCahiersDeTextes,listeDS:this.JSONReponse.listeDS,listeMatieres:this.JSONReponse.listeMatieres,listeRessourcesNumeriques:lListeRessourcesNumeriques,listeRessourcesPedagogiques:lListeRessourcesPedagogiques});}}
Requetes.inscrire('PageCahierDeTexte',ObjetRequetePageCahierDeTexte);module.exports=ObjetRequetePageCahierDeTexte;},fn:"objetrequetepagecahierdetexte.js"});;
IE.fModule({f:function(exports,require,module,global){const GHtml=require('GHtml.js');const EGenreDirection=require('Enumere_Direction.js');const EGenreOrientationAffichage=require('enumere_orientationaffichage.js');const Identite=require('ObjetIdentite.js');const ObjetListeElements=require('ObjetListeElements.js');const{GObjetWAI,EGenreRole}=require('ObjetWAI.js');const ToucheClavier=require('ToucheClavier.js');require('produit/css/ObjetTabOnglet.css');class ObjetTabOnglets extends Identite{constructor(...aParams){super(...aParams);this.listeOnglets=new ObjetListeElements();this.idOnglets=this.Nom+'_Onglets';this.IdPremierElement=this.idOnglets;this.ongletSelectionne=0;this.setOptions({afficherOngletUnique:!IE.estMobile,avecSwipe:true});}
getControleur(aInstance){return $.extend(true,super.getControleur(this),{getNode(){$(this.node).on('keyup',function(aEvent){if(ToucheClavier.estToucheFleche(aEvent.which)){_setFocusSurOnglet.call(aInstance,aEvent);}});},getNodeOnglet(aIndice){$(this.node).eventValidation(() =>{aInstance.selectOnglet(aIndice);});}});}
setOptions(aOptions){$.extend(this.options,aOptions);}
SetParametres(aListeOnglets){this.setListeOnglets(aListeOnglets);}
ConstruireAffichage(aIdWAI){let lNbrOngletsVisibles=0;if(this.listeOnglets&&this.listeOnglets.parcourir){this.listeOnglets.parcourir((aElement) =>{if(_estOngletVisible(aElement)){lNbrOngletsVisibles+=1;}});}
if((this.options.afficherOngletUnique&&lNbrOngletsVisibles>0)||(!this.options.afficherOngletUnique&&lNbrOngletsVisibles>1)){return this.composePage(aIdWAI);} else{return'';}}
setListeOnglets(aListeOnglets){this.listeOnglets=aListeOnglets;}
SetDonnees(aListeOnglets,aIndiceOnglet,aAvecCallbackSelection=false){this.setListeOnglets(aListeOnglets);this.Afficher();if(aIndiceOnglet>=0){this.selectOnglet(aIndiceOnglet,!aAvecCallbackSelection);}
if(this.options.avecSwipe&&IE.estMobile&&this.Pere){const lJPage=$(`#${this.Pere.Nom.escapeJQ()}.objetInterfaceMobile_identPage`);if(lJPage.length===1){const lInstance=this;lJPage.off('swipeleft.tabonglet swiperight.tabonglet').on({'swiperight.tabonglet':function(){_selectOngletSuivant.call(lInstance,lInstance.ongletSelectionne,true);},'swipeleft.tabonglet':function(){_selectOngletSuivant.call(lInstance,lInstance.ongletSelectionne,false);}});$(`#${this.Nom.escapeJQ()}`).on('destroyed',function(){lJPage.off('swipeleft.tabonglet swiperight.tabonglet');});}}}
composePage(aIdWAI){const lHtml=[];lHtml.push('<div class="menu-tabs" id="',this.idOnglets,'" tabIndex="0" ie-node="getNode" ',GObjetWAI.composeRole(EGenreRole.Tablist),'>',_composeOnglets.call(this,aIdWAI),'</div>');return lHtml.join('');}
setLibelleOngletDIndice(aIndice,aLibelle){const lID=this.getIdOnglet(aIndice);const lElmOnglet=this.listeOnglets.GetElement(aIndice);lElmOnglet.SetLibelle(aLibelle);GHtml.setHtml('nav_'+lID,aLibelle);}
NavigationClavier(aId,aEvent){if(ToucheClavier.estToucheFleche(aEvent)){this.FocusSuivant(aId,(aEvent.which===ToucheClavier.FlecheGauche||aEvent.which===ToucheClavier.FlecheDroite)?EGenreOrientationAffichage.Horizontal:EGenreOrientationAffichage.Vertical,(aEvent.which===ToucheClavier.FlecheGauche||aEvent.which===ToucheClavier.Flechehaut)?EGenreDirection.SensInverse:EGenreDirection.SensNormal);const lId=this.getIdNavigationSuivant(aId,(aEvent.which===ToucheClavier.FlecheGauche||aEvent.which===ToucheClavier.FlecheDroite)?EGenreOrientationAffichage.Horizontal:EGenreOrientationAffichage.Vertical,(aEvent.which===ToucheClavier.FlecheGauche||aEvent.which===ToucheClavier.Flechehaut)?EGenreDirection.SensInverse:EGenreDirection.SensNormal);if(lId){this.selectOnglet(_getNumeroId(lId));} else{GHtml.setFocus(aId);}}}
ActiverBordureNavigation(){}
getIdOnglet(i){return this.Nom+'_Tab_'+i;}
getIdPanel(i){return this.Nom+'_Panel_'+i;}
selectOnglet(i,aSansCallback=false){const lIdCourant=this.getIdOnglet(this.ongletSelectionne);const lIdNouveau=this.getIdOnglet(i);const lElement=this.listeOnglets.GetElement(i);GHtml.delClass('tab_'+lIdCourant,'selected');GHtml.delClass('nav_'+lIdCourant,'sel');this.ongletSelectionne=i;GHtml.addClass('tab_'+lIdNouveau,'selected');GHtml.addClass('nav_'+lIdNouveau,'sel');if(this.listeOnglets&&this.listeOnglets.parcourir){this.listeOnglets.parcourir((aOnglet) =>{if(aOnglet.idDiv){const lJOnglet=$(`#${aOnglet.idDiv.escapeJQ()}`);if(aOnglet===lElement&&_estOngletVisible(aOnglet)){lJOnglet.show();} else{lJOnglet.hide();}}});}
if(!aSansCallback){this.callback.appel(lElement);this.$refresh();}}
getIndiceOngletSelectionne(){return this.ongletSelectionne;}
getOngletSelectionne(){return this.listeOnglets.GetElement(this.ongletSelectionne);}
estOngletDIndiceVisible(aIndice){const lOnglet=this.listeOnglets.GetElement(aIndice);return _estOngletVisible(lOnglet);}}
function _composeOnglets(aIdWAI){const lHtml=[];let i=0;let idPrecedent='';let idCourant='';for(i=0;i<this.listeOnglets.GetNbrElements();i++){const lElmOnglet=this.listeOnglets.GetElement(i);if(_estOngletVisible(lElmOnglet)){const lLibelle=lElmOnglet.Libelle;idCourant=this.getIdOnglet(i);lHtml.push('<div id="div_',idCourant,'" class="tab-item">','<div id="tab_',idCourant,'" tabIndex="0" ie-node="getNodeOnglet(',i,')" class="tab-content">',this.ComposeElementNavigation('nav_'+idCourant,lLibelle,EGenreRole.Tab,null,null,null,null,null,null,aIdWAI?aIdWAI:idCourant),'</div>','</div>');if(idPrecedent!==''){this.AjouterAuTableaux('nav_'+idPrecedent,'nav_'+idCourant,EGenreDirection.DeuxSenses);}
idPrecedent=idCourant;}}
return lHtml.join('');}
function _estOngletVisible(aOnglet){return!!aOnglet&&!aOnglet.invisible&&aOnglet.GetActif();}
function _getNumeroId(aId){const lSegmentsId=aId.split('_');const lNumero=parseInt(lSegmentsId[lSegmentsId.length-1]);return lNumero;}
function _selectOngletSuivant(aIndiceOnglet,aPrecedent){if(this.listeOnglets&&this.listeOnglets.parcourir){const lFunc=(aIndice) =>{const lOnglet=this.listeOnglets.GetElement(aIndice);if(_estOngletVisible(lOnglet)){this.selectOnglet(aIndice);GHtml.setFocus('tab_'+this.getIdOnglet(aIndice));return true;}};if(aPrecedent){for(let i=aIndiceOnglet-1;i>=0;i--){if(lFunc(i)){return;}}} else{for(let i=aIndiceOnglet+1;i<this.listeOnglets.GetNbrElements();i++){if(lFunc(i)){return;}}}}}
function _setFocusSurOnglet(aEvent){this.NavigationClavier('nav_'+this.getIdOnglet(this.ongletSelectionne),aEvent);if(ToucheClavier.estToucheFleche(aEvent.which)||ToucheClavier.estEventSelection(aEvent)){aEvent.stopPropagation();}}
module.exports=ObjetTabOnglets;},fn:"objettabonglets.js"});;
IE.fModule({f:function(exports,require,module,global){const InterfacePage_Mobile=require('InterfacePage_Mobile.js');const ObjetTabOnglets=require('ObjetTabOnglets.js');const ObjetElement=require('ObjetElement.js');const GTraductions=require('ObjetTraduction.js');const Identite=require('ObjetIdentite.js');const ObjetSelection=require('ObjetSelection.js').ObjetSelection;const ObjetListeElements=require('ObjetListeElements.js');const tag=require('tag.js');class ObjetCahierDeTexte_MobileCP extends InterfacePage_Mobile{constructor(...aParams){super(...aParams);this.genreModeAffTAF={AVenir:0,hebdomadaire:1};this.listeTabs=new ObjetListeElements();this.inclureTAFFait=true;this.inclureTAFAFaire=true;this.filtreMatiere=null;this.apresModificationTAF=false;this.avecPageFondBlanc=true;}
ConstruireInstances(){this.identTabs=this.Add(ObjetTabOnglets,this.eventModeAffTAF,(aInstance) =>{aInstance.setOptions({avecSwipe:false});});this.identCalendrier=this.creerInstanceCalendrier();this.identPage=this.creerInstancePage();this.ObjetCahierDeTexte_TAFParAVenir=this.creerInstancePageTabs();const lElementTAFAVenir=new ObjetElement(GTraductions.getValeur('TAFEtContenu.aVenir'),null,this.genreModeAffTAF.AVenir,null,true);lElementTAFAVenir.idDiv=this.GetInstance(this.ObjetCahierDeTexte_TAFParAVenir).GetNom();this.listeTabs.AddElement(lElementTAFAVenir);this.ObjetCahierDeTexte_TAFParHebdomadaire=this.creerInstancePageTabs();const lElementTAFHebdomadaire=new ObjetElement(GTraductions.getValeur('TAFEtContenu.hebdomadaire'),null,this.genreModeAffTAF.hebdomadaire,null,true);lElementTAFHebdomadaire.idDiv=this.GetInstance(this.ObjetCahierDeTexte_TAFParHebdomadaire).GetNom();this.listeTabs.AddElement(lElementTAFHebdomadaire);this.instanceFiltreMatieres=Identite.creerInstance(ObjetSelection,{pere:this,evenement:_evntFiltreMatieres.bind(this)});_initSelecteurFiltreMatieres.call(this,this.instanceFiltreMatieres);this.AddSurZone=[this.identTabs];this.AddSurZone.push({html:tag('div',{class:'conteneur-entete'},tag('div',{class:'conteneur-calendrier',id:this.GetInstance(this.identCalendrier).GetNom()}),this.instanceFiltreMatieres?tag('div',{class:'conteneur-matiere',id:this.instanceFiltreMatieres.GetNom()}):'',this.instanceFiltreTheme?tag('div',{class:'conteneur-matiere',id:this.instanceFiltreTheme.GetNom()}):'',tag('div',{class:'conteneur-filtre'},tag('ie-checkbox',{class:'as-chips EspaceGauche AlignementMilieuVertical','ie-icon':'icon_time','ie-model':"cbFiltreTAF(false)"},GTraductions.getValeur('TAFEtContenu.AFaire')),tag('ie-checkbox',{class:'as-chips EspaceGauche10 AlignementMilieuVertical','ie-icon':'icon_check_fin','ie-model':"cbFiltreTAF(true)"},GTraductions.getValeur('TAFEtContenu.Fait')),this.getFiltrePrimaire()))});}
getControleur(aInstance){return $.extend(true,super.getControleur(this),{cbFiltreTAF:{getValue:function(aTAFFait){if(aTAFFait){return aInstance.inclureTAFFait;} else{return aInstance.inclureTAFAFaire;}},setValue:function(aTAFFait,aValue){aInstance.modifierInclureTAF(aTAFFait,aValue);}}});}
modifierInclureTAF(aTAFFait,aValue){if(aTAFFait){this.inclureTAFFait=aValue;if(!aValue&&!this.inclureTAFAFaire){this.inclureTAFAFaire=true;}} else{this.inclureTAFAFaire=aValue;if(!aValue&&!this.inclureTAFFait){this.inclureTAFFait=true;}}
this.Actualiser();}
creerInstanceCalendrier(){}
creerInstancePage(){}
creerInstancePageTabs(){}
eventModeAffTAF(){}
RecupererDonnees(){}
Actualiser(){}
formatDonnees(){}
getFiltrePrimaire(){}
actualiserFiltreTheme(){}}
function _initSelecteurFiltreMatieres(aInstance){aInstance.SetParametres({avecBoutonsPrecedentSuivant:false});}
function _evntFiltreMatieres(aParam){this.filtreMatiere=aParam.element&&aParam.element.GetNumero()!==null?aParam.element:null;if(this.instanceFiltreTheme){this.actualiserFiltreTheme(this.listeThemes);} else{this.Actualiser();}}
module.exports=ObjetCahierDeTexte_MobileCP;},fn:"interfacepagecahierdetexte_mobilecp.js"});;
IE.fModule({f:function(exports,require,module,global){const ObjetCahierDeTexte_Mobile=require('pagecahierdetexte_mobile.js');const ObjetCelluleDate=require('ObjetCelluleDate.js');const MethodesObjet=require('MethodesObjet.js');const TypeDomaine=require('TypeDomaine.js');const EGenreOnglet=require('Enumere_Onglet.js');const ObjetRequetePageCahierDeTexte=require('ObjetRequetePageCahierDeTexte.js');const Requetes=require('CollectionRequetes.js');const ObjetFenetre=require('ObjetFenetre.js');const{ObjetRequeteConsultation}=require('ObjetRequeteJSON.js');const GTraductions=require('ObjetTraduction.js');const ObjetTri=require('ObjetTri.js');const ObjetListeElements=require('ObjetListeElements.js');const ObjetElement=require('ObjetElement.js');const{GDate}=require('ObjetDate.js');const EGenreEtat=require('Enumere_Etat.js');const ObjetRequeteSaisieTAFFaitEleve=require('ObjetRequeteSaisieTAFFaitEleve.js');const ObjetUtilitaireCahierDeTexte=require('ObjetUtilitaireCahierDeTexte.js');const GHtml=require('GHtml.js');const tag=require('tag.js');const ObjetCahierDeTexte_MobileCP=require('InterfacePageCahierDeTexte_MobileCP.js');const ObjetTabOnglets=require('ObjetTabOnglets.js');const Identite=require('ObjetIdentite.js');const ObjetSelection=require('ObjetSelection.js').ObjetSelection;Requetes.inscrire('donneesContenusCDT',ObjetRequeteConsultation);class ObjetAffichagePageCahierDeTexte_Mobile extends ObjetCahierDeTexte_MobileCP{constructor(...aParams){super(...aParams);this.utilitaireCDT=new ObjetUtilitaireCahierDeTexte(this.Nom+'.utilitaireCDT',this,this.surUtilitaireCDT);this.domaineCourant=null;this.cycleCourant=null;this.genreModeAffCDC={contenu:0,ressource:1};this.listeTabsCDC=new ObjetListeElements();}
creerInstanceCalendrier(){return this.Add(ObjetCelluleDate,this.evenementSurCalendrier,this.initialiserCalendrier);}
creerInstancePage(){return this.Add(ObjetCahierDeTexte_Mobile,this.evenementSurPage);}
creerInstancePageTabs(){return this.Add(ObjetCahierDeTexte_Mobile);}
ConstruireInstances(){this.instanceFiltreTheme=Identite.creerInstance(ObjetSelection,{pere:this,evenement:_evntFiltreThemes.bind(this),options:{avecBoutonsPrecedentSuivant:false}});super.ConstruireInstances();this.estAffichageTAF=GEtatUtilisateur.getGenreOnglet()===EGenreOnglet.CDT_TAF;this.estAffichageContenu=GEtatUtilisateur.getGenreOnglet()===EGenreOnglet.CDT_Contenu;if(this.estAffichageContenu){this.identTabs=this.Add(ObjetTabOnglets,this.eventModeAffCDC,(aInstance) =>{aInstance.setOptions({avecSwipe:false});});this.ObjetCahierDeTexte_CDCContenu=this.creerInstancePageTabs();const lElementCDCContenu=new ObjetElement(GTraductions.getValeur('CahierDeTexte.contenu'),null,this.genreModeAffCDC.contenu,null,true);lElementCDCContenu.idDiv=this.GetInstance(this.ObjetCahierDeTexte_CDCContenu).GetNom();this.listeTabsCDC.AddElement(lElementCDCContenu);this.ObjetCahierDeTexte_CDCRessource=this.creerInstancePageTabs();const lElementCDCRessource=new ObjetElement(GTraductions.getValeur('CahierDeTexte.ressources'),null,this.genreModeAffCDC.ressource,null,true);lElementCDCRessource.idDiv=this.GetInstance(this.ObjetCahierDeTexte_CDCRessource).GetNom();this.listeTabsCDC.AddElement(lElementCDCRessource);this.AddSurZone=[];this.AddSurZone.push(this.identTabs);this.AddSurZone.push({html:_composeFiltresContenu.call(this)});}}
eventModeAffCDC(aParam){if(aParam){switch(aParam.GetGenre()){case this.genreModeAffCDC.contenu:this.selectModeAffCDC=this.genreModeAffCDC.contenu;$('#'+this.GetInstance(this.identCalendrier).GetNom().escapeJQ()).show();this.listeMatieres=_getListeMatieres.call(this);this.listeThemes=_getListeThemes.call(this);if(this.instanceFiltreMatieres){this.instanceFiltreMatieres.SetDonnees(this.listeMatieres,this.listeMatieres.GetIndiceParElement(this.listeMatieres.GetElementParNumero(this.filtreMatiere?this.filtreMatiere.GetNumero():null)));} else{this.Actualiser();}
break;case this.genreModeAffCDC.ressource:this.selectModeAffCDC=this.genreModeAffCDC.ressource;$('#'+this.GetInstance(this.identCalendrier).GetNom().escapeJQ()).hide();new ObjetRequetePageCahierDeTexte(this,this.actionSurRessourcePeda).lancerRequete({domaine:new TypeDomaine(this.cycleCourant),estRequeteRP:true});break;default:break;}}}
eventModeAffTAF(aParam){if(aParam){switch(aParam.GetGenre()){case this.genreModeAffTAF.AVenir:this.selectModeAffTAF=this.genreModeAffTAF.AVenir;$('#'+this.GetInstance(this.identCalendrier).GetNom().escapeJQ()).hide();new ObjetRequetePageCahierDeTexte(this,this.actionSurCalendrier).lancerRequete({date:GDate.aujourdhui});break;case this.genreModeAffTAF.hebdomadaire:this.selectModeAffTAF=this.genreModeAffTAF.hebdomadaire;$('#'+this.GetInstance(this.identCalendrier).GetNom().escapeJQ()).show();this.GetInstance(this.identCalendrier).SetDonnees(this.dateCourant,true);break;default:break;}}}
Actualiser(){let lDonnees=this.formatDonnees();let lAvecFiltrage=this.filtreMatiere!==null;this.GetInstance(this.identPage).SetDonnees(this.Pere.GenreOnglet,lDonnees,this.cycleCourant,lAvecFiltrage,this.filtreMatiere,this.ListeTravailAFaire,(this.estAffichageContenu&&this.selectModeAffCDC===this.genreModeAffCDC.ressource));}
formatDonnees(){let lListeTAF=new ObjetListeElements();let lListeCDC=new ObjetListeElements();let llTestFiltreMatiere;if(this.estAffichageTAF){lListeTAF=this.ListeTravailAFaire.getListeElements(function(aElement){const lFait=aElement.executionQCM?aElement.QCMFait:aElement.TAFFait;const lTestFiltreTAF=(this.inclureTAFFait&&lFait)||(this.inclureTAFAFaire&&!lFait);llTestFiltreMatiere=!this.filtreMatiere||(this.filtreMatiere.GetNumero()===aElement.Matiere.GetNumero());return lTestFiltreTAF&&llTestFiltreMatiere;}.bind(this));if(this.filtreThemes){lListeTAF=lListeTAF.getListeElements((aElement) =>{let lTestTheme=false;if(aElement.ListeThemes&&aElement.ListeThemes.GetNbrElements()){aElement.ListeThemes.parcourir((aTheme) =>{if(aTheme.GetNumero()===this.filtreThemes.GetNumero()){lTestTheme=true;}});}
return lTestTheme;});}
return lListeTAF;} else{if(this.selectModeAffCDC===this.genreModeAffCDC.contenu){this.ListeCahierDeTextes.parcourir((aEl) =>{lListeCDC.add(Object.assign(new ObjetElement(),aEl));});lListeCDC=lListeCDC.getListeElements(function(aElement){llTestFiltreMatiere=!this.filtreMatiere||(this.filtreMatiere.GetNumero()===aElement.Matiere.GetNumero());return llTestFiltreMatiere;}.bind(this));if(this.filtreThemes){lListeCDC.parcourir((aCDT) =>{aCDT.listeContenus=aCDT.listeContenus.getListeElements((aContenu) =>{let lTestTheme=false;if(aContenu.ListeThemes&&aContenu.ListeThemes.GetNbrElements()){aContenu.ListeThemes.parcourir((aTheme) =>{if(aTheme.GetNumero()===this.filtreThemes.GetNumero()){lTestTheme=true;}});}
return lTestTheme;});});lListeCDC=lListeCDC.getListeElements(function(aElement){return!!aElement.listeContenus.GetNbrElements();}.bind(this));}} else{if(this.listeRessourcesPedagogiques){lListeCDC=this.listeRessourcesPedagogiques.getListeElements(function(aElement){llTestFiltreMatiere=!this.filtreMatiere||(this.filtreMatiere.GetNumero()===aElement.matiere.GetNumero());return llTestFiltreMatiere;}.bind(this));if(this.filtreThemes){lListeCDC=lListeCDC.getListeElements((aRessource) =>{let lTestTheme=false;if(aRessource.ListeThemes&&aRessource.ListeThemes.GetNbrElements()){aRessource.ListeThemes.parcourir((aTheme) =>{if(aTheme.GetNumero()===this.filtreThemes.GetNumero()){lTestTheme=true;}});}
return lTestTheme;});}}}
return lListeCDC;}}
actualiserFiltreTheme(aListeThemes){if(aListeThemes){const lListeThemes=MethodesObjet.dupliquer(aListeThemes);if(lListeThemes){lListeThemes.parcourir((aTheme) =>{if(aTheme.Matiere){aTheme.SetLibelle('<div>'+aTheme.GetLibelle()+'</div><div>'+aTheme.Matiere.GetLibelle()+'</div>');}});}
this.instanceFiltreTheme.SetDonnees(lListeThemes,lListeThemes.GetIndiceParElement(this.filtreThemes));}}
initialiserCalendrier(aInstance){aInstance.setOptions_ObjetCelluleDate({selecteurMobile:true,avecBoutonsPrecedentSuivant:true,avecSelectionSemaine:true});}
RecupererDonnees(){$('#'+this.GetInstance(this.identPage).GetNom().escapeJQ()).css('min-height',((parseInt($('#'+this.Nom.escapeJQ()).css('min-height'))-$('#'+this.GetInstance(this.identCalendrier).GetNom().escapeJQ()).height())*0.9)+'px');this.actionSurRecupererDonnees();}
actionSurRecupererDonnees(){if(!this.dateCourant){this.dateCourant=!!GEtatUtilisateur.getDerniereDate()?GEtatUtilisateur.getDerniereDate():(GEtatUtilisateur.getNavigationDate()?GEtatUtilisateur.getNavigationDate():GDate.aujourdhui);}
if(this.estAffichageTAF){if(this.selectModeAffTAF===undefined){let lContexteTAF=GEtatUtilisateur.getContexteTAF();if(lContexteTAF){this.inclureTAFFait=lContexteTAF.inclureTAFFait;this.inclureTAFAFaire=lContexteTAF.inclureTAFAFaire;this.filtreMatiere=lContexteTAF.filtreMatiere;this.filtreThemes=lContexteTAF.filtreThemes;GEtatUtilisateur.setContexteTAF();}
this.selectModeAffTAF=!!lContexteTAF&&lContexteTAF.modeAffTAF?lContexteTAF.modeAffTAF:this.genreModeAffTAF.AVenir;this.GetInstance(this.identTabs).SetDonnees(this.listeTabs);}
this.GetInstance(this.identTabs).selectOnglet(this.listeTabs.GetIndiceParNumeroEtGenre(null,this.selectModeAffTAF));} else{this.GetInstance(this.identCalendrier).SetDonnees(this.dateCourant,true);}
$('#'+this.GetInstance(this.identPage).GetNom().escapeJQ()).css('min-height',((parseInt($('#'+this.Nom.escapeJQ()).css('min-height'))-$('#'+this.GetInstance(this.identCalendrier).GetNom().escapeJQ()).height())*0.9)+'px');}
evenementSurCalendrier(aDate){let lDate=aDate;this.cycleCourant=IE.Cycles.cycleDeLaDate(lDate);this.dateCourant=lDate;GEtatUtilisateur.setDerniereDate(lDate);new ObjetRequetePageCahierDeTexte(this,this.actionSurCalendrier).lancerRequete({domaine:new TypeDomaine(this.cycleCourant),sansRequeteRP:true});}
evenementSurPage(aObjet){if(!aObjet||aObjet.date){this.dateCourant=aObjet?aObjet.date:this.dateCourant;this.apresModificationTAF=true;if(this.donnee){if(this.fenetre){this.fenetre.Fermer();}
Requetes('donneesContenusCDT',this,_actionApresRequeteDonneesTAFCDT.bind(this,{contexte:this.donnee,pourLe:true})).lancerRequete({cahierDeTextes:new ObjetElement('',this.donnee.GetNumero()),pourTAF:true});} else{this.RecupererDonnees();}}
if(aObjet&&aObjet.taf){Requetes('donneesContenusCDT',this,_actionApresRequeteDonneesContenusCDT).lancerRequete({cahierDeTextes:aObjet.taf.cahierDeTextes});return;}
if(aObjet&&aObjet.cours){Requetes('donneesContenusCDT',this,_actionApresRequeteDonneesTAFCDT.bind(this,{contexte:aObjet.cours,pourLe:true})).lancerRequete({cahierDeTextes:new ObjetElement('',aObjet.cours.GetNumero()),pourTAF:true});return;}
let lExecutionQCM=null,i,j,k,lElement,lContenu;if(this.estAffichageTAF){if(aObjet&&aObjet.CDT){lElement=aObjet.CDT;for(j=0;lElement.listeContenus&&j<lElement.listeContenus.GetNbrElements();j++){lContenu=lElement.listeContenus.GetElement(j);for(k=0;lContenu.listeExecutionQCM&&k<lContenu.listeExecutionQCM.GetNbrElements();k++){lExecutionQCM=lContenu.listeExecutionQCM.GetElement(k);if(lExecutionQCM&&lExecutionQCM.GetNumero()===aObjet.executionQCM){break;}}
if(lExecutionQCM&&lExecutionQCM.GetNumero()===aObjet.executionQCM){break;}}} else{for(i=0;i<this.ListeTravailAFaire.GetNbrElements();i++){lElement=this.ListeTravailAFaire.GetElement(i);if(lElement.executionQCM&&!!aObjet&&!!aObjet.executionQCM&&lElement.executionQCM.GetNumero()===aObjet.executionQCM){lExecutionQCM=lElement.executionQCM;break;}}}
GEtatUtilisateur.setContexteTAF({modeAffTAF:this.selectModeAffTAF,inclureTAFFait:this.inclureTAFFait,inclureTAFAFaire:this.inclureTAFAFaire,filtreMatiere:this.filtreMatiere,filtreThemes:this.filtreThemes});} else if(this.estAffichageContenu){if(aObjet&&aObjet.estRessource){this.listeRessourcesPedagogiques.parcourir(function(D){if(D.ressource&&D.ressource.GetNumero()===aObjet.executionQCM){lExecutionQCM=D.ressource;return false;}});} else if(aObjet&&aObjet.CDT){lContenu=aObjet.CDT;for(i=0;i<lContenu.ListeTravailAFaire.GetNbrElements();i++){lElement=lContenu.ListeTravailAFaire.GetElement(i);if(lElement.executionQCM&&!!aObjet&&!!aObjet.executionQCM&&lElement.executionQCM.GetNumero()===aObjet.executionQCM){lExecutionQCM=lElement.executionQCM;break;}}} else{for(i=0;i<this.ListeCahierDeTextes.GetNbrElements();i++){lElement=this.ListeCahierDeTextes.GetElement(i);for(j=0;lElement.listeContenus&&j<lElement.listeContenus.GetNbrElements();j++){lContenu=lElement.listeContenus.GetElement(j);for(k=0;lContenu.listeExecutionQCM&&k<lContenu.listeExecutionQCM.GetNbrElements();k++){lExecutionQCM=lContenu.listeExecutionQCM.GetElement(k);if(lExecutionQCM&&lExecutionQCM.GetNumero()===aObjet.executionQCM){break;}}
if(lExecutionQCM&&lExecutionQCM.GetNumero()===aObjet.executionQCM){break;}}
if(lExecutionQCM&&lExecutionQCM.GetNumero()===aObjet.executionQCM){break;}}}
GEtatUtilisateur.setContexteCDT({modeAffCDC:this.selectModeAffCDC,filtreMatiere:this.filtreMatiere,filtreThemes:this.filtreThemes});}
if(lExecutionQCM){this.callback.appel({genreOnglet:GEtatUtilisateur.genreOnglet,executionQCM:lExecutionQCM});}}
surUtilitaireCDT(){if(this.fenetre){this.fenetre.Fermer();}
Requetes('donneesContenusCDT',this,_actionApresRequeteDonneesTAFCDT.bind(this,{contexte:this.donnee,pourLe:true})).lancerRequete({cahierDeTextes:new ObjetElement('',this.donnee.GetNumero()),pourTAF:true});}
actionSurCalendrier(aParametres){this.ListeTravailAFaire=aParametres.listeTAF;this.ListeCahierDeTextes=aParametres.listeCDT;this.listeRessourcesPedagogiques=aParametres.listeRessourcesPedagogiques;if(this.estAffichageContenu){if(this.selectModeAffCDC===undefined){let lContexteCDT=GEtatUtilisateur.getContexteCDT();if(lContexteCDT){this.filtreMatiere=lContexteCDT.filtreMatiere;this.filtreThemes=lContexteCDT.filtreThemes;GEtatUtilisateur.setContexteCDT();}
this.selectModeAffCDC=!!lContexteCDT&&lContexteCDT.modeAffCDC?lContexteCDT.modeAffCDC:this.genreModeAffCDC.contenu;this.GetInstance(this.identTabs).SetDonnees(this.listeTabsCDC);}
this.GetInstance(this.identTabs).selectOnglet(this.listeTabs.GetIndiceParNumeroEtGenre(null,this.selectModeAffCDC));}
if(!(this.estAffichageContenu&&this.selectModeAffCDC===this.genreModeAffCDC.ressource)){this.listeMatieres=_getListeMatieres.call(this);this.listeThemes=_getListeThemes.call(this);if(this.instanceFiltreMatieres){this.instanceFiltreMatieres.SetDonnees(this.listeMatieres,this.listeMatieres.GetIndiceParElement(this.listeMatieres.GetElementParNumero(this.filtreMatiere?this.filtreMatiere.GetNumero():null)));} else{this.Actualiser();}}
if(!!this.ListeTravailAFaire&&this.ListeTravailAFaire.GetNbrElements()){if(!this.apresModificationTAF){const lIdentPageJQ=$('#'+this.GetInstance(this.identPage).GetNom().escapeJQ());const lPageJQ=$('#'+this.GetNom().escapeJQ());const lZoneSelectionJQ=$('#'+this.Pere.idZoneSelection);const lElementJQ=$('#'+this.GetInstance(this.identPage).GetNom().escapeJQ()).find('div[data-idDate="'+GDate.FormatDate(this.dateCourant,"%JJ%MM%AAAA").toString()+'"]');if(this.selectModeAffTAF===this.genreModeAffTAF.AVenir&&!!lElementJQ&&!!lElementJQ.get(0)&&lElementJQ.get(0).scrollIntoView){const lPositionDate=lElementJQ.offset().top;lElementJQ.get(0).scrollIntoView();$('#'+GApplication.getIdConteneur()).scrollTop(lPositionDate-(lZoneSelectionJQ.offset().top+lZoneSelectionJQ.outerHeight(true))-(lPageJQ.outerHeight(true)-lIdentPageJQ.outerHeight(true)));this.dateCourant=GDate.aujourdhui;} else{$('#'+GApplication.getIdConteneur()).scrollTop(0);}} else{this.apresModificationTAF=false;}}}
actionSurRessourcePeda(aParams){this.listeRessourcesPedagogiques=aParams.listeRessourcesPedagogiques;this.listeMatieres=_getListeMatieres.call(this);this.listeThemes=_getListeThemes.call(this);if(this.instanceFiltreMatieres){this.instanceFiltreMatieres.SetDonnees(this.listeMatieres,this.listeMatieres.GetIndiceParElement(this.listeMatieres.GetElementParNumero(this.filtreMatiere?this.filtreMatiere.GetNumero():null)));} else{this.Actualiser();}}}
function _actionApresRequeteDonneesContenusCDT(aJSON){let lDonnee=aJSON.ListeCahierDeTextes&&aJSON.ListeCahierDeTextes.GetNbrElements()===1?aJSON.ListeCahierDeTextes.GetPremierElement():null;if(lDonnee){new(require('ObjetDeserialiser.js'))().deserialiserCahierDeTexte(lDonnee);_afficheFenetreDetail.call(this,lDonnee,false);} else{}}
function _actionApresRequeteDonneesTAFCDT(aParams,aJSON){let lDonnee=aJSON.ListeCahierDeTextes&&aJSON.ListeCahierDeTextes.GetNbrElements()===1?aJSON.ListeCahierDeTextes.GetPremierElement():null;if(lDonnee){_afficheFenetreDetail.call(this,lDonnee,true);} else{}}
function _afficheFenetreDetail(aDonnee,aEstTAF){this.donnee=aDonnee;this.fenetre=ObjetFenetre.creerInstance(ObjetFenetre,{pere:this,evenement:function(aGenreBouton){if(aGenreBouton!==1){this.donnee=null;}},initialiser:function(aInstance){aInstance.setOptionsFenetre({titre:aEstTAF?GTraductions.getValeur('CahierDeTexte.TravailAFaire'):GTraductions.getValeur('CahierDeTexte.ContenuDuCours'),avecCroixFermeture:false});}});$.extend(this.fenetre.controleur,{appelQCM:{event:function(aDonnee,aNumeroQCM){this.evenementSurPage({CDT:aDonnee,executionQCM:aNumeroQCM});}.bind(this,aDonnee)},evenementTafFait:{getValue:function(aNumeroTaf){const lElement=aDonnee.ListeTravailAFaire.GetElementParNumero(aNumeroTaf);return lElement.TAFFait;},setValue:function(aNumeroTaf){const lElement=aDonnee.ListeTravailAFaire.GetElementParNumero(aNumeroTaf);if(!!lElement.TAFFait){lElement.TAFFait=false;} else{lElement.TAFFait=true;}
lElement.SetEtat(EGenreEtat.Modification);new ObjetRequeteSaisieTAFFaitEleve(this).lancerRequete({listeTAF:aDonnee.ListeTravailAFaire}).then(function(){let lHtml;lHtml=this.GetInstance(this.identPage).composeTAF(aDonnee,this.fenetre.controleur);GHtml.setHtml(this.Nom+'_cont',lHtml,{controleur:this.fenetre.controleur});}.bind(this));}.bind(this)}});if(aEstTAF){this.fenetre.Afficher(tag('div',{id:this.Nom+'_cont'},this.GetInstance(this.identPage).composeTAF(aDonnee,this.fenetre.controleur)));} else{this.fenetre.Afficher(tag('div',{id:this.Nom+'_cont'},this.GetInstance(this.identPage).composeCours(aDonnee)));}}
function _composeFiltresContenu(){const H=[];H.push('<div class="conteneur-entete">',tag('div',{class:'conteneur-calendrier',id:this.GetInstance(this.identCalendrier).GetNom()}),tag('div',{id:this.instanceFiltreMatieres.GetNom()}),tag('div',{id:this.instanceFiltreTheme.GetNom()}),'</div>');return H.join('');}
function _getListeMatieres(){let lResult=new ObjetListeElements();let lMatiereDeLaListe;if(this.estAffichageTAF){this.ListeTravailAFaire.parcourir(function(aElement){lMatiereDeLaListe=lResult.GetElementParNumero(aElement.Matiere.GetNumero());if(!lMatiereDeLaListe){lMatiereDeLaListe=MethodesObjet.dupliquer(aElement.Matiere);lMatiereDeLaListe.nbElementsConcernes=0;lMatiereDeLaListe.couleurFond=aElement.CouleurFond;lResult.AddElement(lMatiereDeLaListe);}
lMatiereDeLaListe.nbElementsConcernes++;});} else{if(this.selectModeAffCDC===this.genreModeAffCDC.contenu){this.ListeCahierDeTextes.parcourir(function(aElement){if(!!aElement&&!!aElement.listeContenus&&aElement.listeContenus.GetNbrElements()>0){lMatiereDeLaListe=lResult.GetElementParNumero(aElement.Matiere.GetNumero());if(!lMatiereDeLaListe){lMatiereDeLaListe=MethodesObjet.dupliquer(aElement.Matiere);lMatiereDeLaListe.nbElementsConcernes=0;lMatiereDeLaListe.couleurFond=aElement.CouleurFond;lResult.AddElement(lMatiereDeLaListe);}
lMatiereDeLaListe.nbElementsConcernes++;}});} else{if(!!this.listeRessourcesPedagogiques){this.listeRessourcesPedagogiques.parcourir(function(aRessource){if(!!aRessource&&!!aRessource.matiere){lMatiereDeLaListe=lResult.GetElementParNumero(aRessource.matiere.GetNumero());if(!lMatiereDeLaListe){lMatiereDeLaListe=MethodesObjet.dupliquer(aRessource.matiere);lMatiereDeLaListe.nbElementsConcernes=0;lMatiereDeLaListe.couleurFond=aRessource.matiere.CouleurFond;lResult.AddElement(lMatiereDeLaListe);}
lMatiereDeLaListe.nbElementsConcernes++;}});}}}
lResult.setTri([ObjetTri.init('Libelle')]);lResult.trier();lResult.insererElement(new ObjetElement(GTraductions.getValeur('TAFEtContenu.toutesLesMatieres'),null,-1),0);return lResult;}
function _evntFiltreThemes(aParam){this.filtreThemes=aParam.element&&aParam.element.GetNumero()!==null?aParam.element:null;this.Actualiser();}
function _getListeThemes(){let lResult=new ObjetListeElements();let lThemeDeLaListe;if(this.estAffichageTAF){this.ListeTravailAFaire.parcourir(function(aElement){if(!!aElement&&!!aElement.ListeThemes&&aElement.ListeThemes.GetNbrElements()){aElement.ListeThemes.parcourir((aTheme) =>{lThemeDeLaListe=lResult.GetElementParNumero(aTheme.GetNumero());if(!lThemeDeLaListe){lThemeDeLaListe=MethodesObjet.dupliquer(aTheme);lResult.AddElement(lThemeDeLaListe);}});}});} else{if(this.selectModeAffCDC===this.genreModeAffCDC.contenu){this.ListeCahierDeTextes.parcourir(function(aElement){if(!!aElement&&!!aElement.listeContenus&&aElement.listeContenus.GetNbrElements()){aElement.listeContenus.parcourir((aContenu) =>{if(!!aContenu&&!!aContenu.ListeThemes&&aContenu.ListeThemes.GetNbrElements()){aContenu.ListeThemes.parcourir((aTheme) =>{lThemeDeLaListe=lResult.GetElementParNumero(aTheme.GetNumero());if(!lThemeDeLaListe){lThemeDeLaListe=MethodesObjet.dupliquer(aTheme);lResult.AddElement(lThemeDeLaListe);}});}});}});} else{if(!!this.listeRessourcesPedagogiques){this.listeRessourcesPedagogiques.parcourir(function(aRessource){if(!!aRessource&&!!aRessource.ListeThemes&&aRessource.ListeThemes.GetNbrElements()){aRessource.ListeThemes.parcourir((aTheme) =>{lThemeDeLaListe=lResult.GetElementParNumero(aTheme.GetNumero());if(!lThemeDeLaListe){lThemeDeLaListe=MethodesObjet.dupliquer(aTheme);lResult.AddElement(lThemeDeLaListe);}});}});}}}
lResult.setTri([ObjetTri.init('Libelle')]);lResult.trier();lResult.insererElement(new ObjetElement(GTraductions.getValeur('CahierDeTexte.tousLesThemes'),null,-1),0);return lResult;}
module.exports=ObjetAffichagePageCahierDeTexte_Mobile;},fn:"interfacepagecahierdetexte_mobile.js"});;
IE.fModule({f:function(exports,require,module,global){const InterfacePage_Mobile=require('InterfacePage_Mobile.js');const{ObjetRequeteConsultation}=require('ObjetRequeteJSON.js');const Requetes=require('CollectionRequetes.js');const ObjetTri=require('ObjetTri.js');const MethodesTableau=require('MethodesTableau.js');const EGenreEspace=require('Enumere_Espace.js');const GHtml=require('GHtml.js');const UtilitaireManuelsNumeriques=require('UtilitaireManuelsNumeriques.js');Requetes.inscrire('ManuelsNumeriques',ObjetRequeteConsultation);class InterfaceManuelsNumeriques_Mobile extends InterfacePage_Mobile{constructor(...aParams){super(...aParams);this.options={avecNomEditeur:MethodesTableau.existe(GEtatUtilisateur.GenreEspace,[EGenreEspace.Mobile_Professeur,EGenreEspace.Mobile_PrimProfesseur]),avecDetailsRessources:MethodesTableau.existe(GEtatUtilisateur.GenreEspace,[EGenreEspace.Mobile_Professeur,EGenreEspace.Mobile_PrimProfesseur]),avecCumulMatiere:MethodesTableau.existe(GEtatUtilisateur.GenreEspace,[EGenreEspace.Mobile_Eleve,EGenreEspace.Mobile_PrimEleve])};}
RecupererDonnees(){this.ActualiserDonnees();}
ActualiserDonnees(){Requetes('ManuelsNumeriques',this,_surRecupererDonnees.bind(this)).lancerRequete();}
getControleur(){return $.extend(true,super.getControleur(this),{});}}
function _surRecupererDonnees(aJSON){aJSON.kiosque.listeRessources.setTri([
ObjetTri.init(function(D){return D.matiere?!D.matiere.existeNumero():false;}),ObjetTri.init(function(D){return D.matiere?D.matiere.GetLibelle():'';}),ObjetTri.init('editeur'),ObjetTri.init('titre')
]);aJSON.kiosque.listeRessources.trier();var lHtml=[];lHtml.push(UtilitaireManuelsNumeriques.composeListeManuelsNumeriques_Mobile(aJSON.kiosque.listeRessources,this.options,this.controleur));GHtml.setHtml(this.Nom,lHtml.join(''),{controleur:this.controleur});}
module.exports=InterfaceManuelsNumeriques_Mobile;},fn:"interfacemanuelsnumeriques_mobile.js"});;
IE.fModule({f:function(exports,require,module,global){
const UtilitaireBulletinEtReleve_Mobile={};UtilitaireBulletinEtReleve_Mobile.composePetitBlocDonnees=function(aIntitule,aContenu,aMultiLignes){const lHtml=[];lHtml.push('<div class="petitBlocDonnees">','<div>',aIntitule,'</div>','<div class="',(aMultiLignes===true?'multiLignes':''),'">',(aContenu||'&nbsp;'),'</div>','</div>');return lHtml.join('');};UtilitaireBulletinEtReleve_Mobile.composeAppreciation=function(aParam){let lHtml=[];lHtml.push('<div class="notes-data-conteneur">');lHtml.push('<div class="libelle" style="',(!!aParam.styleBlockIntitule?aParam.styleBlockIntitule:''),'">',aParam.intituleDAppreciation,'</div>');lHtml.push('<div class="appreciation">');if($.isArray(aParam.contenuDAppreciation)){lHtml=lHtml.concat(aParam.contenuDAppreciation);} else{lHtml.push(aParam.contenuDAppreciation);}
lHtml.push('</div>');lHtml.push('</div>');return lHtml.join('');};UtilitaireBulletinEtReleve_Mobile.composeVieScolaire=function(aDonneesAbsences){const lHtml=[];for(const lAbs in aDonneesAbsences){if(aDonneesAbsences[lAbs]&&aDonneesAbsences[lAbs]!==""){lHtml.push('<div class="vie-scolaire-conteneur">'+aDonneesAbsences[lAbs]+'</div>');}}
return lHtml.join('');};module.exports=UtilitaireBulletinEtReleve_Mobile;},fn:"utilitairebulletinetreleve_mobile.js"});;
IE.fModule({f:function(exports,require,module,global){const GTraductions=require('ObjetTraduction.js');const ObjetListeElements=require('ObjetListeElements.js');const ObjetElement=require('ObjetElement.js');const{GObjetWAI,EGenreRole}=require('ObjetWAI.js');const EGenreEvolution={Aucune:0,Progres:1,Regularite:2,Regression:3};EGenreEvolution.getLibelle=function(aGenre){switch(aGenre){case EGenreEvolution.Aucune:return GTraductions.getValeur('Aucune');case EGenreEvolution.Progres:return GTraductions.getValeur('BulletinEtReleve.Progres');case EGenreEvolution.Regularite:return GTraductions.getValeur('BulletinEtReleve.Regulier');case EGenreEvolution.Regression:return GTraductions.getValeur('BulletinEtReleve.Regression');}};EGenreEvolution.getAriaLabel=function(aGenre){switch(aGenre){case EGenreEvolution.Aucune:return GTraductions.getValeur('Aucune');case EGenreEvolution.Progres:return GTraductions.getValeur('BulletinEtReleve.arialabel.Progres');case EGenreEvolution.Regularite:return GTraductions.getValeur('BulletinEtReleve.arialabel.Regulier');case EGenreEvolution.Regression:return GTraductions.getValeur('BulletinEtReleve.arialabel.Regression');}};EGenreEvolution.getImage=function(aGenre){let lClasseCss='';switch(aGenre){case EGenreEvolution.Progres:lClasseCss='Image_EvolutionHausse';break;case EGenreEvolution.Regularite:lClasseCss='Image_EvolutionStable';break;case EGenreEvolution.Regression:lClasseCss='Image_EvolutionBaisse';break;}
const H=[];if(!!lClasseCss){H.push('<div class="InlineBlock ',lClasseCss,'" ',GObjetWAI.composeRole(EGenreRole.Img),' aria-label="',EGenreEvolution.getAriaLabel(aGenre),'"></div>');}
return H.join('');};EGenreEvolution.getListePourMenu=function(){const lListeEvolutions=new ObjetListeElements();const lTabGenres=[
EGenreEvolution.Aucune,EGenreEvolution.Progres,EGenreEvolution.Regularite,EGenreEvolution.Regression
];for(let i=0,lNbr=lTabGenres.length;i<lNbr;i++){let lGenre=lTabGenres[i];let lEvolution=new ObjetElement(EGenreEvolution.getLibelle(lGenre),lGenre,lGenre);lEvolution.image=EGenreEvolution.getImage(lGenre);lListeEvolutions.AddElement(lEvolution);}
return lListeEvolutions;};module.exports=EGenreEvolution;},fn:"enumere_evolution.js"});;
IE.fModule({f:function(exports,require,module,global){const GTraductions=require('ObjetTraduction.js');const TypeModuleFonctionnelPiedBulletin={MFPB_VieScolaire:0,MFPB_Certificats:1,MFPB_Appreciations:2,MFPB_ParcoursEducatif:3,MFPB_Competences:4,MFPB_Stages:5,MFPB_Orientations:6,MFPB_Mentions:7,MFPB_Legende:8,MFPB_Projets:9,MFPB_Credits:10,MFPB_Appreciations_Generales_Annuelles:11,MFPB_Appreciations_Annuelles:12};TypeModuleFonctionnelPiedBulletin.getLibelle=function(aGenre){switch(aGenre){case this.MFPB_ParcoursEducatif:return GTraductions.getValeur('ParcoursPeda.ComboGenreParcours');case this.MFPB_Stages:return GTraductions.getValeur('PiedDeBulletin.Onglet.Titre.Stages');case this.MFPB_Competences:return GTraductions.getValeur('PiedDeBulletin.Competences');case this.MFPB_Orientations:return GTraductions.getValeur('PiedDeBulletin.Orientations');case this.MFPB_Appreciations:return GTraductions.getValeur('ConseilDeClasse');case this.MFPB_Mentions:return GTraductions.getValeur('Appreciations.Mentions');case this.MFPB_Certificats:return GTraductions.getValeur('FicheEleve.attestations');case this.MFPB_Credits:return GTraductions.getValeur('PiedDeBulletin.CreditsAnnuel');case this.MFPB_Appreciations_Annuelles:return GTraductions.getValeur('PiedDeBulletin.AppreciationsAnnuelles');case this.MFPB_Appreciations_Generales_Annuelles:return GTraductions.getValeur('PiedDeBulletin.AppreciationsAnnuellesGenerales');default:return'';}};TypeModuleFonctionnelPiedBulletin.getTabTousLesModules=function(){const lTousModules=[];const lKeysObject=Object.keys(TypeModuleFonctionnelPiedBulletin);for(let i=0;i<lKeysObject.length;i++){const lValeurEnum=TypeModuleFonctionnelPiedBulletin[lKeysObject[i]];if(typeof(lValeurEnum)==='number'){lTousModules.push(lValeurEnum);}}
return lTousModules;};module.exports=TypeModuleFonctionnelPiedBulletin;},fn:"typemodulefonctionnelpiedbulletin.js"});;
IE.fModule({f:function(exports,require,module,global){const TypeContexteBulletin={CB_Eleve:0,CB_Classe:1};module.exports=TypeContexteBulletin;},fn:"typecontextebulletin.js"});;
IE.fModule({f:function(exports,require,module,global){const TypeModeAffichagePiedBulletin={MAPB_Onglets:0,MAPB_Lineaire:1,MAPB_Accessible:2};module.exports=TypeModeAffichagePiedBulletin;},fn:"typemodeaffichagepiedbulletin.js"});;
IE.fModule({f:function(exports,require,module,global){const TypeGenreAppreciation={GA_Bulletin_Professeur:0,GA_Bulletin_Generale:1,GA_Bulletin_CPE:2,GA_Releve_Professeur:3,GA_Releve_Generale:4,GA_BilanAnnuel_Professeur:5,GA_BilanAnnuel_Generale:6,GA_Observations_Competences:7,GA_BulletinCompetence_Professeur:8,GA_BulletinCompetence_Generale:9,GA_BulletinCompetence_CPE:10};module.exports.TypeGenreAppreciation=TypeGenreAppreciation;},fn:"typegenreappreciation.js"});;
IE.fModule({f:function(exports,require,module,global){const EGenreAppreciationGenerale={AG_Assiduite:1,AG_Autonomie:2,AG_Globale:3,AG_Commentaire1:4,AG_Commentaire2:5,AG_Commentaire3:6,AG_CPE:7,AG_Mention:8};module.exports=EGenreAppreciationGenerale;},fn:"enumere_appreciationgenerale.js"});;
IE.fModule({f:function(exports,require,module,global){var TypeReleveBulletin={ReleveDeNotes:0,BulletinNotes:1,BulletinCompetences:2,ReleveCompetences:3,LivretScolaire:4,AppreciationsBulletinParEleve:5,AppreciationsBulletinProfesseur:6,AppreciationsReleveProfesseur:7,AvisProfesseur:8,AvisParcoursup:9};module.exports=TypeReleveBulletin;},fn:"typerelevebulletin.js"});;
IE.fModule({f:function(exports,require,module,global){class ObjetMoteurGrilleSaisie{constructor(){}
selectionCelluleSuivante(aParam){aParam.instanceListe.selectionnerCelluleSuivante(Object.assign({entrerEdition:true},aParam.suivante));}
estColVariable(aIdCol,aRacineCol){return(aIdCol!==null)&&(aIdCol!==undefined)?aIdCol.startsWith(aRacineCol):false;}
getIdColVariable(aIndice,aRacineCol){return aRacineCol+'_'+aIndice;}
getIndiceColVariable(aIdCol){if((aIdCol!==null)&&(aIdCol!==undefined)){const lTab=aIdCol.split('_');const lTaille=lTab.length;return parseInt(lTab[lTaille-1]);}
return 0;}}
module.exports=ObjetMoteurGrilleSaisie;},fn:"objetmoteurgrillesaisie.js"});;
IE.fModule({f:function(exports,require,module,global){const GTraductions=require('ObjetTraduction.js');const TypeModuleFonctionnelPiedBulletin=require('TypeModuleFonctionnelPiedBulletin.js');const TypeContexteBulletin=require('TypeContexteBulletin.js');const TypeModeAffichagePiedBulletin=require('TypeModeAffichagePiedBulletin.js');const EGenreEtat=require('Enumere_Etat.js');const TypeGenreAppreciation=require('TypeGenreAppreciation.js').TypeGenreAppreciation;const EGenreAppreciationGenerale=require('Enumere_AppreciationGenerale.js');const TypeReleveBulletin=require('TypeReleveBulletin.js');const ObjetMoteurGrilleSaisie=require('ObjetMoteurGrilleSaisie.js');class ObjetMoteurPiedDeBulletin{constructor(){this.moteurGrille=new ObjetMoteurGrilleSaisie();}
getContexteBulletin(aParam){switch(aParam.typeReleveBulletin){case TypeReleveBulletin.BulletinNotes:{const lCtxEleve=((aParam!==null)&&(aParam!==undefined)&&aParam.estCtxEleve);return lCtxEleve?TypeContexteBulletin.CB_Eleve:TypeContexteBulletin.CB_Classe;}
case TypeReleveBulletin.ReleveDeNotes:return TypeContexteBulletin.CB_Eleve;case TypeReleveBulletin.AppreciationsBulletinProfesseur:return TypeContexteBulletin.CB_Classe;default:;}}
getModulesHorsOnglets(aParam){const lContexteBulletin=aParam.typeContexteBulletin;const lAvecSaisie=aParam.avecSaisie;switch(aParam.typeReleveBulletin){case TypeReleveBulletin.BulletinNotes:if(lAvecSaisie){return(lContexteBulletin===TypeContexteBulletin.CB_Eleve)?
[TypeModuleFonctionnelPiedBulletin.MFPB_Projets,TypeModuleFonctionnelPiedBulletin.MFPB_VieScolaire]:
[TypeModuleFonctionnelPiedBulletin.MFPB_VieScolaire];} else{return(lContexteBulletin===TypeContexteBulletin.CB_Eleve)?
[TypeModuleFonctionnelPiedBulletin.MFPB_ParcoursEducatif,TypeModuleFonctionnelPiedBulletin.MFPB_Competences,TypeModuleFonctionnelPiedBulletin.MFPB_Projets,TypeModuleFonctionnelPiedBulletin.MFPB_VieScolaire,TypeModuleFonctionnelPiedBulletin.MFPB_Certificats
]:
[TypeModuleFonctionnelPiedBulletin.MFPB_VieScolaire];}
case TypeReleveBulletin.ReleveDeNotes:return[TypeModuleFonctionnelPiedBulletin.MFPB_Projets,TypeModuleFonctionnelPiedBulletin.MFPB_VieScolaire];case TypeReleveBulletin.BulletinCompetences:if(lAvecSaisie){return(lContexteBulletin===TypeContexteBulletin.CB_Eleve)?
[TypeModuleFonctionnelPiedBulletin.MFPB_Projets,TypeModuleFonctionnelPiedBulletin.MFPB_VieScolaire]:
[TypeModuleFonctionnelPiedBulletin.MFPB_VieScolaire];} else{return(lContexteBulletin===TypeContexteBulletin.CB_Eleve)?
[TypeModuleFonctionnelPiedBulletin.MFPB_ParcoursEducatif,TypeModuleFonctionnelPiedBulletin.MFPB_Projets,TypeModuleFonctionnelPiedBulletin.MFPB_VieScolaire,TypeModuleFonctionnelPiedBulletin.MFPB_Certificats
]:
[TypeModuleFonctionnelPiedBulletin.MFPB_ParcoursEducatif,TypeModuleFonctionnelPiedBulletin.MFPB_VieScolaire];}
case TypeReleveBulletin.ReleveCompetences:;return lAvecSaisie?
[TypeModuleFonctionnelPiedBulletin.MFPB_Projets,TypeModuleFonctionnelPiedBulletin.MFPB_VieScolaire
]:
[TypeModuleFonctionnelPiedBulletin.MFPB_ParcoursEducatif,TypeModuleFonctionnelPiedBulletin.MFPB_Projets,TypeModuleFonctionnelPiedBulletin.MFPB_VieScolaire,TypeModuleFonctionnelPiedBulletin.MFPB_Certificats];case TypeReleveBulletin.AppreciationsBulletinParEleve:return[];default:;}}
getModulesOnglets(aParam){const lAvecSaisie=aParam.avecSaisie;const lContexteBulletin=aParam.typeContexteBulletin;switch(aParam.typeReleveBulletin){case TypeReleveBulletin.BulletinNotes:if(lAvecSaisie){return(lContexteBulletin===TypeContexteBulletin.CB_Eleve)?
[TypeModuleFonctionnelPiedBulletin.MFPB_ParcoursEducatif,TypeModuleFonctionnelPiedBulletin.MFPB_Competences,TypeModuleFonctionnelPiedBulletin.MFPB_Orientations,TypeModuleFonctionnelPiedBulletin.MFPB_Appreciations,TypeModuleFonctionnelPiedBulletin.MFPB_Stages,TypeModuleFonctionnelPiedBulletin.MFPB_Certificats,TypeModuleFonctionnelPiedBulletin.MFPB_Credits
]:
[TypeModuleFonctionnelPiedBulletin.MFPB_ParcoursEducatif,TypeModuleFonctionnelPiedBulletin.MFPB_Appreciations,TypeModuleFonctionnelPiedBulletin.MFPB_Mentions,TypeModuleFonctionnelPiedBulletin.MFPB_Orientations
];} else{return(lContexteBulletin===TypeContexteBulletin.CB_Eleve)?
[TypeModuleFonctionnelPiedBulletin.MFPB_Orientations,TypeModuleFonctionnelPiedBulletin.MFPB_Appreciations,TypeModuleFonctionnelPiedBulletin.MFPB_Stages,TypeModuleFonctionnelPiedBulletin.MFPB_Legende,TypeModuleFonctionnelPiedBulletin.MFPB_Credits
]:
[TypeModuleFonctionnelPiedBulletin.MFPB_ParcoursEducatif,TypeModuleFonctionnelPiedBulletin.MFPB_Orientations,TypeModuleFonctionnelPiedBulletin.MFPB_Appreciations,TypeModuleFonctionnelPiedBulletin.MFPB_Mentions
];}
case TypeReleveBulletin.ReleveDeNotes:return[TypeModuleFonctionnelPiedBulletin.MFPB_Appreciations];case TypeReleveBulletin.BulletinCompetences:if(lAvecSaisie){return(lContexteBulletin===TypeContexteBulletin.CB_Eleve)?
[TypeModuleFonctionnelPiedBulletin.MFPB_ParcoursEducatif,TypeModuleFonctionnelPiedBulletin.MFPB_Competences,TypeModuleFonctionnelPiedBulletin.MFPB_Appreciations,TypeModuleFonctionnelPiedBulletin.MFPB_Orientations,TypeModuleFonctionnelPiedBulletin.MFPB_Stages,TypeModuleFonctionnelPiedBulletin.MFPB_Certificats
]:
[TypeModuleFonctionnelPiedBulletin.MFPB_ParcoursEducatif,TypeModuleFonctionnelPiedBulletin.MFPB_Appreciations,TypeModuleFonctionnelPiedBulletin.MFPB_Orientations,TypeModuleFonctionnelPiedBulletin.MFPB_Mentions
];} else{return(lContexteBulletin===TypeContexteBulletin.CB_Eleve)?
[TypeModuleFonctionnelPiedBulletin.MFPB_Orientations,TypeModuleFonctionnelPiedBulletin.MFPB_Competences,TypeModuleFonctionnelPiedBulletin.MFPB_Appreciations,TypeModuleFonctionnelPiedBulletin.MFPB_Stages,TypeModuleFonctionnelPiedBulletin.MFPB_Legende
]:
[TypeModuleFonctionnelPiedBulletin.MFPB_Appreciations,TypeModuleFonctionnelPiedBulletin.MFPB_Mentions,TypeModuleFonctionnelPiedBulletin.MFPB_Orientations
];}
case TypeReleveBulletin.ReleveCompetences:;return lAvecSaisie?
[TypeModuleFonctionnelPiedBulletin.MFPB_ParcoursEducatif,TypeModuleFonctionnelPiedBulletin.MFPB_Competences,TypeModuleFonctionnelPiedBulletin.MFPB_Appreciations,TypeModuleFonctionnelPiedBulletin.MFPB_Orientations,TypeModuleFonctionnelPiedBulletin.MFPB_Stages,TypeModuleFonctionnelPiedBulletin.MFPB_Certificats
]:
[TypeModuleFonctionnelPiedBulletin.MFPB_Orientations,TypeModuleFonctionnelPiedBulletin.MFPB_Competences,TypeModuleFonctionnelPiedBulletin.MFPB_Appreciations,TypeModuleFonctionnelPiedBulletin.MFPB_Stages,TypeModuleFonctionnelPiedBulletin.MFPB_Legende
];case TypeReleveBulletin.AppreciationsBulletinParEleve:return[
TypeModuleFonctionnelPiedBulletin.MFPB_Appreciations_Annuelles,TypeModuleFonctionnelPiedBulletin.MFPB_Appreciations_Generales_Annuelles
];default:;}}
initPiedPage(aInstance,aParam){const lContexteBulletin=(aParam.typeContexteBulletin!==null)&&(aParam.typeContexteBulletin!==undefined)?aParam.typeContexteBulletin:this.getContexteBulletin(aParam);const lParam=$.extend(aParam,{typeContexteBulletin:lContexteBulletin});const lParametres={typeReleveBulletin:lParam.typeReleveBulletin,modeSaisie:lParam.avecSaisie,modeAffichage:_getModeAffichage.call(this,lParam),contexte:lContexteBulletin,modulesHorsOnglets:this.getModulesHorsOnglets(lParam),modulesOnglets:this.getModulesOnglets(lParam),avecContenuVide:lParam.avecSaisie,avecValidationAuto:lParam.avecValidationAuto,clbckValidationAutoSurEdition:lParam.clbckValidationAutoSurEdition};const lDefaultModule=_getModuleParDefaut.call(this,lParam);if(lDefaultModule!==null){$.extend(lParametres,{moduleParDefaut:lDefaultModule});}
aInstance.setParametres(lParametres);}
estAppreciationGenerale(aParam){if(!aParam.appreciation){return false;}
return this.estGenreApprGenerale(aParam.appreciation.Genre);}
estGenreApprGenerale(aGenreAppr){switch(aGenreAppr){case 0:return true;default:return false;}}
estAppreciationConseilDeClasse(aParam){if(!aParam.appreciation){return false;}
return this.estGenreApprConseilDeClasse(aParam.appreciation.Genre);}
estGenreApprConseilDeClasse(aGenreAppr){switch(aGenreAppr){case EGenreAppreciationGenerale.AG_Assiduite:case EGenreAppreciationGenerale.AG_Autonomie:case EGenreAppreciationGenerale.AG_Globale:case EGenreAppreciationGenerale.AG_Mention:return true;default:return false;}}
estMention(aParam){return(!!aParam.appreciation&&(aParam.appreciation.Genre===EGenreAppreciationGenerale.AG_Mention));}
estAppreciationCommentaire(aParam){if(!aParam.appreciation){return false;}
return this.estGenreApprCommentaire(aParam.appreciation.Genre);}
estGenreApprCommentaire(aGenreAppr){switch(aGenreAppr){case EGenreAppreciationGenerale.AG_Commentaire1:case EGenreAppreciationGenerale.AG_Commentaire2:case EGenreAppreciationGenerale.AG_Commentaire3:return true;default:return false;}}
estAppreciationCPE(aParam){if(!aParam.appreciation){return false;}
return this.estGenreApprCPE(aParam.appreciation.Genre);}
estGenreApprCPE(aGenreAppr){switch(aGenreAppr){case EGenreAppreciationGenerale.AG_CPE:return true;default:return false;}}
getTypeGenreAppreciationPdB(aParam){if(this.estGenreApprGenerale(aParam.genreAppr)){return aParam.typeReleveBulletin===TypeReleveBulletin.ReleveDeNotes?TypeGenreAppreciation.GA_Releve_Generale:TypeGenreAppreciation.GA_Bulletin_Generale;} else if((this.estGenreApprConseilDeClasse(aParam.genreAppr)||this.estGenreApprCommentaire(aParam.genreAppr))){return TypeGenreAppreciation.GA_Bulletin_Generale;} else if(this.estGenreApprCPE(aParam.genreAppr)){return TypeGenreAppreciation.GA_Bulletin_CPE;}
;return null;}
avecAppCPE(aParam){return(aParam.typeReleveBulletin===TypeReleveBulletin.BulletinNotes)||(aParam.typeReleveBulletin===TypeReleveBulletin.BulletinCompetences);}
avecAppConseilDeClasse(aParam){return(aParam.typeReleveBulletin===TypeReleveBulletin.BulletinNotes)||(aParam.typeReleveBulletin===TypeReleveBulletin.BulletinCompetences);}
avecAppCommentaire(aParam){return((aParam.typeReleveBulletin===TypeReleveBulletin.BulletinNotes)||(aParam.typeReleveBulletin===TypeReleveBulletin.BulletinCompetences))&&(aParam.contexte===TypeContexteBulletin.CB_Eleve);}
avecAppAG(aParam){return(aParam.typeReleveBulletin===TypeReleveBulletin.ReleveDeNotes);}
evenementOuvrirMentions(aParam){const lFenetre=aParam.instanceFenetre;if((lFenetre!==null)&&(lFenetre!==undefined)){lFenetre.SetDonnees(aParam.listeMentions);lFenetre.FocusSurPremierElement();}}
initialiserMentions(aParam){const lFenetre=aParam.instanceFenetre;lFenetre.setParametres_Mention(GTraductions.getValeur('Appreciations.Mentions'));lFenetre.setOptionsFenetre({titre:GTraductions.getValeur('Appreciations.SaisieMentions'),largeur:300,hauteur:300,listeBoutons:[GTraductions.getValeur('Annuler'),GTraductions.getValeur('Valider')]});}
evenementMention(aGenreBouton,aParam){const lElmtMention=aParam.instanceFenetre.getMentionSelectionnee();$.extend(aParam,{eltSelectionne:lElmtMention});this.traiterSelectionMention(aGenreBouton,aParam);}
traiterSelectionMention(aGenreBouton,aParam){switch(aGenreBouton){case(1):{this.validerDonneesMentionSurValider(aParam);const lInstanceListe=aParam.instanceListe;if(aParam.avecValidationAuto===true&&aParam.clbckValidationAutoSurEdition!==null&&aParam.clbckValidationAutoSurEdition!==undefined){const lParam={instanceListe:lInstanceListe,appreciation:aParam.appreciation};if(aParam.global===true){$.extend(lParam,{periode:aParam.article});}
aParam.clbckValidationAutoSurEdition(lParam);} else{lInstanceListe.Actualiser(true);this.moteurGrille.selectionCelluleSuivante({instanceListe:lInstanceListe,suivante:{orientationVerticale:false}});}
break;}
default:break;}}
validerDonneesMentionSurValider(aParam){aParam.article.SetEtat(EGenreEtat.Modification);const lAppreciation=aParam.appreciation;const lElmtSelectionne=aParam.eltSelectionne;if(lElmtSelectionne&&lElmtSelectionne.existeNumero()){lAppreciation.SetEtat(EGenreEtat.Modification);lAppreciation.SetLibelle(lElmtSelectionne.GetLibelle());} else{lAppreciation.SetEtat(EGenreEtat.Suppression);lAppreciation.Libelle='';}
lAppreciation.SetNumero(lElmtSelectionne.GetNumero());}
majAppreciationPdBParPeriode(aParam){_majAppreciation.call(this,$.extend(aParam,{parPeriode:true}));}
majAppreciationPdB(aParam){_majAppreciation.call(this,$.extend(aParam,{parPeriode:false}));}
clbckValidationAutoSurEditionPdB(aCtx,aParam){const lListe=aParam.instanceListe;const lEstCtxPiedBulletin=true;const lAppr=aParam.appreciation;aCtx.clbckSaisieAppreciation({instanceListe:lListe,estCtxPied:lEstCtxPiedBulletin,global:aParam.global,suivante:aParam.suivante},{classe:aCtx.classe,periode:aCtx.periode,eleve:aCtx.eleve,service:aCtx.service,appreciation:lAppr,typeGenreAppreciation:this.getTypeGenreAppreciationPdB({estCtxPied:lEstCtxPiedBulletin,eleve:aCtx.eleve,typeReleveBulletin:aCtx.typeReleveBulletin,genreAppr:lAppr?lAppr.Genre:null})});}}
function _getModuleParDefaut(aParam){const lAvecSaisie=aParam.avecSaisie;const lContexteBulletin=aParam.typeContexteBulletin;switch(aParam.typeReleveBulletin){case TypeReleveBulletin.BulletinNotes:if(lAvecSaisie){return(lContexteBulletin===TypeContexteBulletin.CB_Eleve)?TypeModuleFonctionnelPiedBulletin.MFPB_Orientations:TypeModuleFonctionnelPiedBulletin.MFPB_Appreciations;} else{return null;}
case TypeReleveBulletin.ReleveDeNotes:return lAvecSaisie?TypeModuleFonctionnelPiedBulletin.MFPB_Appreciations:null;case TypeReleveBulletin.BulletinCompetences:if(lAvecSaisie){return(lContexteBulletin===TypeContexteBulletin.CB_Eleve)?TypeModuleFonctionnelPiedBulletin.MFPB_Orientations:TypeModuleFonctionnelPiedBulletin.MFPB_Appreciations;} else{return(lContexteBulletin===TypeContexteBulletin.CB_Eleve)?null:TypeModuleFonctionnelPiedBulletin.MFPB_Appreciations;}
case TypeReleveBulletin.ReleveCompetences:;return lAvecSaisie?TypeModuleFonctionnelPiedBulletin.MFPB_Orientations:null;case TypeReleveBulletin.AppreciationsBulletinParEleve:return TypeModuleFonctionnelPiedBulletin.MFPB_Orientations;default:;}}
function _getModeAffichage(aParam){if(aParam.typeReleveBulletin===TypeReleveBulletin.AppreciationsBulletinParEleve){return TypeModeAffichagePiedBulletin.MAPB_Onglets;}
const lAvecSaisie=aParam.avecSaisie;if(GEtatUtilisateur.estModeAccessible()){return TypeModeAffichagePiedBulletin.MAPB_Accessible;} else{return lAvecSaisie?TypeModeAffichagePiedBulletin.MAPB_Onglets:TypeModeAffichagePiedBulletin.MAPB_Lineaire;}}
function _majAppreciation(aParam){const lDonnees=aParam.instanceListe.getDonneesListe().Donnees;const lIndice=lDonnees.getIndiceElementParFiltre(function(aElt){if(aParam.parPeriode){return aElt.GetNumero()===aParam.numeroPeriode;} else{return aElt.GetGenre()===aParam.rangAppr;}}.bind(this));const lLigne=lDonnees.GetElement(lIndice);const lListe=aParam.parPeriode?(aParam.global===true?lLigne.listeAppreciationsGenerales:lLigne.listeAppreciations):lLigne.ListeAppreciations;const lIndiceAppr=lListe.getIndiceElementParFiltre(function(aElt){return(aElt.GetGenre()===aParam.apprSaisie.GetGenre());}.bind(this));if(lIndiceAppr!== -1){const lAppr=lListe.GetElement(lIndiceAppr);const lApprSaisie=aParam.apprSaisie;lAppr.SetLibelle(lApprSaisie.GetLibelle());lAppr.SetNumero(lApprSaisie.GetNumero());lAppr.SetEtat(lApprSaisie.Etat);} else{}}
module.exports=ObjetMoteurPiedDeBulletin;},fn:"objetmoteurpieddebulletin.js"});;
IE.fModule({f:function(exports,require,module,global){const MethodesObjet=require('MethodesObjet.js');const ObjetElement=require('ObjetElement.js');const ObjetListeElements=require('ObjetListeElements.js');const GTraductions=require('ObjetTraduction.js');const ObjetTri=require('ObjetTri.js');const TypeGenreParcoursEducatif={GPE_ParcoursAvenir:0,GPE_ParcoursCitoyen:1,GPE_ParcoursArtistique:2,GPE_ParcoursSante:3,GPE_ParcoursExcellence:4};module.exports.TypeGenreParcoursEducatif=TypeGenreParcoursEducatif;TypeGenreParcoursEducatif.getLibelle=function(aGenre){if(GParametres.pourNouvelleCaledonie){switch(aGenre){case this.GPE_ParcoursAvenir:return GTraductions.getValeur('TypeGenreParcoursEducatif.libelle.Orientation');case this.GPE_ParcoursCitoyen:return GTraductions.getValeur('TypeGenreParcoursEducatif.libelle.Civique');case this.GPE_ParcoursArtistique:return GTraductions.getValeur('TypeGenreParcoursEducatif.libelle.Artistique');case this.GPE_ParcoursExcellence:return GTraductions.getValeur('TypeGenreParcoursEducatif.libelle.Excellence');default:;return'';}} else{switch(aGenre){case this.GPE_ParcoursAvenir:return GTraductions.getValeur('TypeGenreParcoursEducatif.libelle.Avenir');case this.GPE_ParcoursCitoyen:return GTraductions.getValeur('TypeGenreParcoursEducatif.libelle.Citoyen');case this.GPE_ParcoursArtistique:return GTraductions.getValeur('TypeGenreParcoursEducatif.libelle.Artistique');case this.GPE_ParcoursSante:return GTraductions.getValeur('TypeGenreParcoursEducatif.libelle.Sante');case this.GPE_ParcoursExcellence:return GTraductions.getValeur('TypeGenreParcoursEducatif.libelle.Excellence');default:;return'';}}};TypeGenreParcoursEducatif.toListe=function(){const lListe=new ObjetListeElements();for(const iGenre in TypeGenreParcoursEducatif){const lGenre=TypeGenreParcoursEducatif[iGenre];if(MethodesObjet.isNumber(lGenre)){if(lGenre===this.GPE_ParcoursExcellence&&!GParametres.GestionParcoursExcellence){continue;}
lListe.AddElement(new ObjetElement(TypeGenreParcoursEducatif.getLibelle(lGenre),0,lGenre));}}
lListe.setTri([ObjetTri.init('Genre')]);lListe.trier();return lListe;};},fn:"typegenreparcourseducatif.js"});;
IE.fModule({f:function(exports,require,module,global){const TypeRubriqueOrientation={RO_IntentionFamille:0,RO_AutreRecommandationConseil:1,RO_VoeuDefinitif:2,RO_AutrePropositionConseil:3,RO_DecisionRetenue:4,RO_OrientationEffective:5};module.exports.TypeRubriqueOrientation=TypeRubriqueOrientation;},fn:"typerubriqueorientation.js"});;
IE.fModule({f:function(exports,require,module,global){const TypeAvisConseil={taco_Aucun:0,taco_TresFavorable:1,taco_Favorable:2,taco_Reserve:3,taco_Defavorable:4};module.exports.TypeAvisConseil=TypeAvisConseil;const MethodesObjet=require('MethodesObjet.js');const GTraductions=require('ObjetTraduction.js');const TypeAvisConseilUtil={toListe(){const lArray=[];for(const lType in TypeAvisConseil){const lValeurType=TypeAvisConseil[lType];if(MethodesObjet.isNumber(lValeurType)){lArray.push(lValeurType);}}
return lArray;},getLibelleOuiNon(aTypeAvis){return GTraductions.getValeur('TypeAvisConseil.LibelleOuiNon.type_'+aTypeAvis);},getLibelle(aTypeAvis){return GTraductions.getValeur('TypeAvisConseil.Libelle.type_'+aTypeAvis);},getAbbreviation(aTypeAvis){return GTraductions.getValeur('TypeAvisConseil.Abbreviation.type_'+aTypeAvis);}};module.exports.TypeAvisConseilUtil=TypeAvisConseilUtil;},fn:"typeavisconseil.js"});;
IE.fModule({f:function(exports,require,module,global){const GChaine=require('GChaine.js');const{GDate}=require('ObjetDate.js');const ObjetTri=require('ObjetTri.js');const GTraductions=require('ObjetTraduction.js');const EGenreNiveauDAcquisition=require('Enumere_NiveauDAcquisition.js');const EGenreRessource=require('Enumere_Ressource.js');const ObjetIdentite_Mobile=require('ObjetIdentite_Mobile.js');const ObjetListeElements=require('ObjetListeElements.js');const ObjetMoteurPiedDeBulletin=require('ObjetMoteurPiedDeBulletin.js');const TypeModuleFonctionnelPiedBulletin=require('TypeModuleFonctionnelPiedBulletin.js');const TypeGenreParcoursEducatif=require('TypeGenreParcoursEducatif.js').TypeGenreParcoursEducatif;const TypeRubriqueOrientation=require('TypeRubriqueOrientation.js').TypeRubriqueOrientation;const{TypeAvisConseilUtil}=require('TypeAvisConseil.js');const UtilitaireBulletinEtReleve_Mobile=require('UtilitaireBulletinEtReleve_Mobile.js');require('espace/css/InterfacePageOrientation.css');class PiedDeBulletinMobile extends ObjetIdentite_Mobile{constructor(...aParams){super(...aParams);this.moteurPdB=new ObjetMoteurPiedDeBulletin();this.donneesContexte={typeContexteBulletin:0,avecSaisie:false,typeReleveBulletin:0};this.donneesPiedDeBulletin=null;this.donneesAbsences=null;}
ConstruireAffichage(){const lHtml=[];const lModulesHorsOnglet=this.moteurPdB.getModulesHorsOnglets(this.donneesContexte);for(let i=0;i<lModulesHorsOnglet.length;i++){lHtml.push('<div class="PDB_ModuleFonctionnel">',construireModuleFonctionnel.call(this,lModulesHorsOnglet[i]),'</div>');}
const lModulesOnglet=this.moteurPdB.getModulesOnglets(this.donneesContexte);for(let j=0;j<lModulesOnglet.length;j++){lHtml.push('<div class="PDB_ModuleFonctionnel">',construireModuleFonctionnel.call(this,lModulesOnglet[j]),'</div>');}
return lHtml.join('');}
setDonneesContexte(aDonnees){Object.assign(this.donneesContexte,aDonnees);}
setDonneesPiedDeBulletin(aDonnees,aDonneesAbsences){this.donneesPiedDeBulletin=aDonnees;this.donneesAbsences=aDonneesAbsences;}}
function construireModuleFonctionnel(aTypeModuleFonctionnel){const H=[];switch(aTypeModuleFonctionnel){case TypeModuleFonctionnelPiedBulletin.MFPB_VieScolaire:H.push(_construireVieScolaire(this.donneesPiedDeBulletin,this.donneesAbsences));break;case TypeModuleFonctionnelPiedBulletin.MFPB_Certificats:H.push(_construireAttestations(this.donneesPiedDeBulletin));break;case TypeModuleFonctionnelPiedBulletin.MFPB_Appreciations:H.push(_construireListeAppreciations(this.donneesPiedDeBulletin));break;case TypeModuleFonctionnelPiedBulletin.MFPB_ParcoursEducatif:H.push(_construireParcoursEducatif(this.donneesPiedDeBulletin));break;case TypeModuleFonctionnelPiedBulletin.MFPB_Competences:H.push(_construireBilanDeCycle(this.donneesPiedDeBulletin));break;case TypeModuleFonctionnelPiedBulletin.MFPB_Stages:H.push(_construireStages(this.donneesPiedDeBulletin));break;case TypeModuleFonctionnelPiedBulletin.MFPB_Orientations:H.push(_construireOrientations(this.donneesPiedDeBulletin));break;case TypeModuleFonctionnelPiedBulletin.MFPB_Legende:H.push(_construireLegende(this.donneesPiedDeBulletin));break;case TypeModuleFonctionnelPiedBulletin.MFPB_Projets:H.push(_construireProjets(this.donneesPiedDeBulletin));break;case TypeModuleFonctionnelPiedBulletin.MFPB_Credits:H.push(_construireCredits(this.donneesPiedDeBulletin));break;default:;break;}
return H.join('');}
function _construireVieScolaire(aDonneesPiedDeBulletin,aDonneesAbsences){const lHtml=[];lHtml.push('<div style="margin-top:10px;">',UtilitaireBulletinEtReleve_Mobile.composeVieScolaire(aDonneesAbsences),'</div>');return lHtml.join('');}
function _construireAttestations(aDonneesPiedDeBulletin){const lHtml=[];if(!!aDonneesPiedDeBulletin&&!!aDonneesPiedDeBulletin.ListeAttestationsEleve){lHtml.push('<div>','<ul style="display:table;">');aDonneesPiedDeBulletin.ListeAttestationsEleve.parcourir(function(aAttestation){lHtml.push('<li style="display:table-row;">','<span style="display:table-cell;">- ',aAttestation.GetLibelle(),'</span>','<div class="Italique GrandEspaceGauche">',aAttestation.delivree?GTraductions.getValeur('FicheEleve.delivree')+' '+GDate.FormatDate(aAttestation.date,'%JJ/%MM/%AAAA'):GTraductions.getValeur('FicheEleve.nonDelivree'),'</div>','</li>');});lHtml.push('</ul>','</div>');}
return lHtml.join('');}
function _construireListeAppreciations(aDonneesPiedDeBulletin){const lHtml=[];if(!!aDonneesPiedDeBulletin&&!!aDonneesPiedDeBulletin.ListeAppreciations){if(!!aDonneesPiedDeBulletin.ListeAppreciations.commentaires&&!!aDonneesPiedDeBulletin.ListeAppreciations.commentaires.GetNbrElements()){const lCommentaires=aDonneesPiedDeBulletin.ListeAppreciations.commentaires;for(let i=0,lNbrCommentaires=lCommentaires.GetNbrElements();i<lNbrCommentaires;i++){const lCommentaire=lCommentaires.GetElement(i);if(!!lCommentaire.ListeAppreciations&&!!lCommentaire.ListeAppreciations.GetNbrElements()&&!!lCommentaires.Intitule&&lCommentaires.Intitule!==""&&lCommentaire.ListeAppreciations.getTableauLibelles().join(', ')!==""){lCommentaire.ListeAppreciations.setTri([ObjetTri.init('Genre')]);lCommentaire.ListeAppreciations.trier();lHtml.push(UtilitaireBulletinEtReleve_Mobile.composeAppreciation({intituleDAppreciation:lCommentaires.Intitule,contenuDAppreciation:lCommentaire.ListeAppreciations.getTableauLibelles().join(', '),styleBlockIntitule:'color : #616161;',styleBlockContenu:'border:1px solid #616161; background-color: #F1F1F1;'}));}}}
if(!!aDonneesPiedDeBulletin.ListeAppreciations.conseilDeClasse&&!!aDonneesPiedDeBulletin.ListeAppreciations.conseilDeClasse.GetNbrElements()){const lAppreciationsConseilDeClasse=aDonneesPiedDeBulletin.ListeAppreciations.conseilDeClasse;for(let i=0,lNbrAppreciationConseilDeClasse=lAppreciationsConseilDeClasse.GetNbrElements();i<lNbrAppreciationConseilDeClasse;i++){const lAppConseilDeClass=lAppreciationsConseilDeClasse.GetElement(i);if(!!lAppConseilDeClass.ListeAppreciations&&!!lAppConseilDeClass.ListeAppreciations.GetNbrElements()&&!!lAppConseilDeClass.Intitule&&lAppConseilDeClass.Intitule!==""&&lAppConseilDeClass.ListeAppreciations.getTableauLibelles().join(', ')!==""){lAppConseilDeClass.ListeAppreciations.setTri([ObjetTri.init('Genre')]);lAppConseilDeClass.ListeAppreciations.trier();lHtml.push(UtilitaireBulletinEtReleve_Mobile.composeAppreciation({intituleDAppreciation:lAppConseilDeClass.Intitule,contenuDAppreciation:lAppConseilDeClass.ListeAppreciations.getTableauLibelles().join(', '),styleBlockIntitule:'color : #616161;',styleBlockContenu:'border:1px solid #616161; background-color: #F1F1F1;'}));}}}
if(!!aDonneesPiedDeBulletin.ListeAppreciations.cpe&&!!aDonneesPiedDeBulletin.ListeAppreciations.cpe.GetNbrElements()){const lAppreciationsCpe=aDonneesPiedDeBulletin.ListeAppreciations.cpe;for(let i=0,lNbrAppreciationsCpe=lAppreciationsCpe.GetNbrElements();i<lNbrAppreciationsCpe;i++){const lAppCpe=lAppreciationsCpe.GetElement(i);if(!!lAppCpe.ListeAppreciations&&!!lAppCpe.ListeAppreciations.GetNbrElements()&&!!lAppCpe.Intitule&&lAppCpe.Intitule!==""&&lAppCpe.ListeAppreciations.getTableauLibelles().join(', ')!==""){lAppCpe.ListeAppreciations.setTri([ObjetTri.init('Genre')]);lAppCpe.ListeAppreciations.trier();lHtml.push(UtilitaireBulletinEtReleve_Mobile.composeAppreciation({intituleDAppreciation:lAppCpe.Intitule,contenuDAppreciation:lAppCpe.ListeAppreciations.getTableauLibelles().join(', '),styleBlockIntitule:'color : #616161;',styleBlockContenu:'border:1px solid #616161; background-color: #F1F1F1;'}));}}}
if(!!aDonneesPiedDeBulletin.ListeAppreciations.general&&!!aDonneesPiedDeBulletin.ListeAppreciations.general.GetNbrElements()){const lAppreciationsGeneral=aDonneesPiedDeBulletin.ListeAppreciations.general;for(let i=0,lNbrAppreciationsGeneral=lAppreciationsGeneral.GetNbrElements();i<lNbrAppreciationsGeneral;i++){const lAppGeneral=lAppreciationsGeneral.GetElement(i);if(!!lAppGeneral.ListeAppreciations&&!!lAppGeneral.ListeAppreciations.GetNbrElements()&&!!lAppGeneral.Intitule&&lAppGeneral.Intitule!==""&&lAppGeneral.ListeAppreciations.getTableauLibelles().join(', ')!==""){lAppGeneral.ListeAppreciations.setTri([ObjetTri.init('Genre')]);lAppGeneral.ListeAppreciations.trier();lHtml.push(UtilitaireBulletinEtReleve_Mobile.composeAppreciation({intituleDAppreciation:lAppGeneral.Intitule,contenuDAppreciation:lAppGeneral.ListeAppreciations.getTableauLibelles().join(', '),styleBlockIntitule:'color : #616161;',styleBlockContenu:'border:1px solid #616161; background-color: #F1F1F1;'}));}}}}
return lHtml.join('');}
function _construireParcoursEducatif(aDonneesPiedDeBulletin){const lHtml=[];if(!!aDonneesPiedDeBulletin){const lListeGenresParcoursPublies=new ObjetListeElements();if(!!aDonneesPiedDeBulletin.listeGenreParcours){aDonneesPiedDeBulletin.listeGenreParcours.parcourir(function(D){if(!!D&&D.autorise){lListeGenresParcoursPublies.AddElement(D);}});}
const lListeParcoursEducatifs=new ObjetListeElements();if(!!aDonneesPiedDeBulletin.listeEvntsParcoursPeda){aDonneesPiedDeBulletin.listeEvntsParcoursPeda.parcourir(function(D){if(!!D&&!!D.Descr){lListeParcoursEducatifs.AddElement(D);}});}
if(lListeParcoursEducatifs.GetNbrElements()>0&&lListeGenresParcoursPublies.GetNbrElements()>0){lHtml.push('<div>');let lCumulGenreParcoursVide;lListeGenresParcoursPublies.parcourir(function(aGenreParcoursEducatif){lCumulGenreParcoursVide=false;lListeParcoursEducatifs.parcourir(function(aParcoursEducatif){if(aParcoursEducatif.GetGenre()===aGenreParcoursEducatif.GetGenre()){if(!lCumulGenreParcoursVide){lHtml.push('<div class="Espace Gras">',TypeGenreParcoursEducatif.getLibelle(aGenreParcoursEducatif.GetGenre()),'</div>');lCumulGenreParcoursVide=true;}
lHtml.push('<div class="Espace" style="background-color:#FFFFFF;">','<div class="PetitEspaceHaut" style="color: #9C9C9C;">',GDate.FormatDate(aParcoursEducatif.Date,' '+GTraductions.getValeur('Le')+' %JJ/%MM/%AA'),aParcoursEducatif.SuiviPar!==""?'&nbsp-&nbsp;'+GChaine.Format(GTraductions.getValeur('ParcoursPeda.colonne.suiviParS'),[aParcoursEducatif.SuiviPar]):'','</div>','<div class="Espace" style="border: 1px solid #c4c4c4;">',aParcoursEducatif.Descr,'</div>','</div>');}});});lHtml.push('</div>');}}
return lHtml.join('');}
function _construireBilanDeCycle(aDonneesPiedDeBulletin){const lHtml=[];if(!!aDonneesPiedDeBulletin&&!!aDonneesPiedDeBulletin.listePiliers&&aDonneesPiedDeBulletin.listePiliers.GetNbrElements()){lHtml.push('<div class="card" style="margin:0.5rem;">');lHtml.push('<div class="Espace Gras">'+GTraductions.getValeur('competences.BilansDeCycle')+'</div>');lHtml.push('<div class="card-content">');lHtml.push('<ul class="collection with-header">');aDonneesPiedDeBulletin.listePiliers.parcourir(function(aPilier){if(aPilier.GetGenre()===EGenreRessource.Pilier){const lNiveauDAcquisition=GParametres.listeNiveauxDAcquisitions.GetElementParElement(aPilier.niveauDAcquisition);lHtml.push('<li class="collection-item">','<div style="padding-right: 2.5rem;">',aPilier.GetLibelle(),'</div>','<div class="secondary-content">',EGenreNiveauDAcquisition.getImage(lNiveauDAcquisition),'</div>','</li>');} else{lHtml.push('<li class="collection-header" style="border-bottom:#d1d1d1 1px solid;">',aPilier.GetLibelle(),'</li>');}});lHtml.push('</ul>');lHtml.push('</div>');lHtml.push('</div>');}
return lHtml.join('');}
function _construireStages(aDonneesPiedDeBulletin){const lHtml=[];if(!!aDonneesPiedDeBulletin&&!!aDonneesPiedDeBulletin.listeStages){aDonneesPiedDeBulletin.listeStages.parcourir(function(aStage){aStage.listeDemandeurs=new ObjetListeElements();if(!!aStage.listeProfesseurs){aStage.listeDemandeurs.FusionnerListe(aStage.listeProfesseurs);}
if(aStage.listeMaitresDeStage){aStage.listeDemandeurs.FusionnerListe(aStage.listeMaitresDeStage);}
const lExisteDemandeurs=(!!aStage.listeDemandeurs&&aStage.listeDemandeurs.GetNbrElements()>0);lHtml.push('<div class="notes-data-conteneur">');if(!!aStage.session){lHtml.push('<div class="',(lExisteDemandeurs?' grey-text text-darken-2':''),'">',aStage.session,'</div>');}
const lLibelleStage=[aStage.GetLibelle()];if(!!aStage.dateInterruption){lLibelleStage.push(' - ',GTraductions.getValeur('stage.InterrompuLe'),' ',GDate.FormatDate(aStage.dateInterruption,'%JJ/%MM/%AAAA'));}
lHtml.push('<div class="',(lExisteDemandeurs?' grey-text text-darken-2':''),'">',lLibelleStage.join(''),'</div>');if(lExisteDemandeurs){let existeAppreciations=false;for(let i=0,lNbrDemandeur=aStage.listeDemandeurs.GetNbrElements();i<lNbrDemandeur;i++){const lDemandeur=aStage.listeDemandeurs.GetElement(i);if((!!lDemandeur.GetLibelle()||!!lDemandeur.appreciation)&&!existeAppreciations){lHtml.push('<div class="notes-data-conteneur encadre">');lHtml.push('<ul class="browser-default">');existeAppreciations=true;}
if(!!lDemandeur.GetLibelle()||!!lDemandeur.appreciation){lHtml.push('<li>');lHtml.push('<div>',lDemandeur.GetLibelle(),'</div>');lHtml.push('<div class="Gras">',lDemandeur.appreciation,'</div>');lHtml.push('</li>');}
if(i===aStage.listeDemandeurs.GetNbrElements()-1&&!!existeAppreciations){lHtml.push('</ul>');lHtml.push('</div>');}}}
lHtml.push('</div>');});}
return lHtml.join('');}
function _construireOrientations(aDonneesPiedDeBulletin){const lHtml=[];if(!!aDonneesPiedDeBulletin){const lObjetOrientation=aDonneesPiedDeBulletin.Orientation;if(!!lObjetOrientation&&!!lObjetOrientation.listeRubriques&&lObjetOrientation.listeRubriques.GetNbrElements()>0){lHtml.push('<div style="margin-top:10px;">');const construitStrLibelleVoeuOrientation=function(aVoeuOrientation){const lStrOrientation=[];if(!!aVoeuOrientation){if(!!aVoeuOrientation.orientation){lStrOrientation.push(aVoeuOrientation.orientation.GetLibelle());} else if(!!aVoeuOrientation.commentaire){lStrOrientation.push(aVoeuOrientation.commentaire);}
if(!!aVoeuOrientation.listeSpecialites){aVoeuOrientation.listeSpecialites.parcourir(function(aSpe){if(!!aSpe&&!!aSpe.code){lStrOrientation.push(aSpe.code);}});}}
return lStrOrientation.join(' - ');};lObjetOrientation.listeRubriques.parcourir(function(aRubrique){lHtml.push('<div>');if(aRubrique.GetGenre()===TypeRubriqueOrientation.RO_IntentionFamille||aRubrique.GetGenre()===TypeRubriqueOrientation.RO_VoeuDefinitif){if(!!aRubrique.listeVoeux&&aRubrique.listeVoeux.GetNbrElements()>0){let lTitreBloc;if(aRubrique.GetGenre()===TypeRubriqueOrientation.RO_IntentionFamille){lTitreBloc=GTraductions.getValeur('Orientation.Ressources.IntentionsEtAvisProvisoire');} else{lTitreBloc=GTraductions.getValeur('Orientation.Ressources.ChoixEtPropositions');}
lHtml.push('<div class="Gras" style="color : #616161;">',lTitreBloc,'</div>');aRubrique.listeVoeux.parcourir(function(aVoeu){lHtml.push('<div><span class="Gras">',construitStrLibelleVoeuOrientation(aVoeu),'</span>');if(!!aVoeu.avecStagePasserelleFamille){lHtml.push(' (',GTraductions.getValeur('Orientation.Ressources.DemandeStagePasserelle'),')');}
lHtml.push('</div>');if(!!aVoeu.reponseCC||!!aVoeu.motivation){lHtml.push('<div>');if(!!aVoeu.reponseCC){let lAvisLibelle=TypeAvisConseilUtil.getLibelle(aVoeu.reponseCC);if(aRubrique.GetGenre()===TypeRubriqueOrientation.RO_VoeuDefinitif){lAvisLibelle=TypeAvisConseilUtil.getLibelleOuiNon(aVoeu.reponseCC);}
lHtml.push('<span class="Bloc_TypeAvisConseil TypeAvis_',aVoeu.reponseCC,'" style="margin-right: 5px;">',(lAvisLibelle||''),'</span>');}
if(aVoeu.motivation){lHtml.push(aVoeu.motivation);}
if(aVoeu.avecStagePasserelleConseil){lHtml.push(' (',GTraductions.getValeur('Orientation.Ressources.StagePasserellePropose'),')');}
lHtml.push('</div>');}});}} else{const lPremierVoeu=(!!aRubrique.listeVoeux&&aRubrique.listeVoeux.GetNbrElements()>0)?aRubrique.listeVoeux.GetPremierElement():null;if(!!lPremierVoeu){lHtml.push('<b>',aRubrique.GetLibelle(),'</b> : ',construitStrLibelleVoeuOrientation(lPremierVoeu));if(!!lPremierVoeu.avecStagePasserelleConseil){lHtml.push(' - ',GTraductions.getValeur('Orientation.Ressources.StagePasserellePropose'));}}}
lHtml.push('</div>');});lHtml.push('</div>');}}
return lHtml.join('');}
function _construireLegende(aDonneesPiedDeBulletin){const lHtml=[];if(!!aDonneesPiedDeBulletin&&!!aDonneesPiedDeBulletin.legende){lHtml.push('<div class="Italique Espace">',aDonneesPiedDeBulletin.legende,'</div>');}
return lHtml.join('');}
function _construireProjets(aDonneesPiedDeBulletin){const lHtml=[];if(!!aDonneesPiedDeBulletin&&!!aDonneesPiedDeBulletin.ListeProjets){lHtml.push('<div class="Espace">');if(aDonneesPiedDeBulletin.ListeProjets.GetNbrElements()>0){lHtml.push(GTraductions.getValeur('BulletinEtReleve.Projets.Detail',[aDonneesPiedDeBulletin.ListeProjets.getTableauLibelles().join(', ')]));} else{lHtml.push(GTraductions.getValeur('BulletinEtReleve.Projets.Aucun'));}
lHtml.push('</div>');}
return lHtml.join('');}
function _construireCredits(aDonneesPiedDeBulletin){const lHtml=[];if(!!aDonneesPiedDeBulletin&&!!aDonneesPiedDeBulletin.listeCredits){aDonneesPiedDeBulletin.listeCredits.parcourir(function(D){if(!!D&&!!D.credits){lHtml.push('<div><span>',D.GetLibelle(),'</span> <span>',D.credits,'</span></div>');}});}
return lHtml.join('');}
module.exports=PiedDeBulletinMobile;},fn:"pieddebulletinmobile.js"});;
IE.fModule({f:function(exports,require,module,global){const EGenreImpression={Aucune:0,Normale:1,Format:2,Proportion:3,ProportionTempSaisieNotes:4,GenerationPDF:5};module.exports=EGenreImpression;},fn:"enumere_genreimpression.js"});;
IE.fModule({f:function(exports,require,module,global){const{ObjetRequeteSaisie}=require('ObjetRequeteJSON.js');const Requetes=require('CollectionRequetes.js');class ObjetRequeteValidationAutoPositionnement extends ObjetRequeteSaisie{constructor(...aParams){super(...aParams);}
lancerRequete(aParam){$.extend(this.JSON,aParam);if(!!aParam.listeEleves){this.JSON.listeEleves=aParam.listeEleves;this.JSON.listeEleves.setSerialisateurJSON({ignorerEtatsElements:true});}
return this.appelAsynchrone();}
actionApresRequete(){this.callbackReussite.appel();}}
Requetes.inscrire('ValidationAutoPositionnement',ObjetRequeteValidationAutoPositionnement);module.exports=ObjetRequeteValidationAutoPositionnement;},fn:"objetrequetevalidationautopositionnement.js"});;
IE.fModule({f:function(exports,require,module,global){const{ObjetRequeteSaisie}=require('ObjetRequeteJSON.js');const Requetes=require('CollectionRequetes.js');class ObjetRequeteCalculAutoNotesSelonCompetences extends ObjetRequeteSaisie{constructor(...aParams){super(...aParams);}
lancerRequete(aParam){$.extend(this.JSON,aParam);return this.appelAsynchrone();}
actionApresRequete(){this.callbackReussite.appel();}}
Requetes.inscrire('CalculAutoNotesSelonCompetences',ObjetRequeteCalculAutoNotesSelonCompetences);module.exports=ObjetRequeteCalculAutoNotesSelonCompetences;},fn:"objetrequetecalculautonotesseloncompetences.js"});;
IE.fModule({f:function(exports,require,module,global){const EGenreRessource=require('Enumere_Ressource.js');const TypeGenreValidationCompetence={tGVC_EvaluationEtItem:0,tGVC_Competence:1};module.exports.TypeGenreValidationCompetence=TypeGenreValidationCompetence;TypeGenreValidationCompetence.getGenreDeCompetence=function(aCompetence){if(!aCompetence){return this.tGVC_EvaluationEtItem;}
switch(aCompetence.GetGenre()){case EGenreRessource.Pilier:return this.tGVC_Competence;case EGenreRessource.ElementPilier:case EGenreRessource.Competence:case EGenreRessource.SousItem:case EGenreRessource.Evaluation:return this.tGVC_EvaluationEtItem;}
return this.tGVC_EvaluationEtItem;};},fn:"typegenrevalidationcompetence.js"});;
IE.fModule({f:function(exports,require,module,global){const TypeModeValidationAuto={tmva_PosSansNoteSelonDevoir:0,tmva_PosSansNoteSelonEvaluation:1,tmva_PosAvecNoteSelonEvaluation:2};module.exports.TypeModeValidationAuto=TypeModeValidationAuto;},fn:"typemodevalidationauto.js"});;
IE.fModule({f:function(exports,require,module,global){const TypePositionnement={POS_Moyenne:0,POS_Echelle:1,POS_ObjApprentissage:2};module.exports.TypePositionnement=TypePositionnement;const TypePositionnementUtil={getGenrePositionnementParDefaut(aGenre){return aGenre||TypePositionnement.POS_Echelle;}};module.exports.TypePositionnementUtil=TypePositionnementUtil;},fn:"typepositionnement.js"});;
IE.fModule({f:function(exports,require,module,global){const GTraductions=require('ObjetTraduction.js');const TypeModeCalculPositionnementService={tMCPS_Defaut:0,tMCPS_NDernieresEvals:1,tMCPS_NMeilleursEvals:2,tMCPS_PonderationAutoProgressive:3};module.exports.TypeModeCalculPositionnementService=TypeModeCalculPositionnementService;TypeModeCalculPositionnementService.getListe=function(){return[
TypeModeCalculPositionnementService.tMCPS_Defaut,TypeModeCalculPositionnementService.tMCPS_NDernieresEvals,TypeModeCalculPositionnementService.tMCPS_NMeilleursEvals,TypeModeCalculPositionnementService.tMCPS_PonderationAutoProgressive
];};function _getNomSimulation(aTypeModeCalcul){switch(aTypeModeCalcul){case TypeModeCalculPositionnementService.tMCPS_Defaut:return GTraductions.getValeur('TypeModeCalculPositionnementService.libelle.ModeCalculDefaut');case TypeModeCalculPositionnementService.tMCPS_NDernieresEvals:return GTraductions.getValeur('TypeModeCalculPositionnementService.libelle.ModeCalculNDernieresEvals');case TypeModeCalculPositionnementService.tMCPS_NMeilleursEvals:return GTraductions.getValeur('TypeModeCalculPositionnementService.libelle.ModeCalculNMeilleursEvals');case TypeModeCalculPositionnementService.tMCPS_PonderationAutoProgressive:return GTraductions.getValeur('TypeModeCalculPositionnementService.libelle.ModeCalculPonderationAutoProgressive');}
return'';}
function _getExplicationSimulation(aTypeModeCalcul){switch(aTypeModeCalcul){case TypeModeCalculPositionnementService.tMCPS_Defaut:return GTraductions.getValeur('TypeModeCalculPositionnementService.explication.ModeCalculDefaut');case TypeModeCalculPositionnementService.tMCPS_NDernieresEvals:return GTraductions.getValeur('TypeModeCalculPositionnementService.explication.PosCalculeAPartirDe')+'<input ie-model="inputNbDernieresEvals" ie-mask="/[^0-9]/i" maxlength="3" style="width: 25px; margin: 0 5px; text-align: center;" class="style-input"  />'+GTraductions.getValeur('TypeModeCalculPositionnementService.explication.ModeCalculNDernieresEvals');case TypeModeCalculPositionnementService.tMCPS_NMeilleursEvals:return GTraductions.getValeur('TypeModeCalculPositionnementService.explication.PosCalculeAPartirDe')+'<input ie-model="inputNbMeilleuresEvals" ie-mask="/[^0-9]/i" maxlength="3" style="width: 25px; margin: 0 5px; text-align: center;" class="style-input" />'+
GTraductions.getValeur('TypeModeCalculPositionnementService.explication.ModeCalculNMeilleursEvals');case TypeModeCalculPositionnementService.tMCPS_PonderationAutoProgressive:return GTraductions.getValeur('TypeModeCalculPositionnementService.explication.ModeCalculPonderationAutoProgressive');}}
TypeModeCalculPositionnementService.getLibelle=function(aTypeModeCalcul){const result=[];result.push(_getNomSimulation(aTypeModeCalcul));result.push(_getExplicationSimulation(aTypeModeCalcul));return result.join(' - ');};},fn:"typemodecalculpositionnementservice.js"});;
IE.fModule({f:function(exports,require,module,global){const MethodesObjet=require('MethodesObjet.js');const ObjetElement=require('ObjetElement.js');const ObjetListeElements=require('ObjetListeElements.js');const GTraductions=require('ObjetTraduction.js');const TypeNiveauEquivalenceCE={TNECE_Aucun:0,TNECE_Niveau1:1,TNECE_Niveau2:2,TNECE_Niveau3:3,TNECE_Niveau4:4,TNECE_Niveau5:5,TNECE_Niveau6:6,TNECE_Niveau7:7,TNECE_Niveau8:8};module.exports.TypeNiveauEquivalenceCE=TypeNiveauEquivalenceCE;TypeNiveauEquivalenceCE.getLibelle=function(aModeLVE,aLibelleLong,aTypeNiveau){var lCleTraduction;if(aModeLVE){if(aLibelleLong){lCleTraduction='TypeNiveauEquivalenceCE.LVE.long_niveau_'+aTypeNiveau;} else{lCleTraduction='TypeNiveauEquivalenceCE.LVE.niveau_'+aTypeNiveau;}} else{if(aLibelleLong){lCleTraduction='TypeNiveauEquivalenceCE.CN.long_niveau_'+aTypeNiveau;} else{lCleTraduction='TypeNiveauEquivalenceCE.CN.niveau_'+aTypeNiveau;}}
return GTraductions.getValeur(lCleTraduction);};TypeNiveauEquivalenceCE.getType=function(aModeLVE,aEstLibelleLong,aLibelle){var result=this.TNECE_Aucun;if(aLibelle===''){return result;} else{var lListeNiveaux=toListe(aModeLVE,aEstLibelleLong);lListeNiveaux.parcourir(function(D){if(D.GetLibelle()===aLibelle){result=D.GetGenre();return false;}});return result;}};TypeNiveauEquivalenceCE.getTypeParRaccourci=function(aModeLVE,aRaccourci){var result=null;if(!!aRaccourci){var lListeNiveaux=toListe(aModeLVE);lListeNiveaux.parcourir(function(D){if(D.GetGenre().toString()===aRaccourci){result=D;return false;}});}
return result;};function toListe(aModeLVE,aAvecLibelleLong){var lListe=new ObjetListeElements();for(var iRendu in TypeNiveauEquivalenceCE){var lElement,lTypeNiveau=TypeNiveauEquivalenceCE[iRendu];if(MethodesObjet.isNumber(lTypeNiveau)){lElement=new ObjetElement(TypeNiveauEquivalenceCE.getLibelle(aModeLVE,aAvecLibelleLong,lTypeNiveau),undefined,lTypeNiveau,lTypeNiveau);lListe.AddElement(lElement);}}
return lListe;}
TypeNiveauEquivalenceCE.getListeNiveauxEquivalenceLVE=function(aAvecLibelleLong){return toListe(true,aAvecLibelleLong);};TypeNiveauEquivalenceCE.getListeNiveauxEquivalenceCN=function(aAvecLibelleLong){return toListe(false,aAvecLibelleLong);};},fn:"typeniveauequivalencece.js"});;
IE.fModule({f:function(exports,require,module,global){const{ObjetRequeteSaisie}=require('ObjetRequeteJSON.js');const Requetes=require('CollectionRequetes.js');class ObjetRequeteValidationAutoCompetences extends ObjetRequeteSaisie{constructor(...aParams){super(...aParams);}
lancerRequete(aParam){this.JSON=aParam;if(this.JSON.listePiliers){this.JSON.listePiliers.setSerialisateurJSON({ignorerEtatsElements:true});}
if(this.JSON.listeEleves){this.JSON.listeEleves.setSerialisateurJSON({ignorerEtatsElements:true});}
return this.appelAsynchrone();}
actionApresRequete(){this.callbackReussite.appel();}}
Requetes.inscrire('ValidationAutoCompetences',ObjetRequeteValidationAutoCompetences);module.exports=ObjetRequeteValidationAutoCompetences;},fn:"objetrequetevalidationautocompetences.js"});;
IE.fModule({f:function(exports,require,module,global){const GTraductions=require('ObjetTraduction.js');const EGenreBoiteMessage=require('Enumere_BoiteMessage.js');const MethodesTableau=require('MethodesTableau.js');const EGenreOnglet=require('Enumere_Onglet.js');const EGenreRessource=require('Enumere_Ressource.js');const ObjetHint=require('objethint.js');const ObjetRequeteValidationAutoCompetences=require('ObjetRequeteValidationAutoCompetences.js');const TypeModeCalculPositionnementService=require('TypeModeCalculPositionnementService.js').TypeModeCalculPositionnementService;class ObjetMessageValidationAutoCompetence{constructor(){this.options={estCompetenceNumerique:false,estPourLaClasse:false,estValidationCECRLDomaine:false,estValidationCECRLLV:false,avecChoixCalcul:false,mrFiche:null};this.donnees={instance:null,palier:null,listePiliers:null,periode:null,service:null,listeEleves:null,modeCalcul:TypeModeCalculPositionnementService.tMCPS_Defaut,donneesModeCalcul:{nbDernieresEvaluations:5,nbMeilleuresEvals:5}};}
setOptions(aOptions){Object.assign(this.options,aOptions);}
setDonnees(aDonnees){Object.assign(this.donnees,aDonnees);}
afficherObjetMessage(){const lMessage=[];const lStrDetailExplication=getStrDetailExplication.call(this);if(!!lStrDetailExplication){lMessage.push('<div>',lStrDetailExplication,'</div>');const lOptionsLi=getTableauOptionsDetailCalcul.call(this);if(lOptionsLi.length>0){lMessage.push('<div class="GrandEspaceGauche PetitEspaceHaut">');lMessage.push('<ul>');for(let i=0;i<lOptionsLi.length;i++){lMessage.push('<li>',lOptionsLi[i],'</li>');}
lMessage.push('</ul>');lMessage.push('</div>');}}
const lStrDetailSuite=getStrDetailExplicationSuite.call(this);if(lStrDetailSuite.length>0){const lClasses=[];if(lMessage.length>0){lClasses.push('GrandEspaceHaut');}
lMessage.push('<div class="',lClasses.join(' '),'">',lStrDetailSuite,'</div>');}
if(this.options.avecChoixCalcul&&GParametres.general.SansValidationNivIntermediairesDsValidAuto){this.donnees.modeCalcul=GApplication.parametresUtilisateur.get('CalculPositionnementEleveParClasse.ModeCalcul');if(!this.donnees.modeCalcul&&this.donnees.modeCalcul!==0){this.donnees.modeCalcul=TypeModeCalculPositionnementService.tMCPS_Defaut;}
if(isNaN(GApplication.parametresUtilisateur.get('CalculPositionnementEleveParClasse.NDernieresEvaluations'))){GApplication.parametresUtilisateur.set('CalculPositionnementEleveParClasse.NDernieresEvaluations',1);}
this.donnees.donneesModeCalcul.nbDernieresEvaluations=GApplication.parametresUtilisateur.get('CalculPositionnementEleveParClasse.NDernieresEvaluations');this.donnees.donneesModeCalcul.nbMeilleuresEvals=GApplication.parametresUtilisateur.get('CalculPositionnementEleveParClasse.NMeilleuresEvaluations');lMessage.push('<div class="EspaceHaut">',GTraductions.getValeur('competences.fenetreValidationAuto.IndiquezModeCalcul'),'</div>');lMessage.push('<div class="EspaceGauche">');for(const sModeCalcul in TypeModeCalculPositionnementService.getListe()){const modeCalcul=parseInt(sModeCalcul);const lIdCb='cbModeCalcul_'+modeCalcul;lMessage.push('<div class="PetitEspaceHaut">','<ie-radio class="AlignementMilieuVertical" id="',lIdCb,'" ie-model="surRadioChoixModeCalcul(',modeCalcul,')"></ie-radio>','<label class="AlignementMilieuVertical PetitEspaceGauche" for="',lIdCb,'">',TypeModeCalculPositionnementService.getLibelle(modeCalcul,this.donnees.donneesModeCalcul),'</label>','</div>');}
lMessage.push('</div>');} else{lMessage.push('<div class="GrandEspaceHaut">',GTraductions.getValeur('competences.fenetreValidationAuto.QuestionContinuer'),'</div>');}
lMessage.push('<div class="EspaceHaut EspaceGauche10">','<ie-checkbox ie-model="cbRemplacerExistants">',getMessageRemplacerExistants.call(this),'</ie-checkbox>','</div>');let lJsonMrFiche=null;if(!!this.options.mrFiche){lJsonMrFiche=require('ObjetJSON.js').parse(this.options.mrFiche);if(!!lJsonMrFiche){lMessage.push('<div class="EspaceHaut flex-contain flex-center">','<span>',lJsonMrFiche.titre,'</span>','<ie-btnicon class="MargeGauche icon_question bt-activable" ie-model="surAfficherMrFiche" title="',lJsonMrFiche.titre,'"></ie-btnicon>','</div>');}}
const lThis=this;GApplication.getMessage().afficher({type:EGenreBoiteMessage.Confirmation,titre:getTitreObjetMessage.call(this),message:lMessage.join(''),callback:this.surConfirmationValidationAuto.bind(this),width:365,controleur:{surRadioChoixModeCalcul:{getValue:function(aModeCalcul){return lThis.donnees.modeCalcul===aModeCalcul;},setValue:function(aModeCalcul){lThis.donnees.modeCalcul=aModeCalcul;GApplication.parametresUtilisateur.set('CalculPositionnementEleveParClasse.ModeCalcul',aModeCalcul);}},cbRemplacerExistants:{getValue:function(){return GEtatUtilisateur.remplacerNiveauxDAcquisitions;},setValue:function(aValue){GEtatUtilisateur.remplacerNiveauxDAcquisitions=aValue;}},surAfficherMrFiche:{event(){if(lJsonMrFiche){ObjetHint.start(lJsonMrFiche.html,{sansDelai:true,couleurFond:GCouleur.blanc});}}},inputNbDernieresEvals:{getValue:function(){let lValue=GApplication.parametresUtilisateur.get('CalculPositionnementEleveParClasse.NDernieresEvaluations');if(!isNaN(lValue)&&!lThis.forcerNaNDernieresEvaluations){return GApplication.parametresUtilisateur.get('CalculPositionnementEleveParClasse.NDernieresEvaluations');}
return'';},setValue:function(aValue){let lValue=parseInt(aValue);if(GApplication.parametresUtilisateur.get('CalculPositionnementEleveParClasse.NDernieresEvaluations')!==lValue){if(isNaN(lValue)){lThis.forcerNaNDernieresEvaluations=true;GApplication.parametresUtilisateur.set('CalculPositionnementEleveParClasse.NDernieresEvaluations',1);} else{lThis.forcerNaNDernieresEvaluations=false;GApplication.parametresUtilisateur.set('CalculPositionnementEleveParClasse.NDernieresEvaluations',lValue);}}},getDisabled:function(){const lModeCalcul=GApplication.parametresUtilisateur.get('CalculPositionnementEleveParClasse.ModeCalcul');return lModeCalcul!==TypeModeCalculPositionnementService.tMCPS_NDernieresEvals;}},inputNbMeilleuresEvals:{getValue:function(){let lValue=GApplication.parametresUtilisateur.get('CalculPositionnementEleveParClasse.NMeilleuresEvaluations');if(!isNaN(lValue)&&!lThis.forcerNaNMeilleuresEvaluations){return GApplication.parametresUtilisateur.get('CalculPositionnementEleveParClasse.NMeilleuresEvaluations');}
return'';},setValue:function(aValue){let lValue=parseInt(aValue);if(GApplication.parametresUtilisateur.get('CalculPositionnementEleveParClasse.NMeilleuresEvaluations')!==lValue){if(isNaN(lValue)){lThis.forcerNaNMeilleuresEvaluations=true;GApplication.parametresUtilisateur.set('CalculPositionnementEleveParClasse.NMeilleuresEvaluations',1);} else{lThis.forcerNaNMeilleuresEvaluations=false;GApplication.parametresUtilisateur.set('CalculPositionnementEleveParClasse.NMeilleuresEvaluations',lValue);}}},getDisabled:function(){const lModeCalcul=GApplication.parametresUtilisateur.get('CalculPositionnementEleveParClasse.ModeCalcul');return lModeCalcul!==TypeModeCalculPositionnementService.tMCPS_NMeilleursEvals;}}}});}
surConfirmationValidationAuto(aGenreBouton){if(aGenreBouton===0){const lAvecService=MethodesTableau.existe(GEtatUtilisateur.getGenreOnglet(),[EGenreOnglet.BilanParDomaine,EGenreOnglet.ReleveEvaluationsParClasse]);const lAvecPeriode=MethodesTableau.existe(GEtatUtilisateur.getGenreOnglet(),[EGenreOnglet.BilanFinDeCycle,EGenreOnglet.ReleveEvaluationsParClasse]);const lPalier=!!this.donnees.palier?this.donnees.palier:GEtatUtilisateur.Navigation.GetRessource(EGenreRessource.Palier);const lListePiliers=!!this.donnees.listePiliers?this.donnees.listePiliers:GEtatUtilisateur.Navigation.getRessources(EGenreRessource.Pilier);const lListeEleves=!!this.donnees.listeEleves?this.donnees.listeEleves:GEtatUtilisateur.Navigation.getRessources(EGenreRessource.Eleve);let lService=null;if(lAvecService){lService=!!this.donnees.service?this.donnees.service:GEtatUtilisateur.Navigation.GetRessource(EGenreRessource.Service);}
let lPeriode=null;if(lAvecPeriode){lPeriode=this.donnees.periode;}
let lModeCalcul=null;let lNbDernieresEvals=null;let lNbMeilleuresEvals=null;if(this.options.avecChoixCalcul){lModeCalcul=this.donnees.modeCalcul;if(lModeCalcul!==TypeModeCalculPositionnementService.tMCPS_Defaut){lNbDernieresEvals=isNaN(GApplication.parametresUtilisateur.get('CalculPositionnementEleveParClasse.NDernieresEvaluations'))?1:GApplication.parametresUtilisateur.get('CalculPositionnementEleveParClasse.NDernieresEvaluations');lNbMeilleuresEvals=GApplication.parametresUtilisateur.get('CalculPositionnementEleveParClasse.NMeilleuresEvaluations');}}
const lInstancePage=this.donnees.instance;new ObjetRequeteValidationAutoCompetences(lInstancePage,lInstancePage.AfficherPage).lancerRequete({palier:lPalier,listePiliers:lListePiliers,service:lService,periode:lPeriode,listeEleves:lListeEleves,modeCalcul:lModeCalcul,nbDernEvalsPourCalcul:lNbDernieresEvals,nbMeilleuresEvalsPourCalcul:lNbMeilleuresEvals,remplacerNiveauxDAcquisitions:GEtatUtilisateur.remplacerNiveauxDAcquisitions});}}}
function _estMultiDomaines(){return!!this.donnees.listePiliers&&this.donnees.listePiliers.GetNbrElements()>1;}
function getTitreObjetMessage(){let lTitre;if(!!this.options.estCompetenceNumerique){lTitre=GTraductions.getValeur('competences.fenetreValidationAuto.titre.validationAutoCN');} else if(_estMultiDomaines.call(this)){if(!!this.options.estPourLaClasse){lTitre=GTraductions.getValeur('competences.fenetreValidationAuto.titre.validationAutoDesComposantesDesClasses');} else{lTitre=GTraductions.getValeur('competences.fenetreValidationAuto.titre.validationAutoDesComposantes');}}
if(!lTitre){lTitre=GTraductions.getValeur('competences.fenetreValidationAuto.titre.validationAuto');}
return lTitre;}
function getLibellesNiveauxAcquis(){const lLibelles=[];GParametres.listeNiveauxDAcquisitions.parcourir(function(aNiveauGlobal){if(!!aNiveauGlobal&&!!aNiveauGlobal.estAcqui){lLibelles.push(aNiveauGlobal.GetLibelle());}});return lLibelles.join(', ');}
function estPourPrimaire(){return GEtatUtilisateur.pourPrimaire();}
function getStrDetailExplication(){const H=[];if(this.options.estCompetenceNumerique||this.options.estValidationCECRLLV){if(!estPourPrimaire()){H.push(GTraductions.getValeur('competences.fenetreValidationAuto.ExplicationCalculCN'));}} else if(this.options.estValidationCECRLDomaine){H.push(GTraductions.getValeur('competences.fenetreValidationAuto.ExplicationCalculCECRLDomaine'));} else{H.push(GTraductions.getValeur('competences.fenetreValidationAuto.ExplicationCalcul'));}
return H.join('');}
function getTableauOptionsDetailCalcul(){const H=[];if(this.options.estCompetenceNumerique||this.options.estValidationCECRLLV){H.push(GTraductions.getValeur('competences.fenetreValidationAuto.OptionNivAcquisCN',[getLibellesNiveauxAcquis()]));} else if(!this.options.estValidationCECRLDomaine){if(GParametres.general.SansValidationNivIntermediairesDsValidAuto){H.push(GTraductions.getValeur('competences.fenetreValidationAuto.CalculParEvaluations'));} else{H.push(GTraductions.getValeur('competences.fenetreValidationAuto.CalculParNiveauxMaitrise'));}}
if(!this.donnees.periode||!this.donnees.periode.existeNumero()){if(!this.options.estValidationCECRLDomaine){if(!(this.options.estCompetenceNumerique&&estPourPrimaire())||this.options.estValidationCECRLLV){if(GParametres.general.NeComptabiliserQueEvalsAnneeScoDsValidAuto){H.push(GTraductions.getValeur('competences.fenetreValidationAuto.EvaluationsAnneeEnCours'));} else{H.push(GTraductions.getValeur('competences.fenetreValidationAuto.EvaluationsCycle'));}}}}
if(!this.options.estValidationCECRLDomaine&&!this.options.estValidationCECRLLV&&!this.options.estCompetenceNumerique){if(GParametres.general.PondererMatieresSelonLeurCoeffDsDomaine){H.push(GTraductions.getValeur('competences.fenetreValidationAuto.EnPonderantMatieres'));}}
return H;}
function getStrDetailExplicationSuite(){const H=[];if(this.options.estCompetenceNumerique||this.options.estValidationCECRLLV){H.push(GTraductions.getValeur('competences.fenetreValidationAuto.ExplicationCalculAuto3CN'));}
return H.join('');}
function getMessageRemplacerExistants(){const lMessageRemplacerExistants=[];if(this.options.estCompetenceNumerique||this.options.estValidationCECRLLV){lMessageRemplacerExistants.push(GTraductions.getValeur('competences.fenetreValidationAuto.RemplacerExistantsCN'));} else{lMessageRemplacerExistants.push(GTraductions.getValeur('competences.fenetreValidationAuto.RemplacerExistants'));}
return lMessageRemplacerExistants.join('');}
module.exports=ObjetMessageValidationAutoCompetence;},fn:"objetmessagevalidationautocompetence.js"});;
IE.fModule({f:function(exports,require,module,global){const MethodesObjet=require('MethodesObjet.js');const GChaine=require('GChaine.js');const GStyle=require('GStyle.js');const EGenreBoiteMessage=require('Enumere_BoiteMessage.js');const{GDate}=require('ObjetDate.js');const ObjetHint=require('objethint.js');const ObjetElement=require('ObjetElement.js');const ObjetListeElements=require('ObjetListeElements.js');const GTraductions=require('ObjetTraduction.js');const ObjetTri=require('ObjetTri.js');const TypeNote=require('TypeNote.js');const EGenreNiveauDAcquisition=require('Enumere_NiveauDAcquisition.js');const EGenreRessource=require('Enumere_Ressource.js');const EGenreTriElement=require('Enumere_TriElement.js');const ObjetRequeteValidationAutoPositionnement=require('ObjetRequeteValidationAutoPositionnement.js');const ObjetRequeteCalculAutoNotesSelonCompetences=require('ObjetRequeteCalculAutoNotesSelonCompetences.js');const TypeGenreValidationCompetence=require('TypeGenreValidationCompetence.js').TypeGenreValidationCompetence;const TypeModeValidationAuto=require('TypeModeValidationAuto.js').TypeModeValidationAuto;const TypePositionnement=require('TypePositionnement.js').TypePositionnement;const TypeModeCalculPositionnementService=require('TypeModeCalculPositionnementService.js').TypeModeCalculPositionnementService;const TypeNiveauEquivalenceCE=require('TypeNiveauEquivalenceCE.js').TypeNiveauEquivalenceCE;const ObjetMessageValidationAutoCompetence=require('ObjetMessageValidationAutoCompetence.js');function TUtilitaireCompetences(){}
TUtilitaireCompetences.construitInfoActiviteLangagiere=function(aParams={}){const lAvecLibelle=aParams.avecLibelle||false;const lAvecHint=!!aParams.avecHint;const lStr=GTraductions.getValeur('competences.LegendeCompetenceLangagiere');const H=[];H.push('<i style="color: ',GParametres.general.couleurActiviteLangagiere,';" class="icon_star"');if(lAvecHint){H.push(' title="',GChaine.toTitle(lStr),'"');}
H.push('></i>');if(lAvecLibelle){H.push('<span class="MargeGauche">',lStr,'</span>');}
return H.join('');};TUtilitaireCompetences.getListeNiveauxDAcquisitionsPourMenu=function(aParams){const lListeEvaluations=new ObjetListeElements();const lPourPositionnement=(aParams.genrePositionnement!==undefined&&aParams.genrePositionnement!==null);for(let I=0;I<GParametres.listeNiveauxDAcquisitions.GetNbrElements();I++){let lEvaluation=MethodesObjet.dupliquer(GParametres.listeNiveauxDAcquisitions.GetElement(I));lEvaluation.Position=EGenreNiveauDAcquisition.ordre().indexOf(lEvaluation.GetGenre());if(lEvaluation.actifPour.contains(aParams.genreChoixValidationCompetence)){if(aParams.avecDispense||lEvaluation.GetGenre()!==EGenreNiveauDAcquisition.Dispense){if(lPourPositionnement){lEvaluation.Libelle=EGenreNiveauDAcquisition.getLibellePositionnement({niveauDAcquisition:lEvaluation,genrePositionnement:aParams.genrePositionnement});lEvaluation.image=EGenreNiveauDAcquisition.getImagePositionnement({niveauDAcquisition:lEvaluation,genrePositionnement:aParams.genrePositionnement});} else{lEvaluation.Libelle=EGenreNiveauDAcquisition.getLibelle(lEvaluation);lEvaluation.image=EGenreNiveauDAcquisition.getImage(lEvaluation);}
let lRaccourci='';if(aParams.avecLibelleRaccourci&&!!lEvaluation){let lRaccourciTemp;if(!lPourPositionnement&&!!lEvaluation.raccourci){lRaccourciTemp=lEvaluation.raccourci;} else if(lPourPositionnement&&!!lEvaluation.raccourciPositionnement){lRaccourciTemp=lEvaluation.raccourciPositionnement;}
if(lRaccourciTemp&&lRaccourciTemp.toUpperCase){lRaccourci=lRaccourciTemp.toUpperCase();}}
if(lRaccourci){lEvaluation.tableauLibelles=[lEvaluation.Libelle,lRaccourci];}
lListeEvaluations.AddElement(lEvaluation);}}}
lListeEvaluations.trier();if(aParams.avecSelecteurNiveauCalcule){const lSelecteurNivCalcule=new ObjetElement();lSelecteurNivCalcule.Libelle=GTraductions.getValeur('competences.niveauCalculeEvals');lListeEvaluations.insererElement(lSelecteurNivCalcule,0);}
return lListeEvaluations;};TUtilitaireCompetences.getListeNiveauxDAcquisitionsPourCombo=function(aParams){const lListeEvaluations=new ObjetListeElements();GParametres.listeNiveauxDAcquisitions.parcourir(function(aNiveauGlobal){let lEvaluation=MethodesObjet.dupliquer(aNiveauGlobal);lEvaluation.Position=EGenreNiveauDAcquisition.ordre().indexOf(lEvaluation.GetGenre());if(!lEvaluation.existeNumero()&&aParams.sansLibelleAucun){lEvaluation.Position=0;lEvaluation.Libelle='';}
if(lEvaluation.actifPour.contains(aParams.genreChoixValidationCompetence)&&(!!aParams.avecDispense||lEvaluation.GetGenre()!==EGenreNiveauDAcquisition.Dispense)){if(lEvaluation.existeNumero()){lEvaluation.libelleHtml='<span style="margin: 0 3px; width:20px; text-align: center; display: inline-block;" >'+EGenreNiveauDAcquisition.getImage(lEvaluation)+'</span><span>'+lEvaluation.GetLibelle()+'</span>';}
lListeEvaluations.AddElement(lEvaluation);}});lListeEvaluations.trier();return lListeEvaluations;};TUtilitaireCompetences.getNombrePointsBrevet=function(aNiveauDAcquisition){const lNiveauDAcquisition=GParametres.listeNiveauxDAcquisitions.GetElementParElement(aNiveauDAcquisition);if(lNiveauDAcquisition){return EGenreNiveauDAcquisition.getNombrePointsBrevet({niveauDAcquisition:lNiveauDAcquisition});}
return 0;};TUtilitaireCompetences.composeJaugeChronologique=function(aParams){let result='';if(aParams.listeNiveaux){const H=[];let lSeparateur='';let lNiveau;const lEstModeAccessible=(GParametres.afficherAbbreviationNiveauDAcquisition||GEtatUtilisateur.estAvecCodeCompetences());if(lEstModeAccessible){lSeparateur=', ';aParams.listeNiveaux.parcourir(function(aNiveau){lNiveau=GParametres.listeNiveauxDAcquisitions.GetElementParGenre(aNiveau.GetGenre());if(lNiveau.abbreviation){H.push('<div class="InlineBlock">'+lNiveau.abbreviation+'</div>');}});} else{let lCouleur;let lContenuPastille;aParams.listeNiveaux.parcourir(function(aNiveau){lNiveau=GParametres.listeNiveauxDAcquisitions.GetElementParGenre(aNiveau.GetGenre());lCouleur=EGenreNiveauDAcquisition.getCouleur(lNiveau);lContenuPastille='&nbsp;';if(aParams.afficherValeurPourNonRempli&&!lNiveau.existeNumero()){lContenuPastille=!!lNiveau.abbreviation&&lNiveau.abbreviation.length>0?lNiveau.abbreviation.charAt(0):'&nbsp;';}
H.push('<div class="InlineBlock AlignementMilieu"',' style="width: 6px;','border: ',(aParams.pourImpression?'3px solid '+lCouleur+';':'1px solid black;'),'background-color:',lCouleur,';','color: black;','"','>',(aParams.pourImpression?'':lContenuPastille),'</div>');});}
result=H.join(lSeparateur);}
if(result.length>0&&!!aParams.hint){result='<div title="'+GChaine.toTitle(aParams.hint)+'" aria-label="'+GChaine.toTitle(aParams.hint)+'">'+result+'</div>';}
return result;};function _composeJaugeParNiveauxOuPastilles(aParams,aEstJaugeParPastilles){const H=[];const lSeparateur='';if(aParams.listeNiveaux){const lEstModeAccessible=(GParametres.afficherAbbreviationNiveauDAcquisition||GEtatUtilisateur.estAvecCodeCompetences());let lTotalNiveaux=0;const lInfosNiveauParNiveaux=[];let lCouleur,lImage,lNombre,lNiveauParam;const lListeGlobaleNiveaux=MethodesObjet.dupliquer(GParametres.listeNiveauxDAcquisitions);lListeGlobaleNiveaux.setTri([
ObjetTri.init('positionJauge')
]);lListeGlobaleNiveaux.trier();const _acceptNiveau=function(aNiveau){let result=false;if(aNiveau.existeNumero()){result=(!aParams.listeGenreNiveauxIgnores||aParams.listeGenreNiveauxIgnores.indexOf(aNiveau.GetGenre())=== -1);}
return result;};lListeGlobaleNiveaux.parcourir(function(aNiveauGlobal){if(_acceptNiveau(aNiveauGlobal)){lCouleur=EGenreNiveauDAcquisition.getCouleur(aNiveauGlobal);lImage=EGenreNiveauDAcquisition.getImage(aNiveauGlobal,{avecTitle:!aParams.hint});lNombre=0;lNiveauParam=aParams.listeNiveaux.GetElementParGenre(aNiveauGlobal.GetGenre());if(!!lNiveauParam&&lNiveauParam.nbr){lNombre+=lNiveauParam.nbr;}
lTotalNiveaux+=lNombre;lInfosNiveauParNiveaux.push({nombre:lNombre,couleur:lCouleur,image:lImage});}});if(lTotalNiveaux>0){H.push('<table style="width:100%" ',(aParams.hint?' title="'+GChaine.toTitle(aParams.hint)+'"':''),' border="0" cellspacing="0" cellpadding="0"><tr>');let lInfoNiveau,lWidthCellule;for(let i=0;i<lInfosNiveauParNiveaux.length;i++){lInfoNiveau=lInfosNiveauParNiveaux[i];if(lEstModeAccessible||aEstJaugeParPastilles){lWidthCellule=(100/lInfosNiveauParNiveaux.length);H.push('<td class="AlignementDroit EspaceDroit" width="',lWidthCellule,'%">');if(lInfoNiveau.nombre){H.push('<div class="InlineBlock" style="margin-right: 5px;">',lInfoNiveau.nombre,'</div><div class="InlineBlock">',lInfoNiveau.image,'</div></div>');} else{H.push('&nbsp;');}
H.push('</td>');} else{if(lInfoNiveau.nombre>0){lWidthCellule=((lInfoNiveau.nombre*100)/lTotalNiveaux);H.push('<td style="border:',(aParams.pourImpression?'3px solid '+lInfoNiveau.couleur+';':'1px solid black;'),'background-color:',lInfoNiveau.couleur,';"','width="',lWidthCellule,'%"','>',(aParams.pourImpression?'':'&nbsp;'),'</td>');}}}
H.push('</tr></table>');}}
return H.join(lSeparateur);}
TUtilitaireCompetences.composeJaugeParNiveaux=function(aParams){return _composeJaugeParNiveauxOuPastilles(aParams,false);};TUtilitaireCompetences.composeJaugeParPastilles=function(aParams){return _composeJaugeParNiveauxOuPastilles(aParams,true);};TUtilitaireCompetences.existeBarreNiveauxDAcquisitionsDePiliers=function(aListePiliers){if(!!aListePiliers){for(let i=0;i<aListePiliers.GetNbrElements();i++){let lPilier=aListePiliers.GetElement(i);if(lPilier){if(this.existeBarreNiveauxDAcquisitionsDeNiveaux(lPilier.listeNiveaux)){return true;}}}}
return false;};TUtilitaireCompetences.existeBarreNiveauxDAcquisitionsDeNiveaux=function(aListeNiveaux,aPourChronologique){if(aListeNiveaux){if(aPourChronologique===true){return aListeNiveaux.GetNbrElements()>0;}
for(let i=0;i<aListeNiveaux.GetNbrElements();i++){let lNiveau=aListeNiveaux.GetElement(i);if(lNiveau.nbr>0){return true;}}}
return false;};TUtilitaireCompetences.regroupeNiveauxDAcquisitions=function(aListeNiveauxDAcquisition){const result=new ObjetListeElements();if(aListeNiveauxDAcquisition){aListeNiveauxDAcquisition.parcourir(function(aNiveau){if(aNiveau.GetGenre()>=EGenreNiveauDAcquisition.Expert){const lValeurDuNiveau=(aNiveau.coeff!==undefined&&aNiveau.coeff!==null)?aNiveau.coeff:1;if(lValeurDuNiveau>0){let lNiveauDeListeRegroupee=result.GetElementParGenre(aNiveau.GetGenre());if(lNiveauDeListeRegroupee===undefined){lNiveauDeListeRegroupee=MethodesObjet.dupliquer(aNiveau);lNiveauDeListeRegroupee.nbr=lValeurDuNiveau;result.AddElement(lNiveauDeListeRegroupee);} else{lNiveauDeListeRegroupee.nbr+=lValeurDuNiveau;}}}});}
return result;};TUtilitaireCompetences.getDefaultHintBarreNiveauDAcquisitionParNiveauOuPastille=function(aListeNiveauxDAcquisitionRegroupes){const result=[];if(aListeNiveauxDAcquisitionRegroupes){const lListeGlobalNiveauxDAcquisitions=MethodesObjet.dupliquer(GParametres.listeNiveauxDAcquisitions);lListeGlobalNiveauxDAcquisitions.setTri([
ObjetTri.init('positionJauge')
]);lListeGlobalNiveauxDAcquisitions.trier();let niveau=null;lListeGlobalNiveauxDAcquisitions.parcourir(function(D){niveau=aListeNiveauxDAcquisitionRegroupes.GetElementParGenre(D.GetGenre());if(!!niveau){result.push(niveau.nbr+' '+niveau.GetLibelle());}});}
return result.length>0?result.join('\n'):'';};TUtilitaireCompetences.getDefaultHintBarreNiveauDAcquisitionChronologique=function(aListeNiveauxDAcquisition,aAvecAffichageZero){const result=[];if(aListeNiveauxDAcquisition){const lListeGlobalNiveauxDAcquisitions=MethodesObjet.dupliquer(GParametres.listeNiveauxDAcquisitions);lListeGlobalNiveauxDAcquisitions.setTri([
ObjetTri.init('positionJauge')
]);lListeGlobalNiveauxDAcquisitions.trier();lListeGlobalNiveauxDAcquisitions.parcourir(function(D){const lListe=aListeNiveauxDAcquisition.getListeElements(function(D2){return D2.GetGenre()===D.GetGenre();});if(aAvecAffichageZero||lListe.GetNbrElements()>0){result.push(lListe.GetNbrElements()+' '+D.GetLibelle());}});}
return result.length>0?result.join('\n'):'';};TUtilitaireCompetences.getMoyenneBarreNiveauDAcquisition=function(aListeNiveauxDAcquisitionRegroupes){let lTotalNotesSynthese=0,lNbDEvaluationsNotees=0,lTypeNotePonderation=null;if(aListeNiveauxDAcquisitionRegroupes){aListeNiveauxDAcquisitionRegroupes.parcourir(function(D){lTypeNotePonderation=EGenreNiveauDAcquisition.getPonderation(D);if(!!lTypeNotePonderation&&lTypeNotePonderation.estUneValeur()){lTotalNotesSynthese+=(D.nbr*lTypeNotePonderation.getValeur());lNbDEvaluationsNotees+=D.nbr;}});}
return new TypeNote(lNbDEvaluationsNotees>0?(lTotalNotesSynthese/lNbDEvaluationsNotees):0);};TUtilitaireCompetences.surBoutonValidationAuto=function(aParams){if(GEtatUtilisateur.EtatSaisie){GApplication.getMessage().afficher({type:EGenreBoiteMessage.Information,titre:GTraductions.getValeur('interface.SaisieNonValidee'),message:GTraductions.getValeur('interface.SaisieAValider')});} else{const lObjetMessage=new ObjetMessageValidationAutoCompetence();lObjetMessage.setOptions({estCompetenceNumerique:!!aParams.estCompetenceNumerique,estPourLaClasse:!!aParams.estPourLaClasse,estValidationCECRLDomaine:!!aParams.estValidationCECRLDomaine,estValidationCECRLLV:!!aParams.estValidationCECRLLV,avecChoixCalcul:!!aParams.avecChoixCalcul,mrFiche:aParams.mrFiche});lObjetMessage.setDonnees({instance:aParams.instance,palier:aParams.palier,listePiliers:aParams.listePiliers,periode:aParams.periode,service:aParams.service,listeEleves:aParams.listeEleves});lObjetMessage.afficherObjetMessage();}};TUtilitaireCompetences.surBoutonValidationAutoPositionnement=function(aParams){if(GEtatUtilisateur.EtatSaisie){GApplication.getMessage().afficher({type:EGenreBoiteMessage.Information,titre:GTraductions.getValeur('interface.SaisieNonValidee'),message:GTraductions.getValeur('interface.SaisieAValider')});} else{let lDetailPointCompetences;const lListeGlobalNiveauxDAcquisitions=MethodesObjet.dupliquer(GParametres.listeNiveauxDAcquisitions);if(!!lListeGlobalNiveauxDAcquisitions&&lListeGlobalNiveauxDAcquisitions.GetNbrElements()>0){lDetailPointCompetences=[];lListeGlobalNiveauxDAcquisitions.parcourir(function(D){if(!!D.ponderation&&D.ponderation.estUneValeur()){lDetailPointCompetences.push('<span class="InlineBlock AlignementDroit" style="'+GStyle.composeWidth(40)+'">'+
D.ponderation.getNoteEntier()+' '+GTraductions.getValeur('BulletinEtReleve.Pts')+'</span> : '+D.GetLibelle());}});}
const lMessageHTML=[];const lAvecMessageRestrictions=(!!aParams.messageRestrictionsSurCalculAuto&&aParams.messageRestrictionsSurCalculAuto.length>0);if(lAvecMessageRestrictions){lMessageHTML.push('<div class="Gras">',aParams.messageRestrictionsSurCalculAuto,'</div>');}
if(aParams.message){lMessageHTML.push('<div',(lAvecMessageRestrictions?' class="EspaceHaut"':''),'>',aParams.message,'</div>');} else{const lExplicationCalcul=(aParams.calculMultiServices?GTraductions.getValeur('competences.fenetreValidationAutoPositionnement.messageCalculTousServices'):GTraductions.getValeur('competences.fenetreValidationAutoPositionnement.message'));lMessageHTML.push('<div',(lAvecMessageRestrictions?' class="EspaceHaut"':''),'>',lExplicationCalcul,'</div>','<div class="EspaceHaut">','<div>',GTraductions.getValeur('competences.fenetreValidationAutoPositionnement.detailPoints'),'</div>',(!!lDetailPointCompetences?'<div class="EspaceGauche PetitEspaceHaut">'+
lDetailPointCompetences.join('</div><div class="EspaceGauche PetitEspaceHaut">')+'</div>':''),'</div>');}
if(!!aParams.borneDateDebut&&!!aParams.borneDateFin){lMessageHTML.push('<div class="EspaceHaut">',GTraductions.getValeur('competences.fenetreValidationAutoPositionnement.messageOptionnel',[GDate.FormatDate(aParams.borneDateDebut,'%JJ/%MM/%AAAA'),GDate.FormatDate(aParams.borneDateFin,'%JJ/%MM/%AAAA')]),'</div>');}
aParams.modeCalculPositionnement=GApplication.parametresUtilisateur.get('CalculPositionnementEleveParService.ModeCalcul');if(!aParams.modeCalculPositionnement&&aParams.modeCalculPositionnement!==0){aParams.modeCalculPositionnement=TypeModeCalculPositionnementService.tMCPS_Defaut;}
if(aParams.avecChoixCalcul){lMessageHTML.push('<div class="EspaceHaut">',GTraductions.getValeur('competences.fenetreValidationAutoPositionnement.indiquezModeCalculPositionnement'),'</div>');aParams.donneesModeCalcul={nbDernieresEvaluations:GApplication.parametresUtilisateur.get('CalculPositionnementEleveParService.NDernieresEvaluations'),nbMeilleuresEvals:GApplication.parametresUtilisateur.get('CalculPositionnementEleveParService.NMeilleuresEvaluations')};lMessageHTML.push('<div class="EspaceGauche">');for(const sModeCalcul in TypeModeCalculPositionnementService.getListe()){const modeCalcul=parseInt(sModeCalcul);const lIdCb='cbModeCalcul_'+modeCalcul;lMessageHTML.push('<div class="PetitEspaceHaut">','<ie-radio class="AlignementMilieuVertical" id="',lIdCb,'" ie-model="surRadioChoixModeCalcul(',modeCalcul,')"></ie-radio>','<label class="AlignementMilieuVertical PetitEspaceGauche" for="',lIdCb,'">',TypeModeCalculPositionnementService.getLibelle(modeCalcul,aParams.donneesModeCalcul),'</label>','</div>');}
lMessageHTML.push('</div>');} else{lMessageHTML.push('<div class="EspaceHaut">',GTraductions.getValeur('competences.fenetreValidationAutoPositionnement.voulezVousContinuer'),'</div>');}
let lLibelleRemplacerExistants;if(aParams.modeValidationAuto===TypeModeValidationAuto.tmva_PosAvecNoteSelonEvaluation){lLibelleRemplacerExistants=GTraductions.getValeur('competences.fenetreValidationAutoPositionnement.remplacerPositionnementsNote');} else{lLibelleRemplacerExistants=GTraductions.getValeur('competences.fenetreValidationAutoPositionnement.remplacerPositionnementsExistants');}
lMessageHTML.push('<div class="EspaceHaut10 EspaceGauche10">','<ie-checkbox ie-model="surCbRemplacerPosExistants">',lLibelleRemplacerExistants,'</ie-checkbox>','</div>');let lJsonMrFiche=null;if(!!aParams.modeValidationAuto){let lMrFiche;if(!!aParams.mrFiche){lMrFiche=aParams.mrFiche;} else{if(aParams.modeValidationAuto===TypeModeValidationAuto.tmva_PosAvecNoteSelonEvaluation){lMrFiche=GTraductions.getValeur('BulletinEtReleve.MFicheCalculNoteAutomatique');} else{lMrFiche=GTraductions.getValeur('BulletinEtReleve.MFichePostionnement');}}
lJsonMrFiche=require('ObjetJSON.js').parse(lMrFiche);lMessageHTML.push('<div class="flex-contain flex-center">','<span>',lJsonMrFiche.titre,'</span>','<ie-btnicon class="MargeGauche icon_question bt-activable" ie-model="surAfficherMrFiche" title="',lJsonMrFiche.titre,'"></ie-btnicon>','</div>');}
let lTitre;if(!!aParams.titre){lTitre=aParams.titre;} else{if(aParams.modeValidationAuto===TypeModeValidationAuto.tmva_PosAvecNoteSelonEvaluation){lTitre=GTraductions.getValeur('competences.fenetreValidationAutoPositionnement.titrePositionnementNote');} else{lTitre=GTraductions.getValeur('competences.fenetreValidationAutoPositionnement.titre');}}
GApplication.getMessage().afficher({type:EGenreBoiteMessage.Confirmation,width:420,titre:lTitre,message:lMessageHTML.join(''),callback:this.surConfirmationValidationAutoPositionnement.bind(this,aParams),controleur:{surRadioChoixModeCalcul:{getValue:function(aModeCalcul){return aParams.modeCalculPositionnement===aModeCalcul;},setValue:function(aModeCalcul){aParams.modeCalculPositionnement=aModeCalcul;GApplication.parametresUtilisateur.set('CalculPositionnementEleveParService.ModeCalcul',aParams.modeCalculPositionnement);}},surCbRemplacerPosExistants:{getValue:function(){return GEtatUtilisateur.remplacerNiveauxDAcquisitions;},setValue:function(aValue){GEtatUtilisateur.remplacerNiveauxDAcquisitions=aValue;}},surAfficherMrFiche:{event:function(){if(!!lJsonMrFiche){ObjetHint.start(lJsonMrFiche.html,{sansDelai:true,couleurFond:GCouleur.blanc});}}}}});}};TUtilitaireCompetences.surConfirmationValidationAutoPositionnement=function(aParams,aGenreBouton){if(aGenreBouton===0){let lService=!!aParams.calculMultiServices?null:GEtatUtilisateur.Navigation.GetRessource(EGenreRessource.Service);let lRessource=GEtatUtilisateur.Navigation.GetRessource(EGenreRessource.Classe);if(lRessource!==null&&lRessource!==undefined&&lRessource.GetNumero()=== -1&&lRessource.GetGenre()===EGenreRessource.Aucune){if(lService!==null&&lService!==undefined){let lGpeDuService=lService.groupe;if(lGpeDuService&&lGpeDuService.existeNumero()){lGpeDuService.Genre=EGenreRessource.Groupe;lRessource=lGpeDuService;} else{let lClasseDuService=lService.classe;if(lClasseDuService&&lClasseDuService.existeNumero()){lClasseDuService.Genre=EGenreRessource.Classe;lRessource=lClasseDuService;}}}}
const lParamsSaisie={periode:GEtatUtilisateur.Navigation.GetRessource(EGenreRessource.Periode),calculMultiServices:!!aParams.calculMultiServices,service:lService,ressource:lRessource,remplacerPosExistants:GEtatUtilisateur.remplacerNiveauxDAcquisitions,modeValidationAuto:aParams.modeValidationAuto,modeCalcul:aParams.modeCalculPositionnement,borneDateDebut:aParams.borneDateDebut,borneDateFin:aParams.borneDateFin};if(!!aParams.listeEleves){lParamsSaisie.listeEleves=aParams.listeEleves;}
if(aParams.modeCalculPositionnement!==TypeModeCalculPositionnementService.tMCPS_Defaut){let lNbDernEvalsPourCalcul=0;let lNbMeilleuresEvalsPourCalcul=0;if(!!aParams.donneesModeCalcul){lNbDernEvalsPourCalcul=aParams.donneesModeCalcul.nbDernieresEvaluations||0;lNbMeilleuresEvalsPourCalcul=aParams.donneesModeCalcul.nbMeilleuresEvals||0;}
lParamsSaisie.nbDernEvalsPourCalcul=lNbDernEvalsPourCalcul;lParamsSaisie.nbMeilleuresEvalsPourCalcul=lNbMeilleuresEvalsPourCalcul;}
const lCallbackReussite=(!!aParams.callback&&MethodesObjet.isFunction(aParams.callback)?aParams.callback:aParams.instance.AfficherPage);new ObjetRequeteValidationAutoPositionnement(aParams.instance,lCallbackReussite).lancerRequete(lParamsSaisie);}};TUtilitaireCompetences.surBoutonCalculNotesDevoir=function(aParams){if(GEtatUtilisateur.EtatSaisie){GApplication.getMessage().afficher({type:EGenreBoiteMessage.Information,titre:GTraductions.getValeur('interface.SaisieNonValidee'),message:GTraductions.getValeur('interface.SaisieAValider')});} else{const lMrFiche=GTraductions.getValeur('evaluations.MFicheCalculNote');const lJsonMrFiche=require('ObjetJSON.js').parse(lMrFiche);const lMessageHTML=[];lMessageHTML.push('<div>',GTraductions.getValeur('evaluations.confirmationAffectationNotes'),'</div>','<div class="EspaceHaut10 flex-contain flex-center">','<span>',lJsonMrFiche.titre,'</span>','<ie-btnicon class="MargeGauche icon_question bt-activable" ie-model="surAfficherMrFiche" title="',lJsonMrFiche.titre,'"></ie-btnicon>','</div>');GApplication.getMessage().afficher({type:EGenreBoiteMessage.Confirmation,titre:aParams.titre,message:lMessageHTML.join(''),callback:this._surConfirmationCalculNotesDevoir.bind(this,aParams),controleur:{surAfficherMrFiche:{event(){ObjetHint.start(lJsonMrFiche.html,{sansDelai:true,couleurFond:GCouleur.blanc});}}}});}};TUtilitaireCompetences._surConfirmationCalculNotesDevoir=function(aParams,aGenreBouton){if(aGenreBouton===0){const lParamsSaisie={evaluation:aParams.evaluation};const lCallbackReussite=(!!aParams.callback&&MethodesObjet.isFunction(aParams.callback)?aParams.callback:aParams.instance.AfficherPage);new ObjetRequeteCalculAutoNotesSelonCompetences(aParams.instance,lCallbackReussite).lancerRequete(lParamsSaisie);}};TUtilitaireCompetences.getNiveauAcqusitionDEventClavier=function(aEvent,aListeNiveaux,aPourPositionnement=false){if(!aListeNiveaux||!aEvent){return null;}
if(aEvent.ctrlKey||aEvent.altKey){return null;}
const lEventKey=!!aEvent.key&&!!aEvent.key.toLowerCase?aEvent.key.toLowerCase():'';let lGenre= -1;if(!!lEventKey){GParametres.listeNiveauxDAcquisitions.parcourir((D) =>{if((!aPourPositionnement&&D.raccourci===lEventKey)||(aPourPositionnement&&D.raccourciPositionnement===lEventKey)){lGenre=D.GetGenre();return false;}});}
if(lGenre>=0){return aListeNiveaux.GetElementParNumeroEtGenre(null,lGenre);}
return null;};function _initMenuContextuelNiveauEquivalence(aPourCN,aParametres){const lParametres=Object.assign({instance:null,menuContextuel:null,evaluationsEditables:true,callbackNiveau:null},aParametres);lParametres.menuContextuel.setOptionsMenuContextuel({largeurMin:120});if(MethodesObjet.isFunction(lParametres.callbackNiveau)){let lListe;if(aPourCN){lListe=TypeNiveauEquivalenceCE.getListeNiveauxEquivalenceCN(true);} else{lListe=TypeNiveauEquivalenceCE.getListeNiveauxEquivalenceLVE(true);}
if(!!lListe){lListe.parcourir(function(aElement){if(aElement.Existe()){lParametres.menuContextuel.add(aElement.GetLibelle(),lParametres.evaluationsEditables,function(){lParametres.callbackNiveau.call(lParametres.instance,aElement);});}});}}}
TUtilitaireCompetences.initMenuContextuelNiveauEquivalenceLVE=function(aParametres){_initMenuContextuelNiveauEquivalence(false,aParametres);};TUtilitaireCompetences.initMenuContextuelNiveauEquivalenceCN=function(aParametres){_initMenuContextuelNiveauEquivalence(true,aParametres);};TUtilitaireCompetences.initMenuContextuelNiveauAcquisition=function(aParametres){const lParametres=Object.assign({instance:null,menuContextuel:null,genreChoixValidationCompetence:-1,genrePositionnement:undefined,avecDispense:true,avecSupprimerLesEvaluations:false,evaluationsEditables:true,estObservationEditable:false,estDateEditable:false,callbackNiveau:null,callbackCommentaire:null,callbackDate:null,avecLibelleRaccourci:false,avecSousMenu:false,avecSelecteurNiveauCalcule:false},aParametres);lParametres.menuContextuel.setOptionsMenuContextuel({largeurMin:150,largeurColonneGauche:30,imageFormate:true});let lListe=null;if(MethodesObjet.isFunction(lParametres.callbackNiveau)){lListe=TUtilitaireCompetences.getListeNiveauxDAcquisitionsPourMenu({genreChoixValidationCompetence:lParametres.genreChoixValidationCompetence,avecDispense:lParametres.avecDispense,avecLibelleRaccourci:lParametres.avecLibelleRaccourci,genrePositionnement:lParametres.genrePositionnement,avecSelecteurNiveauCalcule:lParametres.avecSelecteurNiveauCalcule});if(lParametres.avecSousMenu){lParametres.menuContextuel.addSousMenu(GTraductions.getValeur('competences.ModifierNiveauAcquisition'),function(aInstanceSousMenu){lListe.parcourir(function(aElement){if(aElement.Existe()){aInstanceSousMenu.add(aElement.tableauLibelles||aElement.GetLibelle(),aElement.actif!==false&&lParametres.evaluationsEditables,function(){lParametres.callbackNiveau.call(lParametres.instance,aElement);},{image:aElement.image,largeurImage:aElement.largeurImage});}}.bind(lParametres.instance));}.bind(lParametres.instance));} else{lListe.parcourir(function(aElement){if(aElement.Existe()){lParametres.menuContextuel.add(aElement.tableauLibelles||aElement.GetLibelle(),aElement.actif!==false&&lParametres.evaluationsEditables,function(){lParametres.callbackNiveau.call(lParametres.instance,aElement);},{image:aElement.image,largeurImage:aElement.largeurImage});}}.bind(lParametres.instance));}}
if(MethodesObjet.isFunction(lParametres.callbackCommentaire)){lParametres.menuContextuel.add(GTraductions.getValeur('competences.AjouterCommentaire'),lParametres.estObservationEditable,function(){lParametres.callbackCommentaire.call(lParametres.instance);});}
if(MethodesObjet.isFunction(lParametres.callbackDate)){lParametres.menuContextuel.add(GTraductions.getValeur('competences.ModifierDate'),lParametres.estDateEditable,function(){lParametres.callbackDate.call(lParametres.instance);});}
if(lParametres.avecSupprimerLesEvaluations&&MethodesObjet.isFunction(lParametres.callbackNiveau)){const lNiveauSuppression=lListe?lListe.GetElementParNumeroEtGenre(null,EGenreNiveauDAcquisition.Utilisateur):null;if(!!lNiveauSuppression){lParametres.menuContextuel.add(GTraductions.getValeur('competences.SupprimerEvaluations'),lNiveauSuppression.actif!==false&&lParametres.evaluationsEditables,function(){lParametres.callbackNiveau.call(lParametres.instance,lNiveauSuppression);});}}};TUtilitaireCompetences.getLibellePositionnement=function(aParams){aParams.niveauDAcquisition=GParametres.listeNiveauxDAcquisitions.GetElementParElement(aParams.niveauDAcquisition);if(aParams.niveauDAcquisition){return EGenreNiveauDAcquisition.getLibellePositionnement(aParams);}};TUtilitaireCompetences.getImagePositionnement=function(aParams){aParams.niveauDAcquisition=GParametres.listeNiveauxDAcquisitions.GetElementParElement(aParams.niveauDAcquisition);if(aParams.niveauDAcquisition){return EGenreNiveauDAcquisition.getImagePositionnement(aParams);}};TUtilitaireCompetences.composeLegende=function(aParams){const lParams=Object.assign({avecTitreLegende:true,titreLegende:GTraductions.getValeur('competences.Legende'),avecListeCompetences:true,avecListePositionnements:false,genrePositionnement:TypePositionnement.POS_Echelle},aParams);const _composeLigneSimpleLegende=function(aTypeGenreValidation,aEstPourPositionnement,aAvecEspaceHaut){const H=[];let lLibelleNiveau,lImageNiveau;H.push('<div',(aAvecEspaceHaut===true?' class="EspaceHaut"':''),'>');GParametres.listeNiveauxDAcquisitions.parcourir(function(D){if(D.existeNumero()&&D.actifPour.contains(aTypeGenreValidation)){lLibelleNiveau=aEstPourPositionnement?EGenreNiveauDAcquisition.getLibellePositionnement({niveauDAcquisition:D,genrePositionnement:lParams.genrePositionnement}):D.GetLibelle();lImageNiveau=aEstPourPositionnement?EGenreNiveauDAcquisition.getImagePositionnement({niveauDAcquisition:D,genrePositionnement:lParams.genrePositionnement}):EGenreNiveauDAcquisition.getImage(D);H.push('<div class="InlineBlock PetitEspaceDroit AlignementMilieuVertical" style="padding-left: 15px;">',lImageNiveau,'</div><span class="AlignementMilieuVertical">',lLibelleNiveau,'</span>');}});H.push('</div>');return H.join('');};const result=[];if(lParams.avecListeCompetences||lParams.avecListePositionnements){result.push('<div class="EspaceHaut EspaceBas">','  <div class="Espace" style="',GStyle.composeCouleurBordure(GCouleur.bordure),GStyle.composeCouleurFond(GCouleur.fond),'">','    <table>','      <tr>');if(lParams.avecTitreLegende){result.push('  <td class="AlignementHaut Gras">',lParams.titreLegende,'</td>');}
result.push('    <td>');if(lParams.avecListeCompetences&&lParams.avecListePositionnements&&(lParams.genrePositionnement===TypePositionnement.POS_Echelle||lParams.genrePositionnement===TypePositionnement.POS_Moyenne)){let lOnAfficheLesDeuxImages,lImageCompetence,lImagePositionnement;result.push('<div>');GParametres.listeNiveauxDAcquisitions.parcourir(function(D){if(D.existeNumero()&&(D.actifPour.contains(TypeGenreValidationCompetence.tGVC_EvaluationEtItem)||D.actifPour.contains(TypeGenreValidationCompetence.tGVC_Competence))){lImageCompetence=EGenreNiveauDAcquisition.getImage(D);lImagePositionnement=EGenreNiveauDAcquisition.getImagePositionnement({niveauDAcquisition:D,genrePositionnement:lParams.genrePositionnement});lOnAfficheLesDeuxImages=(D.actifPour.contains(TypeGenreValidationCompetence.tGVC_EvaluationEtItem)&&D.actifPour.contains(TypeGenreValidationCompetence.tGVC_Competence)&&D.GetGenre()<=EGenreNiveauDAcquisition.NonAcquis);if(lOnAfficheLesDeuxImages){result.push('<div class="InlineBlock PetitEspaceDroit AlignementMilieuVertical" style="padding-left: 15px;">',lImageCompetence,'</div>');result.push('<div class="InlineBlock PetitEspaceDroit AlignementMilieuVertical" style="">',lImagePositionnement,'</div>');} else{result.push('<div class="InlineBlock PetitEspaceDroit AlignementMilieuVertical" style="padding-left: 15px;">',(D.actifPour.contains(TypeGenreValidationCompetence.tGVC_EvaluationEtItem)?lImageCompetence:lImagePositionnement),'</div>');}
result.push('<span class="AlignementMilieuVertical">',D.GetLibelle(),'</span>');}});result.push('</div>');} else{if(lParams.avecListeCompetences){result.push(_composeLigneSimpleLegende(TypeGenreValidationCompetence.tGVC_EvaluationEtItem,false));}
if(lParams.avecListePositionnements){result.push(_composeLigneSimpleLegende(TypeGenreValidationCompetence.tGVC_Competence,true,!!lParams.avecListeCompetences));}}
result.push('         </td>','       </tr>','     </table>','   </div>','</div>');}
return result.join('');};TUtilitaireCompetences.composeTitleEvaluation=function(aCompetence){const lTitleEvaluation=[];if(!!aCompetence){if(!!aCompetence.pilier){lTitleEvaluation.push('<b>',aCompetence.pilier.GetLibelle(),'</b>','<br/>');}
if(!!aCompetence.coefficient||aCompetence.coefficient===0){lTitleEvaluation.push(GTraductions.getValeur('competences.coefficient'),' <b>',aCompetence.coefficient,'</b>','<br/><br/>');}
if(!!aCompetence.nivEquivCELong){lTitleEvaluation.push('[',aCompetence.nivEquivCELong,'] ');}
lTitleEvaluation.push(aCompetence.GetLibelle());}
return lTitleEvaluation.join('');};TUtilitaireCompetences.composeHintEvaluationEleve=function(aParams){const lHintEvaluationEleve=[];if(!!aParams.libelleEleve){lHintEvaluationEleve.push('<b>',aParams.libelleEleve,'</b>');lHintEvaluationEleve.push('<br/><br/>');}
lHintEvaluationEleve.push(aParams.hintCompetence);if(!!aParams.niveauDAcquisition){if(GParametres.listeNiveauxDAcquisitions){const lNiveauDAcquisition=GParametres.listeNiveauxDAcquisitions.GetElementParNumero(aParams.niveauDAcquisition.GetNumero());if(lNiveauDAcquisition){const lLibelleNivAcqui=EGenreNiveauDAcquisition.getLibelle(lNiveauDAcquisition);lHintEvaluationEleve.push('<br/><br/>');lHintEvaluationEleve.push('<b><u>',GTraductions.getValeur('competences.evaluation'),'</u></b> : ',lLibelleNivAcqui);}}}
if(!!aParams.observation){lHintEvaluationEleve.push('<br/>',aParams.observation);}
return GChaine.toTitle(lHintEvaluationEleve.join(''));};TUtilitaireCompetences.afficherAideSaisieNiveauMaitrise=function(aParams){let lListeNiveauxRaccourcis;const lListeGlobaleNiveaux=MethodesObjet.dupliquer(GParametres.listeNiveauxDAcquisitions);if(!!lListeGlobaleNiveaux&&lListeGlobaleNiveaux.GetNbrElements()>0){lListeGlobaleNiveaux.setTri([
ObjetTri.init('positionJauge',EGenreTriElement.Decroissant)
]);lListeGlobaleNiveaux.trier();lListeNiveauxRaccourcis=[];lListeGlobaleNiveaux.parcourir(function(D){if(aParams.genreChoixValidationCompetence===undefined||D.actifPour.contains(aParams.genreChoixValidationCompetence)){const lRaccourci=(!!D.raccourci&&D.raccourci.toUpperCase?D.raccourci.toUpperCase():'');const lImage=EGenreNiveauDAcquisition.getImage(D);lListeNiveauxRaccourcis.push('<div class="PetitEspaceBas">','<span class="InlineBlock AlignementMilieu" style="',GStyle.composeWidth(30),'">',lRaccourci,' : </span>','<span class="InlineBlock AlignementMilieu" style="',GStyle.composeWidth(30),'">',(lImage||''),'</span>','<span>',D.GetLibelle(),'</span>','</div>');}});}
const lMessageHtml=[];lMessageHtml.push('<div>',GTraductions.getValeur('competences.MessageAideSaisieNivMaitrise'),'</div>');if(!!lListeNiveauxRaccourcis){lMessageHtml.push('<div class="EspaceHaut MargeGauche GrandEspaceHaut">',lListeNiveauxRaccourcis.join(''),'</div>');}
GApplication.getMessage().afficher({type:EGenreBoiteMessage.MrFiche,titre:GTraductions.getValeur('competences.TitreAideSaisieNivMaitrise'),width:420,message:lMessageHtml.join('')}).then(function(){if(!!aParams.callback){aParams.callback();}});};TUtilitaireCompetences.getListeNiveauxAcquis=function(){const lListeNiveauxAcquis=new ObjetListeElements();GParametres.listeNiveauxDAcquisitions.parcourir((aNiveau) =>{if(TUtilitaireCompetences.estNiveauAcqui(aNiveau)){lListeNiveauxAcquis.add(aNiveau);}});return lListeNiveauxAcquis;};TUtilitaireCompetences.getListeNiveauxNonAcquis=function(){const lListeNiveauxAcquis=new ObjetListeElements();GParametres.listeNiveauxDAcquisitions.parcourir((aNiveau) =>{if(TUtilitaireCompetences.estNiveauNonAcqui(aNiveau)){lListeNiveauxAcquis.add(aNiveau);}});return lListeNiveauxAcquis;};TUtilitaireCompetences.estNiveauAcqui=function(aNiveauAcquisition){let lEstUnNiveauAcquis=false;if(!!aNiveauAcquisition){const lNiveauGlobal=GParametres.listeNiveauxDAcquisitions.GetElementParGenre(aNiveauAcquisition.GetGenre());lEstUnNiveauAcquis=(!!lNiveauGlobal&&!!lNiveauGlobal.estAcqui);}
return lEstUnNiveauAcquis;};TUtilitaireCompetences.estNiveauNonAcqui=function(aNiveauAcquisition){let lEstUnNiveauAcquis=false;if(!!aNiveauAcquisition){const lNiveauGlobal=GParametres.listeNiveauxDAcquisitions.GetElementParGenre(aNiveauAcquisition.GetGenre());lEstUnNiveauAcquis=(!!lNiveauGlobal&&!!lNiveauGlobal.estNonAcqui);}
return lEstUnNiveauAcquis;};TUtilitaireCompetences.estNotantPourTxReussiteEvaluation=function(aNiveauAcquisition){let lEstUnNiveauAcquisNotant=false;if(!!aNiveauAcquisition){const lNiveauGlobal=GParametres.listeNiveauxDAcquisitions.GetElementParGenre(aNiveauAcquisition.GetGenre());lEstUnNiveauAcquisNotant=(!!lNiveauGlobal&&!!lNiveauGlobal.estNotantPourTxReussite);}
return lEstUnNiveauAcquisNotant;};module.exports=TUtilitaireCompetences;},fn:"utilitairecompetences.js"});;
IE.fModule({f:function(exports,require,module,global){const ObjetDonneesListe=require('ObjetDonneesListe.js');const GTraductions=require('ObjetTraduction.js');const EGenreNiveauDAcquisition=require('Enumere_NiveauDAcquisition.js');const TUtilitaireCompetences=require('UtilitaireCompetences.js');class DonneesListe_BarreNiveauxDAcquisitionsDePilier extends ObjetDonneesListe{constructor(aDonnees,aParams){super(aDonnees);this.parametres=Object.assign({afficheJaugesChronologiques:false},aParams);this.creerIndexUnique('Libelle');this.setOptions({avecEdition:false,avecSuppression:false});}
GetVisible(D){if(!this.parametres.afficheJaugesChronologiques){let lResult=false;if(!!D.listeNiveaux){D.listeNiveaux.parcourir(function(aNiveau){if(aNiveau.GetGenre()!==EGenreNiveauDAcquisition.Absent&&aNiveau.GetGenre()!==EGenreNiveauDAcquisition.NonEvalue){lResult=true;return false;}});}
return lResult;}
return true;}
AvecCreation(){return false;}
GetTypeValeur(aParams){switch(aParams.idColonne){case DonneesListe_BarreNiveauxDAcquisitionsDePilier.colonnes.jauge:return ObjetDonneesListe.ETypeCellule.Html;}
return ObjetDonneesListe.ETypeCellule.Texte;}
GetValeur(I,D,aParams){switch(aParams.idColonne){case DonneesListe_BarreNiveauxDAcquisitionsDePilier.colonnes.domaine:return aParams.article.GetLibelle()||GTraductions.getValeur('Fenetre_BarreNiveauxDacquisitions.SansLienAvecLeDomaineDuSocle');case DonneesListe_BarreNiveauxDAcquisitionsDePilier.colonnes.jauge:if(this.parametres.afficheJaugesChronologiques){return TUtilitaireCompetences.composeJaugeChronologique({listeNiveaux:aParams.article.listeNiveauxChronologiques,hint:TUtilitaireCompetences.getDefaultHintBarreNiveauDAcquisitionChronologique(aParams.article.listeNiveauxChronologiques)});} else{return TUtilitaireCompetences.composeJaugeParNiveaux({listeNiveaux:aParams.article.listeNiveaux,hint:TUtilitaireCompetences.getDefaultHintBarreNiveauDAcquisitionParNiveauOuPastille(aParams.article.listeNiveaux)});}}}}
DonneesListe_BarreNiveauxDAcquisitionsDePilier.colonnes={domaine:'DLBarreNiv_domaine',jauge:'DLBarreNiv_jauge'};module.exports=DonneesListe_BarreNiveauxDAcquisitionsDePilier;},fn:"donneesliste_barreniveauxdacquisitionsdepilier.js"});;
IE.fModule({f:function(exports,require,module,global){const MethodesTableau=require('MethodesTableau.js');const EGenreEvenementListe=require('Enumere_EvenementListe.js');const ObjetFenetre=require('ObjetFenetre.js');const ObjetListe=require('ObjetListe.js');class ObjetFenetre_Liste extends ObjetFenetre{constructor(...aParams){super(...aParams);this.modeActivationBtnValider={surModification:1,auMoinsUnEltSelectionne:2,toujoursActifs:3,autre:4};this.valeurFiltre=false;this.setOptionsFenetre({heightMax_mobile:true,modeActivationBtnValider:this.modeActivationBtnValider.surModification,avecVerificationLigneSelectionne:false});}
ConstruireInstances(){this.identListe=this.Add(ObjetListe,this.evenementSurListe,this.initialiserListe);}
verifierActivationBtnValider(){return false;}
getControleur(){return $.extend(true,super.getControleur(this),{fenetreBtn:{getDisabled:function(aBoutonRepeat){const lThis=this.instance;if(lThis.optionsFenetre.modeActivationBtnValider===lThis.modeActivationBtnValider.autre){return!lThis.verifierActivationBtnValider(aBoutonRepeat);}
if(lThis.optionsFenetre.modeActivationBtnValider===lThis.modeActivationBtnValider.toujoursActifs){return false;}
if((lThis.optionsFenetre.modeActivationBtnValider===lThis.modeActivationBtnValider.auMoinsUnEltSelectionne)&&(aBoutonRepeat.element.index===1)){let lDisabled=true;lThis.GetInstance(lThis.identListe).getListeArticles().parcourir(function(aArticle){if(aArticle.cmsActif){lDisabled=false;return false;}});return lDisabled;} else{return lThis.optionsFenetre.listeBoutonsInactifs[aBoutonRepeat.element.index]===true;}}},filtre:{visible:function(){return this.instance.paramsListe?!!this.instance.paramsListe.callbckFiltre:false;},check:{getValue:function(){return this.instance.valeurFiltre;},setValue:function(aValue){_evenementSurCB.call(this.instance,aValue);}},label:function(){return this.instance.paramsListe&&this.instance.paramsListe.labelFiltre?this.instance.paramsListe.labelFiltre:'';}}});}
initialiserListe(aInstance){const lOptions={listeCreations:this.paramsListe.creations!==null?this.paramsListe.creations:undefined,avecLigneCreation:this.paramsListe.avecLigneCreation!==null?this.paramsListe.avecLigneCreation:undefined,titreCreation:this.paramsListe.titreCreation!==null?this.paramsListe.titreCreation:undefined};if(Array.isArray(this.paramsListe.tailles)){lOptions.colonnes=[];this.paramsListe.tailles.forEach(function(aVal){lOptions.colonnes.push({taille:aVal});});}
if(Array.isArray(this.paramsListe.titres)){this.paramsListe.titres.forEach(function(aVal,aIndex){if(lOptions.colonnes[aIndex]){lOptions.colonnes[aIndex].titre=aVal;}});}
if(Array.isArray(this.paramsListe.hintTitres)){this.paramsListe.hintTitres.forEach(function(aVal,aIndex){if(lOptions.colonnes[aIndex]){lOptions.colonnes[aIndex].hint=aVal;}});}
aInstance.setOptionsListe(lOptions);if(this.paramsListe.colonnesCachees){aInstance.setOptionsListe({colonnesCachees:this.paramsListe.colonnesCachees});}
if(this.paramsListe.editable!==undefined){aInstance.setOptionsListe({nonEditable:!this.paramsListe.editable});}
if(this.paramsListe.optionsListe){aInstance.setOptionsListe(this.paramsListe.optionsListe);}}
SetDonnees(aObjetDonneesListe,aAvecValidation,aLigneSelectionnee,aParamsSetDonneesListe){this.Afficher();this.avecValidation=aAvecValidation;this.SetBoutonActif(1,false);if(this.avecValidation){this.setBoutonVisible(1,false);}
this.GetInstance(this.identListe).SetDonnees(aObjetDonneesListe,aLigneSelectionnee,aParamsSetDonneesListe);if(!!this.paramsListe&&this.paramsListe.optionsListe&&this.paramsListe.optionsListe.hauteurAdapteContenu){this.positionnerFenetre();}}
actualiserListe(aConserverSelection,aActivationBouton){this.GetInstance(this.identListe).Actualiser(aConserverSelection);if(aActivationBouton){this.SetBoutonActif(1,aActivationBouton);}}
annulerCreation(){this.GetInstance(this.identListe).annulerCreation();}
ComposeContenu(){const T=[];T.push('<table width="100%" height="100%" border="0" cellpadding="0" cellspacing="0">');T.push('<tr ie-display="filtre.visible"><td style="padding-bottom: 1rem;"><ie-checkbox ie-model="filtre.check" ie-html="filtre.label">','&nbsp;','</ie-checkbox></td></tr>');T.push('<tr><td id="'+this.GetNomInstance(this.identListe)+'" height="100%">&nbsp;</td></tr>');T.push('</table>');return T.join('');}
evenementSurListe(aParametres){switch(aParametres.genreEvenement){case EGenreEvenementListe.Selection:case EGenreEvenementListe.SelectionClick:if(this.optionsFenetre.modeActivationBtnValider!==this.modeActivationBtnValider.autre){this.SetBoutonActif(1,(aParametres.ligne!== -1)||!this.optionsFenetre.avecVerificationLigneSelectionne);}
if(this.avecValidation){this.SurValidation(1);}
break;case EGenreEvenementListe.SelectionDblClick:this.SurValidation(1);break;case EGenreEvenementListe.Suppression:if(this.optionsFenetre.modeActivationBtnValider!==this.modeActivationBtnValider.autre){this.SetBoutonActif(1,false);}
break;case EGenreEvenementListe.Creation:if(this.paramsListe.avecLigneCreation){if(this.paramsListe.callbckCreation){this.changementListe=true;return this.paramsListe.callbckCreation(aParametres.colonne,aParametres.ligne);}}
break;case EGenreEvenementListe.ApresCreation:if(this.optionsFenetre.modeActivationBtnValider!==this.modeActivationBtnValider.autre){this.SetBoutonActif(1,true);}
break;case EGenreEvenementListe.ApresEdition:this.SetBoutonActif(1,true);break;case EGenreEvenementListe.Edition:if(this.paramsListe.callbckEdition){this.changementListe=true;return this.paramsListe.callbckEdition(aParametres);}
break;case EGenreEvenementListe.ModificationCBLigne:this.SetBoutonActif(1,true);break;case EGenreEvenementListe.ApresSuppression:this.SetBoutonActif(1,true);break;}
if(MethodesTableau.existe(aParametres.genreEvenement,[EGenreEvenementListe.Creation,EGenreEvenementListe.Edition,EGenreEvenementListe.ApresEdition,EGenreEvenementListe.Suppression,EGenreEvenementListe.ApresSuppression,EGenreEvenementListe.ModificationCBLigne])){this.changementListe=true;}}
SurValidation(aNumeroBouton){const lMaSelection=this.GetInstance(this.identListe).GetSelection();this.Fermer();if(this.optionsFenetre.callback){this.optionsFenetre.callback(aNumeroBouton,lMaSelection,this.changementListe);}
this.callback.appel(aNumeroBouton,lMaSelection,this.changementListe);if(this.Pere&&this.Pere.$refreshSelf){this.Pere.$refreshSelf();}}}
function _evenementSurCB(aValue){this.valeurFiltre=!!aValue;if(this.paramsListe.callbckFiltre){this.paramsListe.callbckFiltre(this.valeurFiltre,this);}}
module.exports=ObjetFenetre_Liste;},fn:"objetfenetre_liste.js"});;
IE.fModule({f:function(exports,require,module,global){const ObjetDonneesListe=require('ObjetDonneesListe.js');class DonneesListe_Simple extends ObjetDonneesListe{constructor(aDonnees,aOptions){super(aDonnees);const lOptionsParDefaut={avecSelection:true,avecEdition:false,avecMenuContextuel:true,avecSuppression:false,avecEvnt_Selection:true,avecEvnt_Edition:false,avecEvnt_Creation:false,avecEvnt_ApresSuppression:false,avecTri:true};this.setOptions($.extend(lOptionsParDefaut,aOptions))
;}
GetCouleurCellule(){return ObjetDonneesListe.ECouleurCellule.Blanc;}}
module.exports=DonneesListe_Simple;},fn:"donneesliste_simple.js"});;
IE.fModule({f:function(exports,require,module,global){const GTraductions=require('ObjetTraduction.js');const{TypeDroits}=require('ObjetDroitsPN.js');const EGenreImpression=require('Enumere_Genreimpression.js');const TypeHttpGenerationPDFSco=require('TypeHttpGenerationPDFSco.js').TypeHttpGenerationPDFSco;const ObjetListeElements=require('ObjetListeElements.js');const GChaine=require('GChaine.js');const EGenreNiveauDAcquisition=require('Enumere_NiveauDAcquisition.js');const TypeGenreAppreciation=require('TypeGenreAppreciation.js').TypeGenreAppreciation;const ObjetElement=require('ObjetElement.js');const GHtml=require('GHtml.js');const EGenreRessource=require('Enumere_Ressource.js');const TypeReleveBulletin=require('TypeReleveBulletin.js');const ObjetMoteurPiedDeBulletin=require('ObjetMoteurPiedDeBulletin.js');const TypeFichierExterneHttpSco=require('TypeFichierExterneHttpSco.js').TypeFichierExterneHttpSco;const EGenreDocumentJoint=require('Enumere_DocumentJoint.js');const{GDate}=require('ObjetDate.js');const Requetes=require('CollectionRequetes.js');const{ObjetRequeteSaisie,EGenreReponseSaisie}=require('ObjetRequeteJSON.js');const ObjetMoteurGrilleSaisie=require('ObjetMoteurGrilleSaisie.js');const TUtilitaireCompetences=require('UtilitaireCompetences.js');const DonneesListe_BarreNiveauxDAcquisitionsDePilier=require('DonneesListe_BarreNiveauxDAcquisitionsDePilier.js');const TypeModeValidationAuto=require('TypeModeValidationAuto.js').TypeModeValidationAuto;const EGenreBoiteMessage=require('Enumere_BoiteMessage.js');const EGenreAction=require('Enumere_Action.js');const ObjetMenuContextuel=require('ObjetMenuContextuel.js');const EGenreEvolution=require('Enumere_Evolution.js');const ObjetFenetre=require('ObjetFenetre.js');const ObjetFenetre_Liste=require('ObjetFenetre_Liste.js');const DonneesListe_Simple=require('DonneesListe_Simple.js');const EGenreEtat=require('Enumere_Etat.js');const tag=require('tag.js');const{TypePositionnementUtil}=require('TypePositionnement.js');Requetes.inscrire('SaisieAppreciation',ObjetRequeteSaisie);Requetes.inscrire('SaisieNoteLSU',ObjetRequeteSaisie);Requetes.inscrire('SaisieECTS',ObjetRequeteSaisie);Requetes.inscrire('SaisiePositionnement',ObjetRequeteSaisie);Requetes.inscrire('SaisieEvolution',ObjetRequeteSaisie);Requetes.inscrire('SaisieNotePropDelib',ObjetRequeteSaisie);Requetes.inscrire('SaisieEltsPgme',ObjetRequeteSaisie);Requetes.inscrire('SaisieAvisProfesseur',ObjetRequeteSaisie);Requetes.inscrire('SaisieAvisProfesseurParcoursup',ObjetRequeteSaisie);Requetes.inscrire('SaisieParamSynchroAppClasse',ObjetRequeteSaisie);Requetes.inscrire('SaisieMoyNR',ObjetRequeteSaisie);class ObjetMoteurReleveBulletin{constructor(){this.moteurPdB=new ObjetMoteurPiedDeBulletin();this.moteurGrille=new ObjetMoteurGrilleSaisie();}
getGenreImpression(aParam){if(!GApplication.droits.get(TypeDroits.autoriserImpression)){return EGenreImpression.Aucune;}
switch(aParam.typeReleveBulletin){case TypeReleveBulletin.ReleveDeNotes:case TypeReleveBulletin.BulletinNotes:case TypeReleveBulletin.AppreciationsBulletinProfesseur:case TypeReleveBulletin.AppreciationsReleveProfesseur:case TypeReleveBulletin.AvisProfesseur:return EGenreImpression.GenerationPDF;case TypeReleveBulletin.AvisParcoursup:return EGenreImpression.Aucune;default:;return EGenreImpression.Format;}}
getGenreGenerationPdf(aParam){switch(aParam.typeReleveBulletin){case TypeReleveBulletin.BulletinNotes:return TypeHttpGenerationPDFSco.Bulletin;case TypeReleveBulletin.AppreciationsBulletinProfesseur:case TypeReleveBulletin.AppreciationsReleveProfesseur:case TypeReleveBulletin.AvisProfesseur:return TypeHttpGenerationPDFSco.AppreciationsProf;default:;}}
_getListeDonneesLineaire(aListeElements,aParam){let lService,lSousService,lCmpActifs,lIndicePremier,lIndiceDernier,lIndicePremierActif,lIndiceDernierActif,J,I,lNbr;const lListe=new ObjetListeElements();let lNbrMaxTotDevoirs=0;for(I=0,lNbr=aListeElements.GetNbrElements();I<lNbr;I++){lService=aListeElements.GetElement(I);lService.estService=lService.estSousService||lService.estSurMatiere?false:true;lService.nbSousServicesTotal=!!lService.ListeElements?lService.ListeElements.GetNbrElements():0;lService.regroupement=lService.regroupement===0?0:lService.SurMatiere.GetNumero();lService.avecAppreciationParSousService=aParam.typeReleveBulletin===TypeReleveBulletin.ReleveDeNotes?aParam.affichage.AvecAppreciationParSousService:lService.AvecAppreciationParSousService;if((lService.nbSousServicesTotal>0)||(aParam.typeReleveBulletin===TypeReleveBulletin.BulletinNotes)){lCmpActifs=0;lIndicePremier=null;lIndiceDernier=0;lIndicePremierActif=null;lIndiceDernierActif=0;for(J=0;J<lService.nbSousServicesTotal;J++){if(lIndicePremier===null||lIndicePremier===undefined){lIndicePremier=J;}
if(lService.ListeElements.GetElement(J).Actif){if(lIndicePremierActif===null||lIndicePremierActif===undefined){lIndicePremierActif=J;}
lCmpActifs++;lIndiceDernierActif=J;}
lIndiceDernier=J;}
lService.nbSousServicesActifs=lCmpActifs;if(aParam.typeReleveBulletin===TypeReleveBulletin.BulletinNotes){lListe.AddElement(lService);}
for(J=0;J<lService.nbSousServicesTotal;J++){lSousService=lService.ListeElements.GetElement(J);if(lSousService.ListeDevoirs&&(lSousService.ListeDevoirs.GetNbrElements()>lNbrMaxTotDevoirs)){lNbrMaxTotDevoirs=lSousService.ListeDevoirs?lSousService.ListeDevoirs.GetNbrElements():0;}
lSousService.estService=false;lSousService.estPremier=(J===lIndicePremier);lSousService.estDernier=(J===lIndiceDernier);lSousService.estPremierActif=(J===lIndicePremierActif);lSousService.estDernierActif=(J===lIndiceDernierActif);lSousService.regroupement=lService.regroupement;lSousService.avecAppreciationParSousService=lService.avecAppreciationParSousService;lSousService.service=lService;lListe.AddElement(lSousService);}} else{if(lService.ListeDevoirs&&(lService.ListeDevoirs.GetNbrElements()>lNbrMaxTotDevoirs)){lNbrMaxTotDevoirs=lService.ListeDevoirs?lService.ListeDevoirs.GetNbrElements():0;}
lListe.AddElement(lService);}}
lListe.nbrMaxTotDevoirs=lNbrMaxTotDevoirs;return lListe;}
getApprDeService(aParam){switch(aParam.typeReleveBulletin){case TypeReleveBulletin.ReleveDeNotes:{const lArticle=aParam.article;const lService=lArticle.estService||lArticle.avecAppreciationParSousService?lArticle:lArticle.service;if(lService){const lAppr=lService.ListeAppreciations?lService.ListeAppreciations.GetElement(0):null;return{service:lService,appreciation:lAppr};}}}
return{service:aParam.article,appreciation:null};}
_formatterDonneesPourRegroupements(aDonnees,aTableauSurMatieres,aParam){const lDonneesAcRegroup=new ObjetListeElements();lDonneesAcRegroup.nbrMaxTotDevoirs=aDonnees.nbrMaxTotDevoirs;let lRegroup=null;let lMatiereRegroup=null;aDonnees.parcourir(function(aService){if(aService.estSurMatiere||(aService.estDebutRegroupement&&(aService.estService||(aParam.typeReleveBulletin===TypeReleveBulletin.ReleveDeNotes&&aService.estPremier)))){lMatiereRegroup=aService.SurMatiere;lRegroup=new ObjetElement(lMatiereRegroup.GetLibelle(),lMatiereRegroup.GetNumero(),lMatiereRegroup.GetGenre());lRegroup.surMatiere=aTableauSurMatieres[aService.regroupement];lRegroup.estUnDeploiement=true;lRegroup.estDeploye=true;lDonneesAcRegroup.AddElement(lRegroup);aService.estUnDeploiement=false;aService.pere=lRegroup;lDonneesAcRegroup.AddElement(aService);} else{aService.estUnDeploiement=false;const lServicePere=aService.estService?aService:aService.service;if(!!lServicePere&&((lServicePere.estDebutRegroupement)||(lServicePere.regroupement))){aService.pere=lRegroup;} else{lRegroup=null;}
lDonneesAcRegroup.AddElement(aService);}}.bind(this));return lDonneesAcRegroup;}
_getHintListeProfsDeServices(aParam){let lEstChaineTropLongue=false;let lListeProfesseurs=[],lLibelle;const N=aParam.service&&aParam.service.ListeProfesseurs?aParam.service.ListeProfesseurs.GetNbrElements():0;for(let I=0;I<N;I++){lLibelle=aParam.service.ListeProfesseurs.GetLibelle(I);if(GChaine.EstChaineTropLongue(lLibelle,10,false,aParam.largeur)){lEstChaineTropLongue=true;}
lListeProfesseurs.push(lLibelle);}
return(N>aParam.nbMaxProfs)||lEstChaineTropLongue?lListeProfesseurs.join('\n'):'';}
composeHtmlService(aParam){const H=[];const lService=aParam.service;const lHauteur=(aParam.hauteur!==null)&&(aParam.hauteur!==undefined)?'height:'+aParam.hauteur+'px':'';H.push('<div style="',lHauteur,'">');if(lService){const lLibelleMatiere=(!lService.Matiere||lService.Matiere.GetLibelle()===''?'&nbsp;':lService.Matiere.GetLibelle());H.push('<div ie-ellipsis>'+lLibelleMatiere+'</div>');if(lService.AvecLibelleEnseignantMatiereSurMemeLigne){const lLibelles=(!!lService.ListeProfesseurs?lService.ListeProfesseurs.getTableauLibelles().join(', '):'');H.push('<div ie-ellipsis title="'+lLibelles+'">'+lLibelles+'</div>');} else{const N=lService&&lService.ListeProfesseurs?lService.ListeProfesseurs.GetNbrElements():0;let i,lNbr;for(i=0,lNbr=Math.min(N,aParam.nbrMaxProfesseurs);i<lNbr;i++){const lProfesseur=(!!lService.ListeProfesseurs?lService.ListeProfesseurs.GetElement(i):'');H.push('<div ie-ellipsis>'+lProfesseur.GetLibelle()+'</div>');}}}
H.push('</div>');return H.join('');}
composeHtmlEleve(aParam){const H=[];const lHeight=aParam.hauteur?'height: '+(aParam.hauteur)+'px;':'';const lHintProjetAcc=(!!aParam.strProjetAcc?aParam.strProjetAcc.replace(/\n/g,'<br/>'):'');const lAvecPiecesJointes=(!!aParam.avecDocsProjetAcc);H.push('<div style="display:flex; ',lHeight,'">');if(aParam.avecPhoto===true){H.push(_composePhoto.call(this,{eleve:aParam.eleve,largeurPhoto:aParam.largeurPhoto}));}
H.push('<div class="InlineBlock AlignementHaut EspaceGauche EspaceHaut">',aParam.eleve.GetLibelle(),'</div>');if(lHintProjetAcc.length>0||lAvecPiecesJointes){const lClass=['AlignementMilieuVertical','InlineBlock'];let lEvntClic='';if(lAvecPiecesJointes){lClass.push('AvecMain');lEvntClic=' ie-node="surClicPiecesJointesProjAcc(\''+aParam.eleve.GetNumero()+'\')"';}
H.push('<div style="margin-left:auto;" ie-hint="'+lHintProjetAcc+'" class=" '+lClass.join(' ')+'" '+lEvntClic+'><i class="icon_projet_accompagnement Texte12"></i></div>');}
H.push('</div>');return H.join('');}
composeHtmlEvolution(aParam){return EGenreEvolution.getImage(aParam.genreEvol?aParam.genreEvol:0);}
composeBaretteEvaluations(aParam){const H=[];if(aParam.modeChronologique){H.push(TUtilitaireCompetences.composeJaugeChronologique({listeNiveaux:aParam.listeNiveauxChronologiques,hint:TUtilitaireCompetences.getDefaultHintBarreNiveauDAcquisitionChronologique(aParam.listeNiveauxChronologiques)}));} else{H.push(TUtilitaireCompetences.composeJaugeParNiveaux({listeNiveaux:aParam.listeNiveaux,hint:TUtilitaireCompetences.getDefaultHintBarreNiveauDAcquisitionParNiveauOuPastille(aParam.listeNiveaux)}));}
return H.join('');}
ouvrirFenetreDetailBarreNiveauxDAcquisition(aParam){const lInstance=aParam.instance;GEtatUtilisateur.Navigation.fenetre_BarreNiveauxDAcquisitions_estAffiche=TUtilitaireCompetences.existeBarreNiveauxDAcquisitionsDePiliers(aParam.listePiliers);if(GEtatUtilisateur.Navigation.fenetre_BarreNiveauxDAcquisitions_estAffiche){lInstance.setOptionsFenetre({titre:getTitreFenetreBarreNiveauxDacquisitions(aParam)});lInstance.SetDonnees(new DonneesListe_BarreNiveauxDAcquisitionsDePilier(aParam.listePiliers,{afficheJaugesChronologiques:aParam.modeChronologique}));} else{lInstance.Fermer();}}
composeHtmlPeriodePrec(aParam){const H=[];const lAvecMoy=(aParam.moyEleve!==null)&&(aParam.moyEleve!==undefined)&&(aParam.moyEleve!=='');const lAvecNivAcq=(aParam.niveauAcqu!==null)&&(aParam.niveauAcqu!==undefined)&&(aParam.niveauAcqu!=='');const lAvecMoyNR=(aParam.estMoyNR===true);const lStyleLigne='style="display:flex; margin-bottom:3px; align-items:center;"';H.push('<div>');if(lAvecMoy||lAvecNivAcq||lAvecMoyNR){H.push('<div ',lStyleLigne,'>');if(lAvecMoyNR){H.push('<div style="margin-right:1rem;">');H.push(this.composeHtmlMoyNR());H.push('</div>');}
if(lAvecMoy){H.push('<div>',aParam.moyEleve,'</div>');}
if(lAvecNivAcq){H.push('<div style="margin-left:auto;">',this.composeHtmlNote({note:null,niveauDAcquisition:aParam.niveauAcqu,genrePositionnement:TypePositionnementUtil.getGenrePositionnementParDefaut(aParam.typePositionnementClasse)}),'</div>');}
H.push('</div>');}
const lAvecNbHeuresAbs=(aParam.strHAbs!==null)&&(aParam.strHAbs!==undefined)&&(aParam.strHAbs!=='');const lAvecNbRetards=(aParam.strNbRetards!==null)&&(aParam.strNbRetards!==undefined)&&(aParam.strNbRetards!=='');if(lAvecNbHeuresAbs||lAvecNbRetards){H.push('<div ',lStyleLigne,'>');if(lAvecNbHeuresAbs){H.push('<div>',aParam.strHAbs,'</div>');}
if(lAvecNbRetards){H.push('<div style="margin-left:auto;">',aParam.strNbRetards,'</div>');}
H.push('</div>');}
const lAvecAppA=(aParam.appA!==null)&&(aParam.appA!==undefined)&&(aParam.appA.GetLibelle()!=='');const lAvecAppB=(aParam.appB!==null)&&(aParam.appB!==undefined)&&(aParam.appB.GetLibelle()!=='');const lAvecAppC=(aParam.appC!==null)&&(aParam.appC!==undefined)&&(aParam.appC.GetLibelle()!=='');const lAvecAppReleve=(aParam.appReleve!==null)&&(aParam.appReleve!==undefined)&&(aParam.appReleve.GetLibelle()!=='');const lAvecAvisProf=(aParam.appAvisProfesseur!==null)&&(aParam.appAvisProfesseur!==undefined)&&(aParam.appAvisProfesseur.GetLibelle()!=='');if(lAvecAppA){H.push('<div ',lStyleLigne,'>',aParam.appA.GetLibelle(),'</div>');}
if(lAvecAppB){H.push('<div ',lStyleLigne,'>',aParam.appB.GetLibelle(),'</div>');}
if(lAvecAppC){H.push('<div ',lStyleLigne,'>',aParam.appC.GetLibelle(),'</div>');}
if(lAvecAppReleve){H.push('<div ',lStyleLigne,'>',aParam.appReleve.GetLibelle(),'</div>');}
if(lAvecAvisProf){H.push('<div ',lStyleLigne,'>',aParam.appAvisProfesseur.GetLibelle(),'</div>');}
H.push('</div>');return H.join('');}
composeStrPeriodePrec(aParam){const H=[];const lAvecMoy=(aParam.moyEleve!==null)&&(aParam.moyEleve!==undefined)&&(aParam.moyEleve!=='');const lAvecNivAcq=(aParam.niveauAcqu!==null)&&(aParam.niveauAcqu!==undefined)&&(aParam.niveauAcqu!=='');const lAvecMoyNR=(aParam.estMoyNR===true);if(lAvecMoy||lAvecNivAcq||lAvecMoyNR){if(lAvecMoyNR){H.push(GTraductions.getValeur('Notes.Colonne.TitreMoyNR'));}
if(lAvecMoy){H.push(aParam.moyEleve);}
if(lAvecNivAcq){this.composeStrNote({note:null,niveauDAcquisition:aParam.niveauAcqu,genrePositionnement:TypePositionnementUtil.getGenrePositionnementParDefaut(aParam.typePositionnementClasse)});}}
const lAvecNbHeuresAbs=(aParam.strHAbs!==null)&&(aParam.strHAbs!==undefined)&&(aParam.strHAbs!=='');const lAvecNbRetards=(aParam.strNbRetards!==null)&&(aParam.strNbRetards!==undefined)&&(aParam.strNbRetards!=='');if(lAvecNbHeuresAbs||lAvecNbRetards){if(lAvecNbHeuresAbs){H.push(aParam.strHAbs);}
if(lAvecNbRetards){H.push(aParam.strNbRetards);}}
const lAvecAppA=(aParam.appA!==null)&&(aParam.appA!==undefined)&&(aParam.appA.GetLibelle()!=='');const lAvecAppB=(aParam.appB!==null)&&(aParam.appB!==undefined)&&(aParam.appB.GetLibelle()!=='');const lAvecAppC=(aParam.appC!==null)&&(aParam.appC!==undefined)&&(aParam.appC.GetLibelle()!=='');const lAvecAppReleve=(aParam.appReleve!==null)&&(aParam.appReleve!==undefined)&&(aParam.appReleve.GetLibelle()!=='');const lAvecAvisProf=(aParam.appAvisProfesseur!==null)&&(aParam.appAvisProfesseur!==undefined)&&(aParam.appAvisProfesseur.GetLibelle()!=='');if(lAvecAppA){H.push(aParam.appA.GetLibelle());}
if(lAvecAppB){H.push(aParam.appB.GetLibelle());}
if(lAvecAppC){H.push(aParam.appC.GetLibelle());}
if(lAvecAppReleve){H.push(aParam.appReleve.GetLibelle());}
if(lAvecAvisProf){H.push(aParam.appAvisProfesseur.GetLibelle());}
return H.join(' - ');}
getStrNote(aNote){return(aNote!==null)&&(aNote!==false)&&(aNote!==undefined)?((aNote.getNote!==null)&&(aNote.getNote!==undefined)?aNote.getNote():aNote+''):'';}
composeHtmlNote(aParam){let lValeur;const lStyles=[];const H=[];const lAvecPrefixe=aParam.avecPrefixe===undefined?true:aParam.avecPrefixe;if(aParam.niveauDAcquisition&&aParam.niveauDAcquisition.existeNumero()){lStyles.push('text-align: center;');const lNiveauDAcquisition=GParametres.listeNiveauxDAcquisitions.GetElementParNumero(aParam.niveauDAcquisition.GetNumero());lValeur=EGenreNiveauDAcquisition.getImagePositionnement({niveauDAcquisition:lNiveauDAcquisition,genrePositionnement:aParam.genrePositionnement,avecPrefixe:lAvecPrefixe});} else{lValeur=this.getStrNote(aParam.note);}
if(aParam.estMoyNR===true){H.push(this.composeHtmlMoyNR());}
if(!((aParam.estMoyNR===true)&&(aParam.avecMoyNRUniquement===true))){H.push('<div style="'+lStyles.join('')+'">'+GChaine.AvecEspaceSiVide(lValeur)+'</div>');}
return H.join('');}
composeStrNote(aParam){let lValeur;const H=[];if(aParam.niveauDAcquisition&&aParam.niveauDAcquisition.existeNumero()){const lNiveauDAcquisition=GParametres.listeNiveauxDAcquisitions.GetElementParNumero(aParam.niveauDAcquisition.GetNumero());lValeur=EGenreNiveauDAcquisition.getImagePositionnement({niveauDAcquisition:lNiveauDAcquisition,genrePositionnement:aParam.genrePositionnement,avecPrefixe:true});} else{lValeur=this.getStrNote(aParam.note);}
if(aParam.estMoyNR===true){H.push(GTraductions.getValeur('Notes.Colonne.TitreMoyNR'));}
if(!((aParam.estMoyNR===true)&&(aParam.avecMoyNRUniquement===true))){H.push(GChaine.AvecEspaceSiVide(lValeur));}
return H.join('');}
composeContenuListeElementProgramme(aListe,aAvecDetail){const T=[],lNb=aListe.GetNbrElementsExistes();if(aListe&&lNb){aListe.trier();if(lNb<=10||aAvecDetail){T.push('<ul>');aListe.parcourir(function(aElement){if(aElement.Existe()){T.push('<li>',aElement.GetLibelle(),'</li>');}});T.push('</ul>');} else if(lNb>2){T.push(GTraductions.getValeur('BulletinEtReleve.ElementsProgramme',[lNb]));}}
return T.join('');}
composeHtmlElementProgramme(aParam){const H=[];H.push(this.composeContenuListeElementProgramme(aParam.elements));return H.join('');}
getHintElementProgramme(aParam){const T=[];if(aParam.service){T.push(this.composeContenuListeElementProgramme(aParam.service.ElementsProgrammeBulletin,true));}
return T.join('');}
getTypeGenreAppreciation(aParam){let lTypeGenreAppreciation;if(aParam.estCtxPied===true){if((aParam.genreAppr===null)||(aParam.genreAppr===undefined)){$.extend(aParam,{genreAppr:aParam.appreciation.Genre});}
lTypeGenreAppreciation=this.moteurPdB.getTypeGenreAppreciationPdB(aParam);} else{switch(aParam.typeReleveBulletin){case TypeReleveBulletin.BulletinNotes:case TypeReleveBulletin.BulletinCompetences:lTypeGenreAppreciation=TypeGenreAppreciation.GA_Bulletin_Professeur;break;case TypeReleveBulletin.LivretScolaire:lTypeGenreAppreciation=TypeGenreAppreciation.GA_BilanAnnuel_Professeur;break;case TypeReleveBulletin.AppreciationsBulletinProfesseur:return TypeGenreAppreciation.GA_Bulletin_Professeur;case TypeReleveBulletin.AppreciationsReleveProfesseur:case TypeReleveBulletin.ReleveDeNotes:lTypeGenreAppreciation=TypeGenreAppreciation.GA_Releve_Professeur;break;case TypeReleveBulletin.AvisProfesseur:return TypeGenreAppreciation.GA_Bulletin_Professeur;case TypeReleveBulletin.AvisParcoursup:return TypeGenreAppreciation.GA_Bulletin_Professeur;default:;lTypeGenreAppreciation=TypeGenreAppreciation.GA_Bulletin_Professeur;break;}}
return lTypeGenreAppreciation;}
getTailleMaxAppreciation(aParam){if(aParam.tailleMaxDonneesAffichage){return aParam.tailleMaxDonneesAffichage;}
if(aParam.estCtxPied&&(aParam.appreciation!==null)&&(aParam.appreciation!==undefined)){$.extend(aParam,{genreAppr:aParam.appreciation.Genre});}
const lTypeGenreAppreciation=this.getTypeGenreAppreciation(aParam);return GParametres.getTailleMaxAppreciationParEnumere(lTypeGenreAppreciation);}
initFenetreAvisReligion(aInstance){const lParamsListe={tailles:['100%'],editable:false};aInstance.setOptionsFenetre({titre:GTraductions.getValeur('AvisReligion.titreSelection'),largeur:300,hauteur:350,listeBoutons:[GTraductions.getValeur('Annuler'),GTraductions.getValeur('Valider')],modeActivationBtnValider:aInstance.modeActivationBtnValider.toujoursActifs});aInstance.paramsListe=lParamsListe;}
composeHtmlDevoir(aParam){const H=[];const lDevoir=aParam.devoir;if(lDevoir&&lDevoir.Note){const lBareme=_composeHtmlBareme.call(this,aParam);const lNote=_composeHtmlNote.call(this,aParam);const lNoteAuDessusBareme=() =>{if(lDevoir.Note.getValeur()>lDevoir.Bareme.getValeur()){return tag('i',{class:['icon','icon_star','EspaceDroit']});}
return'';};H.push('<div style="display:flex; flex-direction:column; margin:3px; align-items:flex-end;">');H.push('<div style="display:flex; align-items:center;  padding-bottom:3px;">',lNoteAuDessusBareme(),lNote,lBareme,'</div>');if(aParam.avecDevoirsCoefficient){H.push(_composeHtmlCoeff.call(this,aParam));}
if(aParam.avecDevoirsDate&&lDevoir.Date){H.push(_composeHtmlDate.call(this,aParam));}
H.push('</div>');}
return H.join('');}
composeHtmlLienNoteCalculMoyenne(aParam){const H=[];const lNote=aParam.note;const lAvecNote=lNote&&lNote.estUneNoteVide&&!lNote.estUneNoteVide()&&lNote.estUneValeur();H.push('<span class="',lAvecNote?(aParam.estUnDeploiement?'LienMoyenneRegroupement':'LienMoyenne'):'','" ',(lAvecNote?GHtml.composeAttr('ie-node','getNodeCalculMoy',[aParam.ligne,aParam.colonne,aParam.idColonne]):''),'>'+lNote.getNote()+'</span>');return H.join('');}
saisieParamSynchroAppClasse(aParam){return Requetes('SaisieParamSynchroAppClasse',this).lancerRequete(aParam.paramRequete).then(function(aParams){if(aParams&&aParams.genreReponse===EGenreReponseSaisie.succes){if(aParams.JSONRapportSaisie&&aParams.JSONRapportSaisie.appreciationClasse&&aParams.JSONRapportSaisie.service&&aParams.JSONRapportSaisie.periode){const lParamClbck={numeroPeriode:aParams.JSONRapportSaisie.periode.GetNumero(),numeroService:aParams.JSONRapportSaisie.service.GetNumero(),apprSaisie:aParams.JSONRapportSaisie.appreciationClasse};aParam.clbckSucces(lParamClbck);}}
return aParams;}.bind(this),function(aParams){return aParams;});}
controleCtxAppSaisie(aParam,aParamSucces){if(aParam.service.GetNumero()!==aParamSucces.numeroService||aParam.periode.GetNumero()!==aParamSucces.numeroPeriode){return false;}
return true;}
updateAppClasseSurRetourSaisie(aAppClasse,aParamSucces){const lApprSaisie=aParamSucces.apprSaisie;aAppClasse.SetNumero(lApprSaisie.GetNumero());aAppClasse.appreciation=lApprSaisie.appreciation?lApprSaisie.appreciation:lApprSaisie.GetLibelle();if(lApprSaisie.editable!==null&&lApprSaisie.editable!==undefined){aAppClasse.editable=lApprSaisie.editable;}
aAppClasse.SetLibelle(lApprSaisie.GetLibelle());aAppClasse.SetEtat(EGenreEtat.Aucun);const lEstSynchro=lApprSaisie.estSynchronisee;aAppClasse.estSynchronisee=lEstSynchro;if(!lEstSynchro){aAppClasse.apprsIdentiques=lApprSaisie.apprsIdentiques;}}
saisieAppreciation(aParam){const lListe=aParam.instanceListe;return Requetes('SaisieAppreciation',this).lancerRequete(aParam.paramRequete).then(function(aParams){if(aParams&&aParams.genreReponse===EGenreReponseSaisie.succes){if(aParams.JSONRapportSaisie&&aParams.JSONRapportSaisie.appreciation&&aParams.JSONRapportSaisie.service&&aParams.JSONRapportSaisie.periode){const lParamClbck={numeroPeriode:aParams.JSONRapportSaisie.periode.GetNumero(),numeroService:aParams.JSONRapportSaisie.service.GetNumero(),numeroEleve:aParams.JSONRapportSaisie.eleve?aParams.JSONRapportSaisie.eleve.GetNumero():0,rangAppr:aParams.JSONRapportSaisie.appreciation.GetGenre(),apprSaisie:aParams.JSONRapportSaisie.appreciation};aParam.clbckSucces(lParamClbck);}}
return aParams;}.bind(this),function(aParams){return aParams;}).then(function(aParams){if(aParams&&aParams.genreReponse===EGenreReponseSaisie.succes){if(lListe!==null&&lListe!==undefined){lListe.Actualiser(true);this.moteurGrille.selectionCelluleSuivante({instanceListe:lListe,suivante:aParam.paramCellSuivante});}} else{aParam.clbckEchec(aParams.promiseMessage);}}.bind(this));}
saisieAR(aParam){return Requetes('SaisieAppreciation',this).lancerRequete(aParam);}
majAppreciationService(aParam){const lService=aParam.service;if(lService!==null){const lIndiceCol=lService.ListeAppreciations.getIndiceElementParFiltre(function(aElt){return aElt.GetGenre()===aParam.rangAppr;}.bind(this));lService.ListeAppreciations.AddElement(aParam.apprSaisie,lIndiceCol);} else{}}
saisieMoyPropDelib(aParam){const lListe=aParam.instanceListe;return Requetes('SaisieNotePropDelib',this).lancerRequete(aParam.paramRequete).then(function(aParams){if(aParams&&aParams.genreReponse===EGenreReponseSaisie.succes){if(aParams.JSONRapportSaisie&&(aParams.JSONRapportSaisie.estProposee!==null)&&(aParams.JSONRapportSaisie.estProposee!==undefined)&&(aParams.JSONRapportSaisie.estAvisReligion!==null)&&(aParams.JSONRapportSaisie.estAvisReligion!==undefined)&&aParams.JSONRapportSaisie.service&&aParams.JSONRapportSaisie.eleve){const lParamClbck={numeroService:aParams.JSONRapportSaisie.service.GetNumero(),numeroEleve:aParams.JSONRapportSaisie.eleve.GetNumero(),estProposee:aParams.JSONRapportSaisie.estProposee,estAvisReligion:aParams.JSONRapportSaisie.estAvisReligion};if(aParams.JSONRapportSaisie.estProposee===true){if(aParams.JSONRapportSaisie.estAvisReligion===true){$.extend(lParamClbck,{avisReligionPropose:aParams.JSONRapportSaisie.avisReligionPropose});} else{$.extend(lParamClbck,{moyenneProposee:aParams.JSONRapportSaisie.moyenneProposee});}} else{if(aParams.JSONRapportSaisie.estAvisReligion===true){$.extend(lParamClbck,{avisReligionDelibere:aParams.JSONRapportSaisie.avisReligionDelibere});} else{$.extend(lParamClbck,{moyenneDeliberee:aParams.JSONRapportSaisie.moyenneDeliberee});}}
aParam.clbckSucces(lParamClbck);}}
return aParams;}.bind(this),function(aParams){return aParams;}).then(function(aParams){if(aParams&&aParams.genreReponse===EGenreReponseSaisie.succes){lListe.Actualiser(true);this.moteurGrille.selectionCelluleSuivante({instanceListe:lListe,suivante:aParam.paramCellSuivante});} else{aParam.clbckEchec(aParams.promiseMessage);}}.bind(this));}
saisieEltsPgme(aParam){const lListe=aParam.instanceListe;return Requetes('SaisieEltsPgme',this).lancerRequete(aParam.paramRequete).then(function(aParams){if(aParams&&aParams.genreReponse===EGenreReponseSaisie.succes){if(aParams.JSONRapportSaisie&&aParams.JSONRapportSaisie.service&&aParams.JSONRapportSaisie.listeEltsPgme){aParams.JSONRapportSaisie.listeEltsPgme.trier();const lParamClbck={numeroService:aParams.JSONRapportSaisie.service.GetNumero(),listeEltsPgme:aParams.JSONRapportSaisie.listeEltsPgme};aParam.clbckSucces(lParamClbck);}}
return aParams;}.bind(this),function(aParams){return aParams;}).then(function(aParams){if(aParams&&aParams.genreReponse===EGenreReponseSaisie.succes){if(lListe!==null&&lListe!==undefined){lListe.Actualiser(true);this.moteurGrille.selectionCelluleSuivante({instanceListe:lListe,suivante:aParam.paramCellSuivante});}} else{aParam.clbckEchec(aParams.promiseMessage);}}.bind(this));}
saisieNoteLSU(aParam){const lListe=aParam.instanceListe;return Requetes('SaisieNoteLSU',this).lancerRequete(aParam.paramRequete).then(function(aParams){if(aParams&&aParams.genreReponse===EGenreReponseSaisie.succes){if(aParams.JSONRapportSaisie&&aParams.JSONRapportSaisie.posLSUNote&&aParams.JSONRapportSaisie.service&&aParams.JSONRapportSaisie.eleve){const lParamClbck={numeroService:aParams.JSONRapportSaisie.service.GetNumero(),numeroEleve:aParams.JSONRapportSaisie.eleve.GetNumero(),noteLSUSaisie:aParams.JSONRapportSaisie.posLSUNote};aParam.clbckSucces(lParamClbck);}}
return aParams;}.bind(this),function(aParams){return aParams;}).then(function(aParams){if(aParams&&aParams.genreReponse===EGenreReponseSaisie.succes){lListe.Actualiser(true);this.moteurGrille.selectionCelluleSuivante({instanceListe:lListe,suivante:aParam.paramCellSuivante});} else{aParam.clbckEchec(aParams.promiseMessage);}}.bind(this));}
saisieAvisProfesseur(aParam){const lListe=aParam.instanceListe;return Requetes('SaisieAvisProfesseur',this).lancerRequete(aParam.paramRequete).then(function(aParams){if(aParams&&aParams.genreReponse===EGenreReponseSaisie.succes){if(aParams.JSONRapportSaisie&&aParams.JSONRapportSaisie.appAvisProfesseur&&aParams.JSONRapportSaisie.service&&aParams.JSONRapportSaisie.eleve){const lParamClbck={numeroService:aParams.JSONRapportSaisie.service.GetNumero(),numeroEleve:aParams.JSONRapportSaisie.eleve.GetNumero(),appAvisProfesseur:aParams.JSONRapportSaisie.appAvisProfesseur};aParam.clbckSucces(lParamClbck);}}
return aParams;}.bind(this),function(aParams){return aParams;}).then(function(aParams){if(aParams&&aParams.genreReponse===EGenreReponseSaisie.succes){lListe.Actualiser(true);this.moteurGrille.selectionCelluleSuivante({instanceListe:lListe,suivante:aParam.paramCellSuivante});} else{aParam.clbckEchec(aParams.promiseMessage);}}.bind(this));}
saisieAvisProfesseurParcoursup(aParam){const lListe=aParam.instanceListe;return Requetes('SaisieAvisProfesseurParcoursup',this).lancerRequete(aParam.paramRequete).then(function(aParams){if(aParams&&aParams.genreReponse===EGenreReponseSaisie.succes){if(aParams.JSONRapportSaisie&&aParams.JSONRapportSaisie.appAvisProfParcoursup&&aParams.JSONRapportSaisie.service&&aParams.JSONRapportSaisie.eleve){const lParamClbck={numeroService:aParams.JSONRapportSaisie.service.GetNumero(),numeroEleve:aParams.JSONRapportSaisie.eleve.GetNumero(),appAvisProfParcoursup:aParams.JSONRapportSaisie.appAvisProfParcoursup};aParam.clbckSucces(lParamClbck);}}
return aParams;}.bind(this),function(aParams){return aParams;}).then(function(aParams){if(aParams&&aParams.genreReponse===EGenreReponseSaisie.succes){lListe.Actualiser(true);this.moteurGrille.selectionCelluleSuivante({instanceListe:lListe,suivante:aParam.paramCellSuivante});} else{aParam.clbckEchec(aParams.promiseMessage);}}.bind(this));}
saisieECTS(aParam){const lListe=aParam.instanceListe;const lEstCalculAuto=(aParam.paramRequete.estCalculAuto===true);if(lEstCalculAuto){const lParamRequete=aParam.paramRequete;lParamRequete.listeEleves=lParamRequete.listeEleves.setSerialisateurJSON({ignorerEtatsElements:true,methodeSerialisation:function(aEleve,AJSON){AJSON.classe=aEleve.classe;AJSON.service=aEleve.service;}});return Requetes('SaisieECTS',this).lancerRequete(lParamRequete).then(function(aParams){if(aParams&&aParams.genreReponse===EGenreReponseSaisie.succes){aParam.clbckSucces();}}.bind(this));} else{return Requetes('SaisieECTS',this).lancerRequete(aParam.paramRequete).then(function(aParams){if(aParams&&aParams.genreReponse===EGenreReponseSaisie.succes){if(aParams.JSONRapportSaisie&&(aParams.JSONRapportSaisie.ECTS!==null)&&(aParams.JSONRapportSaisie.ECTS!==undefined)&&aParams.JSONRapportSaisie.service&&aParams.JSONRapportSaisie.eleve){const lParamClbck={numeroService:aParams.JSONRapportSaisie.service.GetNumero(),numeroEleve:aParams.JSONRapportSaisie.eleve.GetNumero(),ECTSSaisie:aParams.JSONRapportSaisie.ECTS};aParam.clbckSucces(lParamClbck);}}
return aParams;}.bind(this),function(aParams){return aParams;}).then(function(aParams){if(aParams&&aParams.genreReponse===EGenreReponseSaisie.succes){lListe.Actualiser(true);this.moteurGrille.selectionCelluleSuivante({instanceListe:lListe,suivante:aParam.paramCellSuivante});} else{aParam.clbckEchec(aParams.promiseMessage);}}.bind(this));}}
surBoutonCalculAuto(aParam){const lListeEleves=aParam.listeEleves;if(lListeEleves.GetNbrElements()>0){let lTitreFenetre='';if(aParam.modeCalculAuto===TypeModeValidationAuto.tmva_PosAvecNoteSelonEvaluation){lTitreFenetre=GTraductions.getValeur('competences.fenetreValidationAutoPositionnement.titreNoteLSUSelonEvaluations');}
let lMessageFenetre='';if(aParam.modeCalculAuto===TypeModeValidationAuto.tmva_PosSansNoteSelonDevoir){lMessageFenetre=aParam.messageValidationAutoPositionnementSelonDevoir;} else if(aParam.modeCalculAuto===TypeModeValidationAuto.tmva_PosAvecNoteSelonEvaluation){lMessageFenetre=GTraductions.getValeur('competences.fenetreValidationAutoPositionnement.messageNoteLSUSelonEvaluations');}
let lMrFiche;if(aParam.modeCalculAuto===TypeModeValidationAuto.tmva_PosAvecNoteSelonEvaluation){lMrFiche=GTraductions.getValeur('BulletinEtReleve.MFichePostionnementCalculeNoteLSU');}
const lParamValidationAutoPositionnement={instance:aParam.instance,listeEleves:lListeEleves,modeValidationAuto:aParam.modeCalculAuto,titre:lTitreFenetre,message:lMessageFenetre,mrFiche:lMrFiche,callback:function(){aParam.clbckCalculAuto.call(aParam.instance);}};TUtilitaireCompetences.surBoutonValidationAutoPositionnement(lParamValidationAutoPositionnement);}}
surBoutonCalculAutoECTS(aParam){const lModeCalculECTS=(aParam.seuilECTS!==null)&&(aParam.seuilECTS!==undefined)&&(aParam.seuilECTS.getValeur()>0)?GTraductions.getValeur('BulletinEtReleve.ECTSParSeuil'):GTraductions.getValeur('BulletinEtReleve.ECTSParRatio');GApplication.getMessage().afficher({type:EGenreBoiteMessage.Confirmation,titre:GTraductions.getValeur('BulletinEtReleve.affectationECTS'),message:GChaine.Format(GTraductions.getValeur('BulletinEtReleve.msgAffectationECTS'),[GChaine.doubleToStr(aParam.nbrECTSService),lModeCalculECTS])}).then(function(aGenreAction){if(aGenreAction===EGenreAction.Valider){this.saisieECTS({paramRequete:{estCalculAuto:true,periode:aParam.periode,listeEleves:aParam.listeEleves},instanceListe:aParam.instanceListe,clbckSucces:function(){aParam.clbckCalculAuto.call(aParam.instance);}.bind(this),clbckEchec:function(){}.bind(this)});}}.bind(this));}
ouvrirMenuPositionnement(aParam){ObjetMenuContextuel.afficher({id:aParam.id,options:{imageFormate:true},pere:aParam.instance,initCommandes:function(aInstance){TUtilitaireCompetences.getListeNiveauxDAcquisitionsPourMenu({genreChoixValidationCompetence:aParam.genreChoixValidationCompetence,genrePositionnement:aParam.genrePositionnement,avecSelecteurNiveauCalcule:aParam.avecSelecteurNiveauCalcule,avecDispense:true,avecLibelleRaccourci:!!aParam.avecLibelleRaccourci}).parcourir(function(aElement){aInstance.add(aElement.tableauLibelles||aElement.GetLibelle(),aElement.actif,function(){aParam.clbackMenuPositionnement(aElement);},{image:aElement.image,largeurImage:aElement.largeurImage});}.bind(this));}});}
saisiePositionnement(aParam){const lListe=aParam.instanceListe;return Requetes('SaisiePositionnement',this).lancerRequete(aParam.paramRequete).then(function(aParams){if(aParams&&aParams.genreReponse===EGenreReponseSaisie.succes){if(aParams.JSONRapportSaisie&&aParams.JSONRapportSaisie.service&&aParams.JSONRapportSaisie.eleve){const lParamClbck={numeroService:aParams.JSONRapportSaisie.service.GetNumero(),numeroEleve:aParams.JSONRapportSaisie.eleve.GetNumero(),niveauAcquSaisi:aParams.JSONRapportSaisie.niveauAcqu!==null&&aParams.JSONRapportSaisie.niveauAcqu!==undefined?aParams.JSONRapportSaisie.niveauAcqu:null,numeroEltCompetence:(aParams.JSONRapportSaisie.eltCompetence!==null)&&(aParams.JSONRapportSaisie.eltCompetence!==undefined)?aParams.JSONRapportSaisie.eltCompetence.GetNumero():null,numeroPilier:aParams.JSONRapportSaisie.pilier!==null&&aParams.JSONRapportSaisie.pilier!==undefined?aParams.JSONRapportSaisie.pilier.GetNumero():null,numeroPalier:aParams.JSONRapportSaisie.palier!==null&&aParams.JSONRapportSaisie.palier!==undefined?aParams.JSONRapportSaisie.palier.GetNumero():null};aParam.clbckSucces(lParamClbck);}}
return aParams;}.bind(this),function(aParams){return aParams;}).then(function(aParams){if(aParams&&aParams.genreReponse===EGenreReponseSaisie.succes){lListe.Actualiser(true);if(aParam.paramCellSuivante!==null&&aParam.paramCellSuivante!==undefined){this.moteurGrille.selectionCelluleSuivante({instanceListe:lListe,suivante:aParam.paramCellSuivante});}} else{aParam.clbckEchec(aParams.promiseMessage);}}.bind(this));}
ouvrirMenuEvolution(aParam){ObjetMenuContextuel.afficher({id:aParam.id,options:{imageFormate:true},pere:aParam.instance,initCommandes:function(aInstance){EGenreEvolution.getListePourMenu().parcourir(function(aElement){aInstance.add(aElement.tableauLibelles||aElement.GetLibelle(),aElement.actif,function(){aParam.clbackMenuEvolution(aElement);},{image:aElement.image,largeurImage:aElement.largeurImage});}.bind(this));}});}
composeHtmlMoyNR(){const H=[];H.push(tag('div',{class:'notation_pastille_moy_NR','ie-hint':GTraductions.getValeur('Notes.Colonne.HintMoyenneNR')},GTraductions.getValeur('Notes.Colonne.TitreMoyNR')));return H.join('');}
saisieMoyNR(aParam){const lListe=aParam.instanceListe;return Requetes('SaisieMoyNR',this).lancerRequete(aParam.paramRequete).then(function(aParams){if(aParams&&aParams.genreReponse===EGenreReponseSaisie.succes){if(aParams.JSONRapportSaisie&&aParams.JSONRapportSaisie.eleve){const lParamClbck={numeroEleve:aParams.JSONRapportSaisie.eleve.GetNumero(),estMoyNRSaisie:aParams.JSONRapportSaisie.estMoyNR!==null&&aParams.JSONRapportSaisie.estMoyNR!==undefined?aParams.JSONRapportSaisie.estMoyNR:null,estMoyAnnuelleNR:aParams.JSONRapportSaisie.estMoyAnnuelleNR!==null&&aParams.JSONRapportSaisie.estMoyAnnuelleNR!==undefined?aParams.JSONRapportSaisie.estMoyAnnuelleNR:null};aParam.clbckSucces(lParamClbck);}}
return aParams;}.bind(this),function(aParams){return aParams;}).then(function(aParams){if(aParams&&aParams.genreReponse===EGenreReponseSaisie.succes){lListe.Actualiser(true);} else{aParam.clbckEchec(aParams.promiseMessage);}}.bind(this));}
saisieEvolution(aParam){const lListe=aParam.instanceListe;return Requetes('SaisieEvolution',this).lancerRequete(aParam.paramRequete).then(function(aParams){if(aParams&&aParams.genreReponse===EGenreReponseSaisie.succes){if(aParams.JSONRapportSaisie&&aParams.JSONRapportSaisie.service&&aParams.JSONRapportSaisie.eleve){const lParamClbck={numeroService:aParams.JSONRapportSaisie.service.GetNumero(),numeroEleve:aParams.JSONRapportSaisie.eleve.GetNumero(),evolutionSaisie:aParams.JSONRapportSaisie.evolution!==null&&aParams.JSONRapportSaisie.evolution!==undefined?aParams.JSONRapportSaisie.evolution:null};aParam.clbckSucces(lParamClbck);}}
return aParams;}.bind(this),function(aParams){return aParams;}).then(function(aParams){if(aParams&&aParams.genreReponse===EGenreReponseSaisie.succes){lListe.Actualiser(true);this.moteurGrille.selectionCelluleSuivante({instanceListe:lListe,suivante:aParam.paramCellSuivante});} else{aParam.clbckEchec(aParams.promiseMessage);}}.bind(this));}
surEditionAvisReligion(aContexte){const lDonneesListe=new DonneesListe_Simple(aContexte.listeAvis,{avecTri:false}).setOptions({avecEvnt_SelectionClick:true,avecEvnt_Selection:false});lDonneesListe.GetValeur=function(I,D){if(I===0){return(D.description!==null)&&(D.description!==undefined)?(D.GetLibelle()!==''?D.GetLibelle()+' ('+D.description+')':D.description):D.GetLibelle();}
return D.GetLibelle();};ObjetFenetre.creerInstance(ObjetFenetre_Liste,{pere:this,evenement:function(aContexte ,aNumeroBouton,aIndiceSelection){switch(aNumeroBouton){case 1:{const lEltSelection=aContexte.listeAvis.GetElement(aIndiceSelection);if(lEltSelection&&(lEltSelection.GetNumero()!==aContexte.avisReligion.GetNumero())){aContexte.surValiderEditionDonnee({article:aContexte.article,idColonne:aContexte.idColonne,selection:lEltSelection,ctxAvisReligion:true,navigation:{suivante:{orientationVerticale:true}}});}
break;}}}.bind(this,aContexte),initialiser:this.initFenetreAvisReligion}).SetDonnees(lDonneesListe,true);}
strClassement(aClassement){if(aClassement!==null&&aClassement!==undefined){if(aClassement.toString()==='1'){return GTraductions.getValeur('BulletinEtReleve.classementEr',[aClassement]);} else{return GTraductions.getValeur('BulletinEtReleve.classementEme',[aClassement]);}}
return'';}
composeHtmlMoyAnnuelle(aMoy,aEstNR){const H=[];if(aEstNR===true){H.push(this.composeHtmlMoyNR());}
H.push(aMoy);return H.join('');}}
function _composePhoto(aParam){const result=[];if(aParam.eleve){let lSrcPhoto='';if(aParam.eleve.avecPhoto!==false){lSrcPhoto=GChaine.creerUrlBruteLienExterne(aParam.eleve,{libelle:'photo.jpg'});}
result.push('<div class="InlineBlock AlignementHaut" style="display:flex; align-items:center; height: 100%; width: ',aParam.largeurPhoto,'px; ">','<img ie-load-src="',lSrcPhoto,'" ',GHtml.composeAttr('ie-node','nodePhoto',aParam.eleve.GetNumero()),' class="img-portrait" ie-imgviewer style="height: auto; width: auto; max-height: 100%; max-width: 100%;" />','</div>');}
return result.join('');}
function getTitreFenetreBarreNiveauxDacquisitions(aParam){const lEleve=aParam.eleve;const lNombre=aParam.nbEvals;const lResult=[lEleve.GetLibelle()];if(lNombre>0){lResult.push(GTraductions.getValeur('Fenetre_BarreNiveauxDacquisitions.TitreFenetre',[lNombre]));}
lResult.push(GEtatUtilisateur.Navigation.GetLibelleRessource(EGenreRessource.Matiere));return lResult.join(' - ');}
function _composeHtmlBareme(aParam){const H=[];const lDevoir=aParam.devoir;const lEstBaremeParDefaut=!lDevoir.Bareme||!lDevoir.BaremeParDefaut||(lDevoir.Bareme.getValeur()===lDevoir.BaremeParDefaut.getValeur());const lNoteAuDessusBareme=(lDevoir.Note.getValeur()>lDevoir.Bareme.getValeur());if(!lEstBaremeParDefaut||lNoteAuDessusBareme){H.push('<div class="Texte9" style="margin-left:3px;"','title="',GTraductions.getValeur('ReleveDeNotes.BaremeDevoir'),'"',' >');H.push(lDevoir.Bareme.getBaremeEntier());H.push('</div>');}
return H.join('');}
function _composeHtmlNote(aParam){const H=[];const lDevoir=aParam.devoir;let lNote=lDevoir.Note.getNote();if(lDevoir.estFacultatif){lNote='('+lNote+')';}
if(aParam.avecCorrige&&lDevoir.libelleCorrige){const lDocJoint=new ObjetElement(lDevoir.libelleCorrige,lDevoir.GetNumero(),EGenreDocumentJoint.Fichier);const lUrl=GChaine.creerUrlBruteLienExterne(lDocJoint,{genreRessource:TypeFichierExterneHttpSco.DevoirCorrige});H.push('<a class="LienAccueil Gras" title="',GTraductions.getValeur('AfficherCorrige'),'" href="'+lUrl+'" target="_blank">');H.push(lNote);H.push('</a>');} else if(aParam.avecCorrige&&lDevoir.executionQCM&&lDevoir.executionQCM.publierCorrige){H.push('<div ',GHtml.composeAttr('ie-node','getNodeCorrigeQCM',[aParam.ligne,aParam.indiceDevoir]),' class="LienAccueil Gras" title="',GTraductions.getValeur('AfficherCorrige'),'">');H.push(lNote);H.push('</div>');} else{H.push('<div class="Gras">'+lNote+'</div>');}
return H.join('');}
function _composeHtmlCoeff(aParam){const H=[];const lDevoir=aParam.devoir;const lAvecCoeff=(lDevoir.Coefficient)&&(!lDevoir.Coefficient.estCoefficientParDefaut());H.push('<div class="Texte9"',(lAvecCoeff?'title="'+GTraductions.getValeur('ReleveDeNotes.CoeffficientDevoir')+'"':''),' >');if(lAvecCoeff){H.push(GTraductions.getValeur('ReleveDeNotes.AbreviationCoef'),'&nbsp;',aParam.devoir.Coefficient.getNote());} else{H.push('&nbsp;');}
H.push('</div>');return H.join('');}
function _composeHtmlDate(aParam){const H=[];const lDevoir=aParam.devoir;H.push('<div class="Texte9">'+GDate.FormatDate(lDevoir.Date,'%JJ %MMM')+'</div>');return H.join('');}
module.exports.ObjetMoteurReleveBulletin=ObjetMoteurReleveBulletin;},fn:"objetmoteurrelevebulletin.js"});;
IE.fModule({f:function(exports,require,module,global){const GChaine=require('GChaine.js');const Identite=require('ObjetIdentite.js');const ObjetIdentite_Mobile=require('ObjetIdentite_Mobile.js');const ObjetListeElements=require('ObjetListeElements.js');const GTraductions=require('ObjetTraduction.js');const ObjetTri=require('ObjetTri.js');const TypeNote=require('TypeNote.js');const UtilitaireBulletinEtReleve_Mobile=require('UtilitaireBulletinEtReleve_Mobile.js');const EGenreEvolution=require('Enumere_Evolution.js');const EGenreNiveauDAcquisition=require('Enumere_NiveauDAcquisition.js');const EGenreDirectionSlide=require('EGenreDirectionSlide.js');const PiedDeBulletinMobile=require('PiedDeBulletinMobile.js');const TypeContexteBulletin=require('TypeContexteBulletin.js');const TypeReleveBulletin=require('TypeReleveBulletin.js');const ObjetBoutonFlottant=require('ObjetBoutonFlottant.js');const GenerationPDF=require('utilitairegenerationpdf.js');const OptionsPdf=require('OptionsPDFSco.js');const TypeHttpGenerationPDFSco=require('TypeHttpGenerationPDFSco.js').TypeHttpGenerationPDFSco;const{TypeDroits}=require('ObjetDroitsPN.js');const ObjetMoteurReleveBulletin=require('ObjetMoteurReleveBulletin.js').ObjetMoteurReleveBulletin;const UtilitaireGestionCloudEtPDF=require('UtilitaireGestionCloudEtPDF.js');const{TypePositionnementUtil}=require('TypePositionnement.js');class ObjetBulletin extends ObjetIdentite_Mobile{constructor(...aParams){super(...aParams);this.donneesRecues=false;this.moteur=new ObjetMoteurReleveBulletin();this.instancePiedDeBulletin=Identite.creerInstance(PiedDeBulletinMobile,{pere:this,evenement:null});this.instancePiedDeBulletin.setDonneesContexte({typeContexteBulletin:TypeContexteBulletin.CB_Eleve,avecSaisie:false,typeReleveBulletin:TypeReleveBulletin.BulletinNotes});}
getControleur(aInstance){return $.extend(true,super.getControleur(this),{getIdentiteBouton:function(){return{class:ObjetBoutonFlottant,pere:this,init:function(aBtn){aInstance.identBtnFlottant=aBtn;var lParam={listeBoutons:[{primaire:true,icone:"icon_pdf",callback:aInstance.AfficherModalitesGenerationPDF.bind(this,aInstance,_genererPdf)}
]};aBtn.setOptionsBouton(lParam);}};}});}
AfficherModalitesGenerationPDF(aInstance){let lParams={callbaskEvenement:aInstance.surEvenementFenetre.bind(aInstance),modeGestion:UtilitaireGestionCloudEtPDF.modeGestion.PDFEtCloud,avecDepot:true,avecTitreSelonOnglet:true};UtilitaireGestionCloudEtPDF.creerFenetreGestion(lParams);}
surEvenementFenetre(aLigne){const lService=GEtatUtilisateur.listeCloudDepotServeur.GetElement(aLigne);_genererPdf.call(this,!!lService?lService.GetGenre():null);}
ConstruireAffichage(){this.listeRegroupements=new ObjetListeElements();this.listeServices=new ObjetListeElements();var lHtml=[];if(!!this.Message){lHtml.push(this.composeAucuneDonnee(this.Message));if(!!this.identBtnFlottant){this.identBtnFlottant.SetVisible(false);}} else if(this.donneesRecues){if(!!this.identBtnFlottant){this.identBtnFlottant.SetVisible(true);}
lHtml.push('<div id="',this.Nom,'_Bulletin">');if(this.ListeElements.GetNbrElements()){lHtml.push(this.composeCorpsDeBulletin());}
lHtml.push('<div id="',this.instancePiedDeBulletin.GetNom(),'"></div>');lHtml.push('</div>');if(GApplication.droits.get(TypeDroits.autoriserImpression)&&!this.identBtnFlottant){$("#"+GInterface.idZonePrincipale).IEHtmlAppend('<div class="is-sticky" ie-identite="getIdentiteBouton" ></div>',{controleur:this.controleur,avecCommentaireConstructeur:false});}}
return lHtml.join('');}
composeCorpsDeBulletin(){var lHtml=[];var lNumeroRegroupement;lHtml.push('<ul class="collection with-header bg-white bulletin">');lNumeroRegroupement=this.ListeElements.GetElement(0).SurMatiere.GetNumero();for(var I=0;this.ListeElements&&(I<this.ListeElements.GetNbrElements());I++){var lService=this.ListeElements.GetElement(I);if(lService.estService){lHtml.push(this.composeService(lService,lNumeroRegroupement!==null&&lService.SurMatiere.GetNumero()!==lNumeroRegroupement&&lService.SurMatiere.GetLibelle()===""));lNumeroRegroupement=lService.SurMatiere.GetNumero();}}
lHtml.push(this.composeMoyenneGenerale());lHtml.push('</ul>');return lHtml.join('');}
composeService(aService,aDoitSortirDeRegroupement){var lHtml=[];var lDebutRegroupement=this.composeRegroupement({service:aService});lHtml.push(lDebutRegroupement);lHtml.push('<li class="collection-item with-action ',(aDoitSortirDeRegroupement?'break-group':''),'" onclick="',this.Nom,'.ouvrirPanel(\'',aService.GetNumero(),'\')" style="padding:3px 12px;">');var lLibelleService=aService.GetLibelle();this.listeServices.AddElement(aService);var lInfosMoyComplet=this.Affichage.AvecNivMaitriseEleve&&this.Affichage.AvecMoyenneEleve;lHtml.push('<div class="matiere-conteneur ',lInfosMoyComplet?'infos-moy-complet':'','" style="border-color: '+(!!aService.couleur&&aService.couleur!==""?aService.couleur:'D4D4D4')+';">');lHtml.push('<div class="libelle">',lLibelleService,'</div>');lHtml.push('<div class="moyenne-classe">',this.getMoyenneClasse(aService),'</div>');lHtml.push('<div class="infos-moy-eleve">');lHtml.push('<div class="moyenne-eleve">'+this.getNoteService(aService,{estMoyNR:aService.estMoyNR})+'</div>');lHtml.push('<div class="nivMaitrise-eleve">'+this.getNivMaitriseService(aService)+'</div>');lHtml.push('</div>');if(aService.estService&&aService.nbSousServicesTotal>0){lHtml.push('<ul class="collection">');for(var J=0;J<aService.nbSousServicesTotal;J++){var lSousService=aService.ListeElements.GetElement(J);lHtml.push('<li class="collection-item with-action">');var libelleSousService=(!!lSousService.Matiere&&lSousService.Matiere.GetLibelle()!==""?lSousService.Matiere.GetLibelle():'');lHtml.push('<div class="sous-service-conteneur">');lHtml.push('<div class="libelle">');if(!!libelleSousService&&libelleSousService!==""){lHtml.push('<div>',libelleSousService,'</div>');}
if(!!lSousService.ListeProfesseurs&&!!lSousService.ListeProfesseurs.GetNbrElements()){lHtml.push('<div>',GChaine.ToHTML(lSousService.ListeProfesseurs.getTableauLibelles().join('<br>')),'</div>');}
lHtml.push('</div>');lHtml.push('<div class="moyenne-classe">',this.getMoyenneClasse(lSousService),'</div>');lHtml.push('<div class="moyenne-eleve">'+this.getNoteService(lSousService,{})+'</div>');lHtml.push('</div>');lHtml.push('</li>');}
lHtml.push('</ul>');}
lHtml.push('</div>');lHtml.push('</li>');return lHtml.join('');}
composeRegroupement(aParam){var lService=aParam.service.estService?aParam.service:aParam.service.pere;var lHtml=[];if(lService.SurMatiere.existeNumero()&&lService.estDebutRegroupement){this.listeRegroupements.AddElement(lService);lHtml.push('<li class="collection-header collection-group with-action" onclick="',this.Nom,'.ouvrirPanel(\'',lService.GetNumero(),'\',',true,')">');lHtml.push('<div class="title left-align InlineBlock" style="width:86%;">'+lService.SurMatiere.GetLibelle()+'</div>');var lMoyenneRegroupement="";var lServiceDansRegroupement=this.tableauSurMatieres[lService.regroupement];if(lService.AvecMoyenneRegroupement){lMoyenneRegroupement=this.getNoteService(lServiceDansRegroupement,{});}
lHtml.push('<div class="title right-align InlineBlock" style="width:13%;">',lMoyenneRegroupement,'</div>');lHtml.push('</li>');}
return lHtml.join('');}
SetDonnees(aListeElements,aPositionPeriode,aPositionMax,aTableauSurMatieres,aMoyenneGenerale,aDonneesAbsences,aPiedDePage,aAffichage,aPeriodeCourante){if(aListeElements){this.ListeElements=this.getListeDonneesLineaire(aListeElements);this.Affichage=aAffichage;this.donneesRecues=true;this.Message=false;}
if(aTableauSurMatieres){this.tableauSurMatieres=aTableauSurMatieres;}
if(aMoyenneGenerale){this.MoyenneGenerale=aMoyenneGenerale;}
if(aDonneesAbsences){this.donneesAbsences=aDonneesAbsences;}
if(aPiedDePage){this.PiedDePage=aPiedDePage;}
this.periodeCourante=aPeriodeCourante;var lSensSlide;if(this.precedentePosition===aPositionMax&&aPositionPeriode===0){lSensSlide=EGenreDirectionSlide.Droite;} else if(this.precedentePosition===0&&aPositionPeriode>1){lSensSlide=EGenreDirectionSlide.Gauche;} else{lSensSlide=aPositionPeriode===this.precedentePosition?EGenreDirectionSlide.Aucune:aPositionPeriode<this.precedentePosition?EGenreDirectionSlide.Gauche:EGenreDirectionSlide.Droite;}
this.precedentePosition=aPositionPeriode;this.Afficher(null,lSensSlide);this.instancePiedDeBulletin.setDonneesPiedDeBulletin(aPiedDePage,aDonneesAbsences);this.instancePiedDeBulletin.Afficher();}
SetMessage(aMessage){this.Message=aMessage;this.Afficher();}
getListeDonneesLineaire(aListeElements){var lService,lSousService,lCmpActifs,lIndiceDernier,lIndiceDernierActif,J,I,lNbr;var lListe=new ObjetListeElements();for(I=0,lNbr=aListeElements.GetNbrElements();I<lNbr;I++){lService=aListeElements.GetElement(I);lService.estService=true;lService.nbSousServicesTotal=!!lService.ListeElements?lService.ListeElements.GetNbrElements():0;lService.regroupement=lService.SurMatiere.GetNumero();lService.avecAppreciationParSousService=lService.AvecAppreciationParSousService;lCmpActifs=0;lIndiceDernier=0;lIndiceDernierActif=0;for(J=0;J<lService.nbSousServicesTotal;J++){if(lService.ListeElements.GetElement(J).Actif){lCmpActifs++;lIndiceDernierActif=J;}
lIndiceDernier=J;}
lService.nbSousServicesActifs=lCmpActifs;lListe.AddElement(lService);for(J=0;J<lService.nbSousServicesTotal;J++){lSousService=lService.ListeElements.GetElement(J);lSousService.estService=false;lSousService.estDernier=(J===lIndiceDernier);lSousService.estDernierActif=(J===lIndiceDernierActif);lSousService.regroupement=lService.regroupement;lSousService.avecAppreciationParSousService=lService.avecAppreciationParSousService;lListe.AddElement(lSousService);}}
return lListe;}
calculerTotalECTS(){var lTotalECTS=0;if(this.Affichage.avecECTS){var lService;var lNombreServices=this.ListeElements.GetNbrElements();for(var I=0;I<lNombreServices;I++){lService=this.ListeElements.GetElement(I);if(lService.ECTS!==false){lTotalECTS+=lService.ECTS;}}}
return lTotalECTS.toFixed(3);}
calculerNombrePointsEleve(){var lTotal=0;if(this.Affichage.AvecNombrePointsEleve){var lService;var lNombreService=this.ListeElements.GetNbrElements();for(var I=0;I<lNombreService;I++){lService=this.ListeElements.GetElement(I);if(lService.NombrePointsEleve){lTotal+=lService.NombrePointsEleve.valeur;}}}
return new TypeNote(lTotal,2);}
composeMoyenneGenerale(){var lHtml=[];if(this.Affichage&&this.Affichage.AvecMoyenneGenerale){lHtml.push('<li class="collection-item raised with-action break-group" onclick="',this.Nom,'.ouvrirPanel()">');lHtml.push('<div class="title left-align InlineBlock" style="width:86%;" >',GTraductions.getValeur('BulletinEtReleve.MoyGen'),'</div>');var lMoyenneGenerale="";if(this.MoyenneGenerale){if(this.MoyenneGenerale.moyenneDeliberee&&this.MoyenneGenerale.moyenneDeliberee.getNote()!==""){lMoyenneGenerale=this.MoyenneGenerale.moyenneDeliberee.getNote();} else if(this.MoyenneGenerale.MoyenneEleve&&this.MoyenneGenerale.MoyenneEleve.getNote()!==""){lMoyenneGenerale=this.MoyenneGenerale.MoyenneEleve.getNote();}
lHtml.push('<div class="title right-align InlineBlock" style="width:13%;">',lMoyenneGenerale,'</div>');}
lHtml.push('</li>');}
return lHtml.join('');}
ouvrirPanel(aNumeroService,aOuvrirePanelRegroupement){var lService=this.ListeElements.GetElementParNumero(aNumeroService);if(!!lService){if(!!aOuvrirePanelRegroupement){GInterface.openPanel(this.composePanelRegroupement(lService));} else{GInterface.openPanel(this.composePanelService(lService));}} else{GInterface.openPanel(this.composePanelMoyenneGenerale(this.MoyenneGenerale));}}
composePanelRegroupement(aService){var lHtml=[];var lMoyenneRegroupement="";var lServiceDansRegroupement=this.tableauSurMatieres[aService.regroupement];if(aService.AvecMoyenneRegroupement){lMoyenneRegroupement=this.getNoteService(lServiceDansRegroupement,{});}
if(aService){lHtml.push('<div class="navheader with-title-close">','  <div class="title-contain">','    <h3>',GTraductions.getValeur('BulletinEtReleve.DetailsRegroupement'),'</h3>','    <ie-btnimage onclick="'+GInterface.GetNom()+'.closePanel();" class="btnImageIcon icon_fermeture_widget" ></ie-btnimage>','  </div>');lHtml.push('  <div class="nav-prec-suiv">','    <ie-btnimage onclick="',this.Nom,'.surClickProchainElement(\'',aService.GetNumero(),'\',',false,',',true,')" class="btnImageIcon icon_angle_left"></ie-btnimage>','      <div class="libelle-contain">','        <h4>'+aService.SurMatiere.GetLibelle()+'</h4>');lHtml.push('        <div>',lMoyenneRegroupement,'</div>');lHtml.push('      </div>','    <ie-btnimage  onclick="',this.Nom,'.surClickProchainElement(\'',aService.GetNumero(),'\',',true,',',true,')" class="btnImageIcon icon_angle_right"></ie-btnimage>','  </div>');if(!!this.composeDetails(lServiceDansRegroupement,false)){lHtml.push('<div class="details-conteneur">');lHtml.push(this.composeDetails(lServiceDansRegroupement,false));lHtml.push('</div>');}
lHtml.push('</div>');}
return lHtml.join('');}
composePanelMoyenneGenerale(aMoyenneGenerale){var lHtml=[];if(aMoyenneGenerale){lHtml.push('<div class="navheader with-title-close">','<div class="title-contain">','<h3>',GTraductions.getValeur('BulletinEtReleve.DetailsMoyenneGenerale'),'</h3>','<ie-btnimage onclick="'+GInterface.GetNom()+'.closePanel();" class="btnImageIcon icon_fermeture_widget" ></ie-btnimage>','</div>');lHtml.push('<div class="nav-prec-suiv">','       <div class="libelle-contain"><h4>'+GTraductions.getValeur('BulletinEtReleve.MoyGen')+'</h4>',(this.Affichage.AvecMoyenneEleve&&aMoyenneGenerale.MoyenneEleve&&aMoyenneGenerale.MoyenneEleve.getNote()!=="")?'<div class="get-note">'+aMoyenneGenerale.MoyenneEleve.getNote()+'</div>':'','</div>','</div>');if(!!this.composeDetails(aMoyenneGenerale,true)){lHtml.push('<div class="details-conteneur">');lHtml.push(this.composeDetails(aMoyenneGenerale,true));lHtml.push('</div>');}}
return lHtml.join('');}
composePanelService(aService){var lHtml=[];if(aService){lHtml.push('<div class="navheader with-title-close">','<div class="title-contain">','<h3>',GTraductions.getValeur('BulletinEtReleve.DetailsMatiere'),'</h3>','<ie-btnimage onclick="'+GInterface.GetNom()+'.closePanel();" class="btnImageIcon icon_fermeture_widget" ></ie-btnimage>','</div>');lHtml.push('<div class="nav-prec-suiv">','<ie-btnimage onclick="',this.Nom,'.surClickProchainElement(\'',aService.GetNumero(),'\',',false,')" class="btnImageIcon icon_angle_left"></ie-btnimage>','<div class="libelle-contain bulletin">'+this.composeBandeauService(aService)+'</div>','<ie-btnimage onclick="',this.Nom,'.surClickProchainElement(\'',aService.GetNumero(),'\',',true,')" class="btnImageIcon icon_angle_right"></ie-btnimage>','</div>');if(!!this.composeDetails(aService,false)){lHtml.push('<div class="details-conteneur ">');lHtml.push(this.composeDetails(aService,false));lHtml.push('</div>');}
lHtml.push(this.composeElementProgrammeBulletin(aService));lHtml.push(this.composeAppreciationsService(aService));if(aService.estService&&aService.nbSousServicesTotal>0){lHtml.push('<ul class="collapsible popout">');for(var J=0;J<aService.nbSousServicesTotal;J++){var lSousService=aService.ListeElements.GetElement(J);lHtml.push(this.composeSousService(lSousService));}
lHtml.push('</ul>');}
lHtml.push(this.composeLegende(aService));}
return lHtml.join('');}
composeBandeauService(aService){var lHtml=[];lHtml.push('<h4>'+aService.GetLibelle());var libelleProfesseur=this.getProfesseur(aService);if(libelleProfesseur!==""){lHtml.push(' - ',libelleProfesseur);}
lHtml.push('</h4>');lHtml.push('<div class="infos-moy-eleve-bandeau">');lHtml.push('<div>'+this.getNoteService(aService,{estMoyNR:aService.estMoyNR,surMemeLigne:true})+'</div>');lHtml.push('<div class="nivMaitrise-eleve-bandeau">'+this.getNivMaitriseService(aService)+'</div>');lHtml.push('</div>');if(this.Affichage.avecECTS&&aService.ECTS&&aService.ECTS&&aService.ECTS!==""){lHtml.push('<div>');lHtml.push(GTraductions.getValeur('BulletinEtReleve.ECTS'),'&nbsp;',aService.ECTS);lHtml.push('</div>');}
return lHtml.join('');}
composeSousService(aSousService){var lHtml=[],lDetailSousService=this.composeDetails(aSousService,false),libelleSousService=(!!aSousService.Matiere&&aSousService.Matiere.GetLibelle()!==""?aSousService.Matiere.GetLibelle():'');lHtml.push('<li>');lHtml.push('<div class="collapsible-header',(lDetailSousService?' active':' empty-body'),'">');lHtml.push('<div>');lHtml.push('<div class="InlineBlock truncate" style="',(lDetailSousService?'width:69%;':''),'">');if(!!libelleSousService&&libelleSousService!==""){lHtml.push('<div>',libelleSousService,'</div>');}
if(!!aSousService.ListeProfesseurs&&!!aSousService.ListeProfesseurs.GetNbrElements()){lHtml.push('<div>',GChaine.ToHTML(aSousService.ListeProfesseurs.getTableauLibelles().join('<br>')),'</div>');}
lHtml.push('</div>');lHtml.push('<div class="InlineBlock" style="width:30%;',(!lDetailSousService?'float:right;':''),'">');lHtml.push('<div class="right-align Italique InlineBlock" style="width:100%;">',this.getNoteService(aSousService,{}),'</div>');lHtml.push('</div>');lHtml.push('</div>');lHtml.push('</div>');lHtml.push('<div class="collapsible-body details-conteneur">');lHtml.push((lDetailSousService||''));lHtml.push(this.composeAppreciationsService(aSousService));lHtml.push('</div>');lHtml.push('</li>');return lHtml.join('');}
composeDetails(aParam,aEstMoyenneGenerale){var lHtml=[];var H=[];var lMoyNR;if(this.Affichage&&!!aParam){var lEstMultiLignes=false;if(this.Affichage.avecMoyNRUniquement===false){lEstMultiLignes=this.Affichage.AvecMoyenneAnnuelle&&(aParam.estMoyAnnuelleNR===true);if(lEstMultiLignes===false&&this.Affichage.AvecMoyennePeriode){for(var lIndice=0;lIndice<this.Affichage.NombreMoyennesPeriodes;lIndice++){if(lEstMultiLignes===false){lMoyNR=(aParam.ListeMoyNRPeriodes!==null)&&(aParam.ListeMoyNRPeriodes!==undefined)?aParam.ListeMoyNRPeriodes[lIndice]:false;if(lMoyNR===true){lEstMultiLignes=true;}}}}}
if(this.Affichage.AvecVolumeHoraire&&!!aParam.VolumeHoraire&&aParam.VolumeHoraire!==""){lHtml.push(UtilitaireBulletinEtReleve_Mobile.composePetitBlocDonnees(GTraductions.getValeur('BulletinEtReleve.VolH'),aParam.VolumeHoraire,lEstMultiLignes));}
if(this.Affichage.AvecCoefficient&&!!aParam.Coefficient&&aParam.Coefficient.getNote()!==""){lHtml.push(UtilitaireBulletinEtReleve_Mobile.composePetitBlocDonnees(GTraductions.getValeur('BulletinEtReleve.Coeff'),aParam.Coefficient.getNote(),lEstMultiLignes));}
if(this.Affichage.AvecNombreDevoirs&&!!aParam.NombreDevoirs&&aParam.NombreDevoirs!==""){lHtml.push(UtilitaireBulletinEtReleve_Mobile.composePetitBlocDonnees(GTraductions.getValeur('BulletinEtReleve.NbrNotes'),aParam.NombreDevoirs,lEstMultiLignes));}
if(this.Affichage.AvecClassementEleve&&!!aParam.ClassementEleve&&aParam.ClassementEleve!==""){lHtml.push(UtilitaireBulletinEtReleve_Mobile.composePetitBlocDonnees(GTraductions.getValeur('BulletinEtReleve.Rang'),aParam.ClassementEleve,lEstMultiLignes));}
if(this.Affichage.AvecEvolution&&!!aParam.Evolution&&aParam.Evolution.GetGenre()!==null&&aParam.Evolution.GetGenre()!==EGenreEvolution.Aucune){lHtml.push(UtilitaireBulletinEtReleve_Mobile.composePetitBlocDonnees(GTraductions.getValeur('BulletinEtReleve.Evol'),'<div>'+EGenreEvolution.getImage(aParam.Evolution.GetGenre())+'</div>',lEstMultiLignes));}
if(this.Affichage.AvecMoyenneAnnuelle&&((!!aParam.MoyenneAnnuelle&&aParam.MoyenneAnnuelle.getNote()!=="")||(aParam.estMoyAnnuelleNR===true))){H=[];if(aParam.estMoyAnnuelleNR===true){H.push(this.moteur.composeHtmlMoyNR());}
if(!((aParam.estMoyAnnuelleNR===true)&&(this.Affichage.avecMoyNRUniquement===true))){H.push(aParam.MoyenneAnnuelle.getNote());}
lHtml.push(UtilitaireBulletinEtReleve_Mobile.composePetitBlocDonnees(GTraductions.getValeur('BulletinEtReleve.MoyAnnee'),H.join(''),lEstMultiLignes));}
if(this.Affichage.AvecMoyennePeriode){for(var I=0;I<this.Affichage.NombreMoyennesPeriodes;I++){if(aParam.ListeNiveauDAcquisitionPeriodes&&aParam.ListeNiveauDAcquisitionPeriodes.GetNbrElements()&&aParam.ListeNiveauDAcquisitionPeriodes.existeNumero(I)){var lNiveauDacquisition=GParametres.listeNiveauxDAcquisitions.GetElementParNumero(aParam.ListeNiveauDAcquisitionPeriodes.GetNumero(I));lHtml.push(UtilitaireBulletinEtReleve_Mobile.composePetitBlocDonnees(this.Affichage.listePeriodes.GetLibelle(I),EGenreNiveauDAcquisition.getImagePositionnement({niveauDAcquisition:lNiveauDacquisition}),lEstMultiLignes));} else if((aParam.ListeMoyennesPeriodes&&aParam.ListeMoyennesPeriodes[I]&&aParam.ListeMoyennesPeriodes[I].getNote()!=="")||(aParam.ListeMoyNRPeriodes&&aParam.ListeMoyNRPeriodes[I]===true)){H=[];lMoyNR=(aParam.ListeMoyNRPeriodes!==null)&&(aParam.ListeMoyNRPeriodes!==undefined)?aParam.ListeMoyNRPeriodes[I]:false;if(lMoyNR===true){H.push(this.moteur.composeHtmlMoyNR());}
if(!((lMoyNR===true)&&(this.Affichage.avecMoyNRUniquement===true))){H.push(aParam.ListeMoyennesPeriodes[I].getNote());}
lHtml.push(UtilitaireBulletinEtReleve_Mobile.composePetitBlocDonnees(this.Affichage.listePeriodes.GetLibelle(I),H.join(''),lEstMultiLignes));}}}
if(aEstMoyenneGenerale){aParam.NombrePointsEleve=this.calculerNombrePointsEleve();if(!!this.Affichage.AvecNombrePointsEleve&&aParam.NombrePointsEleve.valeur!==0){lHtml.push(UtilitaireBulletinEtReleve_Mobile.composePetitBlocDonnees(GTraductions.getValeur('BulletinEtReleve.Pts'),aParam.NombrePointsEleve.getNote(),lEstMultiLignes));}
aParam.TotalECTS=this.calculerTotalECTS();if(!!this.Affichage.avecECTS&&aParam.TotalECTS>0){lHtml.push(UtilitaireBulletinEtReleve_Mobile.composePetitBlocDonnees(GTraductions.getValeur('BulletinEtReleve.ECTS'),aParam.TotalECTS,lEstMultiLignes));}} else if(this.Affichage.AvecNombrePointsEleve&&!!aParam.NombrePointsEleve&&aParam.NombrePointsEleve.getNote()!==""){lHtml.push(UtilitaireBulletinEtReleve_Mobile.composePetitBlocDonnees(GTraductions.getValeur('BulletinEtReleve.Pts'),aParam.NombrePointsEleve.getNote(),lEstMultiLignes));}
if(this.Affichage.AvecMoyenneClasse&&!!aParam.MoyenneClasse&&aParam.MoyenneClasse.getNote()!==""){lHtml.push(UtilitaireBulletinEtReleve_Mobile.composePetitBlocDonnees(GTraductions.getValeur('BulletinEtReleve.Classe'),aParam.MoyenneClasse.getNote(),lEstMultiLignes));}
if(!!this.Affichage.AvecMoyenneInfSup&&!!aParam.MoyenneInf&&aParam.MoyenneInf.getNote()!==""){lHtml.push(UtilitaireBulletinEtReleve_Mobile.composePetitBlocDonnees(GTraductions.getValeur('BulletinEtReleve.MoyInf'),aParam.MoyenneInf.getNote(),lEstMultiLignes));}
if(!!this.Affichage.AvecMoyenneInfSup&&!!aParam.MoyenneSup&&aParam.MoyenneSup.getNote()!==""){lHtml.push(UtilitaireBulletinEtReleve_Mobile.composePetitBlocDonnees(GTraductions.getValeur('BulletinEtReleve.MoySup'),aParam.MoyenneSup.getNote(),lEstMultiLignes));}
if(!!this.Affichage.AvecMoyenneMediane&&!!aParam.MoyenneMediane&&aParam.MoyenneMediane.getNote()!==""){lHtml.push(UtilitaireBulletinEtReleve_Mobile.composePetitBlocDonnees(GTraductions.getValeur('BulletinEtReleve.Mediane'),aParam.MoyenneMediane.getNote(),lEstMultiLignes));}
if(this.Affichage.AvecDureeDesAbsenses&&!!aParam.DureeDesAbsences&&aParam.DureeDesAbsences!==""){lHtml.push(UtilitaireBulletinEtReleve_Mobile.composePetitBlocDonnees(GTraductions.getValeur('BulletinEtReleve.RS_HAbs'),aParam.DureeDesAbsences,lEstMultiLignes));}}
if(lHtml.length===0){return false;} else{return lHtml.join('');}}
composeLegende(aService){var lAvecInfoNR=_existeInfoNRPourService.call(this,aService);var lAvecNiveauAcqu=aService.NiveauDAcquisition;var lExisteLegende=lAvecInfoNR||lAvecNiveauAcqu;var lHtml=[];if(lExisteLegende){lHtml.push('<div class="',this.Nom,'_legende legende-conteneur">');lHtml.push('<h5>',GTraductions.getValeur('BulletinEtReleve.Legende'),'</h5>');lHtml.push('<ul>');if(lAvecNiveauAcqu){var lNiveauDAcquisition,lLibelle;const lGenrePositionnement=TypePositionnementUtil.getGenrePositionnementParDefaut(aService.TypePositionnementClasse);for(var i=0;i<GParametres.listeNiveauxDAcquisitions.GetNbrElements();i++){lNiveauDAcquisition=GParametres.listeNiveauxDAcquisitions.GetElement(i);lLibelle=EGenreNiveauDAcquisition.getLibellePositionnement({niveauDAcquisition:lNiveauDAcquisition,avecPositionnementVide:true,genrePositionnement:lGenrePositionnement});if(lLibelle&&EGenreNiveauDAcquisition.getNombrePointsBrevet({niveauDAcquisition:lNiveauDAcquisition}).getValeur()>0){lHtml.push('<li>',EGenreNiveauDAcquisition.getImagePositionnement({niveauDAcquisition:lNiveauDAcquisition,genrePositionnement:lGenrePositionnement}),'<span class="libelle">',lLibelle,'</span>','</li>');}}}
if(lAvecInfoNR){lHtml.push('<li style="display:flex; align-items:flex-start; margin-top:1rem;">',this.moteur.composeHtmlMoyNR(),'<span class="libelle EspaceGauche">',GTraductions.getValeur('Notes.Colonne.HintMoyenneNR'),'</span>','</li>');}
lHtml.push('</ul>');lHtml.push('</div>');}
return lHtml.join('');}
composeAppreciationsService(aService){var lHtml=[];var lNombreAppreciationsSurService=aService.ListeAppreciations.GetNbrElements();for(var I=0;I<lNombreAppreciationsSurService;I++){var lAppreciationSurService=aService.ListeAppreciations.GetElement(I).GetLibelle();if(lAppreciationSurService!==""){var lIntituleAppreciation=this.Affichage.ListeIntitulesAppreciations.GetElement(I).GetLibelle();lHtml.push(UtilitaireBulletinEtReleve_Mobile.composeAppreciation({intituleDAppreciation:lIntituleAppreciation,contenuDAppreciation:lAppreciationSurService,styleBlockIntitule:'color : #616161;',styleBlockContenu:'border:1px solid #616161; background-color: #F1F1F1;'}));}}
return lHtml.join('');}
getNivMaitriseService(aService){if(this.Affichage.AvecNivMaitriseEleve){if(aService.NiveauDAcquisition&&aService.NiveauDAcquisition.existeNumero()){var lNiveauDAcquisition=GParametres.listeNiveauxDAcquisitions.GetElementParNumero(aService.NiveauDAcquisition.GetNumero());return'<div>'+EGenreNiveauDAcquisition.getImagePositionnement({niveauDAcquisition:lNiveauDAcquisition})+'</div>';}}
return'';}
getNoteService(aService,aInfosMoyNR){if(this.Affichage.AvecMoyenneDeliberee||this.Affichage.AvecMoyenneEleve){if(aService.avisReligionPropose&&aService.avisReligionPropose.GetLibelle()!==""){return aService.avisReligionPropose.GetLibelle();} else if(aService.avisReligionDelibere&&aService.avisReligionDelibere.GetLibelle()!==""){return aService.avisReligionDelibere.GetLibelle();} else if(aService.moyenneDeliberee&&aService.moyenneDeliberee.getNote()!==""){return aService.moyenneDeliberee.getNote();} else if(aService.NiveauDAcquisition&&aService.NiveauDAcquisition.existeNumero()&&!this.Affichage.AvecNivMaitriseEleve){var lNiveauDAcquisition=GParametres.listeNiveauxDAcquisitions.GetElementParNumero(aService.NiveauDAcquisition.GetNumero());return'<div style="position: relative; float: right; top: 3px;">'+EGenreNiveauDAcquisition.getImagePositionnement({niveauDAcquisition:lNiveauDAcquisition,genrePositionnement:TypePositionnementUtil.getGenrePositionnementParDefaut(aService.TypePositionnementClasse)})+'</div>';} else if(aService.MoyenneEleve&&aService.MoyenneEleve.getNote()!==""){return aService.MoyenneEleve.getNote();} else{var H=[];if(aInfosMoyNR&&aInfosMoyNR.estMoyNR===true){H.push(this.moteur.composeHtmlMoyNR());}
if(aService.MoyenneEleve&&aService.MoyenneEleve.getNote()!==""){if(!((aService.estMoyNR===true)&&(this.Affichage.avecMoyNRUniquement===true))){H.push(aService.MoyenneEleve.getNote());}}
return H.join(aInfosMoyNR&&aInfosMoyNR.surMemeLigne===true?' ':'<br />');}} else{return"";}}
getMoyenneClasse(aService){if(this.Affichage.AvecMoyenneClasse&&aService.MoyenneClasse&&aService.MoyenneClasse.getNote()!==""){return GTraductions.getValeur('BulletinEtReleve.ClasseAbr')+'&nbsp;'+aService.MoyenneClasse.getNote();} else{return"&nbsp;";}}
getProfesseur(aService){return(!!aService.ListeProfesseurs&&aService.ListeProfesseurs.GetNbrElements()>0?aService.ListeProfesseurs.GetLibelle(0):"");}
getCoefficient(aService){if(this.Affichage.AvecCoefficient&&aService.Coefficient&&aService.Coefficient.getNote()!==""){return GTraductions.getValeur('BulletinEtReleve.Coeff')+aService.Coefficient.getNote();} else{return" ";}}
composeElementProgrammeBulletin(aService){var lHtml=[];if(this.Affichage.avecElementProgramme&&aService.ElementsProgrammeBulletin.GetNbrElements()>0){aService.ElementsProgrammeBulletin.setTri([ObjetTri.init('Libelle')]);aService.ElementsProgrammeBulletin.trier();lHtml.push('<ul class="browser-default">');for(var I=0;I<aService.ElementsProgrammeBulletin.GetNbrElements();I++){if(aService.ElementsProgrammeBulletin.GetElement(I).GetLibelle()!==""){lHtml.push('<li>',aService.ElementsProgrammeBulletin.GetElement(I).GetLibelle(),'</li>');}}
lHtml.push('</ul>');return UtilitaireBulletinEtReleve_Mobile.composeAppreciation({intituleDAppreciation:this.Affichage.intituleElementProgramme,contenuDAppreciation:lHtml,styleBlockIntitule:'color : #616161;',styleBlockContenu:'border:1px solid #616161;'});}
return'';}
surClickProchainElement(aNumeroElement,aEstSuivant,aRegroupementSuivant){var lIndiceElementActuel,lIndiceProchainElement,lProchainElement;if(!!aRegroupementSuivant){lIndiceElementActuel=this.listeRegroupements.GetIndiceParNumeroEtGenre(aNumeroElement);if(!!aEstSuivant){lIndiceProchainElement=lIndiceElementActuel+1<this.listeRegroupements.GetNbrElements()?lIndiceElementActuel+1:0;} else{lIndiceProchainElement=lIndiceElementActuel===0?this.listeRegroupements.GetNbrElements()-1:lIndiceElementActuel-1;}
lProchainElement=this.listeRegroupements.GetElement(lIndiceProchainElement);GInterface.updatePanelContent(this.composePanelRegroupement(lProchainElement));} else{lIndiceElementActuel=this.listeServices.GetIndiceParNumeroEtGenre(aNumeroElement);if(!!aEstSuivant){lIndiceProchainElement=lIndiceElementActuel+1<this.listeServices.GetNbrElements()?lIndiceElementActuel+1:0;} else{lIndiceProchainElement=lIndiceElementActuel===0?this.listeServices.GetNbrElements()-1:lIndiceElementActuel-1;}
lProchainElement=this.listeServices.GetElement(lIndiceProchainElement);GInterface.updatePanelContent(this.composePanelService(lProchainElement));}}
free(...aParams){super.free(...aParams);if(this.identBtnFlottant){$('#'+this.identBtnFlottant.GetNom().escapeJQ()).remove();}}}
function _genererPdf(aService){var lParametrageAffichage={genreGenerationPDF:TypeHttpGenerationPDFSco.Bulletin,periode:this.periodeCourante};GenerationPDF.genererPDF({paramPDF:lParametrageAffichage,optionsPDF:OptionsPdf.Bulletin,cloudCible:aService});}
function _existeInfoNRPourService(aService){var lAvecInfoNR=aService&&(aService.estMoyNR===true||aService.estMoyAnnuelleNR===true);if(lAvecInfoNR!==true&&this.Affichage.AvecMoyennePeriode&&(aService.ListeMoyNRPeriodes!==null)&&(aService.ListeMoyNRPeriodes!==undefined)){for(var lIndice=0;lIndice<this.Affichage.NombreMoyennesPeriodes;lIndice++){if(lAvecInfoNR===false&&aService.ListeMoyNRPeriodes[lIndice]){lAvecInfoNR=true;}}}
return lAvecInfoNR;}
module.exports=ObjetBulletin;},fn:"mobile/script/pagebulletin.js"});;
IE.fModule({f:function(exports,require,module,global){const EGenreMessage={SelectionClasse:0,SelectionGroupe:1,SelectionEleve:2,SelectionService:3,SelectionAppreciation:4,SelectionPeriode:5,AucunElevePourPeriode:6,AucunService:7,AucunAppreciation:8,PasDeNotes:9,SelectionClasseOuGroupe:10,AucunElevePourClasse:11,SelectionPilier:12,AucunClassePourPilier:13,AucunPilierPourEleve:14,AucunBulletinPourEleve:15,AucunRelevePourEleve:16,AucunConseilPourEleve:17,AucunClassePourProfesseur:18,AucunMatierePourClasseProf:19,SelectionPalier:20,AucunPalier:21,SelectionMatiere:22,AucunMatiere:23,SelectionCompetence:24,SelectionSalle:25,AucunElevePourGroupe:26,SelectionDisciplineLivret:27,AucuneDiciplineLivret:28,SelectionProfesseur:29,AucuneClasseDisponible:30,AucunBulletinDeCompetencesPourEleve:31,AucuneSalleDisponible:32,SelectionPersonnel:33,SelectionMateriel:34,AucunMaterielDisponible:35,AucunePeriodes:36,SelectionSousMatiere:37};module.exports=EGenreMessage;},fn:"enumere_message.js"});;
IE.fModule({f:function(exports,require,module,global){const{ObjetRequeteConsultation}=require('ObjetRequeteJSON.js');const MethodesTableau=require('MethodesTableau.js');const ObjetElement=require('ObjetElement.js');const ObjetListeElements=require('ObjetListeElements.js');const ObjetTri=require('ObjetTri.js');const TypeNote=require('TypeNote.js');class _ObjetRequeteResultat extends ObjetRequeteConsultation{constructor(...aParams){super(...aParams);}
CreerListeServices(aJSON){function getCoefficient(T){let R=0;for(const I in T){if(T[I].Coefficient){const V=T[I].Coefficient.getValeur();if(!isNaN(V)){R+=V;}}}
return new TypeNote(R);}
function getMoyenne(T,aNom,aArrondi){let R=0,N=0;for(const I in T){const lExiste=T[I][aNom];if(lExiste){const V=T[I][aNom].getValeur();if(!isNaN(V)){R+=T[I].Coefficient.getValeur()*V;N+=T[I].Coefficient.getValeur();}} else if(T[I].ListeElements&&T[I].ListeElements.GetNbrElements()>0){T[I].ListeElements.parcourir(function(aEle){const lExiste=aEle[aNom];if(lExiste){const V=aEle[aNom].getValeur();if(!isNaN(V)){R+=aEle.Coefficient.getValeur()*V;N+=aEle.Coefficient.getValeur();}}});}}
const lNote=N>0?new TypeNote(R/N):new TypeNote('');return aArrondi?new TypeNote(aArrondi.arrondir(lNote.getValeur())):lNote;}
function getNombreDevoirs(T){let R1=0,R2=0,N=0;for(const I in T){if((T[I])&&T[I].NombreDevoirs){R1+=parseInt(T[I].NombreDevoirs.split('/')[0]);R2+=parseInt(T[I].NombreDevoirs.split('/')[1]);N++;}}
return N>0?R1+(isNaN(R2)?'':'/'+R2):'';}
function getNombrePointsEleve(T){let R=0;for(const I in T){if((T[I])&&T[I].NombrePointsEleve){R+=T[I].NombrePointsEleve.getValeur();}}
return new TypeNote(R>0?R:'');}
function calculerEstDebutRegroupement(aListeElements,aTableauDebutRegroupement){for(let I=0;I<aListeElements.GetNbrElements();I++){const lElement=aListeElements.GetElement(I);if(!!lElement.SurMatiere){const lNumeroSurMatiere=lElement.SurMatiere.GetNumero();const lCleSurMatiere=lNumeroSurMatiere+'_'+lElement.OrdreRegroupement;if(lElement.SurMatiere.existeNumero()&&(lElement.OrdreDansRegroupement===aTableauDebutRegroupement[lCleSurMatiere])){lElement.estDebutRegroupement=true;}}
if(lElement.ListeElements){calculerEstDebutRegroupement(lElement.ListeElements,aTableauDebutRegroupement);}}}
this.ServiceEditable=aJSON.Editable;this.ExisteDevoir=false;this.ExisteService=false;this.NbrMaxServices=0;this.NbrMaxDevoirs=0;this.tableauSurMatieres=[];this.tableauDebutRegroupement=[];const lThis=this;this.ListeElements=aJSON.ListeServices;if(!!this.ListeElements){this.ListeElements.parcourir(function(aService){_composeDonneesService.call(lThis,aJSON,aService);});_trierListeServices(this.ListeElements);}
this.listeSurMatieres=aJSON.ListeSurMatieres;if(!!this.listeSurMatieres){this.listeSurMatieres.parcourir(function(aMatiere){const lNumeroSurMatiere=aMatiere.GetNumero();if(lThis.tableauSurMatieres[lNumeroSurMatiere]){lThis.tableauSurMatieres[lNumeroSurMatiere].Arrondi=aMatiere.Arrondi;lThis.tableauSurMatieres[lNumeroSurMatiere].MoyenneClasse=aMatiere.MoyenneClasse;lThis.tableauSurMatieres[lNumeroSurMatiere].MoyenneInf=aMatiere.MoyenneInf;lThis.tableauSurMatieres[lNumeroSurMatiere].MoyenneSup=aMatiere.MoyenneSup;lThis.tableauSurMatieres[lNumeroSurMatiere].MoyenneMediane=aMatiere.MoyenneMediane;}});}
calculerEstDebutRegroupement(this.ListeElements,this.tableauDebutRegroupement);for(const lNumero in this.tableauSurMatieres){this.tableauSurMatieres[lNumero].Coefficient=getCoefficient(this.tableauSurMatieres[lNumero].tableauServices);this.tableauSurMatieres[lNumero].NombreDevoirs=getNombreDevoirs(this.tableauSurMatieres[lNumero].tableauServices);this.tableauSurMatieres[lNumero].NombrePointsEleve=getNombrePointsEleve(this.tableauSurMatieres[lNumero].tableauServices);this.tableauSurMatieres[lNumero].MoyenneAnnuelle=null;this.tableauSurMatieres[lNumero].MoyenneEleve=getMoyenne(this.tableauSurMatieres[lNumero].tableauServices,'MoyenneEleve',this.tableauSurMatieres[lNumero].Arrondi);this.tableauSurMatieres[lNumero].ListeMoyennesPeriodes=[];for(let I=0;I<aJSON.ParametresAffichages.NombreMoyennesPeriodes;I++){this.tableauSurMatieres[lNumero].ListeMoyennesPeriodes[I]=null;}}
const lNouvelleListeMoyennePeriodes=[];const lGeneral=this.JSONReponse.General;if(!!lGeneral){if(!!lGeneral.ListeMoyennesPeriodes){MethodesTableau.parcourir(lGeneral.ListeMoyennesPeriodes,function(aMoyennePeriode){lNouvelleListeMoyennePeriodes.push(new TypeNote(aMoyennePeriode));});}
lGeneral.ListeMoyennesPeriodes=lNouvelleListeMoyennePeriodes;}}}
function _trierListeServices(aListe){if(!aListe){return;}
aListe.setTri([
ObjetTri.init('OrdreRegroupement'),ObjetTri.init('OrdreDansRegroupement'),ObjetTri.init('Matiere.Libelle'),ObjetTri.init(function(D){return D.ListeProfesseurs&&D.ListeProfesseurs.GetNbrElements()?D.ListeProfesseurs.GetLibelle(0):'';})
]).trier();}
function _composeDonneesService(aJSON,aService,aEstSousService){this.ExisteService=true;if(!aService.ListeNiveauDAcquisitionPeriodes){aService.ListeNiveauDAcquisitionPeriodes=new ObjetListeElements();}
if(!aService.SurMatiere){aService.SurMatiere=new ObjetElement('',0);}
const lNouvelleListeMoyennePeriodes=[];if(!!aService.ListeMoyennesPeriodes){MethodesTableau.parcourir(aService.ListeMoyennesPeriodes,function(aMoyennePeriode){lNouvelleListeMoyennePeriodes.push(new TypeNote(aMoyennePeriode));});}
aService.ListeMoyennesPeriodes=lNouvelleListeMoyennePeriodes;if(!!aService.SurMatiere&&aService.SurMatiere.existeNumero()){const lCleSurMatiere=aService.SurMatiere.GetNumero()+'_'+aService.OrdreRegroupement;if((this.tableauDebutRegroupement[lCleSurMatiere]===null||this.tableauDebutRegroupement[lCleSurMatiere]===undefined)||(aService.OrdreDansRegroupement<this.tableauDebutRegroupement[lCleSurMatiere])){this.tableauDebutRegroupement[lCleSurMatiere]=aService.OrdreDansRegroupement;}
if(aService.AvecMoyenneRegroupement&&!aEstSousService){const lNumeroSurMatiere=aService.SurMatiere.GetNumero();if(this.tableauSurMatieres[lNumeroSurMatiere]===null||this.tableauSurMatieres[lNumeroSurMatiere]===undefined){this.tableauSurMatieres[lNumeroSurMatiere]={};this.tableauSurMatieres[lNumeroSurMatiere].tableauServices=[];}
this.tableauSurMatieres[lNumeroSurMatiere].tableauServices.push(aService);}}
if(!!aService.ListeElements&&aService.ListeElements.GetNbrElements()>0){aJSON.ParametresAffichages.AvecSousService=true;const lThis=this;aService.ListeElements.parcourir(function(aSousService){_composeDonneesService.call(lThis,aJSON,aSousService,true);});_trierListeServices(aService.ListeElements);} else{this.NbrMaxServices++;}
if(!!aService.ListeDevoirs&&aService.ListeDevoirs.GetNbrElements()>0){this.ExisteDevoir=true;aService.ListeDevoirs.parcourir(function(aDevoir){if(!!aDevoir.ExcecutionQCM){aDevoir.executionQCM=aDevoir.ExcecutionQCM;}
if(!!aDevoir.ExecKiosque){aDevoir.execKiosque=aDevoir.ExecKiosque;}});aService.ListeDevoirs.setTri([ObjetTri.init('Date',true),ObjetTri.init('Position')]);aService.ListeDevoirs.trier();if(!aService.ListeElements||aService.ListeElements.GetNbrElements()===0){this.NbrMaxDevoirs=Math.max(this.NbrMaxDevoirs,aService.ListeDevoirs.GetNbrElements());}}}
module.exports=_ObjetRequeteResultat;},fn:"_objetrequeteresultat.js"});;
IE.fModule({f:function(exports,require,module,global){const ObjetElement=require('ObjetElement.js');const ObjetListeElements=require('ObjetListeElements.js');const MethodesTableau=require('MethodesTableau.js');class UtilitaireDeserialiserPiedBulletin{creerAbsences(aJSON){return{strAbsences:!!aJSON.ListeAbsences?(aJSON.ListeAbsences.strAbsences||''):'',strRetards:!!aJSON.ListeAbsences?(aJSON.ListeAbsences.strRetards||''):'',strPunitions:!!aJSON.ListeAbsences?(aJSON.ListeAbsences.strPunitions||''):'',strSanctions:!!aJSON.ListeAbsences?(aJSON.ListeAbsences.strSanctions||''):''};}
creerPiedDePage(aJSON){const lResult={};if(aJSON&&!!aJSON.ListeProjets){lResult.ListeProjets=aJSON.ListeProjets;}
if(aJSON&&!!aJSON.Orientation){lResult.Orientation=aJSON.Orientation;}
if(aJSON&&!!aJSON.ListeAttestations){lResult.ListeAttestations=aJSON.ListeAttestations;}
if(aJSON&&!!aJSON.listeAttestationsEleve){lResult.ListeAttestationsEleve=aJSON.listeAttestationsEleve;lResult.eleve=aJSON.eleve;}
if(aJSON&&!!aJSON.ObjetListeAppreciations){lResult.ListeAppreciations={general:new ObjetListeElements(),conseilDeClasse:new ObjetListeElements(),commentaires:new ObjetListeElements(),cpe:new ObjetListeElements(),appreciationAnnuelle:new ObjetListeElements(),generalAnnuelle:new ObjetListeElements(),periodes:new ObjetListeElements()};lResult.avecSaisieAG=aJSON.ObjetListeAppreciations.Editable;lResult.periodeCloture=aJSON.ObjetListeAppreciations.Cloture;if(!!aJSON.ObjetListeAppreciations.ListeAppreciations){aJSON.ObjetListeAppreciations.ListeAppreciations.parcourir(function(D){const lElement=new ObjetElement();lElement.Intitule=D.Intitule;lElement.Editable=aJSON.ObjetListeAppreciations.Editable;lElement.Cloture=aJSON.ObjetListeAppreciations.Cloture;lElement.Genre=D.GetGenre();lElement.ListeAppreciations=new ObjetListeElements();lElement.ListeAppreciations.AddElement(D);if(lElement.Genre===0){lResult.ListeAppreciations.general.AddElement(lElement);} else if(lElement.Genre===1||lElement.Genre===2||lElement.Genre===3||lElement.Genre===8){lResult.ListeAppreciations.conseilDeClasse.AddElement(lElement);} else if(lElement.Genre===4||lElement.Genre===5||lElement.Genre===6){lResult.ListeAppreciations.commentaires.AddElement(lElement);} else if(lElement.Genre===7){lResult.ListeAppreciations.cpe.AddElement(lElement);}});}
if(!!aJSON.ObjetListeAppreciations.listePeriodes){aJSON.ObjetListeAppreciations.listePeriodes.parcourir(function(D){lResult.ListeAppreciations.periodes.AddElement(D);});lResult.ListeAppreciations.appreciationAnnuelle=_formatListeAppreciationAnnuelle(aJSON.ObjetListeAppreciations.listePeriodes,false);lResult.ListeAppreciations.generalAnnuelle=_formatListeAppreciationAnnuelle(aJSON.ObjetListeAppreciations.listePeriodes,true);}}
if(aJSON&&aJSON.listePiliers){lResult.listePiliers=aJSON.listePiliers;lResult.avecValidationAuto=aJSON.avecValidationAuto;}
if(aJSON){lResult.listeMentions=aJSON.listeMentions;}
if(aJSON&&!!aJSON.ListeStages){lResult.listeStages=aJSON.ListeStages;}
if(aJSON&&!!aJSON.ListeMentionsClasse){lResult.ListeMentionsClasse=aJSON.ListeMentionsClasse;}
if(aJSON&&!!aJSON.ParcoursEducatif){lResult.libelleUtilisateur=aJSON.ParcoursEducatif.libelleUtilisateur;lResult.listeEvntsParcoursPeda=aJSON.ParcoursEducatif.listeParcours;lResult.listeGenreParcours=aJSON.ParcoursEducatif.listeGenreParcours;}
lResult.legende=aJSON.Legende;lResult.listeCredits=aJSON.listeCredits;return lResult;}}
function _formatListeAppreciationAnnuelle(aListePeriode,aGlobal){const lAppreciations=new ObjetListeElements();const lGenreAppreciation=[];aListePeriode.parcourir(function(periode){const lListeAppreciation=(aGlobal)?periode.listeAppreciationsGenerales:periode.listeAppreciations;if(lListeAppreciation){lListeAppreciation.parcourir(function(D){if(MethodesTableau.existe(D.GetGenre(),lGenreAppreciation)){const lListeIntitule=lAppreciations.GetElementParGenre(D.GetGenre()).Intitule;if(!MethodesTableau.existe(D.Intitule,lListeIntitule)){lAppreciations.GetElementParGenre(D.GetGenre()).Intitule.push(D.Intitule);}} else{lGenreAppreciation.push(D.GetGenre());const lElement=new ObjetElement();lElement.Intitule=[D.Intitule];lElement.Editable=D.Editable;lElement.Cloture=D.cloture;lElement.Genre=D.GetGenre();lElement.global=aGlobal;lAppreciations.AddElement(lElement);}});}});return lAppreciations;}
module.exports=UtilitaireDeserialiserPiedBulletin;},fn:"utilitairedeserialiserpiedbulletin.js"});;
IE.fModule({f:function(exports,require,module,global){const _ObjetRequeteResultat=require('_ObjetRequeteResultat.js');const Requetes=require('CollectionRequetes.js');const ObjetElement=require('ObjetElement.js');const UtilitaireDeserialiserPiedBulletin=require('UtilitaireDeserialiserPiedBulletin.js');class ObjetRequetePageBulletins extends _ObjetRequeteResultat{constructor(...aParams){super(...aParams);}
lancerRequete(aParam){const lParam={eleve:new ObjetElement(),classe:new ObjetElement(),periode:new ObjetElement()};$.extend(lParam,aParam);this.JSON={eleve:lParam.eleve,periode:lParam.periode,classe:lParam.classe};return this.appelAsynchrone();}
actionApresRequete(){const lParam={aCopier:{},absences:{}};lParam.Message=this.JSONReponse.Message;if(!lParam.Message){lParam.aCopier.classe=this.JSONReponse.Classe;lParam.aCopier.strInfoDatePublication=this.JSONReponse.strInfoDatePublication;if((this.JSONReponse.NoteBareme!==null)&&(this.JSONReponse.NoteBareme!==undefined)){lParam.aCopier.baremeNotationNiveau=this.JSONReponse.NoteBareme;}
const lExisteServiceAvecNotes=this.JSONReponse.existeServiceAvecNotes;const lExisteServiceSansNotes=this.JSONReponse.existeServiceSansNotes;lParam.aCopier.Affichage=this.JSONReponse.ParametresAffichages;lParam.aCopier.Affichage.existeServiceAvecNotes=lExisteServiceAvecNotes;lParam.aCopier.Affichage.existeServiceSansNotes=lExisteServiceSansNotes;lParam.aCopier.Affichage.pourClasseAvecNotes=lExisteServiceAvecNotes&&!lExisteServiceSansNotes;lParam.aCopier.Affichage.pourClasseSansNotes=!lExisteServiceAvecNotes&&lExisteServiceSansNotes;if(lExisteServiceSansNotes){lParam.aCopier.Affichage.posClasse=this.JSONReponse.TypePositionnementClasse;}
this.CreerListeServices(this.JSONReponse);lParam.aCopier.ServiceEditable=this.ServiceEditable;lParam.aCopier.ExisteDevoir=this.ExisteDevoir;lParam.aCopier.ExisteService=this.ExisteService;lParam.aCopier.NbrMaxServices=this.NbrMaxServices;lParam.aCopier.NbrMaxDevoirs=this.NbrMaxDevoirs;lParam.aCopier.tableauSurMatieres=this.tableauSurMatieres;lParam.aCopier.tableauDebutRegroupement=this.tableauDebutRegroupement;lParam.aCopier.ListeElements=this.ListeElements;lParam.aCopier.listeAnnotations=this.JSONReponse.listeAnnotations;lParam.aCopier.MoyenneGenerale=this.JSONReponse.General;lParam.aCopier.graph=this.JSONReponse.graphe;lParam.aCopier.baremeParDefaut=this.JSONReponse.baremeParDefaut;$.extend(lParam.absences,new UtilitaireDeserialiserPiedBulletin().creerAbsences(this.JSONReponse));lParam.aCopier.PiedDePage=new UtilitaireDeserialiserPiedBulletin().creerPiedDePage(this.JSONReponse);lParam.aCopier.listeAccusesReception=this.JSONReponse.listeAccusesReception;}
this.callbackReussite.appel(lParam);}}
Requetes.inscrire('PageBulletins',ObjetRequetePageBulletins);module.exports=ObjetRequetePageBulletins;},fn:"objetrequetepagebulletins.js"});;
IE.fModule({f:function(exports,require,module,global){const GHtml=require('GHtml.js');const InterfacePage_Mobile=require('InterfacePage_Mobile.js');const ObjetElement=require('ObjetElement.js');const ObjetListeElements=require('ObjetListeElements.js');const ObjetSelection=require('ObjetSelection.js').ObjetSelection;const GTraductions=require('ObjetTraduction.js');const ObjetBulletin=require('mobile/script/PageBulletin.js');const EGenreMessage=require('Enumere_Message.js');const ObjetRequetePageBulletins=require('ObjetRequetePageBulletins.js');const MethodesTableau=require('MethodesTableau.js');const EGenreEspace=require('Enumere_Espace.js');const ObjetRequeteSaisieBulletin=require('ObjetRequeteSaisieBulletin.js');const{TypeDroits}=require('ObjetDroitsPN.js');class InterfacePageBulletin extends InterfacePage_Mobile{constructor(...aParams){super(...aParams);this.listePeriodes=new ObjetListeElements();this.periodeCourant=new ObjetElement();this.indiceParDefaut=0;this.swipeActif=true;this.avecGestionAccuseReception=MethodesTableau.existe(GEtatUtilisateur.GenreEspace,[EGenreEspace.Mobile_Parent])&&(GApplication.droits.get(TypeDroits.fonctionnalites.gestionARBulletins));}
getControleur(aInstance){return $.extend(true,super.getControleur(this),{visibiliteAR:function(){var lResponsableAR=this._getResponsableAccuseReception();return!this.avecMessage&&this.avecGestionAccuseReception&&!!lResponsableAR;}.bind(aInstance),cbAccuseReception:{getValue:function(){var lResponsableAR=this._getResponsableAccuseReception();return!!lResponsableAR?lResponsableAR.aPrisConnaissance:false;}.bind(aInstance),setValue:function(aValue){var lResponsableAR=this._getResponsableAccuseReception();if(!!lResponsableAR){lResponsableAR.aPrisConnaissance=aValue;new ObjetRequeteSaisieBulletin(this).lancerRequete({periode:this.periodeCourant,aPrisConnaissance:aValue});}}.bind(aInstance),getDisabled:function(){var lResponsableAR=this._getResponsableAccuseReception();return!!lResponsableAR?lResponsableAR.aPrisConnaissance:true;}.bind(aInstance)}});}
_getResponsableAccuseReception(){var lReponsableAccuseReception=null;if(!!this.listeAccusesReception&&this.listeAccusesReception.GetNbrElements()>0){lReponsableAccuseReception=this.listeAccusesReception.GetPremierElement()
;if(!!lReponsableAccuseReception){}}
return lReponsableAccuseReception;}
ConstruireInstances(){this.identSelection=this.Add(ObjetSelection,this.evenementSelection);this.identPage=this.Add(ObjetBulletin,null,function(aInstance){aInstance.setSwipeActif=function(aActif){this.swipeActif=aActif;}.bind(this);});this.AddSurZone=[this.identSelection];if(this.avecGestionAccuseReception){this.AddSurZone.push({html:_getHtmlCBAccuseReception.call(this)});}}
DetruireInstances(){}
evenementSwipe(event){if(this.swipeActif){if(event.type==='swiperight'){this.GetInstance(this.identSelection).surPrecedent();} else{this.GetInstance(this.identSelection).surSuivant();}}}
RecupererDonnees(){var lOngletInfosPeriodes=GEtatUtilisateur.getOngletInfosPeriodes();var lNrPeriodeParDefaut;if(lOngletInfosPeriodes.message){this.GetInstance(this.identPage).SetMessage(lOngletInfosPeriodes.message);} else{this.listePeriodes=lOngletInfosPeriodes.listePeriodes;if(!(this.listePeriodes&&this.listePeriodes.GetNbrElements())){var lGenreMessage=EGenreMessage.AucunBulletinPourEleve;var lMessage=typeof(lGenreMessage)==='number'?GTraductions.getValeur('Message')[lGenreMessage]:lGenreMessage;var lHtml=[];lHtml.push(this.composeAucuneDonnee(lMessage));GHtml.setHtml(this.Nom,lHtml);} else{if(GEtatUtilisateur.getPeriodePourBulletin()){lNrPeriodeParDefaut=GEtatUtilisateur.getPeriodePourBulletin();} else{lNrPeriodeParDefaut=GEtatUtilisateur.getPage()&&GEtatUtilisateur.getPage().periode?GEtatUtilisateur.getPage().periode.GetNumero():lOngletInfosPeriodes.periodeParDefaut.GetNumero();}
this.indiceParDefaut=this.listePeriodes.GetIndiceParNumeroEtGenre(lNrPeriodeParDefaut);if(!this.indiceParDefaut){this.indiceParDefaut=0;}
this.periodeCourant=this.listePeriodes.GetElement(this.indiceParDefaut);this.GetInstance(this.identSelection).SetDonnees(this.listePeriodes,this.indiceParDefaut,this.GetInstance(this.identPage).GetNom(),'');$('#'+this.GetInstance(this.identPage).GetNom().escapeJQ()).css('min-height',((parseInt($('#'+this.Nom.escapeJQ()).css('min-height'))-$('#'+this.GetInstance(this.identSelection).GetNom().escapeJQ()).height())*0.9)+'px');}}
if(GEtatUtilisateur.getPeriodePourBulletin()){GEtatUtilisateur.setPeriodePourBulletin(null);}}
RecupererDonneesBulletin(){new ObjetRequetePageBulletins(this,this.ActionSurRecupBulletin).lancerRequete({eleve:GEtatUtilisateur.getMembre(),periode:this.periodeCourant});}
ActionSurRecupBulletin(aParam){this.graph='';this.avecMessage=!!aParam.Message;if(this.avecMessage){this.GetInstance(this.identPage).SetMessage(aParam.Message);} else{$.extend(this,aParam.aCopier);this.GetInstance(this.identPage).SetDonnees(this.ListeElements,this.positionPeriodeCourant,this.listePeriodes.GetNbrElements()-1,this.tableauSurMatieres,this.MoyenneGenerale,aParam.absences,this.PiedDePage,this.Affichage,this.periodeCourant);}
this.actionAppliMobile();}
actionAppliMobile(){}
evenementSelection(aParam){this.periodeCourant=aParam.element;this.positionPeriodeCourant=this.listePeriodes.GetIndiceParElement(this.periodeCourant);this.RecupererDonneesBulletin();}}
function _getHtmlCBAccuseReception(){var lHtml=[];lHtml.push('<div style="padding: 0.5rem;">','<ie-checkbox ie-textright class="AlignementMilieuVertical" ie-model="cbAccuseReception" ie-display="visibiliteAR">',GTraductions.getValeur('BulletinEtReleve.JAiPrisConnaissanceDuBulletin'),'</ie-checkbox>','</div>');return lHtml.join('');}
module.exports=InterfacePageBulletin;},fn:"interfacepagebulletin.js"});;
IE.fModule({f:function(exports,require,module,global){const ObjetIdentite_Mobile=require('ObjetIdentite_Mobile.js');const ObjetListeElements=require('ObjetListeElements.js');class ObjetAffichageDonneesListe_Mobile extends ObjetIdentite_Mobile{constructor(...aParams){super(...aParams);this.listeHtml=new ObjetListeElements();}
ConstruireAffichage(){var lHtml=[];if(this.listeHtml&&this.listeHtml.GetNbrElements()){lHtml.push('<ul class="collection with-header bg-white">');this.listeHtml.parcourir((function(aEle){if(aEle.estUnDeploiement){lHtml.push('<li class="collection-header">'+aEle.GetLibelle()+'</li>');} else{var lResult=this.fonctionAffichage(aEle);if(!!lResult){lHtml.push('<li class="collection-item" style="min-height: 4rem;">'+lResult+'</li>');}}}).bind(this));lHtml.push('</ul>');}
return lHtml.join('');}
SetDonnees(aListe,aFonction){this.listeHtml=aListe;this.fonctionAffichage=aFonction;this.Afficher();}}
module.exports=ObjetAffichageDonneesListe_Mobile;},fn:"mobile/script/objetaffichagedonneesliste_mobile.js"});;
IE.fModule({f:function(exports,require,module,global){const{ObjetRequeteConsultation}=require('ObjetRequeteJSON.js');const Requetes=require('CollectionRequetes.js');const ObjetElement=require('ObjetElement.js');const GTraductions=require('ObjetTraduction.js');const ObjetTri=require('ObjetTri.js');const EGenreRessource=require('Enumere_Ressource.js');class ObjetRequetePageEquipePedagogique extends ObjetRequeteConsultation{constructor(...aParams){super(...aParams);}
lancerRequete(aParametres){$.extend(this.JSON,aParametres);return this.appelAsynchrone();}
actionApresRequete(){let lCumul,lAvecEnseignant,lAvecEnseignantEnleve,lAvecPersonnel;const lListe=this.JSONReponse.liste;lListe.parcourir(function(aElement){if((aElement.GetGenre()===EGenreRessource.Enseignant)&&!aElement.estEnleve){lAvecEnseignant=true;}
if(aElement.GetGenre()===EGenreRessource.Enseignant&&aElement.estEnleve){lAvecEnseignantEnleve=true;}
if(aElement.GetGenre()===EGenreRessource.Personnel){lAvecPersonnel=true;}
if(aElement.matieres){aElement.matieres.setTri([ObjetTri.init(function(D){return D.estUneSousMatiere?D.libelleMatiere:D.GetLibelle();}),ObjetTri.init(function(D){return!!D.estUneSousMatiere;}),ObjetTri.init('Libelle')]);aElement.matieres.trier();}});if(lAvecEnseignant&&(lAvecEnseignantEnleve||lAvecPersonnel)){lCumul=new ObjetElement(GTraductions.getValeur('EquipePedagogique.professeursDEquipe'));lCumul.Genre=EGenreRessource.Enseignant;lCumul.estUnDeploiement=true;lCumul.estDeploye=true;lListe.AddElement(lCumul);}
if(lAvecEnseignantEnleve){lCumul=new ObjetElement(GTraductions.getValeur('EquipePedagogique.autresProfesseursDEquipe'));lCumul.Genre=EGenreRessource.Enseignant;lCumul.estUnDeploiement=true;lCumul.estDeploye=true;lCumul.estEnleve=true;lListe.AddElement(lCumul);}
if(lAvecPersonnel){lCumul=new ObjetElement(GTraductions.getValeur('EquipePedagogique.personnelsDEquipe'));lCumul.Genre=EGenreRessource.Personnel;lCumul.estUnDeploiement=true;lCumul.estDeploye=true;lListe.AddElement(lCumul);}
lListe.setTri([
ObjetTri.init(function(D){return D.GetGenre()===EGenreRessource.Enseignant?false:true;}),ObjetTri.init(function(D){return D.estEnleve?true:false;}),ObjetTri.init(function(D){return D.Position;})
]);lListe.trier();this.callbackReussite.appel(lListe);}}
Requetes.inscrire('PageEquipePedagogique',ObjetRequetePageEquipePedagogique);module.exports=ObjetRequetePageEquipePedagogique;},fn:"objetrequetepageequipepedagogique.js"});;
IE.fModule({f:function(exports,require,module,global){const ObjetAffichageDonneesListe_Mobile=require('mobile/script/ObjetAffichageDonneesListe_Mobile.js');const ObjetRequetePageEquipePedagogique=require('ObjetRequetePageEquipePedagogique.js');const MethodesObjet=require('MethodesObjet.js');const InterfacePage_Mobile=require('InterfacePage_Mobile.js');const ObjetElement=require('ObjetElement.js');const ObjetListeElements=require('ObjetListeElements.js');const ObjetTabOnglets=require('ObjetTabOnglets.js');const GTraductions=require('ObjetTraduction.js');const ObjetTri=require('ObjetTri.js');const EGenreRessource=require('Enumere_Ressource.js');class ObjetAffichageEquipePedagogique extends InterfacePage_Mobile{constructor(...aParams){super(...aParams);this.listeTabs=new ObjetListeElements();}
ConstruireInstances(){this.identTabs=this.Add(ObjetTabOnglets);this.identObjetEquipePedaParNom=this.Add(ObjetAffichageDonneesListe_Mobile);var lElement=new ObjetElement(GTraductions.getValeur('EquipePedagogique.liste.titre.nom'),null,EGenreRessource.Personnel,null,false);lElement.idDiv=this.GetInstance(this.identObjetEquipePedaParNom).GetNom();this.listeTabs.AddElement(lElement);this.identObjetEquipePedaParMatiereFonction=this.Add(ObjetAffichageDonneesListe_Mobile);lElement=new ObjetElement(GTraductions.getValeur('EquipePedagogique.liste.titre.matiereFonction'),null,EGenreRessource.Specialite,null,false);lElement.idDiv=this.GetInstance(this.identObjetEquipePedaParMatiereFonction).GetNom();this.listeTabs.AddElement(lElement);this.AddSurZone=[this.identTabs];}
RecupererDonnees(){new ObjetRequetePageEquipePedagogique(this,this.actionSurRecupererDonnees).lancerRequete();}
actionSurRecupererDonnees(aListeEquipePedagogique){if(!!aListeEquipePedagogique){this.listeEquipeParNom=aListeEquipePedagogique;this.listeEquipeParMatiereEtFonction=formaterListeParMatiereEtFonction(aListeEquipePedagogique);this.listeTabs.GetElementParGenre(EGenreRessource.Personnel).Actif=true;this.listeTabs.GetElementParGenre(EGenreRessource.Specialite).Actif=true;this.AfficherDonnees();this.GetInstance(this.identTabs).SetDonnees(this.listeTabs,0);}}
AfficherDonnees(){var lLibelleProfesseur,lLibellesPPEtTuteur,lMail;this.GetInstance(this.identObjetEquipePedaParNom).SetDonnees(this.listeEquipeParNom,function(aElem){var lHtml=[];if(aElem.GetGenre()===EGenreRessource.Enseignant){var lProf=aElem,lNbrMatieres=lProf.matieres.GetNbrElements();lMail=lProf.email;lLibellesPPEtTuteur=getArrayLibellesProfPrincipalEtTuteur(lProf);lLibelleProfesseur=lProf.GetLibelle();if(lLibellesPPEtTuteur.length>0){lHtml.push('<div class="right">',lLibellesPPEtTuteur.join('<br>'),'</div>');}
lHtml.push('<div class="title">',lLibelleProfesseur,'</div>');for(var m=0;m<lNbrMatieres;m++){var lMatiere=lProf.matieres.GetElement(m),lLibelleMatiere=lMatiere.GetLibelle(),lVolumeHoraire=lMatiere.volumeHoraire?'&nbsp;('+lMatiere.volumeHoraire+')':'';lHtml.push('<div style="',(lMatiere.estUneSousMatiere?'text-indent:15px;':''),'">',lLibelleMatiere+lVolumeHoraire,'</div>');}
if(!!lMail){lHtml.push('<a class="link" href="mailto:'+lMail+'">',lMail,'</a>');}} else if(aElem.GetGenre()===EGenreRessource.Personnel){var lPersonnel=aElem,lLibellePersonnel=lPersonnel.GetLibelle(),lFonction=lPersonnel.fonction;lMail=lPersonnel.email,lHtml.push('<div class="title" >',lLibellePersonnel,'</div>');lHtml.push('<div>',lFonction,'</div>');if(!!lMail){lHtml.push('<a class="link" href="mailto:'+lMail+'">'+lMail,'</a>');}}
return lHtml.join('');});this.GetInstance(this.identObjetEquipePedaParMatiereFonction).SetDonnees(this.listeEquipeParMatiereEtFonction,function(aElem){var lHtml=[];if(aElem.GetGenre()===EGenreRessource.Enseignant){var lService=aElem,lListeProfesseurs=lService.listeProfesseurs,lVolumeHoraire=lService.volumeHoraire?'&nbsp;('+lService.volumeHoraire+')':'';lHtml.push('<div class="title">',lService.GetLibelle()+lVolumeHoraire,'</div>');for(var p=0,lNbrProfDuService=lListeProfesseurs.GetNbrElements();p<lNbrProfDuService;p++){var lEstProfDeSousService=false,lProfDeService=lListeProfesseurs.GetElement(p),lListeServicesDuProf=lProfDeService.matieres;for(var l=0,lNbrServicesesDuProf=lListeServicesDuProf.GetNbrElements();l<lNbrServicesesDuProf;l++){var lServiceDuProf=lListeServicesDuProf.GetElement(l);if(lServiceDuProf.servicePere&&lServiceDuProf.servicePere.GetNumero()===lService.GetNumero()){lEstProfDeSousService=true;}}
if(!lEstProfDeSousService){var lVolumeHoraireDuProf='';if(lNbrProfDuService!==1){lVolumeHoraireDuProf=lProfDeService.volumeHoraire?'&nbsp;('+lProfDeService.volumeHoraire+')':'';}
lHtml.push('<div>');lLibellesPPEtTuteur=getArrayLibellesProfPrincipalEtTuteur(lProfDeService);if(lLibellesPPEtTuteur.length>0){lHtml.push('<div class="right">',lLibellesPPEtTuteur.join('<br>'),'</div>');}
lHtml.push('<div>',lProfDeService.GetLibelle()+lVolumeHoraireDuProf,'</div>');if(!!lProfDeService.eMail){lHtml.push('<a class="link" href="mailto:'+lProfDeService.email+'">'+lProfDeService.eMail+'</a>');}
lHtml.push('</div>');}}
for(var j=0,lNbProfesseursDeMatiere=lListeProfesseurs.GetNbrElements();j<lNbProfesseursDeMatiere;j++){var lProfDeSousService=lListeProfesseurs.GetElement(j),lListeSousServicesDuProf=lProfDeSousService.matieres;lLibellesPPEtTuteur=getArrayLibellesProfPrincipalEtTuteur(lProfDeService);for(var K=0,lNbServicesesDuProf=lListeSousServicesDuProf.GetNbrElements();K<lNbServicesesDuProf;K++){var lSousServiceDuProf=lListeSousServicesDuProf.GetElement(K);if(lSousServiceDuProf.servicePere&&lSousServiceDuProf.servicePere.GetNumero()===lService.GetNumero()){var lVolumeHoraireSousMatiereDuProf=lSousServiceDuProf.volumeHoraire?'('+lSousServiceDuProf.volumeHoraire+')':'';lHtml.push('<div class="title">',lSousServiceDuProf.GetLibelle()+lVolumeHoraireSousMatiereDuProf,'</div>');var lVolumeHoraireDuProfSousService=lProfDeSousService.volumeHoraire?'&nbsp;('+lProfDeSousService.volumeHoraire+')':'';lHtml.push('<div>');if(lLibellesPPEtTuteur.length>0){lHtml.push('<div class="right">',lLibellesPPEtTuteur.join('<br>'),'</div>');}
lHtml.push('<div>',lProfDeSousService.GetLibelle()+lVolumeHoraireDuProfSousService,'</div>');if(!!lProfDeSousService.eMail){lHtml.push('<a class="link" href="mailto:'+lProfDeSousService.email+'">'+lProfDeSousService.eMail+'</a>');}
lHtml.push('</div>');}}}} else if(aElem.GetGenre()===EGenreRessource.Personnel){var lFonction=aElem;lHtml.push('<div class="title">',lFonction.GetLibelle(),'</div>');var lNrePersonnel=lFonction.listePersonnel.GetNbrElements();for(var i=0;i<lNrePersonnel;i++){var lPersonnel=lFonction.listePersonnel.GetElement(i),lMail=lPersonnel.email;lHtml.push('<div>',lPersonnel.GetLibelle(),'</div>');if(!!lMail){lHtml.push('<a class="link" href="mailto:'+lMail+'">'+lMail+'</a>');}}}
return lHtml.join('');});}}
function formaterListeParMatiereEtFonction(aListeEquipePedagogique){var lListe=new ObjetListeElements();if(!!aListeEquipePedagogique){var lLibelleSansMatiere=GTraductions.getValeur('EquipePedagogique.sansMatiere');aListeEquipePedagogique.parcourir(function(D){if(D.estUnDeploiement){var lElement=MethodesObjet.dupliquer(D);lElement.libelleTri='';lListe.AddElement(lElement);} else{switch(D.GetGenre()){case EGenreRessource.Enseignant:if(!D.matieres||D.matieres.GetNbrElements()===0){lElement=lListe.GetElementParLibelle(lLibelleSansMatiere);if(!lElement){lElement=new ObjetElement(lLibelleSansMatiere,null,EGenreRessource.Enseignant);lElement.libelleTri=lElement.GetLibelle();lElement.listeProfesseurs=new ObjetListeElements();lListe.AddElement(lElement);}
lElement.listeProfesseurs.AddElement(D);} else{D.matieres.parcourir(function(aMatiereDeProfesseur){if(!aMatiereDeProfesseur.estUneSousMatiere){lElement=null;lListe.parcourir(function(D2){if(aMatiereDeProfesseur.GetLibelle()===D.GetLibelle()){if(!!D.estEnleve===!!D2.estEnleve){lElement=D;return true;}}});if(!lElement){lElement=MethodesObjet.dupliquer(aMatiereDeProfesseur);lElement.Genre=EGenreRessource.Enseignant;lElement.estEnleve=D.estEnleve;lElement.libelleTri=lElement.GetLibelle();lElement.listeProfesseurs=new ObjetListeElements();lListe.AddElement(lElement);}
D.volumeHoraire=aMatiereDeProfesseur.volumeHoraire;lElement.listeProfesseurs.AddElement(D);if(lElement.listeProfesseurs.GetNbrElements()>1){lElement.volumeHoraire='';}}});}
break;case EGenreRessource.Personnel:var lLibelleFonction=D.fonction?D.fonction:GTraductions.getValeur('EquipePedagogique.fonctionInconnue');lElement=lListe.GetElementParLibelle(lLibelleFonction);if(!lElement){lElement=new ObjetElement(lLibelleFonction,null,EGenreRessource.Personnel);lElement.libelleTri=lElement.GetLibelle();lElement.listePersonnel=new ObjetListeElements();lListe.AddElement(lElement);}
lElement.listePersonnel.AddElement(D);break;}}});}
lListe.setTri([
ObjetTri.init(function(D){return D.GetGenre()===EGenreRessource.Enseignant?false:true;}),ObjetTri.init(function(D){return D.estEnleve?true:false;}),ObjetTri.init(function(D){return D.libelleTri;})
]);lListe.trier();return lListe;}
function getArrayLibellesProfPrincipalEtTuteur(aProfesseur){var lArrayStr=[];if(!!aProfesseur){if(!!aProfesseur.estProfesseurPrincipal){lArrayStr.push(GTraductions.getValeur('EquipePedagogique.professeurPrincipal'));}
if(!!aProfesseur.estTuteur){lArrayStr.push(GTraductions.getValeur('EquipePedagogique.tuteur'));}}
return lArrayStr;}
module.exports=ObjetAffichageEquipePedagogique;},fn:"mobile/script/interfacepageequipepedagogique.js"});;
IE.fModule({f:function(exports,require,module,global){const GChaine=require('GChaine.js');const{GDate}=require('ObjetDate.js');const ObjetIdentite_Mobile=require('ObjetIdentite_Mobile.js');const GTraductions=require('ObjetTraduction.js');const UtilitaireBulletinEtReleve_Mobile=require('UtilitaireBulletinEtReleve_Mobile.js');const EGenreDirectionSlide=require('EGenreDirectionSlide.js');const EGenreDocumentJoint=require('Enumere_DocumentJoint.js');const ObjetElement=require('ObjetElement.js');const TypeFichierExterneHttpSco=require('TypeFichierExterneHttpSco.js').TypeFichierExterneHttpSco;const{TypeDroits}=require('ObjetDroitsPN.js');const ObjetBoutonFlottant=require('ObjetBoutonFlottant.js');const TypeHttpGenerationPDFSco=require('TypeHttpGenerationPDFSco.js').TypeHttpGenerationPDFSco;const GenerationPDF=require('utilitairegenerationpdf.js');const OptionsPdf=require('OptionsPDFSco.js');const ObjetMoteurReleveBulletin=require('ObjetMoteurReleveBulletin.js').ObjetMoteurReleveBulletin;const{TypePositionnementUtil}=require('TypePositionnement.js');const UtilitaireGestionCloudEtPDF=require('UtilitaireGestionCloudEtPDF.js');class ObjetReleveDeNotes extends ObjetIdentite_Mobile{constructor(...aParams){super(...aParams);this.tableauVisible=[];this.donneesRecues=false;this.donneesRecues=false;this.moteur=new ObjetMoteurReleveBulletin();}
getControleur(aInstance){return $.extend(true,super.getControleur(this),{getIdentiteBouton:function(){return{class:ObjetBoutonFlottant,pere:this,init:function(aBtn){aInstance.identBtnFlottant=aBtn;var lParam={listeBoutons:[{primaire:true,icone:"icon_pdf",callback:aInstance.AfficherModalitesGenerationPDF.bind(this,aInstance,_genererPdf)}
]};aBtn.setOptionsBouton(lParam);}};}});}
AfficherModalitesGenerationPDF(aInstance){let lParams={callbaskEvenement:aInstance.surEvenementFenetre.bind(aInstance),modeGestion:UtilitaireGestionCloudEtPDF.modeGestion.PDFEtCloud,avecDepot:true,avecTitreSelonOnglet:true};UtilitaireGestionCloudEtPDF.creerFenetreGestion(lParams);}
surEvenementFenetre(aLigne){const lService=GEtatUtilisateur.listeCloudDepotServeur.GetElement(aLigne);_genererPdf.call(this,!!lService?lService.GetGenre():null);}
ConstruireAffichage(){var lHtml=[];if(!!this.message){lHtml.push(this.composeAucuneDonnee(this.message));if(!!this.identBtnFlottant){this.identBtnFlottant.SetVisible(false);}} else if(this.donneesRecues){if(!!this.identBtnFlottant){this.identBtnFlottant.SetVisible(true);}
lHtml.push('<div>');lHtml.push(this.composeServices());lHtml.push('</div>');if(GApplication.droits.get(TypeDroits.autoriserImpression)&&!this.identBtnFlottant){$("#"+GInterface.idZonePrincipale).IEHtmlAppend('<div class="is-sticky" ie-identite="getIdentiteBouton" ></div>',{controleur:this.controleur,avecCommentaireConstructeur:false});}}
return lHtml.join('');}
SetMessage(aMessage){this.message=aMessage;this.Afficher();}
SetDonnees(aListeServices,aMoyenneGenerale,aDonneesAbsences,aPiedDePage,aAffichage,aPositionPeriode,aPositionMax,aPeriode){this.listeServices=aListeServices;this.moyenneGenerale=aMoyenneGenerale;this.donneesAbsences=aDonneesAbsences;this.PiedDePage=aPiedDePage;this.Affichage=aAffichage;this.message=false;this.periode=aPeriode;var lSensSlide;this.donneesRecues=true;if(this.precedentePosition===aPositionMax&&aPositionPeriode===0){lSensSlide=EGenreDirectionSlide.Droite;} else if(this.precedentePosition===0&&aPositionPeriode>1){lSensSlide=EGenreDirectionSlide.Gauche;} else{lSensSlide=aPositionPeriode===this.precedentePosition?EGenreDirectionSlide.Aucune:aPositionPeriode<this.precedentePosition?EGenreDirectionSlide.Gauche:EGenreDirectionSlide.Droite;}
this.precedentePosition=aPositionPeriode;this.Afficher(null,lSensSlide);this.donneesRecues=true;}
composeServices(){var lHtml=[];lHtml.push('<ul class="collection collection-thin with-header">');if(this.listeServices){for(var I=0,lNbr=this.listeServices.GetNbrElements();I<lNbr;I++){var lService=this.listeServices.GetElement(I);var lDetailService,lDetailSousService,lDetailRegroupemement,lDetailServiceRegroupement;if(!lService.estSousService){if(!lService.estServicePereAvecSousService){if(!lService.SurMatiere||lService.SurMatiere.GetNumero()===0){lDetailService=this.composeDetails(lService,false);lHtml.push('<li class="collection-item">');lHtml.push('<ul class="collapsible">');lHtml.push('<li',(lDetailService?' class="active"':''),'>');lHtml.push('<div class="collapsible-header',(lDetailService?'':' empty-body'),'">','<div style="padding:0.2rem 0">'+'<div style="border-left: 5px solid '+(!!lService.couleur&&lService.couleur!==""?lService.couleur:"#D4D4D4")+'; padding-left: 0.4rem;">'+'<div class="title" style="'+(this.getLibelleProfesseur(lService)!==''?'line-height:1.5rem;':'')+'">'+this.getLibelleService(lService)+'</div>'+'<div style="line-height:1.5rem;">'+this.getLibelleProfesseur(lService)+'</div>'+'</div>'+'</div>'+'</div>');lHtml.push('<div class="collapsible-body">',(lDetailService||''),'</div>');lHtml.push('</li>');lHtml.push('</ul>');lHtml.push('</li>');} else{if(lService.estSurMatiere){lDetailRegroupemement=this.composeDetails(lService,false);lHtml.push('<li class="collection-item">');lHtml.push('<ul class="collapsible">');lHtml.push('<li class="active">');lHtml.push('<div class="collapsible-header">'+'<div style="padding:0.2rem 0rem">'+'<div style="padding-left: 0.4rem;">'+'<div class="title">'+lService.GetLibelle()+'</div>'+'</div>'+'</div>'+'</div>');lHtml.push('<div class="collapsible-body" style="border: 1px solid #D1D1D1;">',(lDetailRegroupemement||''));lHtml.push('<ul class="collection collection-thin with-header">');} else{lDetailServiceRegroupement=this.composeDetails(lService,false);lHtml.push('<li class="collection-item">');lHtml.push('<ul class="collapsible">');lHtml.push('<li',(lDetailServiceRegroupement?' class="active"':''),'>');lHtml.push('<div class="collapsible-header',(lDetailServiceRegroupement?'':' empty-body'),'"','">','<div style="padding:0.2rem 0">'+'<div style="border-left: 5px solid '+(!!lService.couleur&&lService.couleur!==""?lService.couleur:"#D4D4D4")+'; padding-left: 0.4rem;">'+'<div class="title" style="'+(this.getLibelleProfesseur(lService)!==''?'line-height:1.5rem;':'')+'">'+this.getLibelleService(lService)+'</div>'+'<div style="line-height:1.5rem;">'+this.getLibelleProfesseur(lService)+'</div>'+'</div>'+'</div>'+'</div>');lHtml.push('<div class="collapsible-body">',(lDetailServiceRegroupement||''),'</div>');lHtml.push('</li>');lHtml.push('</ul>');lHtml.push('</li>');if(lService.estDernierDansSurMatiere){lHtml.push('</ul>');lHtml.push('</div>');lHtml.push('</li>');lHtml.push('</ul>');lHtml.push('</li>');}}}} else{lDetailService=this.composeDetails(lService,false);lHtml.push('<li class="collection-item">');lHtml.push('<ul class="collapsible">');lHtml.push('<li',(lDetailService||lService.avecSousServiceAffiche?' class="active"':''),'>');lHtml.push('<div class="collapsible-header">'+'<div style="padding:0.2rem 0">'+'<div style="border-left: 5px solid '+(!!lService.couleur&&lService.couleur!==""?lService.couleur:"#D4D4D4")+'; padding-left: 0.4rem;">'+'<div class="title" style="'+(this.getLibelleProfesseur(lService)!==''?'line-height:1.5rem;':'')+'">'+this.getLibelleService(lService)+'</div>'+'<div style="line-height:1.5rem;">'+this.getLibelleProfesseur(lService)+'</div>'+'</div>'+'</div>'+'</div>');lHtml.push('<div class="collapsible-body" style="border: 1px solid #D1D1D1;">',(lDetailService||''));if(!lService.avecSousServiceAffiche){lHtml.push('</div>');lHtml.push('</li>');lHtml.push('</ul>');lHtml.push('</li>');if(lService.estDernierDansSurMatiere){lHtml.push('</ul>');lHtml.push('</div>');lHtml.push('</li>');lHtml.push('</ul>');lHtml.push('</li>');}} else{lHtml.push('<ul class="collection collection-thin with-header">');}}} else{lDetailSousService=this.composeDetails(lService,true);lHtml.push('<li class="collection-item">');lHtml.push('<ul class="collapsible" style="margin-left:19px;">');lHtml.push('<li',(lDetailSousService?' class="active"':''),'>');lHtml.push('<div class="collapsible-header',(lDetailSousService?'':' empty-body'),'">'+'<div style="padding:0.2rem 0;">'+'<div style="border-left: 5px solid '+(!!lService.couleur&&lService.couleur!==""?lService.couleur:"#D4D4D4")+'; padding-left: 0.4rem;">',this.composeLibelleServiceEtProfesseur(lService),'</div>'+'</div>'+'</div>');lHtml.push('<div class="collapsible-body" >',(lDetailSousService||''),'</div>');lHtml.push('</li>');lHtml.push('</ul>');lHtml.push('</li>');if(lService.estDernier){lHtml.push('</ul>');lHtml.push('</div>');lHtml.push('</li>');lHtml.push('</ul>');lHtml.push('</li>');if(lService.estDernierDansSurMatiere){lHtml.push('</ul>');lHtml.push('</div>');lHtml.push('</li>');lHtml.push('</ul>');lHtml.push('</li>');}}}}}
if(!!this.Affichage.AvecMoyenneGenerale){const lAvecMoyGenEleve=!!this.Affichage.AvecMoyenneEleve&&!!this.moyenneGenerale.MoyenneEleve&&this.moyenneGenerale.MoyenneEleve.getNote()!=="";const lAvecMoyGenClasse=!!this.Affichage.AvecMoyenneClasse&&this.moyenneGenerale.MoyenneClasse&&this.moyenneGenerale.MoyenneClasse.getNote()!=="";const lAvecMoyGenMediane=!!this.Affichage.AvecMoyenneMediane&&this.moyenneGenerale.MoyenneMediane&&this.moyenneGenerale.MoyenneMediane.getNote()!=="";const lAvecMoyGenInfSup=!!this.Affichage.AvecMoyenneInfSup&&!!this.moyenneGenerale.MoyenneInf&&this.moyenneGenerale.MoyenneInf.getNote()!==""&&!!this.moyenneGenerale.MoyenneSup&&this.moyenneGenerale.MoyenneSup.getNote()!=="";if((lAvecMoyGenEleve&&(lAvecMoyGenClasse||lAvecMoyGenMediane))||(lAvecMoyGenClasse&&lAvecMoyGenMediane)||lAvecMoyGenInfSup){lHtml.push('<li class="collection-item raised">');lHtml.push('<div class="Espace title">',GTraductions.getValeur('BulletinEtReleve.MoyGen'),'</div>');lHtml.push('<div class="Espace">');if(lAvecMoyGenEleve){lHtml.push(UtilitaireBulletinEtReleve_Mobile.composePetitBlocDonnees(GTraductions.getValeur('ReleveDeNotes.MoyEleve'),this.moyenneGenerale.MoyenneEleve.getNote()));}
if(lAvecMoyGenClasse){lHtml.push(UtilitaireBulletinEtReleve_Mobile.composePetitBlocDonnees(GTraductions.getValeur('BulletinEtReleve.Classe'),this.moyenneGenerale.MoyenneClasse.getNote()));}
if(lAvecMoyGenMediane){lHtml.push(UtilitaireBulletinEtReleve_Mobile.composePetitBlocDonnees(GTraductions.getValeur('BulletinEtReleve.Mediane'),this.moyenneGenerale.MoyenneMediane.getNote()));}
if(lAvecMoyGenInfSup){lHtml.push(UtilitaireBulletinEtReleve_Mobile.composePetitBlocDonnees(GTraductions.getValeur('BulletinEtReleve.MoyInf'),this.moyenneGenerale.MoyenneInf.getNote()));lHtml.push(UtilitaireBulletinEtReleve_Mobile.composePetitBlocDonnees(GTraductions.getValeur('BulletinEtReleve.MoySup'),this.moyenneGenerale.MoyenneSup.getNote()));}
lHtml.push('</div>');lHtml.push('</li>');} else{if(lAvecMoyGenEleve){lHtml.push('<li class="collection-item raised">');lHtml.push('<div class="left title">',GTraductions.getValeur('BulletinEtReleve.MoyGenEleve'),'</div>');lHtml.push('<div class="right title">');lHtml.push(this.moyenneGenerale.MoyenneEleve.getNote());lHtml.push('</div>');lHtml.push('<div class="clear"></div>');lHtml.push('</li>');} else if(lAvecMoyGenClasse){lHtml.push('<li class="collection-item raised">');lHtml.push('<div class="left title">',GTraductions.getValeur('BulletinEtReleve.MoyGenClasse'),'</div>');lHtml.push('<div class="right title">');lHtml.push(this.moyenneGenerale.MoyenneClasse.getNote());lHtml.push('</div>');lHtml.push('<div class="clear"></div>');lHtml.push('</li>');} else if(lAvecMoyGenMediane){lHtml.push('<li class="collection-item raised">');lHtml.push('<div class="left title">',GTraductions.getValeur('BulletinEtReleve.MoyGenMediane'),'</div>');lHtml.push('<div class="right title">');lHtml.push(this.moyenneGenerale.MoyenneMediane.getNote());lHtml.push('</div>');lHtml.push('<div class="clear"></div>');lHtml.push('</li>');}}}
lHtml.push('</ul>');if(this.existeDonneesAbsence()){lHtml.push('<div class="card" style="margin:0.5rem;">');lHtml.push('<div class="card-content">');lHtml.push('<div id="',this.Nom,'_vieScolaire" class="small">');lHtml.push(UtilitaireBulletinEtReleve_Mobile.composeVieScolaire(this.donneesAbsences));lHtml.push('</div>');}
if(this.existeDonneesAppreciations()){if(!this.existeDonneesAbsence()){lHtml.push('<div class="card" style="margin:0.5rem;">');lHtml.push('<div class="card-content">');}
lHtml.push('<div id="',this.Nom,'_appreciationGenerale" class="small">');var lIntitule=this.PiedDePage.ListeAppreciations.general.GetElement(0).Intitule;var lContenu=this.PiedDePage.ListeAppreciations.general.GetElement(0).ListeAppreciations.GetElement(0).GetLibelle();lHtml.push(UtilitaireBulletinEtReleve_Mobile.composeAppreciation({intituleDAppreciation:lIntitule,contenuDAppreciation:lContenu,styleBlockIntitule:'color : #616161;',styleBlockContenu:'border:1px solid #616161; background-color: #F1F1F1;'}));lHtml.push('</div>');}
if(this.existeDonneesAbsence()||this.existeDonneesAppreciations()){lHtml.push('</div>');lHtml.push('</div>');}
return lHtml.join('');}
composeDetails(aService,aEstSousService){var lHtml=[],J;var lNbrDevoirs=aService.ListeDevoirs.GetNbrElements();if(lNbrDevoirs!==0){lHtml.push('<div class="content">');for(J=0;J<lNbrDevoirs;J++){lHtml.push('<div style="'+(J<lNbrDevoirs-1?'border-bottom: 1px solid #C4C4C4;':'')+' padding-left:2.1rem;">',this.composeDevoir(aService.ListeDevoirs.GetElement(J)),'</div>');}
lHtml.push('</div>');}
var lEstMultiLignes=false;if(this.Affichage.avecMoyNRUniquement===false){lEstMultiLignes=this.Affichage.AvecMoyenneEleve&&(aService.estMoyNR===true)&&!!aService.MoyenneEleve&&aService.MoyenneEleve.getNote()!=="";}
var lExisteDetaille=false;if(this.Affichage.AvecNivMaitriseEleve&&!!aService.NiveauDAcquisition&&aService.NiveauDAcquisition.existeNumero()){const H=[];H.push(this.moteur.composeHtmlNote({note:null,niveauDAcquisition:aService.NiveauDAcquisition,genrePositionnement:TypePositionnementUtil.getGenrePositionnementParDefaut(aService.TypePositionnementClasse),avecPrefixe:false}));if(!lExisteDetaille){lHtml.push('<div class="Espace">');lExisteDetaille=true;}
lHtml.push(UtilitaireBulletinEtReleve_Mobile.composePetitBlocDonnees(GTraductions.getValeur('BulletinEtReleve.Pos'),H.join(''),lEstMultiLignes));}
if(this.Affichage.AvecMoyenneEleve&&((!!aService.MoyenneEleve&&aService.MoyenneEleve.getNote()!=="")||aService.estMoyNR===true)){const H=[];if(aService.estMoyNR===true){H.push(this.moteur.composeHtmlMoyNR());}
if(!((aService.estMoyNR===true)&&(this.Affichage.avecMoyNRUniquement===true))){H.push(aService.MoyenneEleve.getNote());}
if(!lExisteDetaille){lHtml.push('<div class="Espace">');lExisteDetaille=true;}
lHtml.push(UtilitaireBulletinEtReleve_Mobile.composePetitBlocDonnees(GTraductions.getValeur('ReleveDeNotes.MoyEleve'),H.join(''),lEstMultiLignes));}
if(this.Affichage.AvecMoyenneClasse&&!!aService.MoyenneClasse&&aService.MoyenneClasse.getNote()!==""){if(!lExisteDetaille){lHtml.push('<div class="Espace">');lExisteDetaille=true;}
lHtml.push(UtilitaireBulletinEtReleve_Mobile.composePetitBlocDonnees(GTraductions.getValeur('BulletinEtReleve.Classe'),aService.MoyenneClasse.getNote(),lEstMultiLignes));}
if(this.Affichage.AvecMoyenneMediane&&!!aService.MoyenneMediane&&aService.MoyenneMediane.getNote()!==""){if(!lExisteDetaille){lHtml.push('<div class="Espace">');lExisteDetaille=true;}
lHtml.push(UtilitaireBulletinEtReleve_Mobile.composePetitBlocDonnees(GTraductions.getValeur('BulletinEtReleve.Mediane'),aService.MoyenneMediane.getNote(),lEstMultiLignes));}
if(this.Affichage.AvecMoyenneInfSup){if(!!aService.MoyenneInf&&aService.MoyenneInf.getNote()!==""){if(!lExisteDetaille){lHtml.push('<div class="Espace">');lExisteDetaille=true;}
lHtml.push(UtilitaireBulletinEtReleve_Mobile.composePetitBlocDonnees(GTraductions.getValeur('BulletinEtReleve.MoyInf'),aService.MoyenneInf.getNote(),lEstMultiLignes));}
if(!!aService.MoyenneSup&&aService.MoyenneSup.getNote()!==''){if(!lExisteDetaille){lHtml.push('<div class="Espace">');lExisteDetaille=true;}
lHtml.push(UtilitaireBulletinEtReleve_Mobile.composePetitBlocDonnees(GTraductions.getValeur('BulletinEtReleve.MoySup'),aService.MoyenneSup.getNote(),lEstMultiLignes));}}
if(lExisteDetaille){lHtml.push('</div>');}
if(aEstSousService&&!!this.Affichage.AvecAppreciationParSousService&&this.Affichage.NombreAppreciations!==0&&aService.ListeAppreciations&&aService.ListeAppreciations.GetLibelle(0)!==''){lHtml.push(UtilitaireBulletinEtReleve_Mobile.composeAppreciation({intituleDAppreciation:GTraductions.getValeur('Appreciation'),contenuDAppreciation:aService.ListeAppreciations.GetLibelle(0),styleBlockIntitule:'color : #616161;',styleBlockContenu:'border:1px solid #616161; background-color: #F1F1F1;'}));}
if(!aEstSousService&&this.Affichage.NombreAppreciations!==0&&aService.ListeAppreciations&&aService.ListeAppreciations.GetLibelle(0)!==''){lHtml.push(UtilitaireBulletinEtReleve_Mobile.composeAppreciation({intituleDAppreciation:GTraductions.getValeur('Appreciation'),contenuDAppreciation:aService.ListeAppreciations.GetLibelle(0),styleBlockIntitule:'color : #616161;',styleBlockContenu:'border:1px solid #616161; background-color: #F1F1F1;'}));}
if(lHtml.length===0){return false;} else{return lHtml.join('');}}
composeDevoir(aDevoir){const lNoteAuDessusBareme=(aDevoir.Note&&aDevoir.Bareme&&aDevoir.Note.getValeur()>aDevoir.Bareme.getValeur());const lStrEtoile=lNoteAuDessusBareme?'<i class="icon icon_star EspaceDroit"></i>':'';var lEstBaremeParDefaut=!aDevoir.Bareme||!aDevoir.BaremeParDefaut||(aDevoir.Bareme.getValeur()===aDevoir.BaremeParDefaut.getValeur());var lHtml=[];lHtml.push('<div class="note-details-conteneur ">');lHtml.push(aDevoir.Date?'<span class="date">'+GDate.FormatDate(aDevoir.Date,'%JJ/%MM/%AA')+'</span>':'');lHtml.push('<span class="note-contain">');var lNoteAffichee=aDevoir.estFacultatif?'('+aDevoir.Note.getNote()+')':aDevoir.Note.getNote();if(aDevoir.libelleCorrige){var lDocumentJoint=new ObjetElement(aDevoir.libelleCorrige,aDevoir.GetNumero(),EGenreDocumentJoint.Fichier);lHtml.push(GChaine.composerUrlLienExterne({libelle:aDevoir.libelleCorrige,libelleEcran:lNoteAffichee,genreRessource:TypeFichierExterneHttpSco.DevoirCorrige,documentJoint:lDocumentJoint}));} else{lHtml.push('<span class="note">',lStrEtoile,lNoteAffichee,'</span>');}
lHtml.push('<span class="bareme">',lEstBaremeParDefaut&&!lNoteAuDessusBareme?'':'&nbsp;/'+aDevoir.Bareme.getValeur(),'</span>');lHtml.push('</span>');lHtml.push('<span class="coefficient">',!aDevoir.Coefficient||(aDevoir.Coefficient.getValeur()===1)?'&nbsp;':'(x&nbsp;'+aDevoir.Coefficient+')','</span>');if(aDevoir.Commentaire){lHtml.push('<span class="commentaire">',aDevoir.Commentaire,'</span>');}
lHtml.push('</div>');return lHtml.join('');}
composeLibelleServiceEtProfesseur(aService){var lHtml=[];var lLibelleProfesseur=this.getLibelleProfesseur(aService);var lLibelleService=this.getLibelleService(aService);if(lLibelleService!==''){lHtml.push('<div>'+lLibelleService+'</div>');}
if(lLibelleProfesseur!==''){lHtml.push('<div>'+lLibelleProfesseur+'</div>');}
return lHtml.join('');}
getLibelleProfesseur(aService){var lTableauProfesseurs=[],lNbProfesseur=!!aService.ListeProfesseurs?aService.ListeProfesseurs.GetNbrElements():0;for(var J=0;J<lNbProfesseur;J++){lTableauProfesseurs.push(aService.ListeProfesseurs.GetLibelle(J));}
return this.avecLibelleProfesseur(aService)?lTableauProfesseurs.join(', ')+'':'';}
getLibelleService(aService){return!!aService.Matiere&&!!aService.Matiere.GetLibelle()?aService.Matiere.GetLibelle():'';}
avecLibelleProfesseur(aService){return(!!aService.ListeProfesseurs&&!!aService.ListeProfesseurs.GetNbrElements());}
existeDonneesAbsence(){if((!!this.donneesAbsences.strAbsences&&this.donneesAbsences.strAbsences!=="")||(!!this.donneesAbsences.strPunitions&&this.donneesAbsences.strPunitions!=="")||(!!this.donneesAbsences.strRetards&&this.donneesAbsences.strRetards!=="")||(!!this.donneesAbsences.strSanctions&&this.donneesAbsences.strSanctions!=="")){return true;} else{return false;}}
existeDonneesAppreciations(){if(this.PiedDePage&&this.PiedDePage.ListeAppreciations&&this.PiedDePage.ListeAppreciations.general.GetElement(0).GetLibelle()!==""){return true;} else{return false;}}
free(...aParams){super.free(...aParams);if(this.identBtnFlottant){$('#'+this.identBtnFlottant.GetNom().escapeJQ()).remove();}}}
function _genererPdf(aService){var lParametrageAffichage={genreGenerationPDF:TypeHttpGenerationPDFSco.ReleveDeNotes,periode:this.periode};GenerationPDF.genererPDF({paramPDF:lParametrageAffichage,optionsPDF:OptionsPdf.ReleveDeNotes,cloudCible:aService});}
module.exports=ObjetReleveDeNotes;},fn:"mobile/script/pagerelevedenotes.js"});;
IE.fModule({f:function(exports,require,module,global){const _ObjetRequeteResultat=require('_ObjetRequeteResultat.js');const Requetes=require('CollectionRequetes.js');const ObjetElement=require('ObjetElement.js');const UtilitaireDeserialiserPiedBulletin=require('UtilitaireDeserialiserPiedBulletin.js');const ObjetListeElements=require('ObjetListeElements.js');class ObjetRequetePageReleve extends _ObjetRequeteResultat{constructor(...aParams){super(...aParams);}
lancerRequete(aParam){const lParam={numeroEleve:0,numeroClasse:0,genrePeriode:0,numeroPeriode:0};$.extend(lParam,aParam);this.JSON={eleve:new ObjetElement('',lParam.numeroEleve),periode:new ObjetElement('',lParam.numeroPeriode,lParam.genrePeriode)};if(lParam.numeroClasse){this.JSON.classe=new ObjetElement('',lParam.numeroClasse);}
return this.appelAsynchrone();}
actionApresRequete(){const lParam={aCopier:{},absences:{}};lParam.Message=this.JSONReponse.Message;if(!lParam.Message){lParam.aCopier.classe=this.JSONReponse.Classe;lParam.aCopier.strInfoDatePublication=this.JSONReponse.strInfoDatePublication;lParam.aCopier.Affichage=this.JSONReponse.ParametresAffichages;lParam.aCopier.Affichage.listeLibellesPeriodes=this.JSONReponse.ListePeriodes;const lThis=this;let lDernierSousService,lPremierSousService,lPereSousService;const lNbrSurMatiere=this.JSONReponse.ListeSurMatieres.GetNbrElements();this.NbrMaxServices=0;lParam.aCopier.ListeElements=this.JSONReponse.ListeServices.parcourir(function(aElement){lThis.NbrMaxServices=!aElement.estSousService&&!aElement.estSurMatiere?lThis.NbrMaxServices+1:lThis.NbrMaxServices;if(lNbrSurMatiere===0){aElement.regroupement=0;}
if(aElement.estServicePereAvecSousService){lPereSousService=aElement;aElement.avecSousServiceAffiche=false;}
if(aElement.estSousService){lThis.JSONReponse.ParametresAffichages.AvecSousService=true;aElement.service=lPereSousService;lPereSousService.avecSousServiceAffiche=true;lDernierSousService=aElement;if(lPremierSousService){lPremierSousService=null;} else{lPremierSousService=aElement;}} else{if(lDernierSousService){lDernierSousService.estDernier=true;}
if(lPremierSousService){lPremierSousService=null;}}});if(lDernierSousService){lDernierSousService.estDernier=true;}
if(lPremierSousService){lPremierSousService=null;}
lParam.aCopier.ServiceEditable=this.JSONReponse.Editable;lParam.aCopier.ExisteDevoir=this.JSONReponse.NbrMaxDevoirs>0;lParam.aCopier.ExisteService=this.NbrMaxServices>0;lParam.aCopier.NbrMaxServices=this.NbrMaxServices;lParam.aCopier.NbrMaxDevoirs=this.JSONReponse.NbrMaxDevoirs;const lTabSurMatiere=[];this.JSONReponse.ListeSurMatieres.parcourir(function(aSurMatiere){let lAvecServiceDansSurMatiere=false;let lDernierServiceDansSurMatiere;lParam.aCopier.ListeElements.parcourir(function(aElement){if(aSurMatiere.GetNumero()===aElement.SurMatiere.GetNumero()&&aSurMatiere.GetNumero()!==aElement.GetNumero()){lAvecServiceDansSurMatiere=true;lDernierServiceDansSurMatiere=aElement;} else{if(lDernierServiceDansSurMatiere){lDernierServiceDansSurMatiere.estDernierDansSurMatiere=true;}}});if(lDernierServiceDansSurMatiere){lDernierServiceDansSurMatiere.estDernierDansSurMatiere=true;}
if(lAvecServiceDansSurMatiere){lTabSurMatiere[aSurMatiere.GetNumero()]=aSurMatiere;} else{const lListe=new ObjetListeElements();for(let i=0,lNbr=lParam.aCopier.ListeElements.GetNbrElements();i<lNbr;i++){if(aSurMatiere.GetNumero()!==lParam.aCopier.ListeElements.GetElement(i).GetNumero()){lListe.AddElement(lParam.aCopier.ListeElements.GetElement(i));}}
lParam.aCopier.ListeElements=lListe;}});lParam.aCopier.tableauSurMatieres=lTabSurMatiere;lParam.aCopier.MoyenneGenerale=this.JSONReponse.General;$.extend(lParam.absences,new UtilitaireDeserialiserPiedBulletin().creerAbsences(this.JSONReponse));lParam.aCopier.PiedDePage=new UtilitaireDeserialiserPiedBulletin().creerPiedDePage(this.JSONReponse);lParam.listeAccusesReception=this.JSONReponse.listeAccusesReception;}
this.callbackReussite.appel(lParam);}}
Requetes.inscrire('PageReleve',ObjetRequetePageReleve);module.exports=ObjetRequetePageReleve;},fn:"objetrequetepagereleve.js"});;
IE.fModule({f:function(exports,require,module,global){const ObjetReleveDeNotes=require('mobile/script/PageReleveDeNotes.js');const ObjetRequetePageReleve=require('ObjetRequetePageReleve.js');const GHtml=require('GHtml.js');const InterfacePage_Mobile=require('InterfacePage_Mobile.js');const ObjetElement=require('ObjetElement.js');const ObjetListeElements=require('ObjetListeElements.js');const ObjetSelection=require('ObjetSelection.js').ObjetSelection;const GTraductions=require('ObjetTraduction.js');const EGenreMessage=require('Enumere_Message.js');const MethodesTableau=require('MethodesTableau.js');const EGenreEspace=require('Enumere_Espace.js');const{TypeDroits}=require('ObjetDroitsPN.js');const ObjetMoteurReleveBulletin=require('ObjetMoteurReleveBulletin.js').ObjetMoteurReleveBulletin;class ObjetAffichagePageReleveDeNotes extends InterfacePage_Mobile{constructor(...aParams){super(...aParams);this.listePeriodes=new ObjetListeElements();this.periodeCourant=new ObjetElement();this.indiceParDefaut=0;this.moteur=new ObjetMoteurReleveBulletin();this.avecGestionAccuseReception=MethodesTableau.existe(GEtatUtilisateur.GenreEspace,[EGenreEspace.Mobile_Parent])&&(GApplication.droits.get(TypeDroits.fonctionnalites.gestionARBulletins));}
ConstruireInstances(){this.identSelection=this.Add(ObjetSelection,this.evenementSelection);this.identPage=this.Add(ObjetReleveDeNotes);this.AddSurZone=[this.identSelection];if(this.avecGestionAccuseReception){this.AddSurZone.push({html:_getHtmlCBAccuseReception.call(this)});}}
getControleur(aInstance){return $.extend(true,super.getControleur(this),{visibiliteAR:function(){const lResponsableAR=aInstance._getResponsableAccuseReception();return aInstance.avecGestionAccuseReception&&!!lResponsableAR;},cbAccuseReception:{getValue:function(){const lResponsableAR=aInstance._getResponsableAccuseReception();return!!lResponsableAR?lResponsableAR.aPrisConnaissance:false;},setValue:function(aValue){const lResponsableAR=aInstance._getResponsableAccuseReception();if(!!lResponsableAR){lResponsableAR.aPrisConnaissance=aValue;aInstance.moteur.saisieAR({periode:aInstance.periodeCourant});}},getDisabled:function(){const lResponsableAR=aInstance._getResponsableAccuseReception();return!!lResponsableAR?lResponsableAR.aPrisConnaissance:true;}}});}
_getResponsableAccuseReception(){let lReponsableAccuseReception=null;if(!!this.listeAccusesReception&&this.listeAccusesReception.GetNbrElements()>0){lReponsableAccuseReception=this.listeAccusesReception.GetPremierElement()
;if(!!lReponsableAccuseReception){}}
return lReponsableAccuseReception;}
DetruireInstances(){}
evenementSwipe(event){if(event.type==='swiperight'){this.GetInstance(this.identSelection).surPrecedent();} else{this.GetInstance(this.identSelection).surSuivant();}}
RecupererDonnees(){var lOngletInfosPeriodes=GEtatUtilisateur.getOngletInfosPeriodes();var lNrPeriodeParDefaut;if(!(lOngletInfosPeriodes.listePeriodes&&lOngletInfosPeriodes.listePeriodes.GetNbrElements())){var lGenreMessage=EGenreMessage.AucunRelevePourEleve;var lMessage=typeof(lGenreMessage)==='number'?GTraductions.getValeur('Message')[lGenreMessage]:lGenreMessage;GHtml.setHtml(this.Nom,this.composeAucuneDonnee(lMessage));} else{this.listePeriodes=lOngletInfosPeriodes.listePeriodes;if(GEtatUtilisateur.getPeriodePourReleve()){lNrPeriodeParDefaut=GEtatUtilisateur.getPeriodePourReleve();} else{lNrPeriodeParDefaut=GEtatUtilisateur.getPage()&&GEtatUtilisateur.getPage().periode?GEtatUtilisateur.getPage().periode.GetNumero():lOngletInfosPeriodes.periodeParDefaut.GetNumero();}
this.indiceParDefaut=this.listePeriodes.GetIndiceParNumeroEtGenre(lNrPeriodeParDefaut);if(!this.indiceParDefaut){this.indiceParDefaut=0;}
this.periodeCourant=this.listePeriodes.GetElement(this.indiceParDefaut);this.GetInstance(this.identSelection).SetDonnees(this.listePeriodes,this.indiceParDefaut,this.GetInstance(this.identPage).GetNom(),'');$('#'+this.GetInstance(this.identPage).GetNom().escapeJQ()).css('min-height',((parseInt($('#'+this.Nom.escapeJQ()).css('min-height'))-$('#'+this.GetInstance(this.identSelection).GetNom().escapeJQ()).height())*0.9)+'px');}
if(GEtatUtilisateur.getPeriodePourReleve()){GEtatUtilisateur.setPeriodePourReleve(null);}}
RecupererDonneesReleve(){new ObjetRequetePageReleve(this,this.ActionSurRecupererReleve).lancerRequete({numeroEleve:GEtatUtilisateur.getMembre().GetNumero(),genrePeriode:this.periodeCourant.GetGenre(),numeroPeriode:this.periodeCourant.GetNumero()});}
ActionSurRecupererReleve(aParam){$.extend(this,aParam.aCopier);this.donneesAbsences=aParam.absences;this.listeAccusesReception=aParam.listeAccusesReception;if(!!aParam.Message){this.GetInstance(this.identPage).SetMessage(aParam.Message);} else if(!this.ExisteDevoir){this.GetInstance(this.identPage).SetMessage(GTraductions.getValeur('Message')[9]);} else{this.GetInstance(this.identPage).SetDonnees(this.ListeElements,this.MoyenneGenerale,this.donneesAbsences,this.PiedDePage,this.Affichage,this.positionPeriodeCourant,this.listePeriodes.GetNbrElements()-1,this.periodeCourant);}}
evenementSelection(aParam){this.periodeCourant=aParam.element;this.positionPeriodeCourant=this.listePeriodes.GetIndiceParElement(this.periodeCourant);this.RecupererDonneesReleve();}}
function _getHtmlCBAccuseReception(){var lHtml=[];lHtml.push('<div style="padding: 0.5rem;">','<ie-checkbox ie-textright class="AlignementMilieuVertical" ie-model="cbAccuseReception" ie-display="visibiliteAR">',GTraductions.getValeur('BulletinEtReleve.JAiPrisConnaissanceDuReleve'),'</ie-checkbox>','</div>');return lHtml.join('');}
module.exports=ObjetAffichagePageReleveDeNotes;},fn:"interfacepagerelevedenotes.js"});;
IE.fModule({f:function(exports,require,module,global){const TypeOrigineCreationLabelAlimentaire={OCLA_Utilisateur:0,OCLA_Bio:1,OCLA_FaitMaison:2,OCLA_Assemble:3,OCLA_Local:4};module.exports.TypeOrigineCreationLabelAlimentaire=TypeOrigineCreationLabelAlimentaire;},fn:"typeoriginecreationlabelalimentaire.js"});;
IE.fModule({f:function(exports,require,module,global){require('produit/css/general/Menu-cantine-mobile.css');const{GDate}=require('ObjetDate.js');const ObjetIdentite_Mobile=require('ObjetIdentite_Mobile.js');const GTraductions=require('ObjetTraduction.js');const EGenreRepas=require('Enumere_Repas.js');const EGenreDirectionSlide=require('EGenreDirectionSlide.js');const TypeOrigineCreationLabelAlimentaire=require('TypeOrigineCreationLabelAlimentaire.js').TypeOrigineCreationLabelAlimentaire;class ObjetMenus extends ObjetIdentite_Mobile{constructor(...aParams){super(...aParams);this.idMenus=this.Nom+'_TableauMenu';this.avecMidi=false;this.avecSoir=false;this.donneesRecues=false;this.avecSlide=true;this.semainePrecedente=null;this.semaineCourante=null;}
SetDonnees(aAvecMidi,aAvecSoir,aListeJours,aDateCourante){this.semainePrecedente=this.semaineCourante;this.avecMidi=aAvecMidi;this.avecSoir=aAvecSoir;this.listeJours=aListeJours;this.semaineCourante=IE.Cycles.cycleDeLaDate(aDateCourante);this.donneesRecues=true;this.avecDonnees=false;for(let i=0;i<this.listeJours.GetNbrElements()&&!this.avecDonnees;i++){const lJour=this.listeJours.GetElement(i);if(lJour.ListeRepas&&lJour.ListeRepas.GetNbrElements()>0){this.avecDonnees=true;}}
this.Afficher(null,!this.semainePrecedente||this.semainePrecedente===this.semaineCourante?EGenreDirectionSlide.Aucune:this.semainePrecedente>this.semaineCourante?EGenreDirectionSlide.Droite:EGenreDirectionSlide.Gauche);}
ConstruireAffichage(){if(!this.donneesRecues){return'';}
const lHtml=[];let lActif=0;let lDateActif;if(IE.Cycles.cycleCourant()===this.semaineCourante){if(GDate.getDateHeureCourante().getHours()>GDate.PlaceParJourEnDate(GParametres.PlaceDemiJournee)){lDateActif=GDate.GetJourSuivant(GDate.getDateCourante(),1);} else{lDateActif=GDate.getDateCourante();}
this.listeJours.parcourir(function(ele,index){if(ele.Date>=lDateActif){lActif=index;return false;}});}
if(this.listeJours.GetNbrElements()>0){lHtml.push('<ul class="liste-conteneur collapsible bg-white">');this.listeJours.parcourir(function(aJour,aIndexJour){if(aJour.ListeRepas&&aJour.ListeRepas.GetNbrElements()>0){lHtml.push('<li>','<div class="collapsible-header',(lActif===aIndexJour?' active':''),'">',GDate.FormatDate(aJour.Date,'%JJJJ %JJ %MMMM %AAAA'),'</div>','<div class="collapsible-body">','<ul class="collection with-header">');const lNbRepasDuJour=aJour.ListeRepas.GetNbrElements();aJour.ListeRepas.parcourir(function(aRepas){let lLibelleRepas='';if(lNbRepasDuJour>1){lLibelleRepas+=(aRepas.GetGenre()===EGenreRepas.Soir?GTraductions.getValeur('menus.RepasSoir'):GTraductions.getValeur('menus.RepasMidi'));}
if(!!aRepas.GetLibelle()){if(lLibelleRepas.length>0){lLibelleRepas+=' : ';}
lLibelleRepas+=aRepas.GetLibelle();}
if(lLibelleRepas.length>0){lHtml.push('<li class="collection-header">','<div style="text-align:center">',lLibelleRepas,'</div>','</li>');}
lHtml.push('<li class="collection-item menu-cantine">',_composeRepas(aRepas),'</li>');});lHtml.push('</ul>','</div>','</li>');}});lHtml.push('</ul>');}
if(!this.avecDonnees){lHtml.push(this.composeAucuneDonnee(GTraductions.getValeur('menus.Message.AucunMenuSurSemaine')));}
return lHtml.join('');}}
function _composePlat(aPlat){const H=[];aPlat.ListeAliments.parcourir(function(aElement){H.push('<span>'+aElement.GetLibelle());aElement.listeLabelsAlimentaires.parcourir(function(aElem){if(aElem.GetGenre()===TypeOrigineCreationLabelAlimentaire.OCLA_Utilisateur&&!!aElem.icone){H.push('<img  class="label-alimentaire" src="data:image/png;base64,',aElem.icone,'" alt="" onerror="$(this).parent().remove();" title="',aElem.GetLibelle(),'"/>');} else{H.push('<i class="label-alimentaire icon '+_getClassIcon(aElem.GetGenre())+'" style="color:'+aElem.couleur+'" title="'+aElem.GetLibelle()+'"></i>');}});H.push('</span>');});return H.join('');}
function _composeRepas(aRepas){const lHtml=[];if(!!aRepas&&!!aRepas.ListePlats){lHtml.push('<ul>');aRepas.ListePlats.parcourir(function(aPlat){lHtml.push('<li>'+_composePlat(aPlat)+'</li>');});lHtml.push('</ul>');}
return lHtml.join('');}
function _getClassIcon(aGenre){const T=['',' icon_cantine_bio',' icon_home',' icon_cantine_assembler_place',' icon_map_marker'];return T[aGenre];}
module.exports=ObjetMenus;},fn:"pagemenus.js"});;
IE.fModule({f:function(exports,require,module,global){const{ObjetRequeteConsultation}=require('ObjetRequeteJSON.js');const Requetes=require('CollectionRequetes.js');class ObjetRequetePageMenus extends ObjetRequeteConsultation{constructor(...aParams){super(...aParams);}
lancerRequete(aDate){this.JSON.date=aDate;return this.appelAsynchrone();}
actionApresRequete(){this.callbackReussite.appel(this.JSONReponse.ListeJours,this.JSONReponse.DomaineDePresence,this.JSONReponse.AvecRepasMidi,this.JSONReponse.AvecRepasSoir);}}
Requetes.inscrire('PageMenus',ObjetRequetePageMenus);module.exports=ObjetRequetePageMenus;},fn:"objetrequetepagemenus.js"});;
IE.fModule({f:function(exports,require,module,global){const ObjetMenus=require('PageMenus.js');const ObjetRequetePageMenus=require('ObjetRequetePageMenus.js');const InterfacePage_Mobile=require('InterfacePage_Mobile.js');const ObjetCelluleDate=require('ObjetCelluleDate.js');class ObjetAffichagePageMenus_Mobile extends InterfacePage_Mobile{constructor(...aParams){super(...aParams);}
ConstruireInstances(){this.identDate=this.Add(ObjetCelluleDate,this.evenementCalendrier,(aInstance) =>{aInstance.setOptions_ObjetCelluleDate({avecBoutonsPrecedentSuivant:true,selecteurMobile:true,avecSelectionSemaine:true});});this.identPage=this.Add(ObjetMenus);this.AddSurZone=[this.identDate];this.dateCourant=null;}
RecupererDonnees(){this.dateCourant=GEtatUtilisateur.getDerniereDate();this.GetInstance(this.identDate).SetDonnees(this.dateCourant,true);}
evenementCalendrier(aSelection){this.dateCourant=aSelection;new ObjetRequetePageMenus(this,this.actionSurCalendrier).lancerRequete(IE.Cycles.dateDebutCycle(IE.Cycles.cycleDeLaDate(aSelection)));}
actionSurCalendrier(aListeJours,aDomainePresence,aAvecRepasMidi,aAvecRepasSoir){this.GetInstance(this.identPage).SetDonnees(aAvecRepasMidi,aAvecRepasSoir,aListeJours,this.dateCourant);}}
module.exports=ObjetAffichagePageMenus_Mobile;},fn:"interfacepagemenus_mobile.js"});;
IE.fModule({f:function(exports,require,module,global){const TypeGenreExerciceDeQuestionnaire={GEQ_Inconnu:0,GEQ_SingleChoice:1,GEQ_MultiChoice:2,GEQ_TrueFalse:3,GEQ_NumericalAnswer:4,GEQ_ShortAnswer:5,GEQ_SpellAnswer:6,GEQ_Matching:7,GEQ_ClozeField:8,GEQ_ClozeFixed:9,GEQ_ClozeVariable:10,GEQ_Essay:11};module.exports.TypeGenreExerciceDeQuestionnaire=TypeGenreExerciceDeQuestionnaire;},fn:"typegenreexercicedequestionnaire.js"});;
IE.fModule({f:function(exports,require,module,global){const TypeQualificatifReponse={qrBonne:0,qrBonnePartielle:1,qrFausse:2,qrSansReponse:3};module.exports.TypeQualificatifReponse=TypeQualificatifReponse;},fn:"typequalificatifreponse.js"});;
IE.fModule({f:function(exports,require,module,global){const GChaine=require('GChaine.js');const GTraductions=require('ObjetTraduction.js');const TypeEtatExecutionQCMPourRepondant=require('TypeEtatExecutionQCMPourRepondant.js').TypeEtatExecutionQCMPourRepondant;const TypeGenreExerciceDeQuestionnaire=require('TypeGenreExerciceDeQuestionnaire.js').TypeGenreExerciceDeQuestionnaire;const TypeModeCorrectionQCM=require('TypeModeCorrectionQCM.js').TypeModeCorrectionQCM;const TypeQualificatifReponse=require('TypeQualificatifReponse.js').TypeQualificatifReponse;const TUtilitaireDuree=require('UtilitaireDuree.js');const ObjetTri=require('ObjetTri.js');const ObjetListeElements=require('ObjetListeElements.js');const ComparateurChaines=require('ComparateurChaines.js');const UtilitaireAudio=require('UtilitaireAudio.js');require('Espace/Css/ObjetVisuEleveQCM.css');require('Produit/Css/iconesQCM.css');require('jIECheckbox.js');class ObjetVisuEleve{constructor(aNom,aIdent,aPere,aEvenement){this.Nom=aNom;this.Pere=aPere;this.Evenement=aEvenement;this.modeProf=false;this.modeVisuQuestion=false;this.idContenu=null;this.numeroExecution=null;this.executionQCM=null;this.indiceQuestion= -1;this.listeQuestions=null;this.question=null;this.nbQuestions=null;this.typeNumerotation=null;this.etatCloture=null;this.start=null;this.affichageEnLigne=null;this.affichageUnePage=null;this.intervalChrono=null;this.evaluationNote=[];this.enActualisation=false;this.avecIECheckbox=true;this.idWrapperGlobal=this.Nom+'_WrapperGlobal';this.idWrapperAffichage=this.Nom+'_WrapperAffichage_';this.idValeurChrono=this.Nom+'_ValeurChrono';this.idWrapperBarreProgression=this.Nom+'_WrapperBarreProg';this.idRessenti=this.Nom+'_Ressenti';this.idTexteRessenti=this.Nom+'_TexteRessenti';this.idNbPoint=this.Nom+'_NbPoint_';this.idCommentPoint=this.Nom+'_CommentPoint_';this.idSlashNbPoint=this.Nom+'_SlashNbPoint_';this.idMp3Question=this.Nom+'_mp3question_';this.idMp3Control=this.Nom+'_control_mp3question_';this.idBoutonStart=this.Nom+'_boutonStart';this.idBoutonSubmit=this.Nom+'_boutonSubmit_';this.idBoutonPrev=this.Nom+'_boutonPrev_';this.idBoutonNext=this.Nom+'_boutonNext_';this.idCartoucheCompetences=this.Nom+'_cartoucheCompetences';this.couleurNonVu='White';this.couleurNonRepondu='LightGray';this.couleurValidee='Gray ';this.couleurFaux='#ec636a';this.couleurPartiel='Orange';this.couleurVrai='#9fd647';this.couleurThemeQCM='#62acc5';}
setParametres(aObjet){this.idContenu=aObjet.idContenu;this.numeroExecution=aObjet.numeroExecution;this.modeProf=aObjet.modeProf;this.modeVisuQuestion=false;this.executionQCM=null;this.indiceQuestion= -1;this.listeQuestions=null;this.question=null;this.nbQuestions=null;this.typeNumerotation=null;this.etatCloture=null;this.start=null;this.affichageEnLigne=null;this.affichageUnePage=null;clearInterval(this.intervalChrono);this.intervalChrono=null;this.evaluationNote=[];this.enActualisation=false;}
actualiser(){let lThis;if(this.etatCloture&&$.inArray(this.etatCloture,[TypeEtatExecutionQCMPourRepondant.EQR_EnCours,TypeEtatExecutionQCMPourRepondant.EQR_ARefaire])=== -1&&this.indiceQuestion> -1){if(this.executionQCM.modeDiffusionCorrige===TypeModeCorrectionQCM.FBQ_CorrigeALaFin||this.executionQCM.modeDiffusionCorrige===TypeModeCorrectionQCM.FBQ_CorrigeApresQuestion||((this.executionQCM.estLieADevoir||this.executionQCM.estLieAEvaluation)&&this.executionQCM.publierCorrige)){this.composeCorrigeFin();this.indiceQuestion=this.nbQuestions+Number(this.executionQCM.ressentiRepondant)+1;} else if(!this.executionQCM.estLieADevoir&&!this.executionQCM.estLieAEvaluation){this.composeCorrigeFin(!this.modeProf);} else{this.composeCloture();}
this.formaterLien();this.triggerFinActualisation();return;}
if(!this.affichageEnLigne||$('#'+this.idWrapperAffichage.escapeJQ()+this.indiceQuestion).length===0){if($('#'+this.idWrapperGlobal.escapeJQ()).length===0){this.affichageEnLigne=null;}
let lHtml=[];if(!this.affichageEnLigne){lHtml.push(this.composeOuvertureDivGlobal());}
if(this.executionQCM&&!this.executionQCM.message&&this.estEnInitialisation()&&!this.estEnCloture()){lHtml=lHtml.concat(this.composePageModalite());} else if(this.executionQCM&&!this.executionQCM.message&&this.estEnInitialisation()&&this.estEnCloture()){if(this.executionQCM.estDemarre){lHtml=lHtml.concat(this.composePagePresCorrige());} else{lHtml=lHtml.concat(this.composePageNonDemarre());}} else if(this.executionQCM&&this.estEnCours()&&this.question){this.evaluationNote[this.indiceQuestion]={validee:false};lHtml=lHtml.concat(this.composeAffichageQuestion());} else if(this.executionQCM&&this.executionQCM.message){lHtml.push('<div class="InlineBlock" style="height:100%;vertical-align:middle;"></div><h1 class="InlineBlock" style="vertical-align:middle;text-align:center;font-size:25px;width:99%;border-bottom:',GCouleur.fond,' 1px solid;margin:10px auto 100px;">'+this.executionQCM.message+'</h1>');} else if(this.executionQCM&&this.estEnRessenti()){lHtml=lHtml.concat(this.composeAffichageRessenti());} else if(this.executionQCM&&this.indiceQuestion>=this.nbQuestions){lHtml=lHtml.concat(this.composeAffichageFin());this.interdireFermetureInterface();}
if(!this.affichageEnLigne){lHtml.push(this.composeFermetureDivGlobal());}
const lAsymetrie=estQuestionMatchingASymetrique(this.question);lThis=this;if(!this.affichageEnLigne){$('#'+this.idContenu).IEHtml(lHtml.join(''));$('#'+this.idContenu).ready(function(){if(lThis.executionQCM.autoriserLaNavigation){lThis.ajouterEvenementBarreProgression();}
if(lThis.avecIECheckbox){$('#'+lThis.idContenu).find(':checkbox, :radio').jIECheckBox();}
lThis.actualiserHauteurCartoucheCompetences();lThis.ajouterEvenementQuestion(lAsymetrie);if(lThis.question&&lThis.question.reponsesRepondant){lThis.triggerFinActualisation();lThis.majReponsesRepondant();lThis.formaterLien();lThis.triggerFinActualisation();if(lThis.executionQCM.modeDiffusionCorrige===TypeModeCorrectionQCM.FBQ_CorrigeApresQuestion){lThis.composeCorrige();}}
$('[id^="'+lThis.Nom.escapeJQ()+'_q'+lThis.indiceQuestion+'_div_r"]').each(function(){lThis.actualiserHauteurReponse(this.id);});lThis.actualiserHauteurQuestion();lThis.majChrono();$('#'+lThis.idWrapperAffichage.escapeJQ()+lThis.indiceQuestion).find('div[id^="'+lThis.idMp3Control.escapeJQ()+'"]').on('click',{lThis:lThis},lThis.playMp3);$('#'+lThis.idWrapperAffichage.escapeJQ()+lThis.indiceQuestion).find('audio[id^="'+lThis.idMp3Question.escapeJQ()+'"]').on('ended',function(){$('#'+this.id.replace('_mp3question_','_control_mp3question_').escapeJQ()).trigger('click');});lThis.formaterLien();lThis.triggerFinActualisation();lThis.enActualisation=false;});} else{$('#'+this.idWrapperGlobal.escapeJQ()).find('[id^="'+this.idWrapperAffichage.escapeJQ()+'"]:visible').fadeOut(200,function(){$('#'+lThis.idWrapperGlobal.escapeJQ()).IEHtmlAppend(lHtml.join(''));if(lThis.avecIECheckbox){$('#'+lThis.idWrapperGlobal.escapeJQ()).find(':checkbox, :radio').jIECheckBox();}
$('#'+lThis.idWrapperGlobal.escapeJQ()).ready(function(){lThis.ajouterEvenementQuestion(lAsymetrie);if(lThis.question&&lThis.question.reponsesRepondant){lThis.triggerFinActualisation();lThis.majReponsesRepondant();lThis.formaterLien();lThis.triggerFinActualisation();if(lThis.executionQCM.modeDiffusionCorrige===TypeModeCorrectionQCM.FBQ_CorrigeApresQuestion){lThis.composeCorrige();}}
$('#'+lThis.idWrapperAffichage.escapeJQ()+lThis.indiceQuestion).hide().fadeIn(200);lThis.composeBarreProgression();$('[id^="'+lThis.Nom.escapeJQ()+'_q'+lThis.indiceQuestion+'_div_r"]').each(function(){lThis.actualiserHauteurReponse(this.id);});const $imagesNonChargees=$('#'+lThis.idWrapperAffichage.escapeJQ()+lThis.indiceQuestion).find('img').filter(function(){return!$(this).prop('complete');});if($imagesNonChargees.length){$imagesNonChargees.on('load',lThis.actualiserHauteurQuestion.bind(lThis,lThis.indiceQuestion));} else{lThis.actualiserHauteurQuestion();}
$('#'+lThis.idWrapperAffichage.escapeJQ()+lThis.indiceQuestion).find('div[id^="'+lThis.idMp3Control.escapeJQ()+'"]').on('click',{lThis:lThis},lThis.playMp3);$('#'+lThis.idWrapperAffichage.escapeJQ()+lThis.indiceQuestion).find('audio[id^="'+lThis.idMp3Question.escapeJQ()+'"]').on('ended',function(){$('#'+this.id.replace('_mp3question_','_control_mp3question_').escapeJQ()).trigger('click');});lThis.formaterLien();lThis.triggerFinActualisation();lThis.enActualisation=false;if(lThis.estEnCours()&&lThis.executionQCM.dureeMaxQCM){lThis.majChrono();}});});}
if(this.affichageEnLigne===null){this.affichageEnLigne=this.executionQCM&&this.executionQCM.autoriserLaNavigation&&!this.executionQCM.message;}} else{lThis=this;$('#'+this.idWrapperGlobal.escapeJQ()).find('[id^="'+this.idWrapperAffichage.escapeJQ()+'"]:visible').fadeOut(100,function(){$('#'+lThis.idWrapperAffichage.escapeJQ()+lThis.indiceQuestion).fadeIn(100);lThis.composeBarreProgression();const lJqImg=$('#'+lThis.idWrapperAffichage.escapeJQ()+lThis.indiceQuestion).find('img');if(lJqImg.length){lJqImg.on('load',lThis.actualiserHauteurQuestion.bind(lThis,lThis.indiceQuestion));} else{lThis.actualiserHauteurQuestion();}
lThis.formaterLien();lThis.triggerFinActualisation();lThis.enActualisation=false;});}
if(this.estEnCours()&&this.executionQCM.dureeMaxQCM){this.majChrono();if(!this.intervalChrono){this.intervalChrono=setInterval(this.majChrono.bind(this),5000);}} else if(this.intervalChrono&&!this.estEnCours()){clearInterval(this.intervalChrono);}}
playMp3(aEvent){aEvent.stopImmediatePropagation();if(!$(this).data('play')){$('#'+this.id.replace(/_control/,'').escapeJQ()).get(0).play();$(this).children('span').removeClass('Image_QCM_Son_Play').addClass('Image_QCM_Son_Pause');$(this).data('play',true);} else{$('#'+this.id.replace(/_control/,'').escapeJQ()).get(0).pause();$(this).children('span').removeClass('Image_QCM_Son_Pause').addClass('Image_QCM_Son_Play');$(this).data('play',false);}}
_estUnIDevoir(aExecutionQCM){return(aExecutionQCM.estLieADevoir||aExecutionQCM.estLieAEvaluation);}
_getTitreExecutionQCM(aExecutionQCM){let lTitre='';if(!!aExecutionQCM){if(this._estUnIDevoir(aExecutionQCM)){lTitre=GTraductions.getValeur('ExecutionQCM.typesQCM.IDevoir');} else if(aExecutionQCM.estUnTAF){lTitre=GTraductions.getValeur('ExecutionQCM.typesQCM.QCMDeTaf');} else{lTitre=GTraductions.getValeur('ExecutionQCM.typesQCM.QCMDeContenu');}}
return lTitre;}
_getNomImageTypeExecutionQCM(aExecutionQCM){let lNomImage;if(!!aExecutionQCM){if(aExecutionQCM.estLieADevoir&&aExecutionQCM.estLieAEvaluation){lNomImage='Image_QCM_evaluation_note';} else if(aExecutionQCM.estLieADevoir){lNomImage='Image_QCM_associe_devoir';} else if(aExecutionQCM.estLieAEvaluation){lNomImage='Image_QCM_evaluation';} else if(aExecutionQCM.estUnTAF){lNomImage='Image_QCM_entrainement';} else{lNomImage='Image_QCM_revision';}}
return lNomImage;}
_getIconeTypeExecutionQCM(aExecutionQCM){let lNomImage;if(!!aExecutionQCM){if(aExecutionQCM.estLieADevoir&&aExecutionQCM.estLieAEvaluation){lNomImage='icon_qcm_Evl_Devoir_20';} else if(aExecutionQCM.estLieADevoir){lNomImage='icon_saisie_note';} else if(aExecutionQCM.estLieAEvaluation){lNomImage='icon_saisie_evaluation';} else if(aExecutionQCM.estUnTAF){lNomImage='icon_home';} else{lNomImage='icon_taf';}}
return lNomImage;}
composeLigneInfo(aObjet){const lHtml=[];const lClassContainer=['qcm_visueleve_infocontainer'];const lClassIcon=['qcm_container_icon'];if(!!aObjet.mobile){lClassContainer.push('qcm_visueleve_mobile');lClassIcon.push('mobile');} else{lClassContainer.push('qcm_visueleve_espace');}
if(!!aObjet.classIcon){lClassIcon.push(aObjet.classIcon);}
if(aObjet.classContainer){lClassContainer.push(aObjet.classContainer);}
lHtml.push('<div class="',lClassContainer.join(' '),'">','<div class="',lClassIcon.join(' '),'"><i class="',aObjet.icon,'"></i></div>','<div class="qcm_container_label">',aObjet.label,'</div>','</div>');return lHtml.join('');}
triggerFinActualisation(){}
composeOuvertureDivGlobal(){return'';}
composeFermetureDivGlobal(){return'';}
composeTitre(){return'';}
composeAffichageQuestion(){return[];}
ajouterEvenementQuestion(aAsymetrie){if(this.executionQCM&&this.estEnCours()&&this.question&&this.question.GetGenre()===TypeGenreExerciceDeQuestionnaire.GEQ_Matching){this.ajouterEvenementMatching(this.indiceQuestion,aAsymetrie);} else if(this.executionQCM&&this.estEnCours()&&this.question&&(this.question.GetGenre()===TypeGenreExerciceDeQuestionnaire.GEQ_SingleChoice||this.question.GetGenre()===TypeGenreExerciceDeQuestionnaire.GEQ_MultiChoice)){this.ajouterEvenementSingleMultiChoice(this.indiceQuestion);} else if(this.executionQCM&&this.estEnRessenti()){this.ajouterEvenementRessenti();}}
ajouterEvenementMatching(){}
onClicChipsAudio(aEventJQuery){const lElementAudio=$(aEventJQuery.currentTarget).find('audio').get(0);if(!!lElementAudio){if(UtilitaireAudio.estEnCoursDeLecture(lElementAudio)){UtilitaireAudio.stopAudio(lElementAudio);} else{try{UtilitaireAudio.jouerAudio(lElementAudio);} catch(error){if(error===UtilitaireAudio.ExceptionFichierNonValide){GApplication.getMessage().afficher({message:GTraductions.getValeur('ExecutionQCM.FichierSonNonValide')});}}}}}
onStartAudio(aEventJQuery){const lChipsAudio=$(aEventJQuery.target).closest('.ChipsAudio');if(lChipsAudio){lChipsAudio.removeClass(UtilitaireAudio.IconeLecture).addClass(UtilitaireAudio.IconeStop);}}
onPauseAudio(aEventJQuery){const lChipsAudio=$(aEventJQuery.target).closest('.ChipsAudio');if(lChipsAudio){lChipsAudio.removeClass(UtilitaireAudio.IconeStop).addClass(UtilitaireAudio.IconeLecture);}}
ajouterEvenementSingleMultiChoice(){}
composeAffichageRessenti(){return[];}
ajouterEvenementRessentiEtoile(){$('span[id^="'+this.idRessenti.escapeJQ()+'"]').on('mouseenter',{aObjet:this},function(aEvent){const lThis=aEvent.data.aObjet;const lRessentiTmp=this.id.match(/_([0-9]+)/i)[1];$(this).prevAll().addBack().removeClass('Image_QCM_Etoile_Off').addClass('Image_QCM_Etoile_On').end().end().nextAll().removeClass('Image_QCM_Etoile_On').addClass('Image_QCM_Etoile_Off');$('span#'+lThis.idTexteRessenti.escapeJQ()).text(GTraductions.getValeur('ExecutionQCM.valeurRessenti')[lRessentiTmp-1]);}).on('mouseleave',{aObjet:this},function(aEvent){const lThis=aEvent.data.aObjet;$(this).siblings().addBack().removeClass('Image_QCM_Etoile_On').addClass('Image_QCM_Etoile_Off');$('span#'+lThis.idTexteRessenti.escapeJQ()).text('');if(lThis.ressenti>0){$('span#'+lThis.idRessenti.escapeJQ()+'_'+lThis.ressenti).prevAll().addBack().removeClass('Image_QCM_Etoile_Off').addClass('Image_QCM_Etoile_On');$('span#'+lThis.idTexteRessenti.escapeJQ()).text(GTraductions.getValeur('ExecutionQCM.valeurRessenti')[lThis.ressenti-1]);}}).on('click',{aObjet:this},function(aEvent){const lThis=aEvent.data.aObjet;const lRessenti=this.id.match(/_([0-9]+)/i)[1];lThis.ressenti=parseInt(lRessenti);$('#'+lThis.idBoutonSubmit.escapeJQ()+lThis.indiceQuestion).show();});}
ajouterEvenementRessenti(){$('span[id^="'+this.idRessenti.escapeJQ()+'"]').on('mouseenter',{aObjet:this},function(){$(this).css({color:GCouleur.noir}).siblings('span').css({color:GCouleur.grisClair});}).on('mouseleave',{aObjet:this},function(aEvent){const lThis=aEvent.data.aObjet;$(this).siblings('span').addBack().css({color:GCouleur.grisClair});if(lThis.ressentiSelectionne){$('span#'+lThis.idRessenti.escapeJQ()+'_'+lThis.ressenti).css({color:GCouleur.noir});}}).on('click',{aObjet:this},function(aEvent){const lThis=aEvent.data.aObjet;lThis.ressentiSelectionne=true;const lRessenti=this.id.match(/_([0-9]+)/i)[1];lThis.ressenti=parseInt(lRessenti);$(this).css({color:GCouleur.noir}).siblings('span').css({color:GCouleur.grisClair});$('#'+lThis.idBoutonSubmit.escapeJQ()+lThis.nbQuestions).show();});}
composeAffichageFin(){return[];}
composePageNonDemarre(){return[];}
composeCloture(){return[];}
formaterLien(){$('#'+this.idContenu).find('a[href]').each(function(){let lUrl=$(this).attr('href');if(lUrl.search(/^(ht|f)tp/gi)!==0){lUrl='http://'+lUrl;$(this).prop('href',lUrl);}});}
composeCorrigeFin(aSansCorrige){this.affichageUnePage=true;$('#'+this.idContenu).IEHtml('');let lHtml=[];lHtml=lHtml.concat(this.composeAffichageCorrigeFin());$('#'+this.idContenu).IEHtml(lHtml.join(''));if(this.avecIECheckbox){$('#'+this.idContenu).find(':checkbox, :radio').jIECheckBox();}
this.formaterLien();this.triggerFinActualisation();this.nbImages=$('#'+this.idContenu).find('img').length;$('#'+this.idContenu).ready(function(){const lThis=this;$('[id^="'+this.idWrapperAffichage+'"]').each(function(){const lJqImg=$(this).find('img');if(lJqImg.length){const lId=parseInt(this.id.slice(lThis.idWrapperAffichage.length));lJqImg.on('load',lThis.actualiserHauteurQuestion.bind(lThis,lId));}});const lBackupIndice=this.indiceQuestion;const aNbr=this.listeQuestions?this.listeQuestions.GetNbrElements():0;for(let aIndice=0;aIndice<aNbr;aIndice++){this.indiceQuestion=aIndice;this.question=this.listeQuestions.GetElement(aIndice);const lAsymetrie=estQuestionMatchingASymetrique(this.question);this.ajouterEvenementQuestion(lAsymetrie);this.majReponsesRepondant();if(!aSansCorrige){this.composeCorrige();} else{this.desactiveEvent();$('#'+this.idBoutonNext.escapeJQ()+this.indiceQuestion).show();}}
this.indiceQuestion=lBackupIndice;$('[id^="'+this.idWrapperAffichage+'"]').find('div[id^="'+this.idMp3Control.escapeJQ()+'"]').on('click',{lThis:this},this.playMp3);$('[id^="'+this.idWrapperAffichage+'"]').find('audio[id^="'+this.idMp3Question.escapeJQ()+'"]').on('ended',function(){$('#'+this.id.replace('_mp3question_','_control_mp3question_').escapeJQ()).trigger('click');});this.actualiserHauteurCorrige();this.enActualisation=false;this.triggerFinActualisation();this.autoriserFermetureInterface();}.bind(this));}
autoriserFermetureInterface(){}
interdireFermetureInterface(){}
composeAffichageCorrigeFin(){return[];}
actualiserHauteurCartoucheCompetences(){}
actualiserHauteurCorrige(){}
actualiserHauteurQuestion(){}
actualiserHauteurReponse(){}
composePageModalite(){return[];}
composePagePresCorrige(){return[];}
composeChrono(){return[];}
majChrono(){if($('#'+this.idValeurChrono.escapeJQ()).length===0&&this.intervalChrono){clearInterval(this.intervalChrono);return;}
if(!this.executionQCM.dureeMaxQCM){return;}
const lMinRestantes=this.getMinutesChrono();let lTextTime=lMinRestantes;let lLibelleTime=GTraductions.getValeur('ExecutionQCM.MinutesCourt');if(lMinRestantes<1){lTextTime='&lt; 1';if(this.getMilliSecondesChrono()/1000<=30){lTextTime='&lt; 30';lLibelleTime=GTraductions.getValeur('ExecutionQCM.SecondesCourt');}}
this.composeMajChrono(lTextTime,lLibelleTime);}
composeMajChrono(){}
getMinutesChrono(){const lSecRestantes=this.getMilliSecondesChrono(),lTpsRestant=new Date(lSecRestantes>0?lSecRestantes:0),lMinutes=lTpsRestant.getUTCHours()*60+lTpsRestant.getUTCMinutes();return lMinutes;}
getMilliSecondesChrono(){const lMinutesSupplementaire=!this.modeProf&&(this.executionQCM.dureeMaxQCM>0)&&(this.executionQCM.dureeSupplementaire>0)?TUtilitaireDuree.dureeEnMin(this.executionQCM.dureeSupplementaire):0;const lSecRestantes=new Date(0).setUTCMinutes(TUtilitaireDuree.dureeEnMin(this.executionQCM.dureeMaxQCM)+lMinutesSupplementaire)-(new Date().getTime()-this.start);return lSecRestantes;}
composeBarreProgression(){let lHtml=[];lHtml=lHtml.concat(this.composeAffichageBarreProgression());if(this.affichageEnLigne){$('#'+this.idWrapperBarreProgression.escapeJQ()).IEHtml(lHtml.join(''));this.composeMiseEnFormeBarreProgression();}
return lHtml;}
composeAffichageBarreProgression(){return[];}
composeMiseEnFormeBarreProgression(){}
getCouleurPointProgression(aIndice){let lBackColor=this.couleurNonVu;if(this.evaluationNote[aIndice]){if(this.evaluationNote[aIndice].nbBonnesReponses&&this.evaluationNote[aIndice].nbReponsesJustes>=0){if(this.evaluationNote[aIndice].typeQualifReponse!==undefined){lBackColor=(this.evaluationNote[aIndice].typeQualifReponse===TypeQualificatifReponse.qrBonne?this.couleurVrai:(this.evaluationNote[aIndice].typeQualifReponse===TypeQualificatifReponse.qrBonnePartielle?this.couleurPartiel:this.couleurFaux));} else{if(this.evaluationNote[aIndice].nbReponsesJustes===0){lBackColor=this.couleurFaux;} else if(this.evaluationNote[aIndice].nbReponsesJustes===this.evaluationNote[aIndice].nbBonnesReponses){lBackColor=this.couleurVrai;} else if(this.evaluationNote[aIndice].nbReponsesJustes<this.evaluationNote[aIndice].nbBonnesReponses){lBackColor=this.couleurPartiel;}}} else if(this.evaluationNote[aIndice].validee){lBackColor=this.couleurValidee;} else{lBackColor=this.couleurNonRepondu;}}
return lBackColor;}
ajouterEvenementBarreProgression(){}
composeRessentiEtoile(){return[];}
composeRessenti(){return[];}
composeNavigation(){return[];}
composeCorrige(){if(this.question.GetGenre()===TypeGenreExerciceDeQuestionnaire.GEQ_SingleChoice||this.question.GetGenre()===TypeGenreExerciceDeQuestionnaire.GEQ_MultiChoice){this.composeCorrigeSingleMulti();} else if(this.question.GetGenre()===TypeGenreExerciceDeQuestionnaire.GEQ_NumericalAnswer){this.composeCorrigeNumerique();} else if(this.question.GetGenre()===TypeGenreExerciceDeQuestionnaire.GEQ_ShortAnswer){this.composeCorrigeShort();} else if(this.question.GetGenre()===TypeGenreExerciceDeQuestionnaire.GEQ_SpellAnswer){this.composeCorrigeSpell();} else if(this.question.GetGenre()===TypeGenreExerciceDeQuestionnaire.GEQ_Matching){this.composeCorrigeMatching();} else if(this.question.GetGenre()===TypeGenreExerciceDeQuestionnaire.GEQ_ClozeField||this.question.GetGenre()===TypeGenreExerciceDeQuestionnaire.GEQ_ClozeFixed||this.question.GetGenre()===TypeGenreExerciceDeQuestionnaire.GEQ_ClozeVariable){this.composeCorrigeCloze();}
let lSpanTexteBonneReponse='';const lAfficherTexteBonneReponse=(!!this.question.noteEleve&&this.question.qualif===TypeQualificatifReponse.qrBonne)||(!this.question.noteEleve&&this.evaluationNote[this.indiceQuestion].nbBonnesReponses===this.evaluationNote[this.indiceQuestion].nbReponsesJustes);if(lAfficherTexteBonneReponse){lSpanTexteBonneReponse='<span style="margin-right: 20px; color: '+this.couleurVrai+';">'+GTraductions.getValeur('ExecutionQCM.BonneReponse')+'</span>';}
let lSpanValeurReponse='';let lSpanCommentPoint='';if(!!this.question.noteEleve){const lCouleurValeurReponse=(this.question.qualif===TypeQualificatifReponse.qrBonne?this.couleurVrai:(this.question.qualif===TypeQualificatifReponse.qrBonnePartielle?this.couleurPartiel:this.couleurFaux));if(this.executionQCM.estLieADevoir||(this.executionQCM.estUnTAF&&!!this.executionQCM.afficherResultatNote)){lSpanValeurReponse='<span style="color: '+lCouleurValeurReponse+';">'+this.question.noteEleve.toString()+(this.question.estAnnotee?'*':'')+'</span>';if(this.question.estAnnotee){lSpanCommentPoint='<span style="color: '+this.couleurFaux+';">* '+GTraductions.getValeur('ExecutionQCM.presentationCorrige.PointsRectifies')+'</span>';}
$('#'+this.idSlashNbPoint.escapeJQ()+this.indiceQuestion).show();} else{lSpanValeurReponse='<span class="InlineBlock" style="width: 15px; height: 15px; vertical-align: middle; background-color: '+lCouleurValeurReponse+';">&nbsp;</span>';}}
if(lSpanTexteBonneReponse||lSpanValeurReponse){$('#'+this.idNbPoint.escapeJQ()+this.indiceQuestion).IEHtml(lSpanTexteBonneReponse+lSpanValeurReponse).show();if(!!lSpanCommentPoint){$('#'+this.idCommentPoint.escapeJQ()+this.indiceQuestion).IEHtml(lSpanCommentPoint).show();}}
this.formaterLien();this.triggerFinActualisation();$('#'+this.idBoutonNext.escapeJQ()+this.indiceQuestion).html(GTraductions.getValeur('ExecutionQCM.JeContinue')).show();$('#'+this.idBoutonSubmit.escapeJQ()+this.indiceQuestion).hide();this.actualiserHauteurQuestion();}
composeCorrigeSingleMulti(){const lEstQuestionAChoixUnique=this.question.GetGenre()===TypeGenreExerciceDeQuestionnaire.GEQ_SingleChoice;const lFnEstUneBonneReponse=function(aReponse){return lEstQuestionAChoixUnique?(aReponse.fractionReponse===100):(aReponse.fractionReponse>0);};const lEvaluationNotePourQuestion={nbBonnesReponses:this.question.listeReponses.getListeElements(function(aReponse){return lFnEstUneBonneReponse(aReponse);}).GetNbrElements(),nbReponsesJustes:0,typeQualifReponse:this.question.qualif};const lThis=this;let lForcerFaux=false;$('[id^="'+this.Nom+'_q'+this.indiceQuestion+'_r"]:checked').each(function(){const lIndice=this.id.match(/_r([0-9]+)$/i)[1];const lReponse=lThis.question.listeReponses.GetElement(lIndice);if(lFnEstUneBonneReponse(lReponse)){lEvaluationNotePourQuestion.nbReponsesJustes+=1;} else{lForcerFaux=true;}});if(!this.executionQCM.acceptIncomplet&&lEvaluationNotePourQuestion.nbReponsesJustes!==lEvaluationNotePourQuestion.nbBonnesReponses){lEvaluationNotePourQuestion.nbReponsesJustes=0;}
if(!this.executionQCM.tolererFausses&&lForcerFaux){lEvaluationNotePourQuestion.nbReponsesJustes=0;}
for(let i=0;i<this.question.listeReponses.GetNbrElements();i++){if(!$('[id="'+this.Nom+'_q'+this.indiceQuestion+'_r'+i+'"]').is(':checked')){const lReponse=this.question.listeReponses.GetElement(i);if(lReponse&&lReponse.Existe()){if(lFnEstUneBonneReponse(lReponse)){this.composeAffichageCorrigeSingleMultiVraiNonCoche('[id="'+this.Nom+'_q'+this.indiceQuestion+'_r'+i+'"]');} else if(lEvaluationNotePourQuestion.nbReponsesJustes!==lEvaluationNotePourQuestion.nbBonnesReponses){this.composeAffichageCorrigeSingleMultiFauxNonCoche('[id="'+this.Nom+'_q'+this.indiceQuestion+'_r'+i+'"]');}}}}
$('[id^="'+this.Nom+'_q'+this.indiceQuestion+'_r"]:checked').each(function(){const lIndice=this.id.match(/_r([0-9]+)$/i)[1];const lReponse=lThis.question.listeReponses.GetElement(lIndice);const lEstUneBonneReponse=lFnEstUneBonneReponse(lReponse);if(lEvaluationNotePourQuestion.nbReponsesJustes!==lEvaluationNotePourQuestion.nbBonnesReponses){if(lEstUneBonneReponse){lThis.composeAffichageCorrigeSingleMultiVraiCoche(this);} else{lThis.composeAffichageCorrigeSingleMultiFauxCoche(this);}} else{if(lEstUneBonneReponse){lThis.composeAffichageCorrigeSingleMultiVraiCoche(this,true);}}
if(lReponse.feedback){lThis.composeAffichageCorrigeSingleMultiFeedback('[id="'+lThis.Nom+'_q'+lThis.indiceQuestion+'_r'+lIndice+'"]',(lEstUneBonneReponse?lThis.couleurVrai:lThis.couleurFaux),lReponse.feedback);}});this.evaluationNote[this.indiceQuestion]=lEvaluationNotePourQuestion;this.desactiveEventSingleMulti(this.indiceQuestion);}
composeAffichageCorrigeSingleMultiVraiCoche(){}
composeAffichageCorrigeSingleMultiVraiNonCoche(){}
composeAffichageCorrigeSingleMultiFauxCoche(){}
composeAffichageCorrigeSingleMultiFauxNonCoche(){}
composeAffichageCorrigeSingleMultiFeedback(){}
desactiveEventSingleMulti(){}
composeCorrigeShort(){this.evaluationNote[this.indiceQuestion]={nbBonnesReponses:1,nbReponsesJustes:0,typeQualifReponse:this.question.qualif};let lBonneReponses=new ObjetListeElements();const lJqInput=$('#'+this.Nom.escapeJQ()+'_q'+this.indiceQuestion+'_r0');const lReponse=GChaine.ajouterEntites(lJqInput.val());if(!!this.question.listeReponses){const lCaseSensitive=this.question.casesensitive;lBonneReponses=this.question.listeReponses.getListeElements(function(aEle){return _comparerChaines(aEle.GetLibelle(),lReponse,lCaseSensitive);});} else{}
if(lBonneReponses.GetNbrElements()){this.evaluationNote[this.indiceQuestion].nbReponsesJustes=1;this.composeAffichageCorrigeShortVrai(lJqInput.get(0));if(lBonneReponses.GetElement(0).feedback){this.composeAffichageCorrigeShortFeedback(lJqInput.get(0),this.couleurVrai,lBonneReponses.GetElement(0).feedback);}} else{if(!!this.question.listeReponses){this.composeAffichageCorrigeShortFaux(lJqInput.get(0),this.question.listeReponses.GetElement(0).GetLibelle(),this.question.incorrectFeedback);}}
this.desactiveEventShort(this.indiceQuestion);}
construitBlocIncorrectFeedback(aIncorrectFeedback){const H=[];H.push('<div class="BlocIncorrectFeedback">');H.push('<i class="icon_arrow_right"></i>');H.push('<div>',aIncorrectFeedback,'</div>');H.push('</div>');return H.join('');}
composeCorrigeSpell(){this.evaluationNote[this.indiceQuestion]={nbBonnesReponses:1,nbReponsesJustes:0,typeQualifReponse:this.question.qualif};const lJqInput=$('[name="'+this.Nom.escapeJQ()+'_q'+this.indiceQuestion+'_r"]');let lReponse='';lJqInput.each(function(){lReponse+=$(this).val().replace("’","'");});lReponse=GChaine.ajouterEntites(lReponse);const lCaseSensitive=this.question.casesensitive;const lBonneReponses=this.question.listeReponses.getListeElements(function(aEle){return _comparerChaines(aEle.GetLibelle(),lReponse,lCaseSensitive);});if(lBonneReponses.GetNbrElements()){this.evaluationNote[this.indiceQuestion].nbReponsesJustes=1;this.composeAffichageCorrigeSpellVrai('[name="'+this.Nom.escapeJQ()+'_q'+this.indiceQuestion+'_r"]');if(lBonneReponses.GetElement(0).feedback){this.composeAffichageCorrigeSpellFeedback('[name="'+this.Nom.escapeJQ()+'_q'+this.indiceQuestion+'_r"]',this.couleurVrai,lBonneReponses.GetElement(0).feedback);}} else{this.composeAffichageCorrigeSpellFaux('[name="'+this.Nom.escapeJQ()+'_q'+this.indiceQuestion+'_r"]',this.question.listeReponses.GetElement(0).GetLibelle());}
this.desactiveEventSpell(this.indiceQuestion);}
composeCorrigeNumerique(){this.evaluationNote[this.indiceQuestion]={nbBonnesReponses:1,nbReponsesJustes:0,typeQualifReponse:this.question.qualif};const lJqInput=$('#'+this.Nom.escapeJQ()+'_q'+this.indiceQuestion+'_r0');let lReponse=lJqInput.val();lReponse=lReponse.replace(/\s+/gi,'');lReponse=lReponse.replace(/\./,',').replace(/٫/gi,',').replace(/²/gi,'2').replace(/³/gi,'3');lReponse=GChaine.latinize(lReponse).toLowerCase();lReponse=GChaine.ajouterEntites(lReponse);const lBonneReponses=this.question.listeReponses.getListeElements(function(aEle){return GChaine.latinize(aEle.GetLibelle().replace(/\s+/gi,'').replace(/\./,',').replace(/٫/gi,',').replace(/²/gi,'2').replace(/³/gi,'3')).toLowerCase()===lReponse;});if(lBonneReponses.GetNbrElements()){this.evaluationNote[this.indiceQuestion].nbReponsesJustes=1;this.composeAffichageCorrigeShortVrai(lJqInput.get(0));if(lBonneReponses.GetElement(0).feedback){this.composeAffichageCorrigeShortFeedback(lJqInput.get(0),this.couleurVrai,lBonneReponses.GetElement(0).feedback);}} else{this.composeAffichageCorrigeShortFaux(lJqInput.get(0),this.question.listeReponses.GetElement(0).GetLibelle(),this.question.incorrectFeedback);}
this.desactiveEventShort(this.indiceQuestion);}
composeAffichageCorrigeShortVrai(){}
composeAffichageCorrigeShortFaux(){}
composeAffichageCorrigeShortFeedback(){}
desactiveEventShort(){}
composeAffichageCorrigeSpellVrai(){}
composeAffichageCorrigeSpellFaux(){}
composeAffichageCorrigeSpellFeedback(){}
desactiveEventSpell(){}
composeCorrigeMatching(){this.evaluationNote[this.indiceQuestion]={nbBonnesReponses:this.question.listeReponses.GetNbrElements(),nbReponsesJustes:0,typeQualifReponse:this.question.qualif};const lThis=this;const lAsymetrie=estQuestionMatchingASymetrique(this.question);this.composeMiseEnFormeCorrigeMatching(lAsymetrie);$('[id^="'+this.Nom+'_q'+this.indiceQuestion+'_drop"]').each(function(aIndexBoucle){const lIndice=this.id.match(/_drop([0-9]+)$/i)[1];const lReponse=lThis.getReponseMatching(this);const lBonneReponse=lThis.question.listeReponses.GetElement(lIndice).bonneReponse;let lEstLaBonneReponse=false;if(!!lBonneReponse){lEstLaBonneReponse=(lReponse===lBonneReponse.hashContenu);}
if(lEstLaBonneReponse){lThis.evaluationNote[lThis.indiceQuestion].nbReponsesJustes+=1;}
lThis.composeCorrigeReponseCorrigeMatching('#'+lThis.idWrapperAffichage.escapeJQ()+lThis.indiceQuestion+' .objetVisuEleveAssocCorriges',lThis.Nom+'_q'+lThis.indiceQuestion+'_c'+lIndice,lEstLaBonneReponse,lBonneReponse,lEstLaBonneReponse?lThis.couleurVrai:lThis.couleurFaux,aIndexBoucle);lThis.composeMiseEnFormeCorrigeReponseCorrigeMatching(this);});this.desactiveEventMatching(lAsymetrie);}
composeMiseEnFormeCorrigeMatching(){}
composeCorrigeReponseCorrigeMatching(){}
composeMiseEnFormeCorrigeReponseCorrigeMatching(){}
desactiveEventMatching(){}
composeCorrigeCloze(){const lEnonceOriginel=this.question.enonceOriginel.replace(/&#039;/gi,'&apos;').replace(/’/g,"'").replace(/«/g,'"').replace(/»/g,'"');let lReponses=lEnonceOriginel.match(/({[0-9]*:(?:ShortAnswer|MultiChoice):(?:~*(?:%[0-9]{1,3}%|=)?[^~%#{}]+#[^~%#{}]*)+})/gi);if(this.question.casesensitive===false){lReponses=$.map(lReponses,function(aEle){return GChaine.latinize(aEle.toLowerCase());});}
const lReponsesJustes=[];this.evaluationNote[this.indiceQuestion]={nbBonnesReponses:lReponses?lReponses.length:null,nbReponsesJustes:0,typeQualifReponse:this.question.qualif};const lThis=this;$('#'+this.idWrapperEnonce.escapeJQ()+this.indiceQuestion).find('select[id], input[id][type="text"]:not(.select-dropdown)').each(function(aIndex){let lReponse=$(this).val().replace(/’/g,"'").replace(/«/g,'"').replace(/»/g,'"');let lValRep=false;if(!!lReponse){if($(this).is('input')){lReponse=lReponse.replace(/^\s+/,'').replace(/\s+$/,'').replace(/\s+/gi,' ');}
if(lThis.question.casesensitive===false){lValRep=lReponses[aIndex].match(new RegExp('(?::|~)(%[0-9]{1,3}%|=)?'+GChaine.latinize(lReponse.replace(/(\(|\)|\[|\]|\+|\*|\.|\^|\$|\?|\\|\{|\}|\|)/g,'\\$1')).toLowerCase()+'(#|~)',''));} else{lValRep=lReponses[aIndex].match(new RegExp('(?::|~)(%[0-9]{1,3}%|=)?'+lReponse.replace(/(\(|\)|\[|\]|\+|\*|\.|\^|\$|\?|\\|\{|\}|\|)/g,'\\$1')+'(#|~)',''));}}
lValRep=lValRep&&lValRep[1]?lValRep[1].replace(/%/gi,'').replace('=','100'):'0';if(parseInt(lValRep)===100){lThis.evaluationNote[lThis.indiceQuestion].nbReponsesJustes+=1;lReponsesJustes[aIndex]=1;}
lThis.composeMiseEnFormeReponseCorrigeCloze(this,parseInt(lValRep)===100?'black':lThis.couleurFaux,lReponse);});if(this.evaluationNote[this.indiceQuestion].nbBonnesReponses!==this.evaluationNote[this.indiceQuestion].nbReponsesJustes){this.composeMiseEnFormeWrapperEnonceCloze('#'+this.idWrapperEnonce.escapeJQ()+this.indiceQuestion);let lInc=0;this.composeMiseEnFormeWrapperCorrigeCloze('#'+this.idWrapperEnonce.escapeJQ()+this.indiceQuestion,lEnonceOriginel.replace(/({[0-9]*:(ShortAnswer|MultiChoice):.*?(~*(?:%100%|=)([^~%#{}]+)#[^~%#{}]*).*?})/gi,function(aMatch,aA,aB,aC,aD){return lThis.composeMiseEnFormeCorrectionCorrigeCloze(aD,(lReponsesJustes[lInc++]===1?'':'color:'+lThis.couleurFaux+';')+'font-weight:bold;');}));}
this.actualiserHauteurQuestion();}
composeMiseEnFormeReponseCorrigeCloze(){}
composeMiseEnFormeWrapperEnonceCloze(){}
composeMiseEnFormeWrapperCorrigeCloze(){}
composeMiseEnFormeCorrectionCorrigeCloze(){return'';}
desactiveEventCloze(){}
majReponsesRepondant(){if(this.question.GetGenre()===TypeGenreExerciceDeQuestionnaire.GEQ_SingleChoice||this.question.GetGenre()===TypeGenreExerciceDeQuestionnaire.GEQ_MultiChoice){this.majReponsesSingleMulti();} else if(this.question.GetGenre()===TypeGenreExerciceDeQuestionnaire.GEQ_ShortAnswer||this.question.GetGenre()===TypeGenreExerciceDeQuestionnaire.GEQ_NumericalAnswer){this.majReponsesShort();} else if(this.question.GetGenre()===TypeGenreExerciceDeQuestionnaire.GEQ_SpellAnswer){this.majReponsesSpell();} else if(this.question.GetGenre()===TypeGenreExerciceDeQuestionnaire.GEQ_Matching){this.majReponsesMatching();} else if(this.question.GetGenre()===TypeGenreExerciceDeQuestionnaire.GEQ_ClozeField||this.question.GetGenre()===TypeGenreExerciceDeQuestionnaire.GEQ_ClozeFixed||this.question.GetGenre()===TypeGenreExerciceDeQuestionnaire.GEQ_ClozeVariable){this.majReponsesCloze();}
$('#'+this.idBoutonNext.escapeJQ()+this.indiceQuestion).show();}
desactiveEvent(){if(this.question.GetGenre()===TypeGenreExerciceDeQuestionnaire.GEQ_SingleChoice||this.question.GetGenre()===TypeGenreExerciceDeQuestionnaire.GEQ_MultiChoice){this.desactiveEventSingleMulti(this.indiceQuestion);} else if(this.question.GetGenre()===TypeGenreExerciceDeQuestionnaire.GEQ_ShortAnswer||this.question.GetGenre()===TypeGenreExerciceDeQuestionnaire.GEQ_NumericalAnswer){this.desactiveEventShort(this.indiceQuestion);} else if(this.question.GetGenre()===TypeGenreExerciceDeQuestionnaire.GEQ_SpellAnswer){this.desactiveEventSpell(this.indiceQuestion);} else if(this.question.GetGenre()===TypeGenreExerciceDeQuestionnaire.GEQ_Matching){const lAsymetrie=estQuestionMatchingASymetrique(this.question);this.desactiveEventMatching(lAsymetrie);} else if(this.question.GetGenre()===TypeGenreExerciceDeQuestionnaire.GEQ_ClozeField||this.question.GetGenre()===TypeGenreExerciceDeQuestionnaire.GEQ_ClozeFixed||this.question.GetGenre()===TypeGenreExerciceDeQuestionnaire.GEQ_ClozeVariable){this.desactiveEventCloze(this.indiceQuestion);}}
majReponsesSingleMulti(){for(const x in this.question.reponsesRepondant){if(this.question.reponsesRepondant[x]!==''){this.composeMajReponsesSingleMulti('#'+this.Nom.escapeJQ()+'_q'+this.indiceQuestion+'_r'+(parseInt(this.question.reponsesRepondant[x])-1),true);}}}
majReponsesShort(){const lJqInput=$('#'+this.Nom.escapeJQ()+'_q'+this.indiceQuestion+'_r0');if(this.question.reponsesRepondant&&this.question.reponsesRepondant[0]){this.composeMajReponsesShort(lJqInput,GChaine.enleverEntites(this.question.reponsesRepondant[0]));}}
majReponsesSpell(){if(this.question.reponsesRepondant&&this.question.reponsesRepondant[0]){this.composeMajReponsesSpell('[name="'+this.Nom.escapeJQ()+'_q'+this.indiceQuestion+'_r"]',GChaine.enleverEntites(this.question.reponsesRepondant[0]));}}
majReponsesMatching(){const lUsedDraggable=[];const lAsymetrie=estQuestionMatchingASymetrique(this.question);for(const x in this.question.reponsesRepondant){if(this.question.reponsesRepondant[x]!==''){const lResult=this.composeMajReponsesMatching('#'+this.Nom.escapeJQ()+'_q'+this.indiceQuestion+'_drop'+x,this.Nom+'_q'+this.indiceQuestion+'_r',GChaine.enleverEntites(this.question.reponsesRepondant[x]),lUsedDraggable,lAsymetrie);if(lResult){lUsedDraggable.push(lResult);} else{}}}}
majReponsesCloze(){const lThis=this;$('#'+this.idWrapperEnonce.escapeJQ()+this.indiceQuestion).find('select, input[type="text"]:not(.select-dropdown)').each(function(aIndex){if(lThis.question.reponsesRepondant&&lThis.question.reponsesRepondant[aIndex]!==''){lThis.composeMajReponsesCloze(this,GChaine.enleverEntites(lThis.question.reponsesRepondant[aIndex]));}});}
composeMajReponsesSingleMulti(){}
composeMajReponsesShort(){}
composeMajReponsesSpell(){}
composeMajReponsesMatching(){return'';}
composeMajReponsesCloze(){}
recupererReponses(){const lReponses=[];let lJqInput,lReponse;if(this.question.GetGenre()===TypeGenreExerciceDeQuestionnaire.GEQ_SingleChoice||this.question.GetGenre()===TypeGenreExerciceDeQuestionnaire.GEQ_MultiChoice){$('[id^="'+this.Nom+'_q'+this.indiceQuestion+'_r"]:checked').each(function(){const lIndice=this.id.match(/_r([0-9]+)$/i)[1];lReponses.push(parseInt(lIndice)+1);});} else if(this.question.GetGenre()===TypeGenreExerciceDeQuestionnaire.GEQ_ShortAnswer||this.question.GetGenre()===TypeGenreExerciceDeQuestionnaire.GEQ_NumericalAnswer){lJqInput=$('#'+this.Nom.escapeJQ()+'_q'+this.indiceQuestion+'_r0');lReponse=lJqInput.val().replace(/^\s+/,'').replace(/\s+$/,'').replace(/\s+/gi,' ');lReponses.push(lReponse);} else if(this.question.GetGenre()===TypeGenreExerciceDeQuestionnaire.GEQ_SpellAnswer){lJqInput=$('input[name="'+this.Nom.escapeJQ()+'_q'+this.indiceQuestion+'_r"]');lReponse='';lJqInput.each(function(){lReponse+=$(this).val();});lReponse=lReponse.replace(/^\s+/,'').replace(/\s+$/,'').replace(/\s+/gi,' ');lReponses.push(lReponse);} else if(this.question.GetGenre()===TypeGenreExerciceDeQuestionnaire.GEQ_Matching){const lThis=this;$('[id^="'+this.Nom+'_q'+this.indiceQuestion+'_drop"]').each(function(){lReponses.push(lThis.getReponseMatching(this));});} else if(this.question.GetGenre()===TypeGenreExerciceDeQuestionnaire.GEQ_ClozeField||this.question.GetGenre()===TypeGenreExerciceDeQuestionnaire.GEQ_ClozeFixed||this.question.GetGenre()===TypeGenreExerciceDeQuestionnaire.GEQ_ClozeVariable){$('#'+this.idWrapperEnonce.escapeJQ()+this.indiceQuestion).find('select, input[type="text"]:not(.select-dropdown)').each(function(){lReponse=$(this).val();if($(this).is('input')){lReponse=lReponse.replace(/^\s+/,'').replace(/\s+$/,'').replace(/\s+/gi,' ');}
lReponses.push(lReponse);});}
return lReponses;}
getReponseMatching(){}
setDonnees(aParam){if(this.estEnInitialisation()){this.executionQCM=aParam;let lNbQuestions=0;if(this.executionQCM.QCM&&this.executionQCM.QCM.nbQuestion){lNbQuestions=this.executionQCM.QCM.nbQuestion;} else if(this.executionQCM.nombreQuestionsSoumises){lNbQuestions=this.executionQCM.nombreQuestionsSoumises;} else if(this.executionQCM.QCM&&this.executionQCM.QCM.nbQuestionsTotal){lNbQuestions=this.executionQCM.QCM.nbQuestionsTotal;} else{lNbQuestions=this.executionQCM.nbQuestionsTotal;}
if(lNbQuestions>1&&!!this.executionQCM.nombreQuestionsEnMoins){lNbQuestions=lNbQuestions-this.executionQCM.nombreQuestionsEnMoins;}
if(this.executionQCM.QCM&&this.executionQCM.QCM.nombreQuestObligatoires){const lNbQuestionsObligatoires=this.executionQCM.QCM.nombreQuestObligatoires;if(!!lNbQuestionsObligatoires){lNbQuestions=Math.max(lNbQuestionsObligatoires,lNbQuestions);}}
this.nbQuestions=Math.max(1,lNbQuestions);if(!!this.executionQCM.listeCompetences){this.executionQCM.listeCompetences.setTri([ObjetTri.init('Libelle')]);this.executionQCM.listeCompetences.trier();}}
if(aParam.message){this.executionQCM.message=aParam.message;}
if(this.typeNumerotation===undefined||this.typeNumerotation===null){this.typeNumerotation=aParam.QCM&&aParam.QCM.typeNumerotation!==undefined?aParam.QCM.typeNumerotation:aParam.contenuQCM&&aParam.contenuQCM.typeNumerotation!==undefined?aParam.contenuQCM.typeNumerotation:aParam.typeNumerotation;}
if(aParam&&((aParam.QCM&&aParam.QCM.etatCloture>=0)||aParam.etatCloture>=0)){this.etatCloture=aParam.etatCloture?aParam.etatCloture:aParam.QCM.etatCloture;}
if(aParam.QCM&&aParam.modeVisuQuestion&&aParam.modeVisuQuestion===true&&$.isNumeric(aParam.questionEnVisu)){this.indiceQuestion=aParam.questionEnVisu;this.modeVisuQuestion=aParam.modeVisuQuestion;} else{this.modeVisuQuestion=false;}
if(aParam.QCM){if(aParam.QCM.secEcoulees){this.start=new Date().getTime()-(aParam.QCM.secEcoulees*1000);} else if(!this.start&&!this.estEnInitialisation()){this.start=new Date().getTime();}
if(aParam.QCM.listeQuestions&&!this.modeProf&&$.inArray(this.etatCloture,[TypeEtatExecutionQCMPourRepondant.EQR_EnCours,TypeEtatExecutionQCMPourRepondant.EQR_ARefaire])> -1){this.question=aParam.QCM.listeQuestions.GetElement(0);} else if(aParam.QCM.listeQuestions){this.listeQuestions=aParam.QCM.listeQuestions;this.question=aParam.QCM.listeQuestions.GetElement(this.indiceQuestion);}}
if(this.estEnInitialisation()||!this.estEnCloture()||this.estEnCorrigeFin()){this.actualiser();}}
setDonneesReponse(aParam){this.etatCloture=aParam.etatCloture;if(aParam.etatCloture!==undefined&&$.inArray(aParam.etatCloture,[TypeEtatExecutionQCMPourRepondant.EQR_EnCours,TypeEtatExecutionQCMPourRepondant.EQR_ARefaire])=== -1&&this.executionQCM.modeDiffusionCorrige!==TypeModeCorrectionQCM.FBQ_CorrigeALaFin){this.composeCloture();if(aParam.etatCloture===TypeEtatExecutionQCMPourRepondant.EQR_DureeMaxDepassee){this.indiceQuestion=this.nbQuestions+Number(this.executionQCM.ressentiRepondant);}} else if(this.estEnRessenti()&&this.executionQCM.modeDiffusionCorrige===TypeModeCorrectionQCM.FBQ_CorrigeApresQuestion){this.indiceQuestion++;this.actualiser();} else if(this.executionQCM.modeDiffusionCorrige===TypeModeCorrectionQCM.FBQ_CorrigeALaFin&&aParam&&aParam.listeQuestions&&aParam.listeQuestions.GetNbrElements()>0){this.listeQuestions=aParam.listeQuestions;if(aParam.etatCloture!==TypeEtatExecutionQCMPourRepondant.EQR_DureeMaxDepassee){this.composeCorrigeFin();this.indiceQuestion++;this.enActualisation=false;} else{this.composeCloture();this.enActualisation=false;this.indiceQuestion=this.nbQuestions+Number(this.executionQCM.ressentiRepondant);}} else if(this.executionQCM.modeDiffusionCorrige===TypeModeCorrectionQCM.FBQ_CorrigeApresQuestion&&aParam&&aParam.listeQuestions&&aParam.listeQuestions.GetNbrElements()===1){$.extend(true,this.question,aParam.listeQuestions.GetElement(0));this.composeCorrige();this.enActualisation=false;}}
arreterTouteLectureAudio(){const lElementsAudio=$('audio');if(lElementsAudio){lElementsAudio.each((aIndex,aElementAudio) =>{if(aElementAudio&&UtilitaireAudio.estEnCoursDeLecture(aElementAudio)){UtilitaireAudio.stopAudio(aElementAudio);}});}}
surEvenement(aObjet){if(this.enActualisation){return;} else{this.enActualisation=true;}
this.arreterTouteLectureAudio();if(this.estEnCloture()&&!this.estUnCorrigeVisibleApresCloture()){this.fermetureFenetre();return;}
if(this.modeProf){this.surEvenementProf(aObjet);} else{this.surEvenementEleve(aObjet);}}
surEvenementProf(aObjet){if(aObjet.action==='submit'&&this.executionQCM.modeDiffusionCorrige===TypeModeCorrectionQCM.FBQ_CorrigeApresQuestion){if(this.estEnCours()){this.composeCorrige();this.enActualisation=false;} else if(this.estEnRessenti()){this.indiceQuestion++;this.actualiser();return;} else{this.fermetureFenetre();}
$('#'+this.idBoutonSubmit.escapeJQ()+this.indiceQuestion).hide();} else{if(this.modeVisuQuestion){this.fermetureFenetre();return;}
if(aObjet.action==='prev'){this.indiceQuestion--;} else{if(aObjet.action==='submit'){if(this.estEnCours()){this.evaluationNote[this.indiceQuestion].validee=true;this.question.reponsesRepondant=this.recupererReponses();} else if(this.estEnRessenti()){$.noop();} else if(this.estEnFin()){if(this.executionQCM.modeDiffusionCorrige!==TypeModeCorrectionQCM.FBQ_CorrigeALaFin||this.estEnCorrigeFin()){this.fermetureFenetre();} else{this.indiceQuestion++;this.composeCorrigeFin();}
return;}}
if(this.estEnCloture()&&this.executionQCM.estRejouable&&aObjet.action==='restart'){this.etatCloture=null;}
if(this.estEnCloture()){this.indiceQuestion=this.nbQuestions+Number(this.executionQCM.ressentiRepondant)+1;} else{this.indiceQuestion++;}}
this.recupererQuestionProf();}}
surEvenementEleve(aObjet){if(aObjet.action==='submit'&&this.executionQCM.modeDiffusionCorrige===TypeModeCorrectionQCM.FBQ_CorrigeApresQuestion){this.surEvenementValidationEleve();$('#'+this.idBoutonSubmit.escapeJQ()+this.indiceQuestion).hide();} else{if(aObjet.action==='prev'){this.indiceQuestion--;} else{if(aObjet.action==='submit'){if(!this.surEvenementValidationEleve()){return;}}
if(this.estEnCloture()&&this.executionQCM.estRejouable&&aObjet.action==='restart'){this.etatCloture=null;}
if(this.estEnInitialisation()&&this.estUneExecutionDejaCommencee()){this.indiceQuestion=this.executionQCM.indiceProchaineQuestion;} else if(this.estEnCloture()){this.indiceQuestion=this.nbQuestions+Number(this.executionQCM.ressentiRepondant)+1;} else{this.indiceQuestion++;}}
this.recupererQuestionEleve();}}
recupererQuestion(){this.arreterTouteLectureAudio();if(this.modeProf){this.recupererQuestionProf();} else{this.recupererQuestionEleve();}}
recupererQuestionProf(){if(this.listeQuestions&&this.listeQuestions.GetNbrElements()>0){if(this.executionQCM.dureeMaxQCM&&this.getMilliSecondesChrono()<=0){this.etatCloture=TypeEtatExecutionQCMPourRepondant.EQR_DureeMaxDepassee;}
this.question=this.listeQuestions.GetElement(this.indiceQuestion);if(this.etatCloture===TypeEtatExecutionQCMPourRepondant.EQR_DureeMaxDepassee){this.composeCloture();this.enActualisation=false;this.indiceQuestion=this.nbQuestions+Number(this.executionQCM.ressentiRepondant);} else{this.actualiser();}} else{const lParam={action:'get',indiceQuestion:this.indiceQuestion,numeroExecution:this.numeroExecution,element:this.executionQCM,pourInitialisation:this.indiceQuestion===0&&!this.estEnCloture()};this.Evenement.call(this.Pere,lParam);}}
recupererQuestionEleve(){const lParam={action:'get',indiceQuestion:this.indiceQuestion,numeroExecution:this.numeroExecution,element:this.executionQCM,pourInitialisation:this.indiceQuestion===0&&!this.estEnCloture()};this.Evenement.call(this.Pere,lParam);}
surEvenementValidationEleve(){let lParam;if(this.estEnCours()){this.evaluationNote[this.indiceQuestion].validee=true;lParam={action:'set',element:this.executionQCM,indiceQuestion:this.indiceQuestion,reponse:this.recupererReponses()};this.Evenement.call(this.Pere,lParam);} else if(this.estEnRessenti()){lParam={action:'set',element:this.executionQCM,ressenti:this.ressenti};this.Evenement.call(this.Pere,lParam);} else if(this.estEnFin()){if(this.executionQCM.modeDiffusionCorrige!==TypeModeCorrectionQCM.FBQ_CorrigeALaFin||this.estEnCorrigeFin()){this.fermetureFenetre(this.executionQCM.modeDiffusionCorrige!==TypeModeCorrectionQCM.FBQ_CorrigeALaFin);} else{lParam={action:'set',element:this.executionQCM,pourCloture:true};this.Evenement.call(this.Pere,lParam);}
return false;}
return true;}
fermetureFenetre(aPourCloture){const lParam={action:'close'};if(aPourCloture===true){lParam.element=this.executionQCM;lParam.pourCloture=true;}
this.Evenement.call(this.Pere,lParam);}
estEnInitialisation(){return this.indiceQuestion=== -1;}
estEnRessenti(){return this.indiceQuestion===this.nbQuestions&&this.executionQCM.ressentiRepondant;}
estEnFin(){return this.indiceQuestion>=this.nbQuestions&&!this.estEnRessenti();}
estEnCorrigeFin(){return(this.executionQCM.modeDiffusionCorrige===TypeModeCorrectionQCM.FBQ_CorrigeALaFin||(this.estEnCloture()&&this.estUnCorrigeVisibleApresCloture()))&&this.indiceQuestion===this.nbQuestions+Number(this.executionQCM.ressentiRepondant)+1;}
estEnCours(){return this.indiceQuestion> -1&&this.indiceQuestion<this.nbQuestions;}
estEnCloture(){return this.etatCloture!==undefined&&this.etatCloture!==null&&$.inArray(this.etatCloture,[TypeEtatExecutionQCMPourRepondant.EQR_EnCours,TypeEtatExecutionQCMPourRepondant.EQR_ARefaire])=== -1;}
estUneExecutionDejaCommencee(){return this.executionQCM.indiceProchaineQuestion>=0&&this.executionQCM.indiceProchaineQuestion<this.nbQuestions;}
estUnCorrigeVisibleApresCloture(){return this.executionQCM.publierCorrige||this.executionQCM.modeDiffusionCorrige===TypeModeCorrectionQCM.FBQ_CorrigeALaFin||this.executionQCM.modeDiffusionCorrige===TypeModeCorrectionQCM.FBQ_CorrigeApresQuestion;}}
function estQuestionMatchingASymetrique(aQuestion){let lEstAsymetrique=false;if(!!aQuestion&&aQuestion.GetGenre()===TypeGenreExerciceDeQuestionnaire.GEQ_Matching&&!!aQuestion.listeReponses){const lHashesReponses=[];aQuestion.listeReponses.parcourir(function(aReponse){if(!!aReponse.associationB){if($.inArray(aReponse.associationB.hashContenu,lHashesReponses)=== -1){lHashesReponses.push(aReponse.associationB.hashContenu);} else{lEstAsymetrique=true;return false;}}});}
return lEstAsymetrique;}
function _comparerChaines(aValeur1,aValeur2,aCaseSensitive){return ComparateurChaines.egal(aValeur1,aValeur2,{caseSensitive:aCaseSensitive,accentSensitive:aCaseSensitive,avecTrim:true,unifierEspacements:true,unifierCarWord:true});}
module.exports=ObjetVisuEleve;},fn:"objetvisueleveqcm.js"});;
IE.fModule({f:function(exports,require,module,global){const ObjetVisuEleve=require('ObjetVisuEleveQCM.js');const GChaine=require('GChaine.js');const GTraductions=require('ObjetTraduction.js');const TypeEtatExecutionQCMPourRepondant=require('TypeEtatExecutionQCMPourRepondant.js').TypeEtatExecutionQCMPourRepondant;const TypeGenreExerciceDeQuestionnaire=require('TypeGenreExerciceDeQuestionnaire.js').TypeGenreExerciceDeQuestionnaire;const TypeModeCorrectionQCM=require('TypeModeCorrectionQCM.js').TypeModeCorrectionQCM;const TUtilitaireDuree=require('UtilitaireDuree.js');const UtilitaireQCM=require('UtilitaireQCM.js').UtilitaireQCM;const EGenreNiveauDAcquisition=require('Enumere_NiveauDAcquisition.js');class ObjetVisuEleve_Mobile extends ObjetVisuEleve{constructor(...aParams){super(...aParams);this.nbImages=0;this.nbImagesChargees=0;this.ressentiSelectionne=false;this.avecIECheckbox=false;this.idWrapperTitre=this.Nom+'_WrapperTitre_';this.idWrapperQuestion=this.Nom+'_WrapperQuestion_';this.idWrapperNavigation=this.Nom+'_WrapperNavigation_';this.idWrapperReponses=this.Nom+'_WrapperReponses_';this.idWrapperEnonce=this.Nom+'_WrapperEnonce_';this.idWrapperCorrigeQuest=this.Nom+'_WrapperCorrigeQuest_';this.idWrapperCorrige=this.Nom+'_WrapperCorrige';this.idWrapperBarreProgression=this.Nom+'_WrapperBarreProg';this.idProgression=this.Nom+'_idProgression_';this.idIndicateurProg=this.Nom+'_IndicateurProgression';this.couleurThemeQCMFonce='#428ca5';}
triggerFinActualisation(){if(this.estEnCours()){this.Evenement.call(this.Pere,{action:'afficherNavigation'});} else{this.Evenement.call(this.Pere,{action:'masquerNavigation'});}
$("#div").scrollTop(0);}
composeOuvertureDivGlobal(){return'<div class="global-conteneur">';}
composeFermetureDivGlobal(){return'</div>';}
composeTitre(){const lHtmlTitle=[];if(this.executionQCM.GetLibelle()){lHtmlTitle.push(this.executionQCM.GetLibelle());}
lHtmlTitle.push(this._getTitreExecutionQCM(this.executionQCM));if(this.executionQCM.service&&this.executionQCM.service.GetLibelle()){lHtmlTitle.push(this.executionQCM.service.GetLibelle());}
if(this.executionQCM.matiere&&this.executionQCM.matiere.GetLibelle()){lHtmlTitle.push(this.executionQCM.matiere.GetLibelle());}
const lHtmlTitleProf=this.executionQCM.listeProfesseurs?this.executionQCM.listeProfesseurs.getTableauLibelles().join(', '):'';const lHtmlThemes=this.executionQCM.ListeThemes&&this.executionQCM.ListeThemes.GetNbrElements()?GTraductions.getValeur('Themes')+' : '+this.executionQCM.ListeThemes.getTableauLibelles().join(', '):'';return GChaine.enleverEntites('<span class="Texte12">'+lHtmlTitle.join(' - ')+'</span><br /><span class="Texte12">'+lHtmlTitleProf+'</span>'+(lHtmlThemes?'<div class="ie-titre">'+lHtmlThemes+'</div>':''));}
composeAffichageQuestion(){let lHtml=[];if(!this.affichageEnLigne){lHtml.push('<div id="',this.idWrapperGlobal,'" style="text-align:center;">');}
lHtml.push('<div id="',this.idWrapperAffichage,this.indiceQuestion,'" class="InlineBlock" style="position:relative;width:100%;max-width:50rem;">');lHtml=lHtml.concat(this.composeQuestion());lHtml=lHtml.concat(this.composeNavigation());lHtml.push('</div>');if(!this.affichageEnLigne){lHtml.push('</div>');$('#'+this.idWrapperBarreProgression.escapeJQ()).html(this.composeBarreProgression().join(''));}
return lHtml;}
ajouterEvenementMatching(aIndiceQuestion,aAsymetrie){const lThis=this;$('[id^="'+this.Nom+'_q'+aIndiceQuestion+'"] audio').on('play',this.onStartAudio).on('pause',this.onPauseAudio);$('[id^="'+this.Nom+'_q'+aIndiceQuestion+'"] .ChipsAudio').on('click',this.onClicChipsAudio);$('[id^="'+this.Nom+'_q'+aIndiceQuestion+'_r"]').on('click',function(){if(!lThis.reponseMatchingEnCours){lThis.reponseMatchingEnCours={};}
if($(this).data('estAssocie')!==true){const lThisId=$(this).attr('id');if(!!lThis.reponseMatchingEnCours.idDropDestination){lThis.reponseMatchingEnCours.idElementReponse=lThisId;executeLiaisonReponseMatching(lThis.reponseMatchingEnCours.idElementReponse,lThis.reponseMatchingEnCours.idDropDestination,aAsymetrie);lThis.reponseMatchingEnCours=null;} else{if(lThis.reponseMatchingEnCours.idElementReponse===lThisId){lThis.reponseMatchingEnCours.idElementReponse=null;$(this).removeClass('ReponseMatchingSelected');} else if(!lThis.reponseMatchingEnCours.idElementReponse){lThis.reponseMatchingEnCours.idElementReponse=lThisId;$(this).addClass('ReponseMatchingSelected');}}}});$('[id^="'+this.Nom+'_q'+aIndiceQuestion+'_drop"]').on('click',function(){if(!lThis.reponseMatchingEnCours){lThis.reponseMatchingEnCours={};}
if($(this).data('estAssocie')!==true){const lThisId=$(this).attr('id');if(!!lThis.reponseMatchingEnCours.idElementReponse){lThis.reponseMatchingEnCours.idDropDestination=lThisId;executeLiaisonReponseMatching(lThis.reponseMatchingEnCours.idElementReponse,lThis.reponseMatchingEnCours.idDropDestination,aAsymetrie);lThis.reponseMatchingEnCours=null;} else{if(lThis.reponseMatchingEnCours.idDropDestination===lThisId){lThis.reponseMatchingEnCours.idDropDestination=null;$(this).removeClass('ZoneDropElementBMatchingSelected');} else if(!lThis.reponseMatchingEnCours.idDropDestination){lThis.reponseMatchingEnCours.idDropDestination=lThisId;$(this).addClass('ZoneDropElementBMatchingSelected');}}}});}
ajouterEvenementSingleMultiChoice(){}
composeAffichageRessenti(){let lHtml=[];if(!this.affichageEnLigne){lHtml.push('<div id="',this.idWrapperGlobal,'" style="margin:10px;text-align:center;flex-grow:1">');}
lHtml.push('<div id="',this.idWrapperAffichage,this.indiceQuestion,'" class="InlineBlock" style="position:relative;width:100%;text-align:left;margin:0;">');lHtml=lHtml.concat(this.composeRessenti());lHtml=lHtml.concat(this.composeNavigation());lHtml.push('</div>');if(!this.affichageEnLigne){lHtml.push('</div>');}
return lHtml;}
composeAffichageFin(){const lHtml=[];if(!this.affichageEnLigne){lHtml.push('<div id="',this.idWrapperGlobal,'" style="margin:10px;text-align:center;flex-grow:1">');}
lHtml.push('<div id="',this.idWrapperAffichage,this.indiceQuestion,'" class="InlineBlock" style="position:relative;width:100%;text-align:left;margin:0;">');lHtml.push('<div class="card">');lHtml.push('<div class="card-content">');const lEstUnIDevoir=this._estUnIDevoir(this.executionQCM);let lCleTraductionPhraseFin;if(this.executionQCM.modeDiffusionCorrige===TypeModeCorrectionQCM.FBQ_CorrigeALaFin){lCleTraductionPhraseFin=(lEstUnIDevoir?'ExecutionQCM.phraseFinAvantCorrige':'ExecutionQCM.phraseFinQCMAvantCorrige');} else{lCleTraductionPhraseFin=(lEstUnIDevoir?'ExecutionQCM.phraseFin':'ExecutionQCM.phraseFinQCM');}
lHtml.push('<span class="card-title">',GTraductions.getValeur(lCleTraductionPhraseFin),'</span>');lHtml.push('</div>');lHtml.push('<div id="',this.idWrapperNavigation,this.indiceQuestion,'" class="card-action">');lHtml.push('<ie-bouton id="',this.idBoutonSubmit,this.indiceQuestion,'" class="themeBoutonPrimaire btn waves-effect waves-light" style="',(this.estEnRessenti()?'display:none;':''),'" onclick="'+this.Nom+'.surEvenement({action: \'submit\'});" tabIndex="0">');lHtml.push(this.executionQCM.modeDiffusionCorrige===TypeModeCorrectionQCM.FBQ_CorrigeALaFin?GTraductions.getValeur('ExecutionQCM.presentationCorrige.VisualiserCorrige'):GTraductions.getValeur('ExecutionQCM.Terminer'));lHtml.push('</ie-bouton>');lHtml.push('</div>');lHtml.push('</div>');lHtml.push('</div>');if(!this.affichageEnLigne){lHtml.push('</div>');}
return lHtml;}
composeCloture(){$('#'+this.idContenu).html('');const lHtml=[];lHtml.push('<div id="',this.idWrapperGlobal,'" style="margin:10px;text-align:center;flex-grow:1">');lHtml.push('<div class="InlineBlock" style="position:relative;width:100%;text-align:left;margin:0;">');lHtml.push('<div style="background-color:#fff;color:#000;border:#ccc 1px solid;font-size:20px;padding:10px;margin:0 0 15px;">');const lEstUnIDevoir=this._estUnIDevoir(this.executionQCM);let lCleTraductionPhraseCloture;if(this.etatCloture===TypeEtatExecutionQCMPourRepondant.EQR_DureeMaxDepassee){lCleTraductionPhraseCloture=(lEstUnIDevoir?'ExecutionQCM.PhraseClotureDelaiMax':'ExecutionQCM.PhraseClotureQCMDelaiMax');} else{lCleTraductionPhraseCloture=(lEstUnIDevoir?'ExecutionQCM.PhraseCloture':'ExecutionQCM.PhraseClotureQCM');}
lHtml.push('<h1 style="text-align:center;font-size:25px;">',GTraductions.getValeur(lCleTraductionPhraseCloture),'</h1>');lHtml.push('</div>');lHtml.push('<table id="',this.idWrapperNavigation,this.indiceQuestion,'" style="width:100%;"><tr>');lHtml.push('<td style="width:100%;">');lHtml.push('<ie-bouton id="',this.idBoutonSubmit,this.indiceQuestion,'" class="themeBoutonPrimaire btn waves-effect waves-light" onclick="'+this.Nom+'.surEvenement({action: \'submit\'});" tabIndex="0">'+GTraductions.getValeur('ExecutionQCM.Terminer')+'</ie-bouton>');lHtml.push('</td>');lHtml.push('</tr></table>');lHtml.push('</div>');lHtml.push('</div>');$('#'+this.idContenu).html(lHtml.join(''));this.actualiserHauteurQuestion();this.enActualisation=false;}
composePageNonDemarre(){const lHtml=[];lHtml.push('<div style="text-align:center;background-color:#fff;color:#000;font-size:20px;padding:10px;margin:10px;">');lHtml.push('<div class="InlineBlock" style="text-align:left;">');lHtml.push('<h1 style="text-align:center;font-size:25px;margin:0 auto 50px;">');lHtml.push(GTraductions.getValeur('ExecutionQCM.phraseClotureNonDemarre'));lHtml.push('</h1>');lHtml.push('<div style="text-align:center;">');lHtml.push('<ie-bouton id="',this.idBoutonStart,'" class="themeBoutonPrimaire btn waves-effect waves-light" onclick="'+this.Nom+'.fermetureFenetre();" tabIndex="0">',GTraductions.getValeur('ExecutionQCM.Terminer'),'</ie-bouton>');lHtml.push('</div>');lHtml.push('</div>');lHtml.push('</div>');return lHtml;}
composeAffichageCorrigeFin(){let lHtml=[];lHtml.push('<div id="',this.idWrapperGlobal,'" style="margin:10px;text-align:center;flex-grow:1">');lHtml.push('<div id="',this.idWrapperCorrige,'" style="position:relative;margin:0;">');const lBackupIndice=this.indiceQuestion;if(this.listeQuestions){for(let i=0;i<this.listeQuestions.GetNbrElements();i++){this.indiceQuestion=i;this.question=this.listeQuestions.GetElement(i);lHtml.push('<div id="',this.idWrapperAffichage,this.indiceQuestion,'" style="margin-bottom:15px;">');lHtml=lHtml.concat(this.composeQuestion());lHtml.push('</div>');}}
this.indiceQuestion=lBackupIndice;lHtml.push('<table id="',this.idWrapperNavigation,this.indiceQuestion,'" style="width:100%;"><tr>');lHtml.push('<td style="width:100%;text-align:center;">');lHtml.push('<ie-bouton id="',this.idBoutonSubmit,this.indiceQuestion,'" class="themeBoutonPrimaire btn waves-effect waves-light" onclick="'+this.Nom+'.surEvenement({action: \'submit\'});" tabIndex="0">'+GTraductions.getValeur('ExecutionQCM.Terminer')+'</ie-bouton>');lHtml.push('</td>');lHtml.push('</tr></table>');lHtml.push('</div>');lHtml.push('</div>');return lHtml;}
autoriserFermetureInterface(){this.Evenement.call(this.Pere,{action:'afficherCroix'});}
interdireFermetureInterface(){this.Evenement.call(this.Pere,{action:'masquerCroix'});}
actualiserHauteurCartoucheCompetences(){}
actualiserHauteurCorrige(){}
actualiserHauteurQuestion(){}
actualiserHauteurReponse(){}
composePageModalite(){const lHtml=[];lHtml.push('<div class="card">');lHtml.push('<div class="card-content">');lHtml.push('<div class="card-title">',GTraductions.getValeur('ExecutionQCM.LisezIndications'),'</div>');let lTrad='';let lIcone='';if(this.executionQCM.consigne){lHtml.push('<div class="qcm_container_consigne mobile">',this.executionQCM.consigne,'</div>');}
if(this.executionQCM.estLieADevoir&&this.executionQCM.estLieAEvaluation){lTrad='ExecutionQCM.notation.evaluationEtDevoir';} else if(this.executionQCM.estLieADevoir){lTrad='ExecutionQCM.notation.devoir';} else if(this.executionQCM.estLieAEvaluation){lTrad='ExecutionQCM.notation.evaluation';} else if(this.executionQCM.estUnTAF){lTrad='ExecutionQCM.notation.taf';} else{lTrad='ExecutionQCM.notation.contenuCours';}
if(lTrad!==''){lHtml.push(this.composeLigneInfo({mobile:true,icon:this._getIconeTypeExecutionQCM(this.executionQCM),label:GTraductions.getValeur(lTrad,[this.executionQCM.nombreDePoints])}));}
if(this.executionQCM.dureeMaxQCM){lTrad='ExecutionQCM.presentation.limite_temps';lIcone='icon_edt_permanence';} else{lTrad='ExecutionQCM.presentation.sans_limite_temps';lIcone='icon_edt_permanence qcm_icon_overlay crossed';}
if(lTrad!==''){const lMinutes=TUtilitaireDuree.dureeEnMin(this.executionQCM.dureeMaxQCM);const lMinutesSupplementaire=!this.modeProf&&(this.executionQCM.dureeMaxQCM>0)&&(this.executionQCM.dureeSupplementaire>0)?TUtilitaireDuree.dureeEnMin(this.executionQCM.dureeSupplementaire):0;lHtml.push(this.composeLigneInfo({mobile:true,icon:lIcone,label:GTraductions.getValeur(lTrad,[(lMinutes+lMinutesSupplementaire)+' '+GTraductions.getValeur('ExecutionQCM.Minutes')])}));}
const lAvecNavigationPossible=this.executionQCM.autoriserLaNavigation;if(!lAvecNavigationPossible){lTrad='ExecutionQCM.presentation.sans_retour_precedent';lIcone='icon_arrow_left qcm_icon_overlay crossed';} else{lTrad='ExecutionQCM.presentation.retour_precedent';lIcone='icon_arrow_left';}
if(lTrad!==''){lHtml.push(this.composeLigneInfo({mobile:true,icon:lIcone,label:GTraductions.getValeur(lTrad)}));if(lAvecNavigationPossible){lHtml.push(this.composeLigneInfo({mobile:true,icon:'',label:GTraductions.getValeur('ExecutionQCM.presentation.RS_IlFautCliquerSurValider'),classContainer:'qcm_information_supplementaire'}));}}
if(this.executionQCM.modeDiffusionCorrige===TypeModeCorrectionQCM.FBQ_CorrigeSans){lTrad='ExecutionQCM.corrige.aucun';lIcone='icon_ul qcm_icon_overlay crossed';} else if(this.executionQCM.modeDiffusionCorrige===TypeModeCorrectionQCM.FBQ_CorrigeApresQuestion){lTrad='ExecutionQCM.corrige.chaque_question';lIcone='icon_ul';} else if(this.executionQCM.modeDiffusionCorrige===TypeModeCorrectionQCM.FBQ_CorrigeALaFin){lTrad='ExecutionQCM.corrige.fin_qcm';lIcone='icon_ul';}
if(lTrad!==''){lHtml.push(this.composeLigneInfo({mobile:true,icon:lIcone,label:GTraductions.getValeur(lTrad)}));}
lHtml.push('<div class="card-action">');lHtml.push('<ie-bouton id="',this.idBoutonStart,'" class="themeBoutonPrimaire btn waves-effect waves-light" onclick="'+this.Nom+'.surEvenement({action: \'start\'});" tabIndex="0">',GTraductions.getValeur('ExecutionQCM.CommencerQCM'),'</ie-bouton>');lHtml.push('</div>');lHtml.push('</div>');lHtml.push('</div>');return lHtml;}
composePagePresCorrige(){const lHtml=[];lHtml.push('<div class="card">');lHtml.push('<div class="card-content">');lHtml.push('<div class="card-title">');if(this._estUnIDevoir(this.executionQCM)){lHtml.push(GTraductions.getValeur('ExecutionQCM.presentationCorrige.CorrigeIdevoirExecute'));} else{lHtml.push(GTraductions.getValeur('ExecutionQCM.presentationCorrige.CorrigeQCMExecute'));}
lHtml.push('</div>');let lTrad='';let lNbQuestionsTotal=this.nbQuestions||(!!this.executionQCM.QCM?this.executionQCM.QCM.nbQuestionsTotal:0);if(!lNbQuestionsTotal){lNbQuestionsTotal=this.executionQCM.nbQuestRepondues;}
const lNbReponsesDonnees=GTraductions.getValeur('ExecutionQCM.presentationCorrige.reponsesDonnees',[this.executionQCM.nbQuestRepondues,lNbQuestionsTotal,this.executionQCM.nbQuestBonnes]);const lNoteObtenue=[];if(this.executionQCM.estLieADevoir||(this.executionQCM.estUnTAF&&!!this.executionQCM.afficherResultatNote)){lNoteObtenue.push('<div>',GTraductions.getValeur('ExecutionQCM.presentationCorrige.noteObtenue',[this.executionQCM.noteQCM?this.executionQCM.noteQCM.toString():'',this.executionQCM.nombreDePoints]),'</div>');}
const lCartoucheCompetences=[];if(this.executionQCM.estLieAEvaluation||(this.executionQCM.estUnTAF&&!!this.executionQCM.afficherResultatNiveauMaitrise)){if(!!this.executionQCM.listeCompetences&&this.executionQCM.listeCompetences.GetNbrElements()>0){lCartoucheCompetences.push('<div style="display: inline-block;border: solid 1px #AAA;">');this.executionQCM.listeCompetences.parcourir(function(D){let lPastilleNiveauAcqui;if(!!D.niveauAcqui){const lNiveauGlobal=!!GParametres.listeNiveauxDAcquisitions?GParametres.listeNiveauxDAcquisitions.GetElementParGenre(D.niveauAcqui.GetGenre()):null;if(!!lNiveauGlobal){lPastilleNiveauAcqui=EGenreNiveauDAcquisition.getImage(lNiveauGlobal);}}
lCartoucheCompetences.push('<div style="padding: 0.2em 0;">','<span class="InlineBlock AlignementHaut AlignementMilieu" style="width: 50px;">',(lPastilleNiveauAcqui||''),'</span>','<span class="InlineBlock AlignementHaut" style="width: calc(100% - 150px);">',D.GetLibelle(),'</span>','<span class="InlineBlock AlignementHaut" style="width: 100px;">',(D.strPrefixes||''),'</span>','</div>');});lCartoucheCompetences.push('</div>');}}
lHtml.push(this.composeLigneInfo({mobile:true,icon:this._getIconeTypeExecutionQCM(this.executionQCM),classIcon:'alignementTop',label:lNoteObtenue.join('')+lCartoucheCompetences.join('')+'<div>'+lNbReponsesDonnees+'</div>'}));let lIcone='';if(this.executionQCM.dureeMaxQCM){lTrad='ExecutionQCM.presentationCorrige.limite_temps';lIcone='icon_edt_permanence';} else{lTrad='ExecutionQCM.presentationCorrige.sans_limite_temps';lIcone='icon_edt_permanence qcm_icon_overlay crossed';}
if(lTrad!==''){const lMinutes=TUtilitaireDuree.dureeEnMin(this.executionQCM.dureeMaxQCM);const lMinutesSupplementaire=!this.modeProf&&(this.executionQCM.dureeMaxQCM>0)&&(this.executionQCM.dureeSupplementaire>0)?TUtilitaireDuree.dureeEnMin(this.executionQCM.dureeSupplementaire):0;lHtml.push(this.composeLigneInfo({mobile:true,icon:lIcone,label:GTraductions.getValeur(lTrad,[(lMinutes+lMinutesSupplementaire)+' '+GTraductions.getValeur('ExecutionQCM.Minutes')])}));}
lHtml.push('<div class="card-action">');if(!this.executionQCM.estRejouable||!GEtatUtilisateur.estEspaceEleve()){lHtml.push('<ie-bouton id="',this.idBoutonStart,'" class="btn waves-effect waves-light" onclick="'+this.Nom+'.surEvenement({action: \'start\'});" tabIndex="0">',GTraductions.getValeur('ExecutionQCM.presentationCorrige.VisualiserCorrige'),'</ie-bouton>');} else{lHtml.push('<ie-bouton id="',this.idBoutonStart,'" class="btn waves-effect waves-light" onclick="'+this.Nom+'.surEvenement({action: \'start\'});" tabIndex="0">',GTraductions.getValeur('ExecutionQCM.presentationCorrige.VisualiserCorrige'),'</ie-bouton>');lHtml.push('<ie-bouton id="',this.idBoutonNext,'" class="btn waves-effect waves-light" onclick="'+this.Nom+'.surEvenement({action: \'restart\'});" tabIndex="0">',GTraductions.getValeur('ExecutionQCM.presentationCorrige.RecommencerQCM'),'</ie-bouton>');}
lHtml.push('</div>');lHtml.push('</div>');lHtml.push('</div>');return lHtml;}
composeChrono(){const lHtml=[];lHtml.push('<div id="',this.idValeurChrono,'"></div>');return lHtml;}
composeMajChrono(aTextTime,aLibelleTime){$('#'+this.idValeurChrono.escapeJQ()).html(aTextTime+'&nbsp;'+aLibelleTime);}
composeAffichageBarreProgression(){const lHtml=[];lHtml.push('<div class="subheader">',GTraductions.getValeur('ExecutionQCM.Navigation'),'</div>');lHtml.push('<ul class="collection" style="overflow:auto">');for(let i=0;i<this.nbQuestions;i++){const lBackColor=this.getCouleurPointProgression(i);lHtml.push('<li id="'+this.idProgression+i+'" class="collection-item">',(this.executionQCM.autoriserLaNavigation?'<a>':''),'<span style="background-color:'+lBackColor+';width:10px;height:10px;margin-right:15px;" class="InlineBlock AlignementMilieuVertical">&nbsp;</span>',GTraductions.getValeur('ExecutionQCM.QuestionXSurY',[UtilitaireQCM.composeNumerotation(this.typeNumerotation,i+1),UtilitaireQCM.composeNumerotation(this.typeNumerotation,this.nbQuestions)]),(this.executionQCM.autoriserLaNavigation?'</a>':''),'</li>');}
lHtml.push('</ul>');return lHtml;}
composeMiseEnFormeBarreProgression(){}
ajouterEvenementBarreProgression(){$('#'+this.idWrapperBarreProgression.escapeJQ()+' li[id^="'+this.idProgression+'"]').addClass('AvecMain');$('#'+this.idWrapperBarreProgression.escapeJQ()).off('click');$('#'+this.idWrapperBarreProgression.escapeJQ()).on('click','li[id^="'+this.idProgression+'"]',{aObjet:this},function(event){const lIndice=this.id.match(/_([0-9]+)$/i)[1];const lThis=event.data.aObjet;lThis.indiceQuestion=parseInt(lIndice);lThis.recupererQuestion();if(!!lThis.Evenement){const lParam={action:'fermerNavigation'};lThis.Evenement.call(lThis.Pere,lParam);}});}
composeQuestion(){this.evaluationNote[this.indiceQuestion]={validee:false};const lAvecAffichageNbPoints=(this.executionQCM.estLieADevoir||(this.executionQCM.estUnTAF&&this.executionQCM.afficherResultatNote));const lHtml=[];lHtml.push('<div class="card">');lHtml.push('<div class="card-content">');lHtml.push('<div id="',this.idWrapperTitre,this.indiceQuestion,'" class="card-title">','<table cellpadding="0" cellspacing="0" style="border:0;width:100%"><tr>','<td style="vertical-align: top; white-space: nowrap;font-size:15px;font-style:normal;">','<span id="',this.idNbPoint,this.indiceQuestion,'" style="display:none;"></span>',(!lAvecAffichageNbPoints?'':('<span id="'+this.idSlashNbPoint+this.indiceQuestion+'" style="display:none;">/</span><span style="">'+this.question.note+' '+(parseInt(this.question.note)===1?GTraductions.getValeur('ExecutionQCM.Point'):GTraductions.getValeur('ExecutionQCM.Points'))+'</span>')),'</td>','<td style="vertical-align: top;width:100%;text-align:right;">',(this.executionQCM.dureeMaxQCM?this.composeChrono().join(''):''),'</td>','</tr><tr>','<td style="vertical-align: top; white-space: nowrap;text-align:left;">',GTraductions.getValeur('QCM.QuestionLibelle'),' ',UtilitaireQCM.composeNumerotation(this.typeNumerotation,this.indiceQuestion+1),'&nbsp;:&nbsp;</td>','<td style="vertical-align: top;width:100%;text-align:left;">',this.question.GetLibelle(),'</td>','</tr></table>','</div>');lHtml.push('<div id="',this.idWrapperQuestion,this.indiceQuestion,'" style="padding:0.5rem;'+(this.affichageUnePage?'':'overflow:auto;')+'">');const lEnonce=this.composeEnonce(this,this.question);const lAvecImageQuestion=(!!this.question.image);const lAvecMp3Question=(this.question.mp3name&&this.question.mp3name!==''&&this.question.mp3&&this.question.mp3!=='');const lAvecUrlQuestion=(this.question.url&&this.question.url!=='');if(!!lEnonce||lAvecImageQuestion||lAvecMp3Question||lAvecUrlQuestion){lHtml.push('<div id="',this.idWrapperEnonce,this.indiceQuestion,'" class="GrandEspaceBas" style="overflow:auto;line-height:110%;">');lHtml.push(lEnonce);if(lAvecImageQuestion){lHtml.push('<div class="GrandEspaceHaut GrandEspaceBas"><img alt="" style="width:100%;" src="data:image/png;base64,',this.question.image,'" onerror="$(this).parent().html(GTraductions.getValeur(\'ExecutionQCM.ImageNonSupportee\'));" /></div>');}
if(lAvecMp3Question){lHtml.push('<audio onclick="event.stopImmediatePropagation()" id="',this.idMp3Question,this.indiceQuestion,'" style="padding:3px;" src="data:audio/mp3;base64,',this.question.mp3,'">'+GTraductions.getValeur('ExecutionQCM.AudioNonSupporte')+'</audio>');lHtml.push('<div id="',this.idMp3Control,this.indiceQuestion,'"  style="" class="InlineBlock"><span class="InlineBlock Image_QCM_Son_Play"></span> ',this.question.mp3name,'</div>');}
if(lAvecUrlQuestion){lHtml.push('<div><div class="Image_QCM_Site InlineBlock AlignementMilieuVertical" style="width:18px;height:18px;"></div><a class="AlignementMilieuVertical" href="'+this.question.url+'" target="_blank">'+this.question.url+'</a></div>');}
lHtml.push('</div>');}
lHtml.push('<div id="',this.idWrapperReponses,this.indiceQuestion,'">');lHtml.push(this.composeReponses(this,this.question));lHtml.push('</div>');if(this.question.GetGenre()===TypeGenreExerciceDeQuestionnaire.GEQ_SingleChoice||this.question.GetGenre()===TypeGenreExerciceDeQuestionnaire.GEQ_MultiChoice||this.question.GetGenre()===TypeGenreExerciceDeQuestionnaire.GEQ_ShortAnswer||this.question.GetGenre()===TypeGenreExerciceDeQuestionnaire.GEQ_NumericalAnswer||this.question.GetGenre()===TypeGenreExerciceDeQuestionnaire.GEQ_SpellAnswer){lHtml.push('<div id="',this.idWrapperCorrigeQuest,this.indiceQuestion,'" style="margin-top:10px;">');lHtml.push('<div class="card-title" style="display:none;">'+GTraductions.getValeur('ExecutionQCM.LabelCorrige')+'</div>');lHtml.push('</div>');}
if(this.question.editeur&&this.question.editeur.existeNumero()){lHtml.push('<div class="" style="font-size:70%;text-align:right;color:'+GCouleur.fenetre.texte+';">'+GTraductions.getValeur('ExecutionQCM.CopyRightEditeur2013',[this.question.editeur.GetLibelle()])+'</div>');}
lHtml.push('</div>');lHtml.push('</div>');lHtml.push('</div>');return lHtml;}
composeRessentiEtoile(){const lHtml=[];lHtml.push('<div class="card">');lHtml.push('<div class="card-content">');lHtml.push('<div id="',this.idWrapperTitre,this.indiceQuestion,'" class="card-title">'+GTraductions.getValeur('ExecutionQCM.TitreRessenti')+'</div>');lHtml.push('<div id="',this.idWrapperQuestion,this.indiceQuestion,'" style="overflow:auto;">');lHtml.push('<div id="',this.idWrapperEnonce,this.indiceQuestion,'" class="Texte12" style="overflow:auto;">');lHtml.push('<div style="font-size:50px;text-align:center;height:50px;line-height:50px;padding:10px;">');for(let i=1;i<=5;i++){lHtml.push('<span class="AvecMain InlineBlock Image_QCM_Etoile_Off" id="',this.idRessenti,'_',i,'">&nbsp;</span>');}
lHtml.push('</div>');lHtml.push('<div class="Texte24" style="text-align:center;padding:10px;">');let lLargMax=0;for(let i=1;i<=5;i++){lLargMax=Math.max(lLargMax,GChaine.GetLongueurChaineDansDiv(GTraductions.getValeur('ExecutionQCM.valeurRessenti')[i-1],24));}
lHtml.push(GTraductions.getValeur('ExecutionQCM.phraseRessenti'));lHtml.push('<span id="',this.idTexteRessenti,'" class="InlineBlock AlignementGauche" style="width:',lLargMax,'px;"></span>');lHtml.push('</div>');lHtml.push('</div>');lHtml.push('</div>');lHtml.push('</div>');lHtml.push('</div>');return lHtml;}
composeRessenti(){const lHtml=[];lHtml.push('<div class="card">');lHtml.push('<div class="card-content">');lHtml.push('<div id="',this.idWrapperTitre,this.indiceQuestion,'" class="card-title">'+GTraductions.getValeur('ExecutionQCM.TitreRessenti')+'</div>');lHtml.push('<div id="',this.idWrapperQuestion,this.indiceQuestion,'" style="overflow:auto;">');lHtml.push('<div id="',this.idWrapperEnonce,this.indiceQuestion,'" class="" style="overflow:auto;">');lHtml.push('<div style="font-size:200%;text-align:center;padding:20px 0;">');lHtml.push('<div class="AlignementMilieuVertical" style="height:100%;">',GTraductions.getValeur('ExecutionQCM.phraseRessenti'),'</div>');lHtml.push('<span class="AvecMain InlineBlock AlignementMilieuVertical" id="',this.idRessenti,'_0" style="text-align:center;color:',GCouleur.grisFonce,';margin-right:10px;">',GTraductions.getValeur('ExecutionQCM.valeurRessenti')[3],'</span>');lHtml.push('<span class="AvecMain InlineBlock AlignementMilieuVertical" id="',this.idRessenti,'_1" style="text-align:center;color:',GCouleur.grisFonce,';margin-left:10px;">',GTraductions.getValeur('ExecutionQCM.valeurRessenti')[1],'</span>');lHtml.push('</div>');lHtml.push('</div>');lHtml.push('</div>');lHtml.push('</div>');lHtml.push('</div>');return lHtml;}
composeNavigation(){const lAvecAffichagePrecedent=(this.executionQCM.autoriserLaNavigation&&this.indiceQuestion>0);let lAvecAffichageSuivant=false;if((this.executionQCM.autoriserLaNavigation&&this.estEnCours())||this.executionQCM.modeDiffusionCorrige===TypeModeCorrectionQCM.FBQ_CorrigeApresQuestion){lAvecAffichageSuivant=true;}
const lLargeursBoutonPrecSuivant='12rem';const lPaddingsLaterauxBtnPrecSuivant='padding-left:0rem;padding-right:0rem;';const lHtml=[];lHtml.push('<div><table id="',this.idWrapperNavigation,this.indiceQuestion,'" style="width:100%;height:100%;"><tr>');lHtml.push('<td>');if(lAvecAffichagePrecedent){lHtml.push('<ie-bouton id="',this.idBoutonPrev,this.indiceQuestion,'" class="btn-floating waves-effect waves-light" style="width:',lLargeursBoutonPrecSuivant,';',lPaddingsLaterauxBtnPrecSuivant,'" onclick="'+this.Nom+'.surEvenement({action: \'prev\'});" tabIndex="0">',GTraductions.getValeur('ExecutionQCM.JeReviens'),'</ie-bouton>');} else{lHtml.push('<div style="width:50px;">&nbsp;</div>');}
lHtml.push('</td>');lHtml.push('<td style="width:100%; text-align:center;">');lHtml.push('<ie-bouton id="',this.idBoutonSubmit,this.indiceQuestion,'" class="themeBoutonPrimaire btn waves-effect waves-light" style="',(this.estEnRessenti()?'display:none;':''),'" onclick="'+this.Nom+'.surEvenement({action: \'submit\'});" tabIndex="0">'+(this.estEnCours()?GTraductions.getValeur('ExecutionQCM.Valider'):GTraductions.getValeur('ExecutionQCM.Terminer'))+'</ie-bouton>');lHtml.push('</td>');lHtml.push('<td>');if(lAvecAffichageSuivant){const lMasquerSuivant=(!this.executionQCM.autoriserLaNavigation&&this.executionQCM.modeDiffusionCorrige===TypeModeCorrectionQCM.FBQ_CorrigeApresQuestion)||(this.executionQCM&&this.indiceQuestion>=this.nbQuestions);lHtml.push('<ie-bouton id="',this.idBoutonNext,this.indiceQuestion,'" class="btn-floating waves-effect waves-light" style="width:',lLargeursBoutonPrecSuivant,';',lPaddingsLaterauxBtnPrecSuivant,'',(lMasquerSuivant?'display:none;':''),'" onclick="'+this.Nom+'.surEvenement({action: \'next\'});" tabIndex="0">',GTraductions.getValeur('ExecutionQCM.JePasse'),'</ie-bouton>');} else{lHtml.push('<div style="width:50px;">&nbsp;</div>');}
lHtml.push('</td>');lHtml.push('</tr></table></div>');return lHtml;}
composeAffichageCorrigeSingleMultiVraiCoche(aSelecteur,aSansCorrige){$('#'+$(aSelecteur).attr('id').replace('_r','_div_r').escapeJQ()).addClass('Image_QCM_CocheVerte').css({backgroundPosition:'right top',width:'100%',height:'auto'});if(!aSansCorrige){const lMatch=$(aSelecteur).attr('id').match(/_q([0-9]+)_r([0-9]+)$/i);const lNumQuest=lMatch[1];const lNumRep=lMatch[2];$('#'+(this.idWrapperCorrigeQuest+lNumQuest).escapeJQ()).children('div:first').show().end().append(this.composeSingleMulti(this,this.question.GetGenre()===TypeGenreExerciceDeQuestionnaire.GEQ_SingleChoice?'radio':'checkbox',this.question.listeReponses.GetElement(lNumRep),lNumRep,true,false,true));const lJqDivs=$('#'+(this.idWrapperCorrigeQuest+lNumQuest).escapeJQ()).children('div:gt(0)');lJqDivs.sort(function(a,b){if(a.id===b.id){return 0;} else if(parseInt(a.id.match(/_r([0-9]+)$/i)[1])<parseInt(b.id.match(/_r([0-9]+)$/i)[1])){return-1;} else{return 1;}});lJqDivs.detach().appendTo($('#'+(this.idWrapperCorrigeQuest+lNumQuest).escapeJQ()));}}
composeAffichageCorrigeSingleMultiFauxNonCoche(){}
composeAffichageCorrigeSingleMultiVraiNonCoche(aSelecteur){const lMatch=$(aSelecteur).attr('id').match(/_q([0-9]+)_r([0-9]+)$/i);const lNumQuest=lMatch[1];const lNumRep=lMatch[2];$('#'+(this.idWrapperCorrigeQuest+lNumQuest).escapeJQ()).children('div:first').show().end().append(this.composeSingleMulti(this,this.question.GetGenre()===TypeGenreExerciceDeQuestionnaire.GEQ_SingleChoice?'radio':'checkbox',this.question.listeReponses.GetElement(lNumRep),lNumRep,true,false,true));const lJqDivs=$('#'+(this.idWrapperCorrigeQuest+lNumQuest).escapeJQ()).children('div:gt(0)');lJqDivs.sort(function(a,b){if(a.id===b.id){return 0;} else if(parseInt(a.id.match(/_r([0-9]+)$/i)[1])<parseInt(b.id.match(/_r([0-9]+)$/i)[1])){return-1;} else{return 1;}});lJqDivs.detach().appendTo($('#'+(this.idWrapperCorrigeQuest+lNumQuest).escapeJQ()));}
composeAffichageCorrigeSingleMultiFauxCoche(aSelecteur){$('#'+$(aSelecteur).attr('id').replace('_r','_div_r').escapeJQ()).addClass('Image_QCM_CocheRouge').css({backgroundPosition:'right top',width:'100%',height:'auto'});}
composeAffichageCorrigeSingleMultiFeedback(aSelecteur,aCouleur,aFeedback){$(aSelecteur).next().after('<span class="GrandEspaceGauche Italique" style="color:'+aCouleur+';">&rarr;&nbsp;'+aFeedback+'</span>');}
desactiveEventSingleMulti(aIndiceQuestion){$('[id^="'+this.Nom+'_q'+aIndiceQuestion+'_r"]').each(function(){$(this).attr('disabled','disabled');});}
composeAffichageCorrigeShortVrai(aSelecteur){$(aSelecteur).addClass('Image_QCM_CocheVerte').css({backgroundPosition:'right center',width:'100%',height:'auto'}).prop('readonly',true);}
composeAffichageCorrigeShortFaux(aSelecteur,aReponse,aIncorrectFeedback=''){$(aSelecteur).addClass('Image_QCM_CocheRouge').css({backgroundPosition:'right center',width:'100%'}).prop('readonly',true);if(aIncorrectFeedback){const lStrIncorrectFeedback=[];lStrIncorrectFeedback.push('<div>',this.construitBlocIncorrectFeedback(aIncorrectFeedback),'</div>');$(aSelecteur).parent().append(lStrIncorrectFeedback.join(''));}
const lMatch=$(aSelecteur).attr('id').match(/_q([0-9]+)_r([0-9]+)$/i);const lNumQuest=lMatch[1];$('#'+(this.idWrapperCorrigeQuest+lNumQuest).escapeJQ()).children('div:first').show().end().append('<div>'+aReponse+'</div>');}
composeAffichageCorrigeShortFeedback(aSelecteur,aCouleur,aFeedback){$(aSelecteur).parent().after('<span class="GrandEspaceGauche Italique Texte12" style="color:'+aCouleur+';">'+aFeedback+'</span>');}
desactiveEventShort(aIndiceQuestion){const lJqInput=$('#'+this.Nom.escapeJQ()+'_q'+aIndiceQuestion+'_r0');lJqInput.on('click focus',function(aEvent){$(this).blur();aEvent.preventDefault();aEvent.stopImmediatePropagation();return false;});}
composeAffichageCorrigeSpellVrai(aSelecteur){$(aSelecteur).last().parent().parent().append('&nbsp;<span class="InlineBlock AlignementMilieuVertical Image_QCM_CocheVerte"></span>');}
composeAffichageCorrigeSpellFaux(aSelecteur,aBonneReponse){$(aSelecteur).last().parent().parent().append('&nbsp;<span class="InlineBlock AlignementMilieuVertical Image_QCM_CocheRouge"></span>');const lMatch=$(aSelecteur).attr('name').match(/_q([0-9]+)_r$/i);const lNumQuest=lMatch[1];$('#'+(this.idWrapperCorrigeQuest+lNumQuest).escapeJQ()).children('div:first').show().end().append('<div>'+aBonneReponse+'</div>');}
composeAffichageCorrigeSpellFeedback(aSelecteur,aCouleur,aFeedback){$(aSelecteur).last().parent().parent().append('<span class="GrandEspaceGauche Italique" style="color:'+aCouleur+';">'+aFeedback+'</span>');}
desactiveEventSpell(aIndiceQuestion){$('#'+this.idWrapperReponses.escapeJQ()+aIndiceQuestion).find('input[type="text"]').on('click focus',function(aEvent){$(this).blur();aEvent.preventDefault();aEvent.stopImmediatePropagation();return false;});}
composeMiseEnFormeCorrigeMatching(){}
composeCorrigeReponseCorrigeMatching(aSelecteur,aId,aEstBonneReponse,aCorrige,aCouleur,aIndexReponse){const $reponseDonnee=$('#'+aId.replace('_c','_drop').escapeJQ());if($reponseDonnee.find('[data-contenu]').length>0){$reponseDonnee.find('.BoutonSupprimerReponseAssociee').remove();} else{$reponseDonnee.empty().append('<span>'+GTraductions.getValeur('QCM_Divers.AucuneReponseSelectionnee')+'</span>');}
const lClassResultat=aEstBonneReponse?'Image_QCM_CocheVerte':'Image_QCM_CocheRouge';const $divImageResultat=$('<div />').addClass('InlineBlock').addClass(lClassResultat);$reponseDonnee.append($divImageResultat);if(!aEstBonneReponse){const $bonneReponse=$('<div />').IEHtmlAppend(GTraductions.getValeur('ExecutionQCM.LabelCorrige')+' : '+UtilitaireQCM.getStringAffichageReponseMatching(aCorrige,true,aIndexReponse));$reponseDonnee.append($bonneReponse);$bonneReponse.find('audio').on('play',this.onStartAudio).on('pause',this.onPauseAudio);$bonneReponse.find('.ChipsAudio').on('click',this.onClicChipsAudio);}}
composeMiseEnFormeCorrigeReponseCorrigeMatching(aSelecteur){$(aSelecteur).css('border','solid 2px #666');}
desactiveEventMatching(){$('[id^="'+this.Nom+'_q'+this.indiceQuestion+'_drop"]').off('click');$('[id^="'+this.Nom+'_q'+this.indiceQuestion+'_choix"]').hide();}
composeMiseEnFormeReponseCorrigeCloze(aSelecteur,aCouleur,aTexte){if($(aSelecteur).is('input')){$(aSelecteur).addClass(aCouleur===this.couleurFaux?'Image_QCM_CocheRouge':'Image_QCM_CocheVerte').css({backgroundPosition:'right center',width:'100%',height:'auto'}).prop('readonly',true);} else if($(aSelecteur).is('select')){$(aSelecteur).replaceWith('<input class="'+(aCouleur===this.couleurFaux?'Image_QCM_CocheRouge':'Image_QCM_CocheVerte')+'" style="background-position:right center;width:100%;height:auto;" readonly value="'+aTexte+'" />');}}
composeMiseEnFormeWrapperEnonceCloze(aSelecteur){$(aSelecteur).wrapInner('<div style="padding-bottom:15px;margin-bottom:15px;"></div>');}
composeMiseEnFormeWrapperCorrigeCloze(aSelecteur,aTexte){$(aSelecteur).append('<div><div class="card-title">'+GTraductions.getValeur('ExecutionQCM.LabelCorrige')+'</div><div>'+aTexte+'</div></div>');}
composeMiseEnFormeCorrectionCorrigeCloze(aTexte,aStyle){return'<span style="'+aStyle+'">'+aTexte+'</span>';}
desactiveEventCloze(aIndiceQuestion){$('#'+this.idWrapperEnonce.escapeJQ()+aIndiceQuestion).find('select, input[type="text"]').on('click focus',function(aEvent){$(this).blur();aEvent.preventDefault();aEvent.stopImmediatePropagation();return false;});}
composeMajReponsesSingleMulti(aSelecteur,aSelected){$(aSelecteur).attr('checked',aSelected);}
composeMajReponsesShort(aSelecteur,aTexte){$(aSelecteur).val(GChaine.enleverEntites(aTexte));}
composeMajReponsesSpell(aSelecteur,aTexte){$(aSelecteur).each(function(lIndex){$(this).val(GChaine.enleverEntites(aTexte[lIndex]||''));});}
composeMajReponsesMatching(aSelDrop,aBaseSelDrag,aReponse,aUsedIndex,aAsymetrie){let lIdReponseDrag='';const lIdDropElement=$(aSelDrop).attr('id');const lSelDrag=$('[id^="'+aBaseSelDrag.escapeJQ()+'"]').filter(function(index,ele){return $(ele).find('[data-contenu]').data('contenu').toString()===aReponse;}).first();lIdReponseDrag=lSelDrag.attr('id');executeLiaisonReponseMatching(lIdReponseDrag,lIdDropElement,aAsymetrie);return lIdReponseDrag;}
composeMajReponsesCloze(aSelecteur,aReponse){$(aSelecteur).val(aReponse);}
getReponseMatching(aSelecteur){let lReponseMatching='';const $dropElement=$(aSelecteur);if($dropElement.data('estAssocie')){const $elementDropped=$dropElement.find('[data-contenu]');lReponseMatching=$elementDropped.data('contenu').toString();}
return lReponseMatching;}
composeEnonce(aThis,aQuestion){let lEnonceHtml=aQuestion.enonce;let lIndice=0;let lResponse;if(aQuestion.GetGenre()===TypeGenreExerciceDeQuestionnaire.GEQ_ClozeField||aQuestion.GetGenre()===TypeGenreExerciceDeQuestionnaire.GEQ_ClozeFixed||aQuestion.GetGenre()===TypeGenreExerciceDeQuestionnaire.GEQ_ClozeVariable){lEnonceHtml=lEnonceHtml.replace(/&#039;/gi,'&apos;');if(aQuestion.GetGenre()===TypeGenreExerciceDeQuestionnaire.GEQ_ClozeField&&aQuestion.enonce.match(/{#}/gi)){lEnonceHtml=lEnonceHtml.replace(/{#}/gi,'<input type="text" autocomplete="off" id="'+aThis.Nom+'_q'+aThis.indiceQuestion+'_r'+(lIndice++)+'" />');} else if(aQuestion.listeReponses&&aQuestion.listeReponses.GetNbrElements()&&aQuestion.listeReponses.GetNbrElements()===aQuestion.enonce.match(/{#}/gi).length){for(let i=0;i<aQuestion.listeReponses.GetNbrElements();i++){lEnonceHtml=lEnonceHtml.replace('{#}','<select id="'+aThis.Nom+'_q'+aThis.indiceQuestion+'_r'+i+'"><option value=""></option>'+$.map(aQuestion.listeReponses.GetElement(i).listeChoix,function(val){return'<option value="'+val+'">'+val+'</option>';}).join('')+'</select>');}} else{const lThis=this;lEnonceHtml=lEnonceHtml.replace(/{[0-9]*:(ShortAnswer|MultiChoice):(~*(%[0-9]{1,3}%|=)?[^~%#{}]+#?[^~%#{}]*)+}/gi,function(ele){let lHtml='';const lSpans=[];if(ele.search(/:multichoice:/gi)> -1){lHtml='<span style="border:'+GCouleur.noir+' 1px solid;">';const lResponses=ele.match(/((multichoice:|shortanswer:|~)(%[0-9]{1,3}%|=)?[^~%#{}]+#?[^~%#{}]*)/gi);for(const x in lResponses){if(!$.isNumeric(x)){continue;}
lResponses[x]=lResponses[x].replace(/^(multichoice:|shortanswer:)/i,'');lResponses[x]=lResponses[x].replace(/^(:|~)?=/,'%100%');lResponses[x]=lResponses[x].replace(/^(:|~)?([^~%#{}])/,'%0%$2');lResponse=lResponses[x].split('%');lResponse.splice(2,1,lResponse[2].split('#')[0],lResponse[2].split('#')[1]);lSpans.push('<span style="color:'+(lResponse[1]==='100'?lThis.couleurBonneReponse:lThis.couleurFausseReponse)+';">'+lResponse[2]+'</span>');}
lHtml+=lSpans.join(' | ');lHtml+='</span>';} else{lResponse=ele.match(/(?:multichoice:|shortanswer:|~)(?:%100%|=)([^~%#{}]+)#?[^~%#{}]*/i);lHtml='<span style="color:'+lThis.couleurBonneReponse+';border:'+lThis.couleurBonneReponse+' 1px solid;">'+lResponse[1]+'</span>';}
return lHtml;});}}
return lEnonceHtml;}
composeReponses(aThis,aQuestion,aAvecReponse,aAvecFeedback){const lHtml=[];let lReponse;if(aQuestion.GetGenre()===TypeGenreExerciceDeQuestionnaire.GEQ_SingleChoice||aQuestion.GetGenre()===TypeGenreExerciceDeQuestionnaire.GEQ_MultiChoice){let lType='checkbox';if(aQuestion.GetGenre()===TypeGenreExerciceDeQuestionnaire.GEQ_SingleChoice){lType='radio';}
for(let i=0;i<aQuestion.listeReponses.GetNbrElements();i++){lReponse=aQuestion.listeReponses.GetElement(i);if(!lReponse.Existe()){continue;}
lHtml.push(this.composeSingleMulti(aThis,lType,lReponse,i,aAvecReponse,aAvecFeedback,false));}} else if(aQuestion.GetGenre()===TypeGenreExerciceDeQuestionnaire.GEQ_ShortAnswer||aQuestion.GetGenre()===TypeGenreExerciceDeQuestionnaire.GEQ_NumericalAnswer){if(aAvecReponse&&aQuestion.listeReponses.GetNbrElements()){lHtml.push('<ul>');for(let i=0;i<aQuestion.listeReponses.GetNbrElements();i++){lReponse=aQuestion.listeReponses.GetElement(i);if(!lReponse.Existe()){continue;}
lHtml.push('<li>');lHtml.push(lReponse.GetLibelle());if(aAvecFeedback&&lReponse.feedback!==''){lHtml.push('<span style="color:'+(lReponse.bonneReponse?this.couleurBonneReponse:this.couleurFausseReponse)+';" class="EspaceGauche">&#x27AA;&nbsp;'+lReponse.feedback+'</span>');}
lHtml.push('</li>');}
lHtml.push('</ul>');} else{lHtml.push('<input type="text" autocomplete="off" id="',aThis.Nom,'_q',aThis.indiceQuestion,'_r0" style="width:50%;" maxlength="35"/>');}} else if(aQuestion.GetGenre()===TypeGenreExerciceDeQuestionnaire.GEQ_Matching&&!aAvecReponse){const lPrefixeIdQuestion=this.Nom+'_q'+this.indiceQuestion;lHtml.push('<div id="',lPrefixeIdQuestion,'_listeAssociations">');this.question.listeReponses.parcourir(function(aReponse,aIndexReponse){const lIdAssoc=lPrefixeIdQuestion+'_assoc'+aIndexReponse;const lIdDrop=lPrefixeIdQuestion+'_drop'+aIndexReponse;const lAssoc=[];lAssoc.push('<div id="',lIdAssoc,'" class="AssociationMatching">');lAssoc.push('<div class="ZoneElementAMatching">');lAssoc.push(UtilitaireQCM.getStringAffichageReponseMatching(aReponse.associationA,true,aIndexReponse));lAssoc.push('</div>');lAssoc.push('<div id="',lIdDrop,'" class="ZoneDropElementBMatching">');lAssoc.push(GTraductions.getValeur('QCM_Divers.CliquerPourSelectionnerReponse'));lAssoc.push('</div>');lAssoc.push('</div>');lHtml.push(lAssoc.join(''));});lHtml.push('</div>');const lChoixDisponibles=[];lChoixDisponibles.push('<div id="',lPrefixeIdQuestion,'_choix" class="ZoneReponsesDisponiblesMatching">');lChoixDisponibles.push('<div class="ZoneReponsesDisponiblesMatchingInner">');const lHashesTraites=[];this.question.listeReponses.parcourir(function(aReponse,aIndexReponse){if($.inArray(aReponse.associationB.hashContenu,lHashesTraites)=== -1){lHashesTraites.push(aReponse.associationB.hashContenu);const lIdChoixDispo=lPrefixeIdQuestion+'_r'+aIndexReponse;lChoixDisponibles.push('<div id="',lIdChoixDispo,'" class="ReponseMatching">');lChoixDisponibles.push('<div class="ReponseMatchingInner">');lChoixDisponibles.push(UtilitaireQCM.getStringAffichageReponseMatching(aReponse.associationB,true,aIndexReponse));lChoixDisponibles.push('</div>');lChoixDisponibles.push('</div>');}});lChoixDisponibles.push('</div>');lChoixDisponibles.push('</div>');lHtml.push(lChoixDisponibles.join(''));} else if(aQuestion.GetGenre()===TypeGenreExerciceDeQuestionnaire.GEQ_SpellAnswer){lReponse=aQuestion.listeReponses.GetElement(0);if(lReponse&&aAvecReponse){lHtml.push($.map(lReponse.GetLibelle().split(''),function(aVal){return'<span class="Texte10 EspaceDroit InlineBlock" style="width:9px;text-align:center;border:0;border-bottom:1px #000 solid;margin-right:5px;padding:0;">'+aVal+'</span>';}).join(''));if(aAvecFeedback&&lReponse.feedback!==''){lHtml.push('<span style="color:'+(this.couleurBonneReponse)+';" class="EspaceGauche">&#x27AA;&nbsp;'+lReponse.feedback+'</span>');}} else if(lReponse){lHtml.push($.map(lReponse.GetLibelle().split(''),function(){return'<input name="'+aThis.Nom+'_q'+aThis.indiceQuestion+'_r" type="text" autocomplete="off" maxLength="1" size="1"'+' style="text-align: center; width:22px;"'+' onkeyup="if($(this).val() !== \'\' && $(this).next(\'input\')) $(this).next(\'input\').focus();"'+' onkeydown="if(event.keyCode === require(\'ToucheClavier.js\').Backspace && $(this).val() === \'\' && $(this).prev(\'input\')) $(this).prev(\'input\').focus().val(\'\');"'+' />';}).join('&nbsp;'));}}
return lHtml.join('');}
composeSingleMulti(aThis,aType,aReponse,aIndiceReponse,aAvecReponse,aAvecFeedback,aPourCorrige){const lEstQuestionAChoixUnique=this.question.GetGenre()===TypeGenreExerciceDeQuestionnaire.GEQ_SingleChoice;const lFnEstUneBonneReponse=function(aReponse){return lEstQuestionAChoixUnique?(aReponse.fractionReponse===100):(aReponse.fractionReponse>0);};const lHtml=[];lHtml.push('<div class="" id="',aThis.Nom,'_q',aThis.indiceQuestion,'_div_r',aIndiceReponse,'">');const lChecked=(aAvecReponse&&lFnEstUneBonneReponse(aReponse)?' checked="checked"':'')+(aPourCorrige?' disabled="disabled"':'');lHtml.push('<div>');const lIdInput=aThis.Nom+'_q'+aThis.indiceQuestion+'_r'+aIndiceReponse;const lNameInput=aThis.Nom+'_q'+aThis.indiceQuestion;lHtml.push('<label>','<input type="',aType,'" autocomplete="off" class="with-gap" ',(!aPourCorrige?'id="'+lIdInput+'" name="'+lNameInput+'"':''),lChecked,' />',(!aReponse.editionAvancee?('<span'+(!aPourCorrige?' for="'+lIdInput+'"':'')+'>'+aReponse.GetLibelle()+'</span>'):'<span>&nbsp;</span>'),'</label>');if(!!aReponse.editionAvancee){lHtml.push('<div>',aReponse.libelleHtml,'</div>');}
if(aAvecFeedback&&aReponse.feedback!==''){lHtml.push(' <span style="color:'+(lFnEstUneBonneReponse(aReponse)?this.couleurBonneReponse:this.couleurFausseReponse)+';" class="EspaceGauche">&#x27AA;&nbsp;'+aReponse.feedback+'</span>');}
if(aReponse.image){lHtml.push('<div style="padding:3px;"><img src="data:image/png;base64,'+aReponse.image+'" style="width:100%;" onerror="$(this).parent().html(GTraductions.getValeur(\'ExecutionQCM.ImageNonSupportee\'));"',(aThis.actualiserHauteurReponse?'onload="'+aThis.Nom+'.actualiserHauteurReponse(\''+aThis.Nom+'_q'+aThis.indiceQuestion+'_div_r'+aIndiceReponse+'\');"':''),' /></div>');}
lHtml.push('</div>');lHtml.push('</div>');return lHtml.join('');}}
function executeLiaisonReponseMatching(aIdElementReponse,aIdDropDestination,aAsymetrie){const $elementReponse=$('#'+aIdElementReponse.escapeJQ());const $elementDrop=$('#'+aIdDropDestination.escapeJQ());const $listeChoixElementReponse=$elementReponse.closest('.ZoneReponsesDisponiblesMatchingInner');const $boutonSupprimerLiaison=$('<div class="BoutonSupprimerReponseAssociee"><i class="icon_trash"></i></div>');$boutonSupprimerLiaison.one('click',function(aEvent){aEvent.stopPropagation();if(!aAsymetrie){const $elementDropped=$elementDrop.find('.ReponseMatching');$elementDropped.appendTo($listeChoixElementReponse);$elementDropped.data('estAssocie',false);}
$elementDrop.empty().append(GTraductions.getValeur('QCM_Divers.CliquerPourSelectionnerReponse'));$elementDrop.data('estAssocie',false);});$elementDrop.empty();if(!aAsymetrie){$elementReponse.appendTo($elementDrop);$elementReponse.data('estAssocie',true);} else{const $cloneElementReponse=$elementReponse.clone(false);$cloneElementReponse.attr('id','').removeClass('ReponseMatchingSelected');$cloneElementReponse.appendTo($elementDrop);}
$elementDrop.append($boutonSupprimerLiaison);$elementDrop.data('estAssocie',true);$elementDrop.removeClass('ZoneDropElementBMatchingSelected');$elementReponse.removeClass('ReponseMatchingSelected');}
module.exports=ObjetVisuEleve_Mobile;},fn:"objetvisueleve_mobile.js"});;
IE.fModule({f:function(exports,require,module,global){const{ObjetRequeteConsultation}=require('ObjetRequeteJSON.js');const Requetes=require('CollectionRequetes.js');const ObjetElement=require('ObjetElement.js');const ObjetListeElements=require('ObjetListeElements.js');class ObjetRequeteQCMQuestions extends ObjetRequeteConsultation{constructor(...aParams){super(...aParams);}
lancerRequete(aParam){this.JSON={};$.extend(this.JSON,aParam);return this.appelAsynchrone();}
actionApresRequete(){const lParam={};if(this.JSONReponse.message){lParam.message=this.JSONReponse.message;} else{lParam.QCM=new ObjetElement().fromJSON(this.JSONReponse.QCM);lParam.QCM.copieJSON(this.JSONReponse.QCM);lParam.QCM.listeQuestions=new ObjetListeElements().fromJSON(this.JSONReponse.QCM.listeQuestions,_ajouterQuestion.bind(this));}
this.callbackReussite.appel(lParam);}}
Requetes.inscrire('ListeQCMQuestions',ObjetRequeteQCMQuestions);function _ajouterQuestion(aJSON,aElement){aElement.copieJSON(aJSON);aElement.nouvellePosition=aElement.position;if(aJSON.listeReponses){aElement.listeReponses=new ObjetListeElements().fromJSON(aJSON.listeReponses,_ajouterReponse.bind(this));}}
function _ajouterReponse(aJSON,aElement){aElement.copieJSON(aJSON);}
module.exports=ObjetRequeteQCMQuestions;},fn:"objetrequeteqcmquestions.js"});;
IE.fModule({f:function(exports,require,module,global){const{ObjetRequeteSaisie}=require('ObjetRequeteJSON.js');const Requetes=require('CollectionRequetes.js');const ObjetListeElements=require('ObjetListeElements.js');class ObjetRequeteSaisieQCMReponses extends ObjetRequeteSaisie{constructor(...aParams){super(...aParams);}
lancerRequete(aParam){this.JSON={executionQCM:aParam.element,indiceQuestion:aParam.indiceQuestion,reponse:aParam.reponse,ressenti:aParam.ressenti,pourInitialisation:aParam.pourInitialisation,pourCloture:aParam.pourCloture};return this.appelAsynchrone();}
actionApresRequete(){const lParam={};if(this.JSONReponse.etatCloture!==undefined){lParam.etatCloture=this.JSONReponse.etatCloture;}
if(this.JSONReponse.listeQuestions){lParam.listeQuestions=new ObjetListeElements().fromJSON(this.JSONReponse.listeQuestions,this._ajouterQuestion.bind(this));}
this.callbackReussite.appel(lParam);}
_ajouterQuestion(aJSON,aElement){aElement.copieJSON(aJSON);if(aJSON.listeReponses){aElement.listeReponses=new ObjetListeElements().fromJSON(aJSON.listeReponses,this._ajouterReponse.bind(this));}}
_ajouterReponse(aJSON,aElement){aElement.copieJSON(aJSON);}}
Requetes.inscrire('SaisieQCMReponses',ObjetRequeteSaisieQCMReponses);module.exports=ObjetRequeteSaisieQCMReponses;},fn:"objetrequetesaisieqcmreponses.js"});;
IE.fModule({f:function(exports,require,module,global){const ObjetVisuEleve_Mobile=require('ObjetVisuEleve_Mobile.js');const ObjetRequeteQCMQuestions=require('ObjetRequeteQCMQuestions.js');const EStructureAffichage=require('Enumere_StructureAffichage.js');const InterfacePage_Mobile=require('InterfacePage_Mobile.js');const TypeEtatExecutionQCMPourRepondant=require('TypeEtatExecutionQCMPourRepondant.js').TypeEtatExecutionQCMPourRepondant;const EGenreEspace=require('Enumere_Espace.js');const EGenreOnglet=require('Enumere_Onglet.js');const ObjetRequeteSaisieQCMReponses=require('ObjetRequeteSaisieQCMReponses.js');const ZoneFenetre=require('IEZoneFenetre.js');const GHtml=require('GHtml.js');class ObjetAffichagePageQCM extends InterfacePage_Mobile{constructor(...aParams){super(...aParams);this.idBandeau=this.Nom+'.bandeau';this.idTitreQCM=this.Nom+'.titreQCM';this.idBoutonsQCM=this.Nom+'.boutonsQCM';this.idBoutonBack=this.Nom+'.boutonBack';this.idBoutonNav=this.Nom+'.boutonNav';this.idSideNav=this.Nom+'_idSideNav';this.idVisuEleve=this.Nom+'.objetVisuEleve';this.objetVisuEleve=new ObjetVisuEleve_Mobile(this.idVisuEleve,null,this,this.evenementQCM);this.objetVisuEleve.setParametres({idContenu:this.idVisuEleve.escapeJQ()});this.objetVisuEleve.idWrapperBarreProgression=this.idSideNav;this.ongletPrec=null;this.couleurThemeQCM='#62acc5';this.couleurThemeQCMFonce='#428ca5';this.avecPageFondBlanc=true;}
ConstruireInstances(){this.GenreStructure=EStructureAffichage.Autre;}
getControleur(aInstance){return $.extend(true,super.getControleur(this),{getNodeAffichage:function(){GHtml.addHtml(ZoneFenetre.getElementZoneFenetre(),['<div id="',aInstance.idSideNav,'" class="sidenav"></div>'].join(''));var lSelec='#'+aInstance.idSideNav.escapeJQ();$(lSelec).sidenav({edge:'right',closeOnClick:false,draggable:true});$(this.node).on('destroyed',function(){$(lSelec).remove();});}});}
ConstruireStructureAffichageAutre(){var lHtml=[];lHtml.push('<div ie-node="getNodeAffichage" class="Fenetre_QCM">');lHtml.push('  <div id="'+this.idBandeau+'" class="header-conteneur">');lHtml.push('     <ul class="icon-contain">');lHtml.push('      <li><a class="iconic icon_retour_mobile" id="'+this.idBoutonBack+'" onclick="',this.Nom,'.fermer();"></a></li>');lHtml.push('      <li><a class="iconic icon_list_alt" id="'+this.idBoutonNav+'" onclick="',this.Nom,'.ouvrirNavigation();"></a></li>');lHtml.push('     </ul>');lHtml.push('     <div class="titres-contain" id="'+this.idTitreQCM+'"></div>');lHtml.push('   </div>');lHtml.push(' <div id="'+this.idVisuEleve+'" class="main-conteneur"></div>');lHtml.push('</div>');return lHtml.join('');}
setDonnees(aObjet,aOngletPrec){$('#'+GInterface.GetInstance(GInterface.identEnteteMobile).GetNom().escapeJQ()).hide();$('#'+GInterface.idZoneSelection.escapeJQ()).hide();this.objetVisuEleve.setParametres({idContenu:this.idVisuEleve.escapeJQ(),modeProf:GApplication.getDemo()||(((GEtatUtilisateur.GenreEspace===EGenreEspace.Mobile_Parent)||(GEtatUtilisateur.GenreEspace===EGenreEspace.Mobile_Accompagnant))&&(aObjet.executionQCM.etatCloture===undefined||aObjet.executionQCM.etatCloture===TypeEtatExecutionQCMPourRepondant.EQR_EnCours))});this.objetVisuEleve.setDonnees(aObjet.executionQCM);$('#'+this.idTitreQCM.escapeJQ()).html(this.objetVisuEleve.composeTitre());this.ongletPrec=aOngletPrec;}
ouvrirNavigation(){$('#'+this.idSideNav.escapeJQ()).sidenav('open');}
fermer(){$('#'+GInterface.GetInstance(GInterface.identEnteteMobile).GetNom().escapeJQ()).show();$('#'+GInterface.idZoneSelection.escapeJQ()).show();GInterface.evenementSurOnglet(this.ongletPrec);}
masquerCroix(){$('#'+this.idBoutonBack.escapeJQ()).hide();}
afficherCroix(){$('#'+this.idBoutonBack.escapeJQ()).show();}
evenementQCM(aParam){if(aParam===undefined){return;}
this.param=aParam;if(this.param.action==='get'){if(GEtatUtilisateur.estEspaceEleve()&&aParam.pourInitialisation){new ObjetRequeteSaisieQCMReponses(this,this.actionSurQCMInitialisation.bind(this,true)).lancerRequete(this.param);} else{this.actionSurQCMInitialisation();}} else if(this.param.action==='set'){new ObjetRequeteSaisieQCMReponses(this,this.actionSurSaisieReponses).lancerRequete(this.param);} else if(this.param.action==='close'){if(this.param.pourCloture&&GEtatUtilisateur.estEspaceEleve()){new ObjetRequeteSaisieQCMReponses(this,this.actionSurSaisieReponses).lancerRequete(this.param);this.callback.appel({genreOnglet:EGenreOnglet.QCM_Reponse,genreOngletPrec:this.ongletPrec});}
this.fermer();} else if(this.param.action==='croixFermeture'){this.fermer();} else if(this.param.action==='masquerCroix'){this.masquerCroix();} else if(this.param.action==='afficherCroix'){this.afficherCroix();} else if(this.param.action==='masquerNavigation'){$('#'+this.idBoutonNav.escapeJQ()).hide();} else if(this.param.action==='afficherNavigation'){$('#'+this.idBoutonNav.escapeJQ()).show();} else if(this.param.action==='fermerNavigation'){$('#'+this.idSideNav.escapeJQ()).sidenav('close');}}
actionSurQCMInitialisation(){new ObjetRequeteQCMQuestions(this,this.actionSurSaisieQCMQuestions).lancerRequete(this.param);}
actionSurSaisieQCMQuestions(aParam){this.objetVisuEleve.setDonnees(aParam);}
actionSurSaisieReponses(aParam){this.objetVisuEleve.setDonneesReponse(aParam);}}
module.exports=ObjetAffichagePageQCM;},fn:"interfacepageqcm.js"});;
IE.fModule({f:function(exports,require,module,global){const ObjetAbstraitInterface=require('ObjetInterface.js');const MoteurInfoSondage=require('MoteurInfoSondage.js').MoteurInfoSondage;const EStructureAffichage=require('Enumere_StructureAffichage.js');const GHtml=require('GHtml.js');const GUID=require('GUID.js');const GTraductions=require('ObjetTraduction.js');const TypeThemeBouton=require('Type_ThemeBouton.js');const EGenreEvntActu=require('EGenreEvntActu.js');const EGenreEtat=require('Enumere_Etat.js');const EGenreBoiteMessage=require('Enumere_BoiteMessage.js');const{GDate}=require('ObjetDate.js');const ObjetMenuCtxMixte=require('ObjetMenuCtxMixte.js');const tag=require('tag.js');class InterfaceConsultInfoSondage extends ObjetAbstraitInterface{constructor(...aParams){super(...aParams);this.idPage=GUID.getId();this.options={avecRappelDescriptif:true,avecCmdMenuCtxMixte:!IE.estMobile,avecVisuResultats:!IE.estMobile,avecScrollZone:!IE.estMobile,avecMsgAucun:true};}
getControleur(aInstance){return $.extend(true,super.getControleur(aInstance),{btnAnnuler:{event:function(){this.declencherCallback({actu:this.donnee,genreEvnt:EGenreEvntActu.SurAnnulationSondage,param:{avecRecupDonnees:false}});}.bind(aInstance),getDisabled:function(){return false;}},btnValider:{event:function(){_declencherClbckValidation.call(this,EGenreEvntActu.SurValidationSondage);}.bind(aInstance),getDisabled:function(){return false;}},surSaisieReponseTextuelle:{getValue:function(aIndice){if(this.options.avecEditionActualite){return null;}
const lQuestion=this.donnee.listeQuestions.GetElement(aIndice);return lQuestion.reponse.valeurReponse;}.bind(aInstance),setValue:function(aIndice,aValue){aInstance.surSaisieReponse(aIndice,aValue);},getDisabled:function(){return aInstance.options.avecEditionActualite||GApplication.getModeExclusif();}},btnVoirResultats:{event:function(){aInstance.declencherCallback({actu:aInstance.donnee,genreEvnt:EGenreEvntActu.SurVoirResultats});}}});}
declencherCallback(aParam){if(this.Pere&&this.Evenement){this.callback.appel(aParam.actu,aParam.genreEvnt,aParam.param);}}
ConstruireInstances(){this.identMenuCtxMixte=this.Add(ObjetMenuCtxMixte,_evntSurMenuCtxMixte.bind(this));}
SetParametresGeneraux(){this.GenreStructure=EStructureAffichage.Autre;}
setOptions(aParam){$.extend(this.options,aParam);}
SetDonnees(aParam,aAvecDateWidget){this.donnee=aParam.actualite;this.options.avecMsgAucun=aParam.avecMsgAucun;if(this.donnee!==null&&this.donnee!==undefined){if(this.options.avecCmdMenuCtxMixte){const lMenu=this.GetInstance(this.identMenuCtxMixte).menuContextuel;lMenu.vider();this.moteur.initCommandesMenuCtxDInfoSond(lMenu,this.donnee,this.options);}
GHtml.setHtml(this.idPage,_construirePage.call(this,aAvecDateWidget),{controleur:this.controleur});if(this.options.avecCmdMenuCtxMixte){this.GetInstance(this.identMenuCtxMixte).Initialiser();}} else{GHtml.setHtml(this.idPage,_construirePageAucun.call(this),{controleur:this.controleur});}}
setUtilitaires(aUtilitaires){this.moteur=new MoteurInfoSondage(aUtilitaires);}
ConstruireStructureAffichageAutre(){const H=[];H.push('<div class="InterfaceConsultInfoSondage" id="',this.idPage,'"></div>');return H.join('');}
surKeyUpReponse(aIndice){if(GNavigateur.IsToucheSelection()){this.surSaisieReponse(aIndice);}}
surSaisieReponse(aIndiceQuestion,aValeurReponse,aValeurCoche){const lActualite=this.donnee;const lQuestion=lActualite.listeQuestions.GetElement(aIndiceQuestion);if(this.moteur.estComposanteQuestTextuelle({composante:lQuestion})){if(aValeurReponse.length<=lQuestion.tailleReponse){lQuestion.reponse.valeurReponse=aValeurReponse;lQuestion.reponse.SetEtat(EGenreEtat.Modification);lQuestion.SetEtat(EGenreEtat.Modification);lActualite.SetEtat(EGenreEtat.FilsModification);} else{GApplication.getMessage().afficher({type:EGenreBoiteMessage.Information,message:GTraductions.getValeur('actualites.TailleMaximale',[lQuestion.tailleReponse])});GHtml.setValue(this.moteur.getIdReponse({instance:this,indice:aIndiceQuestion})+'_0',lQuestion.reponse.valeurReponse);}}
const lEstChoixUnique=this.moteur.estComposanteQuestChoixUnique({composante:lQuestion});const lEstChoixMultiple=this.moteur.estComposanteQuestChoixMultiple({composante:lQuestion});if(lEstChoixUnique||lEstChoixMultiple){for(let I=0;I<lQuestion.listeChoix.GetNbrElements();I++){const lIdReponse=this.moteur.getIdReponse({instance:this,indice:aIndiceQuestion});const lChoixCorrespondant=lQuestion.listeChoix.GetElement(I);if(lChoixCorrespondant&&lChoixCorrespondant.estReponseLibre){const lIdCoche=lIdReponse+'_'+I;if(!$('#'+lIdCoche.escapeJQ()).is(':checked')){const lIdInputReponseLibre=this.moteur.getIdReponseInputTexteLibre(lIdReponse,I);lQuestion.reponse.valeurReponseLibre='';$('#'+lIdInputReponseLibre.escapeJQ()).val(lQuestion.reponse.valeurReponseLibre);$('#'+lIdInputReponseLibre.escapeJQ()).inputDisabled(true);}}}
if(lEstChoixUnique){lQuestion.reponse.valeurReponse.Vider();}
lQuestion.reponse.SetEtat(EGenreEtat.Modification);lQuestion.reponse.valeurReponse.SetValeur(aValeurCoche,aValeurReponse);const lIndiceReponse=parseInt(aValeurReponse)-1;const lChoixCorrespondant=lQuestion.listeChoix.GetElement(lIndiceReponse);if(lChoixCorrespondant&&lChoixCorrespondant.estReponseLibre){const lIdReponse=this.moteur.getIdReponse({instance:this,indice:aIndiceQuestion});const lIdInputReponseLibre=this.moteur.getIdReponseInputTexteLibre(lIdReponse,lIndiceReponse);$('#'+lIdInputReponseLibre.escapeJQ()).inputDisabled(!aValeurCoche);}
lQuestion.SetEtat(EGenreEtat.Modification);lActualite.SetEtat(EGenreEtat.FilsModification);if(lEstChoixMultiple&&lQuestion.avecMaximum){const lNombreCoche=lQuestion.reponse.valeurReponse.GetNbrValeurs();let lID;if(lNombreCoche<lQuestion.nombreReponsesMax){for(let I=0;I<lQuestion.listeChoix.GetNbrElements();I++){lID=this.moteur.getIdReponse({instance:this,indice:aIndiceQuestion})+'_'+I;$('#'+lID.escapeJQ()).inputDisabled(false);}} else{for(let I=0;I<lQuestion.listeChoix.GetNbrElements();I++){lID=this.moteur.getIdReponse({instance:this,indice:aIndiceQuestion})+'_'+I;const lValue=lQuestion.reponse.valeurReponse.GetValeur(I+1);$('#'+lID.escapeJQ()).inputDisabled(!lValue);}}}}
if(this.moteur.estComposanteAvecAR({composante:lQuestion})){lQuestion.reponse.valeurReponse='';lQuestion.reponse.avecReponse=true;lQuestion.reponse.SetEtat(EGenreEtat.Modification);lQuestion.SetEtat(EGenreEtat.Modification);lActualite.SetEtat(EGenreEtat.Modification);_declencherClbckValidation.call(this,EGenreEvntActu.SurAR);}
lQuestion.reponse.avecReponse=true;}
surSaisieReponseLibre(aIndiceQuestion,aTexteLibreSaisi){const lActualite=this.donnee;const lQuestion=lActualite.listeQuestions.GetElement(aIndiceQuestion);if(lQuestion&&lQuestion.reponse){lQuestion.reponse.valeurReponseLibre=aTexteLibreSaisi;lQuestion.reponse.SetEtat(EGenreEtat.Modification);lQuestion.SetEtat(EGenreEtat.Modification);lActualite.SetEtat(EGenreEtat.Modification);}}}
function _declencherClbckValidation(aGenreEvnt){if(this.donnee.aToutRepondu()){this.donnee.lue=true;}
this.declencherCallback({actu:this.donnee,genreEvnt:aGenreEvnt,param:{avecRecupDonnees:true}});}
function _evntSurMenuCtxMixte(aCmd){this.declencherCallback({actu:this.donnee,genreEvnt:EGenreEvntActu.SurMenuCtxActu,param:{cmd:aCmd}});}
function _construirePage(aAvecDateWidget){const H=[];if(this.options.avecCmdMenuCtxMixte){H.push('<div id="',this.GetInstance(this.identMenuCtxMixte).GetNom(),'" class="info-sondage-menuCtxMixte"></div>');}
if(this.options.avecScrollZone){H.push('<div class="zoneConsult_scroll">');}
if(!aAvecDateWidget){H.push('<div class="zoneDescriptif">',(this.options.avecRappelDescriptif?this.moteur.composeDescriptif({actualite:this.donnee,avecDate:true,avecEditionActualite:this.options.avecEditionActualite,avecTitre:true,avecDetailPublicSuccinct:false}):''),'</div>');}
for(let i=0,lNbr=this.donnee.listeQuestions.GetNbrElements();i<lNbr;i++){const lQuestion=this.donnee.listeQuestions.GetElement(i);H.push('<div class="AvecSelectionTexte info-sondage-content ',(i<lNbr-1?'avecSuivant':''),'">');H.push(this.moteur.composeComposanteInfoSondage({instance:this,actu:this.donnee,composante:lQuestion,indice:i,avecLibelleQuestion:(this.donnee.listeQuestions.GetNbrElements()>1),estAffEditionActualite:this.options.avecEditionActualite}));H.push('</div>');}
if(aAvecDateWidget){H.push('<div class="zoneDate">',GTraductions.getValeur('Le'),' ',GDate.FormatDate(this.donnee.dateDebut,'%JJ/%MM/%AAAA'),'</div>');}
if(this.donnee.estSondage&&!this.options.avecEditionActualite&&!GApplication.getModeExclusif()){H.push('<div class="zoneBtnsAction">');H.push('<ie-bouton ie-model="btnAnnuler" class="'+TypeThemeBouton.secondaire+' item">',GTraductions.getValeur('Annuler'),'</ie-bouton>');H.push('<ie-bouton ie-model="btnValider" class="'+TypeThemeBouton.primaire+' item">',GTraductions.getValeur('Valider'),'</ie-bouton>');H.push('</div>');}
if(this.options.avecScrollZone){H.push('</div>');}
return H.join('');}
function _construirePageAucun(){const H=[];if(this.options.avecMsgAucun){H.push(tag('div',{class:'message-vide'},tag('div',{class:'message'},GTraductions.getValeur('infoSond.msgAucunSelection')),tag('div',{class:'Image_No_Data'})));}
return H.join('');}
module.exports=InterfaceConsultInfoSondage;},fn:"interfaceconsultinfosondage.js"});;
IE.fModule({f:function(exports,require,module,global){const ObjetDonneesListeFlatDesign=require('ObjetDonneesListeFlatDesign.js');const GChaine=require('GChaine.js');const MoteurInfoSondage=require('MoteurInfoSondage.js').MoteurInfoSondage;const{GDate}=require('ObjetDate.js');const GTraductions=require('ObjetTraduction.js');class DonneesListe_InfosSond extends ObjetDonneesListeFlatDesign{constructor(aDonnees,aOptions,aUtilitaires){super(aDonnees);this.utilitaires=aUtilitaires;this.moteurCP=new MoteurInfoSondage(aUtilitaires);this.param=aOptions;}
getIconeGaucheContenuFormate(aParams){return aParams.article.estSondage?'icon_diffuser_sondage':'icon_diffuser_information';}
getTitreZonePrincipale(aParams){return aParams.article.GetLibelle();}
estLigneOff(aParams){const lActu=aParams.article;const lLue=lActu.lue;const lEstModeReception=!this.param.avecEditionActualite;return lEstModeReception&&lLue;}
getInfosSuppZonePrincipale(aParams){const H=[];const lActu=aParams.article;H.push('<div>');const lAvecCategorie=(lActu.categorie!==null&&lActu.categorie!==undefined);if(lAvecCategorie){H.push(lActu.categorie.GetLibelle());}
const lEstModeReception=!this.param.avecEditionActualite;const lEstModeModele=this.param.estCtxModeles;if((lEstModeReception||lEstModeModele)&&!!lActu.auteur){H.push(lAvecCategorie?' - ':'');H.push(lActu.auteur);}
H.push('</div>');if(lEstModeReception&&this.moteurCP.avecInfoPublic(lActu)){H.push('<div>');H.push(lActu.public.GetLibelle());H.push('</div>');}
const lEstModeDiffusion=this.param.avecEditionActualite;if(lEstModeDiffusion){const lDetailPublic=(lActu.detailPublicSuccinct?GChaine.ToHTML(lActu.detailPublicSuccinct):'');H.push('<div style="color:',GCouleur.themeCouleur.foncee,'">',lDetailPublic,'</div>');}
return H.join('');}
getZoneComplementaire(aParams){const lActu=aParams.article;const lEstModeDiffusion=this.param.avecEditionActualite;const H=[];const lListePiecesJointes=this.moteurCP.getListePiecesJointesDActualite(lActu);if(lEstModeDiffusion){H.push('<div class="icones-conteneur tiny">');if(lListePiecesJointes.GetNbrElements()>0){H.push('<i class="icon icon_piece_jointe" ></i>');}
if(lActu.estModele!==true){if(lActu.listeIndividusPartage!==null&&lActu.listeIndividusPartage!==undefined&&lActu.listeIndividusPartage.GetNbrElements()>0){H.push('<i title="',GTraductions.getValeur('infoSond.detailPartageSondN',[lActu.listeIndividusPartage.GetNbrElements()]),'" class="icon icon_eye_open" ></i>');}
H.push(this.moteurCP.composeIconDiffusionPageEtablissement({actualite:lActu}));H.push(this.moteurCP.composeIconPublication({actualite:lActu}));} else{if(lActu.estModelePartage===true){H.push('<i class="icon icon_sondage_bibliotheque" ></i>');}}
H.push('</div>');} else{H.push('<time>',GDate.FormatDate(lActu.dateDebut,'%JJJ %JJ %MMM'),'</time>');if(lListePiecesJointes.GetNbrElements()>0){H.push('<div class="icones-conteneur tiny">');H.push('<i class="icon icon_piece_jointe"></i>');H.push('</div>');}}
return H.join('');}
getZoneMessage(aParams){const lActu=aParams.article;const lEstModeReception=!this.param.avecEditionActualite;const H=[];if(lEstModeReception&&lActu&&lActu.estSondage){H.push(_composeEtatReponseSondage.call(this,lActu));}
return H.join('');}
remplirMenuContextuel(aParams){const lMenu=aParams.menuContextuel;const lArticle=aParams.article;this.moteurCP.initCommandesMenuCtxDInfoSond(lMenu,lArticle,this.param);}}
function _composeEtatReponseSondage(aActu){const H=[];const lARepondu=this.moteurCP.aToutRepondu(aActu);const lNbJoursRestants=GDate.GetDifferenceJours(aActu.dateFin,new Date());if(!lARepondu){const lStrJRestants=lNbJoursRestants>0?GTraductions.getValeur('infoSond.repondre',[lNbJoursRestants+1]):GTraductions.getValeur('infoSond.repondre1');H.push('<a>');H.push(lStrJRestants);H.push('<i class="icon_justifier"></i>');H.push('</a>');} else{const lEstDerniereReponse=this.moteurCP.getDerniereReponse(aActu);if(!!lEstDerniereReponse){if(lEstDerniereReponse.reponse.estRepondant){H.push('<a style="color:',GCouleur.noir,';">',GTraductions.getValeur('actualites.aiReponduLe',GDate.FormatDate(lEstDerniereReponse.reponse.reponduLe,'%JJ/%MM/%AAAA')),(lNbJoursRestants>0?' ('+GTraductions.getValeur('actualites.modifiableXJours',[lNbJoursRestants])+')':''),'</a>');} else if(lEstDerniereReponse.reponse.estRepondant===false){H.push('<a>',GTraductions.getValeur('actualites.reponduParX',[lEstDerniereReponse.reponse.strRepondant,GDate.FormatDate(lEstDerniereReponse.reponse.reponduLe,'%JJ/%MM/%AAAA')]),'</a>');}}}
return H.join('');}
module.exports=DonneesListe_InfosSond;},fn:"donneesliste_infossond.js"});;
IE.fModule({f:function(exports,require,module,global){const ObjetDonneesListeFlatDesign=require('ObjetDonneesListeFlatDesign.js');class DonneesListeTypesAccesInfoSond extends ObjetDonneesListeFlatDesign{constructor(aDonnees){super(aDonnees);}
getIconeGaucheContenuFormate(aParams){return aParams.article.icone;}
getTitreZonePrincipale(aParams){return aParams.article.GetLibelle();}
getZoneComplementaire(aParams){var lCmp=aParams.article.compteur;return(lCmp!==null)&&(lCmp!==undefined)&&(lCmp>0)?'<div class="compteur Gras">'+lCmp+'</div>':'';}
avecSeparateurLigneHaut_flatdesign(aParamsCellule,aParamsCellulePrec){return super.avecSeparateurLigneHaut_flatdesign(aParamsCellule,aParamsCellulePrec)&&aParamsCellule.article&&aParamsCellule.article.estAvecSeparateurHaut;}}
module.exports=DonneesListeTypesAccesInfoSond;},fn:"donneeslistetypesaccesinfosond.js"});;
IE.fModule({f:function(exports,require,module,global){if(IE.estMobile){module.exports=require('InterfacePage_Mobile.js');} else{module.exports=require('_InterfacePage.js');}},fn:"objetinterfacepagecp.js"});;
IE.fModule({f:function(exports,require,module,global){const EGenreEvntActu=require('EGenreEvntActu.js');const InterfaceConsultInfoSondage=require('InterfaceConsultInfoSondage.js');const GTraductions=require('ObjetTraduction.js');const TypeThemeBouton=require('Type_ThemeBouton.js');const EGenreEvenementObjetSaisie=require('Enumere_EvenementObjetSaisie.js');const ObjetListe=require('ObjetListe.js');const EGenreEvenementListe=require('Enumere_EvenementListe.js');const ObjetMenuContextuel=require('ObjetMenuContextuel.js');const GPosition=require('GPosition.js');const GUID=require('GUID.js');const DonneesListe_InfosSond=require('DonneesListe_InfosSond.js');const DonneesListeTypesAccesInfoSond=require('DonneesListeTypesAccesInfoSond.js');const{GDate}=require('ObjetDate.js');const EStructureAffichage=require('Enumere_StructureAffichage.js');const ObjetInterfacePage=require('ObjetInterfacePageCP.js');const EEvent=require('Enumere_Event.js');require('produit/css/InterfacePageInfoSondage.css');class InterfacePageInfoSondage extends ObjetInterfacePage{constructor(...aParams){super(...aParams);this.ajouterEvenementGlobal(EEvent.SurPostResize,this._surPostResize);this.genresAffichages={reception:0,saisie:1,modeles:2};this.filtreModeItem=null;this.modeAff=this.genresAffichages.reception;this.uniquementNonLues=GEtatUtilisateur.getUniquementNonLues();this.modeAuteur=false;this.hauteurZoneCommandesDiffusion=IE.estMobile?0:80;this.setOptionsInfoSondage();this.setOptionsEcrans({nbNiveaux:3,avecBascule:IE.estMobile});this.contexte=$.extend(this.contexte,{ecran:
[ InterfacePageInfoSondage.genreEcran.listeTypesBlocs,InterfacePageInfoSondage.genreEcran.listeBlocs,InterfacePageInfoSondage.genreEcran.visuBloc
],avecMsgAucun:true,selectionCouranteModeReception:null,selectionCouranteModeDiffusion:null});if(!this.avecAuteur){this.contexte=$.extend(this.contexte,{niveauCourant:1});}
if(this.avecFiltreCategorie){this.categorie=GEtatUtilisateur.getCategorie();}
this.ids={msgAucun:GUID.getId()};}
evntRetourEcranPrec(){switch(this.getCtxEcran({niveauEcran:this.contexte.niveauCourant})){case InterfacePageInfoSondage.genreEcran.visuBloc:this.selectionCouranteModeReception=null;this.selectionCouranteModeDiffusion=null;this.revenirSurEcranPrecedent();break;case InterfacePageInfoSondage.genreEcran.listeBlocs:if(this.avecAuteur){this.revenirSurEcranPrecedent();}
break;}}
getControleur(aInstance){return $.extend(true,super.getControleur(this),{btnRetourEcranPrec:{event:function(){this.evntRetourEcranPrec();}.bind(aInstance)},retourEcranPrecSurContenu:function(){$(this.node).on({click:function(){this.evntRetourEcranPrec();}.bind(aInstance)});},comboFiltreCategories:{init:function(aCombo){aCombo.setOptions_ObjetSaisie({longueur:200,hauteur:16,hauteurLigneDefault:16});},getDonnees:function(){if(aInstance.listeCategories!==null&&aInstance.listeCategories!==undefined){return aInstance.listeCategories;}},getIndiceSelection:function(){const lIndice=GEtatUtilisateur.getCategorie()?aInstance.listeCategories.GetIndiceParElement(GEtatUtilisateur.getCategorie()):0;return lIndice;},event:function(aParametres,aInstanceCombo){if(aParametres.genreEvenement===EGenreEvenementObjetSaisie.selection&&aParametres.element&&aInstanceCombo.EstUneInteractionUtilisateur()){_evntSurCategorie.call(aInstance,aParametres.genreEvenement,aParametres.element);}}},estVisibleCbUniquementNonLues:function(){return aInstance.estGenreReception();},checkUniquementNonLues:{getValue:function(){return aInstance.uniquementNonLues;},setValue:function(aValeur){aInstance.uniquementNonLues=aValeur;if(!aInstance.modeAuteur){GEtatUtilisateur.setUniquementNonLues(aInstance.uniquementNonLues);}
aInstance.afficherSelonFiltres();}}});}
ConstruireInstances(){this.identVisuInfoSondage=this.Add(InterfaceConsultInfoSondage,_evntVisuInfoSond.bind(this),_initVisuInfoSond.bind(this));this.identListeInfosSond=this.Add(ObjetListe,this.evntSurListeInfoSond);if(this.avecAuteur){this.identListeTypesAccesInfosSond=this.Add(ObjetListe,this.evntSurListeTypeAccesInfoSond,this.initListeTypeAccesInfoSond);}
if(this.avecAuteur&&this.droitSaisie){this.identEditionInfoSond=this.instancierEditionInfoSond();}}
initListeTypeAccesInfoSond(aInstance){aInstance.setOptionsListe({avecLigneCreation:false});}
declencherActionsAutoSurNavigation(){}
getGenreAffichageSelonTypeAcces(){}
estModeAffDiffusion(aModeAff){return(aModeAff===this.genresAffichages.saisie);}
initEcranTypeAccesInfoSond(){if(!this.avecAuteur){return;}
const lNiveauEcranTypes=this.getNiveauDeGenreEcran({genreEcran:InterfacePageInfoSondage.genreEcran.listeTypesBlocs});new Promise(function(aResolve){this.afficherEcranTypeAccesInfoSond();aResolve();}.bind(this)).then(function(){let lDataSelectionCourante=this.getCtxSelection({niveauEcran:lNiveauEcranTypes});let lTypeSelectionCourante;if(lDataSelectionCourante===null||lDataSelectionCourante===undefined){lTypeSelectionCourante=this.getTypeInfoSondParDefaut();} else{lTypeSelectionCourante=lDataSelectionCourante.Genre;}
const lDataSelection=this.getItemDeType(lTypeSelectionCourante);if(lDataSelection!==null&&lDataSelection!==undefined){this.surSelectionTypeAccesInfoSond(lDataSelection);}}.bind(this));}
getItemDeType(aType){if(!this.avecAuteur){return;}
const lDonneesListe=this.GetInstance(this.identListeTypesAccesInfosSond).getDonneesListe().Donnees;return lDonneesListe.GetElementParGenre(aType);}
surSelectionTypeAccesInfoSond(aArticleTypeAccesInfoSond){this.selectionnerTypeAccesInfoSond({selection:aArticleTypeAccesInfoSond});var lModeAff=this.getGenreAffichageSelonTypeAcces({selection:aArticleTypeAccesInfoSond});this.filtreModeItem=aArticleTypeAccesInfoSond.Genre;new Promise(function(aResolve){this.modeAff=lModeAff;this.modeAuteur=this.avecAuteur&&(this.estGenreDiffusion()||this.estGenreModeles());this.formatterDataSurBasculeModeAff(lModeAff,this.filtreModeItem);aResolve();}.bind(this)).then(function(){var lEcranSrc={niveauEcran:0,genreEcran:this.getCtxEcran({niveauEcran:0}),dataEcran:this.getCtxSelection({niveauEcran:0})};var lEcranDest={niveauEcran:1,genreEcran:this.getCtxEcran({niveauEcran:1})};this.basculerEcran(lEcranSrc,lEcranDest);this.declencherActionsAutoSurNavigation();}.bind(this));}
evntSurListeTypeAccesInfoSond(aParametres){switch(aParametres.genreEvenement){case EGenreEvenementListe.Selection:this.surSelectionTypeAccesInfoSond(aParametres.article);break;}}
initListeInfosSond(aInstance){aInstance.setOptionsListe({avecLigneCreation:this.droitSaisie,nonEditableSurModeExclusif:true});}
evntSurListeInfoSond(aParametres){switch(aParametres.genreEvenement){case EGenreEvenementListe.Selection:this.surSelectionInfoSondage({infoSondage:aParametres.article});break;case EGenreEvenementListe.Creation:if(!IE.estMobile){const lPosBtn=GPosition.getClientRect(aParametres.nodeBouton);ObjetMenuContextuel.afficher({pere:this,id:{x:lPosBtn.left,y:lPosBtn.bottom+10},initCommandes:function(aMenu){const lEstModeModele=this.estGenreModeles();if(!lEstModeModele){aMenu.add(GTraductions.getValeur('actualites.creerInfo'),true,function(){this.evntBtnCreerActuInfo();}.bind(this),{icon:'icon_diffuser_information'});aMenu.add(GTraductions.getValeur('actualites.creerSondage'),true,function(){this.evntBtnCreerActuSondage();}.bind(this),{icon:'icon_diffuser_sondage'});} else{if(this.avecModeles){aMenu.add(GTraductions.getValeur('actualites.nouveauModele'),true,function(){this.evntBtnCreerModele({estInfo:this.estModeItemDeTypeInfo()});}.bind(this),{icon:'icon_sondage_bibliotheque'});if(!IE.estMobile&&this.estModeItemDeTypeSondage()){aMenu.add(GTraductions.getValeur('actualites.importerModeleSondage'),this.droitSaisie,function(){this.evntImportModele();}.bind(this),{icon:'icon_download_alt'});}}}}});} else{this.evntBtnCreerActuInfo();}
break;}}
instancierEditionInfoSond(){}
estModeItemDeTypeInfo(){return false;}
estModeItemDeTypeSondage(){return false;}
SetParametresGeneraux(){this.GenreStructure=EStructureAffichage.Autre;this.avecBandeau=true;this.IdentZoneAlClient=this.identPage;this.AddSurZone=[];}
ConstruireStructureAffichageAutre(){const H=[];H.push('<div class="InterfacePageInfoSondage">');const lHauteurADeduire=0;H.push('<div class="ecrans ',(this.optionsEcrans.avecBascule?'mono':'multi'),'" style="height:calc(100% - ',lHauteurADeduire,'px)">');if(this.avecAuteur){H.push('<div class="nav ',(this.optionsEcrans.avecBascule?'mono':'multi'),'" id="',this.getIdDeNiveau({niveauEcran:0}),'">');H.push('<div id="',this.GetInstance(this.identListeTypesAccesInfosSond).GetNom(),'" style="height:100%;"></div>');H.push('</div>');}
H.push('<section class="section ',(this.optionsEcrans.avecBascule?'mono':'multi'),'" style="height:100%" id="',this.getIdDeNiveau({niveauEcran:1}),'">');H.push('<div id="',this.GetInstance(this.identListeInfosSond).GetNom(),'" style="height:100%;"></div>');H.push('</section>');H.push('<aside class="aside ',(this.optionsEcrans.avecBascule?'mono':'multi'),'" id="',this.getIdDeNiveau({niveauEcran:2}),'">');H.push('<div class="',(this.optionsEcrans.avecBascule?'ecran-visu':''),'" id="',this.GetInstance(this.identVisuInfoSondage).GetNom(),'" ></div>');H.push('</aside>');H.push('</div>');H.push('</div>');return H.join('');}
ActualiserDonnees(){}
RecupererDonnees(){this.ActualiserDonnees();}
composeFiltreCategories(){return{html:'<ie-combo ie-model="comboFiltreCategories"></ie-combo>',controleur:this.controleur};}
composeCheckboxUniquementNonLues(){return{html:'<ie-checkbox ie-textleft ie-display="estVisibleCbUniquementNonLues" ie-model="checkUniquementNonLues">'+GTraductions.getValeur('actualites.UniquementNonLues')+'</ie-checkbox>',controleur:this.controleur};}
construireEcran(aEcran){switch(aEcran.genreEcran){case InterfacePageInfoSondage.genreEcran.listeTypesBlocs:return new Promise(function(aResolve){if(this.optionsEcrans.avecBascule){this.setHtmlStructureAffichageBandeau('');}
this.afficherListeTypesInfoSond();aResolve();}.bind(this));case InterfacePageInfoSondage.genreEcran.listeBlocs:return new Promise(function(aResolve){if(this.optionsEcrans.avecBascule){let lHtmlBandeau='';if(this.avecAuteur){lHtmlBandeau=this.construireBandeauEcranListeInfoSondage();}
this.setHtmlStructureAffichageBandeau(lHtmlBandeau);}
this.afficherSelonFiltres();aResolve();}.bind(this));case InterfacePageInfoSondage.genreEcran.visuBloc:return new Promise(function(aResolve){if(this.optionsEcrans.avecBascule){const lHtmlBandeau=this.construireBandeauEcranVisuInfoSondage();this.setHtmlStructureAffichageBandeau(lHtmlBandeau);}
_initVisuInfoSond.call(this,this.GetInstance(this.identVisuInfoSondage));this.GetInstance(this.identVisuInfoSondage).setUtilitaires(this.utilitaires);this.GetInstance(this.identVisuInfoSondage).SetDonnees({actualite:this.getCtxSelection({niveauEcran:1}),avecMsgAucun:this.contexte.avecMsgAucun});aResolve();}.bind(this));default:;}}
afficherEcranTypeAccesInfoSond(){const lEcranDest={niveauEcran:0,genreEcran:this.getCtxEcran({niveauEcran:0})};this.basculerEcran(null,lEcranDest);}
afficherVisuInfoSondage(){const lEcranSrc={niveauEcran:1,genreEcran:this.getCtxEcran({niveauEcran:1}),dataEcran:this.getCtxSelection({niveauEcran:1})};const lEcranDest={niveauEcran:2,genreEcran:this.getCtxEcran({niveauEcran:2})};this.basculerEcran(lEcranSrc,lEcranDest);}
construireBandeauEcranListeInfoSondage(){const H=[];if(this.avecAuteur){const lTypeFiltre=this.getCtxSelection({niveauEcran:0});const lStr=lTypeFiltre.GetLibelle();H.push(`<h3 class="titre"><i class="${lTypeFiltre.icone} "></i>${lStr}</h3>`);}
return this.construireBandeauEcran(H.join(''),{bgWhite:true,avecRetourSurContenuBandeau:true});}
construireBandeauEcranVisuInfoSondage(){const lActu=this.getCtxSelection({niveauEcran:1});const H=[];const lStr=lActu.estSondage?GTraductions.getValeur('infoSond.sondageDu',GDate.FormatDate(lActu.dateDebut,'%JJ %MMM')):GTraductions.getValeur('infoSond.infoDu',GDate.FormatDate(lActu.dateDebut,'%JJ %MMM'));H.push('<h3 class="titre">',lStr,'</h3>');return this.construireBandeauEcran(H.join(''),{bgWhite:true});}
deselectionnerContexte(){const lDataSelection=this.getCtxSelection({niveauEcran:1});if((lDataSelection!==null)&&(lDataSelection!==undefined)){if(!this.optionsEcrans.avecBascule){lDataSelection.estSelectionne=false;}
this.setCtxSelection({niveauEcran:1,dataEcran:null});}}
afficherSelectionDansListeTypeAcces(aSelection){if(!this.avecAuteur){return;}
const lListe=this.GetInstance(this.identListeTypesAccesInfosSond);const lListeElts=lListe.getDonneesListe().Donnees;if(lListeElts!==null&&lListeElts!==undefined){const lIndice=lListeElts.getIndiceElementParFiltre(function(D){return(D.GetNumero()===aSelection.GetNumero());}.bind(this));if(lIndice!==null&&lIndice!==undefined){this.GetInstance(this.identListeTypesAccesInfosSond).SelectionnerLigne({ligne:lIndice,avecScroll:true,avecEvenement:false});}}}
afficherSelectionDansListeInfosSond(aSelection){const lListe=this.GetInstance(this.identListeInfosSond);const lListeElts=lListe.getDonneesListe().Donnees;if(lListeElts!==null&&lListeElts!==undefined){const lIndice=lListeElts.getIndiceElementParFiltre(function(D){return(D.GetNumero()===aSelection.GetNumero())&&(this.modeAuteur===true||(D.public!==null&&D.public!==undefined&&aSelection.public!==null&&aSelection!==undefined&&D.public.GetNumero()===aSelection.public.GetNumero()));}.bind(this));if(lIndice!==null&&lIndice!==undefined){this.GetInstance(this.identListeInfosSond).SelectionnerLigne({ligne:lIndice,avecScroll:true,avecEvenement:false});}}}
selectionnerTypeAccesInfoSond(aParam){this.setCtxSelection({niveauEcran:0,dataEcran:aParam.selection});if(!this.optionsEcrans.avecBascule){this.marquerSelectionTypeAccesInfoSond();}}
marquerSelectionTypeAccesInfoSond(){const lSelection=this.getCtxSelection({niveauEcran:0});if((lSelection!==null)&&(lSelection!==undefined)){lSelection.estSelectionne=true;this.afficherSelectionDansListeTypeAcces(lSelection);}}
selectionnerInfoSond(aParam){this.setCtxSelection({niveauEcran:1,dataEcran:aParam.infoSondage});if(!this.optionsEcrans.avecBascule){const lSelection=this.getCtxSelection({niveauEcran:1});if((lSelection!==null)&&(lSelection!==undefined)){lSelection.estSelectionne=true;this.afficherSelectionDansListeInfosSond(lSelection);}}
if(this.modeAuteur){this.contexte.selectionCouranteModeDiffusion=aParam.infoSondage;} else{this.contexte.selectionCouranteModeReception=aParam.infoSondage;}}
surSelectionInfoSondage(aParam){this.deselectionnerContexte();this.selectionnerInfoSond(aParam);this.afficherVisuInfoSondage();}
reInitCtxSelection(aParam){this.deselectionnerContexte();this.contexte.avecMsgAucun=aParam.avecMsgAucun;if(!this.optionsEcrans.avecBascule){this.afficherVisuInfoSondage();}}
revenirSurEcranPrecedent(){if(this.getCtxEcran(this.contexte.niveauCourant)===InterfacePageInfoSondage.genreEcran.visuBloc){const lData=this.getCtxSelection({niveauEcran:1});const lEstCtxDiffusion=(this.modeAuteur===true);if(IE.estMobile&&!lData.lue&&!lEstCtxDiffusion&&!GApplication.getModeExclusif()){lData.lue=!lData.lue;lData.marqueLueSeulement=true;this.evntSurValidationInfoSond(lData,EGenreEvntActu.SurValidationDirecte,{avecRecupDonnees:true});return;}}
super.revenirSurEcranPrecedent();}
setOptionsActus(aOptions){this.avecAuteur=aOptions.avecAuteur;this.forcerAR=aOptions.forcerAR;this.avecSondageAnonyme=aOptions.avecSondageAnonyme;this.droitSaisie=aOptions.droitSaisie;this.droitPublicationPageEtablissement=aOptions.droitPublicationPageEtablissement;this.avecModeles=aOptions.avecModeles;this.avecFiltreCategorie=aOptions.avecFiltreCategorie;}
setOptionsInfoSondage(){const lDefault={avecAuteur:false,avecFiltreCategorie:false,forcerAR:false,avecSondageAnonyme:false,droitSaisie:false,avecModeles:false};const lParam={avecAuteur:this.getAvecAuteur(),droitSaisie:this.getAvecDroitSaisie(),droitPublicationPageEtablissement:this.getDroitPublicationPageEtablissement(),forcerAR:this.getForcerAR(),avecSondageAnonyme:this.getAvecSondageAnonyme(),avecFiltreCategorie:this.getAvecFiltreCategorie(),avecModeles:this.getAvecModeles()};this.setOptionsActus($.extend(lDefault,lParam));}
getAvecFiltreCategorie(){return false;}
getAvecModeles(){return false;}
initDataInfoSondSurEdition(){}
evntBtnCreerActuInfo(){if(this.GetInstance(this.identEditionInfoSond)){this.GetInstance(this.identEditionInfoSond).setOptionsFenetre({titre:GTraductions.getValeur('actualites.creerInfo')});this.GetInstance(this.identEditionInfoSond).SetDonnees(this.initDataInfoSondSurEdition({estCreation:true,estInfo:true,avecRecupModele:this.avecModeles}));}}
evntBtnCreerActuSondage(){if(this.GetInstance(this.identEditionInfoSond)){this.GetInstance(this.identEditionInfoSond).setOptionsFenetre({titre:GTraductions.getValeur('actualites.creerSondage')});this.GetInstance(this.identEditionInfoSond).SetDonnees(this.initDataInfoSondSurEdition({estCreation:true,estInfo:false,avecRecupModele:this.avecModeles}));}}
evntBtnCreerModele(aParam){if(this.GetInstance(this.identEditionInfoSond)){this.GetInstance(this.identEditionInfoSond).setOptionsFenetre({titre:GTraductions.getValeur('actualites.creerModele')});this.GetInstance(this.identEditionInfoSond).SetDonnees(this.initDataInfoSondSurEdition({estCreation:true,estInfo:aParam.estInfo,estModele:true}));}}
evntImportModele(){}
initFenetreEditionInfoSond(aInstance){aInstance.setOptionsFenetre({titre:'',largeur:750,hauteur:660,listeBoutons:[{libelle:GTraductions.getValeur('Annuler'),theme:TypeThemeBouton.secondaire},{libelle:GTraductions.getValeur('Valider'),theme:TypeThemeBouton.primaire}
]});aInstance.avecEtatSaisie=false;if(aInstance.setUtilitaires){aInstance.setUtilitaires(this.utilitaires);}}
eltSelectionPrecedenteRetrouveDansListe(aParam){let lEltARetrouver;let lResult=null;const lEstCtxDiffusion=(this.modeAuteur===true);if(lEstCtxDiffusion){lEltARetrouver=this.contexte.selectionCouranteModeDiffusion;} else{lEltARetrouver=this.contexte.selectionCouranteModeReception;}
if(lEltARetrouver!==null&&lEltARetrouver!==undefined){const lListe=aParam.liste;const lListeResult=lListe.getListeElements(function(D){return(D.GetNumero()===lEltARetrouver.GetNumero())&&(lEstCtxDiffusion||(D.public!==null&&D.public!==undefined&&lEltARetrouver.public!==null&&lEltARetrouver.public!==undefined&&D.public.GetNumero()===lEltARetrouver.public.GetNumero()));});if(lListeResult.GetNbrElements()===1){lResult=lListeResult.GetElement(0);}}
return lResult;}
initContexteSelection(aListeFiltree){const lListeNonVide=(aListeFiltree.GetNbrElements()>0);if(lListeNonVide){const lEstCasRedirectionDepuisWidget=GEtatUtilisateur.getInfoSond!==null&&GEtatUtilisateur.getInfoSond!==undefined?(GEtatUtilisateur.getInfoSond()!==null&&GEtatUtilisateur.getInfoSond()!==undefined):false;const lEstCtxDiffusion=(this.modeAuteur===true);if(lEstCasRedirectionDepuisWidget&&!lEstCtxDiffusion){this.contexte.selectionCouranteModeReception=GEtatUtilisateur.getInfoSond();GEtatUtilisateur.setInfoSond(null);}
if(!this.optionsEcrans.avecBascule||(lEstCasRedirectionDepuisWidget&&!lEstCtxDiffusion)){const lEltASelectionner=this.eltSelectionPrecedenteRetrouveDansListe({liste:aListeFiltree});if(lEltASelectionner!==null&&lEltASelectionner!==undefined){this.surSelectionInfoSondage({infoSondage:lEltASelectionner});} else{this.reInitCtxSelection({avecMsgAucun:lListeNonVide});}} else{this.reInitCtxSelection({avecMsgAucun:lListeNonVide});}} else{this.reInitCtxSelection({avecMsgAucun:lListeNonVide});}}
getOptionsInfoSond(){return{};}
getListeDonneesTypesInfoSond(){}
afficherListeTypesInfoSond(){if(!this.avecAuteur){return;}
this.GetInstance(this.identListeTypesAccesInfosSond).setOptionsListe({skin:ObjetListe.skin.flatDesign,avecOmbreDroite:true});this.GetInstance(this.identListeTypesAccesInfosSond).SetDonnees(new DonneesListeTypesAccesInfoSond(this.getListeDonneesTypesInfoSond()).setOptions({avecEvnt_Selection:true,avecTri:false,flatDesignMinimal:true,avecBoutonActionLigne:false}));}
afficherListeInfoSond(aListeFiltree){const lFiltres=[];lFiltres.push(this.composeCheckboxUniquementNonLues());if(this.avecFiltreCategorie){lFiltres.push(this.composeFiltreCategories());}
this.GetInstance(this.identListeInfosSond).setOptionsListe({skin:ObjetListe.skin.flatDesign,avecOmbreDroite:true,boutons:lFiltres,messageContenuVide:this.composeMessage(this.estGenreModeles()?GTraductions.getValeur('infoSond.msgAucunModele'):GTraductions.getValeur('infoSond.msgAucun'))});const lOptions=this.getOptionsInfoSond();this.GetInstance(this.identListeInfosSond).SetDonnees(new DonneesListe_InfosSond(aListeFiltree,lOptions,this.utilitaires).setOptions({avecEvnt_Selection:true,avecTri:false}));}
afficherSelonFiltres(){if(!this.listeActualites){return;}
this.marquerSelectionTypeAccesInfoSond();const lListeFiltree=this.getListeFiltree();this.afficherListeInfoSond(lListeFiltree);this.initContexteSelection(lListeFiltree);}
estGenreReception(){return(this.modeAff===this.genresAffichages.reception);}
estGenreDiffusion(){return(this.modeAff===this.genresAffichages.saisie);}
estGenreModeles(){return(this.modeAff===this.genresAffichages.modeles);}
_surPostResize(){this.afficherSelonFiltres();}}
InterfacePageInfoSondage.genreEcran={listeTypesBlocs:'listeTypesBlocs',listeBlocs:'listeBlocs',visuBloc:'visuBloc'};function _evntSurCategorie(aGenreEvenement,aCategorie){if(aGenreEvenement===EGenreEvenementObjetSaisie.selection){this.categorie=aCategorie;GEtatUtilisateur.setCategorie(this.categorie);this.afficherSelonFiltres();}}
function _initVisuInfoSond(aInstance){aInstance.setOptions(this.getOptionsInfoSond());}
function _evntVisuInfoSond(aActu,aGenreEvnt,aParam){switch(aGenreEvnt){case EGenreEvntActu.SurMenuCtxActu:this.evntSurValidationInfoSond(aActu,aGenreEvnt,aParam);break;case EGenreEvntActu.SurAnnulationSondage:this.selectionCouranteModeReception=null;this.selectionCouranteModeDiffusion=null;this.revenirSurEcranPrecedent();this.ActualiserDonnees();break;case EGenreEvntActu.SurAR:case EGenreEvntActu.SurValidationSondage:this.evntSurValidationInfoSond(aActu,aGenreEvnt,aParam);break;case EGenreEvntActu.SurVoirResultats:this.evntSurAfficherResultats(aActu);break;default:break;}}
module.exports=InterfacePageInfoSondage;},fn:"interfacepageinfosondage.js"});;
IE.fModule({f:function(exports,require,module,global){const{ObjetRequeteConsultation}=require('ObjetRequeteJSON.js');const Requetes=require('CollectionRequetes.js');const ObjetElement=require('ObjetElement.js');const GTraductions=require('ObjetTraduction.js');const ObjetTri=require('ObjetTri.js');class ObjetRequetePageActualites extends ObjetRequeteConsultation{constructor(...aParams){super(...aParams);}
lancerRequete(aParametres){$.extend(this.JSON,aParametres);return this.appelAsynchrone();}
actionApresRequete(){let lListeCategories=null;if(this.JSONReponse.listeCategories){lListeCategories=this.JSONReponse.listeCategories;const lCategorie=new ObjetElement(GTraductions.getValeur('actualites.ToutesCategories'),0);lCategorie.toutesLesCategories=true;lListeCategories.AddElement(lCategorie);lListeCategories.setTri([ObjetTri.init(function(D){return!D.toutesLesCategories;}),ObjetTri.init('Libelle')]);lListeCategories.trier();}
const lTabModeAff=this.JSONReponse.listeModesAff;this.callbackReussite.appel({listeCategories:lListeCategories,tabModeAff:lTabModeAff});}}
Requetes.inscrire('PageActualites',ObjetRequetePageActualites);module.exports=ObjetRequetePageActualites;},fn:"objetrequetepageactualites.js"});;
IE.fModule({f:function(exports,require,module,global){
const MethodesObjet=require('MethodesObjet.js');const TypeChampsJSON=require('Enumere_ChampsJSON.js');const TypeHttpVariable=require('TypeHttpVariable.js').TypeHttpVariable;class TypeChaineBrute{constructor(aChaineBrute){this.chaineBrute=MethodesObjet.isString(aChaineBrute)?aChaineBrute:'';}
toJSON(){const lJSON={};lJSON[TypeChampsJSON.type]=TypeHttpVariable.TypeHttpChaineBrute;lJSON[TypeChampsJSON.valeur]=this.chaineBrute;return lJSON;}}
module.exports=TypeChaineBrute;},fn:"typechainebrute.js"});;
IE.fModule({f:function(exports,require,module,global){const{ObjetRequeteSaisie}=require('ObjetRequeteJSON.js');const GChaine=require('GChaine.js');const Requetes=require('CollectionRequetes.js');const TypeChaineBrute=require('TypeChaineBrute.js');const EGenreEtat=require('Enumere_Etat.js');const EGenreRessource=require('Enumere_Ressource.js');class ObjetRequeteSaisieActualites extends ObjetRequeteSaisie{constructor(...aParams){super(...aParams);}
lancerRequete(aParam){this.validationDirecte=aParam.validationDirecte||false;this.saisieActualite=aParam.saisieActualite;this.genresAffDestinataire=aParam.genresAffDestinataire;aParam.listeActualite.setSerialisateurJSON({methodeSerialisation:_serialiser_Actualite.bind(this),ignorerEtatsElements:this.validationDirecte});this.JSON.listeActualites=aParam.listeActualite;this.JSON.saisieActualite=this.saisieActualite;if(aParam.listeDocuments){aParam.listeDocuments.setSerialisateurJSON({methodeSerialisation:_serialiser_Document.bind(this)});this.JSON.listeDocuments=aParam.listeDocuments;}
if(aParam.punition){this.JSON.punition=aParam.punition;}
if(aParam.incident){this.JSON.incident=aParam.incident;}
return this.appelAsynchrone();}
actionApresRequete(aXml,aGenreReponse){this.callbackReussite.appel(aXml,aGenreReponse,this.JSONRapportSaisie);}}
Requetes.inscrire('SaisieActualites',ObjetRequeteSaisieActualites);function _serialiser_Actualite(aActualite,aJSON){if(!!aActualite.estUneDiffusionDeResultatsSondage&&aActualite.Etat===EGenreEtat.Creation){if(!!aActualite.listeQuestions){aActualite.listeQuestions.parcourir(function(aQuestion){if(!!aQuestion&&aQuestion.listePiecesJointes){aQuestion.listePiecesJointes.parcourir(function(aPJ){aPJ.SetEtat(EGenreEtat.Creation);});}});}}
aJSON.validationDirecte=this.validationDirecte;if(aActualite.estADupliquer===true){aJSON.estADupliquer=true;aJSON.dupliquerPublic=(aActualite.dupliquerPublic===true);return;}
if(aActualite.estAModeliser===true){aJSON.estAModeliser=true;return;}
aJSON.estModelePartage=aActualite.estModelePartage;if(!!aActualite.changePartageModeleSeulement){aJSON.changePartageModeleSeulement=true;return;}
aJSON.genrePublic=aActualite.genrePublic;aJSON.public=aActualite.public;aJSON.lue=aActualite.lue;aJSON.supprimee=!!aActualite.supprimee;aJSON.marqueLueSeulement=aActualite.marqueLueSeulement?aActualite.marqueLueSeulement:false;aJSON.saisieActualite=this.saisieActualite;aActualite.listeQuestions.setSerialisateurJSON({methodeSerialisation:_serialiser_ListeQuestions.bind(this),ignorerEtatsElements:this.saisieActualite});aJSON.listeQuestions=aActualite.listeQuestions;if(this.saisieActualite){aJSON.publie=aActualite.publie;aJSON.estModele=aActualite.estModele===true;aJSON.categorie=aActualite.categorie;aJSON.dateDebut=aActualite.dateDebut;aJSON.dateFin=aActualite.dateFin;aJSON.genreReponse=aActualite.genreReponse;aJSON.tailleReponse=aActualite.tailleReponse;aJSON.reponseAnonyme=aActualite.reponseAnonyme;aJSON.publicationPageEtablissement=aActualite.publicationPageEtablissement;if(!!aActualite.listeIndividusPartage){aActualite.listeIndividusPartage.setSerialisateurJSON({ignorerEtatsElements:true});aJSON.listeIndividusPartage=aActualite.listeIndividusPartage;}
if(aActualite.avecModificationPublic){aJSON.avecModificationPublic=true;aJSON.avecElevesRattaches=aActualite.avecElevesRattaches;if($.inArray(EGenreRessource.Eleve,this.genresAffDestinataire)>-1){aJSON.avecEleve=aActualite.avecEleve;aJSON.avecResp1=aActualite.avecResp1;aJSON.avecResp2=aActualite.avecResp2;aJSON.avecProfsPrincipaux=aActualite.avecProfsPrincipaux;aJSON.avecTuteurs=aActualite.avecTuteurs;}
aJSON.genresPublicEntite=aActualite.genresPublicEntite;aJSON.avecDirecteur=aActualite.avecDirecteur;aActualite.listePublicEntite.setSerialisateurJSON({methodeSerialisation:null,ignorerEtatsElements:true});aJSON.listePublicEntite=aActualite.listePublicEntite;aActualite.listePublicIndividu.setSerialisateurJSON({methodeSerialisation:_serialiser_Individu.bind(this),ignorerEtatsElements:true});aJSON.listePublicIndividu=aActualite.listePublicIndividu;}}}
function _serialiser_ListeQuestions(aQuestion,aJSON){if(this.saisieActualite){$.extend(aJSON,aQuestion.copieToJSON());aJSON.texte=new TypeChaineBrute(aQuestion.texte);aQuestion.listeChoix.setSerialisateurJSON({methodeSerialisation:_serialiser_Choix.bind(this),ignorerEtatsElements:false,nePasTrierPourValidation:true});aJSON.listeChoix=aQuestion.listeChoix;aQuestion.listePiecesJointes.setSerialisateurJSON({methodeSerialisation:_serialiser_Document.bind(this),ignorerEtatsElements:false});aJSON.listePiecesJointes=aQuestion.listePiecesJointes;} else{aJSON.genreReponse=aQuestion.genreReponse;aJSON.reponse=aQuestion.reponse.toJSON();$.extend(aJSON.reponse,aQuestion.reponse.copieToJSON());}}
function _serialiser_Document(aDocument,aJSON){const lIdFichier=aDocument.idFichier!==undefined?aDocument.idFichier:(aDocument.Fichier!==undefined?aDocument.Fichier.idFichier:null);if(lIdFichier!==null){aJSON.idFichier=GChaine.CardinalToStr(lIdFichier);}
aJSON.nomFichier=aDocument.nomFichier;aJSON.url=aDocument.url;}
function _serialiser_Individu(aIndividu,aJSON){aJSON.N=aIndividu.GetNumero();aJSON.G=aIndividu.GetGenre();aJSON.E=undefined;aJSON.L=undefined;}
function _serialiser_Choix(aChoix,aJSON){aJSON.rang=aChoix.rang;if(aChoix.estReponseLibre){aJSON.estReponseLibre=true;}}
module.exports=ObjetRequeteSaisieActualites;},fn:"objetrequetesaisieactualites.js"});;
IE.fModule({f:function(exports,require,module,global){const{ObjetRequeteConsultation}=require('ObjetRequeteJSON.js');const Requetes=require('CollectionRequetes.js');class ObjetRequeteListeSondagesDeBiblioEtablissement extends ObjetRequeteConsultation{constructor(...aParams){super(...aParams);}
lancerRequete(aParam){$.extend(this.JSON,aParam);return this.appelAsynchrone();}
actionApresRequete(){this.callbackReussite.appel(this.JSONReponse);}}
Requetes.inscrire('ListeSondagesDeBiblioEtablissement',ObjetRequeteListeSondagesDeBiblioEtablissement);module.exports=ObjetRequeteListeSondagesDeBiblioEtablissement;},fn:"objetrequetelistesondagesdebiblioetablissement.js"});;
IE.fModule({f:function(exports,require,module,global){const ObjetFenetre_Liste=require('ObjetFenetre_Liste.js');const GTraductions=require('ObjetTraduction.js');const ObjetListe=require('ObjetListe.js');const EGenreEvenementObjetSaisie=require('Enumere_EvenementObjetSaisie.js');const MethodesObjet=require('MethodesObjet.js');const ObjetElement=require('ObjetElement.js');const ObjetTri=require('ObjetTri.js');class ObjetFenetre_SelectionModeleInfoSond extends ObjetFenetre_Liste{constructor(aParamsFenetre){super(aParamsFenetre);this.options.filtres={uniquementMesModeles:false,categorie:null,listeBruteCategories:null,listeCategories:null};this.setOptionsFenetre({modale:true,titre:aParamsFenetre.options&&aParamsFenetre.options.estCasSondage?GTraductions.getValeur('actualites.modeles.ListeSondages'):GTraductions.getValeur('actualites.modeles.ListeInfos'),largeur:600,hauteur:700,listeBoutons:[GTraductions.getValeur('Annuler'),GTraductions.getValeur('Valider')],modeActivationBtnValider:this.modeActivationBtnValider.toujoursActifs});this.paramsListe={optionsListe:{colonnes:[{taille:'100%'}],boutons:[{genre:ObjetListe.typeBouton.deployer},{genre:ObjetListe.typeBouton.rechercher}
],skin:ObjetListe.skin.flatDesign}};}
setOptions(aOptions){if(aOptions.filtres&&aOptions.filtres.listeBruteCategories){let lListeCategoriesAvecToutes=MethodesObjet.dupliquer(aOptions.filtres.listeBruteCategories);const lCategorieToutes=new ObjetElement(GTraductions.getValeur('actualites.ToutesCategories'),0);lCategorieToutes.toutesLesCategories=true;lListeCategoriesAvecToutes.AddElement(lCategorieToutes);lListeCategoriesAvecToutes.setTri([ObjetTri.init(function(D){return!D.toutesLesCategories;}),ObjetTri.init('Libelle')]);lListeCategoriesAvecToutes.trier();$.extend(aOptions.filtres,{listeCategories:lListeCategoriesAvecToutes});}
super.setOptions(aOptions);return this;}
getControleur(){return $.extend(true,super.getControleur(this),{filtres:{checkUniquementMesModeles:{getValue:function(){return this.options.filtres.uniquementMesModeles;}.bind(this),setValue:function(aValue){const lValueCB=!!aValue;this.options.filtres.uniquementMesModeles=lValueCB;_filtrerListe.call(this);}.bind(this)},labelUniquementMesModeles:function(){return GTraductions.getValeur('actualites.uniquementMesModeles');},comboCategories:{init:function(aCombo){aCombo.setOptions_ObjetSaisie({longueur:200,hauteur:16,hauteurLigneDefault:16});},getDonnees:function(){if(this.options.filtres.listeCategories!==null&&this.options.filtres.listeCategories!==undefined){return this.options.filtres.listeCategories;}}.bind(this),getIndiceSelection:function(){return this.options.filtres.categorie!==null?this.options.filtres.listeCategories.GetIndiceParElement(this.options.filtres.categorie):0;}.bind(this),event:function(aParametres,aCombo){if(aParametres.genreEvenement===EGenreEvenementObjetSaisie.selection&&aParametres.element&&aCombo.EstUneInteractionUtilisateur()){this.options.filtres.categorie=aParametres.element;_filtrerListe.call(this);}}.bind(this)}}});}
composeZoneFiltres(){const T=[];T.push('<ie-checkbox ie-model="filtres.checkUniquementMesModeles" ie-html="filtres.labelUniquementMesModeles"></ie-checkbox>');T.push('<ie-combo ie-model="filtres.comboCategories" style="padding-top:.5rem;"></ie-combo>');return T.join('');}
ComposeContenu(){const T=[];T.push('<table width="100%" height="100%" border="0" cellpadding="0" cellspacing="0">');T.push('<tr><td style="padding-bottom: 1rem;">');T.push(this.composeZoneFiltres());T.push('</td></tr>');T.push('<tr><td id="'+this.GetNomInstance(this.identListe)+'" height="100%">&nbsp;</td></tr>');T.push('</table>');return T.join('');}}
function _filtrerListe(){const lDonnees=this.GetInstance(this.identListe).getDonneesListe().Donnees;const lUniquementLesMiens=this.options.filtres.uniquementMesModeles;const lCategorie=this.options.filtres.categorie;lDonnees.parcourir(function(aLigne){const lEstVisibleSelonFiltreMiens=(lUniquementLesMiens!==true)||(aLigne.estModele===true&&aLigne.estAuteur===true)||(aLigne.estModele!==true&&aLigne.pere&&aLigne.pere.estAuteur===true);const lEstVisibleSelonCategorie=lCategorie===null||lCategorie===undefined||!lCategorie.existeNumero()||(aLigne.estModele===true&&aLigne.categorie.GetNumero()===lCategorie.GetNumero())||(aLigne.estModele!==true&&aLigne.pere&&aLigne.pere.categorie.GetNumero()===lCategorie.GetNumero());aLigne.visible=lEstVisibleSelonFiltreMiens&&lEstVisibleSelonCategorie;});this.actualiserListe();}
module.exports=ObjetFenetre_SelectionModeleInfoSond;},fn:"objetfenetre_selectionmodeleinfosond.js"});;
IE.fModule({f:function(exports,require,module,global){const ObjetDonneesListeFlatDesign=require('ObjetDonneesListeFlatDesign.js');class DonneesListeSondagesBiblio extends ObjetDonneesListeFlatDesign{constructor(aDonnees){super(aDonnees);this.setOptions({avecEdition:false,avecSuppression:false,avecEvnt_Selection:true,avecRechercheSelectionMiroir:true,avecTri:false,avecBoutonActionLigne:false});}
getInfosSuppZonePrincipale(aParams){const H=[];if(aParams.article&&aParams.article.estUnDeploiement){H.push(aParams.article.categorie.GetLibelle());}
return H.join('');}
estSelectionCibleMiroirDeSelectionSource(aParamsCelluleSource,aParamsCelluleCible){return!!aParamsCelluleSource.article.pere&&aParamsCelluleSource.article.pere.GetNumero()===aParamsCelluleCible.article.GetNumero();}
GetVisible(D){return D.visible!==false;}}
module.exports=DonneesListeSondagesBiblio;},fn:"donneesliste_sondagesbiblio.js"});;
IE.fModule({f:function(exports,require,module,global){const EGenreEvntActu=require('EGenreEvntActu.js');const ObjetListeElements=require('ObjetListeElements.js');const ObjetRequeteSaisieActualites=require('ObjetRequeteSaisieActualites.js');const GTraductions=require('ObjetTraduction.js');const{GDate}=require('ObjetDate.js');const Toast=require('Toast.js').Toast;const ETypeToast=require('Toast.js').ETypeToast;const ObjetRequeteListeSondagesDeBiblioEtablissement=require('ObjetRequeteListeSondagesDeBiblioEtablissement.js');const ObjetFenetre_SelectionModeleInfoSond=require('ObjetFenetre_SelectionModeleInfoSond.js');const DonneesListeSondagesBiblio=require('DonneesListe_SondagesBiblio.js');const ObjetElement=require('ObjetElement.js');const ObjetTri=require('ObjetTri.js');const ObjetFenetre=require('ObjetFenetre.js');const EGenreBoiteMessage=require('Enumere_BoiteMessage.js');const MoteurInfoSondage=require('MoteurInfoSondage.js').MoteurInfoSondage;class ObjetMoteurActus{constructor(...aParams){this.moteurCP=new MoteurInfoSondage(...aParams);}
surEvntSaisieReponseActu(aActualite,aGenreEvnt,aParam){if(aGenreEvnt===EGenreEvntActu.SurValidationSondage){aParam.avecMsgConfirm=true;}
this.declencherSaisieDirecte(aActualite,aGenreEvnt,aParam);}
declencherSaisieDirecte(aActualite,aGenreEvnt,aParam){const lListeActualites=new ObjetListeElements();lListeActualites.AddElement(aActualite);const lObjetSaisie={listeActualite:lListeActualites,validationDirecte:true,saisieActualite:aParam.modeAuteur};new ObjetRequeteSaisieActualites(this,this._reponseSaisieDirecte.bind(this,aActualite,aGenreEvnt,aParam)).lancerRequete(lObjetSaisie);}
_reponseSaisieDirecte(aActualite,aGenreEvnt,aParam){let lMessage,lIcon;switch(aGenreEvnt){case EGenreEvntActu.SurValidationSondage:lMessage=GTraductions.getValeur('actualites.msgConfirmValidation',[GDate.FormatDate(aActualite.dateFin,'%J/%MM/%AAAA')]);lIcon='icon_diffuser_sondage';break;case EGenreEvntActu.SurAR:lMessage=GTraductions.getValeur('infoSond.msgSurAR');lIcon=null;break;default:lMessage='';}
if(lMessage!==''){Toast.afficher({msg:lMessage,type:ETypeToast.succes,dureeAffichage:4500,icon:lIcon});this._surConfirmReponseSaisieDirecte(aParam);} else{this._surConfirmReponseSaisieDirecte(aParam);}}
_surConfirmReponseSaisieDirecte(aParam){if(!!aParam.avecRecupDonnees){aParam.clbckRecupDonnees.call(aParam.pereRecupDonnees);}}
getListeModeles(aParam){new ObjetRequeteListeSondagesDeBiblioEtablissement(this,_surReceptionListeSondageDeBiblioEtablissement.bind(this,aParam)).lancerRequete({estCasSondage:aParam.estCasSondage});}}
function _surReceptionListeSondageDeBiblioEtablissement(aParam,aJSON){if(!!aJSON&&!!aJSON.listeModeles&&aJSON.listeModeles.GetNbrElements()>0){const lListeModelesPourObjetListe=new ObjetListeElements();aJSON.listeModeles.setTri([
ObjetTri.init('Libelle')
]);aJSON.listeModeles.trier();aJSON.listeModeles.parcourir(function(aModele){aModele.estUnDeploiement=true;aModele.estDeploye=false;aModele.estModele=true;aModele.estSondage=aParam.estCasSondage;aModele.estInformation=!aModele.estSondage;aModele.visible=true;lListeModelesPourObjetListe.AddElement(aModele);if(!!aModele.listeQuestions){const lLibelleDetailSondage=[];aModele.listeQuestions.parcourir(function(aQuestion,aIndexQuestion){lLibelleDetailSondage.push(this.moteurCP.composeComposanteSondage({instance:this,actu:aModele,composante:aQuestion,indice:aIndexQuestion,avecLibelleQuestion:false,estAffEditionActualite:true}));}.bind(this));const lDetailSondage=new ObjetElement(lLibelleDetailSondage.join(''));lDetailSondage.pere=aModele;lDetailSondage.visible=true;lListeModelesPourObjetListe.AddElement(lDetailSondage);}}.bind(this));const lFenetreListeModeles=ObjetFenetre.creerInstance(ObjetFenetre_SelectionModeleInfoSond,{pere:this,evenement:function(aGenreBouton,aSelection){if(aGenreBouton===1){let lElementSelectionne=lListeModelesPourObjetListe.GetElement(aSelection);if(!!lElementSelectionne){if(!!lElementSelectionne.pere){lElementSelectionne=lElementSelectionne.pere;}
aParam.evntClbck({modele:lElementSelectionne});}}}.bind(this),options:{estCasSondage:aParam&&aParam.estCasSondage,filtres:{listeBruteCategories:aParam.listeCategories}}});lFenetreListeModeles.SetDonnees(new DonneesListeSondagesBiblio(lListeModelesPourObjetListe));} else{GApplication.getMessage().afficher({type:EGenreBoiteMessage.Information,message:aParam&&aParam.estCasSondage?GTraductions.getValeur('actualites.modeles.AucunSondageDisponible'):GTraductions.getValeur('actualites.modeles.AucuneInfoDisponible')});}}
module.exports=ObjetMoteurActus;},fn:"objetmoteuractus.js"});;
IE.fModule({f:function(exports,require,module,global){const{ObjetRequeteConsultation}=require('ObjetRequeteJSON.js');const Requetes=require('CollectionRequetes.js');const TypeGenreReponseInternetActualite=require('TypeGenreReponseInternetActualite.js').TypeGenreReponseInternetActualite;class ObjetRequetePageActualitesResultats extends ObjetRequeteConsultation{constructor(...aParams){super(...aParams);this.actualite=null;}
lancerRequete(aParametres){this.actualite=aParametres.actualite;this.JSON={};$.extend(this.JSON,aParametres);return this.appelAsynchrone();}
actionApresRequete(){let lNumeroPere;function _getIndicePere(aEle){if(aEle.NumeroArticleLigne===lNumeroPere){return true;} else{return false;}}
function _getIndicePremierFils(aEle){if(aEle.NumeroArticlePere===lNumeroPere){return true;} else{return false;}}
this.actualite.avecResultats=false;const lResultats=this.JSONReponse;if(lResultats&&lResultats.listeQuestions){for(let j=0;j<lResultats.listeQuestions.GetNbrElements();j++){const lQstResultat=lResultats.listeQuestions.GetElement(j);const lQuestion=this.actualite.listeQuestions.GetElementParNumero(lQstResultat.GetNumero());lQuestion.niveauMaxCumul=0;if(!!lQuestion&&!!lQstResultat&&!!lQstResultat.listeRepondant){lQuestion.resultats={};lQuestion.resultats.listeRepondant=lQstResultat.listeRepondant;this.actualite.avecResultats=true;for(let i=0;i<lQuestion.resultats.listeRepondant.GetNbrElements();i++){const lElement=lQuestion.resultats.listeRepondant.GetElement(i);if(lElement.estCumul){lElement.estDeploye=false;lNumeroPere=lElement.NumeroArticleLigne;lElement.estUnDeploiement=!this.actualite.reponseAnonyme||(lQuestion.genreReponse===TypeGenreReponseInternetActualite.Textuelle)||(lQuestion.resultats.listeRepondant.getIndiceElementParFiltre(_getIndicePremierFils)>-1);lQuestion.niveauMaxCumul=Math.max(lQuestion.niveauMaxCumul,lElement.niveauCumul);} else{lElement.estUnDeploiement=false;}
if(lElement.NumeroArticlePere!==0){lNumeroPere=lElement.NumeroArticlePere;const lIndicePere=lQuestion.resultats.listeRepondant.getIndiceElementParFiltre(_getIndicePere);if(lIndicePere> -1){lElement.pere=lQuestion.resultats.listeRepondant.GetElement(lIndicePere);}}}
lQuestion.niveauMaxCumul+=1;}}}
this.callbackReussite.appel(this.actualite);}}
Requetes.inscrire('PageActualitesResultats',ObjetRequetePageActualitesResultats);module.exports=ObjetRequetePageActualitesResultats;},fn:"objetrequetepageactualitesresultats.js"});;
IE.fModule({f:function(exports,require,module,global){const ObjetDonneesListe=require('ObjetDonneesListe.js');const GTraductions=require('ObjetTraduction.js');const ObjetTri=require('ObjetTri.js');class DonneesListe_ResultatsActualite extends ObjetDonneesListe{constructor(aParam,aUtilitaires){super(aParam.donnees);this.pere=aParam.pere;this.evenement=aParam.evenement;this.genreActualite=aParam.genre;this.niveauMaxCumul=aParam.niveauMaxCumul;this.filtreRepondu=aParam.filtreRepondu;this.avecNombreReponses=aParam.avecNombreReponses||false;this.setOptions({avecEdition:false,avecSuppression:false,avecDeploiement:true,avecContenuTronque:true,avecSelection:!IE.estMobile});this.utilitaires=aUtilitaires;}
getTri(){return[ObjetTri.init(function(D){return D.Position;})];}
getNiveauDeploiement(aParams){if(aParams.article.estCumul){return aParams.article.niveauCumul;} else{return this.niveauMaxCumul;}}
GetCouleurCellule(aParams){if(aParams.article.estCumul){return GCouleur.liste.cumul[ aParams.article.niveauCumul];}
return ObjetDonneesListe.ECouleurCellule.Blanc;}
GetValeur(I,D,aParams){let lDonnee;switch(aParams.declarationColonne.genreColonne){case DonneesListe_ResultatsActualite.colonnes.destinataires:{const lImageDeploiement=D.estDeploye?'Image_DeploiementListe_Deploye':'Image_DeploiementListe_NonDeploye';const lLibelle=(!D.estCumul?'&nbsp;&nbsp;&nbsp;&nbsp;':(D.estCumul&&D.NumeroArticlePere!==0?'&nbsp;&nbsp;':'')+(D.estUnDeploiement?'<div class="InlineBlock '+lImageDeploiement+'"></div>&nbsp;':'<div class="InlineBlock" style="width:8px;"></div>&nbsp;'))+D.GetLibelle()+(D.estCumul?' : '+D.nbRecue+' / '+D.nbAttendue+'':'');return lLibelle;}
case DonneesListe_ResultatsActualite.colonnes.classe:return!!D.libelleClasse?D.libelleClasse:'';case DonneesListe_ResultatsActualite.colonnes.reponse:{lDonnee=D.listeReponses.GetElementParNumero(aParams.declarationColonne.numeroQuestion);if(D.estCumul){let lPourcentageRecue=lDonnee.pourcentageRecue||Math.round(100*lDonnee.nbRecue/lDonnee.nbAttendue);let lTxtRecue=lPourcentageRecue+'%';if(this.avecNombreReponses){lTxtRecue+=' ('+lDonnee.nbRecue+')';}
return lTxtRecue;} else if(this.utilitaires.genreReponse.estGenreTextuelle(lDonnee.GetGenre())){return lDonnee.texteReponse;} else{return lDonnee.repondu;}}
case DonneesListe_ResultatsActualite.colonnes.choix:lDonnee=D.listeReponses.GetElementParNumero(aParams.declarationColonne.numeroQuestion);if(D.estCumul){let lTxtQuestion=(lDonnee.nbRecue?Math.round(100*lDonnee.valeurCumul[aParams.declarationColonne.numeroChoix+1 ]/lDonnee.nbRecue):'0')+'%';if(this.avecNombreReponses){lTxtQuestion+=' ('+(lDonnee.nbRecue?lDonnee.valeurCumul[aParams.declarationColonne.numeroChoix+1]:'0')+')';}
return lTxtQuestion;} else if(this.utilitaires.genreReponse.estGenreTextuelle(lDonnee.GetGenre())){return false;} else{return lDonnee.domaineReponse.GetValeur(aParams.declarationColonne.numeroChoix+1);}}}
GetTypeValeur(aParams){switch(aParams.declarationColonne.genreColonne){case DonneesListe_ResultatsActualite.colonnes.destinataires:return ObjetDonneesListe.ETypeCellule.Html;case DonneesListe_ResultatsActualite.colonnes.classe:return ObjetDonneesListe.ETypeCellule.Texte;case DonneesListe_ResultatsActualite.colonnes.reponse:{const lDonnee=aParams.article.listeReponses.GetElementParNumero(aParams.declarationColonne.numeroQuestion);if(aParams.article.estCumul||this.utilitaires.genreReponse.estGenreTextuelle(lDonnee.GetGenre())){return ObjetDonneesListe.ETypeCellule.Texte;} else{return ObjetDonneesListe.ETypeCellule.Coche;}}
default:if(aParams.article.estCumul){return ObjetDonneesListe.ETypeCellule.Texte;} else{return ObjetDonneesListe.ETypeCellule.Coche;}}}
getHintForce(aParams){switch(aParams.declarationColonne.genreColonne){case DonneesListe_ResultatsActualite.colonnes.destinataires:if(!aParams.article.estCumul){return aParams.article.GetLibelle();}
break;case DonneesListe_ResultatsActualite.colonnes.choix:if(!aParams.article.estCumul){const lDonnee=aParams.article.listeReponses.GetElementParNumero(aParams.declarationColonne.numeroQuestion);const lEstCoche=lDonnee.domaineReponse.GetValeur(aParams.declarationColonne.numeroChoix+1);if(lEstCoche&&!!aParams.declarationColonne.estChoixAutre&&!!lDonnee.texteReponse){return lDonnee.texteReponse;}}
return'';}}
getClass(aParams){const lClasses=[];if(aParams.article.estCumul){lClasses.push('Gras');}
if(aParams.idColonne!==DonneesListe_ResultatsActualite.colonnes.destinataires){lClasses.push(IE.estMobile?'AlignementDroit':'AlignementMilieu');}
return lClasses.join(' ');}
GetVisible(D){if(this.filtreRepondu){return D.estCumul?D.nbRecue>0:D.repondu;}
return true;}
AvecMenuContextuel(aParams){return!aParams.surFondListe&&(aParams.article.listeReponses.GetNbrElements()===1);}
initialisationObjetContextuel(aParametres){if(!aParametres.menuContextuel){return;}
if(aParametres.article.estCumul){aParametres.menuContextuel.AddCommande(DonneesListe_ResultatsActualite.genreCommande.graphique,GTraductions.getValeur('actualites.Edition.MenuGrapheCumul',[aParametres.article.GetLibelle()]),!aParametres.nonEditable);aParametres.menuContextuel.AddCommande(DonneesListe_ResultatsActualite.genreCommande.graphiqueTotal,GTraductions.getValeur('actualites.Edition.MenuGrapheTotal'),!aParametres.nonEditable);} else{aParametres.menuContextuel.AddCommande(DonneesListe_ResultatsActualite.genreCommande.graphiqueTotal,GTraductions.getValeur('actualites.Edition.MenuGrapheTotal'),!aParametres.nonEditable);}
aParametres.menuContextuel.SetDonnees();}
evenementMenuContextuel(aParametres){this.evenement.call(this.pere,aParametres.numeroMenu,aParametres.article);}
avecBordureDroite(){return this.utilitaires.genreReponse.estGenreAvecAR(this.genreActualite)?false:true;}}
DonneesListe_ResultatsActualite.genreCommande={graphique:0,graphiqueTotal:1,supprimerReponse:2};DonneesListe_ResultatsActualite.colonnes={destinataires:'destinataires',classe:'classe',reponse:'reponse',choix:'choix'};module.exports=DonneesListe_ResultatsActualite;},fn:"donneesliste_resultatsactualite.js"});;
IE.fModule({f:function(exports,require,module,global){const DonneesListe_ResultatsActualite=require('DonneesListe_ResultatsActualite.js');const GHtml=require('GHtml.js');const GUID=require('GUID.js');const DonneesListe_Simple=require('DonneesListe_Simple.js');const EGenreEvenementListe=require('Enumere_EvenementListe.js');const ZoneFenetre=require('IEZoneFenetre.js');const ObjetFenetre=require('ObjetFenetre.js');const ObjetHint=require('objethint.js');const Identite=require('ObjetIdentite.js');const ObjetListe=require('ObjetListe.js');const ObjetElement=require('ObjetElement.js');const GTraductions=require('ObjetTraduction.js');const ObjetListeElements=require('ObjetListeElements.js');const MoteurInfoSondage=require('MoteurInfoSondage.js').MoteurInfoSondage;class ObjetResultatsActualite extends Identite{constructor(...aParams){super(...aParams);this.idLibelleAnonyme=this.Nom+'_libelleAnonyme';this.idListeQuestions=this.Nom+'.listeQuestions';this.idListeResultats=this.Nom+'.listeResultats';this.idVisuQuestion=this.Nom+'.visuQuestion';this.classVisuQuestion=GUID.getClassCss();this.objetListeQuestions=new ObjetListe(this.idListeQuestions,null,this,this._eventListeQuestions);this.objetListeQuestions.setOptionsListe({colonnes:[{taille:100,titre:GTraductions.getValeur('actualites.Question')}],hauteurAdapteContenu:false,avecMultiSelection:true});this.listeResultats=new ObjetListe(this.idListeResultats,null,this,null);this.idFenetreGraph=this.Nom+'.objetFenetreGraph';this.objetFenetreGraph=new ObjetFenetre(this.idFenetreGraph,null,this);ZoneFenetre.ajouterFenetre(this.objetFenetreGraph.GetNom());this.objetFenetreGraph.setOptionsFenetre({modale:true,hauteur:400,hauteurMin:400,largeur:400,largeurMin:400,listeBoutons:[GTraductions.getValeur('Fermer')],avecRetaillage:true});this.objetFenetreGraph.Initialiser();this.filtreRepondu=false;this.avecNombreReponses=false;this._options={avecBarreTitre:true};}
getControleur(aInstance){return $.extend(true,super.getControleur(aInstance),{cbFiltreUniquementRepondus:{getValue:function(){return!!aInstance.filtreRepondu;},setValue:function(aValeur){aInstance.filtreRepondu=aValeur;aInstance.actualiserListe();}},cbAfficherNbReponses:{getValue:function(){return!!aInstance.avecNombreReponses;},setValue:function(aValeur){aInstance.avecNombreReponses=aValeur;aInstance.actualiserListe();}}});}
setOptions(aOptions){$.extend(this._options,aOptions);}
setUtilitaires(aUtilitaires){this.utilitaires=aUtilitaires;this.moteur=new MoteurInfoSondage(aUtilitaires);}
SetDonnees(aActualite){this.actualite=aActualite;_miseAJourLibelleAnonyme.bind(this)();if(this.actualite.avecResultats){$('#'+this.Nom.escapeJQ()+' > table').show();this.objetListeQuestions.SetDonnees(new DonneesListe_Simple(_getListeQuestionsConcernees.call(this,this.actualite),{avecMenuContextuel:false,avecMultiSelection:true}));this.objetListeQuestions.SelectionnerLigne({ligne:0,avecEvenement:true});} else{$('#'+this.Nom.escapeJQ()+' > table').hide();}}
initialiserListeReponses(aInstance){const lColonnes=[];lColonnes.push({id:DonneesListe_ResultatsActualite.colonnes.destinataires,genreColonne:DonneesListe_ResultatsActualite.colonnes.destinataires,taille:IE.estMobile?'100%':'25rem',titre:this._options.avecBarreTitre?GTraductions.getValeur('actualites.Edition.ColonneDest'):null});if(!IE.estMobile&&_avecColonneClasse.call(this)){lColonnes.push({id:DonneesListe_ResultatsActualite.colonnes.classe,genreColonne:DonneesListe_ResultatsActualite.colonnes.classe,taille:'10rem',titre:this._options.avecBarreTitre?GTraductions.getValeur('actualites.Classe'):null});}
const lAvecGenreReponse=(this.question.genreReponse!==undefined)&&(this.question.genreReponse!==null);let lTitre='';if(this.questionsSelectionnees.length>0){const lAvecMultiSelection=this.questionsSelectionnees.length>1;for(let i=0;i<this.questionsSelectionnees.length;i++){const lQuestion=this.questionsSelectionnees[i].article;if(lQuestion){const lFusionColonne=(lAvecMultiSelection)?{libelle:lQuestion.GetLibelle(),titleHtml:lQuestion.texte,avecFusionColonne:true}:'';if((lAvecGenreReponse&&this.utilitaires.genreReponse.estGenreAvecAR(lQuestion.genreReponse))||lQuestion.avecAR){lTitre=GTraductions.getValeur('actualites.Edition.ColonneARRecu');} else if(lAvecGenreReponse&&this.utilitaires.genreReponse.estGenreTextuelle(lQuestion.genreReponse)){lTitre=GTraductions.getValeur('actualites.Edition.ColonneReponse');} else if(lAvecGenreReponse&&(this.utilitaires.genreReponse.estGenreChoixUnique(lQuestion.genreReponse)||this.utilitaires.genreReponse.estGenreChoixMultiple(lQuestion.genreReponse))){lTitre=GTraductions.getValeur('actualites.Edition.ColonneRepondu');} else{}
let lColonneTitre=lAvecMultiSelection?[lFusionColonne,lTitre]:lTitre;lColonnes.push({id:DonneesListe_ResultatsActualite.colonnes.reponse+'_'+i,genreColonne:DonneesListe_ResultatsActualite.colonnes.reponse,numeroQuestion:lQuestion.GetNumero(),taille:'5rem',titre:this._options.avecBarreTitre?lColonneTitre:null});if(lAvecGenreReponse&&(this.utilitaires.genreReponse.estGenreChoixUnique(lQuestion.genreReponse)||this.utilitaires.genreReponse.estGenreChoixMultiple(lQuestion.genreReponse))){let j=0;const lInstance=this;lQuestion.listeChoix.parcourir(function(aChoix){lColonneTitre=lAvecMultiSelection?[lFusionColonne,aChoix.GetLibelle()]:aChoix.GetLibelle();lColonnes.push({id:DonneesListe_ResultatsActualite.colonnes.choix+'_'+aChoix.GetNumero(),numeroChoix:j,genreColonne:DonneesListe_ResultatsActualite.colonnes.choix,estChoixAutre:!!aChoix.estReponseLibre,numeroQuestion:lQuestion.GetNumero(),taille:'5rem',titre:lInstance._options.avecBarreTitre?lColonneTitre:null});j++;});}}}}
aInstance.setOptionsListe({colonnes:lColonnes,boutons:[{genre:ObjetListe.typeBouton.deployer}],nonEditable:false,avecCelluleEditableTriangle:false,scrollHorizontal:1});}
RecupererDonnees(){}
ConstruireAffichage(){const H=[];H.push('<table style="width:100%;height:100%; cellpadding="0" cellspacing="0"">');if(!IE.estMobile){H.push('<tr>');H.push('<td colspan="2" class="EspaceBas">','<ie-checkbox ie-model="cbFiltreUniquementRepondus">',GTraductions.getValeur('actualites.Edition.FiltreRepondu'),'</ie-checkbox>','<ie-checkbox ie-model="cbAfficherNbReponses" style="margin-left: 1.5rem;">',GTraductions.getValeur('actualites.Edition.AvecNombreRepondu'),'</ie-checkbox>','</td>');H.push('</tr>');H.push('<tr><td colspan="2"><div class="Texte10" style="height:12px;" id="',this.idLibelleAnonyme,'"></div></td></tr>');}
H.push('<tr>');H.push('<td class="AlignementHaut" style="height:100%;"><div id="',this.idListeQuestions,'" style="height:100%;"></div></td>');H.push('<td class="AlignementHaut" style="height:100%;width: 100%;">','<table style="width:100%;height:100%;" cellpadding="0" cellspacing="0">','<tr class="',this.classVisuQuestion,'"><td style="width: 100%;"><div id="',this.idVisuQuestion,'" class="Bordure MargeBas" style="margin-right:',GNavigateur.GetLargeurBarreDeScroll?GNavigateur.GetLargeurBarreDeScroll():10,'px; box-sizing: border-box;"></div></td></tr>','<tr><td style="height:100%;width: 100%;"><div id="',this.idListeResultats,'" style="height:100%;width:100%;"></div></td></tr>','</table>','</td>');H.push('</tr>');H.push('</table>');return H.join('');}
actualiserListe(){if(this.actualite&&this.actualite.estSondage&&this.questionsSelectionnees.length===1){$('.'+this.classVisuQuestion.escapeJQ()).show();} else{$('.'+this.classVisuQuestion.escapeJQ()).hide();}
this.initialiserListeReponses(this.listeResultats);if(this.actualite&&this.actualite.estSondage){const lHtml=[];lHtml.push('<div ie-scrollv ie-scrollreservation style="max-height: 250px;"><div class="Espace">');lHtml.push(this.moteur.composeComposanteInfoSondage({instance:this,actu:this.actualite,composante:this.question,indice:0,avecLibelleQuestion:false,estAffEditionActualite:true}));lHtml.push('</div></div>');GHtml.setHtml(this.idVisuQuestion,lHtml.join(''),{controleur:this.controleur});}
_visibiliteQuestions.call(this);this.listeResultats.SetDonnees(new DonneesListe_ResultatsActualite({donnees:_formatDonnees.call(this),pere:this,evenement:this.evenementMenuContextuelListe,genre:this.question.genreReponse,niveauMaxCumul:this.question.niveauMaxCumul,filtreRepondu:this.filtreRepondu,avecNombreReponses:this.avecNombreReponses},{genreReponse:this.utilitaires.genreReponse}));}
_eventListeQuestions(aParametres){if(aParametres.genreEvenement===EGenreEvenementListe.Selection){this.questionsSelectionnees=aParametres.instance.getTableauCellulesSelection();this.question=this.actualite.listeQuestions.GetElementParNumero(aParametres.article.GetNumero());this.actualiserListe();}}
evenementMenuContextuelListe(aCommande,aElement){if(aCommande===DonneesListe_ResultatsActualite.genreCommande.graphique||aCommande===DonneesListe_ResultatsActualite.genreCommande.graphiqueTotal){let lElement;if(aCommande===DonneesListe_ResultatsActualite.genreCommande.graphique){lElement=aElement;} else{lElement=new ObjetElement();lElement.valeurCumul=[];lElement.nbRecue=0;lElement.nbAttendue=0;for(let i=0;i<this.question.resultats.listeRepondant.GetNbrElements();i++){const lEle=this.question.resultats.listeRepondant.GetElement(i);if(lEle.estCumul&&!lEle.pere){lElement.nbAttendue+=lEle.nbAttendue;lElement.nbRecue+=lEle.nbRecue;for(let j=0;j<lEle.valeurCumul.length;j++){if(lElement.valeurCumul[j]){lElement.valeurCumul[j]+=lEle.valeurCumul[j];} else{lElement.valeurCumul[j]=lEle.valeurCumul[j];}}}}}
const lNbColonnes=(this.utilitaires.genreReponse.estGenreChoixUnique(this.question.genreReponse)||this.utilitaires.genreReponse.estGenreChoixMultiple(this.question.genreReponse)?this.question.listeChoix.GetNbrElements():1)+1;const lLargeurColonne=Math.floor(100/lNbColonnes)+'%';let lMaxAbscisse=lElement.nbAttendue;while(lMaxAbscisse%5!==0&&(lMaxAbscisse/5)%5!==0){lMaxAbscisse+=1;}
const lHtmlBarres=[],lHtmlAbscisses=[];if(this.utilitaires.genreReponse.estGenreChoixUnique(this.question.genreReponse)||this.utilitaires.genreReponse.estGenreChoixMultiple(this.question.genreReponse)){for(let i=0;i<this.question.listeChoix.GetNbrElements();i++){lHtmlAbscisses.push('<div style="width:'+lLargeurColonne+';overflow:hidden;white-space:nowrap;text-overflow:ellipsis;text-align:center;" class="Texte10 InlineBlock">'+this.question.listeChoix.GetElement(i).GetLibelle()+'</div>');lHtmlBarres.push('<div style="width:'+lLargeurColonne+';height:100%;position:relative;" class="Texte10 InlineBlock">','<div class="objetResultatsActualiteBarreGraph" data-libelle="',this.question.listeChoix.GetElement(i).GetLibelle(),'" data-valeur="',lElement.valeurCumul[i+1],'" data-hauteur="',Math.round(100*lElement.valeurCumul[i+1]/lMaxAbscisse),'" style="position:absolute;left:10%;right:10%;bottom:0;height:',Math.round(100*lElement.valeurCumul[i+1]/lMaxAbscisse),'%;background-color:#c8c8c8;"></div>','<div style="position:absolute;left:10%;right:10%;bottom:',(Math.round(100*lElement.valeurCumul[i+1]/lMaxAbscisse)+1),'%;text-align:center;">',lElement.valeurCumul[i+1],'</div>','</div>');}} else{lHtmlAbscisses.push('<div style="width:'+lLargeurColonne+';overflow:hidden;white-space:nowrap;text-overflow:ellipsis;text-align:center;" class="Texte10 InlineBlock">'+GTraductions.getValeur('actualites.Edition.ColonneRepondu')+'</div>');lHtmlBarres.push('<div style="width:'+lLargeurColonne+';height:100%;position:relative;" class="Texte10 InlineBlock">','<div class="objetResultatsActualiteBarreGraph" data-libelle="',GTraductions.getValeur('actualites.Edition.ColonneRepondu'),'" data-valeur="',lElement.nbRecue,'" data-hauteur="',Math.round(100*lElement.nbRecue/lMaxAbscisse),'" style="position:absolute;left:10%;right:10%;bottom:0;height:',Math.round(100*lElement.nbRecue/lMaxAbscisse),'%;background-color:#c8c8c8;"></div>','<div style="position:absolute;left:10%;right:10%;bottom:',(Math.round(100*lElement.nbRecue/lMaxAbscisse)+1),'%;text-align:center;">',lElement.nbRecue,'</div>','</div>');}
lHtmlAbscisses.push('<div style="width:'+lLargeurColonne+';overflow:hidden;white-space:nowrap;text-overflow:ellipsis;text-align:center;" class="Texte10 InlineBlock">'+GTraductions.getValeur('actualites.Edition.ColonneNonRepondu')+'</div>');lHtmlBarres.push('<div style="width:'+lLargeurColonne+';height:100%;position:relative;" class="Texte10 InlineBlock">','<div class="objetResultatsActualiteBarreGraph" data-libelle="',GTraductions.getValeur('actualites.Edition.ColonneNonRepondu'),'" data-valeur="',(lElement.nbAttendue-lElement.nbRecue),'" data-hauteur="',Math.round(100*(lElement.nbAttendue-lElement.nbRecue)/lMaxAbscisse),'" style="position:absolute;left:10%;right:10%;bottom:0;height:',Math.round(100*(lElement.nbAttendue-lElement.nbRecue)/lMaxAbscisse),'%;background-color:#c8c8c8;"></div>','<div style="position:absolute;left:10%;right:10%;bottom:',(Math.round(100*(lElement.nbAttendue-lElement.nbRecue)/lMaxAbscisse)+1),'%;text-align:center;">',(lElement.nbAttendue-lElement.nbRecue),'</div>','</div>');const lHtml=['<div style="position:relative;width:100%;height:95%;margin-top:5%;">','<div style="position:absolute;top:0;left:20px;right:0;bottom:20px;background-color:#fff;">','<div style="position:absolute;top:0;left:0;right:0;height:20%;border-top:#000 1px dashed;"></div>','<div style="position:absolute;top:20%;left:0;right:0;height:20%;border-top:#000 1px dashed;"></div>','<div style="position:absolute;top:40%;left:0;right:0;height:20%;border-top:#000 1px dashed;"></div>','<div style="position:absolute;top:60%;left:0;right:0;height:20%;border-top:#000 1px dashed;"></div>','<div style="position:absolute;top:80%;left:0;right:0;height:20%;border-top:#000 1px dashed;"></div>',lHtmlBarres.join(''),'</div>','<div class="Texte10" style="position:absolute;top:0;left:0;width:19px;border-right:#000 1px solid;bottom:20px;">','<div style="position:absolute;top:0;right:1px;text-align:right;"><div style="position:relative;top:-5px;">',(lMaxAbscisse),'</div></div>','<div style="position:absolute;top:20%;right:1px;text-align:right;"><div style="position:relative;top:-5px;">',(lMaxAbscisse*0.8),'</div></div>','<div style="position:absolute;top:40%;right:1px;text-align:right;"><div style="position:relative;top:-5px;">',(lMaxAbscisse*0.6),'</div></div>','<div style="position:absolute;top:60%;right:1px;text-align:right;"><div style="position:relative;top:-5px;">',(lMaxAbscisse*0.4),'</div></div>','<div style="position:absolute;top:80%;right:1px;text-align:right;"><div style="position:relative;top:-5px;">',(lMaxAbscisse*0.2),'</div></div>','<div style="position:absolute;top:100%;right:1px;text-align:right;"><div style="position:relative;top:-5px;">',(lMaxAbscisse*0),'</div></div>','</div>','<div style="position:absolute;height:19px;border-top:#000 1px solid;left:20px;right:0;bottom:0;">',lHtmlAbscisses.join(''),'</div>','</div>'];if(this.objetFenetreGraph.EnAffichage){this.objetFenetreGraph.Fermer();}
this.objetFenetreGraph.Afficher(lHtml.join(''));$('.objetResultatsActualiteBarreGraph').height('0%').on('mousemove',function(){ObjetHint.start('<strong>'+$(this).attr('data-libelle')+'</strong><br />'+$(this).attr('data-valeur'),{sansDelai:true});$(this).css({border:'#000 1px solid',borderBottom:'0px'});}).on('mouseleave',function(){ObjetHint.stop();$(this).css({border:'0px'});}).each(function(){$(this).delay(250).animate({height:$(this).attr('data-hauteur')+'%'},250);});let lTitreFenetre;if(aCommande===DonneesListe_ResultatsActualite.genreCommande.graphique){lTitreFenetre=GTraductions.getValeur('actualites.Edition.TitreGrapheCumul',[lElement.GetLibelle()]);} else{lTitreFenetre=GTraductions.getValeur('actualites.Edition.TitreGrapheTotal');}
this.objetFenetreGraph.setOptionsFenetre({titre:lTitreFenetre});}}}
function _getListeQuestionsConcernees(aActualite){let lListeQuestions=new ObjetListeElements();if(!!aActualite&&!!aActualite.listeQuestions){lListeQuestions=aActualite.listeQuestions.getListeElements(function(D){if(this.utilitaires.genreReponse.estGenreSansReponse(D.genreReponse)){return false;}
return true;}.bind(this));}
return lListeQuestions;}
function _visibiliteQuestions(){const lListeQuestionsActu=_getListeQuestionsConcernees.call(this,this.actualite);if(lListeQuestionsActu.GetNbrElementsExistes()>1){$('#'+this.idListeQuestions.escapeJQ()).show();this.objetListeQuestions.Actualiser(true);} else{$('#'+this.idListeQuestions.escapeJQ()).hide();}}
function _miseAJourLibelleAnonyme(){let lLibelle='';if(this.actualite.estSondage){lLibelle=this.actualite.reponseAnonyme?GTraductions.getValeur('actualites.InfoAnonyme'):GTraductions.getValeur('actualites.InfoNominatif');}
GHtml.setHtml(this.idLibelleAnonyme,lLibelle);if(this.actualite.estSondage){$('#'+this.idLibelleAnonyme.escapeJQ()).show();} else{$('#'+this.idLibelleAnonyme.escapeJQ()).hide();}}
function _avecColonneClasse(){let lAvecClasse=false;for(let i=0;i<this.questionsSelectionnees.length;i++){const lQuestion=this.questionsSelectionnees[i];if(!!lQuestion.article&&!!lQuestion.article.resultats&&!!lQuestion.article.resultats.listeRepondant){lQuestion.article.resultats.listeRepondant.parcourir(function(aRepondant){if(!!aRepondant.libelleClasse&&aRepondant.libelleClasse!==''){lAvecClasse=true;}});}}
return lAvecClasse;}
function _formatDonnees(){const lListe=new ObjetListeElements();if(this.questionsSelectionnees.length===0){return lListe;}
for(let i=0;i<this.questionsSelectionnees.length;i++){const lQuestion=this.questionsSelectionnees[i];if(!!lQuestion&&!!lQuestion.article.resultats){lQuestion.article.resultats.listeRepondant.parcourir(function(aRepondant){const lReponse=new ObjetElement(lQuestion.article.GetLibelle(),lQuestion.article.GetNumero(),lQuestion.article.genreReponse);lReponse.nbRecue=aRepondant.nbRecue;lReponse.nbAttendue=aRepondant.nbAttendue;lReponse.pourcentageRecue=aRepondant.pourcentageRecue;lReponse.texteReponse=aRepondant.texteReponse;lReponse.repondu=aRepondant.repondu;lReponse.domaineReponse=aRepondant.domaineReponse;lReponse.valeurCumul=aRepondant.valeurCumul;const lElement=lListe.GetElement(lListe.getIndiceElementParFiltre(function(aElement){return aElement.NumeroArticleLigne===aRepondant.NumeroArticleLigne;}));if(!!lElement){lElement.listeReponses.add(lReponse);} else{aRepondant.listeReponses=new ObjetListeElements();aRepondant.listeReponses.add(lReponse);lListe.add(aRepondant);}});}}
return lListe;}
module.exports=ObjetResultatsActualite;},fn:"objetresultatsactualite.js"});;
IE.fModule({f:function(exports,require,module,global){const ObjetResultatsActualite=require('ObjetResultatsActualite.js');const ObjetFenetre=require('ObjetFenetre.js');const TypeBoutonFenetreResultatActualite={DiffuserResultats:0,Fermer:1};class ObjetFenetre_ResultatsActualite extends ObjetFenetre{constructor(...aParams){super(...aParams);}
ConstruireInstances(){this.identResultats=this.Add(ObjetResultatsActualite,null,_initResultats.bind(this));}
setUtilitaires(aUtilitaires){this.utilitaires=aUtilitaires;}
ComposeContenu(){const H=[];H.push('<div style="height:100%;" id="',this.GetInstance(this.identResultats).GetNom(),'"></div>');return H.join('');}
SetDonnees(aParam){this.Afficher();this.GetInstance(this.identResultats).SetDonnees(aParam.actualite);}}
function _initResultats(aInstance){aInstance.setUtilitaires(this.utilitaires);aInstance.setOptions({avecBarreTitre:!IE.estMobile});}
module.exports={ObjetFenetre_ResultatsActualite:ObjetFenetre_ResultatsActualite,TypeBoutonFenetreResultatActualite:TypeBoutonFenetreResultatActualite};},fn:"objetfenetre_resultatsactualite.js"});;
IE.fModule({f:function(exports,require,module,global){const{ObjetRequeteConsultation}=require('ObjetRequeteJSON.js');const Requetes=require('CollectionRequetes.js');const ObjetTri=require('ObjetTri.js');const GCache=require('Cache.js');class ObjetRequeteDonneesEditionInformation extends ObjetRequeteConsultation{constructor(...aParams){super(...aParams);}
lancerRequete(aParam){this.JSON={};this.init=aParam.init||false;this.JSON.init=this.init;if(this.init){this.JSON.avecCategories=!GCache||!GCache.general.existeDonnee('listeCategories');this.JSON.avecListeIndividusPossiblesPartage=!GCache||!GCache.general.existeDonnee('listeIndividusPossiblesPartage');this.JSON.tailleMaxTitre=!GCache||!GCache.general.existeDonnee('tailleMaxTitre');}
this.avecPublic=aParam.avecPublic||false;this.JSON.avecPublic=this.avecPublic;if(aParam.avecPublic){aParam.listePublic.setSerialisateurJSON({methodeSerialisation:_serialiser_Public.bind(this),ignorerEtatsElements:true});this.JSON.listePublic=aParam.listePublic;}
this.avecCours=aParam.avecCours||false;if(aParam.avecCours){this.JSON.date=aParam.date;this.JSON.cours=aParam.cours;}
this.JSON.avecCours=this.avecCours;if(aParam.eleve&&aParam.punition){this.pourPunition=true;this.JSON.eleve=aParam.eleve.toJSON();this.JSON.punition=aParam.punition.toJSON();}
if(aParam.incident){this.pourPunition=true;this.JSON.incident=aParam.incident.toJSON();}
return this.appelAsynchrone();}
actionApresRequete(){const lResult={};if(this.init){_actionInitApresRequete.bind(this)(lResult);}
if(this.avecPublic||this.avecCours){_actionPublicApresRequete.bind(this)(lResult);}
if(this.pourPunition){_actionPunitionApresRequete.call(this,lResult);}
this.callbackReussite.appel(lResult);}}
Requetes.inscrire('DonneesEditionInformation',ObjetRequeteDonneesEditionInformation);function _serialiser_Public(aIndividu,aJSON){aJSON.N=aIndividu.GetNumero();aJSON.G=aIndividu.GetGenre();aJSON.E=undefined;aJSON.L=undefined;}
function _actionInitApresRequete(aResult){let lListeCategories;if(GCache&&GCache.general.existeDonnee('listeCategories')){lListeCategories=GCache.general.getDonnee('listeCategories');} else{lListeCategories=this.JSONReponse.listeCategories;lListeCategories.setTri([ObjetTri.init('Genre'),ObjetTri.init('Libelle')]);lListeCategories.trier();if(GCache){GCache.general.setDonnee('listeCategories',lListeCategories);}}
aResult.listeCategories=lListeCategories;let lListeIndividusPossibles;if(GCache&&GCache.general.existeDonnee('listeIndividusPossiblesPartage')){lListeIndividusPossibles=GCache.general.getDonnee('listeIndividusPossiblesPartage');} else{lListeIndividusPossibles=this.JSONReponse.listeIndividusPossiblesPartage;if(GCache){GCache.general.setDonnee('listeIndividusPossiblesPartage',lListeIndividusPossibles);}}
aResult.listeIndividusPossiblesPartage=lListeIndividusPossibles;let lTailleMaxTitre;if(GCache&&GCache.general.existeDonnee('tailleMaxTitre')){lTailleMaxTitre=GCache.general.getDonnee('tailleMaxTitre');} else{lTailleMaxTitre=this.JSONReponse.tailleMaxTitre;if(GCache){GCache.general.setDonnee('tailleMaxTitre',lTailleMaxTitre);}}
aResult.tailleMaxTitre=lTailleMaxTitre;}
function _actionPublicApresRequete(aResult){aResult.nombreResponsablesPreferentiel=this.JSONReponse.nombreResponsablesPreferentiel;aResult.nombreResponsablesSecondaires=this.JSONReponse.nombreResponsablesSecondaires;aResult.nombreProfsPrincipaux=this.JSONReponse.nombreProfsPrincipaux;aResult.nombreTuteurs=this.JSONReponse.nombreTuteurs;if(this.avecCours){aResult.listeEleves=this.JSONReponse.listeEleves;aResult.equipe=this.JSONReponse.equipe;}}
function _actionPunitionApresRequete(aResult){aResult.titre=this.JSONReponse.titre;aResult.texte=this.JSONReponse.texte;aResult.categorie=this.JSONReponse.categorie;aResult.listePublic=this.JSONReponse.equipe;}
module.exports=ObjetRequeteDonneesEditionInformation;},fn:"objetrequetedonneeseditioninformation.js"});;
IE.fModule({f:function(exports,require,module,global){require('DeclarationTinyInit.js');const lTinyInit=require('tinyInit.js');module.exports.GTinyInit=lTinyInit?lTinyInit.GTinyInit:{};},fn:"declarationtinyinitpn.js"});;
IE.fModule({f:function(exports,require,module,global){const EGenreCommandeMenu=require('Enumere_CommandeMenu.js');const EGenreEtat=require('Enumere_Etat.js');const ObjetDonneesListe=require('ObjetDonneesListe.js');const GTraductions=require('ObjetTraduction.js');const ObjetTri=require('ObjetTri.js');function _modifierRangChoix(aChoix,aDecalage){const lOldRang=aChoix.rang;const lNewRang=lOldRang+aDecalage;let lIndice=this.Donnees.getIndiceElementParFiltre(function(aElement){return aElement.Existe()&&(aElement.rang===lNewRang);});if(lIndice> -1){const lElmRangConflit=this.Donnees.GetElement(lIndice);lElmRangConflit.rang=lOldRang;lElmRangConflit.SetEtat(EGenreEtat.Modification);}
aChoix.rang=lNewRang;aChoix.SetEtat(EGenreEtat.Modification);this.Donnees.trier();const lNumero=aChoix.GetNumero();lIndice=this.Donnees.getIndiceElementParFiltre(function(aElement){return aElement.Existe()&&(aElement.GetNumero()===lNumero);});return lIndice;}
class DonneesListe_ActualitesChoix extends ObjetDonneesListe{constructor(aDonnees,aCallbackMenuContextuel){super(aDonnees);this.callbackMenuContextuel=aCallbackMenuContextuel;this.creerIndexUnique('Libelle');this.setOptions({avecEvnt_Selection:true,avecEvnt_ApresCreation:true,avecEvnt_ApresEdition:true,avecEvnt_ApresSuppression:true,avecEtatSaisie:false,avecLigneDroppable:true,avecLigneDraggable:true});}
getTri(aColonneDeTri,aGenreTri){const lTris=[];lTris.push(ObjetTri.init('rang',aGenreTri));return lTris;}
SurCreation(D,V){D.SetLibelle(V[0]);D.rang=this.Donnees.GetNbrElementsExistes()+1;let lChoixReponseLibre;this.Donnees.parcourir((aChoix) =>{if(aChoix&&aChoix.Existe()&&aChoix.estReponseLibre){lChoixReponseLibre=aChoix;return false;}});if(lChoixReponseLibre){D.SetEtat(EGenreEtat.Creation);_modifierRangChoix.call(this,D,-1);}}
SurEdition(aParams,I,D,V){aParams.article.SetLibelle(V);}
SurSuppression(D){let lRang=1;for(let i=0;i<this.Donnees.GetNbrElements();i++){const lChoix=this.Donnees.GetElement(i);if(lChoix.Existe()&&(lChoix.GetNumero()!==D.GetNumero())){if(lChoix.rang!==lRang){lChoix.rang=lRang;lChoix.SetEtat(EGenreEtat.Modification);}
lRang++;} else{lChoix.rang=0;}}
D.rang=0;this.Donnees.trier();D.SetEtat(EGenreEtat.Suppression);}
GetVisible(D){if(D&&D.Existe()&&D.estReponseLibre){return false;}
return true;}
initialisationObjetContextuel(aParametres){if(!aParametres.menuContextuel){return;}
aParametres.menuContextuel.AddCommande(EGenreCommandeMenu.Edition,GTraductions.getValeur('liste.modifier'),this.AvecEdition(aParametres.colonne,aParametres.article)&&!aParametres.nonEditable);aParametres.menuContextuel.AddSeparateur();aParametres.menuContextuel.AddCommande(DonneesListe_ActualitesChoix.genreAction.monter,GTraductions.getValeur('actualites.choix.monter'),aParametres.article.rang>1);aParametres.menuContextuel.AddCommande(DonneesListe_ActualitesChoix.genreAction.descendre,GTraductions.getValeur('actualites.choix.descendre'),aParametres.article.rang<this.Donnees.GetNbrElementsExistes());aParametres.menuContextuel.AddSeparateur();aParametres.menuContextuel.AddCommande(EGenreCommandeMenu.Suppression,GTraductions.getValeur('liste.supprimer'),this.AvecSuppression(aParametres.article)&&!aParametres.nonEditable);aParametres.menuContextuel.SetDonnees();}
evenementMenuContextuel(aParametres){let lIndice;switch(aParametres.numeroMenu){case DonneesListe_ActualitesChoix.genreAction.monter:if(aParametres.article.rang>1){lIndice=_modifierRangChoix.call(this,aParametres.article,-1);this.callbackMenuContextuel(aParametres.numeroMenu,lIndice);}
break;case DonneesListe_ActualitesChoix.genreAction.descendre:if(aParametres.article.rang<this.Donnees.GetNbrElementsExistes()){lIndice=_modifierRangChoix.call(this,aParametres.article,1);this.callbackMenuContextuel(aParametres.numeroMenu,lIndice);}
break;default:return false;}}
surDeplacementElementSurLigne(aParamsLigneDestination,aParamsSource){_modifierRangChoix.call(this,aParamsSource.article,aParamsLigneDestination.ligne-aParamsSource.ligne);}}
DonneesListe_ActualitesChoix.colonnes={libelle:'DLChoix_libelle'};DonneesListe_ActualitesChoix.genreAction={monter:1,descendre:2};module.exports=DonneesListe_ActualitesChoix;},fn:"donneesliste_actualiteschoix.js"});;
IE.fModule({f:function(exports,require,module,global){const EGenreCommandeMenu=require('Enumere_CommandeMenu.js');const EGenreEtat=require('Enumere_Etat.js');const ObjetDonneesListe=require('ObjetDonneesListe.js');const GTraductions=require('ObjetTraduction.js');const ObjetTri=require('ObjetTri.js');const MoteurInfoSondage=require('MoteurInfoSondage.js').MoteurInfoSondage;function _getNouveauLibelleQuestion(aQuestion,aRang){return this.moteurInfoSond.getLibelleAffichageComposanteQuest({composante:aQuestion,rang:aRang});}
function _modifierRangQuestion(aQuestion,aDecalage){const lOldRang=aQuestion.rang;const lNewRang=lOldRang+aDecalage;let lElmRangConflit;let lNumero;let lIndice=this.Donnees.getIndiceElementParFiltre(function(aElement){return aElement.Existe()&&(aElement.rang===lNewRang);});if(lIndice> -1){lElmRangConflit=this.Donnees.GetElement(lIndice);lElmRangConflit.rang=lOldRang;lElmRangConflit.SetEtat(EGenreEtat.Modification);}
aQuestion.rang=lNewRang;aQuestion.SetEtat(EGenreEtat.Modification);this.Donnees.trier();lNumero=aQuestion.GetNumero();lIndice=this.Donnees.getIndiceElementParFiltre(function(aElement){return aElement.Existe()&&(aElement.GetNumero()===lNumero);});this.reordonnerQuestions();return lIndice;}
class DonneesListe_ActualitesQuestion extends ObjetDonneesListe{constructor(aDonnees,aCallbackMenuContextuel,aUtilitaires){super(aDonnees);this.callbackMenuContextuel=aCallbackMenuContextuel;this.creerIndexUnique('Libelle');this.utilitaires=aUtilitaires;this.moteurInfoSond=new MoteurInfoSondage(this.utilitaires);this.setOptions({avecEdition:true,avecEvnt_Selection:true,avecEvnt_Creation:true,avecEvnt_ApresSuppression:true,avecEtatSaisie:false,avecLigneDroppable:true,avecLigneDraggable:true});this.reordonnerQuestions();}
AvecSuppression(){return this.Donnees.GetNbrElementsExistes()>1;}
GetValeur(I,D,aParams){switch(aParams.idColonne){case DonneesListe_ActualitesQuestion.colonnes.libelle:return!!aParams.article?(aParams.surEdition?aParams.article.titre:aParams.article.GetLibelle()):'';}
return'';}
SurEdition(aParams,I,D,V){switch(aParams.idColonne){case DonneesListe_ActualitesQuestion.colonnes.libelle:if(aParams.article.titre!==V){aParams.article.titre=V;aParams.article.SetEtat(EGenreEtat.Modification);aParams.article.Libelle=_getNouveauLibelleQuestion.call(this,aParams.article,aParams.article.indice);}}}
autoriserChaineVideSurEdition(){return true;}
initialisationObjetContextuel(aParametres){if(!aParametres.menuContextuel){return;}
aParametres.menuContextuel.AddCommande(DonneesListe_ActualitesQuestion.genreAction.monter,GTraductions.getValeur('actualites.choix.monter'),aParametres.article.rang>1);aParametres.menuContextuel.AddCommande(DonneesListe_ActualitesQuestion.genreAction.descendre,GTraductions.getValeur('actualites.choix.descendre'),aParametres.article.rang<this.Donnees.GetNbrElementsExistes());aParametres.menuContextuel.AddSeparateur();let lStrCommandeDupliquer=aParametres.article&&this.utilitaires.genreReponse.estGenreSansReponse(aParametres.article.genreReponse)?GTraductions.getValeur('actualites.Edition.DupliquerTxt'):GTraductions.getValeur('actualites.Edition.DupliquerQu');aParametres.menuContextuel.AddCommande(DonneesListe_ActualitesQuestion.genreAction.dupliquer,lStrCommandeDupliquer,true);aParametres.menuContextuel.AddCommande(EGenreCommandeMenu.Suppression,GTraductions.getValeur('liste.supprimer'),this.AvecSuppression(aParametres.article)&&!aParametres.nonEditable);aParametres.menuContextuel.SetDonnees();}
evenementMenuContextuel(aParametres){let lIndice;switch(aParametres.numeroMenu){case DonneesListe_ActualitesQuestion.genreAction.monter:if(aParametres.article.rang>1){lIndice=_modifierRangQuestion.call(this,aParametres.article,-1);this.callbackMenuContextuel(aParametres.numeroMenu,lIndice);}
break;case DonneesListe_ActualitesQuestion.genreAction.descendre:if(aParametres.article.rang<this.Donnees.GetNbrElementsExistes()){lIndice=_modifierRangQuestion.call(this,aParametres.article,1);this.callbackMenuContextuel(aParametres.numeroMenu,lIndice);}
break;case DonneesListe_ActualitesQuestion.genreAction.dupliquer:if(this.callbackMenuContextuel(aParametres.numeroMenu)){var lQu=this.moteurInfoSond.dupliquerQuestion(aParametres.article);lQu.rang=this.Donnees.GetNbrElementsExistes()+1;this.Donnees.AddElement(lQu);this.reordonnerQuestions();}
break;default:return false;}}
reordonnerQuestions(){let lRangQ=0;let lRangT=0;this.Donnees.trier();this.Donnees.parcourir(function(aElement){if(this.utilitaires.genreReponse.estGenreSansReponse(aElement.genreReponse)){lRangT++;aElement.SetLibelle(_getNouveauLibelleQuestion.call(this,aElement,lRangT));aElement.indice=lRangT;} else{lRangQ++;aElement.SetLibelle(_getNouveauLibelleQuestion.call(this,aElement,lRangQ));aElement.indice=lRangQ;}}.bind(this));}
getTri(aColonneDeTri,aGenreTri){const lTris=[];lTris.push(ObjetTri.init('rang',aGenreTri));return lTris;}
surDeplacementElementSurLigne(aParamsLigneDestination,aParamsSource){_modifierRangQuestion.call(this,aParamsSource.article,aParamsLigneDestination.ligne-aParamsSource.ligne);}}
DonneesListe_ActualitesQuestion.colonnes={libelle:'DLQuestions_libelle'};DonneesListe_ActualitesQuestion.genreAction={monter:1,descendre:2,dupliquer:3};module.exports=DonneesListe_ActualitesQuestion;},fn:"donneesliste_actualitesquestion.js"});;
IE.fModule({f:function(exports,require,module,global){const EGenreDocumentJoint=require('Enumere_DocumentJoint.js');require('IEHtml.SelecFile.js');const Identite=require('ObjetIdentite.js');const TUtilitaireUrl=require('UtilitaireUrl.js');const ToucheClavier=require('ToucheClavier.js');const tag=require('tag.js');class ObjetModulePJ extends Identite{constructor(...aParams){super(...aParams);this.id_trombone=this.Nom+'_trombone';this.idOrigPJ=true;this.id_libellesPJ=this.Nom+'_libellesPJ';this.genreCommande={menuContext:0,click:1};this._options={genrePJ:EGenreDocumentJoint.Fichier,forcerEvenementSurClickIcon:false,IEModelChipsPJ:null,controleur:null,title:'',maxWidthLibelle:0,addFiles:null,getDisabledFiles:null,libelleSelecteur:'',masquerListeChips:false,input:{}};}
setOptions(aOptions){$.extend(this._options,aOptions);return this;}
getControleur(aInstance){return $.extend(true,super.getControleur(this),{getNodeConteneur:function(){$(this.node).on('contextmenu',function(event){event.stopImmediatePropagation();event.preventDefault();aInstance.callback.appel({action:aInstance.genreCommande.menuContext});return false;});},nodeTrombone:function(){$(this.node).on('focus',{couleur:GCouleur.texte},function(event){$(this).css('box-shadow','0 0 5px -1px '+event.data.couleur);}).on('blur',{couleur:GCouleur.texte},function(){$(this).css('box-shadow','');});if((aInstance._options.genrePJ===EGenreDocumentJoint.Url)||aInstance._options.forcerEvenementSurClickIcon){$(this.node).addClass('AvecMain').on('click keyup',function(event){if(event.type==='keyup'&&event.which!==ToucheClavier.RetourChariot&&event.which!==ToucheClavier.Espace){return;}
event.stopImmediatePropagation();event.preventDefault();aInstance.callback.appel({action:aInstance.genreCommande.click,id:aInstance.getNomTrombone()});return false;});}},getClassNodeTrombone:function(){return aInstance._options.libelleSelecteur&&aInstance.Actif?' LienAccueil':'';},trombone:{getOptionsSelecFile:function(){return aInstance._options.getOptionsSelecFile();},addFiles:function(aParams){if(aInstance._options.addFiles){aInstance._options.addFiles(aParams);this.controleur.$refreshSelf();}},getDisabled:function(){return aInstance._options.genrePJ===EGenreDocumentJoint.Url||
!aInstance.Actif||
!!(aInstance._options.getDisabledFiles&&aInstance._options.getDisabledFiles());}}});}
setGenrePJ(aGenrePJ){this._options.genrePJ=aGenrePJ;}
ConstruireAffichage(){if(!this._avecDonnees){return'';}
const H=[];const lImage=tag('div',tag('ie-btnicon',{class:'bt-activable '+(this._options.genrePJ===EGenreDocumentJoint.Url?'icon_globe':'icon_piece_jointe')}));H.push('<div class="NoWrap" ie-node="getNodeConteneur">');H.push('<div id="',this.getNomTrombone(),'" ie-node="nodeTrombone" ie-class="getClassNodeTrombone" class="InlineBlock AlignementHaut"',' style="width:auto;" tabIndex="0" title="',this._options.title,'"',(this._options.genrePJ!==EGenreDocumentJoint.Url&&!this._options.forcerEvenementSurClickIcon?' ie-model="trombone" ie-selecfile ':''),'>',(this._options.libelleSelecteur?tag('div',{style:'display:flex; align-items: center; height'},lImage,tag('div',{class:'PetitEspaceGauche'},this._options.libelleSelecteur)):lImage),'</div>');if(this.idOrigPJ&&!this._options.masquerListeChips){H.push('<div id="',this.id_libellesPJ,'" class="InlineBlock AlignementHaut EspaceGauche EspaceDroit"></div>');}
H.push('</div>');return H.join('');}
setDonnees(aParam){this._avecDonnees=true;this.genreRessourcePJ=aParam.genreRessourcePJ;this.Afficher();if(aParam.idListePJ){this.setIdPourLibellesPJ(aParam.idListePJ);}
if(aParam.listePJ){this.setLibellesPJ(aParam.listePJ);}}
getNomTrombone(){return this.id_trombone;}
setLibellesPJ(aListePJ){if(aListePJ&&!this._options.masquerListeChips){$('#'+this.id_libellesPJ.escapeJQ()).IEHtml(TUtilitaireUrl.construireListeUrls(aListePJ,{genreFiltre:this._options.genrePJ,genreRessource:this.genreRessourcePJ,IEModelChips:this.Actif?this._options.IEModelChipsPJ:'',maxWidth:this._options.maxWidthLibelle}),{controleur:this._options.controleur});}}
setIdPourLibellesPJ(aIdListePJ){this.idOrigPJ=false;this.id_libellesPJ=aIdListePJ;}
SetActif(AActif){this.Actif=AActif;this.$refreshSelf();}}
module.exports=ObjetModulePJ;},fn:"objetmodulepj.js"});;
IE.fModule({f:function(exports,require,module,global){const ObjetFenetre=require('ObjetFenetre.js');const tag=require('tag.js');require('ObjetFenetre_ActionContextuelle.css');class ObjetFenetre_ActionContextuelle extends ObjetFenetre{constructor(...aParams){super(...aParams);this.setOptionsFenetre({modale:false,largeur:380,hauteur:200,fermerFenetreSurClicHorsFenetre:true});}
getControleur(aInstance){return $.extend(true,super.getControleur(aInstance),{action:{event:function(aIndice){if(!!aInstance.actions[aIndice].event){if(!aInstance.actions[aIndice].selecFile){aInstance.Fermer();aInstance.actions[aIndice].event.apply();}} else{}},getOptionsSelecFile:function(aIndice){return aInstance.actions[aIndice].optionsSelecFile;},addFiles:function(aIndice,aParams){aInstance.Fermer();aInstance.actions[aIndice].event.call(aInstance,aParams);}}});}
SetDonnees(aTabActions){this.actions=aTabActions;this.Afficher(this.ComposeContenu());}
ComposeContenu(){return this.actions?'<div class="fenetre-actionContextuelle"><div class="btas-wrapper cnt-'+this.actions.length+'">'+_construireActions.call(this)+'</div></div>':'';}}
function _construireActions(){const H=[];if(!!this.actions&&this.actions.length){this.actions.forEach((aActions,i) =>{if(!!aActions.icon){H.push(tag('div',{class:'bta-contain'},tag('ie-btnicon',{class:'bt-activable bt-big '+aActions.icon+(!!aActions.class?' '+aActions.class:''),title:aActions.libelle||'','ie-model':'action('+i+')','ie-selecFile':!!aActions.selecFile}),aActions.libelle?tag('label',aActions.libelle):''));}});}
return H.join('');}
module.exports=ObjetFenetre_ActionContextuelle;},fn:"objetfenetre_actioncontextuelle.js"});;
IE.fModule({f:function(exports,require,module,global){const MethodesObjet=require('MethodesObjet.js');const EGenreAction=require('Enumere_Action.js');const EGenreBoiteMessage=require('Enumere_BoiteMessage.js');const EGenreDocumentJoint=require('Enumere_DocumentJoint.js');const EGenreEtat=require('Enumere_Etat.js');const ObjetAbstraitInterface=require('ObjetInterface.js');const ObjetListeElements=require('ObjetListeElements.js');const ObjetMenuContextuel=require('ObjetMenuContextuel.js');const GTraductions=require('ObjetTraduction.js');const ObjetModulePJ=require('ObjetModulePJ.js');const ObjetFenetre=require('ObjetFenetre.js');const ObjetFenetre_ActionContextuelle=require('ObjetFenetre_ActionContextuelle.js');const UtilitaireSelecFile=require('UtilitaireSelecFile.js');class ObjetSelecteurPJCP extends ObjetAbstraitInterface{constructor(...aParams){super(...aParams);this.AvecCadre=false;this.genreMenuContextuel={ajouterPJNouvelle:0,ajouterPJExistante:1,supprimerPJ:2};this._initialiserOptions();}
_initialiserOptions(){this._options={genrePJ:EGenreDocumentJoint.Fichier,genreRessourcePJ:-1,title:'',maxFiles:0,maxSize:1048576,avecAjoutExistante:false,interdireDoublonsLibelle:true,avecCmdAjoutNouvelle:true,idLibellePJ:'',avecEtatSaisie:true,avecBoutonSupp:false,avecMenuSuppressionPJ:!IE.estMobile,maxWidthLibelle:0,libelleSelecteur:'',avecInActifVisible:false,ouvrirFenetreChoixTypesAjout:false,ouvrirFenetreGestionnaireSurClick:false,avecMenuContextuel:true,masquerListeChips:false,fenetrePieceJointe:{avecBoutonActualiser:true},avecCallbackAjouterPJs:false,multiple:false,acceptDragDrop:true,avecTransformationFlux:true,optionsCloud:{avecCloud:false,callbackChoixFichierParFichier:null,callbackChoixFichierFinal:null}};}
setOptions(aOptions){$.extend(this._options,aOptions);if(this._options.maxFiles===1){this._options.avecCmdAjoutNouvelle=false;}}
supprimerPJ(aElementPJ){_supprimerPJ.call(this,aElementPJ);return this;}
ConstruireInstances(){this.identPJ=this.Add(ObjetModulePJ,this.evntModulePJ,this.initModulePJ);}
getControleur(aInstance){return $.extend(true,super.getControleur(this),{chipsPieceJointe:{eventBtn:function(aIndice){const lElement=aInstance.listePJ?aInstance.listePJ.GetElement(aIndice):null;if(lElement){_supprimerPJ.call(aInstance,lElement);}},getDisabled:function(aIndice){const lElement=aInstance.listePJ?aInstance.listePJ.GetElement(aIndice):null;return!aInstance.Actif||!lElement;}}});}
ComposeContenu(){const H=[];H.push('<div class="EspaceHaut" id="',this.GetNomInstance(this.identPJ),'"></div>');return H.join('');}
SetActif(AActif){this.Actif=AActif;if(this.GetInstance(this.identPJ)){this.GetInstance(this.identPJ).SetActif(AActif);}}
SetDonnees(aParam){this.avecInputFile=this._options.genrePJ!==EGenreDocumentJoint.Url;this.listePJTotale=aParam.listeTotale;this.listePJ=aParam.listePJ;this.idContextFocus=aParam.idContextFocus;const lParam={listePJ:this.listePJ,genreRessourcePJ:this._options.genreRessourcePJ};if(aParam.idListePJ){lParam.idListePJ=aParam.idListePJ;}
this.GetInstance(this.identPJ).setOptions({genrePJ:this._options.genrePJ,addFiles:_addFiles.bind(this),getDisabledFiles:_getDisabledFiles.bind(this),getOptionsSelecFile:_getOptionsSelecFile.bind(this)}).setDonnees(lParam);}
setTailleMaxPJ(aTailleMax){this._options.maxSize=aTailleMax;}
controlerFichierSelectionne(aParam){if(!UtilitaireSelecFile.estFichierCloudPartage(aParam)&&this._isLibelleFichierExiste(aParam.GetLibelle())){return{succes:false,msg:GTraductions.getValeur('inputFile.msgEchecLibelleFichierAvecInfo')};}
return{succes:true,msg:''};}
_isLibelleFichierExiste(aNomFichier){if(!this._options.interdireDoublonsLibelle){return false;}
const lNbrElts=this.listePJTotale.GetNbrElements();for(let I=0;I<lNbrElts;I++){let lElt=this.listePJTotale.GetElement(I);const lLibelle=lElt.GetLibelle();if(lElt.Existe()&&lLibelle&&aNomFichier&&lLibelle.toLowerCase&&aNomFichier.toLowerCase&&lLibelle.trim().toLowerCase()===aNomFichier.trim().toLowerCase()){return true;}}
return false;}
initModulePJ(aInstance){if(this._options.idLibellePJ){aInstance.setIdPourLibellesPJ(this._options.idLibellePJ);}
aInstance.setOptions({genrePJ:this._options.genrePJ,forcerEvenementSurClickIcon:this._options.ouvrirFenetreGestionnaireSurClick||!!this._options.ouvrirFenetreChoixTypesAjout,IEModelChipsPJ:this._options.avecBoutonSupp?'chipsPieceJointe':'',controleur:this._options.avecBoutonSupp?this.controleur:null,title:this._options.title,maxWidthLibelle:this._options.maxWidthLibelle,libelleSelecteur:this._options.libelleSelecteur,masquerListeChips:this._options.masquerListeChips});}
initEditionPJ(aInstance){if(aInstance.setOptions){aInstance.setOptions(this._options.fenetrePieceJointe);}}
addFilesDeSelecFile(aParams){return _addFiles.call(this,aParams);}
evntModulePJ(aParam){if(!this.Actif){return;}
switch(aParam.action){case this.GetInstance(this.identPJ).genreCommande.menuContext:if(this._options.avecMenuContextuel){_afficherMenuContextuel.call(this);}
break;case this.GetInstance(this.identPJ).genreCommande.click:if(this._options.avecAjoutExistante&&this._options.ouvrirFenetreChoixTypesAjout){_ouvrirFenetreChoixTypesAjout.call(this,this._options.optionsCloud,aParam.id);} else if(this._options.avecAjoutExistante&&((this._options.genrePJ===EGenreDocumentJoint.Url)||this._options.ouvrirFenetreGestionnaireSurClick)){_ouvrirFenetrePJ.call(this);}
break;default:;break;}}
evntEditionPJ(){if(!this.Actif){return;}
const alisteDocumentsJoints=this.listePJTotale;if(!alisteDocumentsJoints){return;}
let lDoc;for(let I=0;I<alisteDocumentsJoints.GetNbrElements();I++){const lDocumentJoint=this.listePJ.GetElementParNumero(alisteDocumentsJoints.GetNumero(I));const lActif=alisteDocumentsJoints.GetElement(I).Actif&&alisteDocumentsJoints.Existe(I);if(lDocumentJoint){if(!lActif){lDocumentJoint.SetEtat(EGenreEtat.Suppression);} else{lDoc=alisteDocumentsJoints.GetElement(I);if(lDoc.Etat===EGenreEtat.Modification){lDocumentJoint.Libelle=lDoc.Libelle;}}} else{if(lActif){lDoc=alisteDocumentsJoints.GetElement(I);if(lDoc.Fichier){lDoc.idFichier=lDoc.Fichier.idFichier;lDoc.Libelle=lDoc.Fichier.Libelle;lDoc.nomOriginal=lDoc.Fichier.nomOriginal;lDoc.file=lDoc.Fichier.file;}
let lEltFichier=MethodesObjet.dupliquer(lDoc);lEltFichier.file=lDoc.file;lEltFichier.SetEtat(EGenreEtat.Creation);this.listePJ.AddElement(lEltFichier);}}}
this.GetInstance(this.identPJ).setLibellesPJ(this.listePJ);this.callback.appel({evnt:ObjetSelecteurPJCP.genreEvnt.editionPJ});}
setIdPourLibellesPJ(aIdListePJ){this.GetInstance(this.identPJ).setIdPourLibellesPJ(aIdListePJ);}
ouvrirFenetreChoixListeCloud(){}}
ObjetSelecteurPJCP.genreEvnt={selectionPJ:1,suppressionPJ:2,editionPJ:3,ajouterPJs:4};function _getOptionsSelecFile(){return{title:this._options.title,maxFiles:this._options.maxFiles,maxSize:this._options.maxSize,genrePJ:this._options.genrePJ,multiple:this._options.multiple,acceptDragDrop:this._options.acceptDragDrop,avecTransformationFlux:this._options.avecTransformationFlux};}
function _getDisabledFiles(){return!this.Actif||(this._options.maxFiles!==0&&this.listePJ.GetNbrElementsExistes()>=this._options.maxFiles);}
function _addFiles(aParams){const lListeFichiersClouds=UtilitaireSelecFile.extraireListeFichiersCloudsPartage(aParams.listeFichiers);let lParam;const lFiles=[];aParams.listeFichiers.parcourir(function(aFichier){const lControle=this.controlerFichierSelectionne(aFichier);lParam=null;if(lControle.succes){this.listePJTotale.AddElement(aFichier);this.listePJ.AddElement(aFichier);lParam={evnt:ObjetSelecteurPJCP.genreEvnt.selectionPJ,fichier:aFichier};lFiles.push(aFichier);if(this._options.avecEtatSaisie){this.SetEtatSaisie(true);}} else{GApplication.getMessage().afficher({type:EGenreBoiteMessage.Information,message:lControle.msg});}
this.GetInstance(this.identPJ).setLibellesPJ(this.listePJ);if(lParam){this.callback.appel(lParam);}}.bind(this));if(lFiles.length>0&&this._options.avecCallbackAjouterPJs){this.callback.appel({evnt:ObjetSelecteurPJCP.genreEvnt.ajouterPJs,tabFichiers:lFiles});}
if(lListeFichiersClouds.GetNbrElements()>0){if(this._options.optionsCloud&&this._options.optionsCloud.callbackChoixFichierParFichier&&this._options.optionsCloud.callbackChoixFichierFinal){lListeFichiersClouds.parcourir((aFichier) =>{this._options.optionsCloud.callbackChoixFichierParFichier(aFichier);});this._options.optionsCloud.callbackChoixFichierFinal();} else{}}}
function avecCloudDisponibles(){return GEtatUtilisateur.listeCloud&&GEtatUtilisateur.listeCloud.GetNbrElements()>0;}
function _ouvrirFenetreChoixTypesAjout(aParametresCloud={},aId){const lFenetreAction=ObjetFenetre.creerInstance(ObjetFenetre_ActionContextuelle,{pere:this,initialiser:function(aInstance){aInstance.setOptionsFenetre({idPositionnement:aId});}});const lThis=this;const lTabActions=[];lTabActions.push({libelle:GTraductions.getValeur('CahierDeTexte.piecesJointes.FichierParmiUtilises'),icon:'icon_file_alt',event(){_ouvrirFenetrePJ.call(lThis);},class:'bg-util-vert-claire'});const lAvecCloud=avecCloudDisponibles()&&aParametresCloud.avecCloud;lTabActions.push({libelle:IE.estMobile?GTraductions.getValeur('CahierDeTexte.piecesJointes.FichierDepuisDocument'):GTraductions.getValeur('CahierDeTexte.piecesJointes.FichierDepuisDisque'),icon:'icon_folder_open',selecFile:true,optionsSelecFile:{maxSize:this._options.maxSize,maxFiles:this._options.maxFiles,multiple:(this._options.maxFiles!==1),avecTransformationFlux:this._options.avecTransformationFlux,avecTransformationFlux_versCloud:lAvecCloud},event(aParamsInput){if(aParamsInput){_addFiles.call(lThis,aParamsInput);}},class:'bg-util-marron-claire'});if(lAvecCloud){lTabActions.push({libelle:GTraductions.getValeur('CahierDeTexte.piecesJointes.FichierDepuisCloud'),icon:'icon_cloud',event(){lThis.ouvrirFenetreChoixListeCloud(aParametresCloud.callbackChoixFichierParFichier,aParametresCloud.callbackChoixFichierFinal);},class:'bg-util-marron-claire'});}
lFenetreAction.SetDonnees(lTabActions);}
function _ouvrirFenetrePJ(){this.GetInstance(this.identEditionPJ).afficherFenetrePJ({listePJTot:this.listePJTotale,listePJContexte:this.listePJ,genreFenetrePJ:this._options.genrePJ,genrePJ:this._options.genrePJ,genreRessourcePJ:this._options.genreRessourcePJ,avecFiltre:{date:true},avecEtatSaisie:this._options.avecEtatSaisie,avecInActifVisible:this._options.avecInActifVisible,optionsSelecFile:_getOptionsSelecFile.call(this)});}
function _afficherMenuContextuel(){ObjetMenuContextuel.afficher({pere:this,evenement:function(){},initCommandes:function(aInstance){if(this._options.avecCmdAjoutNouvelle&&this.avecInputFile){aInstance.addSelecFile(this._options.genrePJ===EGenreDocumentJoint.Url?GTraductions.getValeur('selecteurPJ.ajoutNouveauLien'):GTraductions.getValeur('selecteurPJ.ajoutNouvellePJ'),{getOptionsSelecFile:_getOptionsSelecFile.bind(this),addFiles:_addFiles.bind(this)},!_getDisabledFiles.call(this));aInstance.avecSeparateurSurSuivant();}
if(this._options.avecAjoutExistante){aInstance.add(this._options.genrePJ===EGenreDocumentJoint.Url?GTraductions.getValeur('selecteurPJ.ajoutLienExistant'):GTraductions.getValeur('selecteurPJ.ajoutPJExistante'),true,function(){_ouvrirFenetrePJ.call(this);}.bind(this));}
if(this._options.avecMenuSuppressionPJ){if(this._options.avecCmdAjoutNouvelle||this._options.avecAjoutExistante){aInstance.avecSeparateurSurSuivant();}
const lListePJ=new ObjetListeElements();if(this.listePJ&&this.listePJ.GetNbrElementsExistes()>0){this.listePJ.parcourir(function(aElement){if(aElement.Existe()&&(aElement.GetGenre()===undefined||aElement.GetGenre()===null||aElement.GetGenre()===this._options.genrePJ)){lListePJ.AddElement(aElement);}}.bind(this));}
if(lListePJ.GetNbrElements()>0){aInstance.addSousMenu(GTraductions.getValeur('selecteurPJ.supprimerPJ'),function(aInstanceSousMenu){lListePJ.parcourir(function(aElement){aInstanceSousMenu.add(aElement.GetLibelle(),aElement.actif,function(){_supprimerPJ.call(this,aElement);}.bind(this),{image:aElement.image,largeurImage:aElement.largeurImage});}.bind(this));}.bind(this));}}}});}
function _supprimerPJ(aElementASupprimer){if(!this.Actif||!aElementASupprimer){return;}
const message='<div style="word-break: break-all;">'+(this._options.genrePJ===EGenreDocumentJoint.Url?GTraductions.getValeur('selecteurPJ.msgConfirmLien',[aElementASupprimer.GetLibelle()]):GTraductions.getValeur('selecteurPJ.msgConfirmPJ',[aElementASupprimer.GetLibelle()]))+'</div>';GApplication.getMessage().afficher({type:EGenreBoiteMessage.Confirmation,message:message}).then((aAccepte) =>{if(this.existeInstance(this.identEditionPJ)){this.GetInstance(this.identEditionPJ).Fermer();}
if(aAccepte!==EGenreAction.Valider){return;}
aElementASupprimer.SetEtat(EGenreEtat.Suppression);if(this._options.avecEtatSaisie){this.SetEtatSaisie(true);}
this.GetInstance(this.identPJ).setLibellesPJ(this.listePJ);this.callback.appel({evnt:ObjetSelecteurPJCP.genreEvnt.suppressionPJ});this.$refresh();});}
module.exports=ObjetSelecteurPJCP;},fn:"objetselecteurpjcp.js"});;
IE.fModule({f:function(exports,require,module,global){const MethodesObjet=require('MethodesObjet.js');const GChaine=require('GChaine.js');const GPosition=require('GPosition.js');const EGenreDocumentJoint=require('Enumere_DocumentJoint.js');const EGenreEtat=require('Enumere_Etat.js');const EGenreEvenementListe=require('Enumere_EvenementListe.js');require('IEHtml.SelecFile.js');const ObjetDonneesListe=require('ObjetDonneesListe.js');const ObjetFenetre=require('ObjetFenetre.js');const ObjetListe=require('ObjetListe.js');const _ObjetListe=require('_ObjetListe.js');const ObjetListeElements=require('ObjetListeElements.js');const GTraductions=require('ObjetTraduction.js');const ObjetTri=require('ObjetTri.js');const ObjetElement=require('ObjetElement.js');const EGenreBoiteMessage=require('Enumere_BoiteMessage.js');class DonneesListe_PieceJointeCP extends ObjetDonneesListe{constructor(aDonnees,aGenre,aGenreRessourceDocJoint,aAvecInActifVisible,aMultiSelection,aAvecGestionLibelleSurLiens){super(aDonnees);this.Genre=aGenre;this.genreRessourceDocJoint=aGenreRessourceDocJoint;this.avecInActifVisible=aAvecInActifVisible;this.avecGestionLibelleSurLiens=aAvecGestionLibelleSurLiens;this.creerIndexUnique('Libelle');this.setOptions({avecMultiSelection:aMultiSelection===false?false:true});}
getTri(){return[ObjetTri.init('Libelle')];}
GetVisible(D){let lEstDuGenre=true;if(D.estDuGenre!==undefined){lEstDuGenre=D.estDuGenre;}
return(D.GetGenre()===this.Genre)&&lEstDuGenre&&(D.Actif||this.avecInActifVisible)&&D.existeNumero();}
GetCouleurCellule(){return ObjetDonneesListe.ECouleurCellule.Blanc;}
initArticle(D,V){if(this.avecGestionLibelleSurLiens){D.Libelle=V[2];D.url=GChaine.verifierURLHttp(V[1]);D.Genre=this.Genre;D.descriptif='';D.Fichier=V[-1];} else{D.Libelle=V[1];D.Genre=this.Genre;D.descriptif='';D.Fichier=V[-1];}}
SurCreation(D,V){this.initArticle(D,V);if(D.Fichier){D.Fichier.Libelle=V[1];D.Fichier.SetEtat(EGenreEtat.Creation);this.options.listeFichiers.AddElement(D.Fichier);}
D.Actif=true;D.nbRelations=1;D.Editable=true;D.Date=this.DateCours;}
avecSelecFile(aParams){return aParams.surCreation&&this.Genre===EGenreDocumentJoint.Fichier;}
getOptionsSelecFile(){return Object.assign({multiple:true},this.options.optionsSelecFile);}
GetValeurParDefaut(aParams){return(aParams.colonne===1)&&(this.Genre===EGenreDocumentJoint.Url)?'http://':'';}
SurEdition(aParams,I,D,V){if(this.avecGestionLibelleSurLiens){switch(I){case 0:{D.Actif=V;break;}
case 1:{D.url=V;break;}
case 2:{D.Libelle=V;break;}}} else{switch(I){case 0:{D.Actif=V;break;}
case 1:{if(this.Genre===EGenreDocumentJoint.Fichier){const lExtension=GChaine.extraireExtensionFichier(D.Libelle);V=V+'.'+lExtension;}
D.Libelle=V;if(D.Fichier){D.Fichier.Libelle=V;}
break;}
case 2:{if(this.Genre===EGenreDocumentJoint.Url){D.descriptif=V;}}}}}
autoriserChaineVideSurEdition(aParams){return this.avecGestionLibelleSurLiens&&aParams.colonne===2;}
AvecEvenement_ApresEdition(){return true;}
AvecEvenement_ApresCreation(){return true;}
AvecEdition(I){return(I<2||this.Genre===EGenreDocumentJoint.Url)&&I!==3;}
EnModification(I){return I>0;}
GetValeur(I,D,aParams){if(this.avecGestionLibelleSurLiens){switch(I){case 0:return D.Actif;case 1:return D.url;case 2:return D.Libelle?D.Libelle:'';case 3:return D.ListeThemes&&D.ListeThemes.GetNbrElements()?D.ListeThemes.getTableauLibelles().join(', '):'';default:return'';}} else{switch(I){case 0:return D.Actif;case 1:return aParams.surEdition&&(this.Genre===EGenreDocumentJoint.Fichier)?GChaine.extraireNomFichier(D.Libelle):D.Libelle;case 2:{const lValeur=[];if(this.Genre===EGenreDocumentJoint.Fichier){if(D.Etat!==EGenreEtat.Creation){const lURL=GChaine.creerUrlBruteLienExterne(D,{genreRessource:this.genreRessourceDocJoint});lValeur.push('<a href="',lURL,'" target="_blank">');lValeur.push('<i class="icon_download_alt" style="',(IE.estMobile?'font-size:1.6rem':'font-size:1.8rem'),'"></i>');lValeur.push('</a>');}} else{if(!!D.descriptif){lValeur.push(D.descriptif);}}
return lValeur.join('');}
case 3:return D.ListeThemes&&D.ListeThemes.GetNbrElements()?D.ListeThemes.getTableauLibelles().join(', '):'';}}
return'';}
GetTypeValeur(aParams){switch(aParams.colonne){case 0:return ObjetDonneesListe.ETypeCellule.Coche;case 1:return ObjetDonneesListe.ETypeCellule.Texte;case 2:return this.Genre===EGenreDocumentJoint.Fichier?ObjetDonneesListe.ETypeCellule.Html:ObjetDonneesListe.ETypeCellule.ZoneTexte;case 3:return ObjetDonneesListe.ETypeCellule.Texte;}
return'';}
initialisationObjetContextuel(aParametres){aParametres.avecCreation=false;super.initialisationObjetContextuel(aParametres);}}
class ObjetFenetre_PieceJointeCP extends ObjetFenetre{constructor(...aParams){super(...aParams);this.ListeFichiers=new ObjetListeElements();this.parametres={};this.listeBoutons=[GTraductions.getValeur('Fermer')];this.listeBoutonsModeLien=[GTraductions.getValeur('Valider')];this.setOptionsFenetre({hauteur:500,largeur:450,listeBoutons:this.listeBoutons,avecBoutonActualiser:true,avecColonneInfoBulle:true,avecBoutonSupprimer:true});}
getControleur(aInstance){return $.extend(true,super.getControleur(this),{getDisplayMAJ:function(){return aInstance.Genre===EGenreDocumentJoint.Fichier&&aInstance.optionsFenetre.avecBoutonActualiser;},btnMaj:{event:function(){aInstance._ouvrirSelecteur();},getDisabled:function(){return aInstance.GetInstance(aInstance.IdentListe).getListeElementsSelection().GetNbrElements()!==1;},getOptionsSelecFile:function(){aInstance._ouvrirSelecteur=this.getOpenSelecFile();return aInstance.parametres.optionsSelecFile;},addFiles:function(aParams){if(aParams.eltFichier){_selecFile.call(aInstance,aParams.eltFichier);}}},btnSupp:{event:function(){aInstance.GetInstance(aInstance.IdentListe).SurSuppression();},getDisabled:function(){return aInstance.GetInstance(aInstance.IdentListe).getListeElementsSelection().GetNbrElements()===0;}}});}
ConstruireInstances(){this.IdentListe=this.Add(ObjetListe,this.EvenementSurListe,this.InitialiserListe);}
avecGestionLibelleSurLiens(){return false;}
InitialiserListe(AInstance){const lColonnes=[];let lColonnesCachees=[];let lListeCreations=1;if(this.avecGestionLibelleSurLiens()){lColonnes.push({taille:20,titre:{classeCssImage:'Image_CocheVerte as-icon'}},{taille:'100%',titre:{libelle:GTraductions.getValeur('selecteurPJ.siteInternet')}},{taille:160,titre:{libelle:GTraductions.getValeur('selecteurPJ.nomDocument')}});if(this.parametres.avecThemes){lColonnes.push({taille:80,titre:{libelle:GTraductions.getValeur('Themes')}});}} else{lColonnes.push({taille:20},{taille:'100%'});if(this.Genre===EGenreDocumentJoint.Fichier){lColonnes.push({taille:20});} else if((this.optionsFenetre.avecColonneInfoBulle)||(this.avecGestionLibelleSurLiens())){lColonnes.push({taille:200});}
if(this.parametres.avecThemes){lColonnes.push({taille:80});}}
if(this.avecGestionLibelleSurLiens()){lListeCreations=[1];}
if(this.parametres.modeLien===true){lListeCreations=[1];lColonnesCachees=[0];}
AInstance.setOptionsListe({nonEditable:false,avecCelluleEditableTriangle:false,colonnes:lColonnes,listeCreations:lListeCreations,avecLigneCreation:true,boutons:this.optionsFenetre.avecBoutonSupprimer?[{genre:_ObjetListe.typeBouton.supprimer}]:[],colonnesCachees:lColonnesCachees},true);}
getLien(){let lLien='';const lListeElement=this.GetInstance(this.IdentListe).getListeElementsSelection();if(lListeElement.GetNbrElements()===1){lLien=GChaine.creerUrlBruteLienExterne(lListeElement.GetElement(0));}
return lLien;}
_setDocumentsJointsActifs(aListePJTotal,aListePJContexte){if(aListePJTotal&&aListePJContexte){aListePJTotal.parcourir((aPJDeListeTotale) =>{let lExisteDansContexte=false;if(aListePJContexte){lExisteDansContexte=!!aListePJContexte.GetElementParNumero(aPJDeListeTotale.GetNumero());}
aPJDeListeTotale.SetActif(lExisteDansContexte);});}}
afficherFenetrePJ(aParam){this.listePJContexte=aParam.listePJContexte;this._setDocumentsJointsActifs(aParam.listePJTot,aParam.listePJContexte);this.SetGenre(aParam.genreFenetrePJ);this.SetDonnees({listePiecesJointes:aParam.listePJTot,genre:aParam.genrePJ,genreRessourceDocJoint:aParam.genreRessourcePJ,avecInActifVisible:aParam.avecInActifVisible,avecEtatSaisie:aParam.avecEtatSaisie,optionsSelecFile:Object.assign(aParam.optionsSelecFile,{avecTransformationFlux_versCloud:false}),modeLien:aParam.modeLien,surValiderAvantFermer:aParam.surValiderAvantFermer,validationAuto:aParam.validationAuto,contenuCourant:aParam.contenuCourant,tafCourant:aParam.tafCourant,avecThemes:aParam.avecThemes});}
ajouterPiecesJointesAvecAppelCallback(aListeNouveauxFichiers,aGenreDocJoint,aListePJTotale,aListePJContexte,aAvecCallback=true){if(aListeNouveauxFichiers){let lControleAjoutDoc;if(aGenreDocJoint===EGenreDocumentJoint.Url){lControleAjoutDoc={succes:true};} else{lControleAjoutDoc=this.controlerFichiersSelectionnes(aListeNouveauxFichiers,aListePJTotale);}
if(lControleAjoutDoc.succes){this._setDocumentsJointsActifs(aListePJTotale,aListePJContexte);aListeNouveauxFichiers.parcourir((aNouveauFichier) =>{this._ajouterPieceJointeAvecAppelCallback(aNouveauFichier,aGenreDocJoint,aListePJTotale);});if(aAvecCallback){this.callback.appel();}} else{GApplication.getMessage().afficher({type:EGenreBoiteMessage.Information,message:lControleAjoutDoc.msg});}}}
_ajouterPieceJointeAvecAppelCallback(aEltFichier,aGenreDocJoint,aListePJTotale){this.ListeFichiers.AddElement(aEltFichier);aEltFichier.SetEtat(EGenreEtat.Modification);const lNouveauDocJoint=new ObjetElement(aEltFichier.GetLibelle());lNouveauDocJoint.Genre=aGenreDocJoint;lNouveauDocJoint.url=aEltFichier.url||lNouveauDocJoint.GetLibelle();lNouveauDocJoint.Fichier=aEltFichier;lNouveauDocJoint.idFichier=aEltFichier.idFichier;lNouveauDocJoint.nomOriginal=aEltFichier.nomOriginal;lNouveauDocJoint.file=aEltFichier.file;lNouveauDocJoint.SetEtat(EGenreEtat.Modification);aListePJTotale.AddElement(lNouveauDocJoint);}
controlerFichiersSelectionnes(aListeFichiersAControler,aListePJTotale){const lResultControle={succes:true,msg:''};if(aListeFichiersAControler&&aListeFichiersAControler.GetNbrElements()>0){aListeFichiersAControler.parcourir((aFichierAControler) =>{if(this._isLibelleFichierExiste(aListePJTotale,aFichierAControler.GetLibelle())){lResultControle.succes=false;lResultControle.msg=GTraductions.getValeur('inputFile.msgEchecLibelleFichierAvecInfo');}
if(!lResultControle.succes){return false;}});}
return lResultControle;}
_isLibelleFichierExiste(aListeFichiers,aNomFichier){let lExisteFichier=false;if(aListeFichiers&&aListeFichiers.GetNbrElements()>0&&aNomFichier){aListeFichiers.parcourir((aFichier) =>{if(aFichier.Existe()){const lLibelleFichier=aFichier.GetLibelle();if(lLibelleFichier&&lLibelleFichier.toLowerCase&&aNomFichier.toLowerCase){if(lLibelleFichier.trim().toLowerCase()===aNomFichier.trim().toLowerCase()){lExisteFichier=true;return false;}}}});}
return lExisteFichier;}
SetDonnees(aParametres){this.parametres={listePiecesJointes:new ObjetListeElements(),genre:EGenreDocumentJoint.Fichier,genreRessourceDocJoint:null,avecInActifVisible:false,avecEtatSaisie:true,optionsSelecFile:null,modeLien:false,validationAuto:null,contenuCourant:null,tafCourant:null,avecThemes:false};$.extend(this.parametres,aParametres)
;this.ListePiecesJointes=this.parametres.listePiecesJointes;this.Genre=this.parametres.genre;this.avecEtatSaisie=this.parametres.avecEtatSaisie;if(this.avecGestionLibelleSurLiens()){GPosition.setWidth(this.IdContenu,560);} else{GPosition.setWidth(this.IdContenu,this.optionsFenetre.largeur);}
const lOptionsFenetre={listeBoutons:this.parametres.modeLien?this.listeBoutonsModeLien:this.listeBoutons,surValiderAvantFermer:this.parametres.surValiderAvantFermer,titre:this.optionsFenetre.avecTitre?(this.Genre===EGenreDocumentJoint.Url?GTraductions.getValeur('selecteurPJ.siteInternet'):GTraductions.getValeur('selecteurPJ.nomDocument')):''};this.setOptionsFenetre(lOptionsFenetre);this.Afficher();this.surFixerTaille();this.GetInstance(this.IdentListe).effacer();this.InitialiserListe(this.GetInstance(this.IdentListe));this.objPJListe=this._getDonneesListe();this.SetDonnees_Liste();this.$refreshSelf();}
_getDonneesListe(){return new DonneesListe_PieceJointeCP(this.ListePiecesJointes,this.Genre,this.parametres.genreRessourceDocJoint,this.parametres.avecInActifVisible,this.parametres.modeLien).setOptions({avecEtatSaisie:this.parametres.avecEtatSaisie,optionsSelecFile:this.parametres.optionsSelecFile,listeFichiers:this.ListeFichiers,avecMultiSelection:this.parametres.modeLien});}
Reset(){this.ListeFichiers=new ObjetListeElements();}
ComposeContenu(){const T=[];T.push('<div id="',this.Nom+'_parent','" style="height:100%">');T.push('<table width="100%" height="100%" border="0" cellpadding="0" cellspacing="0">');T.push('<tr><td id="'+this.GetNomInstance(this.IdentListe)+'" height="100%"></td></tr>');T.push('</table>');T.push('</div>');return T.join('');}
ComposeBas(){const T=[];T.push(`<div id="${this.idZoneBoutonApercu}" class="compose-bas flex-contain flex-center justify-end">`);T.push(`<div ie-display="getDisplayMAJ" class="m-right-l">`);T.push(IE.estMobile?`<ie-btnicon ie-model="btnMaj" class="icon_refresh avecFond i-medium" ie-selecfile title="${GTraductions.getValeur('selecteurPJ.majPJ')}"></ie-btnicon>`:`<ie-bouton ie-model="btnMaj" ie-selecfile>${GTraductions.getValeur('selecteurPJ.majPJ')}</ie-bouton>`);T.push(`</div>`);T.push(IE.estMobile?`<ie-btnicon ie-model="btnSupp" class="icon_trash avecFond i-medium" title="${GTraductions.getValeur('selecteurPJ.supprimerPJ')}"></ie-btnicon>`:`<ie-bouton ie-model="btnSupp">${GTraductions.getValeur('selecteurPJ.supprimerPJ')}</ie-bouton>`);T.push(`</div>`);return T.join('');}
actualiserDonneesListe(aParam){this.ListePiecesJointes=this.parametres.listePiecesJointes=aParam.listePiecesJointes;this.objPJListe=this._getDonneesListe();if(this.objPJListe){this.GetInstance(this.IdentListe).SetDonnees(this.objPJListe);}}
SetDonnees_Liste(){if(this.objPJListe){this.GetInstance(this.IdentListe).SetDonnees(this.objPJListe);}}
EvenementSurListe(aParametres,AGenreEvenementListe,I){if(AGenreEvenementListe===EGenreEvenementListe.ApresEdition){if((I===1)&&this.listePJContexte&&aParametres.article){const lPJ=this.listePJContexte.GetElementParNumero(aParametres.article.GetNumero());if(lPJ){lPJ.SetEtat(EGenreEtat.Modification);}}}
if(AGenreEvenementListe===EGenreEvenementListe.ApresEdition||AGenreEvenementListe===EGenreEvenementListe.ApresCreation){if(!!this.parametres.validationAuto&&this.ListePiecesJointes.existeElementPourValidation()){this.parametres.validationAuto();}}}
surFixerTaille(){GPosition.declencherResize(this.GetNomInstance(this.IdentListe));super.surFixerTaille();GPosition.declencherResize(this.GetNomInstance(this.IdentListe));}}
function _selecFile(aFichier){this.ListeFichiers.AddElement(aFichier);const lPJSelectionne=this.GetInstance(this.IdentListe).getListeElementsSelection().GetElement(0);if(!lPJSelectionne){return;}
aFichier.SetNumero(lPJSelectionne.GetNumero());aFichier.SetLibelle(lPJSelectionne.GetLibelle());aFichier.SetEtat(EGenreEtat.Modification);lPJSelectionne.Fichier=aFichier;lPJSelectionne.idFichier=aFichier.idFichier;lPJSelectionne.Libelle=aFichier.Libelle;lPJSelectionne.nomOriginal=aFichier.nomOriginal;lPJSelectionne.file=aFichier.file;lPJSelectionne.SetEtat(EGenreEtat.Modification);if(this.avecEtatSaisie){this.SetEtatSaisie(true);}}
module.exports={DonneesListe_PieceJointeCP,ObjetFenetre_PieceJointeCP};},fn:"objetfenetre_piecejointecp.js"});;
IE.fModule({f:function(exports,require,module,global){const ObjetTri=require('ObjetTri.js');const EGenreRessource=require('Enumere_Ressource.js');const ObjetDonneesListe=require('ObjetDonneesListe.js');const DonneesListe_PieceJointeCP=require('ObjetFenetre_PieceJointeCP.js').DonneesListe_PieceJointeCP;const GTraductions=require('ObjetTraduction.js');const GChaine=require('GChaine.js');const UtilitaireSelecFile=require('UtilitaireSelecFile.js');class DonneesListe_PieceJointe extends DonneesListe_PieceJointeCP{constructor(aDonnees,aAvecEtatSaisie,aGenre,aGenreRessourceDocJoint,aMultiSelection,aAvecGestionLibelleSurLiens){super(aDonnees,aGenre,aGenreRessourceDocJoint,false,aMultiSelection,aAvecGestionLibelleSurLiens);this.avecEtatSaisie=aAvecEtatSaisie;this.PourMemeMatiere=false;this.PourMemeClasseEtGroupe=false;this.erreurURL='erreur_URLInexistante';}
SetDonnees(aAvecFiltre,aPourMemeMatiere,aPourMemeClasseEtGroupe,aDateDeb,aDateFin,aDateCours){this.avecFiltre=aAvecFiltre;this.PourMemeMatiere=aPourMemeMatiere;this.PourMemeClasseEtGroupe=aPourMemeClasseEtGroupe;this.DateDeb=aDateDeb;this.DateFin=aDateFin;this.DateCours=aDateCours;}
getTri(){return[ObjetTri.init('Libelle')];}
GetVisible(D){const lEstDansDate=(!D.Date||((D.Date>=this.DateDeb)&&(D.Date<=this.DateFin)));let lEstDuGenre=true;if(D.estDuGenre!==undefined){lEstDuGenre=D.estDuGenre;}
return(D.GetGenre()===this.Genre)&&lEstDuGenre&&(D.Actif||((!this.avecFiltre||!this.PourMemeMatiere||D.PourMemeMatiere)&&(!this.PourMemeClasseEtGroupe||D.PourMemeClasseEtGroupe)&&lEstDansDate))&&D.existeNumero();}
GetCouleurCellule(D,I){return this.genreRessourceDocJoint!==EGenreRessource.DocJointEtablissement&&I===3?ObjetDonneesListe.ECouleurCellule.Fixe:ObjetDonneesListe.ECouleurCellule.Blanc;}
SurCreation(D,V){const lFile=V[-1];if(UtilitaireSelecFile.estFichierCloudPartage(lFile)){return{estFichierCloud:true};}
if(this.avecGestionLibelleSurLiens){if(V[1].toLowerCase()==='http://'||V[1].toLowerCase()==='https://'){return this.erreurURL;}}
super.SurCreation(D,V);D.PourMemeMatiere=true;D.PourMemeClasseEtGroupe=true;}
GetMessage_Creation_Impossible(aErreur){if(aErreur&&aErreur.estFichierCloud){return'';}
if(aErreur===this.erreurURL){return GTraductions.getValeur('URLIncorrecte');} else{return super.GetMessage_Creation_Impossible(aErreur);}}
AvecEdition(I,D){if(this.genreRessourceDocJoint!==EGenreRessource.DocJointEtablissement){return(I<2||this.avecGestionLibelleSurLiens)&&I!==3;} else{return I===0||(I===1&&DonneesListe_PieceJointe.suppressionAutoriseePJ(D,this.genreRessourceDocJoint));}}
SurEdition(aParams,I,D,V){if(this.avecGestionLibelleSurLiens&&I===1){V=GChaine.verifierURLHttp(V);if(V.toLowerCase()==='http://'||V.toLowerCase()==='https://'){return this.erreurURL;}}
return super.SurEdition(aParams,I,D,V);}
GetMessage_Edition_Impossible(aColonne,aDonnee,aErreur){if(aErreur===this.erreurURL){return GTraductions.getValeur('URLIncorrecte');} else{return super.GetMessage_Edition_Impossible(aColonne,aDonnee,aErreur);}}
AvecEtatSaisie(){return this.avecEtatSaisie;}
AvecSuppression(D){return DonneesListe_PieceJointe.suppressionAutoriseePJ(D,DonneesListe_PieceJointe.genreRessourceDocJoint);}
avecBordureDroite(){return this.options.avecBordure;}
static suppressionAutoriseePJ(aPJ,aGenreRessource){if(!aPJ){return false;}
if(aGenreRessource!==EGenreRessource.DocJointEtablissement){return true;} else{return aPJ.modifiable!==false;}}}
module.exports=DonneesListe_PieceJointe;},fn:"donneesliste_piecejointe.js"});;
IE.fModule({f:function(exports,require,module,global){const ObjetListeElements=require('ObjetListeElements.js');const ObjetSaisie=require('ObjetSaisie.js');class ObjetSaisiePN extends ObjetSaisie{constructor(...aParams){super(...aParams);this.ListeElements=new ObjetListeElements();}
initialiserOptions_ObjetSaisie(){super.initialiserOptions_ObjetSaisie();$.extend(this._options,{avecEventSurFermetureListe:true,forcerBoutonDeploiement:false});}
SetDonnees(AListeElements,ASelection,aSansSelection){if(this.listeDeroulee){this.FermerListe(false);}
this.ListeElements=AListeElements?AListeElements:new ObjetListeElements();if(this._options.avecTriListeElements){this.ListeElements.trier();}
this.listeDeroulee=false;this.cache.heightScroll=0;this._remplirListe();let LLibelle='&nbsp;';if(this._options.initAutoSelectionAvecUnElement&&!this._options.multiSelection){if(this.ListeElements&&this.ListeElements.GetNbrElements()===1){const lElement=this.ListeElements.GetElement(0);if(lElement.Existe()&&lElement.GetLibelle()&&lElement.GetLibelle().length){ASelection=this.Selection=0;LLibelle=this.ListeElements.GetLibelle(this.Selection);} else{this.Selection= -1;}}
if(this._options.celluleAvecTexteHtml){this.bouton.setLibelleHtml(LLibelle);} else{this.bouton.setLibelle(LLibelle);}}
if(!aSansSelection){this._surSetDonnnes=true;this.SetSelection(ASelection);}
const lNbElements=this.ListeElements?this.ListeElements.GetNbrElementsExistes():0;if(lNbElements>1||
this._options.forcerBoutonDeploiement){this.bouton.setAvecBouton(true);this.bouton.SetActif(true);} else{this.bouton.setAvecBouton(false);this.bouton.SetActif(false);}}}
module.exports=ObjetSaisiePN;},fn:"objetsaisiepn.js"});;
IE.fModule({f:function(exports,require,module,global){const DonneesListe_PieceJointe=require('DonneesListe_PieceJointe.js');const ObjetFenetre_PieceJointeCP=require('ObjetFenetre_PieceJointeCP.js').ObjetFenetre_PieceJointeCP;const GChaine=require('GChaine.js');const GStyle=require('GStyle.js');const EGenreDocumentJoint=require('Enumere_DocumentJoint.js');const EGenreEvenementObjetSaisie=require('Enumere_EvenementObjetSaisie.js');const{GDate}=require('ObjetDate.js');const ObjetElement=require('ObjetElement.js');const ObjetListeElements=require('ObjetListeElements.js');const GTraductions=require('ObjetTraduction.js');const{EGenreRole}=require('ObjetWAI.js');const EGenreRessource=require('Enumere_Ressource.js');const ObjetSaisiePN=require('ObjetSaisiePN.js');const GUID=require('GUID.js');class ObjetFenetre_PieceJointe extends ObjetFenetre_PieceJointeCP{constructor(...aParams){super(...aParams);this.ids={deploiementFiltres:GUID.getId(),zoneFiltres:GUID.getId()};this.PourMemeMatiere=false;this.PourMemeClasseEtGroupe=false;this.DateDeb=GParametres.PremiereDate;this.DateFin=GParametres.DerniereDate;this.genrePeriodeFiltre={jourCourant:0,demiMois:1,unMois:2,troisMois:3,sixMois:4,unAn:5};this.setOptionsFenetre({avecColonneInfoBulle:false,avecBoutonSupprimer:!IE.estMobile,avecComposeBasInFooter:IE.estMobile,avecDeploiementFiltres:IE.estMobile,avecTitre:!IE.estMobile,avecCroixFermeture:!IE.estMobile});}
getControleur(aInstance){return $.extend(true,super.getControleur(this),{btnMaj:{getDisabled:function(){const lListe=aInstance.GetInstance(aInstance.IdentListe).getListeElementsSelection();return lListe.GetNbrElements()!==1||!DonneesListe_PieceJointe.suppressionAutoriseePJ(lListe.GetElement(0),aInstance.parametres.genreRessourceDocJoint);}},btnSupp:{getDisabled:function(){const lListe=aInstance.GetInstance(aInstance.IdentListe).getListeElementsSelection();if(lListe.GetNbrElements()===0){return true;}
let lAvecSuppression=true;lListe.parcourir(function(D){if(!DonneesListe_PieceJointe.suppressionAutoriseePJ(D,aInstance.parametres.genreRessourceDocJoint)){lAvecSuppression=false;return false;}});return!lAvecSuppression;}},nodeDeploiementFiltres:function(){const lMap={'click':function(){const lEstDeploye=($('#'+this.ids.zoneFiltres.escapeJQ()).css('display')!=='none');if(lEstDeploye){$('#'+this.ids.zoneFiltres.escapeJQ()).css('display','none');$('#'+this.ids.deploiementFiltres.escapeJQ()).children().first().removeClass('icon_chevron_up').addClass('icon_chevron_down');} else{$('#'+this.ids.zoneFiltres.escapeJQ()).css('display','');$('#'+this.ids.deploiementFiltres.escapeJQ()).children().first().removeClass('icon_chevron_down').addClass('icon_chevron_up');}}.bind(aInstance)};$(this.node).on(lMap);},checkFiltreMemeMatiere:{getValue:function(){return!!aInstance.PourMemeMatiere;},setValue:function(aValeur){aInstance.PourMemeMatiere=aValeur;aInstance.SetDonnees_Liste();}},checkFiltreMemeClasseGroupe:{getValue:function(){return!!aInstance.PourMemeClasseEtGroupe;},setValue:function(aValeur){aInstance.PourMemeClasseEtGroupe=aValeur;aInstance.SetDonnees_Liste();}}});}
avecGestionLibelleSurLiens(){return this.Genre===EGenreDocumentJoint.Url;}
ConstruireInstances(...aParams){super.ConstruireInstances(...aParams);this.IdentCombo=this.Add(ObjetSaisiePN,_EvenementSurCombo,_InitialiserCombo);}
setOptions(aOptions){this.setOptionsFenetre(aOptions);}
afficherFenetrePJ(aParam){this._setDocumentsJointsActifs(aParam.listePJTot,aParam.listePJContexte);this.SetGenre(aParam.genreFenetrePJ);this.SetDonnees({listePiecesJointes:aParam.listePJTot,genre:aParam.genrePJ,genreRessourceDocJoint:aParam.genreRessourcePJ,avecFiltre:aParam.avecFiltre,listePeriodes:aParam.listePeriodes?aParam.listePeriodes:_getListePeriodesParDefaut.call(this),dateCours:aParam.dateCours,avecEtatSaisie:aParam.avecEtatSaisie,optionsSelecFile:aParam.optionsSelecFile,modeLien:aParam.modeLien,surValiderAvantFermer:aParam.surValiderAvantFermer,validationAuto:aParam.validationAuto,contenuCourant:aParam.contenuCourant,tafCourant:aParam.tafCourant,avecThemes:aParam.avecThemes});}
SetDonnees(aParametres){super.SetDonnees($.extend({genre:EGenreDocumentJoint.Fichier,avecFiltre:{date:false,classeMatiere:false},listePeriodes:null,dateCours:null,genreRessourceDocJoint:EGenreRessource.DocumentJoint},aParametres));const lAvecDate=this.parametres.avecFiltre&&this.parametres.avecFiltre.date&&this.parametres.genreRessourceDocJoint!==EGenreRessource.DocJointEtablissement;this.GetInstance(this.IdentCombo).SetVisible(lAvecDate);this.DateCours=this.parametres.dateCours?GDate.GetJour(this.parametres.dateCours):this.parametres.dateCours;const lAvecFiltres=lAvecDate||(this.parametres.avecFiltre&&this.parametres.avecFiltre.classeMatiere);GStyle.setDisplay(this.ids.deploiementFiltres,lAvecFiltres);GStyle.setDisplay(this.Nom+'_Filtre_1',lAvecFiltres&&lAvecDate);GStyle.setDisplay(this.Nom+'_Filtre_2',lAvecFiltres&&this.parametres.avecFiltre.classeMatiere);this.surFixerTaille();if(this.parametres.listePeriodes&&this.parametres.dateCours){this.parametres.listePeriodes.SetLibelle(0,GDate.FormatDate(this.parametres.dateCours,GChaine.Format(GTraductions.getValeur('fenetrePJ.le'),['%JJ %MMMM'])));}
const lInstance=this.GetInstance(this.IdentCombo);lInstance.setLabel(this.Genre===EGenreDocumentJoint.Url?GTraductions.getValeur('fenetrePJ.filtre.uniquementLiensUtilisees'):GTraductions.getValeur('fenetrePJ.filtre.uniquementPJUtilisees'));lInstance.SetDonnees(this.parametres.listePeriodes,this.parametres.genreRessourceDocJoint!==EGenreRessource.DocJointEtablissement?1:undefined);}
_getDonneesListe(){return new DonneesListe_PieceJointe(this.ListePiecesJointes,this.parametres.avecEtatSaisie,this.Genre,this.parametres.genreRessourceDocJoint,this.parametres.modeLien,this.avecGestionLibelleSurLiens()).setOptions({avecEtatSaisie:this.parametres.avecEtatSaisie,optionsSelecFile:this.parametres.optionsSelecFile,listeFichiers:this.ListeFichiers,avecMultiSelection:this.parametres.modeLien,avecBordure:!IE.estMobile});}
ComposeContenu(){const T=[];T.push(`<div id="${this.Nom}_parent" class="flex-contain cols">`);if(this.optionsFenetre.avecDeploiementFiltres){T.push('  <div ie-node="nodeDeploiementFiltres" id="',this.ids.deploiementFiltres,'" class="filtres-header">');T.push('    <i class="icon_chevron_down"></i>');T.push('    <h3>',this.Genre===EGenreDocumentJoint.Url?GTraductions.getValeur('fenetrePJ.filtre.titreRechercheSites'):GTraductions.getValeur('fenetrePJ.filtre.titreRecherchePJ'),'</h3>');T.push('  </div>');}
T.push(`    <div class="filtres-content" id="${this.ids.zoneFiltres}" ${this.optionsFenetre.avecDeploiementFiltres?` style="display:none;"`:``}>`);T.push(`      <div class="field-contain" id="${this.Nom}_Filtre_1" ${this.parametres.avecFiltre&&this.parametres.avecFiltre.date?``:`style="display:none"`}>\n                    <div id="${this.GetNomInstance(this.IdentCombo)}"></div>\n                  </div>`);T.push(`      <div class="field-contain" id="${this.Nom}_Filtre_2" ${this.parametres.avecFiltre&&this.parametres.avecFiltre.classeMatiere?``:`style="display:none"`}>\n                    <ie-checkbox class="m-right-l" ie-model="checkFiltreMemeMatiere">${GTraductions.getValeur('fenetrePJ.filtre.memeMatiere')}</ie-checkbox>\n                    <ie-checkbox ie-model="checkFiltreMemeClasseGroupe">${GTraductions.getValeur('fenetrePJ.filtre.memeClasseGpe')}</ie-checkbox>\n                  </div>`);T.push(`    </div>`);T.push(`    <div class="listeFenetrePJ" id="${this.GetNomInstance(this.IdentListe)}"></div>`);T.push(`</div>`);return T.join('');}
SetDonnees_Liste(){if(this.objPJListe){this.objPJListe.SetDonnees(this.parametres.avecFiltre,this.PourMemeMatiere,this.PourMemeClasseEtGroupe,this.DateDeb,this.DateFin,this.DateCours);this.GetInstance(this.IdentListe).SetDonnees(this.objPJListe);}}}
function _InitialiserCombo(aInstance){const lStr=this.Genre===EGenreDocumentJoint.Url?`<label class="ie-titre-petit">${GTraductions.getValeur('fenetrePJ.filtre.uniquementLiensUtilisees')}</label>`:`<label class="ie-titre-petit">${GTraductions.getValeur('fenetrePJ.filtre.uniquementPJUtilisees')}</label>`;const lParam={labelWAIEdit:lStr,roleWAIEdit:EGenreRole.Combobox,avecOuvertureDeroulantModale:(IE.estMobile?true:false)};const lLabel=lStr;$.extend(lParam,IE.estMobile?{libelleHaut:lLabel,longueur:200}:{texteEdit:lLabel,longueur:150});aInstance.setOptions_ObjetSaisie(lParam);}
function _getListePeriodesParDefaut(){const lListePeriodesParDefaut=new ObjetListeElements();lListePeriodesParDefaut.AddElement(new ObjetElement(GTraductions.getValeur('fenetrePJ.filtre.today'),this.genrePeriodeFiltre.jourCourant,this.genrePeriodeFiltre.jourCourant));lListePeriodesParDefaut.AddElement(new ObjetElement(GTraductions.getValeur('fenetrePJ.filtre.15jours'),this.genrePeriodeFiltre.demiMois,this.genrePeriodeFiltre.demiMois));lListePeriodesParDefaut.AddElement(new ObjetElement(GTraductions.getValeur('fenetrePJ.filtre.1mois'),this.genrePeriodeFiltre.unMois,this.genrePeriodeFiltre.unMois));lListePeriodesParDefaut.AddElement(new ObjetElement(GTraductions.getValeur('fenetrePJ.filtre.3mois'),this.genrePeriodeFiltre.troisMois,this.genrePeriodeFiltre.troisMois));lListePeriodesParDefaut.AddElement(new ObjetElement(GTraductions.getValeur('fenetrePJ.filtre.6mois'),this.genrePeriodeFiltre.sixMois,this.genrePeriodeFiltre.sixMois));lListePeriodesParDefaut.AddElement(new ObjetElement(GTraductions.getValeur('fenetrePJ.filtre.12mois'),this.genrePeriodeFiltre.unAn,this.genrePeriodeFiltre.unAn));return lListePeriodesParDefaut;}
function _EvenementSurCombo(aGenreEvenement,aElement,aSelection){if(aGenreEvenement===EGenreEvenementObjetSaisie.selection){const LNbrMois=[0,0.5,1,3,6];if(aSelection===this.genrePeriodeFiltre.unAn){this.DateDeb=GParametres.PremiereDate;this.DateFin=GParametres.DerniereDate;} else{const lDate=this.DateCours?this.DateCours:new Date();this.DateDeb=new Date(lDate-30*(1000*60*60*24)*LNbrMois[aSelection]);this.DateFin=lDate;}
this.SetDonnees_Liste();}}
module.exports=ObjetFenetre_PieceJointe;},fn:"objetfenetre_piecejointe.js"});;
IE.fModule({f:function(exports,require,module,global){const ObjetSelecteurPJCP=require('ObjetSelecteurPJCP.js');const EGenreRessource=require('Enumere_Ressource.js');const ObjetFenetre_PieceJointe=require('ObjetFenetre_PieceJointe.js');const UtilitaireGestionCloudEtPDF=require('UtilitaireGestionCloudEtPDF.js');const ObjetFenetre=require('ObjetFenetre.js');const ObjetFenetre_FichiersCloud=require('ObjetFenetre_FichiersCloud.js');class ObjetSelecteurPJ extends ObjetSelecteurPJCP{constructor(...aParams){super(...aParams);}
_initialiserOptions(){super._initialiserOptions();Object.assign(this._options,{genreRessourcePJ:EGenreRessource.DocJointEtablissement});}
ConstruireInstances(){super.ConstruireInstances();if(ObjetFenetre_PieceJointe){this.identEditionPJ=this.addFenetre(ObjetFenetre_PieceJointe,this.evntEditionPJ,this.initEditionPJ);}}
ouvrirFenetreChoixListeCloud(aCallbackParFichier,aCallbackFinal){const lThis=this;let lParams={callbaskEvenement:function(aLigne){if(aLigne>=0){const lService=GEtatUtilisateur.listeCloud.GetElement(aLigne);const lFenetreChoixFichierDepuisCloud=ObjetFenetre.creerInstance(ObjetFenetre_FichiersCloud,{pere:lThis,evenement(aAction,aParam){ObjetFenetre_FichiersCloud.eventFenetreFichierCloud(aAction,aParam,(aNewElement) =>{aCallbackParFichier(aNewElement);},aCallbackFinal);}});lFenetreChoixFichierDepuisCloud.SetDonnees({service:lService.Genre});}},modeGestion:UtilitaireGestionCloudEtPDF.modeGestion.Cloud};UtilitaireGestionCloudEtPDF.creerFenetreGestion(lParams);}}
module.exports=ObjetSelecteurPJ;},fn:"objetselecteurpj.js"});;
IE.fModule({f:function(exports,require,module,global){const ObjetCelluleDate=require('ObjetCelluleDate.js');const Identite=require('ObjetIdentite.js');const GTraductions=require('ObjetTraduction.js');const{GDate}=require('ObjetDate.js');class ObjetPublication extends Identite{constructor(...aParams){super(...aParams);this.id={cbPublie:this.Nom+'_CBPubliee'};this._donnees={publie:false,dateDebut:GParametres.PremiereDate,dateFin:GParametres.DerniereDate};}
Initialiser(){this.dateDebut=new ObjetCelluleDate(this.Nom+'.dateDebut',null,this,_surDateDebut.bind(this));this.dateFin=new ObjetCelluleDate(this.Nom+'.dateFin',null,this,_surDateFin.bind(this));_initDate.call(this,this.dateDebut);_initDate.call(this,this.dateFin);this.Afficher();this.dateDebut.Initialiser();this.dateFin.Initialiser();}
SetDonnees(aDonnees){$.extend(this._donnees,aDonnees);this.dateDebut.SetDonnees(this._donnees.dateDebut);this.dateFin.SetDonnees(this._donnees.dateFin);this.dateDebut.SetActif(!!this._donnees.publie);this.dateFin.SetActif(!!this._donnees.publie);}
getControleur(aInstance){return $.extend(true,super.getControleur(this),{cbPublication:{getValue:function(){return!!aInstance._donnees&&!!aInstance._donnees.publie;},setValue:function(aValeur){if(!!aInstance._donnees){aInstance._donnees.publie=aValeur;aInstance.dateDebut.SetActif(!!aValeur);aInstance.dateFin.SetActif(!!aValeur);_onChange.call(aInstance);}}},getTextePublie:function(){const lTextePublie=GTraductions.getValeur('actualites.Publier');return lTextePublie;},getClass:function(){return!!aInstance._donnees&&!!aInstance._donnees.publie?'Gras':'';}});}
_setModeExclusif(){}
ConstruireAffichage(){const H=[];H.push('<div style="display:flex; align-items:center; gap:0.3rem;">');H.push('<ie-checkbox ie-model="cbPublication" tabIndex="0" ie-texte="getTextePublie" ie-icon="icon_info_sondage_publier" ie-class="getClass"></ie-checkbox>');H.push('<div><span ie-class="getClass">',GTraductions.getValeur('aPartirDu').toLowerCase(),'</span></div>','<div id="',this.dateDebut.GetNom(),'"></div>','<div><span ie-class="getClass">',GTraductions.getValeur('jusquAu').toLowerCase(),'</span></div>','<div id="',this.dateFin.GetNom(),'"></div>');H.push('</div>');return H.join('');}}
function _initDate(aInstance){aInstance.setParametres_Fenetre(window.GParametres.PremierLundi,GDate.GetJourSuivant(window.GParametres.PremiereDate,-100),GDate.GetJourSuivant(window.GParametres.DerniereDate,100));}
function _surDateDebut(aDate){this._donnees.dateDebut=aDate;if(this._donnees.dateDebut>this._donnees.dateFin){this._donnees.dateFin=this._donnees.dateDebut;this.dateFin.SetDonnees(this._donnees.dateFin);}
_onChange.call(this);}
function _surDateFin(aDate){this._donnees.dateFin=aDate;if(this._donnees.dateFin<this._donnees.dateDebut){this._donnees.dateDebut=this._donnees.dateFin;this.dateDebut.SetDonnees(this._donnees.dateDebut);}
_onChange.call(this);}
function _onChange(){this.dateDebut.SetDonnees(this._donnees.dateDebut);this.dateFin.SetDonnees(this._donnees.dateFin);if(this.Pere&&this.Evenement){this.callback.appel(this._donnees);}}
module.exports=ObjetPublication;},fn:"objetpublication.js"});;
IE.fModule({f:function(exports,require,module,global){const GChaine=require('GChaine.js');const GHtml=require('GHtml.js');const GPosition=require('GPosition.js');const ControleSaisieEvenement=require('ControleSaisieEvenement.js');const Identite=require('ObjetIdentite.js');const{GObjetWAI,EGenreAttribut}=require('ObjetWAI.js');require('IEHtml.Bouton.js');const EGenreEtatBouton={Actif:0,Inactif:1};class ObjetBouton extends Identite{constructor(...aParams){super(...aParams);this.IdBouton=this.Nom+'_Bouton';this.Etat=EGenreEtatBouton.Actif;this.IdPremierElement=this.IdBouton;this._initOptionsBouton();}
getControleur(aInstance){return $.extend(true,super.getControleur(this),{btn:{event:function(){aInstance.SurValidation();},getDisabled:function(){return!aInstance.Actif;},getOptions:function(){return aInstance._optionsBouton.design||null;},getLibelle:function(){return GChaine.ToHTML(aInstance._optionsBouton.Libelles[aInstance.Etat]);}}});}
_initOptionsBouton(){this._optionsBouton={Actif:true,design:null,Libelles:[],TexteImg:'',hint:'',Width:null,Height:null,RaccourciClavier:null,DescriptionAccessible:null,labelWAI:'',TabImages:[],TabCurseurs:[]};}
setOptionsBouton(aOptions){$.extend(this._optionsBouton,aOptions);this.Actif=this._optionsBouton.Actif;this.Afficher();}
ConstruireAffichage(){let lIndex=this._optionsBouton.Height===null||this._optionsBouton.Height===undefined?0:this._optionsBouton.Height.toString().indexOf("px")+this._optionsBouton.Height.toString().indexOf("%")+this._optionsBouton.Height.toString().indexOf("em")+2;let lWidth;lIndex=this._optionsBouton.Width===null||this._optionsBouton.Width===undefined?0:this._optionsBouton.Width.toString().indexOf("px")+this._optionsBouton.Width.toString().indexOf("%")+this._optionsBouton.Width.toString().indexOf("em")+2;if(lIndex> -1){lWidth=this._optionsBouton.Width;} else{lWidth=parseInt(this._optionsBouton.Width)+'px';}
const LStyleWidth=this._optionsBouton.Width===null||this._optionsBouton.Width===undefined?'':'width:'+lWidth+'; ';const LAccessKey=this._optionsBouton.RaccourciClavier===null||this._optionsBouton.RaccourciClavier===undefined?'':'accesskey="'+this._optionsBouton.RaccourciClavier+'" ';const lHint=this._optionsBouton.hint?'title="'+this._optionsBouton.hint+'"':'';return['<ie-bouton ie-model="btn" id="',this.IdBouton,'"',(this._optionsBouton.labelWAI?GObjetWAI.composeAttribut({genre:EGenreAttribut.label,valeur:this._optionsBouton.labelWAI}):''),' ',lHint,' ',LAccessKey,' style="',LStyleWidth,'">','</ie-bouton>'
].join('');}
SetLibelle(ALibelle,AEtat){AEtat=AEtat===null||AEtat===undefined?EGenreEtatBouton.Actif:EGenreEtatBouton.Inactif;this._optionsBouton.Libelles[AEtat]=ALibelle;this.$refreshSelf();}
setWidth(aWidth){GPosition.setWidth(this.IdBouton,aWidth);}
setHeight(aHeight){GPosition.setHeight(this.IdBouton,aHeight);}
setFocus(aAvecDecalage){GHtml.setFocus(this.IdBouton,true,aAvecDecalage);}
SetEtat(AEtat){GHtml.setImage(this.IdBouton,this._optionsBouton.TabImages[AEtat?EGenreEtatBouton.Actif:EGenreEtatBouton.Inactif]);GHtml.setClass(this.IdBouton,this._optionsBouton.TabCurseurs[AEtat?EGenreEtatBouton.Actif:EGenreEtatBouton.Inactif]);GHtml.setTitle(this.IdBouton,this._optionsBouton.Libelles[AEtat?EGenreEtatBouton.Actif:EGenreEtatBouton.Inactif]);}
SetActif(AActif){this.Actif=AActif;this.$refreshSelf();}
IsActif(){return this.Actif;}
RecupererDonnees(){this.SetVisible(this.Visible);}
SurValidation(){if(this.Actif){ControleSaisieEvenement(function(){this.callback.appel(this.Genre);}.bind(this),!this.ControleNavigation);}}
setHint(aHint){$.extend(this._optionsBouton,{hint:aHint});$('#'+this.IdBouton.escapeJQ()).attr('title',GChaine.toTitle(aHint));}}
module.exports=ObjetBouton;},fn:"objetbouton.js"});;
IE.fModule({f:function(exports,require,module,global){const ObjetDonneesListeFlatDesign=require('ObjetDonneesListeFlatDesign.js');class DonneesListe_SelectionDiffusion extends ObjetDonneesListeFlatDesign{constructor(aDonnees){super(aDonnees);this.uniquementMesListes=GApplication.parametresUtilisateur.get('listeDiffusion.uniquementMesListes')||false;this.setOptions({avecCB:true,avecCocheCBSurLigne:true,avecBoutonActionLigne:false,avecEvnt_Selection:true});}
setUniquementMesListes(aUniquementMesListes){this.uniquementMesListes=aUniquementMesListes;}
GetVisible(D){return!this.uniquementMesListes||D.estAuteur;}
getValueCB(aParams){return aParams.article?!!aParams.article.cmsActif:false;}
setValueCB(aParams,aValue){aParams.article.cmsActif=aValue;}}
module.exports=DonneesListe_SelectionDiffusion;},fn:"donneesliste_selectiondiffusion.js"});;
IE.fModule({f:function(exports,require,module,global){const MethodesObjet=require('MethodesObjet.js');const EGenreEtat=require('Enumere_Etat.js');const ObjetFenetre_SelectionRessource=require('ObjetFenetre_SelectionRessource.js');const ObjetElement=require('ObjetElement.js');const ObjetListeElements=require('ObjetListeElements.js');const GTraductions=require('ObjetTraduction.js');const ObjetTri=require('ObjetTri.js');const TypeThemeBouton=require('Type_ThemeBouton.js');const EGenreRessource=require('Enumere_Ressource.js');const ObjetListe=require('ObjetListe.js');const ObjetDonneesListeFlatDesign=require('ObjetDonneesListeFlatDesign.js');class ObjetFenetre_SelectionClasseGroupe extends ObjetFenetre_SelectionRessource{constructor(...aParams){super(...aParams);this.avecCumul=false;this.setOptionsFenetre({listeBoutons:[{libelle:GTraductions.getValeur('Annuler'),theme:TypeThemeBouton.secondaire},{libelle:GTraductions.getValeur('Valider'),theme:TypeThemeBouton.primaire}
],largeur:320,hauteur:400,heightMax_mobile:true});this.setOptions_Fenetre_SelectionRessource({avecBarreTitre:true,optionsListe:{nonEditable:false,avecCelluleEditableTriangle:false}});this.setSelectionObligatoire(true);this.indexBtnValider=1;}
setAvecCumul(aAvecCumul){this.avecCumul=aAvecCumul;}
setDonnees(aParam){this.SetDonnees(aParam.listeRessources,aParam.listeRessourcesSelectionnees,aParam.titre);if(aParam.genreRessource){this.genreRessource=aParam.genreRessource;}}
SetDonnees(aListeRessources,aListeRessourcesSelectionnees,aTitre){this.listeRessourcesSelectionnees=aListeRessourcesSelectionnees;this.genreRessource=EGenreRessource.Classe;if(this.avecCumul){this._construireListeRessourceAvecCumul(aListeRessources,aListeRessourcesSelectionnees);} else{this.construireListeRessource(aListeRessources,aListeRessourcesSelectionnees);}
if(aTitre){this.setOptionsFenetre({titre:aTitre});} else{this.setOptionsFenetre({titre:GTraductions.getValeur('fenetreSelectionClasseGroupe.titre')});}
this.Afficher();this._actualiserListe();}
_initialiserListe(aInstance){const lColonnes=[{id:'',taille:'100%'}
];let lOptions={colonnes:lColonnes,skin:ObjetListe.skin.flatDesign,avecCBToutCocher:this._options.avecCocheRessources?{libelle:GTraductions.getValeur('liste.toutCocher')}:false,forcerOmbreScrollBottom:true};if(this._options.optionsListe){$.extend(lOptions,this._options.optionsListe);}
aInstance.setOptionsListe(lOptions);}
_actualiserListe(){this.SetBoutonActif(this.indexBtnValider,!this._options.selectionObligatoire||this._nbRessourcesCochees()>0);this.GetInstance(this.identListe).SetDonnees(new DonneesListe_SelectionClasseGroupe(this.listeRessources));}
_construireListeRessourceAvecCumul(aListeRessources,aListeRessourcesSelectionnees){let lCumulGroupe=new ObjetElement(GTraductions.getValeur('Groupes'),0,EGenreRessource.Groupe);lCumulGroupe.estDeploye=false;lCumulGroupe.estUnDeploiement=true;lCumulGroupe.SetActif(true);let lListeCumul=new ObjetListeElements(),lAvecGroupe=false;this.listeRessources=new ObjetListeElements();for(let i=0;i<aListeRessources.GetNbrElements();i++){if(aListeRessources.GetElement(i).existeNumero()){let lRessource=MethodesObjet.dupliquer(aListeRessources.GetElement(i));if(lRessource.GetGenre()===EGenreRessource.Groupe){lAvecGroupe=true;lRessource.pere=lCumulGroupe;} else{let lNiveau=lListeCumul.GetElement(lListeCumul.GetIndiceParNumeroEtGenre(lRessource.niveau.GetNumero()));if(!lNiveau){lNiveau=new ObjetElement(lRessource.niveau.GetLibelle(),lRessource.niveau.GetNumero(),0);lNiveau.estUnDeploiement=true;lNiveau.estDeploye=false;lListeCumul.AddElement(lNiveau);}
lRessource.pere=lNiveau;}
const lRessourceTrouve=aListeRessourcesSelectionnees.GetElementParElement(lRessource);lRessource.selectionne=lRessourceTrouve&&lRessourceTrouve.Etat!==EGenreEtat.Suppression?true:false;this.listeRessources.AddElement(lRessource);}}
if(lAvecGroupe){this.listeRessources.AddElement(lCumulGroupe);}
for(let i=0;i<lListeCumul.GetNbrElements();i++){this.listeRessources.AddElement(lListeCumul.GetElement(i));}
this.listeRessources.setTri([ObjetTri.init(function(D){return D.GetGenre()===EGenreRessource.Groupe;}),ObjetTri.init(function(D){return D.pere?D.pere.GetLibelle():D.GetLibelle();}),ObjetTri.init(function(D){return D.pere?true:false;}),ObjetTri.init('Libelle')]);this.listeRessources.trier();}}
class DonneesListe_SelectionClasseGroupe extends ObjetDonneesListeFlatDesign{constructor(ADonnees){super(ADonnees);this.setOptions({avecSelection:false,avecSuppression:false,avecEtatSaisie:false,avecTri:false,avecCB:true,avecEvnt_CB:true,avecCocheCBSurLigne:true,avecDeploiement:true,avecEvnt_Deploiement:true,avecEventDeploiementSurCellule:true,avecEvnt_ApresEdition:true,avecBoutonActionLigne:false});}
getDisabledCB(aParams){let D=aParams.article;return!!D.nonEditable;}
getValueCB(aParams){return aParams.article?aParams.article.selectionne:false;}
setValueCB(aParams,aValue){aParams.article.selectionne=aValue;}
getTitreZonePrincipale(aParams){let D=aParams.article;return D.GetLibelle();}
desactiverIndentationParente(){return true;}}
module.exports=ObjetFenetre_SelectionClasseGroupe;},fn:"objetfenetre_selectionclassegroupe.js"});;
IE.fModule({f:function(exports,require,module,global){const TypeGenreInternetIndividu={InternetIndividu_Professeur:0,InternetIndividu_Personnel:1,InternetIndividu_Parent:2,InternetIndividu_ParentEleve:3,InternetIndividu_Eleve:4,InternetIndividu_MaitreDeStage:5,InternetIndividu_MaitreDeStageEleve:6,InternetIndividu_Inspecteur:7};module.exports.TypeGenreInternetIndividu=TypeGenreInternetIndividu;},fn:"typegenreinternetindividu.js"});;
IE.fModule({f:function(exports,require,module,global){const GChaine=require('GChaine.js');const GStyle=require('GStyle.js');const ObjetFenetre_Liste=require('ObjetFenetre_Liste.js');const GTraductions=require('ObjetTraduction.js');const ObjetListe=require('ObjetListe.js');class ObjetFenetre_SelectionListeDiffusion extends ObjetFenetre_Liste{constructor(...aParams){super(...aParams);this.uniquementMesListes=GApplication.parametresUtilisateur.get('listeDiffusion.uniquementMesListes')||false;this.setOptionsFenetre({modale:true,titre:GTraductions.getValeur('listeDiffusion.selectionnezListe'),largeur:300,hauteur:470,listeBoutons:[GTraductions.getValeur('Annuler'),GTraductions.getValeur('Valider')]});}
initialiserListe(aInstance){aInstance.setOptionsListe({skin:ObjetListe.skin.flatDesign});}
getControleur(){return $.extend(true,super.getControleur(this),{cbLesMiens:{getValue:function(){return GApplication.parametresUtilisateur.get('listeDiffusion.uniquementMesListes');},setValue:function(aValue){_evenementSurCB.call(this.instance,aValue);}}});}
ComposeContenu(){const T=[];T.push('<table width="100%" height="100%" border="0" cellpadding="0" cellspacing="0">');T.push('<tr><td><ie-checkbox ie-model="cbLesMiens" class="EspaceHaut EspaceBas" style="',GStyle.composeCouleurTexte(GCouleur.bandeau.texte),'">',GChaine.Insecable(GTraductions.getValeur('listeDiffusion.lesMiens')),'&nbsp;','</ie-checkbox></td></tr>');T.push('<tr><td id="'+this.GetNomInstance(this.identListe)+'" height="100%">&nbsp;</td></tr>');T.push('</table>');return T.join('');}}
function _evenementSurCB(aValue){this.uniquementMesListes=!!aValue;GApplication.parametresUtilisateur.set('listeDiffusion.uniquementMesListes',this.uniquementMesListes);if(this.GetInstance(this.identListe)&&this.GetInstance(this.identListe).getDonneesListe()){this.GetInstance(this.identListe).getDonneesListe().setUniquementMesListes(this.uniquementMesListes);this.GetInstance(this.identListe).Actualiser(true,false);}}
module.exports=ObjetFenetre_SelectionListeDiffusion;},fn:"objetfenetre_selectionlistediffusion.js"});;
IE.fModule({f:function(exports,require,module,global){const{TypeDroits}=require('ObjetDroitsPN.js');const GCache=require('Cache.js');const MethodesObjet=require('MethodesObjet.js');const GChaine=require('GChaine.js');const GHtml=require('GHtml.js');const GStyle=require('GStyle.js');const EGenreEtat=require('Enumere_Etat.js');const ObjetBouton=require('ObjetBouton.js');const{ObjetFenetre_SelectionPublic,TypeGenreCumulSelectionPublic}=require('ObjetFenetre_SelectionPublic.js');const ObjetElement=require('ObjetElement.js');const ObjetListeElements=require('ObjetListeElements.js');const ObjetTabOnglets=require('ObjetTabOnglets.js');const GTraductions=require('ObjetTraduction.js');const DonneesListe_SelectionDiffusion=require('DonneesListe_SelectionDiffusion.js');const EGenreEspace=require('Enumere_Espace.js');const EGenreRessource=require('Enumere_Ressource.js');const ObjetAbstraitInterface=require('ObjetInterface.js');const ObjetFenetre_SelectionClasseGroupe=require('ObjetFenetre_SelectionClasseGroupe.js');const ObjetRequeteListePublics=require('ObjetRequeteListePublics.js');const TypeGenreInternetIndividu=require('TypeGenreInternetIndividu.js').TypeGenreInternetIndividu;const getCumulPourFenetrePublic=require('UtilitaireFenetreSelectionPublic.js').getCumulPourFenetrePublic;const ObjetRequeteDonneesEditionInformation=require('ObjetRequeteDonneesEditionInformation.js');const TypeThemeBouton=require('Type_ThemeBouton.js');const ObjetFenetre_SelectionListeDiffusion=require('ObjetFenetre_SelectionListeDiffusion.js');const ObjetRequeteListeDiffusion=require('ObjetRequeteListeDiffusion.js');const UtilitaireBoutonBandeau=require('UtilitaireBoutonBandeau.js');class ObjetDestinatairesAgenda extends ObjetAbstraitInterface{constructor(...aParams){super(...aParams);this.TypeOnglet={entite:1,individuel:2,responsables:3};this.genresRessourceAffDestinataire=[];this.choixResponsableParEntite=false;this.id={destinataires:this.Nom+'_Destinataires',cbPublicElevesRattaches:this.Nom+'_ElevesRattaches',cbPublicEntreResponsables:this.Nom+'_EntreResponsables',cbPublicResponsables:this.Nom+'_Public_'+TypeGenreInternetIndividu.InternetIndividu_ParentEleve,cbPublicProfesseurs:this.Nom+'_Public_'+TypeGenreInternetIndividu.InternetIndividu_Professeur,cbPublicPersonnels:this.Nom+'_Public_'+TypeGenreInternetIndividu.InternetIndividu_Personnel,cbPublicEleves:this.Nom+'_Public_'+TypeGenreInternetIndividu.InternetIndividu_Eleve,cbPublicMaitreDeStage:this.Nom+'_Public_'+TypeGenreInternetIndividu.InternetIndividu_MaitreDeStageEleve,rdRelatifEnfants:this.Nom+'_GenreResp_'+TypeGenreInternetIndividu.InternetIndividu_ParentEleve,rdRespLegaux:this.Nom+'_GenreResp_'+TypeGenreInternetIndividu.InternetIndividu_Parent,cbEleve:this.Nom+'_Eleve_Eleve',cbEleveResponsable1:this.Nom+'_Eleve_Resp1',cbEleveResponsable2:this.Nom+'_Eleve_Resp2',cbEleveProfsPrincipaux:this.Nom+'_Eleve_PPs',cbEleveTuteurs:this.Nom+'_Eleve_Tuteurs',cbDirecteur:this.Nom+'_Directeur',panelDestinataireEntite:this.Nom+'_Panel_'+this.TypeOnglet.entite,panelDestinataireIndividuel:this.Nom+'_Panel_'+this.TypeOnglet.individuel,panelDestinataireResponsables:this.Nom+'_Panel_'+this.TypeOnglet.responsables,panelDestinatairePrimaire:this.Nom+'_Panel_Primaire',countEntite:this.Nom+'_Count_Entite',countEleve:this.Nom+'_Count_'+EGenreRessource.Eleve,countProfesseur:this.Nom+'_Count_'+EGenreRessource.Enseignant,countResponsable:this.Nom+'_Count_'+EGenreRessource.Responsable,countResponsableAResponsable:this.Nom+'_Count_'+EGenreRessource.Responsable+'_AResp',countPersonnel:this.Nom+'_Count_'+EGenreRessource.Personnel,countMaitreDeStage:this.Nom+'_Count_'+EGenreRessource.MaitreDeStage,countInspecteur:this.Nom+'_Count_'+EGenreRessource.InspecteurPedagogique};this.setOptions({});this.listeOngletsDestinataires=new ObjetListeElements();this.listeOngletsDestinataires.AddElement(new ObjetElement(GTraductions.getValeur('actualites.Edition.OngletEntite',[0,0]),0,this.TypeOnglet.entite));this.listeOngletsDestinataires.AddElement(new ObjetElement(GTraductions.getValeur('actualites.Edition.OngletIndividu',[0]),0,this.TypeOnglet.individuel));this.listeOngletsDestinataires.AddElement(new ObjetElement(GTraductions.getValeur('actualites.Edition.Destinataires',[0]),0,this.TypeOnglet.entreResponsables));}
setOptions(aOptions){this.height={zoneDestinataires:122};this.hauteurTabOnglets=31;this.largeur=(aOptions&&aOptions.largeur!==null&&aOptions.largeur!==undefined)?aOptions.largeur:600;this.avecCallbckSurModification=(aOptions&&aOptions.avecCallbckSurModification!==null&&aOptions.avecCallbckSurModification!==undefined)?true:false;}
setChoixResponsableParEntite(aChoixParEntite){this.choixResponsableParEntite=aChoixParEntite;}
setGenresRessourceAffDestinataire(aGenresRessourceAffDest){this.genresRessourceAffDestinataire=aGenresRessourceAffDest;if(this.genresRessourceAffDestinataire.length>0){_resetDestinataires.call(this);}}
getGenresRessourceAffDestinataire(){return this.genresRessourceAffDestinataire;}
estGenreInGenresRessourceAffDestinataire(aGenreRessource){return($.inArray(aGenreRessource,this.genresRessourceAffDestinataire)> -1);}
ConstruireInstances(){this.identTabs=this.Add(ObjetTabOnglets,_evenementSurTab.bind(this),_initialiserTabs.bind(this));this.identBtEntite=this.Add(ObjetBouton,_evntBouton.bind(this),_initBoutonRessource.bind(this,EGenreRessource.Aucune));this.identBtERespAResp=this.Add(ObjetBouton,_evntBouton.bind(this),_initBoutonRessource.bind(this,EGenreRessource.Responsable));this.identBtEleve=this.Add(ObjetBouton,_evntBouton.bind(this),_initBoutonRessource.bind(this,EGenreRessource.Eleve));this.identBtProf=this.Add(ObjetBouton,_evntBouton.bind(this),_initBoutonRessource.bind(this,EGenreRessource.Enseignant));this.identBtResp=this.Add(ObjetBouton,_evntBouton.bind(this),_initBoutonRessource.bind(this,EGenreRessource.Responsable));this.identBtPers=this.Add(ObjetBouton,_evntBouton.bind(this),_initBoutonRessource.bind(this,EGenreRessource.Personnel));this.identBtMDS=this.Add(ObjetBouton,_evntBouton.bind(this),_initBoutonRessource.bind(this,EGenreRessource.MaitreDeStage));this.identBtInsp=this.Add(ObjetBouton,_evntBouton.bind(this),_initBoutonRessource.bind(this,EGenreRessource.InspecteurPedagogique));this.identFenetreClasses=this.addFenetre(ObjetFenetre_SelectionClasseGroupe,_evenementFenetreClasses.bind(this),null);this.identFenetreSelectPublic=this.addFenetre(ObjetFenetre_SelectionPublic,_evenementFenetreIndividu.bind(this),null);this.identFenetreSelectListeDiffusion=this.addFenetre(ObjetFenetre_SelectionListeDiffusion,_evenementFenetreListeDiffusion.bind(this));}
getTabIdentBtn(){return[this.identBtEntite,this.identBtERespAResp,this.identBtEleve,this.identBtProf,this.identBtResp,this.identBtPers,this.identBtMDS,this.identBtInsp];}
SetDonnees(aInfo,aDonnees){this.information=aInfo;this.Afficher();if(aDonnees){_initPublic.call(this,aDonnees);}}
actualiserTabs(aParam){if(this.GetInstance(this.identTabs)){if(!!aParam&&this.listeOngletsDestinataires.GetNbrElements()>1){this.listeOngletsDestinataires.GetElement(1).invisible=aParam.avecIndividuelInvisible;if(aParam.avecIndividuelInvisible===true){this.listeOngletsDestinataires.SetLibelle(1,GTraductions.getValeur('actualites.Edition.OngletIndividu',[0]));}
if(_estResponsableAResponsable.call(this)){this.listeOngletsDestinataires.GetElement(0).invisible=true;this.listeOngletsDestinataires.GetElement(1).invisible=true;} else{this.listeOngletsDestinataires.GetElement(2).invisible=true;}}
_setDonneesTabs.call(this,{conserverSelection:aParam!==null&&aParam!==undefined?aParam.conserverSelection:false});}}
getControleur(aInstance){return $.extend(true,super.getControleur(aInstance),{btnAfficherListesDiffusion:{event(){_evenementSurBoutonListeDiffusion.call(aInstance);},getTitle(){return GTraductions.getValeur('actualites.public.chargerListeDiffusion');}},btnSupprimerDestinataires:{event(){_viderPublic.call(aInstance);},getTitle(){return GTraductions.getValeur('actualites.public.supprimer');},getDisabled(){return!aInstance.information||!_existesDestinataires(aInstance.information);}}});}
surSaisiePublic(aValeur,aChecked){switch(aValeur){case'rattaches':this.information.avecElevesRattaches=aChecked;break;case'responsables':if(!aChecked){_modifierGenrePublicEntite.call(this,TypeGenreInternetIndividu.InternetIndividu_ParentEleve,aChecked);_modifierGenrePublicEntite.call(this,TypeGenreInternetIndividu.InternetIndividu_Parent,aChecked);} else{let lType=TypeGenreInternetIndividu.InternetIndividu_ParentEleve;if(this.information.estInformation){lType=TypeGenreInternetIndividu.InternetIndividu_Parent;}
_modifierGenrePublicEntite.call(this,lType,aChecked);}
$('#'+this.id.rdRelatifEnfants.escapeJQ()).inputDisabled(!aChecked);$('#'+this.id.rdRespLegaux.escapeJQ()).inputDisabled(!aChecked);$('#'+this.id.rdRelatifEnfants.escapeJQ()).inputChecked(this.information.genresPublicEntite.contains(TypeGenreInternetIndividu.InternetIndividu_ParentEleve));$('#'+this.id.rdRespLegaux.escapeJQ()).inputChecked(this.information.genresPublicEntite.contains(TypeGenreInternetIndividu.InternetIndividu_Parent));break;case'professeurs':_modifierGenrePublicEntite.call(this,TypeGenreInternetIndividu.InternetIndividu_Professeur,aChecked);break;case'personnels':_modifierGenrePublicEntite.call(this,TypeGenreInternetIndividu.InternetIndividu_Personnel,aChecked);break;case'maitreDeStage':_modifierGenrePublicEntite.call(this,TypeGenreInternetIndividu.InternetIndividu_MaitreDeStageEleve,aChecked);break;case'eleves':_modifierGenrePublicEntite.call(this,TypeGenreInternetIndividu.InternetIndividu_Eleve,aChecked);break;case'eleve_eleve':this.information.avecEleve=aChecked;break;case'eleve_resp1':this.information.avecResp1=aChecked;break;case'eleve_resp2':this.information.avecResp2=aChecked;break;case'eleve_pp':this.information.avecProfsPrincipaux=aChecked;break;case'eleve_tuteurs':this.information.avecTuteurs=aChecked;break;case'directeur':this.information.avecDirecteur=aChecked;break;default:;break;}
this.information.avecModificationPublic=true;this.surModificationDest();}
surModificationDest(){if(this.avecCallbckSurModification===true){this.callback.appel();} else{this.information.SetEtat(EGenreEtat.Modification);}}
surSaisieGenreResp(aValeur){switch(aValeur){case'enfants':_modifierGenrePublicEntite.call(this,TypeGenreInternetIndividu.InternetIndividu_ParentEleve,true);_modifierGenrePublicEntite.call(this,TypeGenreInternetIndividu.InternetIndividu_Parent,false);break;case'legaux':_modifierGenrePublicEntite.call(this,TypeGenreInternetIndividu.InternetIndividu_ParentEleve,false);_modifierGenrePublicEntite.call(this,TypeGenreInternetIndividu.InternetIndividu_Parent,true);break;default:;break;}
this.information.avecModificationPublic=true;this.surModificationDest();}
resetIndividus(){if(this.information){this.information.listePublicIndividu=new ObjetListeElements();this.setCountIndividus();}}
setCountIndividus(aParam){const lSansFiltre=!aParam||(aParam.avecFiltreGenresRessourceAffDestinataire!==true);const lTab=[EGenreRessource.Enseignant,EGenreRessource.Eleve,EGenreRessource.Responsable,EGenreRessource.Personnel,EGenreRessource.MaitreDeStage,EGenreRessource.InspecteurPedagogique];let lCntTot=0;const lNbr=lTab.length;for(let i=0;i<lNbr;i++){const lGenreRessource=lTab[i];const lCnt=this.information.listePublicIndividu.GetNbrElementsExistes(lGenreRessource);if(lSansFiltre||($.inArray(lGenreRessource,this.genresRessourceAffDestinataire)> -1)){const lDonneesEleve=(lGenreRessource===EGenreRessource.Eleve)?(aParam&&(aParam.donneesEleve!==null)&&(aParam.donneesEleve!==undefined)?aParam.donneesEleve:null):null;_setCountDeGenreRessource.call(this,lCnt,lGenreRessource,lDonneesEleve);}
lCntTot+=lCnt;}
return lCntTot;}
getHeightZoneDestinataires(){return this.height.zoneDestinataires;}
ConstruireAffichage(){return _compose.call(this);}}
function _initBoutonRessource(aGenreRessource,aInstance){aInstance.setOptionsBouton({Libelles:['...'],design:{theme:TypeThemeBouton.neutre},Actif:true,Width:20,Height:20,RaccourciClavier:null,TabImages:[],TabCurseurs:[],hint:null,DescriptionAccessible:null,labelWAI:null});aInstance.Genre=aGenreRessource;}
function _initialiserTabs(aInstance){aInstance.setOptions({hauteur:this.hauteurTabOnglets,largeur:this.largeur-10});}
function _getTraducCount(aGenreRessource,aSingulier){switch(aGenreRessource){case EGenreRessource.Classe:return aSingulier===true?GTraductions.getValeur('actualites.Classe'):GTraductions.getValeur('actualites.Classes');case EGenreRessource.Groupe:return aSingulier===true?GTraductions.getValeur('actualites.Groupe'):GTraductions.getValeur('actualites.Groupes');case EGenreRessource.Responsable:if(_estResponsableAResponsable.call(this)){return GTraductions.getValeur('actualites.Classes');} else{return'';}
default:;return'';}}
function _getIdCountRessource(aGenreRessource){switch(aGenreRessource){case EGenreRessource.Enseignant:return this.id.countProfesseur;case EGenreRessource.Responsable:if(_estResponsableAResponsable.call(this)){return this.id.countResponsableAResponsable;} else{return this.id.countResponsable;}
case EGenreRessource.Eleve:return this.id.countEleve;case EGenreRessource.Personnel:return this.id.countPersonnel;case EGenreRessource.MaitreDeStage:return this.id.countMaitreDeStage;case EGenreRessource.InspecteurPedagogique:return this.id.countInspecteur;case EGenreRessource.Classe:case EGenreRessource.Groupe:return this.id.countEntite;default:return'';}}
function _getStrCount(aCnt,aGenreRessource,aParam){if($.inArray(aGenreRessource,[EGenreRessource.Classe,EGenreRessource.Groupe])>-1){const lOnlyOne=(aCnt===1);const lTraduc=_getTraducCount.call(this,aGenreRessource,lOnlyOne);const lDetail=lOnlyOne?(this.information.listePublicEntite.GetLibelle(0)||aCnt):aCnt;return lTraduc+' ('+lDetail+')';} else if($.inArray(aGenreRessource,[EGenreRessource.Responsable])>-1&&_estResponsableAResponsable.call(this)){const lTraduc=_getTraducCount.call(this,aGenreRessource);const lDetail=aCnt+' '+GTraductions.getValeur('actualites.public.responsables');return lTraduc+' ('+lDetail+')';} else{if(!this.genresRessourceAffDestinataire||this.genresRessourceAffDestinataire.length===0){return aCnt;} else{let lStr;if((aParam.forcerCmp===false)&&(aCnt===1)){const lIndice=this.information.listePublicIndividu.getIndiceElementParFiltre(function(aElement){return aElement.GetGenre()===aGenreRessource;});lStr=this.information.listePublicIndividu.GetLibelle(lIndice);} else{lStr=aCnt;}
return(aParam.avecParentheses===true)?' ('+lStr+')':lStr;}}}
function _setCountRessource(aCnt,aGenreRessource){const lId=_getIdCountRessource.call(this,aGenreRessource);const lForcerCompteur=(aGenreRessource===EGenreRessource.Eleve)?true:false;const lStr=_getStrCount.call(this,aCnt,aGenreRessource,{forcerCmp:lForcerCompteur,avecParentheses:true});GHtml.setHtml(lId,lStr);}
function _setCountCBRespEleve(aIdCB,aEstVisible,aStr,aDisabled){const lJq=$("label[for='"+aIdCB.escapeJQ()+"']");$("#"+aIdCB.escapeJQ()).inputDisabled(aDisabled);if(aEstVisible){lJq.html(aStr).parent().show();} else{lJq.parent().hide();}}
function _setCountDeGenreRessource(aCnt,aGenreRessource,aParam){if(aGenreRessource===EGenreRessource.Eleve){_setCountEleve.call(this,aCnt,aParam);} else{_setCountRessource.call(this,aCnt,aGenreRessource);}}
function _setCountEleve(aCnt,aDonnees){_setCountRessource.call(this,aCnt,EGenreRessource.Eleve);if(this.genresRessourceAffDestinataire&&(this.genresRessourceAffDestinataire.length!==0)&&($.inArray(EGenreRessource.Eleve,this.genresRessourceAffDestinataire)>-1)&&aDonnees){const lOnlyOne=(aCnt===1);let lStr,lEstVisible,lDisabled;lStr=lOnlyOne?_getStrCount.call(this,aCnt,EGenreRessource.Eleve,{forcerCmp:false,avecParentheses:false}):GTraductions.getValeur('actualites.Eleves')+' ('+aCnt+')';_setCountCBRespEleve.call(this,this.id.cbEleve,true,lStr);lEstVisible=true;lDisabled=aDonnees.nombreResponsablesPreferentiel===0;lStr=GTraductions.getValeur('actualites.ResponsablePreferentiel')+' ('+aDonnees.nombreResponsablesPreferentiel+')';_setCountCBRespEleve.call(this,this.id.cbEleveResponsable1,lEstVisible,lStr,lDisabled);lEstVisible=true;lDisabled=aDonnees.nombreResponsablesSecondaires===0;lStr=GTraductions.getValeur('actualites.ResponsableNonPreferentiel')+' ('+aDonnees.nombreResponsablesSecondaires+')';_setCountCBRespEleve.call(this,this.id.cbEleveResponsable2,lEstVisible,lStr,lDisabled);lEstVisible=true;lDisabled=aDonnees.nombreProfsPrincipaux===0;lStr=GTraductions.getValeur('actualites.ProfsPrincipaux')+' ('+aDonnees.nombreProfsPrincipaux+')';_setCountCBRespEleve.call(this,this.id.cbEleveProfsPrincipaux,lEstVisible,lStr,lDisabled);lEstVisible=true;lDisabled=aDonnees.nombreTuteurs===0;lStr=GTraductions.getValeur('actualites.Tuteurs')+' ('+aDonnees.nombreTuteurs+')';_setCountCBRespEleve.call(this,this.id.cbEleveTuteurs,lEstVisible,lStr,lDisabled);}}
function _libererBtnsDestinataires(){const lTabIdentBtn=this.getTabIdentBtn();const lNbr=lTabIdentBtn.length;for(let i=0;i<lNbr;i++){const lIdent=lTabIdentBtn[i];if(this.GetInstance(lIdent)){this.GetInstance(lIdent).free();}}}
function _initialiserBtns(aTabIdent){const lNbr=aTabIdent.length;for(let i=0;i<lNbr;i++){const lIdent=aTabIdent[i];if(this.GetInstance(lIdent)){this.GetInstance(lIdent).Initialiser();}}}
function _initialiserBtnsDestinataires(){const lTabIdentBtn=this.getTabIdentBtn();_initialiserBtns.call(this,lTabIdentBtn);}
function _initCB(aId,aChecked){const lJqCb=$('#'+aId.escapeJQ());if(lJqCb&&lJqCb.length===1){lJqCb.inputChecked(aChecked).jIECheckBox();}}
function _initPublic(aDonnees){if(GEtatUtilisateur.pourPrimaire()){this.GetInstance(this.identBtEntite).Initialiser();this.GetInstance(this.identBtResp).Initialiser();this.GetInstance(this.identBtProf).Initialiser();this.GetInstance(this.identBtPers).Initialiser();if(this.choixResponsableParEntite){this.information.genresPublicEntite.add(TypeGenreInternetIndividu.InternetIndividu_Parent);}
_initCB(this.id.cbDirecteur,!!this.information.avecDirecteur);if(!!aDonnees.avecDirecteurNonEditable){$('#'+this.id.cbDirecteur.escapeJQ()).inputDisabled(true);}} else if(_estResponsableAResponsable.call(this)){_initialiserBtnsDestinataires.call(this);_evntListePublic.call(this,EGenreRessource.Responsable,true);} else{$('#'+this.id.cbPublicElevesRattaches.escapeJQ()).inputChecked(this.information.avecElevesRattaches).jIECheckBox();if(!GParametres.avecElevesRattaches){$('#'+(this.id.cbPublicElevesRattaches+'_pere').escapeJQ()).hide();}
const lRespChecked=this.information.genresPublicEntite.contains(TypeGenreInternetIndividu.InternetIndividu_ParentEleve)||this.information.genresPublicEntite.contains(TypeGenreInternetIndividu.InternetIndividu_Parent);_initCB.call(this,this.id.cbPublicResponsables,lRespChecked);_initCB.call(this,this.id.cbPublicProfesseurs,this.information.genresPublicEntite.contains(TypeGenreInternetIndividu.InternetIndividu_Professeur));_initCB.call(this,this.id.cbPublicPersonnels,this.information.genresPublicEntite.contains(TypeGenreInternetIndividu.InternetIndividu_Personnel));_initCB.call(this,this.id.cbPublicEleves,this.information.genresPublicEntite.contains(TypeGenreInternetIndividu.InternetIndividu_Eleve));_initCB.call(this,this.id.cbPublicMaitreDeStage,this.information.genresPublicEntite.contains(TypeGenreInternetIndividu.InternetIndividu_MaitreDeStageEleve));$('#'+this.id.rdRelatifEnfants.escapeJQ()).inputChecked(this.information.genresPublicEntite.contains(TypeGenreInternetIndividu.InternetIndividu_ParentEleve)).inputDisabled(!lRespChecked).jIECheckBox();$('#'+this.id.rdRespLegaux.escapeJQ()).inputChecked(this.information.genresPublicEntite.contains(TypeGenreInternetIndividu.InternetIndividu_Parent)).inputDisabled(!lRespChecked).jIECheckBox();_initCB.call(this,this.id.cbEleve,this.information.avecEleve);_initCB.call(this,this.id.cbEleveResponsable1,this.information.avecResp1);_initCB.call(this,this.id.cbEleveResponsable2,this.information.avecResp2);_initCB.call(this,this.id.cbEleveProfsPrincipaux,this.information.avecProfsPrincipaux);_initCB.call(this,this.id.cbEleveTuteurs,this.information.avecTuteurs);_initialiserBtnsDestinataires.call(this);}
_actualiserCountDestinataires.call(this,aDonnees);}
function _actualiserCountDestinataires(aDonneesEleve){_setCountDestinataires.call(this,{avecIndividus:true,donneesEleve:aDonneesEleve,avecFiltreGenresRessourceAffDestinataire:true,estInit:true});}
function _setCountDestinataires(aParam){if(GEtatUtilisateur.pourPrimaire()){if(this.choixResponsableParEntite){const lNbPublicEntite=this.information.listePublicEntite.GetNbrElementsExistes();_setCountDeGenreRessource.call(this,lNbPublicEntite,EGenreRessource.Classe);}} else{let lIndice,lNbr,lGenreRessource;const lTabEntites=[EGenreRessource.Classe,EGenreRessource.Groupe];const lCountRessource=[];for(lIndice=0,lNbr=lTabEntites.length;lIndice<lNbr;lIndice++){lGenreRessource=lTabEntites[lIndice];lCountRessource[lGenreRessource]=this.information.listePublicEntite.GetNbrElementsExistes(lGenreRessource);}
this.listeOngletsDestinataires.SetLibelle(0,GTraductions.getValeur('actualites.Edition.OngletEntite',[lCountRessource[EGenreRessource.Classe],lCountRessource[EGenreRessource.Groupe]]));if(!this.genresRessourceAffDestinataire||this.genresRessourceAffDestinataire.length===0){if(this.GetInstance(this.identTabs)&&!aParam.estInit){this.GetInstance(this.identTabs).setLibelleOngletDIndice(0,this.listeOngletsDestinataires.GetLibelle(0));}} else{for(lIndice=0,lNbr=lTabEntites.length;lIndice<lNbr;lIndice++){lGenreRessource=lTabEntites[lIndice];if($.inArray(lGenreRessource,this.genresRessourceAffDestinataire)>-1){_setCountDeGenreRessource.call(this,lCountRessource[lGenreRessource],lGenreRessource);}}}}
if(aParam.avecIndividus===true){let lParamIndividus;if(this.genresRessourceAffDestinataire.length!==0&&aParam.donneesEleve&&aParam.avecFiltreGenresRessourceAffDestinataire===true){lParamIndividus={donneesEleve:aParam.donneesEleve,avecFiltreGenresRessourceAffDestinataire:aParam.avecFiltreGenresRessourceAffDestinataire};}
const lTotal=this.setCountIndividus(lParamIndividus);if(!this.genresRessourceAffDestinataire||this.genresRessourceAffDestinataire.length===0){this.listeOngletsDestinataires.SetLibelle(1,GTraductions.getValeur('actualites.Edition.OngletIndividu',[lTotal]));if(this.GetInstance(this.identTabs)&&!aParam.estInit){this.GetInstance(this.identTabs).setLibelleOngletDIndice(1,this.listeOngletsDestinataires.GetLibelle(1));}}}
if(this.genresRessourceAffDestinataire.length===0&&aParam.estInit===true){if(this.GetInstance(this.identTabs)){_setDonneesTabs.call(this);}}}
function _getHeightDest(aGenreRessource){let lHeight=0;if($.inArray(aGenreRessource,this.genresRessourceAffDestinataire)>-1){lHeight=aGenreRessource===EGenreRessource.Eleve?(46+29):29;}
return lHeight;}
function _resetDestinataires(){const lTailleInit=21;let lHeight=lTailleInit;const lTab=[EGenreRessource.Eleve,EGenreRessource.Enseignant,EGenreRessource.Responsable,EGenreRessource.Personnel,EGenreRessource.MaitreDeStage,EGenreRessource.InspecteurPedagogique];const lNbr=lTab.length;for(let i=0;i<lNbr;i++){const lGenreRessource=lTab[i];lHeight+=_getHeightDest.call(this,lGenreRessource);}
if(lHeight>lTailleInit){this.height.zoneDestinataires=lHeight;}
if(this.GetInstance(this.identTabs)){this.GetInstance(this.identTabs).free();}
_libererBtnsDestinataires.call(this);GHtml.setHtml(this.id.destinataires,_composeDestinataires.call(this));_initialiserBtnsDestinataires.call(this);}
function _evntBouton(aGenre){if(aGenre===EGenreRessource.Aucune){_evntEntite.call(this);} else{_evntListePublic.call(this,aGenre,false);}}
function _evntEntite(){const lInstance=this.GetInstance(this.identFenetreClasses);const lEstPrimaire=GApplication.estPrimaire;if(!this.listeClassesGroupes){let lParam={avecClasse:true,avecGroupe:true,uniquementClasseEnseignee:GEtatUtilisateur.GenreEspace===EGenreEspace.Professeur?!GApplication.droits.get(TypeDroits.communication.toutesClasses):false};if(lEstPrimaire){lParam={avecClasse:true,avecGroupe:true,avecGroupeEtClasseDeRegroupement:false,sansClasseDeRegroupement:true,uniquementClassePrincipal:false,uniquementClasseEnseignee:GEtatUtilisateur.GenreEspace===EGenreEspace.Professeur?!GApplication.droits.get(TypeDroits.communication.toutesClasses):false};}
this.listeClassesGroupes=GEtatUtilisateur.getListeClasses(lParam);}
if(this.genresRessourceAffDestinataire.length>0&&!lEstPrimaire){if($.inArray(EGenreRessource.Classe,this.genresRessourceAffDestinataire)> -1){this.listeClassesGroupes=this.listeClassesGroupes.getListeElements(function(aElement){return aElement.Genre===EGenreRessource.Classe;});} else if($.inArray(EGenreRessource.Groupe,this.genresRessourceAffDestinataire)> -1){this.listeClassesGroupes=this.listeClassesGroupes.getListeElements(function(aElement){return aElement.Genre===EGenreRessource.Groupe;});}}
lInstance.setSelectionObligatoire(false);lInstance.setAvecCumul(!lEstPrimaire);const lTitre=lEstPrimaire?GTraductions.getValeur('fenetreSelectionClasseGroupe.titreClasses'):null;lInstance.SetDonnees(this.listeClassesGroupes,MethodesObjet.dupliquer(this.information.listePublicEntite),lTitre);}
function _estResponsableAResponsable(){return(GEtatUtilisateur.GenreEspace===EGenreEspace.Parent);}
function _evntListePublic(aGenre,aBloquerOuvertureFenetre){const lEstResponsableAResponsable=_estResponsableAResponsable.call(this);const lParams={genres:[aGenre],sansFiltreSurEleve:GApplication.droits.get(TypeDroits.communication.toutesClasses),entreResponsables:lEstResponsableAResponsable};if(lEstResponsableAResponsable){lParams['avecFiltreDelegues']=true;}
new ObjetRequeteListePublics(this,_evntListePublicApresRequete.bind(this,aBloquerOuvertureFenetre)).lancerRequete(lParams);}
function _evntListePublicApresRequete(aBloquerOuvertureFenetre ,aDonnees){var lListeComplet=aDonnees.listePublic;var lGenre=aDonnees.genres[0];var lListeSelection=_getListeDonneesSelectionnees.call(this,lGenre);if(aBloquerOuvertureFenetre===true){if(_estResponsableAResponsable.call(this)&&lListeSelection&&lListeSelection.GetNbrElements()===0&&this.information.listePublicIndividu.GetNbrElements()===0){var lClasse=null;var lClasseUnique=true;lListeComplet.parcourir(function(aElt){if(aElt.classes&&aElt.classes.GetNbrElements()===1){var lClasseCourante=aElt.classes.GetElement(0);if(lClasse===null){lClasse=lClasseCourante;} else{if(lClasse.GetNumero()!==lClasseCourante.GetNumero()){lClasseUnique=false;}}} else{lClasseUnique=false;}}.bind(this));if(lClasseUnique===true){lListeSelection=lListeComplet.getListeElements();this.information.listePublicIndividu=lListeSelection;_evenementApresFenetreIndividu.call(this,EGenreRessource.Responsable,this.information.listePublicIndividu,1);}}
return;}
_evntDeclencherFenetreRessource.call(this,{listeComplet:lListeComplet,listeSelectionnee:lListeSelection,genre:lGenre,genreCumul:getCumulPourFenetrePublic(lGenre,aDonnees.checked,aDonnees.listePublic.GetNbrElements()),listePartiel:this.listePartiel,listeServicesPeriscolaire:aDonnees.listeServicesPeriscolaire,listeFamilles:aDonnees.listeFamilles});}
function _getListeDonneesSelectionnees(aGenre){return this.information.listePublicIndividu.getListeElements(function(aElement){return aElement.GetGenre()===aGenre;});}
function _evntDeclencherFenetreRessource(aDonnees){const lInstance=this.GetInstance(this.identFenetreSelectPublic);if(aDonnees.genre===EGenreRessource.Eleve||aDonnees.genre===EGenreRessource.Responsable){const lListeCumuls=new ObjetListeElements();lListeCumuls.AddElement(new ObjetElement(GTraductions.getValeur('actualites.Cumul.Classe'),0,TypeGenreCumulSelectionPublic.classe,0));lListeCumuls.AddElement(new ObjetElement(GTraductions.getValeur('actualites.Cumul.Alphabetique'),0,TypeGenreCumulSelectionPublic.initial,1));if(aDonnees.genre===EGenreRessource.Responsable){lListeCumuls.AddElement(new ObjetElement(GTraductions.getValeur('actualites.Cumul.NomDesEleves'),0,TypeGenreCumulSelectionPublic.nomEleves));if(aDonnees.listeServicesPeriscolaire){lListeCumuls.AddElement(new ObjetElement(GTraductions.getValeur('actualites.Cumul.ServicesPeriscolaire'),0,TypeGenreCumulSelectionPublic.servicesPeriscolaire));}}
if(aDonnees.listeFamilles){aDonnees.listeFamilles.parcourir((aFamille) =>{const lFiltreFamille=new ObjetElement(aFamille.GetLibelle(),0,TypeGenreCumulSelectionPublic.famille);lFiltreFamille.famille=aFamille;lListeCumuls.AddElement(lFiltreFamille);});}
lInstance.setListeCumuls(lListeCumuls);lInstance.setOptions_Fenetre_SelectionRessource({avecBarreTitre:true,avecFiltreDelegues:_estResponsableAResponsable.call(this)});}
lInstance.setSelectionObligatoire(false);if(aDonnees.genreCumul){lInstance.setGenreCumulActif(aDonnees.genreCumul);}
const lListePartiel=aDonnees.listePartiel;const lFiltres=[];if(lListePartiel&&aDonnees.genre===EGenreRessource.Enseignant){aDonnees.listeComplet.parcourir(function(aElement){const lNumero=aElement.GetNumero();aElement.estMembreEquipe=lListePartiel.getIndiceElementParFiltre(function(aElement){return aElement.GetNumero()===lNumero;})>-1;});lFiltres.push({libelle:GTraductions.getValeur('actualites.filtre.equipePedagogique'),filtre:function(aElement,aChecked){return aChecked?aElement.estMembreEquipe:true;},checked:false});}
lInstance.setOptions({filtres:lFiltres,avecCocheRessources:true});lInstance.setDonnees({listeRessources:aDonnees.listeComplet,listeRessourcesSelectionnees:MethodesObjet.dupliquer(aDonnees.listeSelectionnee),genreRessource:aDonnees.genre,titre:_estResponsableAResponsable.call(this)?GTraductions.getValeur('Fenetre_SelectionRessource.CocherClasses'):EGenreRessource.getTitreFenetreSelectionRessource(aDonnees.genre),estGenreRessourceDUtilisateurConnecte:EGenreRessource.correspondAuGenreUtilisateurEspaceCourant(aDonnees.genre)});}
function _evenementSurBoutonListeDiffusion(){if(!this.listesDiffusion&&GCache&&GCache.general.existeDonnee('listeDiffusion')){this.listesDiffusion=GCache.general.getDonnee('listeDiffusion');}
if(!this.listesDiffusion){new ObjetRequeteListeDiffusion(this,_actionApresRequeteListeDiffusion).lancerRequete();} else{_ouvrirSelecteurListeDiffusion.call(this);}}
function _actionApresRequeteListeDiffusion(aJSON){if(aJSON&&aJSON.liste){this.listesDiffusion=aJSON.liste;if(GCache){GCache.general.setDonnee('listeDiffusion',aJSON.liste);}
_ouvrirSelecteurListeDiffusion.call(this);}}
function _ouvrirSelecteurListeDiffusion(){this.listesDiffusion.parcourir(function(aElement){aElement.cmsActif=false;});this.GetInstance(this.identFenetreSelectListeDiffusion).SetDonnees(new DonneesListe_SelectionDiffusion(this.listesDiffusion));}
function _viderPublic(){this.information.genresPublicEntite.clear();this.information.listePublicEntite=new ObjetListeElements();this.information.listePublicIndividu=new ObjetListeElements();_actualiserPublic.call(this);}
function _actualiserPublic(){$('#'+this.id.cbPublicElevesRattaches.escapeJQ()).inputChecked(this.information.avecElevesRattaches);const lRespChecked=this.information.genresPublicEntite.contains(TypeGenreInternetIndividu.InternetIndividu_ParentEleve)||this.information.genresPublicEntite.contains(TypeGenreInternetIndividu.InternetIndividu_Parent);$('#'+this.id.cbPublicResponsables.escapeJQ()).inputChecked(lRespChecked);$('#'+this.id.cbPublicProfesseurs.escapeJQ()).inputChecked(this.information.genresPublicEntite.contains(TypeGenreInternetIndividu.InternetIndividu_Professeur));$('#'+this.id.cbPublicPersonnels.escapeJQ()).inputChecked(this.information.genresPublicEntite.contains(TypeGenreInternetIndividu.InternetIndividu_Personnel));$('#'+this.id.cbPublicEleves.escapeJQ()).inputChecked(this.information.genresPublicEntite.contains(TypeGenreInternetIndividu.InternetIndividu_Eleve));$('#'+this.id.cbPublicMaitreDeStage.escapeJQ()).inputChecked(this.information.genresPublicEntite.contains(TypeGenreInternetIndividu.InternetIndividu_MaitreDeStageEleve));$('#'+this.id.rdRelatifEnfants.escapeJQ()).inputChecked(this.information.genresPublicEntite.contains(TypeGenreInternetIndividu.InternetIndividu_ParentEleve)).inputDisabled(!lRespChecked);$('#'+this.id.rdRespLegaux.escapeJQ()).inputChecked(this.information.genresPublicEntite.contains(TypeGenreInternetIndividu.InternetIndividu_Parent)).inputDisabled(!lRespChecked);$('#'+this.id.cbEleve.escapeJQ()).inputChecked(this.information.avecEleve);$('#'+this.id.cbEleveResponsable1.escapeJQ()).inputChecked(this.information.avecResp1);$('#'+this.id.cbEleveResponsable2.escapeJQ()).inputChecked(this.information.avecResp2);$('#'+this.id.cbEleveProfsPrincipaux.escapeJQ()).inputChecked(this.information.avecProfsPrincipaux);$('#'+this.id.cbEleveTuteurs.escapeJQ()).inputChecked(this.information.avecTuteurs);_setCountDestinataires.call(this,{avecIndividus:true});this.information.avecModificationPublic=true;this.surModificationDest();}
function _evenementSurTab(aElement){$('#'+this.id.panelDestinataireEntite.escapeJQ()).hide();$('#'+this.id.panelDestinataireIndividuel.escapeJQ()).hide();$('#'+this.id.panelDestinataireResponsables.escapeJQ()).hide();switch(aElement.GetGenre()){case this.TypeOnglet.entite:$('#'+this.id.panelDestinataireEntite.escapeJQ()).show();break;case this.TypeOnglet.individuel:$('#'+this.id.panelDestinataireIndividuel.escapeJQ()).show();break;case this.TypeOnglet.entreResponsables:$('#'+this.id.panelDestinataireResponsables.escapeJQ()).show();break;}}
function _existesDestinataires(aInformation){let lResult=false;lResult=aInformation.genresPublicEntite.count()>0||
aInformation.listePublicEntite.GetNbrElementsExistes()>0||
aInformation.listePublicIndividu.GetNbrElementsExistes()>0;return lResult;}
function _evenementFenetreClasses(aGenreRessource,aListeRessourcesSelectionnees,aNumeroBouton){if(aNumeroBouton===1){this.information.listePublicEntite=aListeRessourcesSelectionnees;_setCountDestinataires.call(this,{avecIndividus:false});this.information.avecModificationPublic=true;this.surModificationDest();}}
function _evenementFenetreIndividu(aGenreRessource,aListeRessourcesSelectionnees,aNumeroBouton){if(aGenreRessource===EGenreRessource.Eleve){new ObjetRequeteDonneesEditionInformation(this,_evenementApresFenetreIndividu.bind(this,aGenreRessource,aListeRessourcesSelectionnees,aNumeroBouton)).lancerRequete({avecPublic:true,listePublic:aListeRessourcesSelectionnees});} else{_evenementApresFenetreIndividu.call(this,aGenreRessource,aListeRessourcesSelectionnees,aNumeroBouton);}}
function _evenementApresFenetreIndividu(aGenreRessource,aListeRessourcesSelectionnees,aNumeroBouton,aDonnees){const lAutrePublicIndividu=this.information.listePublicIndividu.getListeElements(function(aElement){return aElement.GetGenre()!==aGenreRessource;});if(aNumeroBouton===1){this.information.listePublicIndividu=lAutrePublicIndividu;this.information.listePublicIndividu.FusionnerListe(MethodesObjet.dupliquer(aListeRessourcesSelectionnees));const lTotal=this.setCountIndividus({donneesEleve:aDonnees});if(!this.genresRessourceAffDestinataire||this.genresRessourceAffDestinataire.length===0){this.listeOngletsDestinataires.SetLibelle(1,GTraductions.getValeur('actualites.Edition.OngletIndividu',[lTotal]));if(this.GetInstance(this.identTabs)){this.GetInstance(this.identTabs).setLibelleOngletDIndice(1,this.listeOngletsDestinataires.GetLibelle(1));}}
this.information.avecModificationPublic=true;this.surModificationDest();}}
function _evenementFenetreListeDiffusion(aGenreBouton){if(aGenreBouton===1){const lDiffusions=this.listesDiffusion.getListeElements(function(aElement){return!!aElement.cmsActif;});if(lDiffusions.GetNbrElements()>0){const lListe=MethodesObjet.dupliquer(this.information.listePublicIndividu);for(let i=0;i<lDiffusions.GetNbrElements();i++){const lDiffusion=lDiffusions.GetElement(i);lDiffusion.listePublicIndividu.parcourir(function(aElement){const lIndice=lListe.GetIndiceParElement(aElement);if(lIndice===null||lIndice===undefined){lListe.AddElement(MethodesObjet.dupliquer(aElement));}});}
this.information.listePublicIndividu=lListe;_actualiserPublic.call(this);}}}
function _setDonneesTabs(aParam){const lTabs=this.GetInstance(this.identTabs);const lIndicePrec=lTabs.getIndiceOngletSelectionne();lTabs.SetDonnees(this.listeOngletsDestinataires);let lIndiceSelect=_estResponsableAResponsable.call(this)?2:0;if((aParam!==null)&&(aParam!==undefined)&&aParam.conserverSelection===true){if((lIndicePrec!==lIndiceSelect)&&lTabs.estOngletDIndiceVisible(lIndicePrec)){lIndiceSelect=lIndicePrec;}}
lTabs.selectOnglet(lIndiceSelect);}
function _modifierGenrePublicEntite(aGenre,aChecked){const lExists=this.information.genresPublicEntite.contains(aGenre);if(aChecked){if(!lExists){this.information.genresPublicEntite.add(aGenre);}} else{if(lExists){this.information.genresPublicEntite.remove(aGenre);}}
this.information.avecModificationPublic=true;}
function _composePanelDestinatairesPrimaire(){const T=[];const lWidthLibelle=180;if(this.choixResponsableParEntite){T.push('<div>','<span class="InlineBlock AlignementDroit" style="width:',lWidthLibelle,'px;">',GTraductions.getValeur('actualites.ResponsablesPrimaire'),'</span>','<div class="InlineBlock Texte10 EspaceGauche EspaceDroit" id="',this.GetNomInstance(this.identBtEntite),'"></div>','<div class="InlineBlock Texte10 EspaceGauche PetitEspaceHaut" id="',this.id.countEntite,'"></div>','</div>');} else{T.push('<div>','<span class="InlineBlock AlignementDroit" style="width:',lWidthLibelle,'px;">',GTraductions.getValeur('actualites.Responsables'),'</span>','<div class="InlineBlock Texte10 EspaceGauche EspaceDroit" id="',this.GetNomInstance(this.identBtResp),'"></div>','<div class="InlineBlock Texte10 EspaceGauche PetitEspaceHaut" id="',this.id.countResponsable,'"></div>','</div>');}
T.push('<div class="EspaceHaut">','<span class="InlineBlock AlignementDroit" style="width:',lWidthLibelle,'px;">',GTraductions.getValeur('actualites.Professeurs'),'</span>','<div class="InlineBlock Texte10 EspaceGauche EspaceDroit" id="',this.GetNomInstance(this.identBtProf),'"></div>','<div class="InlineBlock Texte10 EspaceGauche PetitEspaceHaut" id="',this.id.countProfesseur,'"></div>','</div>');T.push('<div class="EspaceHaut">','<div class="InlineBlock AlignementDroit" style="',GStyle.composeWidth(lWidthLibelle),'">',GTraductions.getValeur('actualites.Personnels'),'</div>','<div class="InlineBlock EspaceGauche EspaceDroit" id="',this.GetNomInstance(this.identBtPers),'"></div>','<div class="InlineBlock EspaceGauche PetitEspaceHaut" style="min-width : 20px;" id="',this.id.countPersonnel,'">0</div>','</div>');const lEventCbDirecteur=this.Nom+'.surSaisiePublic (value, checked)';T.push('<div class="EspaceHaut">','<div class="InlineBlock AlignementDroit" style="width:',lWidthLibelle,'px;">','<input class="AlignementMilieuVertical" type="checkbox" value="directeur" id="',this.id.cbDirecteur,'" onkeyup="',lEventCbDirecteur,'" onclick="',lEventCbDirecteur,'">','<label class="AlignementMilieuVertical EspaceGauche" for="',this.id.cbDirecteur,'">',GTraductions.getValeur('actualites.Directeur'),'</label>','</div>','</div>');return T.join('');}
function _composePanelEntite(){const T=[];T.push('<div class="EspaceHaut NoWrap">','<div class="InlineBlock AlignementHaut Texte10 EspaceGauche PetitEspaceHaut">',GTraductions.getValeur('actualites.Classes'),' ',GTraductions.getValeur('actualites.Groupes'),'</div>','<div class="InlineBlock AlignementHaut Texte10 EspaceGauche EspaceDroit" id="',this.GetNomInstance(this.identBtEntite),'"></div>','<div class="InlineBlock AlignementHaut Texte10 EspaceGauche PetitEspaceHaut" id="',this.id.cbPublicElevesRattaches,'_pere"><div style="display:flex; align-items:center"><input type="checkbox" class="Texte10" name="public" value="rattaches" id="',this.id.cbPublicElevesRattaches,'" onkeyup="',this.Nom,'.surSaisiePublic (value, checked)" onclick="',this.Nom,'.surSaisiePublic (value, checked)" /><label for="',this.id.cbPublicElevesRattaches,'">',GTraductions.getValeur('actualites.public.elevesRattaches'),'</label></div></div>','</div>');T.push('<div class="flex-contain">');T.push('<div class="flex-contain cols GrandEspaceGauche">');T.push('<div class="Texte10 EspaceHaut" style="display:flex; align-items:center"><input type="checkbox" class="Texte10" name="public" value="responsables" id="',this.id.cbPublicResponsables,'" onkeyup="',this.Nom,'.surSaisiePublic (value, checked)" onclick="',this.Nom,'.surSaisiePublic (value, checked)" /><label for="',this.id.cbPublicResponsables,'">',GTraductions.getValeur('actualites.public.responsables'),'</label></div>','<div class="Texte10 PetitEspaceGauche p-top" title="',GTraductions.getValeur('actualites.public.hintrelatifAuxEnfants'),'" style="display:flex; align-items:center"><input type="radio" class="Texte10" name="publicParent" value="enfants" id="',this.id.rdRelatifEnfants,'" onkeyup="',this.Nom,'.surSaisieGenreResp (value, checked)" onclick="',this.Nom,'.surSaisieGenreResp (value, checked)" /><label for="',this.id.rdRelatifEnfants,'">',GTraductions.getValeur('actualites.public.relatifAuxEnfants'),'</label></div>','<div class="Texte10 PetitEspaceGauche p-top-s" title="',GTraductions.getValeur('actualites.public.hintresponsablesLegaux'),'" style="display:flex; align-items:center"><input type="radio" class="Texte10" name="publicParent" value="legaux" id="',this.id.rdRespLegaux,'" onkeyup="',this.Nom,'.surSaisieGenreResp (value, checked)" onclick="',this.Nom,'.surSaisieGenreResp (value, checked)" /><label for="',this.id.rdRespLegaux,'">',GTraductions.getValeur('actualites.public.responsablesLegaux'),'</label></div>');T.push('</div>');T.push('<div class="InlineBlock AlignementHaut GrandEspaceGauche">');T.push(GApplication.droits.get(TypeDroits.fonctionnalites.gestionEleves)?'<div class="Texte10 EspaceHaut" style="display:flex; align-items:center"><input type="checkbox" class="Texte10" name="public" value="eleves" id="'+this.id.cbPublicEleves+'" onkeyup="'+this.Nom+'.surSaisiePublic (value, checked)" onclick="'+this.Nom+'.surSaisiePublic (value, checked)" /><label for="'+this.id.cbPublicEleves+'">'+GTraductions.getValeur('actualites.public.eleves')+'</label>'+'</div>':'');T.push('<div class="Texte10 EspaceHaut" style="display:flex; align-items:center"><input type="checkbox" class="Texte10" name="public" value="professeurs" id="',this.id.cbPublicProfesseurs,'" onkeyup="',this.Nom,'.surSaisiePublic (value, checked)" onclick="',this.Nom,'.surSaisiePublic (value, checked)" /><label for="',this.id.cbPublicProfesseurs,'">',GTraductions.getValeur('actualites.public.professeurs'),'</label></div>');T.push('</div>');T.push('<div class="InlineBlock AlignementHaut GrandEspaceGauche">');T.push(GApplication.droits.get(TypeDroits.fonctionnalites.gestionPersonnels)?'<div class="Texte10 EspaceHaut" style="display:flex; align-items:center"><input type="checkbox" class="Texte10" name="public" value="personnels" id="'+this.id.cbPublicPersonnels+'" onkeyup="'+this.Nom+'.surSaisiePublic (value, checked)" onclick="'+this.Nom+'.surSaisiePublic (value, checked)" /><label for="'+this.id.cbPublicPersonnels+'">'+GTraductions.getValeur('actualites.public.personnels')+'</label>'+'</div>':'');T.push(GApplication.droits.get(TypeDroits.fonctionnalites.gestionStages)?'<div class="Texte10 EspaceHaut" style="display:flex; align-items:center"><input type="checkbox" class="Texte10" name="public" value="maitreDeStage" id="'+this.id.cbPublicMaitreDeStage+'" onkeyup="'+this.Nom+'.surSaisiePublic (value, checked)" onclick="'+this.Nom+'.surSaisiePublic (value, checked)" /><label for="'+this.id.cbPublicMaitreDeStage+'">'+GTraductions.getValeur('actualites.public.maitreDeStage')+'</label>'+'</div>':'');T.push('</div>');T.push('</div>');return T.join('');}
function _composePanelResponsables(){const T=[];const lStrLabel=GTraductions.getValeur('actualites.ResponsablesPrimaire');T.push('<div class="EspaceHaut NoWrap">','  <div class="InlineBlock AlignementHaut Texte10 EspaceGauche PetitEspaceHaut">',lStrLabel,'</div>','  <div class="InlineBlock AlignementHaut Texte10 EspaceGauche EspaceDroit" id="',this.GetNomInstance(this.identBtERespAResp),'"></div>','<div class="InlineBlock Texte10 EspaceGauche PetitEspaceHaut" id="',this.id.countResponsableAResponsable,'"></div>','</div>');return T.join('');}
function _composePanelClasseGroupe(){const T=[];T.push('<div class="NoWrap">','<div class="InlineBlock AlignementHaut Texte10 EspaceGauche10" id="',this.GetNomInstance(this.identBtEntite),'"></div>','<div class="InlineBlock AlignementHaut Texte10 EspaceGauche PetitEspaceHaut" id="',this.id.countEntite,'"></div>','<div class="InlineBlock AlignementHaut Texte10 EspaceGauche PetitEspaceHaut" id="',this.id.cbPublicElevesRattaches,'_pere"><input type="checkbox" class="Texte10" name="public" value="rattaches" id="',this.id.cbPublicElevesRattaches,'" onkeyup="',this.Nom,'.surSaisiePublic (value, checked)" onclick="',this.Nom,'.surSaisiePublic (value, checked)" /><label for="',this.id.cbPublicElevesRattaches,'">',GTraductions.getValeur('actualites.public.elevesRattaches'),'</label></div>','</div>');T.push('<div class="PetitEspaceHaut NoWrap">');T.push('<div class="InlineBlock AlignementHaut EspaceGauche10">');T.push('<div class="Texte10 EspaceHaut"><input type="checkbox" class="Texte10" name="public" value="responsables" id="',this.id.cbPublicResponsables,'" onkeyup="',this.Nom,'.surSaisiePublic (value, checked)" onclick="',this.Nom,'.surSaisiePublic (value, checked)" /><label for="',this.id.cbPublicResponsables,'">',GTraductions.getValeur('actualites.public.responsables'),'</label></div>');if(GApplication.droits.get(TypeDroits.fonctionnalites.gestionEleves)){T.push('<div class="Texte10 EspaceHaut"><input type="checkbox" class="Texte10" name="public" value="eleves" id="',this.id.cbPublicEleves,'" onkeyup="',this.Nom,'.surSaisiePublic (value, checked)" onclick="',this.Nom,'.surSaisiePublic (value, checked)" /><label for="',this.id.cbPublicEleves,'">',GTraductions.getValeur('actualites.public.eleves'),'</label></div>');}
T.push('</div>');T.push('<div class="InlineBlock AlignementHaut GrandEspaceGauche">');T.push('<div class="Texte10 EspaceHaut"><input type="checkbox" class="Texte10" name="public" value="professeurs" id="',this.id.cbPublicProfesseurs,'" onkeyup="',this.Nom,'.surSaisiePublic (value, checked)" onclick="',this.Nom,'.surSaisiePublic (value, checked)" /><label for="',this.id.cbPublicProfesseurs,'">',GTraductions.getValeur('actualites.public.professeurs'),'</label></div>');if(GApplication.droits.get(TypeDroits.fonctionnalites.gestionPersonnels)){T.push('<div class="Texte10 EspaceHaut"><input type="checkbox" class="Texte10" name="public" value="personnels" id="',this.id.cbPublicPersonnels,'" onkeyup="',this.Nom,'.surSaisiePublic (value, checked)" onclick="',this.Nom,'.surSaisiePublic (value, checked)" /><label for="',this.id.cbPublicPersonnels,'">',GTraductions.getValeur('actualites.public.personnels'),'</label></div>');}
T.push('</div>');if(GApplication.droits.get(TypeDroits.fonctionnalites.gestionStages)){T.push('<div class="InlineBlock AlignementHaut GrandEspaceGauche">','<div class="Texte10 EspaceHaut"><input type="checkbox" class="Texte10" name="public" value="maitreDeStage" id="',this.id.cbPublicMaitreDeStage,'" onkeyup="',this.Nom,'.surSaisiePublic (value, checked)" onclick="',this.Nom,'.surSaisiePublic (value, checked)" /><label for="',this.id.cbPublicMaitreDeStage,'">',GTraductions.getValeur('actualites.public.maitreDeStage'),'</label></div>','</div>');}
T.push('</div>');return T.join('');}
function _composePanelIndividu(){const T=[];const lEleve=GTraductions.getValeur('actualites.Eleves');const lProf=GTraductions.getValeur('actualites.Professeurs');let lWidthA=GChaine.GetLongueurChaineDansDiv(lEleve,10,false);let lWidthB=GChaine.GetLongueurChaineDansDiv(lProf,10,false);const lWidth1=(lWidthA>lWidthB)?lWidthA+5:lWidthB+5;const lResp=GTraductions.getValeur('actualites.Responsables');const lPers=GTraductions.getValeur('actualites.Personnels');lWidthA=GChaine.GetLongueurChaineDansDiv(lResp,10,false);lWidthB=GChaine.GetLongueurChaineDansDiv(lPers,10,false);const lWidth2=(lWidthA>lWidthB)?lWidthA+5:lWidthB+5;const lMDS=GTraductions.getValeur('actualites.MaitresDeStage');const lInsp=GTraductions.getValeur('actualites.Inspecteurs');lWidthA=GChaine.GetLongueurChaineDansDiv(lMDS,10,false);lWidthB=GChaine.GetLongueurChaineDansDiv(lInsp,10,false);const lWidth3=(lWidthA>lWidthB)?lWidthA+5:lWidthB+5;T.push('<div class="NoWrap p-all-s">');T.push('<div class="InlineBlock AlignementHaut EspaceGauche GrandEspaceDroit">');if(GApplication.droits.get(TypeDroits.fonctionnalites.gestionEleves)){T.push('<div class="NoWrap EspaceBas">','<div class="InlineBlock AlignementHaut AlignementDroit PetitEspaceHaut" style="',GStyle.composeWidth(lWidth1),'">',lEleve,'</div>','<div class="InlineBlock AlignementHaut EspaceGauche" id="',this.GetNomInstance(this.identBtEleve),'"></div>','<div class="InlineBlock AlignementHaut EspaceGauche PetitEspaceHaut" style="min-width : 20px;" id="',this.id.countEleve,'">0</div>','</div>');}
T.push('<div class="NoWrap">','<div class="InlineBlock AlignementHaut AlignementDroit PetitEspaceHaut" style="',GStyle.composeWidth(lWidth1),'">',lProf,'</div>','<div class="InlineBlock AlignementHaut EspaceGauche" id="',this.GetNomInstance(this.identBtProf),'"></div>','<div class="InlineBlock AlignementHaut EspaceGauche PetitEspaceHaut" style="min-width : 20px;" id="',this.id.countProfesseur,'">0</div>','</div>');T.push('</div>');T.push('<div class="InlineBlock AlignementHaut GrandEspaceGauche GrandEspaceDroit">');T.push('<div class="NoWrap EspaceBas">','<div class="InlineBlock AlignementHaut AlignementDroit PetitEspaceHaut" style="',GStyle.composeWidth(lWidth2),'">',lResp,'</div>','<div class="InlineBlock AlignementHaut EspaceGauche" id="',this.GetNomInstance(this.identBtResp),'"></div>','<div class="InlineBlock AlignementHaut EspaceGauche PetitEspaceHaut" style="min-width : 20px;" id="',this.id.countResponsable,'">0</div>','</div>');if(GApplication.droits.get(TypeDroits.fonctionnalites.gestionPersonnels)){T.push('<div class="NoWrap">','<div class="InlineBlock AlignementHaut AlignementDroit PetitEspaceHaut" style="',GStyle.composeWidth(lWidth2),'">',lPers,'</div>','<div class="InlineBlock AlignementHaut EspaceGauche" id="',this.GetNomInstance(this.identBtPers),'"></div>','<div class="InlineBlock AlignementHaut EspaceGauche PetitEspaceHaut" style="min-width : 20px;" id="',this.id.countPersonnel,'">0</div>','</div>');}
T.push('</div>');T.push('<div class="InlineBlock AlignementHaut GrandEspaceGauche">');if(GApplication.droits.get(TypeDroits.fonctionnalites.gestionStages)){T.push('<div class="NoWrap EspaceBas">','<div class="InlineBlock AlignementHaut AlignementDroit PetitEspaceHaut" style="',GStyle.composeWidth(lWidth3),'">',lMDS,'</div>','<div class="InlineBlock AlignementHaut EspaceGauche" id="',this.GetNomInstance(this.identBtMDS),'"></div>','<div class="InlineBlock AlignementHaut EspaceGauche PetitEspaceHaut" style="min-width : 20px;" id="',this.id.countMaitreDeStage,'">0</div>','</div>');}
if(GApplication.droits.get(TypeDroits.fonctionnalites.gestionIPR)){T.push('<div class="NoWrap">','<div class="InlineBlock AlignementHaut AlignementDroit PetitEspaceHaut" style="',GStyle.composeWidth(lWidth3),'">',lInsp,'</div>','<div class="InlineBlock AlignementHaut EspaceGauche" id="',this.GetNomInstance(this.identBtInsp),'"></div>','<div class="InlineBlock AlignementHaut EspaceGauche PetitEspaceHaut" style="min-width : 20px;" id="',this.id.countInspecteur,'">0</div>','</div>');}
T.push('</div>','</div>');return T.join('');}
function _composePanelIndividuSimple(aGenres){const T=[];let lAvecDroitFonctionnel=true;let lTraduction,lIDInstance,lIDCount;const lTailleLibelle=90;for(const i in aGenres){const lGenre=aGenres[i];switch(lGenre){case EGenreRessource.Enseignant:lAvecDroitFonctionnel=true;lTraduction=GTraductions.getValeur('actualites.Professeurs');lIDInstance=this.GetNomInstance(this.identBtProf);lIDCount=this.id.countProfesseur;break;case EGenreRessource.Eleve:lAvecDroitFonctionnel=GApplication.droits.get(TypeDroits.fonctionnalites.gestionEleves);lTraduction=GTraductions.getValeur('actualites.Eleves');lIDInstance=this.GetNomInstance(this.identBtEleve);lIDCount=this.id.countEleve;break;case EGenreRessource.Responsable:lAvecDroitFonctionnel=true;lTraduction=GTraductions.getValeur('actualites.Responsables');lIDInstance=this.GetNomInstance(this.identBtResp);lIDCount=this.id.countResponsable;break;case EGenreRessource.Personnel:lAvecDroitFonctionnel=GApplication.droits.get(TypeDroits.fonctionnalites.gestionPersonnels);lTraduction=GTraductions.getValeur('actualites.Personnels');lIDInstance=this.GetNomInstance(this.identBtPers);lIDCount=this.id.countPersonnel;break;case EGenreRessource.MaitreDeStage:lAvecDroitFonctionnel=GApplication.droits.get(TypeDroits.fonctionnalites.gestionStages);lTraduction=GTraductions.getValeur('actualites.MaitresDeStage');lIDInstance=this.GetNomInstance(this.identBtMDS);lIDCount=this.id.countMaitreDeStage;break;case EGenreRessource.InspecteurPedagogique:lAvecDroitFonctionnel=GApplication.droits.get(TypeDroits.fonctionnalites.gestionIPR);lTraduction=GTraductions.getValeur('actualites.Inspecteurs');lIDInstance=this.GetNomInstance(this.identBtInsp);lIDCount=this.id.countInspecteur;break;default:;break;}
if(lAvecDroitFonctionnel){T.push('<div class="flex-contain flex-center p-all-s">','<label class="m-left-xl text-right" style="width:',lTailleLibelle,'px;">',lTraduction,'</label>','<div class="m-left-l" id="',lIDInstance,'"></div>','<div class="m-left-l" id="',lIDCount,'">','</div>','</div>');if(lGenre===EGenreRessource.Eleve){T.push('<div class="flex-contain p-top flex-start m-left-xl" style="padding-left:',lTailleLibelle+12,'px;">','<div class="flex-contain flex-center">','<input type="checkbox" name="public" value="eleve_eleve" id="',this.id.cbEleve,'" onkeyup="',this.Nom,'.surSaisiePublic (value, checked)" onclick="',this.Nom,'.surSaisiePublic (value, checked)" />','<label for="',this.id.cbEleve,'"></label>','</div>','<div class="flex-contain">','<div class="flex-contain cols m-left-l">','<div class="flex-contain flex-center">','<input type="checkbox" name="public" value="eleve_resp1" id="',this.id.cbEleveResponsable1,'" onkeyup="',this.Nom,'.surSaisiePublic (value, checked)" onclick="',this.Nom,'.surSaisiePublic (value, checked)" />','<label for="',this.id.cbEleveResponsable1,'"></label>','</div>','<div class="flex-contain flex-center m-top-l">','<input type="checkbox" name="public" value="eleve_pp" id="',this.id.cbEleveProfsPrincipaux,'" onkeyup="',this.Nom,'.surSaisiePublic (value, checked)" onclick="',this.Nom,'.surSaisiePublic (value, checked)" />','<label for="',this.id.cbEleveProfsPrincipaux,'"></label>','</div>','</div>','<div class="flex-contain cols flex-start m-left-l">','   <div class="flex-contain flex-center">','       <input type="checkbox" name="public" value="eleve_resp2" id="',this.id.cbEleveResponsable2,'" onkeyup="',this.Nom,'.surSaisiePublic (value, checked)" onclick="',this.Nom,'.surSaisiePublic (value, checked)" />','       <label for="',this.id.cbEleveResponsable2,'"></label>','     </div>','<div class="flex-contain flex-center m-top-l">','<input type="checkbox" name="public" value="eleve_tuteurs" id="',this.id.cbEleveTuteurs,'" onkeyup="',this.Nom,'.surSaisiePublic (value, checked)" onclick="',this.Nom,'.surSaisiePublic (value, checked)" />','<label for="',this.id.cbEleveTuteurs,'"></label>','</div>','</div>','</div>','</div>');}}}
return T.join('');}
function avecListeDiffusionSelonEspace(){return[
EGenreEspace.Professeur,EGenreEspace.Mobile_Professeur,EGenreEspace.PrimProfesseur,EGenreEspace.Mobile_PrimProfesseur,EGenreEspace.Etablissement,EGenreEspace.Mobile_Etablissement
].indexOf(GEtatUtilisateur.GenreEspace)>=0;}
function _composeDestinataires(){const lHauteurPanelSeul=(this.height.zoneDestinataires-15);const lAvecListeDiffusion=avecListeDiffusionSelonEspace.call(this);const T=[];if(GEtatUtilisateur.pourPrimaire()){T.push('<div class="flex-contain">','<div class="fix-bloc p-top-l p-right-l flex-contain cols" style="width: 24px;">');if(lAvecListeDiffusion){T.push(`<div class="EspaceBas">${UtilitaireBoutonBandeau.getHtmlBtnListesDiffusion('btnAfficherListesDiffusion')}</div>`);}
T.push(`<div>${UtilitaireBoutonBandeau.getHtmlBtnSupprimer('btnSupprimerDestinataires')}</div>`);T.push('</div>','<div class="fluid-bloc flex-contain cols">','<fieldset class="fieldset-round-style">',`<legend>${GTraductions.getValeur('actualites.Edition.Destinataires')}</legend>`,`<div class="content-wrapper" style="height: ${lHauteurPanelSeul}px;" id="${this.id.panelDestinatairePrimaire}">${_composePanelDestinatairesPrimaire.call(this)}</div>`,'</fieldset>','</div>','</div>');} else if(this.genresRessourceAffDestinataire.length===0){T.push('<div class="flex-contain">','<div class="fix-bloc p-top-l p-right-l flex-contain cols" style="width: 24px;">');if(lAvecListeDiffusion){T.push(`<div class="EspaceBas">${UtilitaireBoutonBandeau.getHtmlBtnListesDiffusion('btnAfficherListesDiffusion')}</div>`);}
T.push(`<div>${UtilitaireBoutonBandeau.getHtmlBtnSupprimer('btnSupprimerDestinataires')}</div>`);T.push('</div>','<div class="fluid-bloc flex-contain cols">',`<div class="conteneur-tabs" id="${this.GetNomInstance(this.identTabs)}"></div>`,`<div class="tabs-contenu with-border"  style="height:${this.height.zoneDestinataires-32}px;">`,`<div id="${this.id.panelDestinataireEntite}">${_composePanelEntite.call(this)}</div>`,`<div id="${this.id.panelDestinataireIndividuel}">${_composePanelIndividu.call(this)}</div>`,`<div id="${this.id.panelDestinataireResponsables}">${_composePanelResponsables.call(this)}</div>`,'</div>','</div>','</div>');} else{if(($.inArray(EGenreRessource.Classe,this.genresRessourceAffDestinataire)>-1)||($.inArray(EGenreRessource.Groupe,this.genresRessourceAffDestinataire)>-1)){T.push('<fieldset class="fieldset-round-style">','<legend>',GTraductions.getValeur('actualites.Edition.Destinataires'),'</legend>','<div class="content-wrapper" style="height: ',lHauteurPanelSeul,'px;" id="',this.id.panelDestinataireEntite,'">',_composePanelClasseGroupe.call(this),'</div>','</fieldset>');} else{T.push('<fieldset class="fieldset-round-style">','<legend>',GTraductions.getValeur('actualites.Edition.Destinataires'),'</legend>','<div class="content-wrapper" style="height: ',lHauteurPanelSeul,'px;" id="',this.id.panelDestinataireIndividuel,'">',_composePanelIndividuSimple.call(this,this.genresRessourceAffDestinataire),'</div>','</fieldset>');}}
return T.join('');}
function _compose(){const H=[];H.push(`<div id="${this.id.destinataires}" class="EspaceBas">${_composeDestinataires.call(this)}</div>`);return H.join('');}
module.exports=ObjetDestinatairesAgenda;},fn:"objetdestinatairesagenda.js"});;
IE.fModule({f:function(exports,require,module,global){const{TypeDroits}=require('ObjetDroitsPN.js');const ObjetRequeteDonneesEditionInformation=require('ObjetRequeteDonneesEditionInformation.js');const GTinyInit=require('DeclarationTinyInitPN.js').GTinyInit;const DonneesListe_ActualitesChoix=require('DonneesListe_ActualitesChoix.js');const ObjetRequeteSaisieActualites=require('ObjetRequeteSaisieActualites.js');const GUID=require('GUID.js');const MethodesObjet=require('MethodesObjet.js');const GChaine=require('GChaine.js');const GHtml=require('GHtml.js');const GStyle=require('GStyle.js');const EGenreBoiteMessage=require('Enumere_BoiteMessage.js');const EGenreDocumentJoint=require('Enumere_DocumentJoint.js');const EGenreEtat=require('Enumere_Etat.js');const EGenreEvenementListe=require('Enumere_EvenementListe.js');const EGenreEvenementObjetSaisie=require('Enumere_EvenementObjetSaisie.js');const{GDate}=require('ObjetDate.js');const ObjetFenetre=require('ObjetFenetre.js');const ObjetListe=require('ObjetListe.js');const ObjetElement=require('ObjetElement.js');const ObjetListeElements=require('ObjetListeElements.js');const ObjetMenuContextuel=require('ObjetMenuContextuel.js');const ObjetSaisie=require('ObjetSaisie.js');const GTraductions=require('ObjetTraduction.js');const ObjetTri=require('ObjetTri.js');const TUtilitaireUrl=require('UtilitaireUrl.js');const DonneesListe_ActualitesQuestion=require('DonneesListe_ActualitesQuestion.js');const EGenreRessource=require('Enumere_Ressource.js');const ObjetFenetre_SelectionRessource=require('ObjetFenetre_SelectionRessource.js');const ObjetSelecteurPJ=require('ObjetSelecteurPJ.js');const TypeGenreReponseInternetActualite=require('TypeGenreReponseInternetActualite.js').TypeGenreReponseInternetActualite;const TypeHttpNotificationDonnes=require('TypeHttpNotificationDonnes.js').TypeHttpNotificationDonnes;const TUtilitaireInformations=require('UtilitaireInformations.js');const ObjetPublication=require('ObjetPublication.js');const ObjetDestinatairesAgenda=require('ObjetDestinatairesAgenda.js');const UtilitaireGenreRessource=require('GestionnaireBlocPN.js').UtilitaireGenreRessource;const UtilitaireGenreEspace=require('GestionnaireBlocPN.js').UtilitaireGenreEspace;const UtilitaireGenreReponse=require('GestionnaireBlocPN.js').UtilitaireGenreReponse;const ObjetMoteurActus=require('ObjetMoteurActus.js');const MoteurInfoSondage=require('MoteurInfoSondage.js').MoteurInfoSondage;const tag=require('tag.js');const TypeNote=require('TypeNote.js');class ObjetFenetre_EditionActualite extends ObjetFenetre{constructor(...aParams){super(...aParams);this.avecEtatSaisie=true;this.avecChoixAnonyme=true;this.forcerAR=false;this.id={titre:this.Nom+'_TitreActu',message:this.Nom+'_MessageActu',choixReponseAnonyme:this.Nom+'_choixReponseAnonyme',destinataires:this.Nom+'_Destinataires',listeQuestions:this.Nom+'_listeQuestions',cbAvecAR:this.Nom+'_AvecARActu',zonePJ:this.Nom+'_ZonePJActu',EditeurHTML:GUID.getId()+'_editeur',listePJ:this.Nom+'_ListePJ',listeCloud:this.Nom+'_ListeCloud',natureReponse:this.Nom+'_NatureActu',rbNominatif:this.Nom+'_Nominatif',rbAnonyme:this.Nom+'_Anonyme',tailleTexte:this.Nom+'_TailleTexteActu',conteneurListeChoixReponses:this.Nom+'_ConteneurListeReponses',partage:this.Nom+'_ZonePartageActu',accuseReception:this.Nom+'_ZoneARActu',publication:this.Nom+'publication',recupModele:this.Nom+'recupModele'};this.pourCarnetDeClasse=false;this.height={zoneReponseAnonyme:25,zoneMessage:345,zonePublication:25};this.widthTrad=0;let lWidthTrad=GChaine.GetLongueurChaineDansDiv(GTraductions.getValeur('actualites.Edition.ReponseASaisir'),10,true);if(lWidthTrad>this.widthTrad){this.widthTrad=lWidthTrad;}
lWidthTrad=GChaine.GetLongueurChaineDansDiv(GTraductions.getValeur('actualites.Edition.ChoixMultiple'),10,true);if(lWidthTrad>this.widthTrad){this.widthTrad=lWidthTrad;}
lWidthTrad=GChaine.GetLongueurChaineDansDiv(GTraductions.getValeur('actualites.Edition.ChoixUnique'),10,true);if(lWidthTrad>this.widthTrad){this.widthTrad=lWidthTrad;}
this.tailleMaxTitre=200;this.tailleMaxReponse=500;this.avecPublicationPageEtablissement=GApplication.droits.get(TypeDroits.communication.avecPublicationPageEtablissement);this.setUtilitaires({genreRessource:new UtilitaireGenreRessource(),genreEspace:new UtilitaireGenreEspace(),genreReponse:new UtilitaireGenreReponse()});}
setUtilitaires(aUtilitaires){this.utilitaires=aUtilitaires;this.moteur=new ObjetMoteurActus(this.utilitaires);this.moteurInfoSond=new MoteurInfoSondage(this.utilitaires);}
ConstruireInstances(){this.identDestinataires=this.Add(ObjetDestinatairesAgenda,_evntDestinataires.bind(this),_initDestinataires.bind(this));this.identCategorie=this.Add(ObjetSaisie,_evntCategorie.bind(this),_initCategorie.bind(this));this.identPJ=this.Add(ObjetSelecteurPJ,_evenementPJ.bind(this),_initialiserPJ.bind(this));this.identPublication=this.Add(ObjetPublication,_evenementPublication.bind(this),null);this.identQuestions=this.Add(ObjetListe,_evenementQuestion.bind(this),_initialiserQuestion);this.identChoix=this.Add(ObjetListe,_evenementListeChoix.bind(this),_initialiserListeChoix);}
avecCloudDisponibles(){return GEtatUtilisateur.listeCloud&&GEtatUtilisateur.listeCloud.GetNbrElements()>0;}
SetDonnees(aParam){this.pourCarnetDeClasse=!!aParam&&!!aParam.pourCarnetDeClasse?aParam.pourCarnetDeClasse:false;this.estCasModele=aParam.estModele;this.optionsFenetre.hauteurMin=660;if(aParam.avecChoixAnonyme!==undefined){this.avecChoixAnonyme=aParam.avecChoixAnonyme;}
this.avecRecupModele=(aParam.avecRecupModele===true);if(aParam.forcerAR!==null&&aParam.forcerAR!==undefined){this.forcerAR=aParam.forcerAR;if((this.forcerAR===true)&&(aParam.genreReponse===TypeGenreReponseInternetActualite.SansAR)){aParam.genreReponse=TypeGenreReponseInternetActualite.AvecAR;}}
if(!this.estCasModele){const lGenresRessourceAffDest=aParam&&aParam.genresPublic?aParam.genresPublic:(aParam.genrePublic&&aParam.genrePublic!==EGenreRessource.Aucune?[aParam.genrePublic]:[]);this.GetInstance(this.identDestinataires).setGenresRessourceAffDestinataire(lGenresRessourceAffDest);}
this.creation=aParam.creation||!aParam.donnee;const lParam={init:true};if(!this.estCasModele){if(aParam.cours&&aParam.date){lParam.avecCours=true;lParam.cours=aParam.cours;lParam.date=aParam.date;} else if(this.GetInstance(this.identDestinataires).estGenreInGenresRessourceAffDestinataire(EGenreRessource.Eleve)){lParam.avecPublic=true;lParam.listePublic=aParam.listePublic;} else if(aParam.listePublicDeListeDiffusion){lParam.listePublicDeListeDiffusion=aParam.listePublicDeListeDiffusion;} else if(aParam.punition&&aParam.eleve){this.pourPunitionIncident=true;this.punition=aParam.punition;lParam.eleve=aParam.eleve;lParam.punition=aParam.punition;} else if(aParam.incident){this.pourPunitionIncident=true;this.incident=aParam.incident;lParam.incident=aParam.incident;}}
new ObjetRequeteDonneesEditionInformation(this,_apresRequeteDonneesEditionInformation.bind(this,aParam)).lancerRequete(lParam);}
appliquerModele(aParam){const lModele=aParam.modele;this.information=TUtilitaireInformations.appliquerModeleSurExistant({modele:lModele,infoSond:this.information});this.information.SetEtat(_verifierEtatModification.call(this));}
actualiserSurAppliquerModele(){const lEstUneInformation=_estUneInformation.call(this);GHtml.setValue(this.id.titre,this.information.GetLibelle());_actualiserCategorie.call(this);this.question=undefined;_actualiserQuestions.call(this,{estCasSondage:!lEstUneInformation});}
actualiserListeCloud(){if(this.avecCloudDisponibles()){GHtml.setHtml(this.id.listeCloud,TUtilitaireUrl.construireListeUrls(this.question.listePiecesJointes,{genreFiltre:EGenreDocumentJoint.Cloud,separateur:' ',IEModelChips:'chipsFichierCloud'}),{controleur:this.controleur});}}
getControleur(aInstance){return $.extend(true,super.getControleur(aInstance),{chipsFichierCloud:{eventBtn:function(aIndice){const lElement=aInstance.question.listePiecesJointes.GetElement(aIndice);if(lElement){lElement.SetEtat(EGenreEtat.Suppression);aInstance.actualiserListeCloud();}}},boutonChoixIndividusPartage:{event:function(){if(!!aInstance.information){aInstance.afficherFenetreChoixIndividusPartage();}}},getHtmlNbIndividusPartage:function(){let lNbIndividusPartage=0;if(!!aInstance.information&&!!aInstance.information.listeIndividusPartage){lNbIndividusPartage=aInstance.information.listeIndividusPartage.GetNbrElements();}
return lNbIndividusPartage;},getHintIndividusPartage:function(){let H=[];if(!!aInstance.information&&!!aInstance.information.listeIndividusPartage){const lMaxIndividusAffiches=10;const lNbIndividusPartage=aInstance.information.listeIndividusPartage.GetNbrElements();if(lNbIndividusPartage<=lMaxIndividusAffiches){H=aInstance.information.listeIndividusPartage.getTableauLibelles();} else{aInstance.information.listeIndividusPartage.parcourir(function(D,aIndex){H.push(D.GetLibelle());if(aIndex>=(lMaxIndividusAffiches-1)){H.push('...');return false;}});}}
return(H.length>0?H.join('<br/>'):'');},btnRecupModele:{getNode:function(){$(this.node).eventValidation(function(){this.moteur.getListeModeles({estCasSondage:this.information.estSondage,evntClbck:function(aParam){this.appliquerModele({modele:aParam.modele});this.actualiserSurAppliquerModele();}.bind(this),listeCategories:this.listeCategories});}.bind(aInstance));},getTitle:function(){return GTraductions.getValeur('actualites.recupererModele');}},cbPublicationPageEtablissement:{getValue(){return!!aInstance.information&&aInstance.information.estInformation&&!!aInstance.information.publicationPageEtablissement;},setValue(aValue){if(!!aInstance.information&&aInstance.information.estInformation){aInstance.information.publicationPageEtablissement=aValue;}},getDisabled(){return!aInstance.information||!aInstance.information.publie;}},pourPageEtablissement:function(){if(aInstance.avecPublicationPageEtablissement&&!!aInstance.information&&aInstance.information.estInformation&&!aInstance.estCasModele&&!aInstance.pourPunitionIncident){return true;}
return false;},radioNatureReponse:{getValue(aTypeNature){const lTypeNatureActuel=aInstance.question?aInstance.question.genreReponse:TypeGenreReponseInternetActualite.ChoixUnique;return aTypeNature===lTypeNatureActuel;},setValue(aTypeNature,aValeur){if(aInstance.question&&aValeur){aInstance.question.genreReponse=aTypeNature;_initAffNature.call(aInstance);aInstance.question.SetEtat(EGenreEtat.Modification);aInstance.information.SetEtat(_verifierEtatModification.call(aInstance));}}},cbAvecLimiteNbChoixReponses:{getValue(){return aInstance.question&&aInstance.question.avecMaximum;},setValue(aValeur){if(aInstance.question){aInstance.question.avecMaximum=aValeur;if(aValeur){const lNombre=aInstance.question.nombreReponsesMax?aInstance.question.nombreReponsesMax:2;aInstance.question.nombreReponsesMax=lNombre;} else{aInstance.question.nombreReponsesMax=0;}
aInstance.question.SetEtat(EGenreEtat.Modification);aInstance.information.SetEtat(_verifierEtatModification.call(aInstance));}},getDisabled(){return!aInstance.question||aInstance.question.genreReponse!==TypeGenreReponseInternetActualite.ChoixMultiple;}},inputTailleTexteMax:{getNote(){const lValeurMin=1;let lValeur=null;if(aInstance.question){lValeur=aInstance.question.tailleReponse;}
lValeur=Math.max(lValeur,lValeurMin);return new TypeNote(lValeur);},setNote(aValue){if(aInstance.question&&!aValue.estUneNoteVide()){aInstance.question.tailleReponse=aValue.getValeur();aInstance.question.SetEtat(EGenreEtat.Modification);aInstance.information.SetEtat(_verifierEtatModification.call(aInstance));}},getOptionsNote(){return{avecVirgule:false,afficherAvecVirgule:false,hintSurErreur:true,avecAnnotation:false,sansNotePossible:false,textAlign:'center',min:1,max:aInstance.tailleMaxReponse};},getDisabled(){return!aInstance.question||aInstance.question.genreReponse!==TypeGenreReponseInternetActualite.Textuelle;}},inputNbMaximalesReponses:{getNote(){const lValeurMin=2;let lValeur=null;if(aInstance.question){lValeur=aInstance.question.nombreReponsesMax;}
lValeur=Math.max(lValeur,lValeurMin);return new TypeNote(lValeur);},setNote(aValue){if(aInstance.question&&!aValue.estUneNoteVide()){aInstance.question.nombreReponsesMax=aValue.getValeur();aInstance.question.SetEtat(EGenreEtat.Modification);aInstance.information.SetEtat(_verifierEtatModification.call(aInstance));}},getOptionsNote(){return{avecVirgule:false,afficherAvecVirgule:false,hintSurErreur:true,avecAnnotation:false,sansNotePossible:false,textAlign:'center',min:2,max:100};},getDisabled(){return this.controleur.cbAvecLimiteNbChoixReponses.getDisabled()||!aInstance.question||!aInstance.question.avecMaximum;}},cbAvecReponseAutre:{getValue(){let lReponseLibre=aInstance.getReponseReponseLibre(aInstance.question);return lReponseLibre&&lReponseLibre.Existe();},setValue(aValeur){if(aInstance.question&&aInstance.question.listeChoix){let lReponseLibre=aInstance.getReponseReponseLibre(aInstance.question);if(aValeur){if(lReponseLibre){lReponseLibre.Etat=EGenreEtat.Aucun;lReponseLibre.rang=aInstance.question.listeChoix.GetNbrElementsExistes();lReponseLibre.SetEtat(EGenreEtat.Modification);} else{const lLibelleAutre=GTraductions.getValeur('actualites.Edition.ChoixAutre');const lReponseAvecLibelleAutre=aInstance.getReponseAvecLibelle(aInstance.question,lLibelleAutre);if(!!lReponseAvecLibelleAutre){lReponseLibre=lReponseAvecLibelleAutre;lReponseLibre.SetLibelle(lLibelleAutre);lReponseLibre.SetEtat(EGenreEtat.Modification);} else{lReponseLibre=new ObjetElement(lLibelleAutre);lReponseLibre.SetEtat(EGenreEtat.Creation);aInstance.question.listeChoix.AddElement(lReponseLibre);}
lReponseLibre.estReponseLibre=true;lReponseLibre.rang=aInstance.question.listeChoix.GetNbrElementsExistes();}} else{if(lReponseLibre){lReponseLibre.SetEtat(EGenreEtat.Suppression);}}
aInstance.question.SetEtat(EGenreEtat.Modification);aInstance.information.SetEtat(_verifierEtatModification.call(aInstance));}}}});}
getReponseAvecLibelle(aQuestion,aLibelleRecherche){let lReponseAvecLibelle;if(aQuestion&&(aQuestion.genreReponse===TypeGenreReponseInternetActualite.ChoixMultiple||aQuestion.genreReponse===TypeGenreReponseInternetActualite.ChoixUnique)&&aQuestion.listeChoix&&aLibelleRecherche){aQuestion.listeChoix.getListeElements((aChoix) =>{if(aChoix&&aChoix.GetLibelle()&&aChoix.GetLibelle().toLowerCase()===aLibelleRecherche.toLowerCase()){lReponseAvecLibelle=aChoix;return false;}});}
return lReponseAvecLibelle;}
getReponseReponseLibre(aQuestion){let lReponseAutre;if(aQuestion&&(aQuestion.genreReponse===TypeGenreReponseInternetActualite.ChoixMultiple||aQuestion.genreReponse===TypeGenreReponseInternetActualite.ChoixUnique)&&aQuestion.listeChoix){aQuestion.listeChoix.getListeElements((aChoix) =>{if(aChoix.estReponseLibre){lReponseAutre=aChoix;return false;}});}
return lReponseAutre;}
afficherFenetreChoixIndividusPartage(){let lIndividusSelectionnes;if(!!this.information.listeIndividusPartage){lIndividusSelectionnes=MethodesObjet.dupliquer(this.information.listeIndividusPartage);} else{lIndividusSelectionnes=new ObjetListeElements();}
const lFenetre=ObjetFenetre.creerInstance(ObjetFenetre_SelectionRessource,{pere:this,evenement:function(aGenreRessource,aListeSelectionnee,aNumeroBouton){if(aNumeroBouton!==0){return;}
this.information.listeIndividusPartage=aListeSelectionnee;this.information.partageAEteModifie=true;},initialiser:function(aInstance){const lTitreFenetre=[];lTitreFenetre.push(GTraductions.getValeur('actualites.Professeurs'));lTitreFenetre.push(GTraductions.getValeur('actualites.Personnels'));aInstance.setOptionsFenetre({titre:lTitreFenetre.join(' / ')});}});lFenetre.setOptions_Fenetre_SelectionRessource({autoriseEltAucun:true});lFenetre.setDonnees({listeRessources:this.listeIndividusPossiblesPartage,listeRessourcesSelectionnees:lIndividusSelectionnes,genreRessource:EGenreRessource.Personnel});}
SurValidation(aGenreBouton){if(aGenreBouton===1){if(this.question&&GHtml.getDisplay(this.id.message)){const lEditeur=tinymce.get(this.id.EditeurHTML);const lContent=lEditeur.getContent();this.question.texte=lContent;this.question.SetEtat(EGenreEtat.Modification);if(GTinyInit.estContenuVide(this.question.texte)){GApplication.getMessage().afficher({type:EGenreBoiteMessage.Information,message:GTraductions.getValeur('actualites.MsgAucunContenu')});return;}}
if(!this.estCasModele&&!!this.information.publie&&!this.information.publicationPageEtablissement){let lIlYADesIndividusSelectionne=false;if(this.GetInstance(this.identDestinataires).estGenreInGenresRessourceAffDestinataire(EGenreRessource.Eleve)&&(this.information.listePublicIndividu.GetNbrElements()>0)){for(let i=0;i<this.information.listePublicIndividu.GetNbrElements()&&!lIlYADesIndividusSelectionne;i++){const lIndividu=this.information.listePublicIndividu.GetElement(i);if(lIndividu.Genre!==EGenreRessource.Eleve){lIlYADesIndividusSelectionne=true;}}
if(!lIlYADesIndividusSelectionne){lIlYADesIndividusSelectionne=this.information.avecEleve||this.information.avecResp1||this.information.avecResp2||this.information.avecProfsPrincipaux||this.information.avecTuteurs;}} else{lIlYADesIndividusSelectionne=(this.information.listePublicIndividu.GetNbrElements()>0)||!!this.information.avecDirecteur;}
const lNbPublicEntite=this.information.listePublicEntite.GetNbrElements();const lNbGenreEntite=this.information.genresPublicEntite.count();let lMessagePbDestinataires=null;if(GEtatUtilisateur.pourPrimaire()){if(lNbPublicEntite===0&&!lIlYADesIndividusSelectionne){lMessagePbDestinataires=GTraductions.getValeur('actualites.MsgAucunUnDestinataire');}} else{if(lNbGenreEntite>0&&lNbPublicEntite===0){lMessagePbDestinataires=GTraductions.getValeur('actualites.MsgSelectionnerUneClasseGroupe');} else if(lNbGenreEntite===0&&lNbPublicEntite>0){lMessagePbDestinataires=GTraductions.getValeur('actualites.MsgSelectionnerUneEntite');} else if(lNbPublicEntite===0&&!lIlYADesIndividusSelectionne){lMessagePbDestinataires=GTraductions.getValeur('actualites.MsgAucunUnDestinataire');}}
if(!!lMessagePbDestinataires){GApplication.getMessage().afficher({type:EGenreBoiteMessage.Information,message:lMessagePbDestinataires});return;}}
if((this.estCasModele===true)||!!this.information.publie){let lTestAucuneQuestion=true;let lTestPossedeAuMoinsUneQuestion=false;const lListeQuestionsVides=[];this.information.listeQuestions.parcourir(function(aQuestion){if(aQuestion.Existe()){lTestAucuneQuestion=false;if(aQuestion.genreReponse!==TypeGenreReponseInternetActualite.SansReponse){lTestPossedeAuMoinsUneQuestion=true;}
if(GTinyInit.estContenuVide(aQuestion.texte)){lListeQuestionsVides.push(aQuestion);}}});if(!lTestPossedeAuMoinsUneQuestion||lTestAucuneQuestion){GApplication.getMessage().afficher({type:EGenreBoiteMessage.Information,message:GTraductions.getValeur('actualites.MsgAucuneQuestion')});return;}
if(lListeQuestionsVides.length>0){GApplication.getMessage().afficher({type:EGenreBoiteMessage.Information,message:lListeQuestionsVides[0].genreReponse!==TypeGenreReponseInternetActualite.SansReponse?GTraductions.getValeur('actualites.saisirContenuQuestionN',[lListeQuestionsVides[0].indice]):GTraductions.getValeur('actualites.saisirContenuTexteN',[lListeQuestionsVides[0].indice])});return;}
this.information.SetEtat(_verifierEtatModification.bind(this)());}}
if(aGenreBouton===1){_validationAuto.bind(this)(aGenreBouton);} else{_finSurValidation.bind(this)(aGenreBouton);}}
getGenresRessourceAffDestinataire(){return this.GetInstance(this.identDestinataires).getGenresRessourceAffDestinataire();}
ComposeContenu(){const T=[];const lHeightDest=_getHeightDestinataires.call(this);T.push('<div class="flex-contain cols" style="height:100%">');T.push('<div class="EspaceBas" id="',this.GetInstance(this.identDestinataires).GetNom(),'" style="',GStyle.composeHeight(lHeightDest),'"></div>');T.push('<div id="',this.id.message,'" class="m-top">');T.push(_composeRecupModele.call(this));T.push('<div id="',this.id.choixReponseAnonyme,'">',_composeReponseAnonyme.call(this),'</div>');T.push(_composeTitre.bind(this)());T.push('<div class="flex-contain fluid-bloc m-bottom">',`<div class="fix-bloc m-right-l" id="${this.GetInstance(this.identQuestions).GetNom()}"></div>`,'<div class="fluid-bloc flex-contain cols">',`<div id="content_${this.id.message}"></div>`,'<div class="flex-contain">',`<div class="fix-bloc flex-contain cols">${_composePJ.bind(this)()}</div>`,'<div class="fluid-bloc flex-contain cols justify-between">',_composeTinyMessage.bind(this)(),'</div>','</div>',_composeNatureReponse.bind(this)(),_composeListePJ.bind(this)(),'</div>','</div>');T.push('</div>');T.push(`<div id="${this.id.message}_bis" class="fluid-bloc flex-contain p-all-xl" style="display: none;">`,this.composeMessage(GTraductions.getValeur('actualites.Edition.NonModifiable')),'</div>');T.push(_composeAccuseReception.bind(this)());T.push('<div class="general-conteneur fond-gris m-top cols">');T.push(`  <div id="${this.id.partage}" class="flex-contain flex-center p-top-l p-bottom-l">\n                <i class="icon_eye_open i-medium i-as-deco m-right"></i>\n                <label>${GTraductions.getValeur('actualites.Edition.DonnerAccesConsultationAuSondage')}</label>\n                <ie-bouton ie-model="boutonChoixIndividusPartage" class="m-left">...</ie-bouton>\n                <span ie-html="getHtmlNbIndividusPartage" ie-hint="getHintIndividusPartage" class="m-left"></span>\n              </div>`);T.push(`  <div id="${this.id.publication}" class="p-top-l p-bottom-l">\n                  <div id="${this.GetInstance(this.identPublication).GetNom()}"></div>\n              </div>`);if(this.avecPublicationPageEtablissement){T.push(tag('ie-checkbox',{'ie-model':'cbPublicationPageEtablissement','ie-display':'pourPageEtablissement',class:['p-top-l','p-bottom-l']},GTraductions.getValeur('actualites.Edition.publicationPageEtablissement')));}
T.push('</div>');T.push('</div>');return T.join('');}
surSaisieTitre(aValeur){this.information.SetLibelle(aValeur);this.information.SetEtat(_verifierEtatModification.bind(this)());}
surSaisieAnonyme(aValeur){switch(aValeur){case'nominatif':this.information.reponseAnonyme=false;_actualiserAffichageApresChoixAnonyme.bind(this)(false);break;case'anonyme':this.information.reponseAnonyme=true;_actualiserAffichageApresChoixAnonyme.bind(this)(true);break;default:;break;}}
surSaisieCBAvecAR(aValeur,aChecked){this.question.genreReponse=aChecked?TypeGenreReponseInternetActualite.AvecAR:TypeGenreReponseInternetActualite.SansAR;this.question.SetEtat(EGenreEtat.Modification);this.information.SetEtat(_verifierEtatModification.bind(this)());}
controlerSurValidation(){if(!!this.question&&this.tinySet){const lEditeur=tinymce.get(this.id.EditeurHTML);const lContent=lEditeur.getContent();this.question.texte=lContent;this.question.SetEtat(EGenreEtat.Modification);if(GTinyInit.estContenuVide(this.question.texte)){GApplication.getMessage().afficher({type:EGenreBoiteMessage.Information,message:GTraductions.getValeur('actualites.MsgAucunContenu')});return false;}}
return true;}}
function _estUneInformation(){return!!this.information&&!!this.information.estInformation;}
function _estUnSondage(){return!_estUneInformation.call(this);}
function _evntCategorie(aGenreEvenement,aElement){if(aGenreEvenement===EGenreEvenementObjetSaisie.selection){this.information.categorie=aElement;this.information.SetEtat(_verifierEtatModification.bind(this)());}}
function _evntDestinataires(){this.information.SetEtat(_verifierEtatModification.bind(this)());}
function _evenementPJ(){this.question.SetEtat(EGenreEtat.Modification);this.information.SetEtat(_verifierEtatModification.bind(this)());}
function _evenementPublication(aResult){this.information.publie=aResult.publie;if(!this.information.publie){this.information.publicationPageEtablissement=false;}
this.information.dateDebut=aResult.dateDebut;this.information.dateFin=aResult.dateFin;this.information.SetEtat(_verifierEtatModification.bind(this)());_actualiserLibelleBtnValider.call(this);}
function _actualiserLibelleBtnValider(){if(this.creation&&!this.information.estModele){const lStr=this.information.publie?GTraductions.getValeur('actualites.Publier'):GTraductions.getValeur('actualites.CreerBrouillon');this.setBoutonLibelle(1,lStr);}}
function _evenementQuestion(aParametres){let lIndice,lEditeur,lContent;switch(aParametres.genreEvenement){case EGenreEvenementListe.Selection:{const lQuestion=this.information.listeQuestions.GetElement(aParametres.ligne);if(!!this.question&&(lQuestion.GetNumero()===this.question.GetNumero()&&lQuestion.GetLibelle()===this.question.GetLibelle())){return;}
if(this.tinySet&&!!this.question){lEditeur=tinymce.get(this.id.EditeurHTML);lContent=lEditeur.getContent();this.question.texte=lContent;this.question.SetEtat(EGenreEtat.Modification);if(GTinyInit.estContenuVide(this.question.texte)&&this.question.Etat!==EGenreEtat.Suppression){GApplication.getMessage().afficher({type:EGenreBoiteMessage.Information,message:GTraductions.getValeur('actualites.MsgAucunContenu')});lIndice=this.information.listeQuestions.GetIndiceParElement(this.question);this.GetInstance(this.identQuestions).SelectionnerLigne({deselectionnerTout:true,ligne:lIndice,avecEvenement:false});return;}}
this.question=lQuestion;_actualiserAffichageQuestion.call(this);_actualiserDonneesQuestion.call(this);break;}
case EGenreEvenementListe.ApresSuppression:{let lNbr=this.information.listeQuestions.GetNbrElements()+1;let lRang=1;this.information.listeQuestions.setTri([ObjetTri.init('rang')]);this.information.listeQuestions.trier();let lIndiceT=1,lIndiceQ=1;this.information.listeQuestions.parcourir(function(aElement){if(aElement.Existe()){if(aElement.rang!==lRang){aElement.rang=lRang;aElement.SetEtat(EGenreEtat.Modification);}
lRang++;if(aElement.genreReponse===TypeGenreReponseInternetActualite.SansReponse){aElement.indice=lIndiceT;lIndiceT++;} else{aElement.indice=lIndiceQ;lIndiceQ++;}
aElement.SetLibelle(this.moteurInfoSond.getLibelleAffichageComposanteQuest({composante:aElement,rang:aElement.indice}));} else{aElement.rang=lNbr;lNbr++;}}.bind(this));this.information.listeQuestions.trier();this.GetInstance(this.identQuestions).Actualiser();if(this.information.listeQuestions.GetNbrElementsExistes()>0){this.GetInstance(this.identQuestions).SelectionnerLigne({ligne:0,avecEvenement:true});} else{this.question=undefined;_actualiserAffichageQuestion.call(this);_actualiserDonneesQuestion.call(this);}
break;}
case EGenreEvenementListe.Creation:if(this.tinySet&&!!this.question){lEditeur=tinymce.get(this.id.EditeurHTML);lContent=lEditeur.getContent();this.question.texte=lContent;this.question.SetEtat(EGenreEtat.Modification);if(GTinyInit.estContenuVide(this.question.texte)){GApplication.getMessage().afficher({type:EGenreBoiteMessage.Information,message:GTraductions.getValeur('actualites.MsgAucunContenu')});return EGenreEvenementListe.Creation;}}
ObjetMenuContextuel.afficher({pere:this,initCommandes:function(aInstanceMenu){aInstanceMenu.add(GTraductions.getValeur('actualites.Edition.Question'),true,function(){creerNouvelleQuestionOuTexte.call(this,false);});aInstanceMenu.add(GTraductions.getValeur('actualites.Edition.Texte'),true,function(){creerNouvelleQuestionOuTexte.call(this,true);});}});return EGenreEvenementListe.Creation;default:;break;}}
function creerNouvelleQuestionOuTexte(aEstUnTexte){const lListe=this.information.listeQuestions.getListeElements(function(aElement){return aElement.Existe()&&((aEstUnTexte&&(aElement.genreReponse===TypeGenreReponseInternetActualite.SansReponse))||(!aEstUnTexte&&(aElement.genreReponse!==TypeGenreReponseInternetActualite.SansReponse)));}.bind(this));const lParamsCreationQuestion={rang:this.information.listeQuestions.GetNbrElementsExistes()+1,rangElement:lListe.GetNbrElementsExistes()+1,genreReponse:aEstUnTexte?TypeGenreReponseInternetActualite.SansReponse:TypeGenreReponseInternetActualite.ChoixUnique};const lElement=TUtilitaireInformations.creerQuestionOuTexteSondage(lParamsCreationQuestion);this.information.listeQuestions.AddElement(lElement);lElement.SetEtat(EGenreEtat.Creation);this.information.SetEtat(EGenreEtat.Modification);this.GetInstance(this.identQuestions).Actualiser();const lIndice=this.information.listeQuestions.GetIndiceParElement(lElement);if(lIndice!==null){this.GetInstance(this.identQuestions).SelectionnerLigne({ligne:lIndice,avecEvenement:true});}}
function _evenementListeChoix(aParametres){switch(aParametres.genreEvenement){case EGenreEvenementListe.Selection:this.choixSelectionnee=this.question.listeChoix.GetElement(aParametres.ligne);break;case EGenreEvenementListe.ApresCreation:case EGenreEvenementListe.ApresEdition:case EGenreEvenementListe.ApresSuppression:this.choixVide=false;break;default:;break;}}
function _callbackSurMenuContextListeQuestions(aGenreActionMenu,aIndiceLigne){switch(aGenreActionMenu){case DonneesListe_ActualitesQuestion.genreAction.monter:case DonneesListe_ActualitesQuestion.genreAction.descendre:this.GetInstance(this.identQuestions).Actualiser(aIndiceLigne===-1?true:false);if(aIndiceLigne> -1){this.GetInstance(this.identQuestions).SelectionnerLigne({ligne:aIndiceLigne,avecEvenement:true});}
break;case DonneesListe_ActualitesQuestion.genreAction.dupliquer:return this.controlerSurValidation();}}
function _callbackSurMenuContextListeChoix(aGenreActionMenu,aIndiceLigne){switch(aGenreActionMenu){case DonneesListe_ActualitesChoix.genreAction.monter:case DonneesListe_ActualitesChoix.genreAction.descendre:if(aIndiceLigne> -1){this.GetInstance(this.identChoix).SelectionnerLigne({ligne:aIndiceLigne,avecEvenement:true});}
break;}}
function _initCategorie(aInstance){aInstance.setOptions_ObjetSaisie({longueur:150});}
function _initDestinataires(aInstance){aInstance.setOptions({largeur:this.optionsFenetre.largeur,avecCallbckSurModification:true});}
function _initialiserPJ(aInstance){aInstance.setOptions({genrePJ:EGenreDocumentJoint.Fichier,genreRessourcePJ:EGenreRessource.DocJointEtablissement,avecMenuContextuel:false,maxFiles:0,maxSize:GApplication.droits.get(TypeDroits.tailleMaxDocJointEtablissement),ouvrirFenetreChoixTypesAjout:true,optionsCloud:{avecCloud:true,callbackChoixFichierParFichier:surAjoutUnFichierCloud.bind(this),callbackChoixFichierFinal:surAjoutFinalFichiersClouds.bind(this)},avecAjoutExistante:true,avecBoutonSupp:true,fenetrePieceJointe:{avecBoutonActualiser:false},avecEtatSaisie:this.avecEtatSaisie,title:GTraductions.getValeur('actualites.Edition.ModifPJ')});}
function surAjoutUnFichierCloud(aNewElement){this.question.listePiecesJointes.AddElement(aNewElement);this.listePJ.AddElement(aNewElement);}
function surAjoutFinalFichiersClouds(){this.actualiserListeCloud();this.information.SetEtat(EGenreEtat.Modification);if(this.avecEtatSaisie){this.SetEtatSaisie(true);}}
function _initialiserQuestion(aInstance){const lColonnes=[];lColonnes.push({id:DonneesListe_ActualitesQuestion.colonnes.libelle,taille:140});aInstance.setOptionsListe({colonnes:lColonnes,titreCreation:GTraductions.getValeur('actualites.question.nouveau'),avecLigneCreation:true,boutons:[{genre:ObjetListe.typeBouton.monter},{genre:ObjetListe.typeBouton.descendre},{genre:ObjetListe.typeBouton.supprimer}
]});}
function _initialiserListeChoix(aInstance){const lColonnes=[];lColonnes.push({id:DonneesListe_ActualitesChoix.colonnes.libelle,taille:'100%'});aInstance.setOptionsListe({colonnes:lColonnes,titreCreation:GTraductions.getValeur('actualites.choix.nouveau'),listeCreations:0,avecLigneCreation:true,boutons:[{genre:ObjetListe.typeBouton.monter},{genre:ObjetListe.typeBouton.descendre},{genre:ObjetListe.typeBouton.supprimer}
]});}
function _initTiny(aEstUneInformation,aReset){if(this.id.EditeurHTML&&!tinymce.get(this.id.EditeurHTML)){const lHeight=this.height.zoneMessage-80-(aEstUneInformation?0:83);GTinyInit.init({id:this.id.EditeurHTML,min_height:lHeight,max_height:lHeight}).then((function(){_initTiny.call(this,aEstUneInformation,aReset);}).bind(this),function(){});return;}
if(aReset){tinymce.get(this.id.EditeurHTML).setContent('');}
if(!!this.question){tinymce.get(this.id.EditeurHTML).show();tinymce.get(this.id.EditeurHTML).setContent(this.question.texte);this.tinySet=true;} else{tinymce.get(this.id.EditeurHTML).hide();this.tinySet=false;}}
function _apresRequeteDonneesEditionInformation(aParam,aDonnees){if(aDonnees.listeCategories){this.listeCategories=aDonnees.listeCategories;}
if(aDonnees.tailleMaxTitre){this.tailleMaxTitre=aDonnees.tailleMaxTitre;}
if(aDonnees.tailleMaxReponse){this.tailleMaxReponse=aDonnees.tailleMaxReponse;}
if(!this.estCasModele){if(!!aDonnees.listeIndividusPossiblesPartage){const lListeIndividusPossiblesPartage=new ObjetListeElements();const lHashParents={};aDonnees.listeIndividusPossiblesPartage.parcourir(function(aElement){const lGenre=aElement.GetGenre();if(!lHashParents[lGenre]){const lParent=new ObjetElement(lGenre===EGenreRessource.Personnel?GTraductions.getValeur('Messagerie.Personnels'):GTraductions.getValeur('Messagerie.Profs'),0,lGenre);lHashParents[lGenre]=lParent;lParent.estUnDeploiement=true;lParent.estDeploye=true;lListeIndividusPossiblesPartage.AddElement(lParent);}
aElement.pere=lHashParents[lGenre];lListeIndividusPossiblesPartage.AddElement(aElement);});this.listeIndividusPossiblesPartage=lListeIndividusPossiblesPartage;}}
if(this.pourPunitionIncident&&aDonnees.categorie){this.indiceCategorieParDefaut=this.listeCategories.getIndiceElementParFiltre(function(aElement){return aElement.GetNumero()===aDonnees.categorie.GetNumero();});} else{this.indiceCategorieParDefaut=this.listeCategories.getIndiceElementParFiltre(function(aElement){return aElement.estDefaut;});}
if(this.indiceCategorieParDefaut===-1){this.indiceCategorieParDefaut=0;}
const lListePeriodes=TUtilitaireInformations.initListePeriodes.bind(this)();this.listePJ=MethodesObjet.dupliquer(GEtatUtilisateur.listeDonnees[TypeHttpNotificationDonnes.THND_ListeDocJointEtablissement]);if(aDonnees.equipe){this.listePartiel=aDonnees.equipe;} else{this.listePartiel=undefined;}
this.tinySet=false;const lNewInformation=TUtilitaireInformations.initialiserNouveauItem.call(this,{categorie:this.listeCategories.GetElement(this.indiceCategorieParDefaut),genresPublic:aParam.genresPublic,listePublic:(aParam.cours&&aParam.date)?aDonnees.listeEleves:(aParam.listePublic?aParam.listePublic:(aDonnees&&aDonnees.listePublic?aDonnees.listePublic:undefined)),genreReponse:aParam.genreReponse,publie:aParam.publie,estModele:this.estCasModele});this.informationOriginal=aParam.donnee||lNewInformation;if(aDonnees.titre){this.informationOriginal.SetLibelle(aDonnees.titre);}
this.information=MethodesObjet.dupliquer(this.informationOriginal);this.information.avecEleve=false;this.information.avecResp1=false;this.information.avecResp2=false;this.information.avecProfsPrincipaux=false;this.information.avecTuteurs=false;if(aParam.listePublicDeListeDiffusion){this.information.listePublicIndividu=MethodesObjet.dupliquer(aParam.listePublicDeListeDiffusion);}
if(aParam.appliquerModele!==null&&aParam.appliquerModele!==undefined){this.appliquerModele({modele:aParam.appliquerModele});}
GHtml.setValue(this.id.titre,this.information.GetLibelle());const lEstUneInformation=_estUneInformation.call(this);let lHeightDest;if(!this.information.estVerrouille){lHeightDest=_getHeightDestinataires.call(this);this.height.zoneMessage=this.optionsFenetre.hauteur-((lEstUneInformation||!this.avecChoixAnonyme)?0:this.height.zoneReponseAnonyme)-lHeightDest-this.height.zonePublication-90;} else{this.height.zoneMessage=200;this.optionsFenetre.hauteur=360;this.optionsFenetre.hauteurMin=360;}
this.Afficher();if(!this.information.estVerrouille){GHtml.setDisplay(this.id.message+'_bis',false);GHtml.setDisplay(this.id.message,true);$('#'+this.GetInstance(this.identDestinataires).GetNom().escapeJQ()).height(lHeightDest);} else{GHtml.setDisplay(this.id.message,false);GHtml.setDisplay(this.id.message+'_bis',true);}
_actualiserCategorie.call(this);if(this.avecRecupModele){$('#'+this.id.recupModele.escapeJQ()).show();} else{$('#'+this.id.recupModele.escapeJQ()).hide();}
if(lEstUneInformation){$('#'+this.GetInstance(this.identQuestions).GetNom().escapeJQ()).hide();$('#'+this.id.choixReponseAnonyme.escapeJQ()).hide();$('#'+this.id.natureReponse.escapeJQ()).hide();if(this.forcerAR!==true){$('#'+this.id.accuseReception.escapeJQ()).show();} else{$('#'+this.id.accuseReception.escapeJQ()).hide();}
$('#'+this.id.partage.escapeJQ()).hide();} else{$('#'+this.GetInstance(this.identQuestions).GetNom().escapeJQ()).show();if(this.avecChoixAnonyme){$('#'+this.id.choixReponseAnonyme.escapeJQ()).show();} else{$('#'+this.id.choixReponseAnonyme.escapeJQ()).hide();}
$('#'+this.id.accuseReception.escapeJQ()).hide();$('#'+this.id.natureReponse.escapeJQ()).show();if(!this.estCasModele){$('#'+this.id.partage.escapeJQ()).show();}}
_actualiserQuestions.call(this,{estCasSondage:!lEstUneInformation,texteInfo:aDonnees.texte});if(!this.estCasModele){_actualiserPublication.call(this,{listePeriodes:lListePeriodes});_actualiserDestinataires.call(this,{donnees:aDonnees});} else{$('#'+this.id.publication.escapeJQ()).hide();$('#'+this.id.partage.escapeJQ()).hide();$('#'+this.GetInstance(this.identDestinataires).GetNom().escapeJQ()).hide();}
_actualiserLibelleBtnValider.call(this);}
function _actualiserAffichageQuestion(){this.choixVide=(!this.question||this.question.listeChoix.GetNbrElements()===0);if(!!this.question){$('#'+'content_'+this.id.message.escapeJQ()).show();} else{$('#'+'content_'+this.id.message.escapeJQ()).hide();}
if(!this.information.estVerrouille){_initTiny.call(this,_estUneInformation.call(this),this.tinySet);}
if(!!this.question){if(this.question.genreReponse===TypeGenreReponseInternetActualite.SansReponse){$('#'+this.id.natureReponse.escapeJQ()).hide();$('#'+this.id.conteneurListeChoixReponses.escapeJQ()).hide();} else{if(!this.information.estInformation){$('#'+this.id.natureReponse.escapeJQ()).show();}
if(this.question.genreReponse===TypeGenreReponseInternetActualite.ChoixMultiple||this.question.genreReponse===TypeGenreReponseInternetActualite.ChoixUnique){$('#'+this.id.conteneurListeChoixReponses.escapeJQ()).show();_initListeChoix.bind(this)();this.GetInstance(this.identChoix).SetDonnees(new DonneesListe_ActualitesChoix(this.question.listeChoix,_callbackSurMenuContextListeChoix.bind(this)));} else{$('#'+this.id.conteneurListeChoixReponses.escapeJQ()).hide();}}}}
function _actualiserDonneesQuestion(){this.GetInstance(this.identPJ).SetActif(!!this.question);if(!this.question){return;}
this.GetInstance(this.identPJ).SetDonnees({idListePJ:this.id.listePJ,listePJ:this.question.listePiecesJointes,listeTotale:this.listePJ,idContextFocus:this.Nom});const lEstSondage=_estUnSondage.call(this);$('#'+this.id.cbAvecAR.escapeJQ()).inputDisabled(lEstSondage).inputChecked(this.question.genreReponse!==TypeGenreReponseInternetActualite.SansAR).jIECheckBox();$('#'+this.id.rbNominatif.escapeJQ()).inputChecked(!this.information.reponseAnonyme).inputDisabled(!!this.information.estVerrouille).jIECheckBox();$('#'+this.id.rbAnonyme.escapeJQ()).inputChecked(!!this.information.reponseAnonyme).inputDisabled(!!this.information.estVerrouille).jIECheckBox();if(this.avecChoixAnonyme){_actualiserAffichageApresChoixAnonyme.call(this,this.information.reponseAnonyme);}
this.actualiserListeCloud();}
function _validationAuto(aGenreBouton){if(this.information&&(this.information.Etat!==EGenreEtat.Aucun)){this.information.SetEtat(EGenreEtat.Modification);const lListeActualites=new ObjetListeElements();lListeActualites.AddElement(this.information);const lGenresRessAffDestinataire=this.getGenresRessourceAffDestinataire();const lObjetSaisie={listeActualite:lListeActualites,validationDirecte:false,saisieActualite:true,listeDocuments:this.listePJ,genresAffDestinataire:lGenresRessAffDestinataire};if(this.pourPunitionIncident){if(this.punition){lObjetSaisie.punition=this.punition;}
if(this.incident){lObjetSaisie.incident=this.incident;}}
new ObjetRequeteSaisieActualites(this,_reponseSaisie.bind(this,1)).addUpload({listeFichiers:this.listePJ,listeDJCloud:this.listePJ}).lancerRequete(lObjetSaisie);} else{_finSurValidation.call(this,aGenreBouton);}}
function _reponseSaisie(aGenreBouton,aXml,aJSONReponse,aJSONRapportSaisie){if(this.avecEtatSaisie){this.SetEtatSaisie(false);}
_finSurValidation.bind(this)(aGenreBouton,aJSONRapportSaisie);}
function _finSurValidation(aGenreBouton,aJSONRapportSaisie){if(this.id.EditeurHTML&&tinymce.get(this.id.EditeurHTML)&&GHtml.getDisplay(this.id.message)){tinymce.execCommand('mceFocus',false,this.id.EditeurHTML);tinymce.execCommand('mceRemoveControl',false,this.id.EditeurHTML);}
this.Fermer();const lParam={creation:this.creation,donnee:(aGenreBouton===0?this.informationOriginal:this.information),listeDocuments:this.listePJ};if(this.pourPunitionIncident){if(this.punition){lParam.punition=this.punition;}
if(this.incident){lParam.incident=this.incident;}}
if(aJSONRapportSaisie!==null&&aJSONRapportSaisie!==undefined&&aJSONRapportSaisie.infoSondCree!==null&&aJSONRapportSaisie.infoSondCree!==undefined){lParam.eltCree=aJSONRapportSaisie.infoSondCree;}
this.callback.appel(aGenreBouton,lParam);}
function _composeRecupModele(){const T=[];T.push('<div id="',this.id.recupModele,'" class="m-bottom-l m-left-big m-top-l">');T.push('<ie-bouton ie-icon="icon_sondage_bibliotheque" ie-node="btnRecupModele.getNode" ie-title="btnRecupModele.getTitle" class="themeBoutonNeutre">',GTraductions.getValeur('actualites.recupererModele'),'</ie-bouton>');T.push('</div>');return T.join('');}
function _composeTitre(){const T=[];T.push(`<div class="flex-contain flex-center justify-between m-bottom-xl">\n            <label class="Gras fix-bloc m-right" width="2.4rem">${GTraductions.getValeur('actualites.Colonnes.Titre')} : </label>\n             <input class="round-style fluid-bloc m-right" name="titre" maxlength=${this.tailleMaxTitre}" id ="${this.id.titre}" onkeyup="${this.Nom}.surSaisieTitre (value)" onchange="${this.Nom}.surSaisieTitre (value)" />\n             <div class="Gras" id="${this.GetInstance(this.identCategorie).GetNom()}"></div>\n          </div>`);return T.join('');}
function _composePJ(){const T=[];T.push('<div id="',this.GetInstance(this.identPJ).GetNom(),'"></div>');return T.join('');}
function _composeTinyMessage(){let lHeightARetirer=0;if(_estUnSondage.call(this)){lHeightARetirer=83;}
const T=[];T.push('<div class="round-style" id="',this.id.EditeurHTML,'" style="width:100%;',GStyle.composeHeight(this.height.zoneMessage-80-lHeightARetirer),'"></div>');return T.join('');}
function _composeListePJ(){const T=[];T.push('<div class="Texte10 m-top" id="',this.id.listePJ,'" style="width:100%;"></div>');T.push('<div class="Texte10" id="',this.id.listeCloud,'" style="width:100%;"></div>');return T.join('');}
function _composeNatureReponse(){const T=[];T.push('<div id="',this.id.natureReponse,'" class="fluid-bloc flex-contain cols m-top-l">');T.push('<div style="margin-left:3.5rem;">');T.push('<div class="flex-contain flex-center">','<ie-radio ie-model="radioNatureReponse(',TypeGenreReponseInternetActualite.Textuelle,')">',GTraductions.getValeur('actualites.Edition.ReponseASaisir'),'</ie-radio>','<ie-inputnote id ="',this.id.tailleTexte,'" ie-model="inputTailleTexteMax" style="width: 3.5rem;" class="round-style m-left m-right"></ie-inputnote>','<label for="',this.id.tailleTexte,'">',GTraductions.getValeur('actualites.Edition.NbrCharTexte'),'</label>','</div>');T.push('<div>','<ie-radio ie-model="radioNatureReponse(',TypeGenreReponseInternetActualite.ChoixUnique,')">',GTraductions.getValeur('actualites.Edition.ChoixUnique'),'</ie-radio>','</div>');T.push('<div class="flex-contain flex-center">','<ie-radio ie-model="radioNatureReponse(',TypeGenreReponseInternetActualite.ChoixMultiple,')">',GTraductions.getValeur('actualites.Edition.ChoixMultiple'),'</ie-radio>','<ie-checkbox ie-model="cbAvecLimiteNbChoixReponses" class="m-left">',GTraductions.getValeur('actualites.Edition.NbrChoix'),'</ie-checkbox>','<ie-inputnote ie-model="inputNbMaximalesReponses" style="width: 2.5rem;" class="round-style m-left"></ie-inputnote>','</div>');T.push('</div>');T.push('<div id="',this.id.conteneurListeChoixReponses,'">','<div>','<ie-checkbox ie-model="cbAvecReponseAutre">',GTraductions.getValeur('actualites.Edition.AvecChoixAutre'),'</ie-checkbox>','</div>','<div style="',GStyle.composeHeight(110),'" id="',this.GetInstance(this.identChoix).GetNom(),'">','</div>','</div>');T.push('</div>');return T.join('');}
function _composeAccuseReception(){const T=[];T.push('<div id="',this.id.accuseReception,'" class="general-conteneur m-top p-top-l p-bottom-l flex-center">','<input type="checkbox" name="avecAR" value="avecAR" id ="',this.id.cbAvecAR,'" onkeyup="',this.Nom,'.surSaisieCBAvecAR (value, checked)" onclick="',this.Nom,'.surSaisieCBAvecAR (value, checked)" />','<label for="',this.id.cbAvecAR,'">',GTraductions.getValeur('actualites.Edition.AvecAR'),'</label>','</div>');return T.join('');}
function _composeReponseAnonyme(){const T=[];T.push('<div class="flex-contain flex-center m-top-l m-bottom-l m-left-big">','<div class="flex-contain flex-center fix-bloc m-right-l m-left-l">','<input type="radio" name="reponseAnonyme" value="nominatif" id="',this.id.rbNominatif,'" onkeyup="',this.Nom,'.surSaisieAnonyme (value)" onclick="',this.Nom,'.surSaisieAnonyme (value)" />','<label for="',this.id.rbNominatif,'">',GTraductions.getValeur('actualites.Nominatif'),'</label>','</div>','<div class="flex-contain flex-center fix-bloc m-right-l">','<input type="radio" name="reponseAnonyme" value="anonyme" id="',this.id.rbAnonyme,'" onkeyup="',this.Nom,'.surSaisieAnonyme (value)" onclick="',this.Nom,'.surSaisieAnonyme (value)" />','<label for="',this.id.rbAnonyme,'">',GTraductions.getValeur('actualites.Anonyme'),'</label>','</div>','</div>');return T.join('');}
function _getHeightDestinataires(){return this.GetInstance(this.identDestinataires).getHeightZoneDestinataires()+10;}
function _actualiserAffichageApresChoixAnonyme(){this.GetInstance(this.identDestinataires).actualiserTabs({avecIndividuelInvisible:false,conserverSelection:true});}
function _initAffNature(){if(this.question.genreReponse===TypeGenreReponseInternetActualite.ChoixMultiple||this.question.genreReponse===TypeGenreReponseInternetActualite.ChoixUnique){$('#'+this.id.conteneurListeChoixReponses.escapeJQ()).show();_initListeChoix.bind(this)();this.GetInstance(this.identChoix).SetDonnees(new DonneesListe_ActualitesChoix(this.question.listeChoix,_callbackSurMenuContextListeChoix.bind(this)));} else{$('#'+this.id.conteneurListeChoixReponses.escapeJQ()).hide();}}
function _reinitChoixUnique(aQuestion){let lNewChoix=new ObjetElement(GTraductions.getValeur('actualites.Oui'));lNewChoix.rang=1;lNewChoix.SetEtat(EGenreEtat.Creation);aQuestion.listeChoix.AddElement(lNewChoix);lNewChoix=new ObjetElement(GTraductions.getValeur('actualites.Non'));lNewChoix.rang=2;lNewChoix.SetEtat(EGenreEtat.Creation);aQuestion.listeChoix.AddElement(lNewChoix);}
function _initListeChoix(){if(this.question.genreReponse===TypeGenreReponseInternetActualite.ChoixUnique&&this.question.listeChoix.GetNbrElements()===0){_reinitChoixUnique.call(this,this.question);}
if(this.choixVide&&this.question.genreReponse===TypeGenreReponseInternetActualite.ChoixMultiple){this.question.listeChoix=new ObjetListeElements();}}
function _publicEstModifie(){if(this.estCasModele){return false;}
let lTestListePublicIndividu=false,lElement,lElementOriginal;const lTestCocheAvecDirecteur=(this.information.avecDirecteur!==this.informationOriginal.avecDirecteur);const lTestCocheAvecElevesRattaches=(this.information.avecElevesRattaches!==this.informationOriginal.avecElevesRattaches);let lTestGenrePublic=!this.information.genresPublicEntite.contains(this.informationOriginal.genresPublicEntite)||!this.informationOriginal.genresPublicEntite.contains(this.information.genresPublicEntite);if(!lTestGenrePublic){lTestListePublicIndividu=this.information.listePublicEntite.GetNbrElements()!==this.informationOriginal.listePublicEntite.GetNbrElements();for(let i=0;i<this.information.listePublicEntite.GetNbrElements()&&!lTestGenrePublic;i++){lElement=this.information.listePublicEntite.GetElement(i);lElementOriginal=this.informationOriginal.listePublicEntite.GetElementParNumeroEtGenre(lElement.GetNumero(),lElement.GetGenre());lTestGenrePublic=!(lElementOriginal&&lElementOriginal.existeNumero());}
lTestListePublicIndividu=(lTestListePublicIndividu)||this.information.listePublicIndividu.GetNbrElements()!==this.informationOriginal.listePublicIndividu.GetNbrElements();for(let i=0;i<this.information.listePublicIndividu.GetNbrElements()&&!lTestListePublicIndividu;i++){lElement=this.information.listePublicIndividu.GetElement(i);lElementOriginal=this.informationOriginal.listePublicIndividu.GetElementParNumeroEtGenre(lElement.GetNumero(),lElement.GetGenre());lTestListePublicIndividu=!(lElementOriginal&&lElementOriginal.existeNumero());}}
return lTestGenrePublic||lTestListePublicIndividu||lTestCocheAvecElevesRattaches||lTestCocheAvecDirecteur;}
function _verifierEtatModification(){let lVerifSelonCtx=false;if(!this.estCasModele){this.information.avecModificationPublic=this.creation||_publicEstModifie.bind(this)();lVerifSelonCtx=(this.information.publie!==this.informationOriginal.publie)||(!GDate.estJourEgal(this.information.dateDebut,this.informationOriginal.dateDebut))||(!GDate.estJourEgal(this.information.dateFin,this.informationOriginal.dateFin))||
this.information.avecModificationPublic||
!!this.information.partageAEteModifie;}
const lTest=lVerifSelonCtx||(this.information.GetLibelle()!==this.informationOriginal.GetLibelle())||(this.information.categorie.GetNumero()!==this.informationOriginal.categorie.GetNumero())||
this.information.listeQuestions.existeElementPourValidation();return lTest?EGenreEtat.Modification:EGenreEtat.Aucun;}
function _actualiserCategorie(){const lIndice=this.listeCategories.GetIndiceParNumeroEtGenre(this.information.categorie.GetNumero(),this.information.categorie.GetGenre());this.GetInstance(this.identCategorie).SetDonnees(this.listeCategories,lIndice?lIndice:0);}
function _actualiserQuestions(aParam){if(aParam.estCasSondage){this.GetInstance(this.identQuestions).SetDonnees(new DonneesListe_ActualitesQuestion(this.information.listeQuestions,_callbackSurMenuContextListeQuestions.bind(this),{genreReponse:new UtilitaireGenreReponse()}),0);} else{this.question=this.information.listeQuestions.GetNbrElementsExistes()>0?this.information.listeQuestions.GetPremierElement():TUtilitaireInformations.creerQuestionOuTexteSondage();if(aParam.texteInfo){this.question.texte=aParam.texteInfo;}
_actualiserAffichageQuestion.call(this);_actualiserDonneesQuestion.call(this);}}
function _actualiserPublication(aParam){this.GetInstance(this.identPublication).SetDonnees({publie:this.information.publie,dateDebut:this.information.dateDebut,dateFin:this.information.dateFin,listePeriodes:aParam.listePeriodes,estSondage:this.information.estSondage});}
function _actualiserDestinataires(aParam){this.GetInstance(this.identDestinataires).setChoixResponsableParEntite(this.pourCarnetDeClasse);this.GetInstance(this.identDestinataires).SetDonnees(this.information,aParam.donnees);}
module.exports=ObjetFenetre_EditionActualite;},fn:"objetfenetre_editionactualite.js"});;
IE.fModule({f:function(exports,require,module,global){const{ObjetRequeteSaisie}=require('ObjetRequeteJSON.js');const Requetes=require('CollectionRequetes.js');class ObjetRequeteGenererFichiersResultatsSondage extends ObjetRequeteSaisie{constructor(...aParams){super(...aParams);}
actionApresRequete(){this.callbackReussite.appel({messageErreur:this.messageErreur,listeFichiersResultatsCrees:this.JSONRapportSaisie?this.JSONRapportSaisie.listeFichiersResultats:null});}}
Requetes.inscrire('GenererFichiersResultatsSondage',ObjetRequeteGenererFichiersResultatsSondage);module.exports=ObjetRequeteGenererFichiersResultatsSondage;},fn:"objetrequetegenererfichiersresultatssondage.js"});;
IE.fModule({f:function(exports,require,module,global){const{ObjetRequeteSaisie}=require('ObjetRequeteJSON.js');const Requetes=require('CollectionRequetes.js');class ObjetRequeteSaisieFichierResultatsSondage extends ObjetRequeteSaisie{constructor(...aParams){super(...aParams);}
lancerRequete(aParametres){$.extend(this.JSON,aParametres);return this.appelAsynchrone();}
actionApresRequete(aXml,aGenreReponse){this.callbackReussite.appel(aXml,aGenreReponse,this.JSONRapportSaisie);}}
Requetes.inscrire('SaisieFichierResultatsSondage',ObjetRequeteSaisieFichierResultatsSondage);module.exports=ObjetRequeteSaisieFichierResultatsSondage;},fn:"objetrequetesaisiefichierresultatssondage.js"});;
IE.fModule({f:function(exports,require,module,global){const{TypeDroits}=require('ObjetDroitsPN.js');const GUID=require('GUID.js');const MethodesObjet=require('MethodesObjet.js');const MethodesTableau=require('MethodesTableau.js');const GChaine=require('GChaine.js');const GHtml=require('GHtml.js');const GStyle=require('GStyle.js');const EGenreBoiteMessage=require('Enumere_BoiteMessage.js');const EGenreDocumentJoint=require('Enumere_DocumentJoint.js');const EGenreEtat=require('Enumere_Etat.js');const ObjetFenetre=require('ObjetFenetre.js');const ObjetElement=require('ObjetElement.js');const ObjetListeElements=require('ObjetListeElements.js');const GTraductions=require('ObjetTraduction.js');const ObjetTri=require('ObjetTri.js');const TUtilitaireUrl=require('UtilitaireUrl.js');const EGenreEspace=require('Enumere_Espace.js');const EGenreRessource=require('Enumere_Ressource.js');const ObjetSelecteurPJ=require('ObjetSelecteurPJ.js');const TypeHttpNotificationDonnes=require('TypeHttpNotificationDonnes.js').TypeHttpNotificationDonnes;const TUtilitaireMessagerie=require('UtilitaireMessagerie.js');const TypeThemeBouton=require('Type_ThemeBouton.js');const GTinyInit=require('DeclarationTinyInitPN.js').GTinyInit;const MoteurMessagerie=require('MoteurMessagerie.js');const tag=require('tag.js');class ObjetFenetre_Message extends ObjetFenetre{constructor(...aParams){super(...aParams);this.setOptionsFenetre({titre:GTraductions.getValeur('Messagerie.TitreFenetre'),largeur:630,avecTailleSelonContenu:true,listeBoutons:[{libelle:GTraductions.getValeur('Annuler'),theme:TypeThemeBouton.secondaire},{libelle:GTraductions.getValeur('Messagerie.BtnEnvoyer'),theme:TypeThemeBouton.primaire}],avecPieceJointe:TUtilitaireMessagerie.avecAjoutPieceJointeMessage(),avecTiny:TUtilitaireMessagerie.avecEditeurTiny(),avecSauvegardeBrouillon:false});this.moteurMessagerie=new MoteurMessagerie().setOptions({instance:this,avecTiny:this.optionsFenetre.avecTiny});this.C_largeurLabelChamps=50;this.idEntete=GUID.getId();this.idCopieAutresResp=GUID.getId();this.idContenuMsg=GUID.getId();this.id_destinataires_conteneur=GUID.getId();this.id_destinataires=GUID.getId();this.idTypesDestinataire={eleve:1,responsable1:2,responsable2:3,profsprincipaux:4,tuteurs:5,equipePedagogique:6};this.estAvecDirecteur=false;this.idDiscussion=GUID.getId();this.idLibellePJ=GUID.getId();this.idLibelleCloud=GUID.getId();}
getControleur(aInstance){return $.extend(true,super.getControleur(this),{estVisibleInclureResponsables:function(){return this.instance.avecCBInclureDelegues;},cbInclureResponsables:{getValue:function(){return this.instance.inclureResponsablesDeleguesClasse?this.instance.inclureResponsablesDeleguesClasse:false;},setValue:function(aValue){this.instance.inclureResponsablesDeleguesClasse=aValue;}},afficherLegende:function(){return!!(aInstance.message&&aInstance.message.legende);},getLegende:function(){return aInstance.message&&aInstance.message.legende?aInstance.message.legende:'';},getObjetTexte:function(){return this.instance.message&&this.instance.message.objet?this.instance.message.objet||'':'';},inputObjet:{getValue:function(){return this.instance.message&&this.instance.message.objet?this.instance.message.objet||'':'';},setValue:function(aValue){if(this.instance.message){this.instance.message.objet=aValue;}}},chipsFichierCloud:{eventBtn:function(aIndice){const lElement=this.instance.message.listeFichiers.GetElement(aIndice);if(lElement){lElement.SetEtat(EGenreEtat.Suppression);_actualiserSelecteurPJ.call(this.instance);this.instance.actualiserListeCloud();this.instance.message.SetEtat(EGenreEtat.Modification);}}},textareaSansTiny:{getValue:function(){return this.instance.message?this.instance.message.contenu:'';},setValue:function(aValue){this.instance.message.contenu=aValue;}},visuMessage:{hintPublic:function(aNumeroMessage,aGauche){return TUtilitaireMessagerie.getStrHintPublicMessage_promise(aInstance,aNumeroMessage,aGauche,false,this.node);}},cbProfsCarnetL:{getValue:function(aNumeroArticle){return aInstance.listeSelectionProfsCarnetLiaison.GetElementParNumero(aNumeroArticle);},setValue:function(aNumeroArticle,aValue){if(!aValue){if(aInstance.listeSelectionProfsCarnetLiaison.GetNbrElements()===1){return;}
const lIndice=aInstance.listeSelectionProfsCarnetLiaison.GetIndiceParNumeroEtGenre(aNumeroArticle);if(lIndice>=0){aInstance.listeSelectionProfsCarnetLiaison.remove(lIndice);}} else{if(!aInstance.listeSelectionProfsCarnetLiaison.GetElementParNumero(aNumeroArticle)){aInstance.listeSelectionProfsCarnetLiaison.add(new ObjetElement('',aNumeroArticle));}}}},cbTypeDestinatairePourEleve:{getValue:function(aIdTypeDestinataire){return aInstance._estDestinatairePossibleEstCocheEtActif(aIdTypeDestinataire);},setValue:function(aIdTypeDestinataire,aValue){const lTypeDestinataire=aInstance._getTypeDestinatairesPossiblesPourEleve(aIdTypeDestinataire);if(!!lTypeDestinataire&&!!lTypeDestinataire.actif){lTypeDestinataire.estCoche=aValue;}},getDisabled:function(aIdTypeDestinataire){const lTypeDestinataire=aInstance._getTypeDestinatairesPossiblesPourEleve(aIdTypeDestinataire);return!lTypeDestinataire||!lTypeDestinataire.actif;},getLibelle:function(aIdTypeDestinataire){const lTexte=[];const lTypeDestinataire=aInstance._getTypeDestinatairesPossiblesPourEleve(aIdTypeDestinataire);if(!!lTypeDestinataire){lTexte.push(lTypeDestinataire.label);if(lTypeDestinataire.nb){lTexte.push(' (',lTypeDestinataire.nb,')');}}
return lTexte.join('');}},cbDestinataireDirecteur:{getValue(){return!!aInstance.estAvecDirecteur;},setValue(aValue){aInstance.estAvecDirecteur=aValue;}},cbInclureResp2:{getValue(){let lListe=aInstance.param.ListeRessources;let lActif=false;lListe.parcourir(function(aDest){if(aDest.GetGenre()===EGenreRessource.Responsable){lActif=aDest.Actif;}});return lActif;},setValue(aValue){let lListe=aInstance.param.ListeRessources;lListe.parcourir(function(aDest){if(aDest.GetGenre()===EGenreRessource.Responsable){aDest.Actif=aValue;}});}}});}
_autorisePJ(){return this.optionsFenetre.avecPieceJointe;}
_autoriseTiny(){return this.optionsFenetre.avecTiny;}
avecCloudDisponibles(){return GEtatUtilisateur.listeCloud&&GEtatUtilisateur.listeCloud.GetNbrElements()>0;}
ConstruireInstances(){if(this._autorisePJ()){this.identSelecteurPJ=this.Add(ObjetSelecteurPJ,_evntSelecteurPJ.bind(this),_initSelecteurPJ.bind(this));}
if(this.optionsFenetre.avecChoixDestinataires){this.identDestinataire=this.Add(require('ObjetDestinatairesMessagerie.js'),null,null);}}
RecupererDonnees(){this.listePJ=this._autorisePJ()&&GEtatUtilisateur.listeDonnees?MethodesObjet.dupliquer(GEtatUtilisateur.listeDonnees[TypeHttpNotificationDonnes.THND_ListeDocJointEtablissement]):new ObjetListeElements();}
_infosDest(aNb,aHint){return{nbDest:aNb,arrHint:aHint,hintDest:_toHint.bind(aHint)};}
_formatterDonneesPourAffichage(){if(!this.optionsFenetre.avecChoixDestinataires){return this._formatterDonneesParGenreRessource();}}
_formatterDonneesParGenreRessource(){let lNb=0;const lHint=[];switch(this.param.genreRessource){case EGenreRessource.Classe:case EGenreRessource.Groupe:{const lEquipe=this._getListeDestinataires();let lNbEquipe=0;let lHintEquipe=[];if(lEquipe){lEquipe.setTri([ObjetTri.init('Genre'),ObjetTri.init('Position')]);lEquipe.trier();lNbEquipe=lEquipe.GetNbrElements();lHintEquipe=lEquipe.getTableauLibelles();}
return{destinataires:this._infosDest(lNbEquipe,lHintEquipe)};}
case EGenreRessource.Eleve:{const lThis=this;let lNbResp1=0,lNbResp2=0,lNbPP=0,lNbTuteurs=0,lNbEquipePeda=0;let lHintResp1=[],lHintResp2=[],lHintPP=[],lHintTuteurs=[],lHintEquipePeda=[];for(let i=0,lNbr=this.param.listeSelectionnee.GetNbrElements();i<lNbr;i++){const lElt=this.param.listeSelectionnee.GetElement(i);if(lElt.avecDiscussion){this.donneesDest.eleves.AddElement(lElt);lNb++;lHint.push(lElt.GetLibelle());}
if(lElt.listeRessources){for(let j=0,lNbrJ=lElt.listeRessources.GetNbrElements();j<lNbrJ;j++){const lEltJ=lElt.listeRessources.GetElement(j);if(lEltJ.existeNumero()&&lEltJ.avecDiscussion){switch(j){case 0:if(!this.donneesDest.respLegal1.GetElementParNumero(lEltJ.GetNumero())){lNbResp1++;lHintResp1.push(lEltJ.GetLibelle());this.donneesDest.respLegal1.AddElement(lEltJ);}
break;case 1:if(!this.donneesDest.respLegal2.GetElementParNumero(lEltJ.GetNumero())){lNbResp2++;lHintResp2.push(lEltJ.GetLibelle());this.donneesDest.respLegal2.AddElement(lEltJ);}
break;}
if(!this.donneesDest.respLegaux.GetElementParNumero(lEltJ.GetNumero())){this.donneesDest.respLegaux.AddElement(lEltJ);}}}}
if(lElt.listePP){lElt.listePP.parcourir(function(aPP){if(aPP.existeNumero()&&aPP.avecDiscussion&&!MethodesTableau.existe(aPP.GetNumero(),lThis.donneesDest.profsprincipaux.getTableauNumeros())){lThis.donneesDest.profsprincipaux.AddElement(aPP);}});}
if(!!lElt.listeTuteurs){lElt.listeTuteurs.parcourir(function(aTuteurEleve){if(aTuteurEleve.existeNumero()&&aTuteurEleve.avecDiscussion&&!MethodesTableau.existe(aTuteurEleve.GetNumero(),lThis.donneesDest.tuteurs.getTableauNumeros())){lThis.donneesDest.tuteurs.AddElement(aTuteurEleve);}});}
if(!!lElt.listeEquipePeda){lElt.listeEquipePeda.parcourir(function(aMembreEquipePeda){if(aMembreEquipePeda.existeNumero()&&aMembreEquipePeda.avecDiscussion&&!MethodesTableau.existe(aMembreEquipePeda.GetNumero(),lThis.donneesDest.equipePeda.getTableauNumeros())){lThis.donneesDest.equipePeda.AddElement(aMembreEquipePeda);}});}}
if(!!this.donneesDest.profsprincipaux&&this.donneesDest.profsprincipaux.GetNbrElements()>0){this.donneesDest.profsprincipaux.trier();lNbPP=this.donneesDest.profsprincipaux.GetNbrElements();lHintPP=this.donneesDest.profsprincipaux.getTableauLibelles();}
if(!!this.donneesDest.tuteurs&&this.donneesDest.tuteurs.GetNbrElements()>0){this.donneesDest.tuteurs.trier();lNbTuteurs=this.donneesDest.tuteurs.GetNbrElements();lHintTuteurs=this.donneesDest.tuteurs.getTableauLibelles();}
if(!!this.donneesDest.equipePeda&&this.donneesDest.equipePeda.GetNbrElements()>0){this.donneesDest.equipePeda.trier();lNbEquipePeda=this.donneesDest.equipePeda.GetNbrElements();lHintEquipePeda=this.donneesDest.equipePeda.getTableauLibelles();}
return{eleves:this._infosDest(lNb,lHint),resp1:this._infosDest(lNbResp1,lHintResp1),resp2:this._infosDest(lNbResp2,lHintResp2),pp:this._infosDest(lNbPP,lHintPP),tuteurs:this._infosDest(lNbTuteurs,lHintTuteurs),equipePeda:this._infosDest(lNbEquipePeda,lHintEquipePeda)};}
case EGenreRessource.Responsable:case EGenreRessource.Enseignant:case EGenreRessource.Personnel:if(MethodesTableau.existe(GEtatUtilisateur.GenreEspace,[EGenreEspace.Eleve,EGenreEspace.Parent])){for(let i=0,lNbr=this.param.listeSelectionnee.GetNbrElements();i<lNbr;i++){const lElt=this.param.listeSelectionnee.GetElement(i);if(lElt.avecDiscussion){lNb++;lHint.push(lElt.GetLibelle());this.donneesDest.destinataires.AddElement(lElt);}}} else{for(let i=0,lNbr=this.param.listeSelectionnee.GetNbrElements();i<lNbr;i++){const lElt=this.param.listeSelectionnee.GetElement(i);lNb++;lHint.push(lElt.GetLibelle());}}
return{destinataires:this._infosDest(lNb,lHint)};default:;break;}}
_setDestinataires(){if(!this.optionsFenetre.avecChoixDestinataires){this._setDestinatairesParGenreRessource();} else{const lInstanceDest=this.GetInstance(this.identDestinataire)
;lInstanceDest.SetDonnees(this.param.genresRessources,this.avecIndicationDiscussionInterdit,this.param.avecListeDiffusion);}}
_getListeTypeDestinatairesPossiblesPourEleve(){const lListeTypesDestinataires=[];if(this.param.genreRessource===EGenreRessource.Eleve){let lDestinataireEleve;const lAutresDestinataires=[];const lAvecEleves=TUtilitaireMessagerie.estGenreDestinataireAutorise(EGenreRessource.Eleve);const lAvecParents=TUtilitaireMessagerie.estGenreDestinataireAutorise(EGenreRessource.Responsable);const lAvecPP=TUtilitaireMessagerie.estGenreDestinataireAutorise(EGenreRessource.Enseignant);const lAvecTuteurs=TUtilitaireMessagerie.estGenreDestinataireAutorise(EGenreRessource.Enseignant);const lAvecEquipePeda=TUtilitaireMessagerie.estGenreDestinataireAutorise(EGenreRessource.Enseignant);if(this.destinataires.eleves.nbDest>1){lDestinataireEleve={hint:lAvecEleves?this.destinataires.eleves.hintDest():GTraductions.getValeur('Messagerie.CommEleveInactif'),nb:this.destinataires.eleves.nbDest,id:this.idTypesDestinataire.eleve,label:GTraductions.getValeur('Messagerie.Eleves'),actif:lAvecEleves,estCoche:false};if(this.destinataires.resp1.nbDest>0){lAutresDestinataires.push({hint:lAvecParents?this.destinataires.resp1.hintDest():GTraductions.getValeur('Messagerie.CommParentInactif'),nb:this.destinataires.resp1.nbDest,id:this.idTypesDestinataire.responsable1,label:GTraductions.getValeur('Messagerie.Resp1Legal'),actif:lAvecParents,estCoche:false});}
if(this.destinataires.resp2.nbDest>0){lAutresDestinataires.push({hint:lAvecParents?this.destinataires.resp2.hintDest():GTraductions.getValeur('Messagerie.CommParentInactif'),nb:this.destinataires.resp2.nbDest,id:this.idTypesDestinataire.responsable2,label:GTraductions.getValeur('Messagerie.Resp2Legal'),actif:lAvecParents,estCoche:false});}} else{lDestinataireEleve={hint:lAvecEleves?'':GTraductions.getValeur('Messagerie.CommEleveInactif'),nb:null,id:this.idTypesDestinataire.eleve,label:this.destinataires.eleves.hintDest(),actif:lAvecEleves,estCoche:false};if(this.destinataires.resp1.nbDest>0){lAutresDestinataires.push({hint:lAvecParents?'':GTraductions.getValeur('Messagerie.CommParentInactif'),nb:null,id:this.idTypesDestinataire.responsable1,label:this.destinataires.resp1.hintDest(),actif:lAvecParents,estCoche:false});}
if(this.destinataires.resp2.nbDest>0){lAutresDestinataires.push({hint:lAvecParents?'':GTraductions.getValeur('Messagerie.CommParentInactif'),nb:null,id:this.idTypesDestinataire.responsable2,label:this.destinataires.resp2.hintDest(),actif:lAvecParents,estCoche:false});}}
let lALaLigneAuProchain=true;if(lAvecPP&&this.destinataires.pp&&this.destinataires.pp.nbDest>0){let lHintPP,lLabelPP,lNbPP=null;if(this.destinataires.pp.nbDest>1){lHintPP=this.destinataires.pp.hintDest();lLabelPP=GTraductions.getValeur('Messagerie.ProfsPrincipaux');lNbPP=this.destinataires.pp.nbDest;} else{lHintPP=GTraductions.getValeur('Messagerie.ProfPrincipal');lLabelPP=this.destinataires.pp.hintDest()+' ('+GTraductions.getValeur('Messagerie.abbrPP')+')';}
lAutresDestinataires.push({hint:lHintPP,nb:lNbPP,id:this.idTypesDestinataire.profsprincipaux,label:lLabelPP,actif:lAvecPP,estCoche:false,aLaLigne:lALaLigneAuProchain});lALaLigneAuProchain=false;}
if(lAvecTuteurs&&this.destinataires.tuteurs&&this.destinataires.tuteurs.nbDest>0){let lHintTuteur,lLabelTuteur,lNbTuteur=null;if(this.destinataires.tuteurs.nbDest>1){lHintTuteur=this.destinataires.tuteurs.hintDest();lLabelTuteur=GTraductions.getValeur('Messagerie.Tuteurs');lNbTuteur=this.destinataires.tuteurs.nbDest;} else{lHintTuteur=GTraductions.getValeur('Messagerie.Tuteur');lLabelTuteur=this.destinataires.tuteurs.hintDest()+' ('+GTraductions.getValeur('Messagerie.abbrTuteur')+')';}
lAutresDestinataires.push({hint:lHintTuteur,nb:lNbTuteur,id:this.idTypesDestinataire.tuteurs,label:lLabelTuteur,actif:lAvecTuteurs,estCoche:false,aLaLigne:lALaLigneAuProchain});}
if(lAvecEquipePeda&&this.destinataires.equipePeda&&this.destinataires.equipePeda.nbDest>0){lALaLigneAuProchain=true;lAutresDestinataires.push({hint:this.destinataires.equipePeda.hintDest(),nb:this.destinataires.equipePeda.nbDest,id:this.idTypesDestinataire.equipePedagogique,label:GTraductions.getValeur('Messagerie.EquipePeda'),actif:lAvecEquipePeda,estCoche:false,aLaLigne:lALaLigneAuProchain});}
lListeTypesDestinataires.push(lDestinataireEleve);lListeTypesDestinataires.push(lAutresDestinataires);}
return lListeTypesDestinataires;}
_getTypeDestinatairesPossiblesPourEleve(aIdTypeDestinataire){let lResult=null;if(this.param.genreRessource===EGenreRessource.Eleve){if(!this.cache_listDestPourEleves){return lResult;}
const lListeDestinatairesPossibles=this.cache_listDestPourEleves;let lListeCompletesAPlat=[];lListeCompletesAPlat.push(lListeDestinatairesPossibles[0]);lListeCompletesAPlat=lListeCompletesAPlat.concat(lListeDestinatairesPossibles[1]);for(let i=0;i<lListeCompletesAPlat.length;i++){if(lListeCompletesAPlat[i].id===aIdTypeDestinataire){lResult=lListeCompletesAPlat[i];break;}}}
return lResult;}
_estDestinatairePossibleEstCocheEtActif(aIdTypeDestinataire){const lTypeDestinataire=this._getTypeDestinatairesPossiblesPourEleve(aIdTypeDestinataire);return!!lTypeDestinataire&&lTypeDestinataire.estCoche&&lTypeDestinataire.actif;}
_setDestinatairesParGenreRessource(){function _getTraducGenreRessource(aGenreRessource){switch(aGenreRessource){case EGenreRessource.Classe:case EGenreRessource.Groupe:return GTraductions.getValeur('Messagerie.EquipePeda');case EGenreRessource.Responsable:return GTraductions.getValeur('Messagerie.Parents');case EGenreRessource.Enseignant:return GTraductions.getValeur('Messagerie.Profs');case EGenreRessource.Personnel:return GTraductions.getValeur('Messagerie.Personnels');default:return'';}}
this.listeSelectionProfsCarnetLiaison=new ObjetListeElements();this.cache_listDestPourEleves=null;let lAvecChoixResponsable2=this.optionsFenetre.avecChoixResponsable2;const T=[];if(GEtatUtilisateur.pourPrimaire()){if(!!this.param.ListeRessources){T.push('<div class="EspaceBas" style="display:flex;align-items: flex-start;flex-direction: column;">');let lListeDestinatairesAAfficher=this.param.ListeRessources;let lListeChoixProfs=null;if(GEtatUtilisateur.GenreEspace===EGenreEspace.PrimParent){lListeChoixProfs=this.param.ListeRessources.getListeElements(function(D){return D.GetGenre()===EGenreRessource.Enseignant;});if(lListeChoixProfs.GetNbrElements()===1){lListeChoixProfs=null;} else{this.listeSelectionProfsCarnetLiaison.add(lListeChoixProfs.GetElement(0));lListeDestinatairesAAfficher=this.param.ListeRessources.getListeElements(function(D){return D.GetGenre()!==EGenreRessource.Enseignant;});}}
if(lListeChoixProfs){T.push('<div>');lListeChoixProfs.parcourir(function(D){T.push('<ie-checkbox',GHtml.composeAttr('ie-model','cbProfsCarnetL',D.GetNumero()),'class="AlignementMilieuVertical MargeDroit">',D.GetLibelle(),'</ie-checkbox>');});T.push('</div>');}
lListeDestinatairesAAfficher.parcourir(function(D){if(lAvecChoixResponsable2&&(D.GetGenre()===EGenreRessource.Responsable)){T.push('<ie-checkbox ',GHtml.composeAttr('ie-model','cbInclureResp2'),' class="PetitEspaceHaut">',D.GetLibelle(),'</ie-checkbox>');} else{T.push('<label class="EspaceDroit10">');T.push(D.GetLibelle());T.push('</label>');}});T.push('</div>');}
T.push('<div>','<ie-checkbox ie-model="cbDestinataireDirecteur">',GTraductions.getValeur('MessagerieCarnetLiaison.AjouterDirecteur'),'</ie-checkbox>','</div>');} else{switch(this.param.genreRessource){case EGenreRessource.Eleve:{this.cache_listDestPourEleves=this._getListeTypeDestinatairesPossiblesPourEleve();const lAffEleve=this.cache_listDestPourEleves[0];const lAffAutres=this.cache_listDestPourEleves[1];T.push('<div class="NoWrap" style="width:100%;">');T.push(_composeBlockGenreDestinataire(lAffEleve));T.push('<div class="InlineBlock AlignementHaut">');for(let i=0;i<lAffAutres.length;i++){T.push(_composeBlockGenreDestinataire(lAffAutres[i]));}
T.push('</div>');T.push('</div>');break;}
case EGenreRessource.Responsable:case EGenreRessource.Enseignant:case EGenreRessource.Personnel:if(this.destinataires.destinataires.nbDest>1){T.push('<div title="',this.destinataires.destinataires.hintDest(),'">',_getTraducGenreRessource(this.param.genreRessource),' (',this.destinataires.destinataires.nbDest,')','</div>');} else{T.push('<div>',this.destinataires.destinataires.hintDest(),'</div>');}
break;case EGenreRessource.Classe:case EGenreRessource.Groupe:if(this.destinataires.destinataires.nbDest>1){T.push('<div title="',this.destinataires.destinataires.hintDest(),'">',_getTraducGenreRessource(this.param.genreRessource),' (',this.destinataires.destinataires.nbDest,')','</div>');} else{T.push('<div>',_getTraducGenreRessource(this.param.genreRessource),' (',this.destinataires.destinataires.hintDest(),')','</div>');}
break;default:;break;}}
GHtml.setHtml(this.id_destinataires,T.join(''),{controleur:this.controleur});}
_getListeDestinataires(){if(this.optionsFenetre.avecChoixDestinataires){return this.GetInstance(this.identDestinataire).getListeDestinataires();}
let lNbr;let lListe=new ObjetListeElements();switch(this.param.genreRessource){case EGenreRessource.Eleve:{const lAvecEleves=this._estDestinatairePossibleEstCocheEtActif(this.idTypesDestinataire.eleve);const lAvecResp1=this._estDestinatairePossibleEstCocheEtActif(this.idTypesDestinataire.responsable1);const lAvecResp2=this._estDestinatairePossibleEstCocheEtActif(this.idTypesDestinataire.responsable2);const lAvecPP=this._estDestinatairePossibleEstCocheEtActif(this.idTypesDestinataire.profsprincipaux);const lAvecTuteurs=this._estDestinatairePossibleEstCocheEtActif(this.idTypesDestinataire.tuteurs);const lAvecEquipePeda=this._estDestinatairePossibleEstCocheEtActif(this.idTypesDestinataire.equipePedagogique);if(lAvecEleves){lListe.FusionnerListe(this.donneesDest.eleves);}
if(lAvecResp1&&lAvecResp2){lListe.FusionnerListe(this.donneesDest.respLegaux);} else{if(lAvecResp1){lListe.FusionnerListe(this.donneesDest.respLegal1);}
if(lAvecResp2){lListe.FusionnerListe(this.donneesDest.respLegal2);}}
if(lAvecPP){lListe.FusionnerListe(this.donneesDest.profsprincipaux);}
if(lAvecTuteurs){lListe.FusionnerListe(this.donneesDest.tuteurs);}
if(lAvecEquipePeda){lListe.FusionnerListe(this.donneesDest.equipePeda);}
break;}
case EGenreRessource.Responsable:case EGenreRessource.Enseignant:case EGenreRessource.Personnel:if(MethodesTableau.existe(GEtatUtilisateur.GenreEspace,[EGenreEspace.Eleve,EGenreEspace.Parent])){lListe.FusionnerListe(this.donneesDest.destinataires);if(this.inclureResponsablesDeleguesClasse){lListe.FusionnerListe(this.donneesDest.delegues);}} else if(MethodesTableau.existe(GEtatUtilisateur.GenreEspace,[EGenreEspace.PrimParent])&&this.param.genreRessource===EGenreRessource.Enseignant){if(this.listeSelectionProfsCarnetLiaison&&this.listeSelectionProfsCarnetLiaison.GetNbrElements()>0){this.param.listeSelectionnee.removeFilter(function(D){if(D.GetGenre()===EGenreRessource.Enseignant&&!this.listeSelectionProfsCarnetLiaison.GetElementParNumero(D.GetNumero())){return true;}
return false;}.bind(this));}
lListe.FusionnerListe(this.param.listeSelectionnee);} else{lListe.FusionnerListe(this.param.listeSelectionnee);}
break;case EGenreRessource.Classe:case EGenreRessource.Groupe:lListe=this.param.listeSelectionnee.GetElement(0).listeRessources.getListeElements(function(aElement){return!!(aElement&&aElement.avecDiscussion);});lNbr=lListe.GetNbrElements();lListe=lListe.getListeElements(function(aElement){return(!MethodesTableau.existe(GEtatUtilisateur.GenreEspace,[EGenreEspace.Professeur,EGenreEspace.Etablissement,EGenreEspace.Administrateur,EGenreEspace.PrimProfesseur])||(lNbr===1)||(GEtatUtilisateur.getUtilisateur().GetNumero()!==aElement.GetNumero()));});break;default:;break;}
if(GEtatUtilisateur.pourPrimaire()){if(this.estAvecDirecteur){lListe.AddElement(new ObjetElement('',0,EGenreRessource.Personnel));}}
for(let i=0,lNbr=lListe.GetNbrElements();i<lNbr;i++){lListe.GetElement(i).SetEtat(EGenreEtat.Modification);}
return lListe;}
SetDonnees(aParam){this.message=new ObjetElement();$.extend(this.message,{objet:'',destinataires:new ObjetListeElements(),contenu:'',placeholder:'',estMsgInitial:true});if(aParam.message){$.extend(this.message,aParam.message);}
this.avecIndicationDiscussionInterdit=aParam.avecIndicationDiscussionInterdit;this.donneesDest={eleves:new ObjetListeElements(),respLegal1:new ObjetListeElements(),respLegal2:new ObjetListeElements(),respLegaux:new ObjetListeElements(),profsprincipaux:new ObjetListeElements(),tuteurs:new ObjetListeElements(),equipePeda:new ObjetListeElements()};if(MethodesTableau.existe(GEtatUtilisateur.GenreEspace,[EGenreEspace.Eleve,EGenreEspace.Parent,EGenreEspace.PrimParent])){$.extend(this.donneesDest,{destinataires:new ObjetListeElements(),delegues:aParam.listeDelegues});this.avecCBInclureDelegues=aParam.avecCBInclureDelegues;}
const $contenuMessage=$('#'+this.idContenuMsg.escapeJQ());if(!!this.message.placeholder){$contenuMessage.attr('placeholder',this.message.placeholder);}
$contenuMessage.val(this.message.contenu);this.param=aParam;if(this._autoriseTiny()){_initTiny.bind(this)();}
this.destinataires=this._formatterDonneesPourAffichage();this.setOptionsFenetre({largeur:600});this.Afficher();this._setDestinataires();if(this.param.avecAffichageChampDestinataires===false){$('#'+this.id_destinataires_conteneur.escapeJQ()).hide();}
if(this._autorisePJ()){this.message.listeFichiers=new ObjetListeElements();this.GetInstance(this.identSelecteurPJ).SetDonnees({listePJ:this.message.listeFichiers,listeTotale:this.listePJ,idContextFocus:this.Nom});_actualiserSelecteurPJ.call(this);}
if(this.optionsFenetre.transfertMessage&&this.param.transfert){this.message.objet=this.param.transfert.objet;$('#'+this.idDiscussion.escapeJQ()).show().IEHtml(TUtilitaireMessagerie.getDiscussion({listeMessages:this.param.transfert.listeMessages,ieHint:'visuMessage.hintPublic'}),{controleur:this.controleur});}
this.$refreshSelf();this.positionnerFenetre();}
actualiserListeCloud(){if(this.avecCloudDisponibles()){GHtml.setHtml(this.idLibelleCloud,TUtilitaireUrl.construireListeUrls(this.message.listeFichiers,{genreFiltre:EGenreDocumentJoint.Cloud,genreRessource:EGenreRessource.Evaluation,separateur:' ',IEModelChips:'chipsFichierCloud'}),{controleur:this.controleur});}}
ComposeContenu(){const T=[];T.push(_composeZoneEnteteMsg.bind(this)());T.push(_composeZoneContenuMsg.bind(this)());if(this.optionsFenetre.transfertMessage){T.push('<div class="EspaceHaut">','<div id="',this.idDiscussion,'" style="overflow-y: auto; max-height:200px; width:100%;"></div>','</div>');}
return T.join('');}
controlerSaisieMsg(){const lResult={estOk:true,destinatairesKo:false,contenuKo:false,content:''};if(this.message.avecControleNbDest!==false){if(this.optionsFenetre.avecChoixDestinataires){if(this.GetInstance(this.identDestinataire).getListeDestinataires().GetNbrElements()===0){$.extend(lResult,{estOk:false,destinatairesKo:true});}} else{if(this.param.listeSelectionnee.GetNbrElements()<1){$.extend(lResult,{estOk:false,destinatairesKo:true});}
if(this.param.genreRessource===EGenreRessource.Eleve){const lAvecEleves=this._estDestinatairePossibleEstCocheEtActif(this.idTypesDestinataire.eleve);const lAvecResp1=this._estDestinatairePossibleEstCocheEtActif(this.idTypesDestinataire.responsable1);const lAvecResp2=this._estDestinatairePossibleEstCocheEtActif(this.idTypesDestinataire.responsable2);const lAvecPP=this._estDestinatairePossibleEstCocheEtActif(this.idTypesDestinataire.profsprincipaux);const lAvecTuteurs=this._estDestinatairePossibleEstCocheEtActif(this.idTypesDestinataire.tuteurs);const lAvecEquipePeda=this._estDestinatairePossibleEstCocheEtActif(this.idTypesDestinataire.equipePedagogique);if(!lAvecEleves&&!lAvecResp1&&!lAvecResp2&&!lAvecPP&&!lAvecTuteurs&&!lAvecEquipePeda){$.extend(lResult,{estOk:false,destinatairesKo:true});}}}}
if(this._autoriseTiny()){if(!GNavigateur.withContentEditable){lResult.content=GHtml.getValue(this.idContenuMsg);} else{const lEditeur=tinymce.get(this.idContenuMsg);lResult.content=lEditeur?lEditeur.getContent():'';}
if(GTinyInit.estContenuVide(lResult.content)){lResult.content='';$.extend(lResult,{estOk:false,contenuKo:true});}} else{if(this.message.contenu.trim()===''){$.extend(lResult,{estOk:false,contenuKo:true});} else{lResult.content=GHtml.getValue(this.idContenuMsg);}}
return lResult;}
SurValidation(aNumeroBouton){const lControle=this.controlerSaisieMsg();this.message.contenu=lControle.content;this.message.destinataires=this._getListeDestinataires();let lMessageDestinatairesFiltree=this.message.destinataires.getListeElements(function(aElt){return aElt.Actif;});const lParametres={objet:this.message.objet,contenu:this.message.contenu,listeDestinataires:this.optionsFenetre.avecChoixResponsable2?lMessageDestinatairesFiltree:this.message.destinataires,listeFichiers:this.message.listeFichiers,avecControleNbDest:this.message.avecControleNbDest,commande:this.message.commande,estCreationCarnetLiaison:this.message.estCreationCarnetLiaison,estCreationDossierDecrochage:this.message.estCreationDossierDecrochage,eleveCarnetLiaison:this.message.eleveCarnetLiaison,dossier:this.message.dossier,listeMessagesTransfert:this.message.listeMessagesTransfert};if(aNumeroBouton===1){if(lControle.estOk){this.moteurMessagerie.requeteSaisieMessage(lParametres).then(function(aResult){if(aResult&&aResult.saisieMessageOK){this.Fermer();this.callback.appel(aNumeroBouton,this.message,this,true);}}.bind(this),function(){});} else{GApplication.getMessage().afficher({type:EGenreBoiteMessage.Information,message:lControle.destinatairesKo?GTraductions.getValeur('Messagerie.MsgAucunDestinataire'):(lControle.contenuKo?GTraductions.getValeur('Messagerie.MsgAucunContenu'):'')});}} else{Promise.resolve().then(function(){if(this.optionsFenetre.avecSauvegardeBrouillon){return this.moteurMessagerie.sauvegarderCreationBrouillon(lParametres);}}.bind(this)).finally(function(){this.Fermer();this.callback.appel(aNumeroBouton,this.message,this,true);}.bind(this));}}
static creerFenetreDiscussion(aInstance,aDonnees,aOptions){const lOptions=Object.assign({avecSauvegardeBrouillon:true,avecChoixDestinataires:MethodesTableau.existe(GEtatUtilisateur.GenreEspace,[
EGenreEspace.Professeur,EGenreEspace.Mobile_Professeur,EGenreEspace.Etablissement,EGenreEspace.Mobile_Etablissement,EGenreEspace.Administrateur,EGenreEspace.Mobile_Administrateur,EGenreEspace.Accompagnant,EGenreEspace.Mobile_Accompagnant,EGenreEspace.PrimProfesseur,EGenreEspace.Mobile_PrimProfesseur,EGenreEspace.PrimAccompagnant,EGenreEspace.Mobile_PrimAccompagnant,EGenreEspace.Tuteur,EGenreEspace.Mobile_Tuteur
]),listeEtiquettes:null,estCreationCarnetLiaison:false,estCreationDossierDecrochage:false,eleveCarnetLiaison:null,dossier:null},aOptions);const lDonnees=Object.assign({genresRessources:[],message:{objet:'',contenu:'',placeholder:'',messageAvertissement:'',listeEtiquettes:lOptions.listeEtiquettes,estCreationCarnetLiaison:lOptions.estCreationCarnetLiaison,estCreationDossierDecrochage:lOptions.estCreationDossierDecrochage,eleveCarnetLiaison:lOptions.eleveCarnetLiaison,dossier:lOptions.dossier},avecIndicationDiscussionInterdit:MethodesTableau.existe(GEtatUtilisateur.GenreEspace,[EGenreEspace.Professeur,EGenreEspace.Etablissement,EGenreEspace.Administrateur,EGenreEspace.Accompagnant,EGenreEspace.Tuteur])},aDonnees);const lFenetre=ObjetFenetre.creerInstance(ObjetFenetre_Message,{pere:aInstance},{avecChoixDestinataires:lOptions.avecChoixDestinataires});if(lOptions.avecSauvegardeBrouillon){lFenetre.setOptionsFenetre({avecSauvegardeBrouillon:lOptions.avecSauvegardeBrouillon});}
if(lOptions.titreFenetre){lFenetre.setOptionsFenetre({titre:lOptions.titreFenetre});}
lFenetre.SetDonnees(lDonnees);}}
function _toHint(){return this.join('\r');}
function _composeBlockGenreDestinataire(aElt){const lResult=[];if(!!aElt.aLaLigne){lResult.push('<br/>');}
lResult.push('<div class="InlineBlock AlignementHaut" title="',GChaine.toTitle(aElt.hint),'" style="padding-right:10px; padding-bottom: 5px;">');lResult.push('<ie-checkbox ie-model="cbTypeDestinatairePourEleve(',aElt.id,')">');lResult.push('</ie-checkbox>');lResult.push('</div>');return lResult.join('');}
function _initSelecteurPJ(aInstance){aInstance.setOptions({genrePJ:EGenreDocumentJoint.Fichier,title:GTraductions.getValeur('Messagerie.HintPJ'),maxFiles:0,multiple:true,avecMenuContextuel:false,maxSize:GApplication.droits.get(TypeDroits.tailleMaxDocJointEtablissement),ouvrirFenetreChoixTypesAjout:true,optionsCloud:{avecCloud:true,callbackChoixFichierParFichier:surAjoutUnFichierCloud.bind(this),callbackChoixFichierFinal:surAjoutFinalFichiersClouds.bind(this)},idLibellePJ:this.idLibellePJ,avecAjoutExistante:true,avecEtatSaisie:false,avecBoutonSupp:true});}
function surAjoutUnFichierCloud(aNouvelElement){this.message.listeFichiers.AddElement(aNouvelElement);this.listePJ.AddElement(aNouvelElement);}
function surAjoutFinalFichiersClouds(){this.actualiserListeCloud();this.message.SetEtat(EGenreEtat.Modification);}
function _initTiny(){if(GNavigateur.withContentEditable){GTinyInit.init({pere:this,id:this.idContenuMsg,modeMail:true,height:this.optionsFenetre.transfertMessage?180:310,min_height:this.optionsFenetre.transfertMessage?150:298,max_height:600});}}
function _composeChampDestinataires(){const T=[];if(!this.optionsFenetre.avecChoixDestinataires){T.push('<div id="',this.id_destinataires_conteneur,'" class="EspaceBas NoWrap">','<div class="InlineBlock Gras AlignementHaut" style="width:',this.C_largeurLabelChamps,'px">',GTraductions.getValeur('Messagerie.DestinatairesMsg'),'</div>','<div id="',this.id_destinataires,'" class="InlineBlock AlignementHaut" style="',GStyle.composeWidthCalc(this.C_largeurLabelChamps),'"></div>','<div id="',this.idCopieAutresResp,'" class="Texte10 EspaceHaut" style="width:100%">','<ie-checkbox ie-model="cbInclureResponsables"  ie-display="estVisibleInclureResponsables">',GTraductions.getValeur('fenetreCommunication.cb.inclureDelegues'),'</ie-checkbox>','</div>','</div>');} else{T.push('<div id="',this.GetNomInstance(this.identDestinataire),'"></div>');}
return T.join('');}
function _composeChampObjet(){const T=[];T.push(`<div class="flex-contain flex-center m-top-l m-bottom-l">\n            <div class="EspaceDroit NoWrap fix-bloc">${GTraductions.getValeur('Messagerie.ObjetMsg')} :</div>`);if(this.optionsFenetre.transfertMessage){T.push('<div class="fluid-bloc" ie-html="getObjetTexte"></div>');} else{T.push('<div class="fluid-bloc"><input ie-model="inputObjet" id="',this.idInputObjetMsg,'" maxlength="',TUtilitaireMessagerie.C_TailleObjetMessage,'" type="text" class="round-style"  style="width:100%" /></div>');}
T.push('</div>');return T.join('');}
function _composeChampPJ(){const T=[];T.push(`<div id="${this.GetNomInstance(this.identSelecteurPJ)}"></div>`);return T.join('');}
function _composeZoneEnteteMsg(){const T=[];T.push('<div id="',this.idEntete,'" class="Texte10 EspaceHaut" style="width:100%">');T.push(_composeChampDestinataires.call(this));T.push(tag('div',{'ie-html':'getLegende','ie-display':'afficherLegende',class:'GrandEspaceBas'}));T.push(_composeChampObjet.call(this));const lAvecPJ=this._autorisePJ();const lAvecCloud=(GEtatUtilisateur.listeCloud.GetNbrElements()>0);if(lAvecPJ||lAvecCloud){T.push('<div>');if(lAvecPJ){T.push('<div id="',this.idLibellePJ,'" class="EspaceBas"></div>');}
if(lAvecCloud){T.push('<div id="',this.idLibelleCloud,'" class="EspaceBas"></div>');}
T.push('</div>');}
T.push('</div>');return T.join('');}
function _composeZoneContenuMsg(){const T=[];T.push(`<div class="flex-contain">`);if(this._autorisePJ()){T.push(`<div class="fix-bloc m-right-l flex-contain cols" style="width:2.4rem;">\n               ${_composeChampPJ.call(this)}
          </div>`);}
T.push(`<div class="fluid-bloc">\n            <textarea id="${this.idContenuMsg}" ${!this._autoriseTiny()?' ie-model="textareaSansTiny" maxlength="10000"':''} placeholder="" class="round-style" style="height:300px;width:100%;"></textarea>\n          </div>`);T.push(`</div>`);return T.join('');}
function _actualiserSelecteurPJ(){if(!this._autorisePJ()){return;}
const lInstance=this.GetInstance(this.identSelecteurPJ);lInstance.SetDonnees({listePJ:this.message.listeFichiers,listeTotale:this.listePJ,idContextFocus:this.Nom});}
function _evntSelecteurPJ(){if(this.message.contenu!==''||this.message.listeFichiers.GetNbrElements()>0){this.message.SetEtat(EGenreEtat.Modification);}
this.$refreshSelf();}
module.exports=ObjetFenetre_Message;},fn:"objetfenetre_message.js"});;
IE.fModule({f:function(exports,require,module,global){const MethodesObjet=require('MethodesObjet.js');const GTraductions=require('ObjetTraduction.js');const ObjetFenetre=require('ObjetFenetre.js');const GUID=require('GUID.js');const GHtml=require('GHtml.js');require('Mobile/css/FenetreEditionDestinatairesParEntites.css');class FenetreEditionDestinatairesParEntites extends ObjetFenetre{constructor(...aParams){super(...aParams);this.id={nbEntiteClasse:GUID.getId(),nbEntiteGpe:GUID.getId()};this.options={};}
getControleur(aInstance){return $.extend(true,super.getControleur(this),{nodeSelectChoixClassesGpes:function(aGenreRessource){$(this.node).on('click',function(){this.openModaleSelectRessource({genreRessource:aGenreRessource,donnee:this.donnee,clbck:function(){this.updateCompteurs();}.bind(this)});}.bind(aInstance));},cbGenreDest:{getValue:function(aGenreRessource){return(this.utilitaires!==null)&&(this.utilitaires!==undefined)?this.utilitaires.moteurDestinataires.estGenrePublicEntite({genreRessource:aGenreRessource,donnee:this.donnee}):false;}.bind(aInstance),setValue:function(aGenreRessource,aValue){if((this.utilitaires!==null)&&(this.utilitaires!==undefined)){this.utilitaires.moteurDestinataires.setGenrePublicEntite({genreRessource:aGenreRessource,donnee:this.donnee,valeur:aValue});}}.bind(aInstance),getDisabled:function(){return false;}.bind(aInstance)},rbChxParMembre:{getValue:function(aGenreRessource,aChoixParMembre){if((this.utilitaires!==null)&&(this.utilitaires!==undefined)){const lRelatifEleve=this.utilitaires.moteurDestinataires.estRelatifEleve({genreRessource:aGenreRessource,donnee:this.donnee});if(aChoixParMembre===true){return(lRelatifEleve===true);} else{return(lRelatifEleve===false);}}}.bind(aInstance),setValue:function(aGenreRessource,aChoixParMembre){if((this.utilitaires!==null)&&(this.utilitaires!==undefined)){this.utilitaires.moteurDestinataires.setChoixParMembre({genreRessource:aGenreRessource,donnee:this.donnee,choixParMembre:aChoixParMembre});}}.bind(aInstance),getDisabled:function(aGenreRessource){return(this.utilitaires!==null)&&(this.utilitaires!==undefined)?!this.utilitaires.moteurDestinataires.estGenrePublicEntite({genreRessource:aGenreRessource,donnee:this.donnee}):true;}.bind(aInstance)},cbElevesRattaches:{getValue:function(){if(this.donnee!==null&&this.donnee!==undefined){return this.donnee.avecElevesRattaches;}}.bind(aInstance),setValue:function(aValue){if(this.donnee!==null&&this.donnee!==undefined){this.donnee.avecElevesRattaches=aValue;this.donnee.avecModificationPublic=true;}}.bind(aInstance),getDisabled:function(){return false;}.bind(aInstance)}});}
ConstruireInstances(){}
SetDonnees(aParam){this.donneeOrigine=aParam.donnee;this.donnee=MethodesObjet.dupliquer(this.donneeOrigine);this.Afficher(this.ComposeContenu());this.updateCompteurs();}
setUtilitaires(aUtilitaires){this.utilitaires=aUtilitaires;}
setOptions(aOptions){this.options=aOptions;}
ComposeContenu(){const H=[];H.push('<div class="FenetreEditionDestinatairesParEntites">');H.push(_construireHtmlChoixClassesGpe.call(this));H.push(_construireHtmlSelectionTypeDestinataires.call(this));H.push('</div>');return H.join('');}
openModaleSelectRessource(aParam){this.utilitaires.moteurDestinataires.ouvrirModaleSelectionRessource(aParam);}
updateCompteurs(){const lNbClasses=this.donnee.listePublicEntite.getListeElements(function(D){return D.GetGenre()===this.utilitaires.genreRessource.getRessourceClasse();}.bind(this)).GetNbrElementsExistes();GHtml.setHtml(this.id.nbEntiteClasse,_construireHtmlNb.call(this,lNbClasses));const lNbGpe=this.donnee.listePublicEntite.getListeElements(function(D){return D.GetGenre()===this.utilitaires.genreRessource.getRessourceGroupe();}.bind(this)).GetNbrElementsExistes();GHtml.setHtml(this.id.nbEntiteGpe,_construireHtmlNb.call(this,lNbGpe));}
SurValidation(aGenreBouton){const lEstValidation=(aGenreBouton===1);this.callback.appel(aGenreBouton,{donnee:lEstValidation?this.donnee:this.donneeOrigine});this.Fermer();}}
function _construireHtmlChoixClassesGpe(){const H=[];H.push('<div class="titreSection first"><span >','1. ',GTraductions.getValeur('destinataires.choixClassesGpes'),'</span></div>');H.push('<div ie-node="nodeSelectChoixClassesGpes(',this.utilitaires.genreRessource.getRessourceClasse(),')" class="flex-contain item conteneurIcon">');H.push('<div class="strIcon">',GTraductions.getValeur('destinataires.classes'),' <span class="strNumber" id="',this.id.nbEntiteClasse,'"></span>','</div>');H.push('<i class="icon_angle_right"></i>');H.push('</div>');H.push('<div ie-node="nodeSelectChoixClassesGpes(',this.utilitaires.genreRessource.getRessourceGroupe(),')" class="flex-contain item conteneurIcon">');H.push('<div class="strIcon">',GTraductions.getValeur('destinataires.gpes'),'<span class="strNumber" id="',this.id.nbEntiteGpe,'"> (0) </span>','</div>');H.push('<i class="icon_angle_right"></i>');H.push('</div>');if(this.options&&this.options.avecCBElevesRattaches===true){H.push('<div class="item flex-contain vertical">');H.push('<ie-checkbox class="cb" ie-model="cbElevesRattaches()" ie-textright>',GTraductions.getValeur('actualites.public.elevesRattaches'),'</ie-checkbox>');H.push('</div>');}
return H.join('');}
function _construireHtmlSelectionDeRessource(aParam){const H=[];H.push('<div  class="item flex-contain vertical',(aParam.estDernier===true?' last ':''),'">');H.push('<ie-checkbox class="cb" ie-model="cbGenreDest(',aParam.genreRessource,')" ie-textright>',aParam.strRessource,'</ie-checkbox>');if(aParam.avecChoixParEleve===true){H.push('<ie-radio class="rb" ie-model="rbChxParMembre(',aParam.genreRessource,', ',true,')" ie-textright>',GTraductions.getValeur('destinataires.envoiParEleve'),'</ie-radio>');H.push('<ie-radio class="rb" ie-model="rbChxParMembre(',aParam.genreRessource,', ',false,')" ie-textright>',GTraductions.getValeur('destinataires.envoiParResp'),'</ie-radio>');}
H.push('</div>');return H.join('');}
function _construireHtmlSelectionTypeDestinataires(){const H=[];H.push('<div class="titreSection"><span >','2. ',GTraductions.getValeur('destinataires.selectionnerTypeDests'),'</span></div>');H.push(_construireHtmlSelectionDeRessource.call(this,{genreRessource:this.utilitaires.genreRessource.getRessourceEleve(),strRessource:GTraductions.getValeur('destinataires.eleves')}));H.push(_construireHtmlSelectionDeRessource.call(this,{genreRessource:this.utilitaires.genreRessource.getRessourceParent(),strRessource:GTraductions.getValeur('destinataires.responsables'),avecChoixParEleve:true}));H.push(_construireHtmlSelectionDeRessource.call(this,{genreRessource:this.utilitaires.genreRessource.getRessourceProf(),strRessource:GTraductions.getValeur('destinataires.professeurs')}));H.push(_construireHtmlSelectionDeRessource.call(this,{genreRessource:this.utilitaires.genreRessource.getRessourcePersonnel(),strRessource:GTraductions.getValeur('destinataires.personnels')}));H.push(_construireHtmlSelectionDeRessource.call(this,{genreRessource:this.utilitaires.genreRessource.getRessourceEntreprise(),strRessource:GTraductions.getValeur('destinataires.maitresDeStage'),estDernier:true}));return H.join('');}
function _construireHtmlNb(aNb){return' ('+aNb+') ';}
module.exports={FenetreEditionDestinatairesParEntites:FenetreEditionDestinatairesParEntites};},fn:"fenetreeditiondestinatairesparentites.js"});;
IE.fModule({f:function(exports,require,module,global){const MethodesObjet=require('MethodesObjet.js');const GTraductions=require('ObjetTraduction.js');const ObjetFenetre=require('ObjetFenetre.js');const GUID=require('GUID.js');const GHtml=require('GHtml.js');const{ObjetFenetre_SelectionPublic,TypeGenreCumulSelectionPublic}=require('ObjetFenetre_SelectionPublic.js');require('Mobile/css/FenetreEditionDestinatairesParIndividus.css');class FenetreEditionDestinatairesParIndividus extends ObjetFenetre{constructor(...aParams){super(...aParams);this.id={nbEleves:GUID.getId(),nbProfs:GUID.getId(),nbResps:GUID.getId(),nbPersonnels:GUID.getId(),nbMdS:GUID.getId(),nbInspecteurs:GUID.getId()};this.options={avecGestionEleves:true,avecGestionPersonnels:true,avecGestionStages:true,avecGestionIPR:true};}
getControleur(aInstance){return $.extend(true,super.getControleur(this),{nodeSelectGenreDest:function(aGenreRessource){$(this.node).on('click',function(){this.utilitaires.moteurDestinataires.getDonneesPublic({genreRessource:aGenreRessource}).then(function(aDonnees){this.openModaleSelectPublic({titre:this.utilitaires.moteurDestinataires.getTitreSelectRessource({genreRessource:aGenreRessource}),genreRessource:aGenreRessource,listeRessources:aDonnees.listePublic,listeRessourcesSelectionnees:this.donnee.listePublicIndividu.getListeElements(function(aElt){return aElt.GetGenre()===aGenreRessource;})});}.bind(this));}.bind(aInstance));}});}
openModaleSelectPublic(aParam){const lGenreRessource=aParam.genreRessource;const lModaleSelect=ObjetFenetre.creerInstance(ObjetFenetre_SelectionPublic,{pere:this,evenement:function(aGenreRessource,aListeRessourcesSelect,aNumeroBouton){if(aNumeroBouton===1){const lPublicAutresGenres=this.donnee.listePublicIndividu.getListeElements(function(aElt){return aElt.GetGenre()!==aGenreRessource;});this.donnee.listePublicIndividu=lPublicAutresGenres;this.donnee.listePublicIndividu.FusionnerListe(MethodesObjet.dupliquer(aListeRessourcesSelect));this.donnee.avecModificationPublic=true;this.updateCompteurs();}}},{titre:aParam.titre});switch(lGenreRessource){case this.utilitaires.genreRessource.getRessourceEleve():case this.utilitaires.genreRessource.getRessourceParent():lModaleSelect.setGenreCumulActif(TypeGenreCumulSelectionPublic.classe);break;}
lModaleSelect.setOptions({avecCocheRessources:true,selectionObligatoire:false,avecBarreTitre:false,estDeploye:false});lModaleSelect.setDonnees({listeRessources:aParam.listeRessources,listeRessourcesSelectionnees:aParam.listeRessourcesSelectionnees,genreRessource:aParam.genreRessource,titre:aParam.titre});}
ConstruireInstances(){}
SetDonnees(aParam){this.donneeOrigine=aParam.donnee;this.donnee=MethodesObjet.dupliquer(this.donneeOrigine);this.Afficher(this.ComposeContenu());this.updateCompteurs();}
setUtilitaires(aUtilitaires){this.utilitaires=aUtilitaires;}
setOptions(aOptions){this.options=$.extend(this.options,aOptions);}
ComposeContenu(){const H=[];const lTabInfosRessources=_getTabInfosRessources.call(this);H.push('<div class="FenetreEditionDestinatairesParIndividus">');for(let i=0,lNbr=lTabInfosRessources.length;i<lNbr;i++){const lInfosRessource=lTabInfosRessources[i];H.push(_construireHtmlSelectionDeRessource.call(this,$.extend(lInfosRessource,{estDernier:i===lNbr-1})));}
H.push('</div>');return H.join('');}
updateCompteurs(){const lTabInfosRessources=_getTabInfosRessources.call(this);for(let i=0,lNbr=lTabInfosRessources.length;i<lNbr;i++){const lInfosRessource=lTabInfosRessources[i];const lNb=this.donnee.listePublicIndividu.getListeElements(function(D){return D.GetGenre()===lInfosRessource.genreRessource;}).GetNbrElementsExistes();GHtml.setHtml(lInfosRessource.idCompteur,_construireHtmlNb.call(this,lNb));}}
SurValidation(aGenreBouton){const lEstValidation=(aGenreBouton===1);this.callback.appel(aGenreBouton,{donnee:lEstValidation?this.donnee:this.donneeOrigine});this.Fermer();}}
function _construireHtmlSelectionDeRessource(aParam){const H=[];H.push('<div ie-node="nodeSelectGenreDest(',aParam.genreRessource,')" class="flex-contain item conteneurIcon ',(aParam.estDernier===true?' last ':''),'">');H.push('<div class="strIcon">',aParam.strRessource,' <span class="strNumber" id="',aParam.idCompteur,'"></span>','</div>');H.push('<i class="icon_angle_right"></i>');H.push('</div>');return H.join('');}
function _construireHtmlNb(aNb){return' ('+aNb+') ';}
function _getTabInfosRessources(){const lResult=[];if(this.options.avecGestionEleves){lResult.push({genreRessource:this.utilitaires.genreRessource.getRessourceEleve(),strRessource:GTraductions.getValeur('destinataires.eleves'),idCompteur:this.id.nbEleves});}
lResult.push({genreRessource:this.utilitaires.genreRessource.getRessourceParent(),strRessource:GTraductions.getValeur('destinataires.responsables'),idCompteur:this.id.nbResps},{genreRessource:this.utilitaires.genreRessource.getRessourceProf(),strRessource:GTraductions.getValeur('destinataires.professeurs'),idCompteur:this.id.nbProfs});if(this.options.avecGestionPersonnels){lResult.push({genreRessource:this.utilitaires.genreRessource.getRessourcePersonnel(),strRessource:GTraductions.getValeur('destinataires.personnels'),idCompteur:this.id.nbPersonnels});}
if(this.options.avecGestionStages){lResult.push({genreRessource:this.utilitaires.genreRessource.getRessourceEntreprise(),strRessource:GTraductions.getValeur('destinataires.maitresDeStage'),idCompteur:this.id.nbMdS});}
if(this.options.avecGestionIPR){lResult.push({genreRessource:this.utilitaires.genreRessource.getRessourceInspecteur(),strRessource:GTraductions.getValeur('destinataires.inspecteur'),idCompteur:this.id.nbInspecteurs});}
return lResult;}
module.exports={FenetreEditionDestinatairesParIndividus:FenetreEditionDestinatairesParIndividus};},fn:"fenetreeditiondestinatairesparindividus.js"});;
IE.fModule({f:function(exports,require,module,global){const MethodesObjet=require('MethodesObjet.js');const MoteurInfoSondage=require('MoteurInfoSondage.js').MoteurInfoSondage;const Identite=require('ObjetIdentite.js');const GHtml=require('GHtml.js');const GUID=require('GUID.js');const GTraductions=require('ObjetTraduction.js');const EGenreEtat=require('Enumere_Etat.js');const tag=require('tag.js');const Toast=require('Toast.js').Toast;const ETypeToast=require('Toast.js').ETypeToast;const TUtilitaireUrl=require('UtilitaireUrl.js');const EGenreAction=require('Enumere_Action.js');const EGenreBoiteMessage=require('Enumere_BoiteMessage.js');const{GDate}=require('ObjetDate.js');const ObjetSelection=require('ObjetSelection.js').ObjetSelection;const MoteurDestinataires=require('MoteurDestinataires.js').MoteurDestinataires;const ObjetFenetre=require('ObjetFenetre.js');const FenetreEditDestParEntites=require('FenetreEditionDestinatairesParEntites.js').FenetreEditionDestinatairesParEntites;const FenetreEditDestParIndividus=require('FenetreEditionDestinatairesParIndividus.js').FenetreEditionDestinatairesParIndividus;const EGenreDocumentJoint=require('Enumere_DocumentJoint.js');const ObjetListeElements=require('ObjetListeElements.js');require('Mobile/css/FicheEditionInfoSond_Mobile.css');class FicheEditionInfoSond_Mobile extends ObjetFenetre{constructor(...aParams){super(...aParams);this.id={titre:GUID.getId(),listePJ:GUID.getId(),nbEntiteClasse:GUID.getId(),nbEntiteGpe:GUID.getId(),nbIndividus:GUID.getId(),nbProfs:GUID.getId(),nbPersonnels:GUID.getId(),nbResponsables:GUID.getId()};this.forcerAR=false;this.options={};}
getControleur(aInstance){return $.extend(true,super.getControleur(this),{nodeSelectDestParEntite:function(){$(this.node).on('click',function(){const lFenetre=ObjetFenetre.creerInstance(FenetreEditDestParEntites,{pere:this,evenement:function(aNumeroBouton,aDonnees){if(aNumeroBouton===1){this.donnee=aDonnees.donnee;this.updateCompteursDestinataires();}}.bind(this),initialiser:function(aInstanceFenetre){aInstanceFenetre.setUtilitaires(aInstance.utilitaires);aInstanceFenetre.setOptions({avecCBElevesRattaches:this.options?this.options.avecCBElevesRattaches:false});aInstanceFenetre.setOptionsFenetre({modale:true,titre:GTraductions.getValeur('destinataires.destsParEntites'),listeBoutons:[GTraductions.getValeur('Annuler'),GTraductions.getValeur('Valider')]});}.bind(this)});lFenetre.SetDonnees({donnee:this.donnee});}.bind(aInstance));},nodeSelectDestParIndiv:function(){$(this.node).on('click',function(){const lFenetre=ObjetFenetre.creerInstance(FenetreEditDestParIndividus,{pere:this,evenement:function(aNumeroBouton,aDonnees){if(aNumeroBouton===1){this.donnee=aDonnees.donnee;this.updateCompteursDestinataires();}}.bind(aInstance),initialiser:function(aInstanceFenetre){aInstanceFenetre.setUtilitaires(aInstance.utilitaires);aInstanceFenetre.setOptions({avecGestionEleves:this.options?this.options.avecGestionEleves:true,avecGestionPersonnels:this.options?this.options.avecGestionPersonnels:true,avecGestionStages:this.options?this.options.avecGestionStages:true,avecGestionIPR:this.options?this.options.avecGestionIPR:true});aInstanceFenetre.setOptionsFenetre({modale:true,titre:GTraductions.getValeur('destinataires.destsATitreIndiv'),listeBoutons:[GTraductions.getValeur('Annuler'),GTraductions.getValeur('Valider')]});}});lFenetre.SetDonnees({donnee:this.donnee});}.bind(aInstance));},nodeSelectDest_RespToResp:function(){$(this.node).on('click',function(){this.openModaleSelectionPublic({genreRessource:this.utilitaires.genreRessource.getRessourceParent(),donnee:this.donnee,clbck:function(){this.updateCompteursDestinataires();}.bind(this)});}.bind(aInstance));},nodeSelectDestPrimaire_RespClasses:function(aGenreRessource){$(this.node).on('click',function(){this.openModaleSelectRespClasses({genreRessource:aGenreRessource,donnee:this.donnee,clbck:function(){this.utilitaires.moteurDestinataires.surSelectEntites_PrimaireRespClasses({donnee:this.donnee});this.updateCompteursDestinataires();}.bind(this)});}.bind(aInstance));},nodeSelectDestPrimaire_Public:function(aGenreRessource){$(this.node).on('click',function(){this.openModaleSelectionPublic({genreRessource:aGenreRessource,donnee:this.donnee,clbck:function(){this.updateCompteursDestinataires();}.bind(this)});}.bind(aInstance));},cbPrimaire_Directeur:{getValue:function(){return this.donnee.avecDirecteur;}.bind(aInstance),setValue:function(aValue){this.donnee.avecDirecteur=aValue;this.donnee.avecModificationPublic=true;}.bind(aInstance),getDisabled:function(){return false;}.bind(aInstance)},nodeTitre:function(){$(this.node).on('focusin',function(){GHtml.setSelectionEdit(this.id.titre);}.bind(aInstance));},titre:{getValue:function(){return(this.donnee!==null&&this.donnee!==undefined)?this.donnee.GetLibelle():'';}.bind(aInstance),setValue:function(aValue){this.donnee.SetLibelle(aValue);}.bind(aInstance),getDisabled:function(){return this.donnee.estVerrouille;}.bind(aInstance),node:function(){$(this.node).attr('placeholder',GTraductions.getValeur('infoSond.redigerTitre'));}},contenu:{getValue:function(){let lResult='';if((this.donnee!==null)&&(this.donnee!==undefined)&&(this.donnee.estInformation)&&(this.donnee.listeQuestions.GetNbrElementsExistes()>0)){const lContenu=this.donnee.listeQuestions.GetPremierElement();lResult=lContenu.texte;}
return lResult;}.bind(aInstance),setValue:function(aValue){if((this.donnee!==null)&&(this.donnee!==undefined)&&(this.donnee.estInformation)&&(this.donnee.listeQuestions.GetNbrElementsExistes()>0)){const lContenu=this.donnee.listeQuestions.GetPremierElement();lContenu.texte=aValue;lContenu.SetEtat(EGenreEtat.Modification);}}.bind(aInstance),getDisabled:function(){return this.donnee.estVerrouille;}.bind(aInstance)},cbAR:{getValue:function(){let lResult=false;if((this.donnee!==null)&&(this.donnee!==undefined)&&(this.donnee.estInformation)&&(this.donnee.listeQuestions.GetNbrElementsExistes()>0)){const lContenu=this.donnee.listeQuestions.GetPremierElement();lResult=lContenu.avecAR;}
return lResult;}.bind(aInstance),setValue:function(){if((this.donnee!==null)&&(this.donnee!==undefined)&&(this.donnee.estInformation)&&(this.donnee.listeQuestions.GetNbrElementsExistes()>0)){const lContenu=this.donnee.listeQuestions.GetPremierElement();lContenu.avecAR=!lContenu.avecAR;lContenu.SetEtat(EGenreEtat.Modification);}}.bind(aInstance),getDisabled:function(){return((this.donnee!==null)&&(this.donnee!==undefined))?!this.donnee.estInformation:true;}.bind(aInstance)},selecteurPJ:function(){$(this.node).on('click',function(){if((this.donnee!==null)&&(this.donnee!==undefined)&&(this.donnee.estInformation)&&(this.donnee.listeQuestions.GetNbrElementsExistes()>0)){const lContenu=this.donnee.listeQuestions.GetPremierElement();_evntSurEditPJ.call(aInstance,{instance:aInstance,element:aInstance.donnee,genre:EGenreDocumentJoint.Fichier,listePiecesJointes:this.listePJ,listePJContexte:lContenu.listePiecesJointes,maxSize:this.maxSizePJ,listePeriodes:null,dateCoursDeb:null,validation:function(aParamsFenetre,aListeFichiers,aAvecSaisie){if(aAvecSaisie&&this.donnee!==null&&this.donnee!==undefined&&this.donnee.estInformation&&(this.donnee.listeQuestions.GetNbrElementsExistes()>0)){this.listePJCree.FusionnerListe(aListeFichiers);const lContenu=this.donnee.listeQuestions.GetPremierElement();lContenu.SetEtat(EGenreEtat.Modification);}
GHtml.setHtml(this.id.listePJ,_construireHtmlListePJ.call(this),this.controleur);}.bind(this)});}}.bind(aInstance));},chipsPJ:{eventBtn:function(aIndice){if((this.donnee!==null)&&(this.donnee!==undefined)&&(this.donnee.estInformation)&&(this.donnee.listeQuestions.GetNbrElementsExistes()>0)){const lContenu=this.donnee.listeQuestions.GetPremierElement();const lPJ=lContenu.listePiecesJointes.GetElement(aIndice);if(lPJ){GApplication.getMessage().afficher({type:EGenreBoiteMessage.Confirmation,message:GTraductions.getValeur('selecteurPJ.msgConfirmPJ',[lPJ.GetLibelle()]),callback:function(aAccepte){if(aAccepte!==EGenreAction.Valider){return;}
lPJ.SetEtat(EGenreEtat.Suppression);lContenu.SetEtat(EGenreEtat.Modification);GHtml.setHtml(this.id.listePJ,_construireHtmlListePJ.call(this),this.controleur);}.bind(this)});}}}.bind(aInstance)},radioPublication:{getValue:function(aBool){return!!this.donnee&&(this.donnee.publie===aBool);}.bind(aInstance),setValue:function(aBool){this.donnee.publie=aBool;this.instanceCalendrierDebPublication.SetActif(!!this.donnee.publie);this.instanceCalendrierFinPublication.SetActif(!!this.donnee.publie);}.bind(aInstance)},cbPublicationPageEtablissement:{getValue(){return!!aInstance.donnee&&aInstance.donnee.estInformation&&!!aInstance.donnee.publicationPageEtablissement;},setValue(aValue){if(!!aInstance.donnee&&aInstance.donnee.estInformation){aInstance.donnee.publicationPageEtablissement=aValue;}},getDisabled(){return!aInstance.donnee||!aInstance.donnee.publie;}},pourPageEtablissement:function(){if(aInstance.options.avecPublicationPageEtablissement&&!!aInstance.donnee&&aInstance.donnee.estInformation&&!aInstance.donnee.estModele&&!aInstance.pourPunitionIncident){return true;}
return false;}});}
setUtilitaires(aUtilitaires){this.utilitaires=aUtilitaires;this.moteurCP=new MoteurInfoSondage(this.utilitaires);this.moteurDestinataires=new MoteurDestinataires(this.utilitaires);}
ConstruireInstances(){this.instanceCalendrierDebPublication=this.instancierCalendrier(function(aDate){if(this.donnee.publie===true&&!GDate.estJourEgal(aDate,this.donnee.dateDebut)){this.donnee.dateDebut=aDate;if(this.donnee.dateDebut>this.donnee.dateFin){this.donnee.dateFin=this.donnee.dateDebut;this.instanceCalendrierFinPublication.SetDonnees(this.donnee.dateFin);}}}.bind(this),this);this.instanceCalendrierFinPublication=this.instancierCalendrier(function(aDate){if(this.donnee.publie===true&&!GDate.estJourEgal(aDate,this.donnee.dateFin)){this.donnee.dateFin=aDate;if(this.donnee.dateFin<this.donnee.dateDebut){this.donnee.dateDebut=this.donnee.dateFin;this.instanceCalendrierDebPublication.SetDonnees(this.donnee.dateDebut);}}}.bind(this),this);this.instanceSelectCategorie=this.instancierSelecteur(function(aParam){this.donnee.categorie=aParam.element;}.bind(this),this,{avecBoutonsPrecedentSuivant:false,textCenter:false});}
composeDate(aParam){const H=[];H.push('<div id="',aParam.id,'" class="',aParam.classCss,'"></div>');return H.join('');}
composeSelecteur(aParam){const H=[];H.push('<div id="',aParam.id,'" class="',aParam.classCss,'"></div>');return H.join('');}
updateContenu(){this.instanceCalendrierDebPublication.Initialiser();this.instanceCalendrierDebPublication.SetDonnees(this.donnee.dateDebut);this.instanceCalendrierDebPublication.SetActif(!!this.donnee.publie);this.instanceCalendrierFinPublication.Initialiser();this.instanceCalendrierFinPublication.SetDonnees(this.donnee.dateFin);this.instanceCalendrierFinPublication.SetActif(!!this.donnee.publie);this.updateSelecteur({liste:this.listeCategories,donnee:this.donnee.categorie,instanceSelect:this.instanceSelectCategorie});this.updateCompteursDestinataires();}
instancierSelecteur(aEvnt,aPere,aParam){const lInstance=Identite.creerInstance(ObjetSelection,{pere:aPere,evenement:aEvnt.bind(aPere)});lInstance.SetParametres(aParam);return lInstance;}
updateSelecteur(aParam){if(aParam.liste){let lIndiceParDefaut=0;const lDonnee=aParam.donnee;if(lDonnee!==null&&lDonnee!==undefined){lIndiceParDefaut=aParam.liste.getIndiceElementParFiltre(function(aElt){if(aParam.comparerGenre===true){return aElt.GetGenre()===lDonnee.GetGenre();} else{return(aElt.GetNumero()===lDonnee.GetNumero());}}.bind(this));}
aParam.instanceSelect.SetDonnees(aParam.liste,lIndiceParDefaut);}}
setOptions(aOptions){this.options=aOptions;}
SetDonnees(aParam){Promise.resolve().then(function(){return this.utilitaires.moteurGestionPJ.getDonneesEditionInformation();}.bind(this)).then(function(aDonnees){this.listePJCree=new ObjetListeElements();this.listePJ=this.utilitaires.moteurGestionPJ.getListePJEtablissement();this.maxSizePJ=aParam.maxSizePJ;this.listeCategories=aDonnees.listeCategories;this.indiceCategorieParDefaut=this.listeCategories.getIndiceElementParFiltre(function(aElement){return aElement.estDefaut;});if(this.indiceCategorieParDefaut=== -1){this.indiceCategorieParDefaut=0;}
if(aParam.forcerAR!==null&&aParam.forcerAR!==undefined){this.forcerAR=aParam.forcerAR;}
if((aParam.donnee!==null)&&(aParam.donnee!==undefined)){this.donneeOrigine=aParam.donnee;} else{this.donneeOrigine=this.moteurCP.initialiserNouveauItem({categorie:this.listeCategories.GetElement(this.indiceCategorieParDefaut),genreReponse:aParam.genreReponse,estInformation:aParam.estInfo,dateFinDerniereDate:true,publie:aParam.publie});}
this.donnee=MethodesObjet.dupliquer(this.donneeOrigine);this.Afficher(this.ComposeContenu());this.updateContenu();if(_estCasParentsDelegues.call(this)){this.utilitaires.moteurDestinataires.automatiserSelectionPublic({genreRessource:this.utilitaires.genreRessource.getRessourceParent(),donnee:this.donnee,clbck:function(){this.updateCompteursDestinataires();}.bind(this)});}}.bind(this));}
ComposeContenu(){return this.construireHtml();}
updateCompteursDestinataires(){const lNbClasses=this.donnee.listePublicEntite.getListeElements(function(D){return D.GetGenre()===this.utilitaires.genreRessource.getRessourceClasse();}.bind(this)).GetNbrElementsExistes();GHtml.setHtml(this.id.nbEntiteClasse,_construireHtmlNb.call(this,lNbClasses));const lNbGpe=this.donnee.listePublicEntite.getListeElements(function(D){return D.GetGenre()===this.utilitaires.genreRessource.getRessourceGroupe();}.bind(this)).GetNbrElementsExistes();GHtml.setHtml(this.id.nbEntiteGpe,_construireHtmlNb.call(this,lNbGpe));if(this.utilitaires.genreEspace.estPourPrimaire()){const lNbResponsables=this.donnee.listePublicIndividu.getListeElements(function(D){return D.GetGenre()===this.utilitaires.genreRessource.getRessourceParent();}.bind(this)).GetNbrElementsExistes();GHtml.setHtml(this.id.nbResponsables,_construireHtmlNb.call(this,lNbResponsables));const lNbProfs=this.donnee.listePublicIndividu.getListeElements(function(D){return D.GetGenre()===this.utilitaires.genreRessource.getRessourceProf();}.bind(this)).GetNbrElementsExistes();GHtml.setHtml(this.id.nbProfs,_construireHtmlNb.call(this,lNbProfs));const lNbPersonnels=this.donnee.listePublicIndividu.getListeElements(function(D){return D.GetGenre()===this.utilitaires.genreRessource.getRessourcePersonnel();}.bind(this)).GetNbrElementsExistes();GHtml.setHtml(this.id.nbPersonnels,_construireHtmlNb.call(this,lNbPersonnels));} else if(_estCasParentsDelegues.call(this)){const lNbResponsables=this.donnee.listePublicIndividu.getListeElements(function(D){return D.GetGenre()===this.utilitaires.genreRessource.getRessourceParent();}.bind(this)).GetNbrElementsExistes();GHtml.setHtml(this.id.nbResponsables,_construireHtmlNb.call(this,lNbResponsables));} else{const lNbIndiv=this.donnee.listePublicIndividu.GetNbrElementsExistes();GHtml.setHtml(this.id.nbIndividus,_construireHtmlNb.call(this,lNbIndiv));}}
construireHtml(){const H=[];H.push('<div class="FicheEditionInfoSond_Mobile">');if((this.donnee!==null)&&(this.donnee!==undefined)){H.push('<div class="item">');H.push(_construireHtmlDestinataires.call(this));H.push('</div>');if(!this.donnee.estVerrouille){H.push('<div class="item selecteur">');H.push(this.composeSelecteur({id:this.instanceSelectCategorie.GetNom(),classCss:''}));H.push('</div>');H.push('<div class="item">');H.push(this.moteurCP.composeForm_Text({id:this.id.titre,node:'nodeTitre',model:'titre',classCss:''}));H.push('</div>');if((this.donnee.estInformation)&&(this.donnee.listeQuestions.GetNbrElementsExistes()>0)){H.push('<div class="item">');H.push(tag('div',{contenteditable:"true",'ie-model':'contenu',class:["contenteditable_index"],placeholder:GTraductions.getValeur('infoSond.redigerContenuInfo')},''));H.push('</div>');H.push('<div class="item">');H.push('<div ',GHtml.composeAttr('ie-node','selecteurPJ',[]),' class="flex-contain conteneurIcon">');H.push('<i class="icon_piece_jointe"></i>');H.push('<span class="strIcon">',GTraductions.getValeur('infoSond.ajouterPJ'),'</span>');H.push('</div>');H.push(_construireHtmlListePJ.call(this));H.push('</div>');}} else{H.push('<div class="ie-titre-petit item msgContenuNonModifiable">',GTraductions.getValeur('actualites.Edition.NonModifiable'),'</div>');}
if(this.forcerAR!==true){H.push('<div class="item">');H.push('<ie-checkbox ie-model="cbAR" ie-textright>',GTraductions.getValeur('actualites.Edition.AvecAR'),'</ie-checkbox>');H.push('</div>');}
H.push('<div class="item">');H.push('<div class="flex-contain chxPublication">');H.push('<ie-radio ie-model="radioPublication(false)" ie-textright class="itemPublication">',GTraductions.getValeur('actualites.NonPubliee'),'</ie-radio>');H.push('<ie-radio ie-model="radioPublication(true)" ie-textright class="itemPublication last">',GTraductions.getValeur('actualites.Publier'),'</ie-radio>');H.push('</div>');H.push('<div class="flex-contain datesPub">');H.push('<span>',GTraductions.getValeur('Du'),'</span>');H.push(this.composeDate({id:this.instanceCalendrierDebPublication.GetNom(),classCss:'itemPublication'}));H.push('<span>',GTraductions.getValeur('Au'),'</span>');H.push(this.composeDate({id:this.instanceCalendrierFinPublication.GetNom(),classCss:'itemPublication'}));H.push('</div>');H.push('<div class="pub_pageetab" ie-display="pourPageEtablissement">');H.push('<ie-checkbox ie-model="cbPublicationPageEtablissement" ie-textright>',GTraductions.getValeur('actualites.Edition.publicationPageEtablissement'),'</ie-checkbox>');H.push('</div>');H.push('</div>');}
H.push('</div>');return H.join('');}
openModaleSelectRespClasses(aParam){this.utilitaires.moteurDestinataires.ouvrirModaleSelectionRessource(aParam);}
openModaleSelectionPublic(aParam){this.utilitaires.moteurDestinataires.ouvrirModaleSelectionPublic(aParam);}
SurValidation(aGenreBouton){const lEstValidation=(aGenreBouton===1);if(lEstValidation){const lControleContenu=_controlerContenu.call(this);if(!lControleContenu){Toast.afficher({msg:GTraductions.getValeur('actualites.MsgAucunContenu'),type:ETypeToast.info,dureeAffichage:4500});return;}
if(!!this.donnee.publie){const lControleDetinataires=this.moteurDestinataires.controlerSurValidation({donnee:this.donnee});if(!lControleDetinataires){return;}}
this.donnee.SetEtat(this.moteurCP.verifierEtatModification({donnee:this.donnee,donneeOrigine:this.donneeOrigine}));}
if(lEstValidation){this.moteurCP.validerEdition({donnee:this.donnee,listePJ:this.listePJ,envoyerRequete:function(aObjetSaisie){this.envoyerRequete({listePJ:this.listePJ,listePJCree:this.listePJCree,paramRequete:aObjetSaisie,clbckSurReussite:this.finaliserValidation.bind(this)});}.bind(this)});} else{this.finaliserValidation(aGenreBouton);}}
finaliserValidation(aGenreBouton,aXml,aJSONReponse,aJSONRapport){this.Fermer();const lParam={donnee:(aGenreBouton===0?this.donneeOrigine:this.donnee),eltCree:aJSONRapport!==null&&aJSONRapport!==undefined&&aJSONRapport.infoSondCree!==null&&aJSONRapport.infoSondCree!==undefined?aJSONRapport.infoSondCree:null};this.callback.appel(aGenreBouton,lParam);}}
function _estCasParentsDelegues(){return this.utilitaires.genreEspace.estEspaceParent(GEtatUtilisateur.GenreEspace);}
function _construireHtmlListePJ(){const H=[];const lQuestion=this.donnee.listeQuestions.GetPremierElement();H.push(tag('div',{id:this.id.listePJ,class:'listePJ'},TUtilitaireUrl.construireListeUrls(lQuestion.listePiecesJointes,{IEModelChips:'chipsPJ'})));return H.join('');}
function _construireHtmlNb(aNb){return' ('+aNb+') ';}
function _construireHtmlDestinataires(){const H=[];H.push('<span class="titreDest">',GTraductions.getValeur('infoSond.destinataires'),'</span>');if(this.utilitaires.genreEspace.estPourPrimaire()){H.push(this.utilitaires.moteurDestinataires.construireHtmlDestPrimaire_Responsables({node:'nodeSelectDestPrimaire_Public',idCompteur:this.id.nbResponsables}));H.push(this.utilitaires.moteurDestinataires.construireHtmlDestPrimaire_Profs({node:'nodeSelectDestPrimaire_Public',idCompteur:this.id.nbProfs}));H.push(this.utilitaires.moteurDestinataires.construireHtmlDestPrimaire_Personnels({node:'nodeSelectDestPrimaire_Public',idCompteur:this.id.nbPersonnels}));H.push(this.utilitaires.moteurDestinataires.construireHtmlDestPrimaire_Directeur({node:'cbPrimaire_Directeur',str:GTraductions.getValeur('actualites.Directeur')}));} else if(_estCasParentsDelegues.call(this)){H.push(this.utilitaires.moteurDestinataires.construireHtmlDest_RespToResp({node:'nodeSelectDest_RespToResp',idCompteur:this.id.nbResponsables}));} else{H.push('<div ie-node="nodeSelectDestParEntite()" class="itemDest flex-contain conteneurIcon">');H.push('<i class="icon_group"></i>');H.push('<div class="strIcon">',GTraductions.getValeur('infoSond.parClasses'),' <span class="strNumber" id="',this.id.nbEntiteClasse,'"> (0) </span>',GTraductions.getValeur('infoSond.ouGroupes'),'<span class="strNumber" id="',this.id.nbEntiteGpe,'"> (0) </span></div>');H.push('<i class="icon_angle_right"></i>');H.push('</div>');H.push('<div ie-node="nodeSelectDestParIndiv()" class="itemDest flex-contain conteneurIcon">');H.push('<i class="icon_user"></i>');H.push('<div class="strIcon">',GTraductions.getValeur('infoSond.aTitreIndiv'),' <span class="strNumber" id="',this.id.nbIndividus,'"> (0) </span></div>');H.push('<i class="icon_angle_right"></i>');H.push('</div>');}
return H.join('');}
function _controlerContenu(){let lEstContenuVide=false;if((this.donnee!==null)&&(this.donnee!==undefined)&&(this.donnee.estInformation)&&(this.donnee.listeQuestions.GetNbrElementsExistes()>0)){const lContenu=this.donnee.listeQuestions.GetPremierElement();const lStr=lContenu.texte.trim();const lContenuEscape=$(GHtml.htmlToDOM(tag('div',lStr))).text().trim();lEstContenuVide=(lContenuEscape==='');}
return!lEstContenuVide;}
function _evntSurEditPJ(aParam){this.utilitaires.moteurGestionPJ.ouvrirModaleSelectionPJ(aParam);}
module.exports={FicheEditionInfoSond_Mobile:FicheEditionInfoSond_Mobile};},fn:"ficheeditioninfosond_mobile.js"});;
IE.fModule({f:function(exports,require,module,global){const EGenreRessource=require('Enumere_Ressource.js');const EGenreEspace=require('Enumere_Espace.js');const TypeGenreInternetIndividu=require('TypeGenreInternetIndividu.js').TypeGenreInternetIndividu;const{TypeDroits}=require('ObjetDroitsPN.js');const ObjetRequeteListePublics=require('ObjetRequeteListePublics.js');const ObjetFenetre_SelectionClasseGroupe=require('ObjetFenetre_SelectionClasseGroupe.js');const ObjetFenetre=require('ObjetFenetre.js');const MethodesObjet=require('MethodesObjet.js');const GTraductions=require('ObjetTraduction.js');const{ObjetFenetre_SelectionPublic,TypeGenreCumulSelectionPublic}=require('ObjetFenetre_SelectionPublic.js');const MethodesTableau=require('MethodesTableau.js');class MoteurDestinatairesPN{estGenrePublicEntite(aParam){if((aParam.donnee===null)||(aParam.donnee===undefined)){return false;}
var lGenresPublicEntite=aParam.donnee.genresPublicEntite;switch(aParam.genreRessource){case EGenreRessource.Responsable:return lGenresPublicEntite.contains(TypeGenreInternetIndividu.InternetIndividu_ParentEleve)||lGenresPublicEntite.contains(TypeGenreInternetIndividu.InternetIndividu_Parent);default:return lGenresPublicEntite.contains(_toInternetIndividu.call(this,aParam.genreRessource));}}
setGenrePublicEntite(aParam){if((aParam.donnee===null)||(aParam.donnee===undefined)){return;}
var lGenresPublicEntite=aParam.donnee.genresPublicEntite;var lRelatifEleve=(aParam.genreRessource===EGenreRessource.Responsable)?(aParam.valeur===true?true:this.estRelatifEleve(aParam)):null;var lGII=_toInternetIndividu.call(this,aParam.genreRessource,lRelatifEleve);var lEstCoche=lGenresPublicEntite.contains(lGII);if(lEstCoche){lGenresPublicEntite.remove(lGII);} else{lGenresPublicEntite.add(lGII);}
aParam.donnee.avecModificationPublic=true;}
estRelatifEleve(aParam){if((aParam.donnee===null)||(aParam.donnee===undefined)){return;}
var lGenresPublicEntite=aParam.donnee.genresPublicEntite;switch(aParam.genreRessource){case EGenreRessource.Responsable:if(lGenresPublicEntite.contains(TypeGenreInternetIndividu.InternetIndividu_ParentEleve)){return true;}
if(lGenresPublicEntite.contains(TypeGenreInternetIndividu.InternetIndividu_Parent)){return false;}
break;}
return null;}
setChoixParMembre(aParam){if((aParam.donnee===null)||(aParam.donnee===undefined)){return;}
var lGenresPublicEntite=aParam.donnee.genresPublicEntite;switch(aParam.genreRessource){case EGenreRessource.Responsable:lGenresPublicEntite.add(_toInternetIndividu.call(this,aParam.genreRessource,aParam.choixParMembre));lGenresPublicEntite.remove(_toInternetIndividu.call(this,aParam.genreRessource,!aParam.choixParMembre));aParam.donnee.avecModificationPublic=true;break;}}
getDonneesPublic(aParam){var lGenreRessource=aParam.genreRessource;var lEstResponsableAResponsable=MethodesTableau.existe(GEtatUtilisateur.GenreEspace,[EGenreEspace.Parent,EGenreEspace.Mobile_Parent]);var lParams={genres:[lGenreRessource],sansFiltreSurEleve:GApplication.droits.get(TypeDroits.communication.toutesClasses),entreResponsables:lEstResponsableAResponsable};if(lEstResponsableAResponsable){lParams['avecFiltreDelegues']=true;}
return new ObjetRequeteListePublics(this,aParam.clbck?aParam.clbck.bind(this):null).lancerRequete(lParams);}
getTitreSelectRessource(aParam){var lGenreRessource=aParam.genreRessource;return EGenreRessource.getTitreFenetreSelectionRessource(lGenreRessource);}
ouvrirModaleSelectionRessource(aParam){var lModaleSelect=ObjetFenetre.creerInstance(ObjetFenetre_SelectionClasseGroupe,{pere:this,evenement:function(aGenreRessource,aListeRessourcesSelect,aNumeroBouton){if(aNumeroBouton===1){var lEntitesAutreGenre=aParam.donnee.listePublicEntite.getListeElements(function(aElt){return aElt.GetGenre()!==aGenreRessource;});aParam.donnee.listePublicEntite=lEntitesAutreGenre;aParam.donnee.listePublicEntite.FusionnerListe(MethodesObjet.dupliquer(aListeRessourcesSelect));aParam.donnee.avecModificationPublic=true;aParam.clbck();}}});var lGenreRessource=aParam.genreRessource;var lListeClassesGroupes=GEtatUtilisateur.getListeClasses({avecClasse:lGenreRessource===EGenreRessource.Classe,avecGroupe:lGenreRessource===EGenreRessource.Groupe,uniquementClasseEnseignee:GEtatUtilisateur.GenreEspace===EGenreEspace.Professeur?!GApplication.droits.get(TypeDroits.communication.toutesClasses):false});var lTitre=lGenreRessource===EGenreRessource.Classe?GTraductions.getValeur('fenetreSelectionClasseGroupe.titreClasses'):GTraductions.getValeur('fenetreSelectionClasseGroupe.titreGroupes');lModaleSelect.setSelectionObligatoire(false);lModaleSelect.setAvecCumul(true);lModaleSelect.setDonnees({listeRessources:lListeClassesGroupes,listeRessourcesSelectionnees:MethodesObjet.dupliquer(aParam.donnee.listePublicEntite),genreRessource:lGenreRessource,titre:lTitre});}
ouvrirModaleSelectionPublic(aParam){this.getDonneesPublic({genreRessource:aParam.genreRessource}).then(function(aDonnees){this.openModaleSelectPublic({donnee:aParam.donnee,clbck:aParam.clbck,titre:this.getTitreSelectRessource({genreRessource:aParam.genreRessource}),genreRessource:aParam.genreRessource,listeRessources:aDonnees.listePublic,listeRessourcesSelectionnees:aParam.donnee.listePublicIndividu.getListeElements(function(aElt){return aElt.GetGenre()===aParam.genreRessource;})});}.bind(this));}
automatiserSelectionPublic(aParam){this.getDonneesPublic({genreRessource:aParam.genreRessource,clbck:function(aDonnees){var lListeComplet=aDonnees.listePublic;if(aParam.donnee.listePublicIndividu.GetNbrElements()===0){var lClasse=null;var lClasseUnique=true;lListeComplet.parcourir(function(aElt){if(aElt.classes&&aElt.classes.GetNbrElements()===1){var lClasseCourante=aElt.classes.GetElement(0);if(lClasse===null){lClasse=lClasseCourante;} else{if(lClasse.GetNumero()!==lClasseCourante.GetNumero()){lClasseUnique=false;}}} else{lClasseUnique=false;}}.bind(this));if(lClasseUnique===true){aParam.donnee.listePublicIndividu=lListeComplet.getListeElements();aParam.donnee.avecModificationPublic=true;aParam.clbck();}}}.bind(this)});}
openModaleSelectPublic(aParam){var lGenreRessource=aParam.genreRessource;var lModaleSelect=ObjetFenetre.creerInstance(ObjetFenetre_SelectionPublic,{pere:this,evenement:function(aGenreRessource,aListeRessourcesSelect,aNumeroBouton){if(aNumeroBouton===1){var lPublicAutresGenres=aParam.donnee.listePublicIndividu.getListeElements(function(aElt){return aElt.GetGenre()!==aGenreRessource;});aParam.donnee.listePublicIndividu=lPublicAutresGenres;aParam.donnee.listePublicIndividu.FusionnerListe(MethodesObjet.dupliquer(aListeRessourcesSelect));aParam.donnee.avecModificationPublic=true;aParam.clbck();}}},{titre:aParam.titre});switch(lGenreRessource){case EGenreRessource.Eleve:case EGenreRessource.Responsable:lModaleSelect.setGenreCumulActif(TypeGenreCumulSelectionPublic.classe);break;}
lModaleSelect.setOptions({avecCocheRessources:true,selectionObligatoire:false,filtres:[],avecBarreTitre:false,estDeploye:false,avecFiltreDelegues:MethodesTableau.existe(GEtatUtilisateur.GenreEspace,[EGenreEspace.Parent,EGenreEspace.Mobile_Parent])});lModaleSelect.setDonnees({listeRessources:aParam.listeRessources,listeRessourcesSelectionnees:aParam.listeRessourcesSelectionnees,genreRessource:aParam.genreRessource,titre:aParam.titre});}
construireHtmlDest_RespToResp(aParam){var H=[];H.push('<div ie-node="',aParam.node,'()" class="itemDest flex-contain conteneurIcon">');H.push('<i class="icon_group"></i>');H.push('<div class="strIcon">',GTraductions.getValeur('destinataires.respDesClasses'),' <span class="strNumber" id="',aParam.idCompteur,'"> (0) </span></div>');H.push('<i class="icon_angle_right"></i>');H.push('</div>');return H.join('');}
construireHtmlDestPrimaire_RespClasses(aParam){var H=[];H.push('<div ie-node="',aParam.node,'(',EGenreRessource.Classe,')" class="itemDest flex-contain conteneurIcon">');H.push('<i class="icon_group"></i>');H.push('<div class="strIcon">',GTraductions.getValeur('destinataires.respDesClasses'),' <span class="strNumber" id="',aParam.idCompteur,'"> (0) </span></div>');H.push('<i class="icon_angle_right"></i>');H.push('</div>');return H.join('');}
construireHtmlDestPrimaire_Responsables(aParam){var H=[];H.push(_construireHtmlSelectionDeRessource.call(this,{node:aParam.node,genreRessource:EGenreRessource.Responsable,strRessource:GTraductions.getValeur('destinataires.responsables'),idCompteur:aParam.idCompteur}));return H.join('');}
construireHtmlDestPrimaire_Profs(aParam){var H=[];H.push(_construireHtmlSelectionDeRessource.call(this,{node:aParam.node,genreRessource:EGenreRessource.Enseignant,strRessource:GTraductions.getValeur('destinataires.professeurs'),idCompteur:aParam.idCompteur}));return H.join('');}
construireHtmlDestPrimaire_Personnels(aParam){var H=[];H.push(_construireHtmlSelectionDeRessource.call(this,{node:aParam.node,genreRessource:EGenreRessource.Personnel,strRessource:GTraductions.getValeur('destinataires.personnels'),idCompteur:aParam.idCompteur}));return H.join('');}
construireHtmlDestPrimaire_Directeur(aParam){var H=[];H.push('<ie-checkbox class="itemDest" ie-model="',aParam.node,'()" ie-textright>',aParam.str,'</ie-checkbox>');return H.join('');}
surSelectEntites_PrimaireRespClasses(aParam){if(!GEtatUtilisateur.pourPrimaire()){return;}
var lDonnee=aParam.donnee;var lNbClasses=lDonnee.listePublicEntite.getListeElements(function(D){return D.GetGenre()===EGenreRessource.Classe;}.bind(this)).GetNbrElementsExistes();var lEstCoche=lDonnee.genresPublicEntite.contains(TypeGenreInternetIndividu.InternetIndividu_Parent);if(lNbClasses>0){if(!lEstCoche){lDonnee.genresPublicEntite.add(TypeGenreInternetIndividu.InternetIndividu_Parent);}} else{if(lEstCoche){lDonnee.genresPublicEntite.remove(TypeGenreInternetIndividu.InternetIndividu_Parent);}}}}
function _toInternetIndividu(aGenreRessource,aRelatifEleve){switch(aGenreRessource){case EGenreRessource.Enseignant:return TypeGenreInternetIndividu.InternetIndividu_Professeur;case EGenreRessource.Eleve:return TypeGenreInternetIndividu.InternetIndividu_Eleve;case EGenreRessource.Responsable:return(aRelatifEleve?TypeGenreInternetIndividu.InternetIndividu_ParentEleve:TypeGenreInternetIndividu.InternetIndividu_Parent);case EGenreRessource.MaitreDeStage:return TypeGenreInternetIndividu.InternetIndividu_MaitreDeStageEleve;case EGenreRessource.Personnel:return TypeGenreInternetIndividu.InternetIndividu_Personnel;}}
function _construireHtmlSelectionDeRessource(aParam){var H=[];H.push('<div ie-node="',aParam.node,'(',aParam.genreRessource,')" class="flex-contain itemDest conteneurIcon ">');H.push('<i class="icon_group"></i>');H.push('<div class="strIcon">',aParam.strRessource,' <span class="strNumber" id="',aParam.idCompteur,'"></span>','</div>');H.push('<i class="icon_angle_right"></i>');H.push('</div>');return H.join('');}
module.exports=MoteurDestinatairesPN;},fn:"moteurdestinatairespn.js"});;
IE.fModule({f:function(exports,require,module,global){const ObjetFenetre=require('ObjetFenetre.js');const ObjetElement=require('ObjetElement.js');const EGenreEtat=require('Enumere_Etat.js');const EGenreRessource=require('Enumere_Ressource.js');const ObjetRequeteDonneesEditionInformation=require('ObjetRequeteDonneesEditionInformation.js');const MethodesObjet=require('MethodesObjet.js');const TypeHttpNotificationDonnes=require('TypeHttpNotificationDonnes.js').TypeHttpNotificationDonnes;class MoteurGestionPJPN{ouvrirModaleSelectionPJ(aParam){let lAvecSaisie=false;$.extend(aParam,{genreRessourceDocJoint:EGenreRessource.DocJointEtablissement});const lModaleSelect=ObjetFenetre.creerInstance(require('ObjetFenetre_PieceJointe.js'),{pere:aParam.instance,evenement:function(aNumeroBouton,aParamsFenetre){const lListeFichiers=aParamsFenetre.instance.ListeFichiers;aParam.listePiecesJointes.parcourir(function(aDocument){if(aDocument.Etat!==EGenreEtat.Aucun){lAvecSaisie=true;}
let lDocumentJoint=aParam.listePJContexte.GetElementParNumero(aDocument.GetNumero());const lActif=aDocument.Actif&&aDocument.Existe();if(lDocumentJoint){if(aDocument.Existe()&&(aDocument.Etat===EGenreEtat.Modification)){lDocumentJoint.SetLibelle(aDocument.GetLibelle());}
if(!lActif){lDocumentJoint.SetEtat(EGenreEtat.Suppression);aParam.element.SetEtat(EGenreEtat.Modification);lAvecSaisie=true;}} else{if(lActif){lDocumentJoint=new ObjetElement(aDocument.GetLibelle(),aDocument.GetNumero(),aDocument.GetGenre());if(aDocument.Fichier){lDocumentJoint.idFichier=aDocument.Fichier.idFichier;lDocumentJoint.Libelle=aDocument.Fichier.Libelle;lDocumentJoint.nomOriginal=aDocument.Fichier.nomOriginal;lDocumentJoint.file=aDocument.Fichier.file;}
lDocumentJoint.SetEtat(EGenreEtat.Creation);aParam.element.SetEtat(EGenreEtat.Modification);aParam.listePJContexte.AddElement(lDocumentJoint);lAvecSaisie=true;}}}.bind(this));aParam.listePiecesJointes.trier();aParam.validation(aParamsFenetre,lListeFichiers,lAvecSaisie);},initialiser:function(aInstance){aInstance.SetEtatSaisie=function(aEtatSaisie){if(aEtatSaisie){lAvecSaisie=true;}};aInstance.SetGenre(aParam.genre);aInstance.setOptionsFenetre({avecBoutonActualiser:false,avecComposeBasInFooter:true});}});lModaleSelect.afficherFenetrePJ({listePJTot:aParam.listePiecesJointes,listePJContexte:aParam.listePJContexte,genrePJ:aParam.genre,genreRessourcePJ:aParam.genreRessourceDocJoint,avecFiltre:false,optionsSelecFile:{maxSize:aParam.maxSize},modeLien:false,surValiderAvantFermer:null,validationAuto:null});}
getDonneesEditionInformation(){return new ObjetRequeteDonneesEditionInformation(this).lancerRequete({init:true});}
getListePJEtablissement(){return GEtatUtilisateur.listeDonnees!==null&&GEtatUtilisateur.listeDonnees!==undefined?MethodesObjet.dupliquer(GEtatUtilisateur.listeDonnees[TypeHttpNotificationDonnes.THND_ListeDocJointEtablissement]):null;}}
module.exports=MoteurGestionPJPN;},fn:"moteurgestionpjpn.js"});;
IE.fModule({f:function(exports,require,module,global){const TypeGenreEchangeDonnees={GED_PAS:0,GED_ModelesSondage:1};module.exports.TypeGenreEchangeDonnees=TypeGenreEchangeDonnees;},fn:"typegenreechangedonnees.js"});;
IE.fModule({f:function(exports,require,module,global){const{ObjetRequeteSaisie,EGenreReponseSaisie}=require('ObjetRequeteJSON.js');const Requetes=require('CollectionRequetes.js');const EGenreBoiteMessage=require('Enumere_BoiteMessage.js');const GTraductions=require('ObjetTraduction.js');const TypeGenreEchangeDonnees=require('TypeGenreEchangeDonnees.js').TypeGenreEchangeDonnees;class ObjetRequeteSaisieExportFichierProf extends ObjetRequeteSaisie{constructor(...aParams){super(...aParams);}
lancerRequete(aParam){$.extend(this.JSON,aParam);if(this.JSON&&this.JSON.listeModeles!==null&&this.JSON.listeModeles!==undefined){this.JSON.listeModeles.setSerialisateurJSON({ignorerEtatsElements:true,nePasTrierPourValidation:true});}
let lStrMsgDetail;switch(aParam.genreFichier){case TypeGenreEchangeDonnees.GED_PAS:lStrMsgDetail=GTraductions.getValeur('Commande.CreerUnFichierDeRessources');break;default:lStrMsgDetail='';}
return this.appelAsynchrone({messageDetail:lStrMsgDetail});}
traiterReponseSaisieMessage(aMessagesErreurRapportSaisie){let lDetails='';if(aMessagesErreurRapportSaisie&&aMessagesErreurRapportSaisie.join){lDetails=aMessagesErreurRapportSaisie.join('\n');}
GApplication.getMessage().afficher({type:EGenreBoiteMessage.Information,message:GTraductions.getValeur('EchecSauvegarderUnFichierDeRessourcesPeda')+(lDetails?'\n\n'+lDetails:'')});}
actionApresRequete(aXml,aGenreReponse){this.callbackReussite.appel(aGenreReponse!==EGenreReponseSaisie.succes,this.JSONReponse.url);}}
Requetes.inscrire('SaisieExportFichierProf',ObjetRequeteSaisieExportFichierProf);module.exports=ObjetRequeteSaisieExportFichierProf;},fn:"objetrequetesaisieexportfichierprof.js"});;
IE.fModule({f:function(exports,require,module,global){const{ObjetRequeteSaisie,EGenreReponseSaisie}=require('ObjetRequeteJSON.js');const Requetes=require('CollectionRequetes.js');const GTraductions=require('ObjetTraduction.js');const TypeGenreEchangeDonnees=require('TypeGenreEchangeDonnees.js').TypeGenreEchangeDonnees;class ObjetRequeteSaisieImportFichierProf extends ObjetRequeteSaisie{constructor(...aParams){super(...aParams);}
lancerRequete(aParam){$.extend(this.JSON,aParam);let lStrMsgDetail;switch(aParam.genreFichier){case TypeGenreEchangeDonnees.GED_PAS:lStrMsgDetail=GTraductions.getValeur('Commande.RecupererFichierDeRessources');break;default:lStrMsgDetail='';}
return this.appelAsynchrone({messageDetail:lStrMsgDetail});}
actionApresRequete(aBidon,aGenreMessage){this.callbackReussite.appel(aGenreMessage===EGenreReponseSaisie.succes);}}
Requetes.inscrire('SaisieImportFichierProf',ObjetRequeteSaisieImportFichierProf);module.exports=ObjetRequeteSaisieImportFichierProf;},fn:"objetrequetesaisieimportfichierprof.js"});;
IE.fModule({f:function(exports,require,module,global){const GChaine=require('GChaine.js');const ObjetFenetre=require('ObjetFenetre.js');const GTraductions=require('ObjetTraduction.js');const ObjetRequeteSaisieImportFichierProf=require('ObjetRequeteSaisieImportFichierProf.js');const TypeGenreEchangeDonnees=require('TypeGenreEchangeDonnees.js').TypeGenreEchangeDonnees;class ObjetFenetre_ImportFichierProf extends ObjetFenetre{constructor(...aParams){super(...aParams);this.setOptionsFenetre({largeur:380,titre:'',listeBoutons:[GTraductions.getValeur('Annuler')],avecTailleSelonContenu:true});}
getControleur(aInstance){return $.extend(true,super.getControleur(aInstance),{btnUpload:{getOptionsSelecFile:function(){return{maxSize:500*1024*1024,accept:'application/zip',extensions:['zip'],avecTransformationFlux:false};},addFiles:function(aParametres){aInstance.Fermer();new ObjetRequeteSaisieImportFichierProf({}).addUpload({listeFichiers:aParametres.listeFichiers,maxChunkSize:1*1024*1024,annulerSurErreurUpload:true}).lancerRequete({genreFichier:aInstance.options.genreFichier}).then(function(aSucces){if(aSucces){return GApplication.getMessage().afficher({message:GTraductions.getValeur('Fenetre_ImportFichierProf.ReussiteImport'),callback:function(){this.callback.appel();}.bind(this)});}}.bind(aInstance));}}});}
SetDonnees(){this.Afficher();}
ComposeBoutons(){const H=[];H.push(super.ComposeBoutons());H.push('<div class="btn-conteneur" style="flex: none; padding-left: 0">');H.push('<ie-bouton ie-model="btnUpload" class="themeBoutonPrimaire" ie-selecfile >',GTraductions.getValeur('Fenetre_ImportFichierProf.ChoisirLeFichier'),'</ie-bouton>');H.push('</div>');return H.join('');}
ComposeContenu(){let lMsg;switch(this.options.genreFichier){case TypeGenreEchangeDonnees.GED_PAS:lMsg=GTraductions.getValeur('Fenetre_ImportFichierProf.TexteExplicatif');break;case TypeGenreEchangeDonnees.GED_ModelesSondage:lMsg=GTraductions.getValeur('Fenetre_ImportFichierProf.TexteExplicatifModelesSond');break;default:lMsg='';}
const T=[];T.push('<div class="Table Texte10">',GChaine.ToHTML(lMsg),'</div>');return T.join('');}
SurValidation(ANumeroBouton){this.Fermer();this.callback.appel(ANumeroBouton);}}
module.exports=ObjetFenetre_ImportFichierProf;},fn:"objetfenetre_importfichierprof.js"});;
IE.fModule({f:function(exports,require,module,global){const MethodesObjet=require('MethodesObjet.js');const InterfacePageInfoSondage=require('InterfacePageInfoSondage.js');const ObjetRequetePageActualites=require('ObjetRequetePageActualites.js');const ObjetTri=require('ObjetTri.js');const EGenreTriElement=require('Enumere_TriElement.js');const ObjetMoteurActus=require('ObjetMoteurActus.js');const EGenreEvntActu=require('EGenreEvntActu.js');const ObjetRequeteSaisieActualites=require('ObjetRequeteSaisieActualites.js');const EGenreEspace=require('Enumere_Espace.js');const MethodesTableau=require('MethodesTableau.js');const{TypeDroits}=require('ObjetDroitsPN.js');const ObjetRequetePageActualitesResultats=require('ObjetRequetePageActualitesResultats.js');const ObjetFenetre=require('ObjetFenetre.js');const TypeBoutonFenetreResultatActualite=require('ObjetFenetre_ResultatsActualite.js').TypeBoutonFenetreResultatActualite;const TypeThemeBouton=require('Type_ThemeBouton.js');const GTraductions=require('ObjetTraduction.js');const ObjetFenetre_EditionInfoSond=require('ObjetFenetre_EditionActualite.js');const ObjetRequeteGenererFichiersResultatsSondage=require('ObjetRequeteGenererFichiersResultatsSondage.js');const EGenreBoiteMessage=require('Enumere_BoiteMessage.js');const{MoteurInfoSondage,EGenreEvntMenuCtxBlocInfoSondage}=require('MoteurInfoSondage.js');const UtilitaireGenreRessource=require('GestionnaireBlocPN.js').UtilitaireGenreRessource;const UtilitaireGenreEspace=require('GestionnaireBlocPN.js').UtilitaireGenreEspace;const UtilitaireGenreReponse=require('GestionnaireBlocPN.js').UtilitaireGenreReponse;const EGenreEtat=require('Enumere_Etat.js');const ObjetRequeteSaisieFichierResultatsSondage=require('ObjetRequeteSaisieFichierResultatsSondage.js');const ObjetElement=require('ObjetElement.js');const ObjetListeElements=require('ObjetListeElements.js');const ObjetFenetre_Message=require('ObjetFenetre_Message.js');const EGenreRessource=require('Enumere_Ressource.js');const{GDate}=require('ObjetDate.js');const FicheEditionInfoSond=require('FicheEditionInfoSond_Mobile.js').FicheEditionInfoSond_Mobile;const Identite=require('ObjetIdentite.js');const ObjetCelluleDate=require('ObjetCelluleDate.js');const MoteurDestinatairesPN=require('MoteurDestinatairesPN.js');const ObjetMenuContextuel=require('ObjetMenuContextuel.js');const MoteurGestionPJPN=require('MoteurGestionPJPN.js');const TypeItemEnum=require('TypeEtatPublication.js').TypeItemEnum;const TypeItemEnumUtil=require('TypeEtatPublication.js').TypeItemEnumUtil;const TypeModeAff=require('TypeEtatPublication.js').TypeModeAff;const TypeEnsembleNombre=require('TypeEnsembleNombre.js');const ObjetRequeteSaisieExportFichierProf=require('ObjetRequeteSaisieExportFichierProf.js');const TypeGenreEchangeDonnees=require('TypeGenreEchangeDonnees.js').TypeGenreEchangeDonnees;const GChaine=require('GChaine.js');const ObjetFenetre_ImportFichierProf=require('ObjetFenetre_ImportFichierProf.js');class InterfacePageInfoSondagePN extends InterfacePageInfoSondage{constructor(...aParams){super(...aParams);this.utilitaires={genreRessource:new UtilitaireGenreRessource(),genreEspace:new UtilitaireGenreEspace(),genreReponse:new UtilitaireGenreReponse(),moteurDestinataires:new MoteurDestinatairesPN(),moteurGestionPJ:new MoteurGestionPJPN()};this.moteur=new ObjetMoteurActus(this.utilitaires);this.moteurCP=new MoteurInfoSondage(this.utilitaires);this.avecPageFondBlanc=true;this.diffusionResultatsSondageEnCours=false;this.listePJ=this.avecAuteur&&this.droitSaisie?this.utilitaires.moteurGestionPJ.getListePJEtablissement():null;this.page=IE.estMobile?GEtatUtilisateur.getPage():GEtatUtilisateur.Navigation.OptionsOnglet;if(!!this.page&&this.page.avecActionSaisie){this.modeAff=this.genresAffichages.saisie;this.filtreModeItem=TypeItemEnum.IE_Diffusion_Tout;this.modeAuteur=this.avecAuteur;}}
getControleur(aInstance){return $.extend(true,super.getControleur(aInstance),{});}
instancierEditionInfoSond(){if(IE.estMobile){return this.addFenetre(FicheEditionInfoSond,_evenementEditionActu.bind(this),_initFicheEditionInfoSond.bind(this));} else{return this.addFenetre(ObjetFenetre_EditionInfoSond,_evenementEditionActu.bind(this),this.initFenetreEditionInfoSond);}}
ActualiserDonnees(){const lModesAff=new TypeEnsembleNombre();lModesAff.add(TypeModeAff.MA_Reception);if(this.avecAuteur){lModesAff.add(TypeModeAff.MA_Diffusion);lModesAff.add(TypeModeAff.MA_Brouillon);lModesAff.add(TypeModeAff.MA_Modele);}
new ObjetRequetePageActualites(this,_actionSurRecupererDonnees.bind(this)).lancerRequete({modesAffActus:lModesAff});}
estInfoSondDuTypeModeDiff(aInfoSond,aFiltreModeAff){const lInfos=this.moteurCP.getInfosPublication(aInfoSond);switch(aFiltreModeAff){case TypeItemEnum.IE_Diffusion_Tout:return true;case TypeItemEnum.IE_Diffusion_Publiee:return lInfos.estEnCours;case TypeItemEnum.IE_Diffusion_PublieeFutur:return lInfos.estFutur;case TypeItemEnum.IE_Diffusion_PublieePasse:return lInfos.estPassee;case TypeItemEnum.IE_Brouillon:return!lInfos.estPubliee;default:return false;}}
estInfoSondDuTypeModeModeles(aInfoSond,aFiltreModeAff){switch(aFiltreModeAff){case TypeItemEnum.IE_Modele_Info:return aInfoSond.estInformation;case TypeItemEnum.IE_Modele_Sondage:return aInfoSond.estSondage;default:return false;}}
getListeActualitesDeModeAff(aModeAff){const lData=this.tabModeAff[aModeAff];if(lData!==null&&lData!==undefined){return lData.listeActualites;} else{return null;}}
getCompteurDeType(aTypeItemEnum){let lModeAff=TypeItemEnumUtil.getTypeModeAffDeTypeItemEnum(aTypeItemEnum);let lListeActus=this.getListeActualitesDeModeAff(lModeAff);if(lListeActus===null||lListeActus===undefined){return 0;}
let lListeFiltree=lListeActus.getListeElements(function(aElt){switch(aTypeItemEnum){case TypeItemEnum.IE_Reception:return!aElt.lue;case TypeItemEnum.IE_Diffusion_Tout:case TypeItemEnum.IE_Diffusion_PublieePasse:case TypeItemEnum.IE_Diffusion_Publiee:case TypeItemEnum.IE_Diffusion_PublieeFutur:case TypeItemEnum.IE_Brouillon:return this.estInfoSondDuTypeModeDiff(aElt,aTypeItemEnum);case TypeItemEnum.IE_Modele_Sondage:case TypeItemEnum.IE_Modele_Info:return this.estInfoSondDuTypeModeModeles(aElt,aTypeItemEnum);default:;return false;}}.bind(this));return lListeFiltree!==null&&lListeFiltree!==undefined?lListeFiltree.GetNbrElements():0;}
getListeFiltree(){const lListeFiltree=this.listeActualites.getListeElements(function(aElement){return(!(this.estGenreReception()&&this.uniquementNonLues&&aElement.lue)&&(!this.estGenreDiffusion()||this.estInfoSondDuTypeModeDiff(aElement,this.filtreModeItem))&&(!this.estGenreModeles()||this.estInfoSondDuTypeModeModeles(aElement,this.filtreModeItem))&&((!this.avecFiltreCategorie)||((this.categorie!==null)&&(this.categorie!==undefined)&&(!this.categorie.existeNumero()||(aElement.categorie.GetNumero()===this.categorie.GetNumero())))));}.bind(this));lListeFiltree.setTri([
ObjetTri.init('dateDebut',EGenreTriElement.Decroissant),ObjetTri.init('dateCreation',EGenreTriElement.Decroissant),ObjetTri.init('Libelle')
]);lListeFiltree.trier();return lListeFiltree;}
getOptionsInfoSond(){return{avecEditionActualite:this.estGenreDiffusion()||this.estGenreModeles(),droitSaisie:this.droitSaisie,droitPublicationPageEtablissement:this.droitPublicationPageEtablissement,avecVisuResultats:this.estGenreDiffusion(),avecSuppressionActusRecues:true,avecDiscussion:this.estGenreReception()&&MethodesTableau.existe(GEtatUtilisateur.GenreEspace,[
EGenreEspace.Professeur,EGenreEspace.PrimProfesseur,EGenreEspace.Etablissement,EGenreEspace.Administrateur,EGenreEspace.Eleve,EGenreEspace.Parent,EGenreEspace.PrimParent,EGenreEspace.Accompagnant,EGenreEspace.PrimAccompagnant,EGenreEspace.Tuteur
]),avecModeles:this.getAvecModeles(),estCtxModeles:this.estGenreModeles(),evenementMenuContextuel:function(aInfoSond,aGenreEvnt,aParam){this.evntSurValidationInfoSond(aInfoSond,aGenreEvnt,aParam);}.bind(this)};}
reInitialiserSurValidation(){this.contexte.niveauCourant=this.getNiveauDeGenreEcran({genreEcran:this.avecAuteur?InterfacePageInfoSondage.genreEcran.listeTypesBlocs:InterfacePageInfoSondage.genreEcran.listeBlocs});this.Initialiser(true);}
evntSurValidationInfoSond(aInfoSond,aGenreEvnt,aParam){if(EGenreEvntActu.estEvntSaisieReponse(aGenreEvnt)){aParam.modeAuteur=this.modeAuteur;aParam.clbckRecupDonnees=this.reInitialiserSurValidation;aParam.pereRecupDonnees=this;this.moteur.surEvntSaisieReponseActu(aInfoSond,aGenreEvnt,aParam);} else{switch(aGenreEvnt){case EGenreEvntActu.SurSelectionInfoSondage:this.surSelectionInfoSondage({infoSondage:aInfoSond});break;case EGenreEvntActu.SurCreationActu:{let lItemASelectionner;if(aInfoSond&&!!aInfoSond.estAModeliser){lItemASelectionner=aInfoSond.estInformation?TypeItemEnum.IE_Modele_Info:TypeItemEnum.IE_Modele_Sondage;} else{lItemASelectionner=TypeItemEnum.IE_Brouillon;}
this.filtreModeItem=lItemASelectionner;let lItemASelectionnerApresSaisie=this.getItemDeType(this.filtreModeItem);this.setCtxSelection({niveauEcran:0,dataEcran:lItemASelectionnerApresSaisie});this.listeActualites.AddElement(aInfoSond);declencherSaisie.call(this);break;}
case EGenreEvntActu.SurValidationModif:declencherSaisie.call(this);break;case EGenreEvntActu.SurMenuCtxActu:switch(aParam.cmd.GetNumero()){case EGenreEvntMenuCtxBlocInfoSondage.editerActu:if(this.GetInstance(this.identEditionInfoSond)){this.GetInstance(this.identEditionInfoSond).setOptionsFenetre({titre:GTraductions.getValeur('actualites.Edition.Modification')});this.GetInstance(this.identEditionInfoSond).SetDonnees(this.initDataInfoSondSurEdition({estCreation:false,donnee:aInfoSond,estModele:aInfoSond.estModele===true,avecRecupModele:!aInfoSond.estModele&&this.avecModeles}));}
break;case EGenreEvntMenuCtxBlocInfoSondage.recupererModele:{this.GetInstance(this.identEditionInfoSond).SetDonnees(this.initDataInfoSondSurEdition({estCreation:true,estInfo:aInfoSond.estInformation,appliquerModele:aInfoSond,avecRecupModele:false}));break;}
case EGenreEvntMenuCtxBlocInfoSondage.exporterModele:{new ObjetRequeteSaisieExportFichierProf({},function(aEchec,aUrl){if(aEchec||!aUrl){return;}
window.open(GChaine.encoderUrl(aUrl));}).lancerRequete({genreFichier:TypeGenreEchangeDonnees.GED_ModelesSondage,listeModeles:new ObjetListeElements().AddElement(aInfoSond)});break;}
case EGenreEvntMenuCtxBlocInfoSondage.voirResultats:this.evntSurAfficherResultats(aInfoSond);break;case EGenreEvntMenuCtxBlocInfoSondage.demarrerDiscussion:this.surDemarrerDiscussion(aInfoSond);break;}
break;case EGenreEvntActu.SurDiffusionResultats:{const lInstanceFenetreEdition=this.GetInstance(this.identEditionInfoSond);if(!!lInstanceFenetreEdition){new ObjetRequeteGenererFichiersResultatsSondage(this).lancerRequete({sondage:aInfoSond,nominatif:aParam.estNominatif}).then(function(aJSON){if(!aJSON.messageErreur&&!!aJSON.listeFichiersResultatsCrees&&aJSON.listeFichiersResultatsCrees.GetNbrElements()>0){const lNouvelleActu=this.moteurCP.creerInfoDiffusionDesResultatsSondage(aInfoSond,this.listeCategories,aJSON.listeFichiersResultatsCrees);this.diffusionResultatsSondageEnCours=true;lInstanceFenetreEdition.setOptionsFenetre({titre:GTraductions.getValeur('actualites.creerInfo')});lInstanceFenetreEdition.SetDonnees({donnee:lNouvelleActu,creation:true});} else{GApplication.getMessage().afficher({type:EGenreBoiteMessage.Information,titre:GTraductions.getValeur('SaisieImpossible'),message:GTraductions.getValeur('actualites.Edition.ErreurCreationFichiersResultats')});}}.bind(this));}
break;}}}}
getAvecAuteur(){const lMasquerFonctionnalite=false;return MethodesTableau.existe(GEtatUtilisateur.GenreEspace,[ EGenreEspace.Professeur,EGenreEspace.Mobile_Professeur,EGenreEspace.Etablissement,EGenreEspace.Mobile_Etablissement,EGenreEspace.Administrateur,EGenreEspace.Mobile_Administrateur,EGenreEspace.PrimProfesseur,EGenreEspace.Mobile_PrimProfesseur
])||(((MethodesTableau.existe(GEtatUtilisateur.GenreEspace,[EGenreEspace.Parent,EGenreEspace.Mobile_Parent]))&&GEtatUtilisateur.Identification.ressource.estDelegue&&GParametres.ActivationMessagerieEntreParents)&&!lMasquerFonctionnalite);}
getAvecDroitSaisie(){return GApplication.droits.get(TypeDroits.actualite.avecSaisieActualite)||((MethodesTableau.existe(GEtatUtilisateur.GenreEspace,[EGenreEspace.Parent,EGenreEspace.Mobile_Parent]))&&GEtatUtilisateur.Identification.ressource.estDelegue&&GParametres.ActivationMessagerieEntreParents);}
getDroitPublicationPageEtablissement(){return GApplication.droits.get(TypeDroits.communication.avecPublicationPageEtablissement);}
getForcerAR(){return GApplication.droits.get(TypeDroits.fonctionnalites.forcerARInfos);}
getAvecSondageAnonyme(){return GApplication.droits.get(TypeDroits.fonctionnalites.gestionSondageAnonyme);}
getAvecFiltreCategorie(){return true;}
surDemarrerDiscussion(aInfoSond){ObjetFenetre_Message.creerFenetreDiscussion(this,_donneesFenetreEditionDiscussion.call(this,aInfoSond));}
initDataInfoSondSurEdition(aParam){if(aParam.estCreation===true){const lDefault={donnee:null,creation:true,forcerAR:this.forcerAR,estInfo:aParam.estInfo,genreReponse:aParam.estInfo?this.utilitaires.genreReponse.getGenreAvecAR():this.utilitaires.genreReponse.getGenreChoixUnique(),listePJ:this.listePJ,maxSizePJ:GApplication.droits.get(TypeDroits.tailleMaxDocJointEtablissement),listeCategories:this.listeCategories,publie:this.avecAuteur&&this.filtreModeItem===TypeItemEnum.IE_Brouillon?false:true,estModele:aParam.estModele,appliquerModele:aParam.appliquerModele,avecRecupModele:aParam.avecRecupModele};if(aParam.estInfo===false){return $.extend(lDefault,{avecChoixAnonyme:this.avecSondageAnonyme});}
return lDefault;} else{return{donnee:aParam.donnee,forcerAR:this.forcerAR,avecChoixAnonyme:this.avecSondageAnonyme,creation:false,listePJ:this.listePJ,maxSizePJ:GApplication.droits.get(TypeDroits.tailleMaxDocJointEtablissement),listeCategories:this.listeCategories,estModele:aParam.estModele,avecRecupModele:aParam.avecRecupModele};}}
getTypeInfoSondParDefaut(){return this.page&&this.page.avecActionSaisie?TypeItemEnum.IE_Diffusion_Tout:TypeItemEnum.IE_Reception;}
getListeDonneesTypesInfoSond(){const lDonnees=new ObjetListeElements();let lEltDiffTout=null;for(const lGenre in TypeItemEnum){const lTypeItemEnum=TypeItemEnum[lGenre];if(MethodesObjet.isNumber(lTypeItemEnum)&&(this.getAvecModeles()||!MethodesTableau.existe(lTypeItemEnum,[TypeItemEnum.IE_Modele_Info,TypeItemEnum.IE_Modele_Sondage]))){let lElt=new ObjetElement(TypeItemEnumUtil.getStr(lTypeItemEnum),lTypeItemEnum,lTypeItemEnum);lElt.icone=TypeItemEnumUtil.getIcon(lTypeItemEnum);lElt.compteur=this.getCompteurDeType(lTypeItemEnum);lElt.estAvecSeparateurHaut=MethodesTableau.existe(lTypeItemEnum,[TypeItemEnum.IE_Diffusion_Tout,TypeItemEnum.IE_Modele_Sondage]);if(lTypeItemEnum===TypeItemEnum.IE_Diffusion_Tout){lEltDiffTout=lElt;} else if(lEltDiffTout!==null&&
MethodesTableau.existe(lTypeItemEnum,[TypeItemEnum.IE_Diffusion_Publiee,TypeItemEnum.IE_Diffusion_PublieeFutur,TypeItemEnum.IE_Diffusion_PublieePasse])){lElt.pere=lEltDiffTout;}
lDonnees.AddElement(lElt);}}
return lDonnees;}
getGenreAffichageSelonTypeAcces(aParam){switch(aParam.selection.Genre){case TypeItemEnum.IE_Reception:return this.genresAffichages.reception;case TypeItemEnum.IE_Diffusion_Tout:case TypeItemEnum.IE_Diffusion_PublieePasse:case TypeItemEnum.IE_Diffusion_Publiee:case TypeItemEnum.IE_Diffusion_PublieeFutur:case TypeItemEnum.IE_Brouillon:return this.genresAffichages.saisie;case TypeItemEnum.IE_Modele_Info:case TypeItemEnum.IE_Modele_Sondage:return this.genresAffichages.modeles;default:;}}
getAvecModeles(){return this.getAvecAuteur()&&this.getAvecDroitSaisie()&&MethodesTableau.existe(GEtatUtilisateur.GenreEspace,[
EGenreEspace.Professeur,EGenreEspace.PrimProfesseur,EGenreEspace.Etablissement,EGenreEspace.Administrateur
]);}
estModeItemDeTypeInfo(){return(this.filtreModeItem===TypeItemEnum.IE_Modele_Info);}
estModeItemDeTypeSondage(){return(this.filtreModeItem===TypeItemEnum.IE_Modele_Sondage);}
evntImportModele(){if(GApplication.getModeExclusif()){GApplication.getMessage().afficher({titre:GTraductions.getValeur('ModeExclusif.UsageExclusif'),message:GTraductions.getValeur('ModeExclusif.SaisieImpossibleConsultation')});} else{ObjetFenetre.creerInstance(ObjetFenetre_ImportFichierProf,{pere:this,initialiser:function(aInstance){aInstance.setOptionsFenetre({titre:GTraductions.getValeur('actualites.importerModeleSondage')});aInstance.setOptions({genreFichier:TypeGenreEchangeDonnees.GED_ModelesSondage});}.bind(this),evenement:function(){this.reInitialiserSurValidation();}.bind(this)}).SetDonnees();}}
evenementOuvrirMenuContextuel(aInfoSondage,aParams){const lInstance=this;ObjetMenuContextuel.afficher({pere:aParams.instance,options:{largeurMaxLibelle:450},evenement:function(aLigne){aParams.instance.Fermer();lInstance.evntSurValidationInfoSond(aInfoSondage,EGenreEvntActu.SurDiffusionResultats,{estNominatif:aLigne.GetNumero()===0});},initCommandes:function(aInstance){aInstance.AddCommande(0,GTraductions.getValeur('actualites.Edition.DiffuserResultatsNominatif'));aInstance.AddCommande(1,GTraductions.getValeur('actualites.Edition.DiffuserResultatsAnonyme'));}});}
evntSurAfficherResultats(aInfoSond){new ObjetRequetePageActualitesResultats(this).lancerRequete({actualite:aInfoSond}).then(function(){ObjetFenetre.creerInstance(require('ObjetFenetre_ResultatsActualite.js').ObjetFenetre_ResultatsActualite,{pere:this,evenement:function(aNumeroBouton,aParams){if(!!aParams.bouton&&aParams.bouton.typeBouton===TypeBoutonFenetreResultatActualite.DiffuserResultats){if(!!aInfoSond.reponseAnonyme){aParams.instance.Fermer();this.evntSurValidationInfoSond(aInfoSond,EGenreEvntActu.SurDiffusionResultats,{estNominatif:false});} else{this.evenementOuvrirMenuContextuel(aInfoSond,aParams);}}},initialiser:function(aInstance){const lListeBoutons=[];const lEstSurEspaceProfOuPersonnel=MethodesTableau.existe(GEtatUtilisateur.GenreEspace,[
EGenreEspace.Professeur,EGenreEspace.Mobile_Professeur,EGenreEspace.PrimProfesseur,EGenreEspace.Mobile_PrimProfesseur,EGenreEspace.Etablissement,EGenreEspace.Mobile_Etablissement,EGenreEspace.Administrateur,EGenreEspace.Mobile_Administrateur
]);if(lEstSurEspaceProfOuPersonnel&&aInfoSond.estSondage){lListeBoutons.push({libelle:GTraductions.getValeur('actualites.Edition.DiffuserResultats'),theme:TypeThemeBouton.secondaire,typeBouton:TypeBoutonFenetreResultatActualite.DiffuserResultats,sansFermeture:true});}
lListeBoutons.push({libelle:GTraductions.getValeur('Fermer'),theme:TypeThemeBouton.secondaire,typeBouton:TypeBoutonFenetreResultatActualite.Fermer});aInstance.setOptionsFenetre({titre:GTraductions.getValeur('actualites.Edition.OngletResultats'),modale:true,largeur:900,hauteur:700,listeBoutons:lListeBoutons});aInstance.setUtilitaires(this.utilitaires);}.bind(this)}).SetDonnees({actualite:aInfoSond});}.bind(this));}
formatterDataSurBasculeModeAff(aModeAff,aFiltre){this.listeActualites=_getListeActualitesDeModeAff.call(this,aModeAff,aFiltre);this.initListeInfosSond(this.GetInstance(this.identListeInfosSond));this.moteurCP.formatterDonnees({listeInfoSond:this.listeActualites,forcerAR:this.forcerAR});this.moteurCP.formatterListeActusPourBlocs({listeActualites:this.listeActualites});}
declencherActionsAutoSurNavigation(){if(this.page&&this.page.avecActionSaisie){_creerInfoSondDepuisNavigation.call(this);}}}
function _initFicheEditionInfoSond(aInstance){aInstance.setUtilitaires(this.utilitaires);aInstance.setOptions({avecCBElevesRattaches:GParametres.avecElevesRattaches,avecGestionEleves:GApplication.droits.get(TypeDroits.fonctionnalites.gestionEleves),avecGestionPersonnels:GApplication.droits.get(TypeDroits.fonctionnalites.gestionPersonnels),avecGestionStages:GApplication.droits.get(TypeDroits.fonctionnalites.gestionStages),avecGestionIPR:GApplication.droits.get(TypeDroits.fonctionnalites.gestionIPR),avecPublicationPageEtablissement:GApplication.droits.get(TypeDroits.communication.avecPublicationPageEtablissement)});aInstance.instancierCalendrier=function(aEvnt,aPere){const lInstance=Identite.creerInstance(ObjetCelluleDate,{pere:aPere,evenement:aEvnt.bind(aPere)});lInstance.setParametres_Fenetre(window.GParametres.PremierLundi,GDate.GetJourSuivant(window.GParametres.PremiereDate,-100),GDate.GetJourSuivant(window.GParametres.DerniereDate,100));return lInstance;};aInstance.setOptionsFenetre({avecFooterFlottant:false});aInstance.envoyerRequete=function(aParam){this.moteurCP.formatterDonneesAvantSaisie({listeInfoSond:aParam.paramRequete.listeActualite});return new ObjetRequeteSaisieActualites(this,aParam.clbckSurReussite.bind(aInstance,1)).addUpload({listeFichiers:aParam.listePJCree,listeDJCloud:IE.estMobile?null:aParam.listePJ}).lancerRequete(aParam.paramRequete);}.bind(this);aInstance.setOptionsFenetre({modale:true,listeBoutons:[GTraductions.getValeur('Annuler'),GTraductions.getValeur('Valider')]});}
function _initialiserCategories(aParam){this.listeCategories=aParam.listeCategories;if((GEtatUtilisateur.getCategorie()===null)||(GEtatUtilisateur.getCategorie()===undefined)){const lCategorieParDefaut=this.listeCategories.getListeElements(function(aElt){return(aElt.toutesLesCategories===true);}).GetElement(0);this.categorie=lCategorieParDefaut;GEtatUtilisateur.setCategorie(lCategorieParDefaut);}}
function _creerInfoSondDepuisNavigation(){if(this.page.creerInformation){this.evntBtnCreerActuInfo();} else{this.evntBtnCreerActuSondage();}
this.page=null;GEtatUtilisateur.resetPage();GEtatUtilisateur.Navigation.OptionsOnglet=null;}
function _getListeActualitesDeModeAff(aModeAff,aFiltreModeAff){let lModeAffCourant;switch(aModeAff){case this.genresAffichages.reception:lModeAffCourant=TypeModeAff.MA_Reception;break;case this.genresAffichages.saisie:if(aFiltreModeAff===TypeItemEnum.IE_Brouillon){lModeAffCourant=TypeModeAff.MA_Brouillon;} else{lModeAffCourant=TypeModeAff.MA_Diffusion;}
break;case this.genresAffichages.modeles:lModeAffCourant=TypeModeAff.MA_Modele;break;default:;}
return this.tabModeAff[lModeAffCourant].listeActualites;}
function _actionSurRecupererDonnees(aDonnees){this.tabModeAff=aDonnees.tabModeAff;this.formatterDataSurBasculeModeAff(this.modeAff,this.filtreModeItem);_initialiserCategories.call(this,{listeCategories:aDonnees.listeCategories});this.initEcranTypeAccesInfoSond();this.afficherSelonFiltres();}
function _evenementEditionActu(aGenreBouton,aParam){const lEstCtxCreation=(aGenreBouton===1)&&aParam&&(aParam.eltCree!==null)&&(aParam.eltCree!==undefined);if(lEstCtxCreation){const lEstUneCreationDepuisUnModele=(this.filtreModeItem===TypeItemEnum.IE_Modele_Info||this.filtreModeItem===TypeItemEnum.IE_Modele_Sondage)&&(aParam.donnee&&!aParam.donnee.estModele);if(this.filtreModeItem===TypeItemEnum.IE_Reception||lEstUneCreationDepuisUnModele){const lTypeItem=aParam.donnee&&aParam.donnee.publie===false?TypeItemEnum.IE_Brouillon:TypeItemEnum.IE_Diffusion_Tout;let lItemASelectionnerApresSaisie=this.getItemDeType(lTypeItem);this.setCtxSelection({niveauEcran:0,dataEcran:lItemASelectionnerApresSaisie});this.modeAuteur=this.avecAuteur;this.modeAff=this.genresAffichages.saisie;this.filtreModeItem=lTypeItem;}}
if(this.diffusionResultatsSondageEnCours){this.diffusionResultatsSondageEnCours=false;if(aGenreBouton!==1){const lListePiecesJointes=this.moteurCP.getListePiecesJointesDActualite(aParam.donnee);if(!!lListePiecesJointes){lListePiecesJointes.parcourir(function(D){D.SetEtat(EGenreEtat.Suppression);});}
new ObjetRequeteSaisieFichierResultatsSondage(this).lancerRequete({listePJASupprimer:lListePiecesJointes});} else{_reponseSaisie.call(this);}} else{if(aGenreBouton===1){if(aParam&&(aParam.eltCree!==null)&&(aParam.eltCree!==undefined)){this.contexte.selectionCouranteModeDiffusion=aParam.eltCree;}
_reponseSaisie.call(this);}}}
function declencherSaisie(){const lObjetSaisie={listeActualite:this.listeActualites,validationDirecte:false,saisieActualite:this.modeAuteur};new ObjetRequeteSaisieActualites(this,_reponseSaisie.bind(this)).lancerRequete(lObjetSaisie);}
function _reponseSaisie(aXml,aJSONReponse,aJSONRapportSaisie){if(this.modeAuteur){if(aJSONRapportSaisie!==null&&aJSONRapportSaisie!==undefined&&aJSONRapportSaisie.infoSondCree!==null&&aJSONRapportSaisie.infoSondCree!==undefined){this.contexte.selectionCouranteModeDiffusion=aJSONRapportSaisie.infoSondCree;}
this.RecupererDonnees();}}
function _donneesFenetreEditionDiscussion(aInfoSond){const lDonnees={};const lAuteur=aInfoSond.elmauteur;if(_estSurEspaceProfesseurOuPersonnel()){const lListeEns=new ObjetListeElements();const lListePers=new ObjetListeElements();switch(lAuteur.GetGenre()){case EGenreRessource.Enseignant:lListeEns.AddElement(lAuteur);break;case EGenreRessource.Personnel:lListePers.AddElement(lAuteur);break;default:break;}
const lGenresRessources=[{genre:EGenreRessource.Enseignant,listeDestinataires:lListeEns},{genre:EGenreRessource.Personnel,listeDestinataires:lListePers}];lDonnees.genresRessources=lGenresRessources;} else{lDonnees.genreRessource=lAuteur.GetGenre();const lListe=new ObjetListeElements();lListe.AddElement(lAuteur);lDonnees.ListeRessources=lListe;lDonnees.listeSelectionnee=lListe;}
let lStrTraduc,lParamsTraduc;const lEstInfo=aInfoSond.estInformation;if(aInfoSond.GetLibelle()){lStrTraduc=lEstInfo?'actualites.discussion.enReponseAInformation':'actualites.discussion.enReponseAuSondage';lParamsTraduc=[aInfoSond.GetLibelle(),GDate.FormatDate(aInfoSond.dateDebut,'%J/%MM/%AAAA')];} else{lStrTraduc=lEstInfo?'actualites.discussion.enReponseAInformationDu':'actualites.discussion.enReponseAuSondageDu';lParamsTraduc=[GDate.FormatDate(aInfoSond.dateDebut,'%J/%MM/%AAAA')];}
lDonnees.message={objet:GTraductions.getValeur('actualites.discussion.reponse',[aInfoSond.GetLibelle()]),contenu:GTraductions.getValeur(lStrTraduc,lParamsTraduc)};return lDonnees;}
function _estSurEspaceProfesseurOuPersonnel(){return MethodesTableau.existe(GEtatUtilisateur.GenreEspace,[
EGenreEspace.Professeur,EGenreEspace.Mobile_Professeur,EGenreEspace.PrimProfesseur,EGenreEspace.Mobile_PrimProfesseur,EGenreEspace.Etablissement,EGenreEspace.Mobile_Etablissement,EGenreEspace.Administrateur,EGenreEspace.Mobile_Administrateur,EGenreEspace.Accompagnant,EGenreEspace.Mobile_Accompagnant,EGenreEspace.PrimAccompagnant,EGenreEspace.Mobile_PrimAccompagnant,EGenreEspace.Tuteur,EGenreEspace.Mobile_Tuteur
]);}
module.exports=InterfacePageInfoSondagePN;},fn:"produit/script/interfacepageinfosondagepn.js"});;
IE.fModule({f:function(exports,require,module,global){const{TypeDroits}=require('ObjetDroitsPN.js');const GChaine=require('GChaine.js');const EGenreEtat=require('Enumere_Etat.js');const ObjetDonneesListeFlatDesign=require('ObjetDonneesListeFlatDesign.js');const GTraductions=require('ObjetTraduction.js');const TUtilitaireMessagerie=require('UtilitaireMessagerie.js');const tag=require('tag.js');const TypeOrigineCreationEtiquetteMessage=require('TypeOrigineCreationEtiquetteMessage.js').TypeOrigineCreationEtiquetteMessage;require('Espace/css/DonneesListe_Messagerie.css');class DonneesListe_Messagerie extends ObjetDonneesListeFlatDesign{constructor(aDonnees){super(aDonnees);this.setOptions({avecEdition:false,avecSuppression:false,avecSelection:true,avecEvnt_Selection:true,avecEvnt_ModificationSelection:true,avecEventDeploiementSurCellule:false,indentationCelluleEnfant:25,tailleEtiquettes:60,tailleTrombone:10,tailleDateMessage:130,avecCategories:GApplication.droits.get(TypeDroits.communication.avecDiscussionAvancee),avecImagePurge:false,getEtiquette:null,avecToutesIconesGauche:false,addCommandeMenuContextuel:null});}
getControleur(aInstance,aInstanceListe){return $.extend(true,super.getControleur(this),{hintPublic:function(aNumeroMessage,aPourParticipants){return TUtilitaireMessagerie.getStrHintPublicMessage_promise(aInstanceListe,aNumeroMessage,aPourParticipants,false,this.node);}});}
getIconeGaucheContenuFormate(aParams){if(this.options.avecToutesIconesGauche&&aParams.article.profondeur===0&&_estEtiquetteToutes.call(this)){return TUtilitaireMessagerie.getIconeMessage(aParams.article);}
return aParams.article.profondeur>0?'icon_sous_discussion':'';}
getHintIconeGaucheContenuFormate(aParams){return aParams.article.profondeur>0?GTraductions.getValeur('Messagerie.HintSousDiscussion'):'';}
getTitreZonePrincipale(aParams){return _getLibelleDiscussion.call(this,aParams);}
getInfosSuppZonePrincipale(aParams){let lLibelle=aParams.article.initiateur||GTraductions.getValeur('Messagerie.Moi');if(!(aParams.article.nbPublic>1)){const lDest=aParams.article.public||GTraductions.getValeur('Messagerie.Moi');if(lDest!==lLibelle){lLibelle=GChaine.Format('%s %s %s',[lLibelle,GTraductions.getValeur('A'),lDest]);}}
return lLibelle;}
getZoneComplementaire(aParams){const H=[tag('time',aParams.article.libelleDate)];const lHIcones=[];if(aParams.article.nbPublic>1){let lValIEHint=false;if(aParams.article.messagePourParticipants){lValIEHint=tag.funcAttr('hintPublic',[aParams.article.messagePourParticipants.GetNumero(),true]);}
lHIcones.push(tag('i',{class:'icon icon_intervenants','ie-hint':lValIEHint}));}
if(aParams.article.documentsJoints){lHIcones.push(tag('i',{class:'icon icon_piece_jointe'}));}
if(aParams.article.avecReponse){lHIcones.push(tag('i',{class:'icon icon_discussion_repondu',title:GTraductions.getValeur('Messagerie.HintRepondu')}));}
if(lHIcones.length>0){H.push(tag('div',{class:'icones-conteneur tiny'},lHIcones.join('')));}
return H.join('');}
getZoneMessage(aParams){const H=[];if(aParams.article.ferme){H.push(tag('p',GTraductions.getValeur('Messagerie.HintDiscussionTerminee')));}
if(aParams.article.estSorti){H.push(tag('p',GTraductions.getValeur('Messagerie.HintDiscussionSorti')));}
if(this.options.avecImagePurge&&aParams.article.messagePurge){H.push(tag('p',GTraductions.getValeur('Messagerie.HintPeutEtreRaccourcie')));}
if(aParams.article.estSignalantContenu){H.push(tag('p',GTraductions.getValeur('Messagerie.HintSignalementContenu')));}
if(aParams.article.estSignalantPourSuppr){H.push(tag('p',GTraductions.getValeur('Messagerie.HintSignalementPourSuppr')));}
if(aParams.article.archive&&this.options.getEtiquette&&this.options.getEtiquette()&&this.options.getEtiquette().GetGenre()!==TypeOrigineCreationEtiquetteMessage.OCEM_Pre_Archive){H.push(tag('p',GTraductions.getValeur('Messagerie.HintDiscussionArchive')));}
if(this.options.avecCategories&&aParams.article.listeEtiquettes&&aParams.article.listeEtiquettes.GetNbrElements()>0){H.push(tag('div',TUtilitaireMessagerie.dessinListeEtiquettes(aParams.article.listeEtiquettes)));}
return H.join('');}
estUnDeploiement(aParams){return this.options.avecDeploiement&&aParams&&aParams.article&&aParams.article.estUneDiscussion&&aParams.article.estUnDeploiement;}
getClass(aParams){const lClasses=[];if(aParams.article.profondeur>0||aParams.article.estNonPossede){lClasses.push('dl_m_sous_discussion');}
return lClasses.join(' ');}
estLigneOff(aParams){return aParams.article.lu;}
GetVisible(D){if(!D||D.visible===false||!D.estUneDiscussion){return false;}
if(D.estUneDiscussion&&D.profondeur===0&&this.options.getEtiquette&&!TUtilitaireMessagerie.estDiscussionVisibleSelonEtiquette(D,this.options.getEtiquette())){return false;}
return true;}
SurSuppression(D){for(let I=0;I<this.Donnees.GetNbrElements();I++){const lMessage=this.Donnees.GetElement(I);if(TUtilitaireMessagerie.getIndicePere(this.Donnees,lMessage)===D.indice){lMessage.SetEtat(EGenreEtat.Suppression);}}
D.SetEtat(EGenreEtat.Suppression);}
GetMessage_Suppression_Confirmation(){return GTraductions.getValeur('Messagerie.ConfirmationSuppression');}
initialisationObjetContextuel(aParametres){if(!aParametres.menuContextuel){return;}
if(GApplication.droits.get(TypeDroits.communication.discussionInterdit)){return;}
this.options.addCommandesMenuContextuel(aParametres);aParametres.menuContextuel.SetDonnees(aParametres.id);}
avecBoutonActionLigne(aParams){return!this.options.nonEditable&&!GApplication.droits.get(TypeDroits.communication.discussionInterdit)&&!this.estInterTitre(aParams.article)&&aParams.article&&!aParams.article.estNonPossede;}}
module.exports=DonneesListe_Messagerie;function _getLibelleDiscussion(aParams){if(!aParams.article.estUneDiscussion){return'';}
const H=[];if(aParams.article){H.push('<div class="dl_m_titre">');if(aParams.article.nbBrouillons>0){H.push('<div class="dl_m_brouillon">','[',aParams.article.nbBrouillons===1?GTraductions.getValeur('Messagerie.UnBrouillon'):GChaine.Format(GTraductions.getValeur('Messagerie.NBrouillons'),[aParams.article.nbBrouillons]),']','</div>');}
H.push('<div ie-ellipsis>',aParams.article.objet||GTraductions.getValeur('Messagerie.ObjetVideDiscussion'),'</div>');H.push(tag('div',{class:'ie-sous-titre'},aParams.article.nombreMessages));H.push('</div>');}
return H.join('');}
function _estEtiquetteToutes(){return this.options.getEtiquette&&this.options.getEtiquette()&&this.options.getEtiquette().toutes;}
module.exports=DonneesListe_Messagerie;},fn:"donneesliste_messagerie.js"});;
IE.fModule({f:function(exports,require,module,global){const{Invocateur}=require('Invocateur.js');const MethodesObjet=require('MethodesObjet.js');const MethodesTableau=require('MethodesTableau.js');const ObjetIdentite_Mobile=require('ObjetIdentite_Mobile.js');const Support=require('ObjetSupport.js');const GTraductions=require('ObjetTraduction.js');const EGenreEspace=require('Enumere_Espace.js');const TUtilitaireMessagerie=require('UtilitaireMessagerie.js');const ObjetDiscussion_Mobile=require('ObjetDiscussion_Mobile.js');const Identite=require('ObjetIdentite.js');const ObjetListeElements=require('ObjetListeElements.js');const{TypeDroits}=require('ObjetDroitsPN.js');const TypeOrigineCreationEtiquetteMessage=require('TypeOrigineCreationEtiquetteMessage.js').TypeOrigineCreationEtiquetteMessage;const ObjetListe=require('ObjetListe.js');const tag=require('tag.js');const DonneesListe_Messagerie=require('DonneesListe_Messagerie.js');const EGenreEvenementListe=require('Enumere_EvenementListe.js');const MoteurMessagerie=require('MoteurMessagerie.js');class ObjetMessagerie extends ObjetIdentite_Mobile{constructor(...aParams){super(...aParams);this.donneesRecues=false;this.listeMessagerie=null;this.nbNonLues=this.Nom+'_NonLues';this.idDiscussions=this.Nom+'_Convers';this.idListeDiscussions=this.Nom+'_ConversList';this.idFenetreConversation=this.Nom+'_FenetreConvers';this.idFenetreCreation=this.Nom+'_Creation';this.idBoutonPlus=this.Nom+'_boutonPlus';this.listesDiffusion=null;this.avecPJ=Support.avecSupportFileUpload&&MethodesTableau.existe(GEtatUtilisateur.GenreEspace,[EGenreEspace.Mobile_Professeur,EGenreEspace.Mobile_Etablissement,EGenreEspace.Mobile_Administrateur,EGenreEspace.Mobile_PrimProfesseur]);this.message=null;this.indiceMessage=null;this.avecHtml=MethodesTableau.existe(GEtatUtilisateur.GenreEspace,[EGenreEspace.Mobile_Professeur,EGenreEspace.Mobile_Etablissement,EGenreEspace.Mobile_Administrateur,EGenreEspace.Mobile_PrimProfesseur]);this.setOptions({surChangementMessage:null});this.moteurMessagerie=new MoteurMessagerie().setOptions({instance:this,avecFiltreNonLues:true});this.pageDiscussion=Identite.creerInstance(ObjetDiscussion_Mobile,{pere:this,moteurMessagerie:this.moteurMessagerie});this.pageDiscussion.setOptions({estChat:false,estDiscussionResponsables:GEtatUtilisateur.GenreEspace===EGenreEspace.Mobile_Parent,activerBoutonsBrouillon:true,callbackFermeture:function(){this.retourListe();}.bind(this),callbackEnvoyer:function(aParams){if(aParams&&aParams.creationDiscussion){if(aParams.message){this.message=MethodesObjet.dupliquer(aParams.message);}
this.pageDiscussion.masquer();} else{this._evenementSurSaisieMessage();}}.bind(this)});Invocateur.abonner('actualiserListeDiscussion_mobile',this.retourListe,this);Invocateur.abonner('notification_actualisationMessage',_notification_actualisationMessage,this);}
getControleur(aInstance){return $.extend(true,super.getControleur(this),{getIdentiteListe:function(){return{class:ObjetListe,pere:aInstance,evenement:function(aParametres){switch(aParametres.genreEvenement){case EGenreEvenementListe.Creation:_ouvrirFenetreCreation(aInstance);return;case EGenreEvenementListe.Selection:_surClicConversation(aInstance,TUtilitaireMessagerie.getIndiceDiscussion(aInstance.listeMessagerie,aParametres.article));return;}},start:function(aListe){aInstance.instanceListeMessagerie=aListe;var lListeBoutons=[];lListeBoutons.push({html:tag('ie-checkbox',{'ie-model':'cbNonLu','ie-textleft':true},GTraductions.getValeur('Messagerie.NonLues')),controleur:{cbNonLu:{getValue:function(){return GApplication.parametresUtilisateur.get('Communication.DiscussionNonLues');},setValue:function(aValue){GApplication.parametresUtilisateur.set('Communication.DiscussionNonLues',!!aValue);aInstance.moteurMessagerie.modifierVisibiliteListeMessagerie(null);aListe.Actualiser();}}}});if(aInstance.moteurMessagerie.avecIconeAvertissementListeMessagerie()){lListeBoutons.push({class:'icon_warning_sign',title:GTraductions.getValeur('Messagerie.TitreFenetreAvertissement'),event:function(){aInstance.moteurMessagerie.ouvrirFenetreAvertissement(false);}});}
if(aInstance.etiquetteSelectionnee&&aInstance.etiquetteSelectionnee.GetGenre()===TypeOrigineCreationEtiquetteMessage.OCEM_Pre_Poubelle&&GApplication.droits.get(TypeDroits.communication.avecDiscussionAvancee)){lListeBoutons.push({class:'icon_trash',title:GTraductions.getValeur('Messagerie.Menu_ViderCorbeille'),event:function(){var lNb=aInstance.moteurMessagerie.getNbMessagesSupprimablesPoubelle();aInstance.moteurMessagerie.saisieViderCorbeille(lNb);},getDisabled:function(){return aInstance.moteurMessagerie.getNbMessagesSupprimablesPoubelle()===0;}});}
aInstance.moteurMessagerie.ouvrirFenetreAvertissement(true);aListe.setOptionsListe({colonnes:[{taille:'100%'}],skin:ObjetListe.skin.flatDesign,avecLigneCreation:!GApplication.droits.get(TypeDroits.communication.discussionInterdit),messageContenuVide:GTraductions.getValeur('Messagerie.AucuneDiscussion'),boutons:lListeBoutons,nonEditableSurModeExclusif:true});aInstance.moteurMessagerie.modifierVisibiliteListeMessagerie(null);aListe.SetDonnees(new DonneesListe_Messagerie(aInstance.listeMessagerie).setOptions({avecDeploiement:true,avecImagePurge:true,getEtiquette:function(){return aInstance.etiquetteSelectionnee;}.bind(aInstance),avecToutesIconesGauche:true,addCommandesMenuContextuel:function _addCommandeMenuContextuel(aParametres){return this.moteurMessagerie.addCommandesMenuContextuelDiscussion({message:aParametres.article,menuContextuel:aParametres.menuContextuel,callback:function(aParams,aCommande){aInstance.pageDiscussion.execCommandesMenuContextuel(aParams,aCommande);}.bind(this)});}.bind(aInstance)}));}};}});}
ConstruireAffichage(){if(!this.donneesRecues){return'';}
return this.composeListeDiscussions()+this.composeConversation();}
SetDonnees(aEtiquetteSelectionnee){this.etiquetteSelectionnee=aEtiquetteSelectionnee;_setListeMessagerie.call(this,this.listeMessagerie_TOUTES);this.donneesRecues=true;this.Afficher();}
getNbMsgNonLus(){var lNb=0;for(var i=0;i<this.listeMessagerie.GetNbrElements();i++){if(this.listeMessagerie.GetElement(i).lu===false){lNb++;}}
return lNb;}
retourListe(){$("#"+this.idFenetreConversation.escapeJQ()).hide();$("#"+this.idDiscussions.escapeJQ()).show();$(".ui-content").css('height','auto');this.options.surChangementMessage(true);_requeteListe_promise.call(this).then(function(){}.bind(this));}
recupererDonnees(){_requeteListe_promise.call(this).then(function(){if(GEtatUtilisateur.message){this.message=null;this.indiceMessage=null;this.listeMessagerie_TOUTES.parcourir(function(aMessage,aIndex){if(TUtilitaireMessagerie.avecPossessionPartageeEntreMessages(aMessage,GEtatUtilisateur.message)){this.message=aMessage;this.indiceMessage=aIndex;return false;}}.bind(this))
;delete GEtatUtilisateur.message;if(this.message){_requeteListeMessages.call(this,this.message);}}}.bind(this));}
_evenementSurSaisieMessage(){_requeteListe_promise.call(this,true).then(function(){this.rechargerListeDiscussions();var lIndice=TUtilitaireMessagerie.getIndiceDiscussion(this.listeMessagerie_TOUTES,this.message);var lMessage=this.listeMessagerie_TOUTES.GetElement(lIndice);if(lMessage&&(lMessage.nbPublic||lMessage.public)){this.message=lMessage;_requeteListeMessages.call(this,lMessage);}}.bind(this));}
traiterContenu(aTabNodes){return $(aTabNodes).map(function(aIndex){return this.nodeName.toLowerCase()==='br'?'\n':aIndex<aTabNodes.length-1?$(this).text()+'\n':$(this).text();}).get().join('');}
composeConversation(){var lHtml=[];lHtml.push('<div id="'+this.pageDiscussion.Nom+'" style="display:none; height:100%;"></div>');lHtml.push('<div id="'+this.idFenetreConversation+'" style="display:none;">');return lHtml.join('');}
rechargerListeDiscussions(){this.instanceListeMessagerie.Actualiser(true);}
composeListeDiscussions(){var lHtml=[];lHtml.push(tag('div',{id:this.idDiscussions,style:'height:100%'},tag('div',{'ie-identite':'getIdentiteListe',style:'height:100%'})));return lHtml.join('');}}
function _setListeMessagerie(aListeMessagerie){this.listeMessagerie=new ObjetListeElements();if(aListeMessagerie){aListeMessagerie.parcourir(function(aMessage){if(TUtilitaireMessagerie.estDiscussionVisibleSelonEtiquette(aMessage,this.etiquetteSelectionnee)){this.listeMessagerie.AddElement(aMessage);}}.bind(this));}}
function _surClicConversation(aInstance,aNb){aInstance.indiceMessage=aNb;aInstance.message=aInstance.listeMessagerie.GetElement(aNb);_requeteListeMessages.call(aInstance,aInstance.message);$("body").scrollTop(0);}
function _requeteListeMessages(aMessage){this.moteurMessagerie.requeteMessagesVisu({message:aMessage,marquerCommeLu:true,nbMessagesVus:TUtilitaireMessagerie.palierNbMessages}).then((aParamRequete) =>{$("#"+this.idDiscussions.escapeJQ()).hide();$("#"+this.idFenetreConversation.escapeJQ()).show();this.options.surChangementMessage(false);this.pageDiscussion.setDonnees({message:this.message,brouillon:aParamRequete.brouillon,messagePourReponse:aParamRequete.messagePourReponse,listeBoutons:aParamRequete.listeBoutons,listeMessages:aParamRequete.listeMessages,destinataires:aParamRequete.destinataires,nbPossessionsMessageListe:aParamRequete.nbPossessionsMessage});});}
function _requeteListe_promise(aIgnorerRecuperationEtiquettes){return this.moteurMessagerie.requeteListeMessagerie({avecMessage:true,avecLu:true}).then(function(aParam){this.listeMessagerie_TOUTES=aParam.listeMessagerie;this.listeEtiquettes=aParam.listeEtiquettes;this.listeDestinatairesCarnetLiaison=aParam.destinatairesCarnetLiaison;this.pageDiscussion.setOptions({listeEtiquettes:this.listeEtiquettes,listeMessagerie:this.listeMessagerie_TOUTES});_setListeMessagerie.call(this,aParam.listeMessagerie);if(!aIgnorerRecuperationEtiquettes&&this.options.surRequeteMessagerie){this.options.surRequeteMessagerie(this.listeMessagerie_TOUTES,aParam.listeEtiquettes);}
return aParam;}.bind(this));}
function _ouvrirFenetreCreation(aInstance){$("#"+aInstance.idDiscussions.escapeJQ()).hide();$("#"+aInstance.idFenetreConversation.escapeJQ()).show();aInstance.options.surChangementMessage(false);var lEstPrimParentSurEtiquetteCL=GEtatUtilisateur.GenreEspace===EGenreEspace.Mobile_PrimParent&&aInstance.etiquetteSelectionnee&&aInstance.etiquetteSelectionnee.GetGenre()===TypeOrigineCreationEtiquetteMessage.OCEM_Pre_CarnetLiaison&&aInstance.etiquetteSelectionnee.contexte&&aInstance.etiquetteSelectionnee.contexte.GetNumero();var lListeDestCarnetLiaison=null;var lEleveCarnetLiaison=null;if(lEstPrimParentSurEtiquetteCL){lEleveCarnetLiaison=aInstance.etiquetteSelectionnee.contexte;lListeDestCarnetLiaison=TUtilitaireMessagerie.getListeDestCarnetLiaisonDEleve_PrimParent(lEleveCarnetLiaison.GetNumero());}
aInstance.pageDiscussion.setDonnees({message:aInstance.message,creationDiscussion:true,estPrimParentSurEtiquetteCL:lEstPrimParentSurEtiquetteCL,listeDestinatairesCarnetLiaison:lListeDestCarnetLiaison,eleveCarnetLiaison:lEleveCarnetLiaison,titre:lEstPrimParentSurEtiquetteCL?GTraductions.getValeur('MessagerieCarnetLiaison.TitreFenetreNouveauPourVotreEnfant'):''});aInstance.$refreshSelf();}
function _notification_actualisationMessage(){if(!this.pageDiscussion.estAffiche()){_requeteListe_promise.call(this);}}
module.exports=ObjetMessagerie;},fn:"mobile/script/pagemessagerie.js"});;
IE.fModule({f:function(exports,require,module,global){const ObjetMessagerie=require('mobile/script/PageMessagerie.js');const InterfacePage_Mobile=require('InterfacePage_Mobile.js');const ObjetSelection=require('ObjetSelection.js').ObjetSelection;const TUtilitaireMessagerie=require('UtilitaireMessagerie.js');const EStructureAffichage=require('Enumere_StructureAffichage.js');const tag=require('tag.js');class ObjetAffichagePageMessagerie_Mobile extends InterfacePage_Mobile{constructor(...aParams){super(...aParams);this.modeAuteur=false;this._etiquetteSelectionne=null;this.GenreStructure=EStructureAffichage.Autre;this.avecPageFondBlanc=true;}
ConstruireInstances(){this.identSelection=this.Add(ObjetSelection,_evenementSelection,function(aInstance){aInstance.SetParametres({avecBoutonsPrecedentSuivant:false,icone:null,getTitre:function(aElement){return aElement.libelleHtml;}});});this.AddSurZone=[this.identSelection];this.identPage=this.Add(ObjetMessagerie,null,function(aInstance){aInstance.setOptions({surChangementMessage:function(aEstListeVisible){this.GetInstance(this.identSelection).SetVisible(aEstListeVisible);}.bind(this),surRequeteMessagerie:_surRequeteMessagerie.bind(this)});});}
RecupererDonnees(){this.GetInstance(this.identPage).recupererDonnees();}
ConstruireStructureAffichageAutre(){return tag('div',{id:this.GetInstance(this.identPage).Nom,style:'height:100%;'});}}
function _surRequeteMessagerie(aListeMessageries,aListeEtiquettes){aListeEtiquettes.parcourir(function(aEtiquette){var lResultImageEtiquette=TUtilitaireMessagerie.contruireImageEtiquette(aEtiquette);var lCompteurMessagesNonLues=TUtilitaireMessagerie.getNbNonlusDEtiquette(aEtiquette,aListeMessageries);var lLibelleCompteur='';if(lCompteurMessagesNonLues>0){lLibelleCompteur='<div class="PetitEspaceGauche'+(lResultImageEtiquette.avecCompteurNonLu?' Gras':'')+'">('+lCompteurMessagesNonLues+')</div>';}
aEtiquette.libelleHtml=['<div class="messagerie-selec-etiquette">','<div>',lResultImageEtiquette.icone,'</div>',aEtiquette.GetLibelle(),lLibelleCompteur,'</div>'
].join('');}.bind(this));var lIndice=0;var lMessage=null;if(GEtatUtilisateur.message){lMessage=aListeMessageries.GetElement(TUtilitaireMessagerie.getIndiceDiscussion(aListeMessageries,GEtatUtilisateur.message));}
this._etiquetteSelectionne=TUtilitaireMessagerie.getEtiquetteInitSelonMessage(aListeEtiquettes,this._etiquetteSelectionne,true,lMessage);if(this._etiquetteSelectionne){lIndice=aListeEtiquettes.GetIndiceParElement(this._etiquetteSelectionne);}
this.GetInstance(this.identSelection).SetDonnees(aListeEtiquettes,lIndice,'','');}
function _evenementSelection(aParam){this._etiquetteSelectionne=aParam.element;this.GetInstance(this.identPage).SetDonnees(this._etiquetteSelectionne);}
module.exports=ObjetAffichagePageMessagerie_Mobile;},fn:"mobile/script/interfacepagemessagerie.js"});;
IE.fModule({f:function(exports,require,module,global){require('Produit/Css/ObjetPreferenceMessagerie.css');const GTraductions=require('ObjetTraduction.js');const Identite=require('ObjetIdentite.js');const tag=require('tag.js');const Requetes=require('CollectionRequetes.js');const{ObjetRequeteConsultation,ObjetRequeteSaisie}=require('ObjetRequeteJSON.js');const{TypeDroits}=require('ObjetDroitsPN.js');const ObjetListeElements=require('ObjetListeElements.js');const ObjetElement=require('ObjetElement.js');const{GDate}=require('ObjetDate.js');const EGenreEvenementObjetSaisie=require('Enumere_EvenementObjetSaisie.js');Requetes.inscrire('PreferenceMessagerie',ObjetRequeteConsultation);Requetes.inscrire('SaisiePreferenceMessagerie',ObjetRequeteSaisie);class ObjetPreferenceMessagerie extends Identite{constructor(...aParams){super(...aParams);this.listeHeures=new ObjetListeElements();for(let i=1;i<=23;i++){this.listeHeures.add(new ObjetElement(GDate.FormatDureeEnMillisecondes(i*60*60*1000,'%hh%sh%mm'),i));}}
getControleur(aInstance){return $.extend(true,super.getControleur(this),{rbUniquementParentEleve:{getValue:function(aUniquementParentEleve){return aInstance.donnees.uniquementParentEleve===aUniquementParentEleve;},setValue:function(aUniquementParentEleve){aInstance.donnees.uniquementParentEleve=aUniquementParentEleve;_saisie(aInstance,'uniquementParentEleve',aUniquementParentEleve);},getDisabled:_estConsult},cbJoursNonOuvres:{getValue:function(){return aInstance.donnees.nonOuvres;},setValue:function(aValue){aInstance.donnees.nonOuvres=aValue;_saisie(aInstance,'nonOuvres',aValue);},getDisabled:_estConsult},cbJoursOuvres:{getValue:function(){return aInstance.donnees.ouvres;},setValue:function(aValue){aInstance.donnees.ouvres=aValue;_saisie(aInstance,'ouvres',aValue);},getDisabled:_estConsult},cbJoursOuvresAvantApres:{getValue:function(aCle){return aInstance.donnees[aCle];},setValue:function(aCle,aValue){aInstance.donnees[aCle]=aValue;_saisie(aInstance,aCle,aValue);},getDisabled:function(){return!aInstance.donnees.ouvres||_estConsult();}},comboOuvres:{init:function(aHeureAvant,aInstanceCombo){aInstanceCombo.setOptions_ObjetSaisie({longueur:40,avecOuvertureDeroulantModale:(IE.estMobile?true:false),iconeGauche:'icon_time',avecBouton:IE.estMobile?false:true,avecDesignMobile:true});},getDonnees:function(aHeureAvant,aDonnees){if(!aDonnees){return aInstance.listeHeures;}},getIndiceSelection:function(aHeureAvant){const lHeure=aHeureAvant?aInstance.donnees.heureAvant:aInstance.donnees.heureApres;return aInstance.listeHeures.GetIndiceParNumeroEtGenre(lHeure)||0;},event:function(aHeureAvant,aParametres,aCombo){if(aParametres.genreEvenement===EGenreEvenementObjetSaisie.selection&&aParametres.element&&aCombo.EstUneInteractionUtilisateur()){const lHeure=aParametres.element.GetNumero();const lAccesseur=aHeureAvant?'heureAvant':'heureApres';if(aInstance.donnees[lAccesseur]!==lHeure){aInstance.donnees[lAccesseur]=lHeure;_saisie(aInstance,lAccesseur,lHeure);}}},getDisabled:function(){return!aInstance.donnees.ouvres||_estConsult();}},cbJours:{getValue:function(aIndexJour){const lJour=aInstance.donnees.listeJours[aIndexJour];return lJour.actif;},setValue:function(aIndexJour,aValue){const lJour=aInstance.donnees.listeJours[aIndexJour];lJour.actif=aValue;_saisie(aInstance,'jour',{jour:lJour.jour,actif:aValue});},getDisabled:function(){return!aInstance.donnees.ouvres||_estConsult();}},cbActiverRetour:{getValue:function(){return aInstance.donnees.activerMessageAuto;},setValue:function(aValue){aInstance.donnees.activerMessageAuto=aValue;_saisie(aInstance,'messageAuto',aValue?aInstance.donnees.messageAuto:'');},getDisabled:_estConsult},textarea:{getValue:function(){return aInstance.donnees.messageAuto;},setValue:function(aValue){aInstance.donnees.messageAuto=aValue;},exitChange:function(){if(aInstance.donnees.activerMessageAuto){_saisie(aInstance,'messageAuto',aInstance.donnees.messageAuto);}},getDisabled:function(){return!aInstance.donnees.activerMessageAuto||_estConsult();}}});}
RecupererDonnees(){_requeteDonnees(this);}
ConstruireAffichage(){if(!this.donnees){return'';}
const H=[];$('#'+this.Nom.escapeJQ()).addClass('ObjetPreferenceMessagerie droit-deconnexion-contain');H.push(`<p>${GTraductions.getValeur('PrefMess.DesactivationReception')}</p>`);H.push(tag('div',{class:'droit-deconnexion-bloc'},tag('div',{class:'choice-contain'},tag('ie-radio',{'ie-model':tag.funcAttr('rbUniquementParentEleve',false)},GTraductions.getValeur('PrefMess.TousLesMessages'))),tag('div',{class:'choice-contain'},tag('ie-radio',{'ie-model':tag.funcAttr('rbUniquementParentEleve',true)},GTraductions.getValeur('PrefMess.UniquementLesMessagesDesParentsEtEleves')))));H.push(tag('div',{class:'droit-deconnexion-bloc mobile-line'},tag('div',{class:'choice-contain'},tag('ie-checkbox',{'ie-model':'cbJoursNonOuvres'},GTraductions.getValeur('PrefMess.PendantNonOuvres'))),tag('div',{class:'choice-contain'},tag('ie-checkbox',{'ie-model':'cbJoursOuvres'},GTraductions.getValeur('PrefMess.PendantOuvres'))),tag('div',{class:'liste-choice'},function(aTabJours){this.donnees.listeJours.forEach(function(aJour,aIndex){aTabJours.push(tag('ie-checkbox',{class:'as-chips','ie-model':tag.funcAttr('cbJours',aIndex)},!IE.estMobile?GTraductions.getValeur('Jours')[aJour.jour-1]:GTraductions.getValeur('JoursCourt')[aJour.jour-1]));}.bind(this));}.bind(this)),tag('div',{class:'choice-contain duree'},tag('ie-checkbox',{'ie-model':tag.funcAttr('cbJoursOuvresAvantApres','plageAvant')},GTraductions.getValeur('PrefMess.Avant')),tag('ie-combo',{'ie-model':tag.funcAttr('comboOuvres',true)})),tag('div',{class:'choice-contain duree'},tag('ie-checkbox',{'ie-model':tag.funcAttr('cbJoursOuvresAvantApres','plageApres')},GTraductions.getValeur('PrefMess.Apres')),tag('ie-combo',{'ie-model':tag.funcAttr('comboOuvres',false)}))));H.push(tag('div',{class:'droit-deconnexion-bloc'},tag('div',{class:'choice-contain'},tag('ie-switch',{'ie-model':'cbActiverRetour'},GTraductions.getValeur('PrefMess.ActiverMessageAutoCourt'))),tag('ie-textareamax',{'ie-model':'textarea','maxlength':500,class:'round-style'})));return H.join('');}}
function _estConsult(){return GApplication.droits.get(TypeDroits.estEnConsultation);}
function _requeteDonnees(aInstance){return Requetes('PreferenceMessagerie',aInstance).lancerRequete().then(function(aDonnees){aInstance.donnees=aDonnees;aInstance.donnees.activerMessageAuto=!!aInstance.donnees.messageAuto;if(!aInstance.donnees.messageAuto){aInstance.donnees.messageAuto=GTraductions.getValeur('PrefMess.MessageAutoDefaut');}
aInstance.Afficher();});}
function _saisie(aInstance,aGenre,aVal){return Requetes('SaisiePreferenceMessagerie',aInstance).lancerRequete({genre:aGenre,val:aVal});}
module.exports=ObjetPreferenceMessagerie;},fn:"objetpreferencemessagerie.js"});;
IE.fModule({f:function(exports,require,module,global){const GTraductions=require('ObjetTraduction.js');const Identite=require('ObjetIdentite.js');const{Invocateur}=require('Invocateur.js');class ObjetPreferenceAccessibilite extends Identite{constructor(...aParams){super(...aParams);}
getControleur(){return $.extend(true,super.getControleur(this),{cbAccessibilite:{getValue:function(){return GEtatUtilisateur.estModeAccessible();},setValue:function(aValue){GEtatUtilisateur.setModeAccessible(aValue);},getLibelle:function(){return GTraductions.getValeur('ParametresUtilisateur.Accessible_Active');}},cbRemplacerPastillesCompetences:{getValue:function(){return GEtatUtilisateur.estAvecCodeCompetences();},setValue:function(aValue){GEtatUtilisateur.setAvecCodeCompetences(aValue);},getLibelle:function(){return GTraductions.getValeur('infosperso.RemplacerPastillesCompetences');}},cbThemeAccessible:{getValue:function(){return GEtatUtilisateur.estAvecThemeAccessible();},setValue:function(aValue){GEtatUtilisateur.setAvecThemeAccessible(aValue);Invocateur.evenement('modification_modeAccessible');},getLibelle:function(){return GTraductions.getValeur('infosperso.AppliquerThemeAccessible');}}});}
ConstruireAffichage(){const H=[];H.push(`<ie-checkbox ie-model="cbRemplacerPastillesCompetences"></ie-checkbox>\n              <ie-checkbox ie-model="cbThemeAccessible"></ie-checkbox>\n              ${!IE.estMobile?`<ie-checkbox ie-model="cbAccessibilite"></ie-checkbox>`:``}
            `);return H.join('');}}
module.exports=ObjetPreferenceAccessibilite;},fn:"objetpreferenceaccessibilite.js"});;
IE.fModule({f:function(exports,require,module,global){const InterfacePage_Mobile=require('InterfacePage_Mobile.js');const GTraductions=require('ObjetTraduction.js');const UtilitaireChangementLangue=require('UtilitaireChangementLangue.js');const EStructureAffichage=require('Enumere_StructureAffichage.js');const tag=require('tag.js');const ObjetPreferenceMessagerie=require('ObjetPreferenceMessagerie.js');const{TypeDroits}=require('ObjetDroitsPN.js');const ObjetPreferenceAccessibilite=require('ObjetPreferenceAccessibilite.js');class ObjetAffichagePageParametres_Mobile extends InterfacePage_Mobile{constructor(...aParams){super(...aParams);this.GenreStructure=EStructureAffichage.Autre;}
getControleur(aInstance){return $.extend(true,super.getControleur(this),{getIdentiteMessagerie:function(){return{class:ObjetPreferenceMessagerie,pere:aInstance};},getIdentiteAccessibilite:function(){return{class:ObjetPreferenceAccessibilite,pere:aInstance};}});}
ConstruireStructureAffichageAutre(){var lHtml=[];if(UtilitaireChangementLangue.avecChoixLangues()){lHtml.push('<div class="parametres conteneur-langues">','<div class="label">',GTraductions.getValeur('mobile.langue'),' : ','</div>','<div class="flags-conteneur">',UtilitaireChangementLangue.construire(this.controleur),'</div>','</div>');}
lHtml.push('<div class="parametres">',tag('div',{class:'label'},GTraductions.getValeur('ParametresUtilisateur.Accessibilite')),tag('div',{'ie-identite':'getIdentiteAccessibilite'}),'</div>');if(GApplication.droits.get(TypeDroits.avecDroitDeconnexionMessagerie)){lHtml.push('<div class="parametres conteneur-droits">',tag('div',{class:'label'},GTraductions.getValeur('PrefMess.DroitDeconnexion')),tag('div',{'ie-identite':'getIdentiteMessagerie'}),'</div>');}
return lHtml.join('');}}
module.exports=ObjetAffichagePageParametres_Mobile;},fn:"mobile/script/interfacepageparametres.js"});;
IE.fModule({f:function(exports,require,module,global){const GUID=require('GUID.js');const GHtml=require('GHtml.js');const GStyle=require('GStyle.js');const _InterfacePageProduit=require('_InterfacePageProduit.js');class _InterfacePage extends _InterfacePageProduit{constructor(...aParams){super(...aParams);this._idAddZoneBandeau=GUID.getId();}
getPrioriteAffichageBandeauLargeur(){return[];}
ConstruireStructureAffichageBandeau(){const lHTML=[];let lGenre,lGenrePourLargeurComplete;let lAlignementDroite=true;const lExisteGenre=[];let lInfos;const lInfosSurZone=[];for(let I=0;I<this.AddSurZone.length;I++){lInfosSurZone.push(_getInfosSurZone.call(this,I));}
for(let I=0;I<this.AddSurZone.length;I++){lInfos=lInfosSurZone[I];if(lInfos.ident!==undefined&&lInfos.ident!==null){lGenre=this.GenreAffichage[lInfos.ident];lExisteGenre[lGenre]=true;}
lAlignementDroite=lAlignementDroite&&lInfos.alignementDroite;}
const lOrdreGenre=this.getPrioriteAffichageBandeauLargeur();for(let I in lOrdreGenre){lGenre=lOrdreGenre[I];if((lGenrePourLargeurComplete===null||lGenrePourLargeurComplete===undefined)&&lExisteGenre[lGenre]){lGenrePourLargeurComplete=lGenre;}}
if(lAlignementDroite&&this.AddSurZone.length>0){lHTML.push('<div class="objetBandeauEntete_fullsize"></div>');if(lGenrePourLargeurComplete===undefined){lGenrePourLargeurComplete=true;}}
let lCptBloc=0;for(let I=0;I<this.AddSurZone.length;I++){lInfos=lInfosSurZone[I];lGenre=lInfos.ident!==undefined&&lInfos.ident!==null?this.GenreAffichage[lInfos.ident]:null;if(lInfos.blocGauche){lHTML.push('<div class="objetBandeauEntete_AddSurZone_wrapper">');lCptBloc+=1;} else if(lInfos.blocDroit){lHTML.push('</div>');lCptBloc-=1
;} else if(lInfos.separateur){lHTML.push('<div class="objetBandeauEntete_fullsize"></div>');if(lGenrePourLargeurComplete===undefined){lGenrePourLargeurComplete=true;}} else if(this.Instances[lInfos.ident]||lInfos.html){lHTML.push('<div id="',(lInfos.html?this._idAddZoneBandeau+I:this.Instances[lInfos.ident].GetNom()),'"',(lInfos.getDisplay?' ie-display="'+lInfos.getDisplay+'"':''),' class="PetitEspaceDroit AlignementGauche m-right" style="align-self:center;">',lInfos.html&&!lInfos.controleur?lInfos.html:'','</div>');}}
;if(lGenrePourLargeurComplete===undefined){lHTML.push('<div class="objetBandeauEntete_fullsize"></div>');}
GHtml.setDisplay(GApplication.idLigneBandeau,true);GHtml.addHtml(GApplication.idLigneBandeau,lHTML.join(''),{controleur:this.controleur});for(let I=0;I<this.AddSurZone.length;I++){lInfos=lInfosSurZone[I];if(lInfos.controleur){GHtml.setHtml(this._idAddZoneBandeau+I,lInfos.html,{controleur:lInfos.controleur});}}
if(this.Pere&&this.Pere.surResizeInterface){this.Pere.surResizeInterface();}
this.surResizeInterface();return'';}
reset(...aParams){super.reset(...aParams);this.AddSurZone=[];if(this.Pere&&this.Pere.estInterfaceEspaceRacine){$('#'+GApplication.idLigneBandeau.escapeJQ()).children(':not(#'+GApplication.idBreadcrumb.escapeJQ()+')').remove();}}
setBandeau(aHtml){GHtml.setDisplay(GApplication.idLigneBandeau,true);GHtml.addHtml(GApplication.idLigneBandeau,aHtml,{controleur:this.controleur});if(this.Pere&&this.Pere.surResizeInterface){this.Pere.surResizeInterface();}
this.surResizeInterface();}
afficherBandeau(aAfficher){let lIdent,lInfos;for(const I in this.AddSurZone){lInfos=_getInfosSurZone.call(this,I);if(!lInfos.getDisplay){lIdent=lInfos.ident!==undefined&&lInfos.ident!==null?lInfos.ident:null;if(lInfos.html){GStyle.setVisible(this._idAddZoneBandeau+I,aAfficher);} else if(this.conditionSuppAfficherBandeau(lIdent)){GStyle.setVisible(this.Instances[lIdent].GetNom(),aAfficher);}}}}
EvenementAfficherMessage(){}
conditionSuppAfficherBandeau(){return false;}}
function _getInfosSurZone(aIndice){const lElement=this.AddSurZone[aIndice];return $.extend({ident:lElement&&(lElement.html||lElement.separateur)?null:lElement,html:null,controleur:null,getDisplay:null,alignementDroite:false,separateur:false},lElement);}
module.exports=_InterfacePage;},fn:"_interfacepage.js"});;
IE.fModule({f:function(exports,require,module,global){const EGenreEvntMenusDeroulants={surOuvertureCombo:0,ressourceNonTrouve:1};module.exports=EGenreEvntMenusDeroulants;},fn:"enumere_evntmenusderoulants.js"});;
IE.fModule({f:function(exports,require,module,global){const{ObjetRequeteConsultation}=require('ObjetRequeteJSON.js');const Requetes=require('CollectionRequetes.js');const ObjetListeElements=require('ObjetListeElements.js');const ObjetTri=require('ObjetTri.js');class ObjetRequeteFicheEleve extends ObjetRequeteConsultation{constructor(...aParams){super(...aParams);}
lancerRequete(aParam){this.JSON={Eleve:{N:aParam.numeroEleve},AvecEleve:aParam.avecEleve,AvecResponsables:aParam.avecResponsables,AvecAutresContacts:aParam.avecAutresContacts};return this.appelAsynchrone();}
actionApresRequete(){if(this.JSONReponse.Scolarite&&this.JSONReponse.Scolarite.listeAttestations){this.JSONReponse.Scolarite.listeAttestations.setTri([ObjetTri.init('abbreviation')]);this.JSONReponse.Scolarite.listeAttestations.trier();}
this.callbackReussite.appel(this.JSONReponse.Identite,this.JSONReponse.Scolarite,this.JSONReponse.listeTypesProjets,this.JSONReponse.listeMotifsProjets,this.JSONReponse.listeAttestations,this.JSONReponse.Responsables?this.JSONReponse.Responsables:new ObjetListeElements(),this.JSONReponse.listeMemosEleves);}}
Requetes.inscrire('FicheEleve',ObjetRequeteFicheEleve);module.exports=ObjetRequeteFicheEleve;},fn:"objetrequeteficheeleve.js"});;
IE.fModule({f:function(exports,require,module,global){const GChaine=require('GChaine.js');const GTraductions=require('ObjetTraduction.js');class UtilitaireProjetAccompagnement{constructor(){}
composeProjetAccompagnement(aProjetAccompagnement,aParams){const H=[];H.push(`<div class="flex-contain flex-start">\n              <div class="libelle-contain no-wrap">\n              <span class="libelle has-text iconic icon_projet_accompagnement ${aProjetAccompagnement.estPAMedical?`  mix-icon_rond i-green`:``}">${aProjetAccompagnement.GetLibelle()} ${aProjetAccompagnement.motifs&&aProjetAccompagnement.motifs.length>0?`(${aProjetAccompagnement.motifs})`:''}</span>`);if(!!aProjetAccompagnement.dateDebut||!!aProjetAccompagnement.dateFin){let lLibelleDate;if(!!aProjetAccompagnement.dateDebut&&!!aProjetAccompagnement.dateFin){lLibelleDate=GTraductions.getValeur('Du')+' '+aProjetAccompagnement.dateDebut+' '+GTraductions.getValeur('Au')+' '+aProjetAccompagnement.dateFin;} else{lLibelleDate=(!!aProjetAccompagnement.dateDebut)?GTraductions.getValeur('aPartirDu')+' '+aProjetAccompagnement.dateDebut:GTraductions.getValeur('jusquAu')+' '+aProjetAccompagnement.dateFin;}
H.push(`<span class="dates">${lLibelleDate}</span>`);}
if(aProjetAccompagnement.commentaire&&aProjetAccompagnement.commentaire.length>0){H.push(`<span class="commentaires">${aProjetAccompagnement.commentaire}</span>`);}
H.push(`</div>`);if(aParams.avecEdition){H.push(`<ie-btnicon class="icon icon_edit avecFond" role="button" title="${GTraductions.getValeur('Modifier')}" ie-model="btnEditProjetAccompagnement('${aProjetAccompagnement.GetNumero()}')"></ie-btnicon>`);}
H.push(`</div>`);if(aProjetAccompagnement.documents&&aProjetAccompagnement.documents.GetNbrElements()>0){const lListeDocJoints=[];aProjetAccompagnement.documents.parcourir(function(D){const lLienDocJoint=GChaine.composerUrlLienExterne({documentJoint:D});lListeDocJoints.push(lLienDocJoint);});H.push(`<div class="pj-contain">${lListeDocJoints.join('')}</div>`);}
if(aParams.avecLibelleConsultationEquipePeda){H.push('<div class="EspaceBas">',(aProjetAccompagnement.consultableEquipePeda?GTraductions.getValeur('PageCompte.ProjetConsultable'):GTraductions.getValeur('PageCompte.ProjetNonConsultable')),'</div>');}
return H.join('');}
composeListeProjetsAccompagnement(aListeProjets,aParams={}){const lHtml=[];if(!!aListeProjets&&aListeProjets.GetNbrElements()>0){const lThis=this;const lParamsComposeProjAcc={avecEdition:aParams.avecEdition,avecLibelleConsultationEquipePeda:aParams.avecLibelleConsultationEquipePeda};let lAvecControlePublication=true;if(aParams.avecEdition){lAvecControlePublication=false;} else if(aParams.avecControlePublication===false){lAvecControlePublication=false;}
aListeProjets.parcourir((aProjetAcc) =>{if(aProjetAcc.Existe()){if(!lAvecControlePublication||aProjetAcc.consultableEquipePeda){lHtml.push(`<div class="projet-item">${lThis.composeProjetAccompagnement(aProjetAcc,lParamsComposeProjAcc)}</div>`);}}});} else{lHtml.push(GTraductions.getValeur('FicheEleve.aucunProjet'));}
return lHtml.join('');}}
module.exports=new UtilitaireProjetAccompagnement();},fn:"utilitaireprojetaccompagnement.js"});;
IE.fModule({f:function(exports,require,module,global){const{TypeDroits}=require('ObjetDroitsPN.js');const EGenreTriElement=require('Enumere_TriElement.js');const{GDate}=require('ObjetDate.js');const ObjetDonneesListeFlatDesign=require('ObjetDonneesListeFlatDesign.js');const GTraductions=require('ObjetTraduction.js');const ObjetTri=require('ObjetTri.js');const EGenreAction=require('Enumere_Action.js');const EGenreBoiteMessage=require('Enumere_BoiteMessage.js');const EGenreEvenementListe=require('Enumere_EvenementListe.js');const EGenreEtat=require('Enumere_Etat.js');class DonneesListe_MemosEleves extends ObjetDonneesListeFlatDesign{constructor(aDonnees,aParametres){super(aDonnees);this.estValorisation=aParametres.estValorisation;this.setOptions({avecEvnt_Creation:true,avecEvnt_Modification:true,avecEvnt_Selection:true,avecCB:false,flatDesignMinimal:true});}
getTitreZonePrincipale(aParams){return aParams.article&&aParams.article.auteur?aParams.article.auteur.GetLibelle():'';}
getZoneComplementaire(aParams){return aParams.article&&aParams.article.date?GDate.FormatDate(aParams.article.date,'%JJ/%MM/%AAAA'):'';}
getZoneMessage(aParams){return aParams.article&&aParams.article?aParams.article.GetLibelle():'';}
initialiserObjetGraphique(aColonne,aElement,aInstance){aInstance.setParametres(GParametres.PremierLundi,GParametres.PremiereDate,GParametres.DerniereDate,null,null,null,false);}
setDonneesObjetGraphique(I,aArticle,aInstance){aInstance.SetDonnees(aArticle.date);}
getTri(){return[
ObjetTri.init('date',EGenreTriElement.Decroissant),ObjetTri.init('Libelle')
];}
GetVisible(aArticle){if(this.options.filtreMemoDate){return!_memoEstExpire(aArticle);}
return true;}
initialisationObjetContextuel(aParametres){if(!aParametres.menuContextuel||!GApplication.droits.get(TypeDroits.dossierVS.saisirMemos)){return;}
aParametres.menuContextuel.add(GTraductions.getValeur('Modifier'),aParametres.article.editable,function(){this.callback.appel({article:aParametres.article,genreEvenement:EGenreEvenementListe.Edition});},{icon:'icon_pencil'});aParametres.menuContextuel.add(GTraductions.getValeur('Supprimer'),aParametres.article.editable,function(){GApplication.getMessage().afficher({type:EGenreBoiteMessage.Confirmation,message:this.Donnees.estValorisation?GTraductions.getValeur('AbsenceVS.msgSuppressionValorisation'):GTraductions.getValeur('AbsenceVS.msgSuppressionMemo'),callback:function(aGenreAction){if(aGenreAction===EGenreAction.Valider){aParametres.article.SetEtat(EGenreEtat.Suppression);this.callback.appel({article:aParametres.article,genreEvenement:EGenreEvenementListe.Suppression});}}.bind(this)});},{icon:'icon_trash'});aParametres.menuContextuel.SetDonnees();}}
function _memoEstExpire(aMemo){return!!aMemo&&aMemo.estExpire;}
module.exports=DonneesListe_MemosEleves;},fn:"donneesliste_memoseleves.js"});;
IE.fModule({f:function(exports,require,module,global){const{ObjetRequeteSaisie}=require('ObjetRequeteJSON.js');const Requetes=require('CollectionRequetes.js');class ObjetRequeteSaisieFicheEleve extends ObjetRequeteSaisie{constructor(...aParams){super(...aParams);}
lancerRequete(aParam){if(aParam.listeProjets){aParam.listeProjets.setSerialisateurJSON({methodeSerialisation:serialiserProjets.bind(this),ignorerEtatsElements:true});}
this.JSON.listeProjets=aParam.listeProjets;if(aParam.listeAttestations){aParam.listeAttestations.setSerialisateurJSON({methodeSerialisation:serialiserAttestations.bind(this),ignorerEtatsElements:true});}
this.JSON.listeAttestations=aParam.listeAttestations;if(aParam.listeTypes){aParam.listeTypes.setSerialisateurJSON({methodeSerialisation:serialiserTypes.bind(this)});}
this.JSON.listeTypes=aParam.listeTypes;this.JSON.eleve=aParam.eleve;if(aParam.listeFichiers){aParam.listeFichiers.setSerialisateurJSON({methodeSerialisation:serialiserDocumentsJoints.bind(this)});}
this.JSON.listeFichiers=aParam.listeFichiers;return this.appelAsynchrone();}
actionApresRequete(aXml,aGenreReponse){this.callbackReussite.appel(aXml,aGenreReponse,this.JSONRapportSaisie);}}
Requetes.inscrire('SaisieFicheEleve',ObjetRequeteSaisieFicheEleve);function serialiserProjets(aProjet,aJSON){$.extend(aJSON,aProjet.copieToJSON());aProjet.listeHandicaps.setSerialisateurJSON({methodeSerialisation:serialiserHandicaps.bind(this)});aJSON.listeHandicaps=aProjet.listeHandicaps;}
function serialiserAttestations(aAttestation,aJSON){$.extend(aJSON,aAttestation.copieToJSON());}
function serialiserTypes(aType,aJSON){$.extend(aJSON,aType.copieToJSON());}
function serialiserDocumentsJoints(aDocument,aJSON){$.extend(aJSON,aDocument.copieToJSON());}
function serialiserHandicaps(aHandicap,aJSON){$.extend(aJSON,aHandicap.copieToJSON());}
module.exports=ObjetRequeteSaisieFicheEleve;},fn:"objetrequetesaisieficheeleve.js"});;
IE.fModule({f:function(exports,require,module,global){const ObjetFenetre=require('ObjetFenetre.js');const GTraductions=require('ObjetTraduction.js');const Identite=require('ObjetIdentite.js');const{GDate}=require('ObjetDate.js');const tag=require('tag.js');const EGenreEtat=require('Enumere_Etat.js');const EGenreEvenementObjetSaisie=require('Enumere_EvenementObjetSaisie.js');const MethodesObjet=require('MethodesObjet.js');const EGenreBoiteMessage=require('Enumere_BoiteMessage.js');const EGenreAction=require('Enumere_Action.js');const ObjetCelluleDate=require('ObjetCelluleDate.js');const ObjetListeElements=require('ObjetListeElements.js');const ObjetElement=require('ObjetElement.js');const ObjetRequeteSaisieFicheEleve=require('ObjetRequeteSaisieFicheEleve.js');const GUID=require('GUID.js');class ObjetFenetre_Attestation extends ObjetFenetre{constructor(...aParams){super(...aParams);this.setOptionsFenetre({largeur:400,listeBoutons:[GTraductions.getValeur('Annuler'),GTraductions.getValeur('Valider')],avecComposeBasInFooter:true});this.enModification=false;this.zoneDateDelivree=GUID.getId();}
ConstruireInstances(){this.selecDate=Identite.creerInstance(ObjetCelluleDate,{pere:this,evenement:(aDate) =>{this.attestation.date=aDate;}});this.selecDate.setOptions_ObjetCelluleDate({largeurComposant:100,formatDate:'%JJ/%MM/%AAAA'});}
getControleur(aInstance){return $.extend(true,super.getControleur(this),{comboType:{init:function(aCombo){aCombo.setOptions_ObjetSaisie({estLargeurAuto:false,placeHolder:GTraductions.getValeur('FicheEleve.aucunTypeDeProjet'),avecOuvertureDeroulantModale:IE.estMobile,getContenuElement:function(aParams){const T=[];T.push(`<abbr>${aParams.element.abbreviation}</abbr><div class="libelle">${aParams.element.GetLibelle()}</div>`);return T.join('');},getClassElement:function(aParams){return aParams.element.GetActif()?'':'Gris';},getEstElementNonSelectionnable:(aElement) =>{return!aInstance.enModification&&!aElement.Actif;}});},getDonnees:function(aDonnees){if(!aDonnees){return aInstance.donnees?aInstance.donnees.listeTypes:null;}},getDisabled:function(){return aInstance.enModification;},getIndiceSelection:function(){if(!aInstance.donnees||!aInstance.donnees.attestation||!aInstance.donnees.listeTypes){return-1;}
let lIndice=aInstance.donnees.listeTypes.GetIndiceParNumeroEtGenre(aInstance.donnees.attestation.GetNumero());if(lIndice<0||!MethodesObjet.isNumber(lIndice)){lIndice= -1;}
return lIndice;},event:function(aParametres){if(!aInstance.enModification&&aParametres.genreEvenement===EGenreEvenementObjetSaisie.selection&&aParametres.element){aInstance.attestation=aParametres.element;aInstance.attestation.date=GDate.aujourdhui;aInstance.attestation.delivree=true;aInstance.attestation.SetEtat(EGenreEtat.Creation);_toggleDate.call(aInstance);}}},cbDelivree:{getValue:function(){return aInstance.attestation&&aInstance.attestation.delivree;},setValue:function(aDelivree){aInstance.attestation.delivree=aDelivree;$("#"+aInstance.zoneDateDelivree).toggle(aInstance.attestation.delivree);}},getNodeSelecDate:function(){aInstance.selecDate.Initialiser();aInstance.selecDate.setParametres_Fenetre(GParametres.PremierLundi,GParametres.PremiereDate,GParametres.DerniereDate,GParametres.JoursOuvres,null,GParametres.JoursFeries,null,null);_toggleDate.call(aInstance);},btnSupprimer:{event:function(){if(aInstance.enModification&&aInstance.donnees&&aInstance.donnees.attestation&&aInstance.donnees.attestation.existeNumero()){GApplication.getMessage().afficher({type:EGenreBoiteMessage.Confirmation,message:GTraductions.getValeur('Attestation.msgConfirmerSuppression',[''])}).then(function(aGenreAction){if(aGenreAction===EGenreAction.Valider){aInstance.donnees.attestation.SetEtat(EGenreEtat.Suppression);aInstance.SurValidation(1);}}.bind(aInstance));}},getDisabled:function(){return!aInstance.donnees||!aInstance.enModification;}},fenetreBtn:{getDisabled:function(aBoutonRepeat){if(aBoutonRepeat.element.index===1){return!(aInstance.attestation&&aInstance.attestation.existeNumero());}
return aInstance.optionsFenetre.listeBoutonsInactifs&&aInstance.optionsFenetre.listeBoutonsInactifs[aBoutonRepeat.element.index]===true;}}});}
SetDonnees(aDonnees){this.donnees=aDonnees;if(aDonnees.attestation){this.enModification=true;this.attestation=aDonnees.attestation;this.attestation.SetEtat(EGenreEtat.Modification);} else{this.attestation=new ObjetElement();this.attestation.delivree=true;this.attestation.date=GDate.aujourdhui;}
_toggleDate.call(this);this.Afficher();}
SurValidation(aNumeroBouton){if(aNumeroBouton===1){const lListeAttestation=new ObjetListeElements();lListeAttestation.add(this.attestation);new ObjetRequeteSaisieFicheEleve(this,this.ActionSurValidation).lancerRequete({listeAttestations:lListeAttestation,eleve:this.donnees.eleve});this.callback.appel(aNumeroBouton,this.attestation);}
this.Fermer();}
ComposeContenu(){const T=[];T.push(tag('div',{class:['flex-contain','cols']},tag('div',{class:'field-contain',style:"--width-bloc: 4.5rem;"},tag('label',{class:['fix-bloc']},GTraductions.getValeur('Attestation.type'),' : '),tag('div',{class:'fluid-bloc'},tag('ie-combo',{'ie-model':'comboType',class:'full-width'}))),tag('div',{class:'field-contain m-top-l no-line',style:"--width-bloc: 4.5rem;"},tag('label',{class:['fix-bloc','self-start']},GTraductions.getValeur('Attestation.etat'),' : '),tag('div',{class:['etat-contain'],style:'height: 5.9rem;'},tag('ie-checkbox',{'ie-model':'cbDelivree'},GTraductions.getValeur('Attestation.delivree')),tag('div',{id:this.zoneDateDelivree,class:['field-contain','as-flex','periode-contain','m-top-l']},tag('label',{class:['for-date','fix-bloc','m-right','self-center']},GTraductions.getValeur('Le')+' :'),tag('div',{class:['text-left','fix-bloc'],id:this.selecDate.GetNom(),'ie-node':'getNodeSelecDate'}))))));return T.join('');}
ComposeBas(){const lHTML=[];lHTML.push(`<div class="compose-bas">\n    <ie-btnicon ie-model="btnSupprimer" title="${GTraductions.getValeur('Supprimer')}" class="icon_trash avecFond i-medium"></ie-btnicon>\n    </div>`);return lHTML.join('');}}
function _toggleDate(){if(this.selecDate&&this.attestation){this.selecDate.setPremiereDateSaisissable(GParametres.PremiereDate,true);this.selecDate.SetDonnees(this.attestation.date?this.attestation.date:GDate.aujourdhui);$("#"+this.zoneDateDelivree).toggle(this.attestation.delivree);}}
module.exports=ObjetFenetre_Attestation;},fn:"objetfenetre_attestation.js"});;
IE.fModule({f:function(exports,require,module,global){const EGenreEvenementListe=require('Enumere_EvenementListe.js');const ObjetFenetre=require('ObjetFenetre.js');const ObjetListe=require('ObjetListe.js');const GTraductions=require('ObjetTraduction.js');const MethodesObjet=require('MethodesObjet.js');const EGenreEtat=require('Enumere_Etat.js');const ObjetElement=require('ObjetElement.js');const ObjetDonneesListeFlatDesign=require('ObjetDonneesListeFlatDesign.js');const ObjetTri=require('ObjetTri.js');const EGenreBoiteMessage=require('Enumere_BoiteMessage.js');const EGenreAction=require('Enumere_Action.js');class ObjetFenetre_TypeProjetAccompagnement extends ObjetFenetre{constructor(...aParams){super(...aParams);this.setOptionsFenetre({titre:GTraductions.getValeur('Themes'),largeur:400,hauteur:500,heightMax_mobile:true,listeBoutons:[GTraductions.getValeur('Annuler'),GTraductions.getValeur('Valider')],avecCroixFermeture:false});this.donnees={listeTypesProjet:null,eleve:null};}
ConstruireInstances(){this.identListeTypeProjetAcc=this.Add(ObjetListe,evenementSurListe.bind(this),_initialiserListe);}
getControleur(aInstance){return $.extend(true,super.getControleur(this),{fenetreBtn:{getDisabled:function(aBoutonRepeat){if(aBoutonRepeat.element.index===1){const lTypeSelectionne=aInstance.GetInstance(aInstance.identListeTypeProjetAcc).getElementSelection();return!lTypeSelectionne;}
return aInstance.optionsFenetre.listeBoutonsInactifs&&aInstance.optionsFenetre.listeBoutonsInactifs[aBoutonRepeat.element.index]===true;}}});}
SetDonnees(aListeTypesProjet,aParam){this.donnees.listeTypesProjet=MethodesObjet.dupliquer(aListeTypesProjet);this.donnees.eleve=aParam.eleve;this.Afficher();this.GetInstance(this.identListeTypeProjetAcc).SetDonnees(new DonneesListe_TypeProjetAccompagnement(this.donnees.listeTypesProjet));}
ComposeContenu(){const lHtml=[];lHtml.push('<div style="height:100%" id="',this.GetNomInstance(this.identListeTypeProjetAcc),'"></div>');return lHtml.join('');}
ouvrirFenetreEditionType(aTypeProjet){let lTypeProjetSaisi;if(aTypeProjet){lTypeProjetSaisi=MethodesObjet.dupliquer(aTypeProjet);} else{lTypeProjetSaisi=new ObjetElement('');lTypeProjetSaisi.estSupprimable=true;lTypeProjetSaisi.estModifiable=true;}
const lFenetre=ObjetFenetre.creerInstance(ObjetFenetre,{pere:this,evenement(aGenreBouton){if(aGenreBouton===1&&lTypeProjetSaisi.PourValidation()){const lElementDeListeAvecLibelle=this.donnees.listeTypesProjet.GetElementParLibelle(lTypeProjetSaisi.GetLibelle());if(lElementDeListeAvecLibelle){GApplication.getMessage().afficher({message:GTraductions.getValeur('FicheEleve.msgTypeProjetExiste')});} else{if(aTypeProjet){const lIndiceTypeExistant=this.donnees.listeTypesProjet.GetIndiceParElement(aTypeProjet);if(lIndiceTypeExistant> -1){this.donnees.listeTypesProjet.remove(lIndiceTypeExistant);}}
this.donnees.listeTypesProjet.add(lTypeProjetSaisi);this.GetInstance(this.identListeTypeProjetAcc).Actualiser(true);}}},initialiser(aInstance){aInstance.setOptionsFenetre({titre:GTraductions.getValeur('FicheEleve.typeDeProjet'),largeur:300,listeBoutons:[GTraductions.getValeur('Annuler'),GTraductions.getValeur('Valider')]});}});$.extend(lFenetre.controleur,{inputLibelle:{getValue(){return lTypeProjetSaisi.GetLibelle();},setValue(aValue){lTypeProjetSaisi.SetLibelle(aValue);lTypeProjetSaisi.SetEtat(EGenreEtat.Modification);}}});const lHtml='<input ie-model="inputLibelle" type="text" class="round-style" style="width:100%;" title="'+GTraductions.getValeur('FicheEleve.type')+'" />';lFenetre.Afficher(lHtml);}
SurValidation(aNumeroBouton){if(aNumeroBouton===1){const lTypeSelectionne=this.GetInstance(this.identListeTypeProjetAcc).getElementSelection();if(lTypeSelectionne){this.callback.appel(aNumeroBouton,lTypeSelectionne,this.donnees.listeTypesProjet);}}
this.Fermer();}}
function _initialiserListe(aInstance){aInstance.setOptionsListe({skin:ObjetListe.skin.flatDesign,avecLigneCreation:true});}
function evenementSurListe(aParametres){switch(aParametres.genreEvenement){case EGenreEvenementListe.Selection:break;case EGenreEvenementListe.Creation:this.ouvrirFenetreEditionType(aParametres.article);break;case EGenreEvenementListe.Edition:this.ouvrirFenetreEditionType(aParametres.article);break;case EGenreEvenementListe.Suppression:aParametres.article.SetEtat(EGenreEtat.Suppression);this.GetInstance(this.identListeTypeProjetAcc).Actualiser(true);break;}}
class DonneesListe_TypeProjetAccompagnement extends ObjetDonneesListeFlatDesign{constructor(aDonnees){super(aDonnees);this.setOptions({avecEvnt_Creation:true,avecEvnt_Selection:true,flatDesignMinimal:true});}
estLigneOff(aParams){return!aParams.article.Actif;}
AvecSelection(I,D){return D.Actif;}
initialisationObjetContextuel(aParametres){if(!aParametres.menuContextuel){return;}
aParametres.menuContextuel.add(GTraductions.getValeur('Modifier'),aParametres.article.estModifiable,function(){this.callback.appel({article:aParametres.article,genreEvenement:EGenreEvenementListe.Edition});},{icon:'icon_pencil'});aParametres.menuContextuel.add(GTraductions.getValeur('Supprimer'),aParametres.article.estSupprimable,function(){GApplication.getMessage().afficher({type:EGenreBoiteMessage.Confirmation,message:GTraductions.getValeur('FicheEleve.msgConfirmerSupprTypeProjet'),callback:(aGenreAction) =>{if(aGenreAction===EGenreAction.Valider){this.callback.appel({article:aParametres.article,genreEvenement:EGenreEvenementListe.Suppression});}}});},{icon:'icon_trash'});aParametres.menuContextuel.SetDonnees();}
getTri(){const lTris=[];lTris.push(ObjetTri.init((D) =>{return D.GetNumero()?true:false;}));lTris.push(ObjetTri.init('Libelle'));return lTris;}}
module.exports=ObjetFenetre_TypeProjetAccompagnement;},fn:"objetfenetre_typeprojetaccompagnement.js"});;
IE.fModule({f:function(exports,require,module,global){const EGenreEvenementListe=require('Enumere_EvenementListe.js');const ObjetFenetre=require('ObjetFenetre.js');const ObjetListe=require('ObjetListe.js');const GTraductions=require('ObjetTraduction.js');const MethodesObjet=require('MethodesObjet.js');const EGenreEtat=require('Enumere_Etat.js');const ObjetElement=require('ObjetElement.js');const ObjetDonneesListeFlatDesign=require('ObjetDonneesListeFlatDesign.js');const ObjetTri=require('ObjetTri.js');const EGenreBoiteMessage=require('Enumere_BoiteMessage.js');const EGenreAction=require('Enumere_Action.js');class ObjetFenetre_MotifProjetAccompagnement extends ObjetFenetre{constructor(...aParams){super(...aParams);this.setOptionsFenetre({largeur:400,hauteur:500,heightMax_mobile:true,listeBoutons:[GTraductions.getValeur('Annuler'),GTraductions.getValeur('Valider')],avecCroixFermeture:false});this.donnees={listeMotifs:null};}
ConstruireInstances(){this.identListeMotifsProjAcc=this.Add(ObjetListe,evenementSurListe.bind(this),_initialiserListe);}
SetDonnees(aListeMotifs){this.donnees.listeMotifs=MethodesObjet.dupliquer(aListeMotifs);this.Afficher();this.GetInstance(this.identListeMotifsProjAcc).SetDonnees(new DonneesListe_MotifProjetAccompagnement(this.donnees.listeMotifs));}
ComposeContenu(){const lHtml=[];lHtml.push('<div style="height:100%" id="',this.GetNomInstance(this.identListeMotifsProjAcc),'"></div>');return lHtml.join('');}
SurValidation(aNumeroBouton){if(aNumeroBouton===1){this.callback.appel(aNumeroBouton,this.donnees.listeMotifs);}
this.Fermer();}}
function _initialiserListe(aInstance){aInstance.setOptionsListe({avecLigneCreation:true,skin:ObjetListe.skin.flatDesign});}
function evenementSurListe(aParametres){switch(aParametres.genreEvenement){case EGenreEvenementListe.Creation:_ouvrirFenetreEditionMotif.call(this,aParametres.article);break;case EGenreEvenementListe.Edition:_ouvrirFenetreEditionMotif.call(this,aParametres.article);break;case EGenreEvenementListe.Suppression:aParametres.article.SetEtat(EGenreEtat.Suppression);this.GetInstance(this.identListeMotifsProjAcc).Actualiser(true);break;}}
function _ouvrirFenetreEditionMotif(aMotifProjAcc){let lMotifSaisi;if(aMotifProjAcc){lMotifSaisi=MethodesObjet.dupliquer(aMotifProjAcc);} else{lMotifSaisi=new ObjetElement('');lMotifSaisi.estSupprimable=true;lMotifSaisi.estModifiable=true;}
const lFenetre=ObjetFenetre.creerInstance(ObjetFenetre,{pere:this,evenement:function(aGenreBouton){if(aGenreBouton===1&&lMotifSaisi.PourValidation()){const lElementDeListeAvecLibelle=this.donnees.listeMotifs.GetElementParLibelle(lMotifSaisi.GetLibelle());if(lElementDeListeAvecLibelle){GApplication.getMessage().afficher({message:GTraductions.getValeur('FicheEleve.msgMotifProjetExiste')});} else{if(aMotifProjAcc){const lIndiceMotifExistant=this.donnees.listeMotifs.GetIndiceParElement(aMotifProjAcc);if(lIndiceMotifExistant> -1){this.donnees.listeMotifs.remove(lIndiceMotifExistant);}}
this.donnees.listeMotifs.add(lMotifSaisi);this.GetInstance(this.identListeMotifsProjAcc).Actualiser(true);}}},initialiser:function(aInstance){aInstance.setOptionsFenetre({titre:GTraductions.getValeur('FicheEleve.motifs'),largeur:300,listeBoutons:[GTraductions.getValeur('Annuler'),GTraductions.getValeur('Valider')]});}});$.extend(lFenetre.controleur,{inputLibelle:{getValue(){return lMotifSaisi.GetLibelle();},setValue(aValue){lMotifSaisi.SetLibelle(aValue);lMotifSaisi.SetEtat(EGenreEtat.Modification);}}});const lHtml='<input ie-model="inputLibelle" type="text" class="round-style" style="width:100%;" title="'+GTraductions.getValeur('FicheEleve.motifs')+'" />';lFenetre.Afficher(lHtml);}
class DonneesListe_MotifProjetAccompagnement extends ObjetDonneesListeFlatDesign{constructor(aDonnees){super(aDonnees);this.setOptions({avecEvnt_Creation:true,avecEvnt_Selection:true,avecCB:true,avecCocheCBSurLigne:true,flatDesignMinimal:true});}
getValueCB(aParams){return aParams.article?aParams.article.selectionne:false;}
setValueCB(aParams,aValue){aParams.article.selectionne=aValue;aParams.article.SetEtat(EGenreEtat.Modification);}
initialisationObjetContextuel(aParametres){if(!aParametres.menuContextuel){return;}
aParametres.menuContextuel.add(GTraductions.getValeur('Modifier'),aParametres.article.estModifiable,function(){this.callback.appel({article:aParametres.article,genreEvenement:EGenreEvenementListe.Edition});},{icon:'icon_pencil'});aParametres.menuContextuel.add(GTraductions.getValeur('Supprimer'),aParametres.article.estSupprimable&&aParametres.article.nbReferences===0&&!aParametres.article.selectionne,function(){GApplication.getMessage().afficher({type:EGenreBoiteMessage.Confirmation,message:GTraductions.getValeur('FicheEleve.msgConfirmerSupprMotif'),callback:(aGenreAction) =>{if(aGenreAction===EGenreAction.Valider){this.callback.appel({article:aParametres.article,genreEvenement:EGenreEvenementListe.Suppression});}}});},{icon:'icon_trash'});aParametres.menuContextuel.SetDonnees();}
getTri(){const lTris=[];lTris.push(ObjetTri.init((D) =>{return D.GetNumero()?true:false;}));lTris.push(ObjetTri.init('Libelle'));return lTris;}}
module.exports=ObjetFenetre_MotifProjetAccompagnement;},fn:"objetfenetre_motifprojetaccompagnement.js"});;
IE.fModule({f:function(exports,require,module,global){const ObjetFenetre=require('ObjetFenetre.js');const GTraductions=require('ObjetTraduction.js');const Identite=require('ObjetIdentite.js');const EGenreEtat=require('Enumere_Etat.js');const EGenreBoiteMessage=require('Enumere_BoiteMessage.js');const EGenreAction=require('Enumere_Action.js');const ObjetCelluleDate=require('ObjetCelluleDate.js');const ObjetListeElements=require('ObjetListeElements.js');const ObjetElement=require('ObjetElement.js');const{GDate}=require('ObjetDate.js');const ObjetRequeteSaisieFicheEleve=require('ObjetRequeteSaisieFicheEleve.js');const ObjetSelecteurPJ=require('ObjetSelecteurPJ.js');const EGenreDocumentJoint=require('Enumere_DocumentJoint.js');const EGenreRessource=require('Enumere_Ressource.js');const{TypeDroits}=require('ObjetDroitsPN.js');const TUtilitaireUrl=require('UtilitaireUrl.js');const GHtml=require('GHtml.js');const GUID=require('GUID.js');const{ObjetCelluleBouton}=require('ObjetCelluleBouton.js');const EGenreBoutonCellule=require('ObjetCelluleBouton.js').EGenreBoutonCellule;const EEvent=require('Enumere_Event.js');const ObjetFenetre_TypeProjetAccompagnement=require('ObjetFenetre_TypeProjetAccompagnement.js');const ObjetFenetre_MotifProjetAccompagnement=require('ObjetFenetre_MotifProjetAccompagnement.js');const MethodesObjet=require('MethodesObjet.js');class ObjetFenetre_ProjetAccompagnement extends ObjetFenetre{constructor(...aParams){super(...aParams);this.setOptionsFenetre({largeur:430,listeBoutons:[GTraductions.getValeur('Annuler'),GTraductions.getValeur('Valider')],avecComposeBasInFooter:true});this.enModification=false;this.ids={pieceJointe:GUID.getId(),docsJoints:GUID.getId()};}
ConstruireInstances(){this.selecDateDebut=Identite.creerInstance(ObjetCelluleDate,{pere:this,evenement:(aDate,aGenreBouton) =>{if(aGenreBouton===0){delete this.projetAccompagnement.debut;this.projetAccompagnement.dateDebut='';this.selecDateDebut.Initialiser();} else{this.projetAccompagnement.debut=aDate;this.projetAccompagnement.dateDebut=GDate.FormatDate(aDate,'%JJ/%MM/%AAAA');}
_initialiserDate.call(this);}});this.selecDateDebut.setOptions_ObjetCelluleDate({largeurComposant:IE.estMobile?130:100,formatDate:'%JJ/%MM/%AAAA',placeHolder:GTraductions.getValeur('FicheEleve.DateDebut')});this.selecDateFin=Identite.creerInstance(ObjetCelluleDate,{pere:this,evenement:(aDate,aGenreBouton) =>{if(aGenreBouton===0){delete this.projetAccompagnement.fin;this.projetAccompagnement.dateFin='';this.selecDateFin.Initialiser();} else{this.projetAccompagnement.fin=aDate;this.projetAccompagnement.dateFin=GDate.FormatDate(aDate,'%JJ/%MM/%AAAA');}
_initialiserDate.call(this);}});this.selecDateFin.setOptions_ObjetCelluleDate({largeurComposant:IE.estMobile?130:100,formatDate:'%JJ/%MM/%AAAA',placeHolder:GTraductions.getValeur('FicheEleve.DateFin')});this.identSelecteurPJ=this.Add(ObjetSelecteurPJ,_evntSelecteurPJ.bind(this),_initSelecteurPJ.bind(this));this.identType=this.Add(ObjetCelluleBouton,_evntType.bind(this),_initType.bind(this));this.identMotif=this.Add(ObjetCelluleBouton,_evntMotif.bind(this),_initMotif.bind(this));}
getControleur(aInstance){return $.extend(true,super.getControleur(this),{inputCommentaire:{getValue(){return aInstance.projetAccompagnement?aInstance.projetAccompagnement.commentaire:'';},setValue(aValue){aInstance.projetAccompagnement.commentaire=aValue;}},cbConsultableEquipePeda:{getValue(){return aInstance.projetAccompagnement?aInstance.projetAccompagnement.consultableEquipePeda:false;},setValue(aValue){aInstance.projetAccompagnement.consultableEquipePeda=aValue;},getDisplay:function(){return!GApplication.estPrimaire;}},getNodeSelecDate:function(aEstDateDebut){const lInstanceDate=aEstDateDebut?aInstance.selecDateDebut:aInstance.selecDateFin;lInstanceDate.Initialiser();if(this.projetAccompagnement){lInstanceDate.setParametres_Fenetre(GParametres.PremierLundi,aEstDateDebut?GParametres.PremiereDate:(aInstance.projetAccompagnement.debut?aInstance.projetAccompagnement.debut:GParametres.PremiereDate),aEstDateDebut?(aInstance.projetAccompagnement.fin?aInstance.projetAccompagnement.fin:GParametres.DerniereDate):GParametres.DerniereDate,GParametres.JoursOuvres,null,GParametres.JoursFeries,null,null);}},btnSupprimer:{event:function(){if(aInstance.enModification&&aInstance.donnees&&aInstance.projetAccompagnement&&aInstance.projetAccompagnement.existeNumero()){GApplication.getMessage().afficher({type:EGenreBoiteMessage.Confirmation,width:370,message:GTraductions.getValeur('FicheEleve.msgConfirmerSuppression',[''])}).then(function(aGenreAction){if(aGenreAction===EGenreAction.Valider){aInstance.projetAccompagnement.SetEtat(EGenreEtat.Suppression);aInstance.SurValidation(1);}}.bind(aInstance));}},getDisabled:function(){return!aInstance.donnees||!aInstance.enModification;}},fenetreBtn:{getDisabled:function(aBoutonRepeat){if(aBoutonRepeat.element.index===1){return!(aInstance.projetAccompagnement&&aInstance.projetAccompagnement.projetIndividuel&&aInstance.projetAccompagnement.projetIndividuel.existeNumero());}
return aInstance.optionsFenetre.listeBoutonsInactifs&&aInstance.optionsFenetre.listeBoutonsInactifs[aBoutonRepeat.element.index]===true;}},chipsPJ:{event:function(){return true;},eventBtn:function(aIndex){_evntSupprPJ.call(aInstance,aIndex);}}});}
SetDonnees(aDonnees){this.donnees=aDonnees;if(aDonnees.projetAccompagnement){this.enModification=true;this.projetAccompagnement=MethodesObjet.dupliquer(aDonnees.projetAccompagnement);_initialiserDate.call(this);this.projetAccompagnement.SetEtat(EGenreEtat.Modification);} else{this.projetAccompagnement=new ObjetElement();this.projetAccompagnement.SetEtat(EGenreEtat.Creation);this.projetAccompagnement.consultableEquipePeda=true;this.projetAccompagnement.listeHandicaps=this.donnees.listeMotifs;}
this.GetInstance(this.identSelecteurPJ).SetDonnees({listePJ:this.projetAccompagnement.documents,listeTotale:new ObjetListeElements(),idContextFocus:this.Nom});_actualiserPJ.call(this);const lLibelleType=this.projetAccompagnement&&this.projetAccompagnement.projetIndividuel?this.projetAccompagnement.projetIndividuel.GetLibelle():'';this.GetInstance(this.identType).setLibelle(lLibelleType);this.GetInstance(this.identType).SetActif(true);if(this.projetAccompagnement&&this.projetAccompagnement.listeHandicaps){this.GetInstance(this.identMotif).setLibelle(this.projetAccompagnement.listeHandicaps.getListeElements((aElement) =>{return aElement.selectionne;}).getTableauLibelles().join(', '));}
this.GetInstance(this.identMotif).SetActif(true);this.Afficher();}
SurValidation(aNumeroBouton){if(aNumeroBouton===1){const lListeProjetAccompagnement=new ObjetListeElements();const lListeFichiers=this.projetAccompagnement.documents;lListeProjetAccompagnement.add(this.projetAccompagnement);new ObjetRequeteSaisieFicheEleve(this,this.ActionSurValidation).addUpload({listeFichiers:lListeFichiers}).lancerRequete({listeTypes:this.donnees.listeTypes,listeProjets:lListeProjetAccompagnement,listeFichiers:lListeFichiers,eleve:this.donnees.eleve});this.callback.appel(aNumeroBouton,this.projetAccompagnement,{listeMotifs:this.donnees.listeMotifs,listeTypes:this.donnees.listeTypes});}
this.Fermer();}
ComposeContenu(){const T=[];T.push(`<div class="flex-contain cols">\n              <div class="field-contain">\n                <label class="fix-bloc " style="width: 4.5rem;">${GTraductions.getValeur('FicheEleve.type')} : </label>\n                <div class="on-mobile" id="${this.GetNomInstance(this.identType)}"></div>\n              </div>\n              <div class="field-contain">\n                <label class="fix-bloc " style="width: 4.5rem;">${GTraductions.getValeur('FicheEleve.motifs')} : </label>\n                <div class="on-mobile" id="${this.GetNomInstance(this.identMotif)}"></div>\n              </div>\n              <div class="field-contain">\n                <label class="fix-bloc  only-mobile m-bottom-l">${GTraductions.getValeur('FicheEleve.commentaire')} : </label>\n                <ie-textareamax ie-model="inputCommentaire" class="txt-comment round-style fluid-bloc" style="width:100%;" maxlength="1000" ie-compteur="" placeholder="${GTraductions.getValeur('FicheEleve.redigezCommentaire')}"></ie-textareamax>\n              </div>\n              <div class="pj-global-conteneur">\n                <div class="pj-contain">\n                  <span class="icon-contain" id="${this.GetNomInstance(this.identSelecteurPJ)}" title="${GTraductions.getValeur('FicheEleve.ajouterPJ')}"></span>\n                  <span class="label-pj">${GTraductions.getValeur('FicheEleve.ajouterPJ')}</span>\n                  <span id="${this.ids.docsJoints}" class="docs-joints"></span>\n                </div>\n              </div>\n              <div class="field-contain periode-contain">\n                <div class="m-top m-right m-bottom">\n                  <label class="only-espace m-top-l ">${GTraductions.getValeur('FicheEleve.DateDebut')}</label>\n                  <div class="m-left-s" id="${this.selecDateDebut.GetNom()}" ie-node="getNodeSelecDate(true)"></div>\n                </div>\n                <div class="m-all">\n                  <label class="only-espace m-top-l">${GTraductions.getValeur('FicheEleve.DateFin')}</label>\n                  <div class="" id="${this.selecDateFin.GetNom()}" ie-node="getNodeSelecDate(false)"></div>\n                </div>\n              </div>\n              <div class="public-team"  ie-display="cbConsultableEquipePeda.getDisplay">\n              <span class="icon-contain only-mobile"><i class="icon_info_sondage_publier i-medium i-as-deco"></i></span>\n                <ie-checkbox ie-model="cbConsultableEquipePeda">${GTraductions.getValeur('FicheEleve.publieEquipePeda')}</ie-checkbox>\n            </div>\n          </div>`);return T.join('');}
ComposeBas(){const lHTML=[];lHTML.push(`<div class="compose-bas">\n                    <ie-btnicon ie-model="btnSupprimer" title="${GTraductions.getValeur('Supprimer')}" class="icon_trash avecFond i-medium"></ie-btnicon>\n                </div>`);return lHTML.join('');}}
function _initialiserDate(){if(this.projetAccompagnement){if(this.selecDateDebut){this.selecDateDebut.setPremiereDateSaisissable(GParametres.PremiereDate,true);this.selecDateDebut.setOptions_ObjetCelluleDate({avecAucuneDate:true});if(this.projetAccompagnement.debut){this.selecDateDebut.SetDonnees(this.projetAccompagnement.debut);}
this.selecDateDebut.setParametres_Fenetre(GParametres.PremierLundi,GParametres.PremiereDate,(this.projetAccompagnement.fin?this.projetAccompagnement.fin:GParametres.DerniereDate),GParametres.JoursOuvres,null,null,true,null);}
if(this.selecDateFin){this.selecDateFin.setPremiereDateSaisissable(this.projetAccompagnement.debut,true);this.selecDateFin.setOptions_ObjetCelluleDate({avecAucuneDate:true});if(this.projetAccompagnement.fin){this.selecDateFin.SetDonnees(this.projetAccompagnement.fin);}
this.selecDateFin.setParametres_Fenetre(GParametres.PremierLundi,(this.projetAccompagnement.debut?this.projetAccompagnement.debut:GParametres.PremiereDate),GParametres.DerniereDate,GParametres.JoursOuvres,null,null,true,null);}}}
function _initSelecteurPJ(aInstance){aInstance.setOptions({genrePJ:EGenreDocumentJoint.Fichier,genreRessourcePJ:EGenreRessource.DocJointEtablissement,maxFiles:0,maxSize:GApplication.droits.get(TypeDroits.tailleMaxDocJointEtablissement),idLibellePJ:this.ids.pieceJointe,avecAjoutExistante:true,avecEtatSaisie:false,avecBoutonSupp:true});}
function _actualiserPJ(){if(!this.projetAccompagnement.documents){this.projetAccompagnement.documents=new ObjetListeElements();}
const lInstance=this.GetInstance(this.identSelecteurPJ);lInstance.SetDonnees({listePJ:this.projetAccompagnement.documents,listeTotale:new ObjetListeElements(),idContextFocus:this.Nom});this.avecSaisie=true;if(this.projetAccompagnement.documents.GetNbrElements()>0){GHtml.setHtml(this.ids.docsJoints,TUtilitaireUrl.construireListeUrls(this.projetAccompagnement.documents,{IEModelChips:'chipsPJ'}),{controleur:this.controleur});}}
function _evntSelecteurPJ(){_actualiserPJ.call(this);}
function _evntSupprPJ(aIndex){if(!!this.projetAccompagnement&&this.projetAccompagnement.documents){this.projetAccompagnement.documents.GetElement(aIndex).SetEtat(EGenreEtat.Suppression);}
_actualiserPJ.call(this);}
function _initType(aInstance){aInstance.setOptions_ObjetCelluleBouton({estSaisissable:true,avecZoneSaisie:false,genreBouton:EGenreBoutonCellule.Points,largeur:180,hauteur:17,largeurBouton:16,placeHolder:GTraductions.getValeur('FicheEleve.aucunTypeDeProjet')});}
function _evntType(aGenreEvent){if((aGenreEvent===EEvent.SurKeyUp&&GNavigateur.IsToucheSelection())||(aGenreEvent===EEvent.SurMouseDown)){ObjetFenetre.creerInstance(ObjetFenetre_TypeProjetAccompagnement,{pere:this,evenement(aNumeroBouton,aTypeSelectionne,aListeType){if(aNumeroBouton===1){if(aTypeSelectionne){this.projetAccompagnement.SetLibelle(aTypeSelectionne.GetLibelle());this.projetAccompagnement.projetIndividuel=aTypeSelectionne;this.GetInstance(this.identType).setLibelle(this.projetAccompagnement.projetIndividuel.GetLibelle());}}
this.donnees.listeTypes=aListeType;},initialiser(aInstance){aInstance.setOptionsFenetre({titre:GTraductions.getValeur('FicheEleve.typeDeProjet')});}}).SetDonnees(this.donnees.listeTypes,{eleve:this.donnees.eleve});}}
function _initMotif(aInstance){aInstance.setOptions_ObjetCelluleBouton({estSaisissable:true,avecZoneSaisie:false,genreBouton:EGenreBoutonCellule.Points,largeur:180,hauteur:17,largeurBouton:16,placeHolder:GTraductions.getValeur('FicheEleve.aucunMotifProjet')});}
function _evntMotif(aGenreEvent){if((aGenreEvent===EEvent.SurKeyUp&&GNavigateur.IsToucheSelection())||(aGenreEvent===EEvent.SurMouseDown)){ObjetFenetre.creerInstance(ObjetFenetre_MotifProjetAccompagnement,{pere:this,evenement(aNumeroBouton,aMotifSelectionnes,aListeMotifs){if(aNumeroBouton===1){if(aMotifSelectionnes){this.projetAccompagnement.listeHandicaps=aMotifSelectionnes;if(this.projetAccompagnement&&this.projetAccompagnement.listeHandicaps){this.GetInstance(this.identMotif).setLibelle(this.projetAccompagnement.listeHandicaps.getListeElements((aElement) =>{return aElement.selectionne;}).getTableauLibelles().join(', '));}}
this.donnees.listeMotifs=aListeMotifs;}},initialiser(aInstance){aInstance.setOptionsFenetre({titre:GTraductions.getValeur('FicheEleve.motifs')});}}).SetDonnees(this.projetAccompagnement.listeHandicaps);}}
module.exports=ObjetFenetre_ProjetAccompagnement;},fn:"objetfenetre_projetaccompagnement.js"});;
IE.fModule({f:function(exports,require,module,global){const{ObjetRequeteSaisie}=require('ObjetRequeteJSON.js');const Requetes=require('CollectionRequetes.js');class ObjetRequeteSaisieMemoEleve extends ObjetRequeteSaisie{constructor(...aParams){super(...aParams);}
lancerRequete(aParametres){$.extend(this.JSON,aParametres);if(this.JSON.listeMemos){this.JSON.listeMemos.setSerialisateurJSON({methodeSerialisation:function(aElement,aJSON){aJSON.date=aElement.date;aJSON.publie=aElement.publie;aJSON.publieVS=aElement.publieVS;}});}
return this.appelAsynchrone();}
actionApresRequete(){this.callbackReussite.appel();}}
Requetes.inscrire('SaisieMemoEleve',ObjetRequeteSaisieMemoEleve);module.exports=ObjetRequeteSaisieMemoEleve;},fn:"objetrequetesaisiememoeleve.js"});;
IE.fModule({f:function(exports,require,module,global){const ObjetFenetre=require('ObjetFenetre.js');const GTraductions=require('ObjetTraduction.js');const Identite=require('ObjetIdentite.js');const{GDate}=require('ObjetDate.js');const tag=require('tag.js');const EGenreEtat=require('Enumere_Etat.js');const EGenreBoiteMessage=require('Enumere_BoiteMessage.js');const EGenreAction=require('Enumere_Action.js');const ObjetCelluleDate=require('ObjetCelluleDate.js');const ObjetElement=require('ObjetElement.js');const EGenreEspace=require('Enumere_Espace.js');const ObjetListeElements=require('ObjetListeElements.js');const ObjetRequeteSaisieMemoEleve=require('ObjetRequeteSaisieMemoEleve.js');class ObjetFenetre_MemoEleve extends ObjetFenetre{constructor(...aParams){super(...aParams);this.setOptionsFenetre({largeur:450,listeBoutons:[GTraductions.getValeur('Annuler'),GTraductions.getValeur('Valider')],avecComposeBasInFooter:true});this.enModification=false;}
ConstruireInstances(){this.selecDate=Identite.creerInstance(ObjetCelluleDate,{pere:this,evenement:(aDate) =>{this.memo.date=aDate;}});this.selecDate.setOptions_ObjetCelluleDate({largeurComposant:IE.estMobile?130:100,formatDate:'%JJ/%MM/%AAAA'});}
getControleur(aInstance){return $.extend(true,super.getControleur(this),{inputLibelle:{getValue(){return aInstance.memo?aInstance.memo.GetLibelle():'';},setValue(aValue){aInstance.memo.SetLibelle(aValue);}},getNodeSelecDate:function(){aInstance.selecDate.Initialiser();aInstance.selecDate.setParametres_Fenetre(GParametres.PremierLundi,GParametres.PremiereDate,GParametres.DerniereDate,GParametres.JoursOuvres,null,GParametres.JoursFeries,null,null);_toggleDate.call(aInstance);},btnSupprimer:{event:function(){if(aInstance.enModification&&aInstance.donnees&&aInstance.donnees.memo&&aInstance.donnees.memo.existeNumero()){GApplication.getMessage().afficher({type:EGenreBoiteMessage.Confirmation,message:aInstance.donnees&&aInstance.donnees.estValorisation?GTraductions.getValeur('AbsenceVS.msgSuppressionValorisation'):GTraductions.getValeur('AbsenceVS.msgSuppressionMemo')}).then(function(aGenreAction){if(aGenreAction===EGenreAction.Valider){aInstance.donnees.memo.SetEtat(EGenreEtat.Suppression);aInstance.SurValidation(1);}}.bind(aInstance));}},getDisabled:function(){return!aInstance.donnees||!aInstance.enModification;}},fenetreBtn:{getDisabled:function(aBoutonRepeat){if(aBoutonRepeat.element.index===1){return!(aInstance.memo&&aInstance.memo.GetLibelle()!=='');}
return aInstance.optionsFenetre.listeBoutonsInactifs&&aInstance.optionsFenetre.listeBoutonsInactifs[aBoutonRepeat.element.index]===true;}},cbPublie:{getValue(){return aInstance.memo?aInstance.memo.publie:'';},setValue(aValue){aInstance.memo.publie=aValue;}},cbPublieVS:{getValue(){return aInstance.memo?aInstance.memo.publieVS:'';},setValue(aValue){aInstance.memo.publieVS=aValue;}},afficherCbPublie:function(){return aInstance.donnees&&!aInstance.donnees.estValorisation&&(GEtatUtilisateur.GenreEspace===EGenreEspace.Etablissement);}});}
SetDonnees(aDonnees){this.donnees=aDonnees;if(aDonnees.memo){this.enModification=true;this.memo=aDonnees.memo;this.memo.SetEtat(EGenreEtat.Modification);} else{this.memo=new ObjetElement();this.memo.SetEtat(EGenreEtat.Creation);this.memo.editable=true;this.memo.date=GDate.aujourdhui;this.memo.publie=true;this.memo.publieVS=true;const lUserConnecte=GEtatUtilisateur.getUtilisateur();this.memo.auteur=new ObjetElement(lUserConnecte.GetLibelle(),lUserConnecte.GetNumero(),lUserConnecte.GetGenre());}
_toggleDate.call(this);this.Afficher();}
SurValidation(aNumeroBouton){if(aNumeroBouton===1){const lListeMemo=new ObjetListeElements();lListeMemo.add(this.memo);new ObjetRequeteSaisieMemoEleve(this).lancerRequete({eleve:this.donnees.eleve,listeMemos:lListeMemo,estValorisation:this.donnees.estValorisation});this.callback.appel(aNumeroBouton,this.memo,this.enModification);}
this.Fermer();}
ComposeContenu(){const T=[];T.push(tag('div',{class:['flex-contain','cols']},tag('div',{class:'field-contain'},tag('label',{class:['fix-bloc','ie-titre-petit','only-mobile','m-bottom-l']},GTraductions.getValeur('FicheEleve.commentaire')),tag('textarea',{type:'text','ie-model':'inputLibelle',class:['round-style','fluid-bloc','m-bottom'],style:'width:100%;',placeholder:GTraductions.getValeur('FicheEleve.redigezCommentaire'),title:GTraductions.getValeur('AbsenceVS.memo')})),tag('div',{class:['field-contain','periode-contain','m-bottom-l']},tag('label',{class:['fix-bloc','m-right','self-center']},GTraductions.getValeur('Date')+' :'),tag('div',{id:this.selecDate.GetNom(),'ie-node':'getNodeSelecDate'})),tag('div',{class:'field-contain shared-contain no-line'},tag('ie-checkbox',{'ie-textright':true,'ie-model':tag.funcAttr('cbPublie'),'ie-if':'afficherCbPublie'},GTraductions.getValeur('AbsenceVS.PartageEnseignant')),tag('ie-checkbox',{'ie-textright':true,'ie-model':tag.funcAttr('cbPublieVS'),'ie-if':'afficherCbPublie'},GTraductions.getValeur('AbsenceVS.PartagePersonnel')))));return T.join('');}
ComposeBas(){const lHTML=[];lHTML.push(`<div class="compose-bas">\n    <ie-btnicon ie-model="btnSupprimer" title="${GTraductions.getValeur('Supprimer')}" class="icon_trash avecFond i-medium"></ie-btnicon>\n    </div>`);return lHTML.join('');}}
function _toggleDate(){if(this.selecDate&&this.memo){this.selecDate.setPremiereDateSaisissable(GParametres.PremiereDate,true);this.selecDate.SetDonnees(this.memo.date?this.memo.date:GDate.aujourdhui);}}
module.exports=ObjetFenetre_MemoEleve;},fn:"objetfenetre_memoeleve.js"});;
IE.fModule({f:function(exports,require,module,global){const{TypeDroits}=require('ObjetDroitsPN.js');const ObjetRequeteFicheEleve=require('ObjetRequeteFicheEleve.js');const GChaine=require('GChaine.js');const{GDate}=require('ObjetDate.js');const ObjetFenetre=require('ObjetFenetre.js');const ObjetListe=require('ObjetListe.js');const ObjetElement=require('ObjetElement.js');const ObjetListeElements=require('ObjetListeElements.js');const ObjetTabOnglets=require('ObjetTabOnglets.js');const GTraductions=require('ObjetTraduction.js');const EGenreRessource=require('Enumere_Ressource.js');const EGenreEspace=require('Enumere_Espace.js');const ObjetAbstraitInterface=require('ObjetInterface.js');const GUID=require('GUID.js');const UtilitaireProjetAccompagnement=require('UtilitaireProjetAccompagnement.js');const DonneesListe_MemosEleves=require('DonneesListe_MemosEleves.js');const GHtml=require('GHtml.js');const EGenreEtat=require('Enumere_Etat.js');const ObjetFenetre_Attestation=require('ObjetFenetre_Attestation.js');const ObjetFenetre_ProjetAccompagnement=require('ObjetFenetre_ProjetAccompagnement.js');const ObjetFenetre_MemoEleve=require('ObjetFenetre_MemoEleve.js');const EGenreEvenementListe=require('Enumere_EvenementListe.js');const MethodesTableau=require('MethodesTableau.js');const ObjetRequeteSaisieMemoEleve=require('ObjetRequeteSaisieMemoEleve.js');require('espace/css/InterfaceRessources_Eleves.css');class InterfaceFicheEleve extends ObjetAbstraitInterface{constructor(...aParams){super(...aParams);this.donneesRecues=false;const lNom=GUID.getId();this.idDivScrollResp=this.Nom+'_divScrollResp_';this.idIdentite=GUID.getId();this.idScolarite=GUID.getId();this.idResponsables=GUID.getId();this.idContenuOnglet=lNom+'_contenuOnglets';this.idDivScrollResp=lNom+'_divScrollResp_';this.hauteurTabOnglets=36;this.mapMotifNbReferences={};this.aut={identiteEleve:GApplication.droits.get(TypeDroits.eleves.consulterIdentiteEleve),saisieAttestations:(GEtatUtilisateur.pourPrimaire()&&!MethodesTableau.existe(GEtatUtilisateur.GenreEspace,[EGenreEspace.PrimPeriscolaire,EGenreEspace.Mobile_PrimPeriscolaire]))||GApplication.droits.get(TypeDroits.eleves.avecSaisieAttestations),ficheResponsables:GApplication.droits.get(TypeDroits.eleves.consulterFichesResponsables),photoEleve:GApplication.droits.get(TypeDroits.eleves.consulterPhotosEleves),memos:MethodesTableau.existe(GEtatUtilisateur.GenreEspace,[EGenreEspace.PrimProfesseur,EGenreEspace.Mobile_PrimProfesseur]),attestationEtendue:GApplication.droits.get(TypeDroits.fonctionnalites.attestationEtendue),estPeriscolaire:GEtatUtilisateur.pourPrimaire()&&MethodesTableau.existe(GEtatUtilisateur.GenreEspace,[EGenreEspace.PrimPeriscolaire,EGenreEspace.Mobile_PrimPeriscolaire])};this.ongletActif=[this.aut.identiteEleve,this.aut.ficheResponsables];}
ConstruireInstances(){this.identTabs=this.Add(ObjetTabOnglets,this.evenementSurTab,this.initialiserTabs);this.identListeMemosEleves=this.Add(ObjetListe,_evenementListeMemo.bind(this),this.initialiserListeMemos);}
initialiserListeMemos(aInstance){aInstance.setOptionsListe({colonnes:[{taille:'100%'}],avecLigneCreation:GApplication.droits.get(TypeDroits.dossierVS.saisirMemos),titreCreation:GTraductions.getValeur('AbsenceVS.CreerUnMemo'),skin:ObjetListe.skin.flatDesign,forcerOmbreScrollBottom:true});}
SetOptions(aParam){this.ongletsAffiches={identite:true,responsables:true,memos:true,attestations:true,projets:true};$.extend(this.ongletsAffiches,aParam);}
verifierExistence(aElement){let existe=false;for(let i=0;i<this.scolariteEleve.listeProjets.GetNbrElements();i++){const elt=this.scolariteEleve.listeProjets.GetElement(i);if(elt.projetIndividuel.GetLibelle()===this.listeTypes.GetElement(aElement).GetLibelle()){existe=(!!elt.debut?GDate.estDateEgale(elt.debut,GDate.premiereDate):true);break;}}
return existe;}
SetDonnees(aParams){if((aParams.onglet!==undefined)&&(aParams.onglet!==null)){this.GetInstance(this.identTabs).ongletSelectionne=aParams.onglet;}
if(aParams.formatTitrePrimaire!==undefined&&aParams.formatTitrePrimaire!==null){this.formatTitrePrimaire=aParams.formatTitrePrimaire;} else{this.formatTitrePrimaire=false;}
this.eleve=GEtatUtilisateur.Navigation.GetRessource(EGenreRessource.Eleve);this.eleve.avecPhoto=true;if(!this.eleve||!this.eleve.existeNumero()){this.Fermer();return;}
this.Actualiser();}
Actualiser(){const lParam={numeroEleve:this.eleve.GetNumero(),avecEleve:this.aut.identiteEleve,avecResponsables:this.aut.ficheResponsables};new ObjetRequeteFicheEleve(this,this.actionSurReponseRequete).lancerRequete(lParam);}
actionSurReponseRequete(aIdentite,aScolarite,aListeTypes,aListeMotifs,aListeAttestations,aListeResponsables,aListeMemos){this.scolariteEleve=aScolarite;this.identiteEleve=aIdentite;this.listeTypes=aListeTypes;this.listeAttestations=aListeAttestations;this.listeMotifs=aListeMotifs;this.listeResponsables=aListeResponsables;this.listeMemosEleves=aListeMemos;this.estValorisation=false;this.donneesRecues=true;this.initialiserTabs(this.GetInstance(this.identTabs));const ancienOnglet=this.GetInstance(this.identTabs).ongletSelectionne;this.GetInstance(this.identTabs).ongletSelectionne=0;const lSelect=ancienOnglet;let positionOnglet=0;for(let i=0;i<this.listeOnglets.GetNbrElements();i++){if(this.listeOnglets.GetElement(i).Genre===lSelect){positionOnglet=i;}}
this.GetInstance(this.identTabs).selectOnglet(positionOnglet);if(!!this.Pere.setOptionsFenetre){let lParams={};if(IE.estMobile){lParams={titreNavigation:this.composeTitreFenetre(),titre:GTraductions.getValeur('FicheEleve.titrePanelMobile')};} else{lParams={titre:this.composeTitreFenetre()};}
this.Pere.setOptionsFenetre(lParams);}}
initialiserTabs(aInstance){this.ongletsAffiches={identite:true,scolarite:true,responsables:true,memos:true,attestations:true,projets:true};$.extend(this.ongletsAffiches,this.Pere.listeOnglets);this.listeOnglets=new ObjetListeElements();if(this.aut.identiteEleve&&this.ongletsAffiches.identite){this.listeOnglets.AddElement(new ObjetElement(GTraductions.getValeur('FicheEleve.identite'),0,InterfaceFicheEleve.genreOnglet.Identite));}
if(this.aut.identiteEleve&&this.ongletsAffiches.scolarite){this.listeOnglets.AddElement(new ObjetElement(GTraductions.getValeur('FicheEleve.scolarite'),0,InterfaceFicheEleve.genreOnglet.Scolarite));}
if(this.aut.ficheResponsables&&this.ongletsAffiches.responsables){this.listeOnglets.AddElement(new ObjetElement(GTraductions.getValeur('FicheEleve.responsables'),0,InterfaceFicheEleve.genreOnglet.Responsables));}
if(this.aut.memos&&this.ongletsAffiches.memos){this.listeOnglets.AddElement(new ObjetElement(GTraductions.getValeur('FicheEleve.memoInterne'),0,InterfaceFicheEleve.genreOnglet.Memos));}
aInstance.SetParametres(this.listeOnglets,false,this.Pere.optionsFenetre.largeur,this.hauteurTabOnglets,0);this.nbOngletsAffiches=this.listeOnglets.GetNbrElements();}
ConstruireStructureAffichage(){const T=[];T.push(`<div class="menu-tabs-wrapper" id="${this.GetInstance(this.identTabs).Nom}"></div>`);T.push(`<div id="${this.idContenuOnglet}" class="content-wrapper" style="overflow:auto;">\n              <div id="${this.idIdentite}"></div>\n              <div id="${this.idScolarite}"></div>\n              <div id="${this.idResponsables}"></div>\n              <div id="${this.GetInstance(this.identListeMemosEleves).GetNom()}" style="height:100%" ></div>\n            </div>`);return T.join('');}
composeTitreFenetre(){return this.identiteEleve.prenom+' '+this.identiteEleve.nom+'<br/>'+this.scolariteEleve.classe;}
composeOnglet(aGenreOnglet){const lGenreOnglet=aGenreOnglet?aGenreOnglet:this.getGenreOngletSelectionne();switch(lGenreOnglet){case InterfaceFicheEleve.genreOnglet.Identite:$('#'+this.idIdentite.escapeJQ()).show().siblings().hide();GHtml.setHtml(this.idIdentite,this.composeIdentiteEleve(),{controleur:this.controleur});break;case InterfaceFicheEleve.genreOnglet.Scolarite:$('#'+this.idScolarite.escapeJQ()).show().siblings().hide();GHtml.setHtml(this.idScolarite,this.composeScolarite(),{controleur:this.controleur});break;case InterfaceFicheEleve.genreOnglet.Responsables:$('#'+this.idResponsables.escapeJQ()).show().siblings().hide();GHtml.setHtml(this.idResponsables,this.composeResponsablesEleve(InterfaceFicheEleve.genreOnglet.Responsables));break;case InterfaceFicheEleve.genreOnglet.Memos:$('#'+this.GetInstance(this.identListeMemosEleves).GetNom().escapeJQ()).show().siblings().hide();_actualiserListeMemo.call(this);break;default:;break;}}
actionApresSaisieDocument(){this.actualiserListe();}
avecInfosCoordonnees(){const t=this.identiteEleve;this.avecInfosAdresse=(t.adresse1||t.adresse2||t.adresse3||t.adresse4||t.CP||t.ville||t.pays);this.avecInfosMedia=(t.telPort||t.email);return(this.avecInfosAdresse||this.avecInfosMedia);}
evenementSurTab(aElement){if(aElement){this.tabSelectionne=aElement;}
this.composeOnglet();}
SurValidation(ANumeroBouton){this.Pere.Fermer();this.scolariteEleve.listeTypes=this.listeTypes;this.Pere.callback.appel(ANumeroBouton,this.eleve,this.scolariteEleve,this.listeFichiersUpload);}
setOngletActif(aGenreOnglet){if($.isNumeric(aGenreOnglet)){this.ongletActif[aGenreOnglet]=true;}}
setOngletParDefaut(aGenreOnglet){this.ongletParDefaut=aGenreOnglet;}
getGenreOngletSelectionne(){return this.tabSelectionne?this.tabSelectionne.GetGenre():null;}
getControleur(aInstance){return $.extend(true,super.getControleur(aInstance),{nodePhoto:function(){$(this.node).on('error',function(){aInstance.eleve.avecPhoto=false;});},btnCreerAttestation:{event:function(){_ouvrirFenetreAttestation.call(aInstance);},getDisabled:function(){return aInstance.scolariteEleve.listeAttestations&&aInstance.listeAttestations&&aInstance.scolariteEleve.listeAttestations.GetNbrElementsExistes()===aInstance.listeAttestations.GetNbrElementsExistes();}},btnEditAttestation:{event:function(aNumero){let lAttestation;if(aInstance.scolariteEleve&&aInstance.scolariteEleve.listeAttestations){lAttestation=aInstance.scolariteEleve.listeAttestations.GetElementParNumero(aNumero);}
_ouvrirFenetreAttestation.call(aInstance,lAttestation);}},btnCreerProjetAccompagnement:{event:function(){_ouvrirFenetreProjetAccompagnement.call(aInstance);},getDisabled:function(){return aInstance.scolariteEleve.listeProjets&&aInstance.listeProjets&&aInstance.scolariteEleve.listeProjets.GetNbrElements()===aInstance.listeProjets.GetNbrElements();}},btnEditProjetAccompagnement:{event:function(aNumero){let lProjet;if(aInstance.scolariteEleve&&aInstance.scolariteEleve.listeProjets){lProjet=aInstance.scolariteEleve.listeProjets.GetElementParNumero(aNumero);}
_ouvrirFenetreProjetAccompagnement.call(aInstance,lProjet);}},getHtmlAttestation:function(){return aInstance.composeAttestations();},getHtmlProjetAccompagnement:function(){return _composeProjetsAccompagnement.call(aInstance);}});}
composeIdentiteEleve(){const T=[];T.push(`<div class="identite-wrapper">\n            ${this.aut.photoEleve?this.composePhoto():''}\n            <div class="identite-contain">\n            ${this.composeNoms()}
            ${(this.identiteEleve.localisationLieu||this.identiteEleve.localisationProf)?this.composelocalisationEleve():''}
            ${this.composeAutorisationSortie()}
            ${this.scolariteEleve.useTransport?`${this.composeUsagerTransports()}`:''}\n            </div>\n          </div>`);T.push(`<div class="infos-contain">\n            ${this.identiteEleve.ine?this.composeInformationINE():''}
            ${this.composeNaissance()}
            ${this.avecInfosCoordonnees()?`${this.avecInfosAdresse?this.composeAdresse(this.identiteEleve):''}
             ${this.avecInfosMedia?this.composeTelephonesMail(this.identiteEleve):''}`:''}
             ${this.composeAutorisationsCommunications(this.identiteEleve)}
          </div>`);return T.join('');}
composePhoto(){const T=[];let lSrcPhoto;if(this.eleve.avecPhoto){lSrcPhoto=GChaine.composeUrl_ImgPhotoIndividu(this.eleve);} else{lSrcPhoto='';}
T.push(`<div class="photo-contain">\n                <img ie-load-src="${lSrcPhoto}" class="img-portrait" ie-imgviewer ${GHtml.composeAttr('ie-node','nodePhoto',this.eleve.GetNumero())}/>\n             </div>`);return T.join('');}
composeNoms(){const T=[];T.push(`<div class="nom-prenom"> ${this.identiteEleve.nom} ${this.identiteEleve.prenom?this.identiteEleve.prenom:''}</div>`);return T.join('');}
composelocalisationEleve(){const T=[];T.push(`<div class="item">\n              <label class="icon_map_marker"></label>\n              <span> ${this.identiteEleve.localisationLieu}</span>\n              <span>(${this.identiteEleve.localisationProf})</span>\n            </div>`);return T.join('');}
composeAutorisationSortie(){const T=[];if(GEtatUtilisateur.pourPrimaire()){if(this.scolariteEleve.autoriseSortirSeul){T.push(`<div class="item">\n        <label>${GTraductions.getValeur('FicheEleve.autorisationSortie')}</label> : <span>${GTraductions.getValeur('FicheEleve.lEleveEstAutoriseASortirSeul')}</span>\n      </div>`);}} else{if(!!this.scolariteEleve.autorisationSortie){T.push(`<div class="item">\n                  <label class="multi-lignes">${GTraductions.getValeur('FicheEleve.autorisationSortie')} :</label> <span>${this.scolariteEleve.autorisationSortie.GetLibelle()}</span>\n                </div>`);}}
return T.join('');}
composeUsagerTransports(){const T=[];T.push(`<div class="item">\n              <label class="icon_bus">:</label><span>${GEtatUtilisateur.pourPrimaire()?`${GTraductions.getValeur('FicheEleve.utiliseTransportPrim')}`:`${GTraductions.getValeur('FicheEleve.utiliseTransport')}`}</span>\n            </div>`);return T.join('');}
composeInformationINE(){const T=[];T.push(`<div class="item">\n               <label class="icon_uniF2BC">${GTraductions.getValeur('FicheEleve.INE')}</label>\n               <span class="mt-3"> ${this.identiteEleve.ine}</span>\n              </div>`);return T.join('');}
composeNaissance(){const T=[];const lClass=this.identiteEleve.sexe===0?'icon_mars':this.identiteEleve.sexe===1?'icon_venus':'icon_troisieme_sexe';T.push(`<div class="item">\n    <label class="${lClass}"></label>`);if(!this.aut.estPeriscolaire&&(this.identiteEleve.dateNaiss||this.identiteEleve.villeNaiss)){T.push(`<span>${GTraductions.getValeur('FicheEleve.ne')}</span>`);T.push(`${this.identiteEleve.dateNaiss?`<span>${GTraductions.getValeur('FicheEleve.le')} ${this.identiteEleve.dateNaiss}</span> `:''}`);T.push(`${this.identiteEleve.villeNaiss?`<span>${GTraductions.getValeur('FicheEleve.a')} ${this.identiteEleve.villeNaiss}</span> `:''}`);T.push(`${this.identiteEleve.estMajeur?`<span class="gris m-left">(${GTraductions.getValeur('FicheEleve.majeur')})</span>`:''}`);} else{T.push(`${this.identiteEleve.age?`<span>${GTraductions.getValeur('FicheEleve.AgeDe')}: ${this.identiteEleve.age}</span> `:''}`);}
T.push(`</div>`);return T.join('');}
composeAdresse(aPersonne){const T=[];T.push(`<div class="item">\n                <label class="icon_home"></label><span class="mt-3">${aPersonne.adresse1?` ${aPersonne.adresse1} `:''} ${aPersonne.adresse2?` ${aPersonne.adresse2} `:''} ${aPersonne.adresse3?` ${aPersonne.adresse3}`:''} ${aPersonne.adresse4?` ${aPersonne.adresse4} `:''} <br> ${aPersonne.CP} ${aPersonne.ville} ${aPersonne.pays?` - ${aPersonne.pays}`:``}\n                </span>\n           </div>`);return T.join('');}
composeTelephonesMail(aPersonne){const T=[];T.push(`<div class="item coordonnees">`);if(aPersonne.telPort){const lIndicatif=aPersonne.indPort?`(+${aPersonne.indPort})`:'';T.push(`<div class="lien-communication tel-mobile" title="${GTraductions.getValeur('FicheEleve.TelPort')}">\n           <a href="tel:${GChaine.formatTelephoneAvecIndicatif(aPersonne.indPort,aPersonne.telPort)}"> ${lIndicatif}  ${_geStrTelephoneAvecEspaces(aPersonne.telPort)}</a>\n        </div>`);}
if(aPersonne.telFixe){T.push(`<div class="lien-communication" title="${GTraductions.getValeur('FicheEleve.TelFixe')}">\n           <a href="tel:${aPersonne.telFixe}"> ${_geStrTelephoneAvecEspaces(aPersonne.telFixe)}</a>\n        </div>`);}
if(aPersonne.telAutre){T.push(`<div class="lien-communication tel-autre" title="${GTraductions.getValeur('FicheEleve.TelFixe')}">\n           <a href="tel:${aPersonne.telAutre}"> ${_geStrTelephoneAvecEspaces(aPersonne.telAutre)}</a>\n        </div>`);}
if(aPersonne.email){T.push('<div class="lien-communication">',GChaine.composerEmail(aPersonne.email),'</div>');}
T.push('</div>');return T.join('');}
composeScolarite(){const T=[];if(this.scolariteEleve.profPrincipal||this.scolariteEleve.tuteur){T.push(`<div class="infos-wrapper profs">\n                  ${this.composeIdentiteProfs()}
              </div>`);}
T.push(`<div class="infos-wrapper">\n\n              ${this.composeRegime()}
              ${this.scolariteEleve.engagements?`${this.composeEngagements()}`:''}
              ${this.scolariteEleve.options?this.composeOptions():''}
              ${!this.aut.estPeriscolaire&&this.identiteEleve.accompagnant?this.composeAccompagnant():''}\n            </div>\n\n            <div class="infos-wrapper">\n              <div ie-html="getHtmlProjetAccompagnement"></div>\n            </div>\n\n              <div class="infos-wrapper">\n                  <div ie-html="getHtmlAttestation"></div>\n                  ${this.composeServicePeriscolaire()}
            </div>`);return T.join('');}
composeIdentiteProfs(){const T=[];T.push(`<div class="item">\n              <label class="multi-lignes">${!this.aut.estPeriscolaire?GTraductions.getValeur('FicheEleve.profPrincipal'):GTraductions.getValeur('Profs')} </label><span>${this.scolariteEleve.profPrincipal}</span>\n            </div>\n            ${!this.aut.estPeriscolaire&&this.scolariteEleve.tuteur?`<div class="item">\n            <label>${GTraductions.getValeur('FicheEleve.tuteur')}</label><span>${this.scolariteEleve.tuteur}</span>\n          </div>`:''}
            `);return T.join('');}
composeRegime(){const T=[];if(this.scolariteEleve.midi||this.scolariteEleve.soir||this.scolariteEleve.internat){T.push(`<div class="item regime">\n\n              <label class="icon_food multi-lignes"></label>\n              <span>\n              <span class="gris">${this.scolariteEleve.regime} : </span>`);T.push(`    <ul>`);if(this.scolariteEleve.midi){T.push(`    <li><span class="wrapper">${GTraductions.getValeur('FicheEleve.midi')} (${this.scolariteEleve.nombreSelectionnesMidi}/${this.scolariteEleve.nombreJoursSelectionnables}): ${this.scolariteEleve.midi}</span></li>`);}
if(this.scolariteEleve.soir){T.push(`    <li><span class="wrapper">${GTraductions.getValeur('FicheEleve.soir')} (${this.scolariteEleve.nombreSelectionnesSoir}/${this.scolariteEleve.nombreJoursSelectionnables}): ${this.scolariteEleve.soir}</span></li>`);}
if(this.scolariteEleve.internat){T.push(`    <li class="m-bottom"><span class="wrapper">${GTraductions.getValeur('FicheEleve.internat')} (${this.scolariteEleve.nombreSelectionnesInternat}/${this.scolariteEleve.nombreJoursSelectionnables}): ${this.scolariteEleve.internat}</span></li>`);if(this.scolariteEleve.numeroChambre){T.push(`    <li><span class="gris">${GTraductions.getValeur('FicheEleve.numeroChambre')} :</span> ${this.scolariteEleve.numeroChambre}</li>`);}
if(this.scolariteEleve.dortoir){T.push(`    <li><span class="gris">${GTraductions.getValeur('FicheEleve.dortoir')} :</span> ${this.scolariteEleve.dortoir}</li>`);}}
if(this.scolariteEleve.numeroSelf){T.push(`    <li><span class="gris">${GTraductions.getValeur('FicheEleve.numeroSelf')} :</span> ${this.scolariteEleve.numeroSelf}</li>`);}
if(this.scolariteEleve.numeroCasier){T.push(`    <li><span class="gris">${GTraductions.getValeur('FicheEleve.numeroCasier')} :</span> ${this.scolariteEleve.numeroCasier}</li>`);}
T.push(`    </ul>\n              </span>\n        </div>`);}
return T.join('');}
composeEngagements(){const T=[];const lClassesIcone=[];const lEstDelegueClasse=!!this.scolariteEleve.delegue&&!!this.scolariteEleve.delegue.estDelegueClasse;const lEstDelegueEco=!!this.scolariteEleve.delegue&&!!this.scolariteEleve.delegue.estDelegueEco;const lEstDelegueAutre=!!this.scolariteEleve.delegue&&!!this.scolariteEleve.delegue.estDelegueAutre;const lEstPlusieursCategories=(lEstDelegueClasse&&(lEstDelegueEco||lEstDelegueAutre))||(lEstDelegueEco&&lEstDelegueAutre);if(lEstPlusieursCategories){lClassesIcone.push('mix-icon_plus');} else if(lEstDelegueClasse){lClassesIcone.push('mix-icon_rond i-orange');} else if(lEstDelegueEco){lClassesIcone.push('mix-icon_rond i-green');}
lClassesIcone.join(' ');T.push(`<div class="item">\n              <label class="has-text icon_engagement ${lClassesIcone}">${GTraductions.getValeur('FicheEleve.engagements')} : </label>\n              <span class="mt-3">${this.scolariteEleve.engagements}</span>\n          </div>`);return T.join('');}
composeOptions(){const T=[];T.push(`<div class="item">\n              <label class="icon_list">${GTraductions.getValeur('FicheEleve.options')} : </label>\n              <span class="mt-3">${this.scolariteEleve.options}</span>\n          </div>`);return T.join('');}
composeAccompagnant(){const T=[];T.push(`<div class="item">\n              <label class="icon_accompagnant">${GTraductions.getValeur('FicheEleve.accompagnant')} : </label>\n              <span class="mt-3">${this.identiteEleve.accompagnant}</span>\n          </div>`);return T.join('');}
composeAttestations(){const T=[];if(this.scolariteEleve.listeAttestations===undefined){return'';}
const lAttestations=[];if(this.scolariteEleve.listeAttestations&&this.listeAttestations&&this.scolariteEleve.listeAttestations.GetNbrElements()===this.listeAttestations.GetNbrElements()){lAttestations.push(GTraductions.getValeur('Attestation.aucuneAttestationDisponible'));}
if(this.scolariteEleve.listeAttestations.GetNbrElements()===0){lAttestations.push(GTraductions.getValeur('Attestation.aucuneAttestationRenseignee'));}
this.scolariteEleve.listeAttestations.parcourir((aAttestation) =>{if(aAttestation.Existe()){const lDelivree=aAttestation.delivree?GTraductions.getValeur('FicheEleve.DelivreLe')+' '+GDate.FormatDate(aAttestation.date,'%JJJJ %JJ %MMMM %AAAA'):GTraductions.getValeur('Attestation.nonDelivree');const lBoutonEditer=this.aut.saisieAttestations?`<ie-btnicon class="icon icon_edit avecFond" role="button" title="${GTraductions.getValeur('Modifier')}" ie-model="btnEditAttestation('${aAttestation.GetNumero()}')"></ie-btnicon>`:'';lAttestations.push(`<div class="item-wrapper">\n        <label title ="${aAttestation.GetLibelle()}">${aAttestation.abbreviation}</label>\n        <span class="p-right">${lDelivree}</span>\n        ${lBoutonEditer}
        </div>`);}});const lBoutonCreer=this.aut.saisieAttestations?`<ie-btnicon class="icon_plus_fin avecFond m-right" role="button" ie-model="btnCreerAttestation" title="${GTraductions.getValeur('Attestation.titre')}"></ie-btnicon>`:'';T.push(`<div class="item attestations">\n                <div class="head-contain">\n                  <h4>${GTraductions.getValeur('FicheEleve.Attestations')}</h4>\n                  ${lBoutonCreer}\n                </div>\n                ${lAttestations.join('')}
              </div>`);return T.join('');}
composeServicePeriscolaire(){const T=[];if(this.scolariteEleve.listeServicesAnnexes&&(this.scolariteEleve.listeServicesAnnexes.GetNbrElements()>0)){T.push(`<div class="item"><label>${GTraductions.getValeur('FicheEleve.servicePeriscolaire')} :</label>\n      <span>${this.scolariteEleve.listeServicesAnnexes.getTableauLibelles().join(', ')}</span></div>`);}
return T.join('');}
composeAutorisationsCommunications(aPersonne){const T=[];const AutorisationCommunicationExiste=aPersonne.autoriseEmail||aPersonne.autoriseSMS||aPersonne.autoriseCourrier||aPersonne.autoriseDiscussion;if(AutorisationCommunicationExiste){T.push(`<div class="item autorisations">\n                <h4>${GTraductions.getValeur('FicheEleve.AutorisationCommunication')} :</h4>\n                  <ul>`);T.push(`${(aPersonne.telPort==='')?`<li class="com-ko">${GTraductions.getValeur('FicheEleve.SMSImpossible')}</li>`:aPersonne.autoriseSMS?`<li class="com-ok">${GTraductions.getValeur('FicheEleve.SMSOK')}</li>`:`<li class="com-ko">${GTraductions.getValeur('FicheEleve.SMSKO')}</li>`}`);T.push(`${aPersonne.email&&aPersonne.autoriseEmail?`<li class="com-ok">${GTraductions.getValeur('FicheEleve.EmailOK')}</li>`:`<li class="com-ko">${GTraductions.getValeur('FicheEleve.EmailKO')}</li>`}`);T.push(`${(aPersonne.adresse1===''&&aPersonne.adresse2===''&&aPersonne.adresse3===''&&aPersonne.adresse4==='')?`<li class="com-ko">${GTraductions.getValeur('FicheEleve.CourrierImpossible')}</li>`:aPersonne.autoriseCourrier?`<li class="com-ok">${GTraductions.getValeur('FicheEleve.CourrierOK')}</li>`:`<li class="com-ko">${GTraductions.getValeur('FicheEleve.CourrierKO')}</li>`}`);T.push(`${aPersonne.autoriseDiscussion?`<li class="com-ok">${GTraductions.getValeur('FicheEleve.DiscussionsOK')}</li>`:`<li class="com-ko">${GTraductions.getValeur('FicheEleve.DiscussionsKO')}</li>`}`);T.push('</ul>','</div>');}
return T.join('');}
composeResponsablesEleve(aGenreOnglet){const lListeResponsables=this.listeResponsables;const T=[];if(this.aut.ficheResponsables){const lNbrResp=lListeResponsables.GetNbrElements();if(lNbrResp>0){T.push(`<div class="liste-individus" id="${this.idDivScrollResp+aGenreOnglet}">`);for(let i=0;i<lNbrResp;i++){T.push(this.composeResponsable(lListeResponsables.GetElement(i)));}
T.push('</div>');} else{T.push(GTraductions.getValeur('FicheEleve.aucunAutreContact'));}}
return T.join('');}
composeResponsable(aResp){const T=[];const InfosAdresse=(aResp.adresse1||aResp.adresse2||aResp.adresse3||aResp.adresse4||aResp.CP||aResp.ville||aResp.pays);if(this.aut.ficheResponsables){T.push(`<div class="infos-wrapper individu">\n                <div class="infos-contain">\n                  <div class="item responsabilite-contain">\n                    <div class="nom-prenom"> ${aResp.nom} ${aResp.lienParente?`<span class="gris m-left"> (${aResp.lienParente})</span>`:''}</div>\n                    ${aResp.niveauResponsabilite?`<ie-chips tabindex=0 class="tag-style" >${aResp.niveauResponsabilite}</ie-chips>`:''}\n                  </div>\n                    ${aResp.profession?`<div class="item"><label>${GTraductions.getValeur('FicheEleve.Profession')} :</label><span>${aResp.profession}</span></div>`:''}
                    ${aResp.situation?`<div class="item"><label>${GTraductions.getValeur('FicheEleve.SituationProfessionnelle')} :</label><span>${aResp.situation}</span></div>`:''}\n\n\n                    ${InfosAdresse?this.composeAdresse(aResp):''}
                    ${this.composeTelephonesMail(aResp)}
                    ${this.composeContact(aResp)}
                    ${this.composeAutorisationsCommunications(aResp)}\n\n                    ${aResp.delegueClasse?`<div class="item"><label>${GTraductions.getValeur('FicheEleve.deleguePE')} : </label><span> ${aResp.delegueClasse}</span></div>`:''}
                    ${aResp.membreCA?`<div class="item"><span>${GTraductions.getValeur('FicheEleve.membreConseilAdmin')}</span></div>`:''}\n                </div>\n\n              </div>`);}
return T.join('');}
composeContact(aResp){const T=[];if(GEtatUtilisateur.GenreEspace===EGenreEspace.PrimProfesseur){if(aResp.contactUrgence){T.push(`<div class="item">\n                  <label class="icon_tel_urgence"></label>\n                  <span>${GTraductions.getValeur('FicheEleve.contactUrgence')}</span>\n                </div>`);}
if(aResp.autoriseRecupererEnfant){T.push(`<div class="item">\n                  <label class="icon_tel_personne_autorise"></label>\n                  <span>${GTraductions.getValeur('FicheEleve.autoriseRecuperer')}</span>\n                </div>`);}}
return T.join('');}}
InterfaceFicheEleve.genreOnglet={Identite:0,Scolarite:1,Responsables:2,Memos:3};function _geStrTelephoneAvecEspaces(aNumeroTelephone){if(!aNumeroTelephone||!aNumeroTelephone.length){return'';}
let lResult='';let lCompteur=0;for(let i=aNumeroTelephone.length-1;i>=0;i--){if((lCompteur%2)===0){lResult=' '+lResult;}
lResult=aNumeroTelephone.charAt(i)+lResult;lCompteur++;}
return lResult.trim();}
function _ouvrirFenetreAttestation(aAttestation){const lListeAttestation=this.listeAttestations.getListeElements((aElement) =>{aElement.SetActif(!(this.scolariteEleve.listeAttestations&&!!this.scolariteEleve.listeAttestations.GetElementParElement(aElement,true)));return aElement;});const lTitre=aAttestation?'Attestation.titreModifier':'Attestation.titre';ObjetFenetre.creerInstance(ObjetFenetre_Attestation,{initialiser:function(aInstance){aInstance.setOptionsFenetre({titre:GTraductions.getValeur(lTitre)});},pere:this,evenement:function(aNumeroBouton,aAttestation){if(aNumeroBouton===1){if(this.scolariteEleve&&this.scolariteEleve.listeAttestations){const lIndiceAncien=this.scolariteEleve.listeAttestations.GetIndiceParElement(aAttestation,false);if(lIndiceAncien> -1){this.scolariteEleve.listeAttestations.AddElement(aAttestation,lIndiceAncien);} else{this.scolariteEleve.listeAttestations.add(aAttestation);}}}}}).SetDonnees({listeTypes:lListeAttestation,eleve:this.eleve,attestation:aAttestation});}
function _evenementListeMemo(aParametres){switch(aParametres.genreEvenement){case EGenreEvenementListe.Creation:_ouvrirFenetreMemo.call(this);break;case EGenreEvenementListe.Edition:_ouvrirFenetreMemo.call(this,aParametres.article);break;case EGenreEvenementListe.Suppression:{const lListeMemo=new ObjetListeElements();lListeMemo.add(aParametres.article);new ObjetRequeteSaisieMemoEleve(this).lancerRequete({eleve:this.eleve,listeMemos:lListeMemo,estValorisation:this.festValorisation});_actualiserListeMemo.call(this);break;}}}
function _ouvrirFenetreProjetAccompagnement(aProjet){this.scolariteEleve.listeProjets.parcourir((aProjet) =>{const lType=this.listeTypes.GetElementParElement(aProjet.projetIndividuel);if(lType&&!(!!aProjet.dateDebut||!!aProjet.dateFin)){lType.SetActif(false);}});const lTitre=aProjet?'FicheEleve.modifierProjetAccompagnement':'FicheEleve.nouveauProjetAccompagnement';ObjetFenetre.creerInstance(ObjetFenetre_ProjetAccompagnement,{initialiser:function(aInstance){aInstance.setOptionsFenetre({titre:GTraductions.getValeur(lTitre)});},pere:this,evenement:function(aNumeroBouton){if(aNumeroBouton===1){if(this.scolariteEleve&&this.scolariteEleve.listeProjets){this.Actualiser();}}}}).SetDonnees({listeTypes:this.listeTypes,listeMotifs:this.listeMotifs,eleve:this.eleve,projetAccompagnement:aProjet});}
function _composeProjetsAccompagnement(){const T=[];const lAvecSaisie=!MethodesTableau.existe(GEtatUtilisateur.GenreEspace,[EGenreEspace.PrimPeriscolaire,EGenreEspace.Mobile_PrimPeriscolaire])&&GApplication.droits.get(TypeDroits.eleves.avecSaisieProjetIndividuel);const lBoutonCreer=lAvecSaisie?` <ie-btnicon class="icon_plus_fin avecFond m-right" role="button" ie-model="btnCreerProjetAccompagnement" title="${GTraductions.getValeur('FicheEleve.nouveauProjetAccompagnement')}"></ie-btnicon>`:'';T.push(`<div class="item projets">\n            <div class="head-contain">\n              <h4>${GTraductions.getValeur('PageCompte.ProjetsAccompagnement')}</h4>\n              ${lBoutonCreer}\n            </div>\n        <div class="projets-wrapper">\n          ${UtilitaireProjetAccompagnement.composeListeProjetsAccompagnement(this.scolariteEleve.listeProjets,{avecEdition:lAvecSaisie})}\n        </div>\n  </div>`);return T.join('');}
function _actualiserListeMemo(){this.GetInstance(this.identListeMemosEleves).SetDonnees(new DonneesListe_MemosEleves(this.listeMemosEleves,{estValorisation:false}));}
function _ouvrirFenetreMemo(aMemo){ObjetFenetre.creerInstance(ObjetFenetre_MemoEleve,{initialiser:function(aInstance){aInstance.setOptionsFenetre({titre:GTraductions.getValeur('AbsenceVS.memo')});},pere:this,evenement:function(aGenreBouton,aMemo){if(aGenreBouton===1){if(aMemo.Etat===EGenreEtat.Creation){this.listeMemosEleves.add(aMemo);}
this.Actualiser();}}}).SetDonnees({memo:aMemo,eleve:this.eleve,estValorisation:false});}
module.exports=InterfaceFicheEleve;},fn:"interfaceficheeleve.js"});;
IE.fModule({f:function(exports,require,module,global){const ObjetFenetre=require('ObjetFenetre.js');const InterfaceFicheEleve=require('InterfaceFicheEleve.js');const ObjetRequeteFicheEleve=require('ObjetRequeteFicheEleve.js');const{TypeDroits}=require('ObjetDroitsPN.js');const EGenreRessource=require('Enumere_Ressource.js');require('espace/css/InterfaceRessources_Eleves.css');require('produit/css/LiensCommunications.css');class ObjetFenetre_FicheEleve extends ObjetFenetre{constructor(...aParams){super(...aParams);}
ConstruireInstances(){this.idFicheEleve=this.Add(InterfaceFicheEleve);}
SurFermer(){}
SetDonnees(aOngletSelection,aBloquerFocus){this.setOptionsFenetre({bloquerFocus:aBloquerFocus});this.Afficher();this.GetInstance(this.idFicheEleve).SetOptions(this.listeOnglets);this.GetInstance(this.idFicheEleve).SetDonnees({onglet:aOngletSelection,formatTitrePrimaire:GEtatUtilisateur.pourPrimaire()});}
SurValidation(ANumeroBouton){this.GetInstance(this.idFicheEleve).SurValidation(ANumeroBouton);}
ComposeContenu(){const T=[];T.push('<div class="fiche-wrapper" style="height:100%" id="',this.GetInstance(this.idFicheEleve).GetNom(),'"></div>');return T.join('');}
setOngletParDefaut(aGenreOnglet){this.GetInstance(this.idFicheEleve).setOngletParDefaut(aGenreOnglet);}
setOngletActif(aGenreOnglet){this.GetInstance(this.idFicheEleve).setOngletActif(aGenreOnglet);}
setOngletsVisibles(aListeOnglets){this.listeOnglets=aListeOnglets;}
recupererDonneesFicheEleve(){var lParam={numeroEleve:this.donnees.eleve.GetNumero(),avecEleve:GApplication.droits.get(TypeDroits.eleves.consulterIdentiteEleve),avecResponsables:GApplication.droits.get(TypeDroits.eleves.consulterFichesResponsables),avecAutresContacts:GApplication.droits.get(TypeDroits.eleves.consulterFichesResponsables)};new ObjetRequeteFicheEleve(this,this.actionSurReponseRequeteFicheEleve).lancerRequete(lParam);}
actionSurReponseRequeteFicheEleve(aIdentite,aScolarite,aListeTypes,aListeMotifs,aListeAttestations,aListeResponsables,aListeMemosEleve){var lFicheEleve={identite:aIdentite,scolarite:aScolarite,listeMemos:aListeMemosEleve,listeResponsables:aListeResponsables};var lAutorisations={avecIdentiteEleve:GApplication.droits.get(TypeDroits.eleves.consulterIdentiteEleve),avecFicheResponsables:GApplication.droits.get(TypeDroits.eleves.consulterFichesResponsables),avecPhotoEleve:GApplication.droits.get(TypeDroits.eleves.consulterPhotosEleves)};Object.assign(this.donnees,lFicheEleve,lAutorisations);this.Afficher();this.afficherFicheEleve();}
afficherFicheEleve(){GEtatUtilisateur.Navigation.SetRessource(EGenreRessource.Eleve,this.donnees.eleve);this.GetInstance(this.idFicheEleve).SetOptions(this.listeOnglets);const lParams={onglet:null,formatTitrePrimaire:GEtatUtilisateur.pourPrimaire()};if(this.donnees.ongletSelection!==undefined){lParams.onglet=this.donnees.ongletSelection;}
this.GetInstance(this.idFicheEleve).SetDonnees(lParams);}
static ouvrir(aParametres){if(IE.estMobile&&!GApplication.droits.get(TypeDroits.eleves.consulterIdentiteEleve)&&!GApplication.droits.get(TypeDroits.eleves.consulterFichesResponsables)){return;}
const lInstanceFenetre=ObjetFenetre.creerInstance(ObjetFenetre_FicheEleve,{pere:aParametres.instance,initialiser:function(aInstance){const lOptions={cssFenetre:'liste-eleves'};if(!IE.estMobile){lOptions.largeur=750;lOptions.hauteur=400;} else{lOptions.heightMax_mobile=true;}
if(aParametres.avecRequeteDonnees&&!!aParametres.donnees&&!!aParametres.donnees.listeEleves){lOptions.avecNavigation=true;lOptions.callbackNavigation=_getEleveSuivant.bind(aInstance);}
aInstance.setOptionsFenetre(lOptions);}});if(aParametres.avecRequeteDonnees){lInstanceFenetre.donnees=Object.assign({eleve:null,listeEleves:null},aParametres.donnees);lInstanceFenetre.recupererDonneesFicheEleve();} else{lInstanceFenetre.SetDonnees(aParametres.donnees.ongletSelection,!!aParametres.donnees.bloquerFocus);}}}
function _getEleveSuivant(aSuivant){if(this.donnees.listeEleves){var lListeEleves=this.donnees.listeEleves;var lIndiceElementActuel,lIndiceProchainElement,lProchainElement;lIndiceElementActuel=lListeEleves.GetIndiceParElement(this.donnees.eleve);if(aSuivant){lIndiceProchainElement=lIndiceElementActuel+1<lListeEleves.GetNbrElements()?lIndiceElementActuel+1:0;} else{lIndiceProchainElement=lIndiceElementActuel===0?lListeEleves.GetNbrElements()-1:lIndiceElementActuel-1;}
lProchainElement=lListeEleves.GetElement(lIndiceProchainElement);if(lProchainElement){this.donnees.eleve=lProchainElement;this.afficherFicheEleve();}}}
module.exports=ObjetFenetre_FicheEleve;},fn:"objetfenetre_ficheeleve.js"});;
IE.fModule({f:function(exports,require,module,global){const UtilitaireBoutonBandeau=require('UtilitaireBoutonBandeau.js');const ObjetFenetre_FicheEleve=require('ObjetFenetre_FicheEleve.js');const{TypeDroits}=require('ObjetDroitsPN.js');const GTraductions=require('ObjetTraduction.js');const GChaine=require('GChaine.js');const EGenreRessource=require('Enumere_Ressource.js');const UtilitaireFicheEleve={};UtilitaireFicheEleve.AddSurZone=function(aInstance){if(this.avecFicheEleve()){aInstance.AddSurZone.push({html:UtilitaireBoutonBandeau.getHtmlBtnAfficherFicheEleve('btnAfficherFicheEleve')});}};UtilitaireFicheEleve.ConstruireInstances=function(aInstance){if(this.avecFicheEleve()){aInstance.identFenetreFicheEleve=aInstance.Add(ObjetFenetre_FicheEleve,null,initialiserFenetreFicheEleve.bind(aInstance));}};function initialiserFenetreFicheEleve(aInstance){aInstance.setOptionsFenetre({modale:false,titre:'',largeur:850,hauteur:400,listeBoutons:[GTraductions.getValeur('Fermer')]});aInstance.setOngletsVisibles({projets:false,attestations:false});}
UtilitaireFicheEleve.ajoutControleur=function(aInstance,aControleur){if(!aControleur.btnAfficherFicheEleve&&this.avecFicheEleve()){aControleur.btnAfficherFicheEleve={event(){_afficherFicheEleve.call(this.instance);},getSelection(){const lFenetre=aInstance.GetInstance(aInstance.identFenetreFicheEleve);return lFenetre&&lFenetre.EstAffiche();},getTitle(){return GTraductions.getValeur('FicheRenseignement');},getDisabled(){return!aInstance.estBoutonsFicheEleveActif;}};}};function _afficherFicheEleve(){const lFenetre=this.GetInstance(this.identFenetreFicheEleve);if(lFenetre){lFenetre.SetDonnees();}}
UtilitaireFicheEleve.avecFicheEleve=function(){return ObjetFenetre_FicheEleve&&(GApplication.droits.get(TypeDroits.eleves.consulterIdentiteEleve)||GApplication.droits.get(TypeDroits.eleves.consulterFichesResponsables));};module.exports.UtilitaireFicheEleve=UtilitaireFicheEleve;const UtilitairePhotoEleve={};UtilitairePhotoEleve.AddSurZone=function(aInstance){if(this.avecPhotoEleve()){aInstance.AddSurZone.push({html:UtilitaireBoutonBandeau.getHtmlBtnAfficherPhotoEleve('btnAfficherPhotoEleve')});}};UtilitairePhotoEleve.ConstruireInstances=function(aInstance){if(this.avecPhotoEleve()){const ObjetFichePhotos=require('ObjetFichePhotos.js');if(ObjetFichePhotos){aInstance.identFichePhoto=aInstance.Add(ObjetFichePhotos);}}};UtilitairePhotoEleve.ajoutControleur=function(aInstance,aControleur){if(!aControleur.btnAfficherPhotoEleve&&this.avecPhotoEleve()){aControleur.btnAfficherPhotoEleve={event(){UtilitairePhotoEleve._afficherPhotoEleve.call(this.instance,true);},getSelection(){const lFenetre=aInstance.GetInstance(aInstance.identFichePhoto);return lFenetre&&lFenetre.EstAffiche();},getTitle(){return GTraductions.getValeur('VoirPhotoEleve');},getDisabled(){return!aInstance.estBoutonsFicheEleveActif;}};}};UtilitairePhotoEleve._afficherPhotoEleve=function(aBloquerFocus){const lFenetrePhoto=this.GetInstance(this.identFichePhoto);if(lFenetrePhoto){const lRessource=GEtatUtilisateur.Navigation.GetRessource(EGenreRessource.Eleve);if(!!lRessource&&lRessource.existeNumero()){const lUrl=GChaine.creerUrlBruteLienExterne(lRessource,{libelle:'photo.jpg'});lFenetrePhoto.SetDonnees(null,lUrl,null,aBloquerFocus);} else{lFenetrePhoto.SetDonnees(null,'',null,aBloquerFocus);}}};UtilitairePhotoEleve.avecPhotoEleve=function(){return UtilitaireFicheEleve.avecFicheEleve()&&GApplication.droits.get(TypeDroits.eleves.consulterPhotosEleves);};module.exports.UtilitairePhotoEleve=UtilitairePhotoEleve;},fn:"utilitairerenseignementseleve.js"});;
IE.fModule({f:function(exports,require,module,global){const{TypeDroits}=require('ObjetDroitsPN.js');const{ObjetInvocateur,Invocateur}=require('Invocateur.js');const MethodesTableau=require('MethodesTableau.js');const _InterfacePage=require('_InterfacePage.js');const GHtml=require('GHtml.js');const EGenreBoiteMessage=require('Enumere_BoiteMessage.js');const EGenreImpression=require('Enumere_Genreimpression.js');const GTraductions=require('ObjetTraduction.js');const EGenreEvntMenusDeroulants=require('Enumere_EvntMenusDeroulants.js');const EGenreOnglet=require('Enumere_Onglet.js');const ObjetAffichagePageAvecMenusDeroulants=require('InterfacePageAvecMenusDeroulants.js');const ObjetSaisiePN=require('ObjetSaisiePN.js');const ObjetFenetre_FicheEleve=require('ObjetFenetre_FicheEleve.js');const UtilitaireBoutonBandeau=require('UtilitaireBoutonBandeau.js');const{UtilitaireFicheEleve,UtilitairePhotoEleve}=require('UtilitaireRenseignementsEleve.js');class ObjetInterfacePage extends _InterfacePage{constructor(...aParams){super(...aParams);this.estBoutonsFicheEleveActif=false;}
getPrioriteAffichageBandeauLargeur(){return[ObjetAffichagePageAvecMenusDeroulants];}
conditionSuppAfficherBandeau(aIdent){return this.Instances[aIdent]&&(!MethodesTableau.existe(this.GenreAffichage[aIdent],[ObjetAffichagePageAvecMenusDeroulants,ObjetSaisiePN]));}
afficherMessage(aMessage){GHtml.setHtml(this.idPage,this.composeMessage(aMessage));}
_EvenementAfficherMessage(AGenreMessage){this.afficherBandeau(false);if(this.Instances[this.IdentZoneAlClient]){const LMessage=typeof(AGenreMessage)==='number'?GTraductions.getValeur('Message')[AGenreMessage]:AGenreMessage;this.Instances[this.IdentZoneAlClient].effacer(this.composeMessage(LMessage));this.Instances[this.IdentZoneAlClient].IdPremierElement=this.idMessageActionRequise;}}
EvenementAfficherMessage(aGenreMessage){Invocateur.evenement(ObjetInvocateur.events.activationImpression,EGenreImpression.Aucune);this._EvenementAfficherMessage(aGenreMessage);}
construireFicheEleveEtFichePhoto(){if(this.avecFicheEleve()){UtilitaireFicheEleve.ConstruireInstances(this);UtilitairePhotoEleve.ConstruireInstances(this);}}
addSurZoneFicheEleve(){if(this.avecFicheEleve()){UtilitaireFicheEleve.AddSurZone(this);}}
addSurZonePhotoEleve(){if(this.avecPhotoEleve()){UtilitairePhotoEleve.AddSurZone(this);}}
estUnOngletAvecFicheEleve(aOnglet){const lListeOngletsAvecFicheEleve=[
EGenreOnglet.Bulletins,EGenreOnglet.Dossiers,EGenreOnglet.FicheBrevet,EGenreOnglet.FicheScolaire,EGenreOnglet.LivretScolaire_Fiche,EGenreOnglet.Releve,EGenreOnglet.SaisieAbsences_AppelEtSuivi,EGenreOnglet.SaisieAbsences_Appel,EGenreOnglet.SaisieAbsences_Appel_Professeur,EGenreOnglet.SaisieAppreciationsBulletin,EGenreOnglet.SaisieAppreciationsGenerales,EGenreOnglet.SaisieAppreciationsGenerales_Competences,EGenreOnglet.SaisieAppreciationsReleve,EGenreOnglet.SaisieNotes,EGenreOnglet.SuivisAbsenceRetard,EGenreOnglet.ListeEleves,EGenreOnglet.AbsencesGrille,EGenreOnglet.SaisieOrientation,EGenreOnglet.ReleveEvaluationsParService,EGenreOnglet.ReleveEvaluationsParClasse,EGenreOnglet.BulletinCompetences,EGenreOnglet.ReleveDeCompetences,EGenreOnglet.AppreciationsBulletinParEleve,EGenreOnglet.Evaluation,EGenreOnglet.ListeEvaluation,EGenreOnglet.SaisieAvisProfesseur,EGenreOnglet.SuiviJustificationsAbsencesRetards,EGenreOnglet.SyntheseAcquis,EGenreOnglet.CarnetDeSuivi
];return MethodesTableau.existe(aOnglet,lListeOngletsAvecFicheEleve);}
avecFicheEleve(){return ObjetFenetre_FicheEleve&&this.estUnOngletAvecFicheEleve(GEtatUtilisateur.getGenreOnglet())&&(GApplication.droits.get(TypeDroits.eleves.consulterIdentiteEleve)||GApplication.droits.get(TypeDroits.eleves.consulterFichesResponsables));}
avecPhotoEleve(){return this.avecFicheEleve()&&GApplication.droits.get(TypeDroits.eleves.consulterPhotosEleves);}
setGraphe(aGraphe,aParamGraphe){this._graphe=aGraphe;this._paramGraphe=aParamGraphe;}
actualiserFicheGraphe(){if(this.GetInstance(this.identFicheGraphe)&&this.GetInstance(this.identFicheGraphe).EnAffichage){this.GetInstance(this.identFicheGraphe).SetDonnees(this._graphe,this._paramGraphe);}}
getHtmlBoutonBandeauGraphe(){return UtilitaireBoutonBandeau.getHtmlBtnGrapheAraignee('btnGrapheAraignee');}
getTitleBoutonGraphe(){return GTraductions.getValeur('competences.GrapheAraignee');}
getControleur(aInstance){const lControleur=$.extend(true,super.getControleur(aInstance),{btnGrapheAraignee:{event(){if(aInstance.GetInstance(aInstance.identFicheGraphe)){if(aInstance._graphe.image[0]){aInstance.GetInstance(aInstance.identFicheGraphe).SetDonnees(aInstance._graphe,aInstance._paramGraphe);} else{GApplication.getMessage().afficher({type:EGenreBoiteMessage.Information,titre:null,message:aInstance._graphe.message,callback:null,avecDecalageFocusBouton:true});}}},getSelection(){return aInstance.GetInstance(aInstance.identFicheGraphe)&&aInstance.GetInstance(aInstance.identFicheGraphe).EstAffiche();},getTitle(){return aInstance.getTitleBoutonGraphe();},getDisabled(){return!aInstance._graphe;}}});UtilitaireFicheEleve.ajoutControleur(aInstance,lControleur);UtilitairePhotoEleve.ajoutControleur(aInstance,lControleur);return lControleur;}
initialiserFenetreFicheEleve(aInstance){aInstance.setOptionsFenetre({modale:false,titre:'',largeur:850,hauteur:400,listeBoutons:[GTraductions.getValeur('Fermer')]});aInstance.setOngletsVisibles({projets:false,attestations:false});}
fermerFenetreFicheEleve(){if(this.estFenetreFicheEleveAffiche()){this.GetInstance(this.identFenetreFicheEleve).Fermer();}}
fermerPhotoEleve(){if(this.estFenetrePhotoEleveAffiche()){this.GetInstance(this.identFichePhoto).Fermer();}}
estFenetreFicheEleveAffiche(){if(this.identFenetreFicheEleve){const lFenetre=this.GetInstance(this.identFenetreFicheEleve);return lFenetre&&lFenetre.EstAffiche();}
return false;}
estFenetrePhotoEleveAffiche(){if(this.identFichePhoto){const lFenetre=this.GetInstance(this.identFichePhoto);return lFenetre&&lFenetre.EstAffiche();}
return false;}
surSelectionEleve(){this.activerFichesEleve(true);if(this.estFenetreFicheEleveAffiche()){const lFenetre=this.GetInstance(this.identFenetreFicheEleve);if(GEtatUtilisateur.estModeAccessible()){lFenetre.Fermer();} else{lFenetre.SetDonnees(null,true);}}
if(this.estFenetrePhotoEleveAffiche()){if(GEtatUtilisateur.estModeAccessible()){this.GetInstance(this.identFichePhoto).Fermer();} else{UtilitairePhotoEleve._afficherPhotoEleve.call(this,true);}}}
activerFichesEleve(aActiver){this.estBoutonsFicheEleveActif=!!aActiver;if(!aActiver){this.fermerFenetreFicheEleve();this.fermerPhotoEleve();}}
selectionneEleveAutoDansPage(aIdentPage){const lTrouve=this.GetInstance(aIdentPage).selectionnerEleveCourant();this.activerFichesEleve(lTrouve);}
surEvntMenusDeroulants(aParam){switch(aParam.genreEvenement){case EGenreEvntMenusDeroulants.ressourceNonTrouve:this.surRessourceCouranteNonTrouveeDansCombo(aParam);break;}}
surRessourceCouranteNonTrouveeDansCombo(aParam){this.activerFichesEleve(false);}}
module.exports=ObjetInterfacePage;},fn:"interfacepage.js"});;
IE.fModule({f:function(exports,require,module,global){const ObjetIdentite=require('ObjetIdentite.js');const GHtml=require('GHtml.js');const GTraductions=require('ObjetTraduction.js');class ObjetCompte_AutorisationSortie extends ObjetIdentite{constructor(...aParams){super(...aParams);this.donneesRecues=false;this.param={sortieAutorisee:false};}
setDonnees(aParam){$.extend(this.param,aParam);this.donneesRecues=true;GHtml.setHtml(this.Nom,this.ConstruireAffichage(),{controleur:this.controleur});}
getControleur(aInstance){return $.extend(true,super.getControleur(this),{switchAutoriserSortie:{getValue:function(){return aInstance.param.sortieAutorisee;},setValue:function(aValeur){aInstance.param.sortieAutorisee=aValeur;aInstance.declencherCallback({estAutorise:aValeur});}}});}
ConstruireAffichage(){if(this.donneesRecues){return _composeAutorisationSortie.call(this);}
return'';}
getTitre(){return GTraductions.getValeur('InfosEnfantPrim.autoriseSortie.titreRubrique');}
declencherCallback(aParam){if(this.Pere&&this.Evenement){this.callback.appel(aParam);}}}
function _composeAutorisationSortie(){const H=[];H.push('<div class="NoWrap">');H.push('<ie-switch ie-model="switchAutoriserSortie">',GTraductions.getValeur('InfosEnfantPrim.autoriseSortie.libelleAutorisation'),'</ie-switch>');H.push('</div>');return H.join('');}
module.exports=ObjetCompte_AutorisationSortie;},fn:"objetcompte_autorisationsortie.js"});;
IE.fModule({f:function(exports,require,module,global){const ObjetIdentite=require('ObjetIdentite.js');const GHtml=require('GHtml.js');const GTraductions=require('ObjetTraduction.js');class ObjetCompte_AutorisationImage extends ObjetIdentite{constructor(...aParams){super(...aParams);this.donneesRecues=false;this.param={autoriserImage:false};}
setDonnees(aParam){$.extend(this.param,aParam);this.donneesRecues=true;GHtml.setHtml(this.Nom,this.ConstruireAffichage(),{controleur:this.controleur});}
getControleur(aInstance){return $.extend(true,super.getControleur(this),{switchAutoriserImage:{getValue:function(){return!aInstance.param.autoriserImage;},setValue:function(aValeur){aInstance.param.autoriserImage=!aValeur;aInstance.declencherCallback({estAutorise:!aValeur});}}});}
ConstruireAffichage(){if(this.donneesRecues){return _composeAutorisationImage.call(this);}
return'';}
getTitre(){return GTraductions.getValeur('infosperso.droitImage');}
declencherCallback(aParam){if(this.Pere&&this.Evenement){this.callback.appel(aParam);}}}
function _composeAutorisationImage(){const H=[];H.push('<div class="NoWrap">');H.push('<ie-switch ie-model="switchAutoriserImage">',GTraductions.getValeur('infosperso.autoriserImageParents',[GEtatUtilisateur.getMembre().GetLibelle(),GApplication.nomProduit]),'</ie-switch>');H.push('</div>');return H.join('');}
module.exports=ObjetCompte_AutorisationImage;},fn:"objetcompte_autorisationimage.js"});;
IE.fModule({f:function(exports,require,module,global){const Identite=require('ObjetIdentite.js');const GHtml=require('GHtml.js');const GStyle=require('GStyle.js');const ObjetListeElements=require('ObjetListeElements.js');const GTraductions=require('ObjetTraduction.js');const EGenreEvenementObjetSaisie=require('Enumere_EvenementObjetSaisie.js');const GUID=require('GUID.js');const EGenreTypeChampForm={texte:0,email:1,tel:2,combo:3};const EGenreTypeTel={domicile:0,mobile:1,professionnel:2};class ObjetChampFormulaire extends Identite{constructor(...aParams){super(...aParams);this.donneesRecues=false;this.param={typeChamp:EGenreTypeChampForm.texte,valeur:'',liste:new ObjetListeElements(),selection:null,estOptionnel:true,estActif:true,maxLength:null,avecClbckSurModif:false,placeholder:{avecOption:false,str:''},label:{avecOption:false,str:'',classCss:''},signalerErreur:{avecOption:false,str:''},styleOnFocus:{avecOption:true}};const lGuid=GUID.getId();this.zoneMsg=lGuid+'_msg';this.zoneChmp=lGuid+'_chmp';}
getControleur(aInstance){return $.extend(true,super.getControleur(this),{chmpstexte:{getValue:function(){return aInstance.param&&aInstance.param.valeur?aInstance.param.valeur:'';},setValue:function(aValue){aInstance.param.valeur=aValue;if(aInstance.param.avecClbckSurModif===true){aInstance.declencherCallback({valeur:aInstance.param.valeur});}},exitChange:function(){aInstance.declencherCallback({valeur:aInstance.param.valeur});},getDisabled:function(){return!aInstance.param.estActif;}},chmpsCombo:{init:function(aCombo){aCombo.setOptions_ObjetSaisie({longueur:!!aInstance.param.maxLength?aInstance.param.maxLength:354,hauteur:25});},getDonnees:function(aDonnees){if(!aDonnees){return aInstance.param.liste;}},getDisabled:function(){return!aInstance.param.estActif;},getIndiceSelection:function(){return aInstance.param.liste.GetIndiceParElement(aInstance.param.selection);},event:function(aParametres){if(aParametres.genreEvenement===EGenreEvenementObjetSaisie.selection&&!!aInstance.param&&(aInstance.param.selection!==null)&&(aInstance.param.selection!==undefined)){if(aParametres.element.GetNumero()!==aInstance.param.selection.GetNumero()){aInstance.param.selection=aParametres.element;aInstance.declencherCallback({valeur:aInstance.param.selection});}}}},ind:{getValue:function(){return aInstance.param&&aInstance.param.valeur?aInstance.param.valeur.ind:'';},setValue:function(aValue){aInstance.param.valeur.ind=aValue;},exitChange:function(){aInstance.declencherCallback({valeur:aInstance.param.valeur});},getDisabled:function(){return!aInstance.param.estActif;}},tel:{getValue:function(){return aInstance.param&&aInstance.param.valeur?aInstance.param.valeur.tel:'';},setValue:function(aValue){aInstance.param.valeur.tel=aValue;},exitChange:function(){aInstance.declencherCallback({valeur:aInstance.param.valeur});},getDisabled:function(){return!aInstance.param.estActif;}}});}
declencherCallback(aParam){if(this.Pere&&this.Evenement){this.callback.appel(aParam);}}
setParametres(aParam){if(!(aParam.label!==undefined&&aParam.label!==null&&aParam.label.avecOption===false)&&(aParam.typeChamp===EGenreTypeChampForm.tel)&&(aParam.typeTel!==null)&&(aParam.typeTel!==undefined)){const lLabel=this.getLabel({typeChamp:aParam.typeChamp,typeTel:aParam.typeTel});$.extend(true,this.param,{label:{avecOption:true,str:lLabel}});}
$.extend(true,this.param,aParam);}
getLabel(aParam){let lLabel='';switch(aParam.typeChamp){case EGenreTypeChampForm.tel:switch(aParam.typeTel){case EGenreTypeTel.domicile:lLabel=GTraductions.getValeur('InfosEnfantPrim.autresContacts.telDom');break;case EGenreTypeTel.mobile:lLabel=GTraductions.getValeur('InfosEnfantPrim.autresContacts.telMob');break;case EGenreTypeTel.professionnel:lLabel=GTraductions.getValeur('InfosEnfantPrim.autresContacts.telPro');break;}
break;}
return lLabel;}
setDonnees(aParam){this.setParametres(aParam);this.donneesRecues=true;GHtml.setHtml(this.Nom,this.ConstruireAffichage(),{controleur:this.controleur});}
ConstruireAffichage(){const H=[];if(this.donneesRecues){const lClass="Espace";const lStyle='height:25px; width:100%;';const lStyleEspaceHaut='margin-top: 10px;';H.push('<div id="',this.zoneChmp,'" style="',lStyleEspaceHaut,'">');if(this.param.label.avecOption){const lStyleLabel='margin-bottom:5px;';const lCssLabel=this.param.label.classCss;H.push('<label style="',lStyleLabel,'" class="',lCssLabel,'">',this.param.label.str,'</label>');}
switch(this.param.typeChamp){case EGenreTypeChampForm.texte:{const lMaxLength=this.param.maxLength!==null?'maxlength="'+this.param.maxLength+'"':'';H.push('<input ie-model="chmpstexte" ie-trim type="text" value="',this.param.valeur,'" ',lMaxLength,' class="round-style ',lClass,'" style="',lStyle,'" />');break;}
case EGenreTypeChampForm.tel:H.push('<div class="',lClass,'" style="',lStyle,'">');H.push(_composeTelephone.call(this,this.param.typeTel));H.push('</div>');break;case EGenreTypeChampForm.combo:H.push('<ie-combo ie-model="chmpsCombo" style="',lStyle,'"></ie-combo>');break;}
H.push('<div style="height:10px;" id="',this.zoneMsg,'" >&nbsp;</div>');H.push('</div>');}
return H.join('');}
setMsgErreur(aParam){let lMsg=aParam.msg;if(lMsg===''){lMsg='&nbsp;';$('#'+this.zoneChmp.escapeJQ()+' input').css('border','');$('#'+this.zoneMsg.escapeJQ()).css('color','');} else{$('#'+this.zoneChmp.escapeJQ()+' input').css('border','1px solid red');$('#'+this.zoneMsg.escapeJQ()).css('color','red');}
GHtml.setHtml(this.zoneMsg,lMsg);}
avecMsgErreur(){const lMsg=GHtml.getHtml(this.zoneMsg);return((lMsg!=='&nbsp;')&&(lMsg!==''));}}
function _composeTelephone(aGenre){const H=[],lLargeurLibelleInput=30,lLargeurIndicatif=45,lLargeurTel=115,lTitleImage='',lTitle='';let lClasseIcone;switch(aGenre){case EGenreTypeTel.domicile:lClasseIcone='icon_home';break;case EGenreTypeTel.mobile:lClasseIcone='icon_mobile_phone';break;case EGenreTypeTel.professionnel:lClasseIcone='icon_suitcase';break;}
H.push('<div class="NoWrap">');H.push('<div class="InlineBlock AlignementMilieuVertical AlignementMilieu" style="font-size: 1.5rem;',GStyle.composeWidth(lLargeurLibelleInput),'">');H.push('<i class="',lClasseIcone,'" title="',lTitleImage,'"></i>');H.push('</div>');H.push('<div class="InlineBlock AlignementMilieuVertical">','<input ie-model="ind" class="round-style"',' ie-indicatiftel ',' style="',GStyle.composeWidth(lLargeurIndicatif),'"',' type="text"',' title="',lTitle,'"',' tabIndex="0"','/>','</div>');H.push('<div class="InlineBlock AlignementMilieuVertical PetitEspaceGauche">','<input ie-model="tel" class="round-style"',' ie-telephone  ',' style="',GStyle.composeWidth(lLargeurTel),'"',' type="text"',lTitle?' placeholder="'+lTitle+'"':'',lTitle?' title="'+lTitle+'"':'',' tabIndex="0"','/>','</div>');H.push('</div>');return H.join('');}
module.exports.ObjetChampFormulaire=ObjetChampFormulaire;module.exports.EGenreTypeChampForm=EGenreTypeChampForm;module.exports.EGenreTypeTel=EGenreTypeTel;},fn:"objetchampformulaire.js"});;
IE.fModule({f:function(exports,require,module,global){const ObjetFenetre=require('ObjetFenetre.js');const GUID=require('GUID.js');const GHtml=require('GHtml.js');class ObjetFenetre_DetailsAutreContact extends ObjetFenetre{constructor(...aParams){super(...aParams);this.idContenu=GUID.getId();}
ConstruireInstances(){}
ComposeContenu(){const H=[];H.push('<div id="',this.idContenu,'"></div>');return H.join('');}
SetDonnees(aParams){GHtml.setHtml(this.idContenu,aParams.html,{controleur:aParams.controleur});}}
module.exports=ObjetFenetre_DetailsAutreContact;},fn:"objetfenetre_detailsautrecontact.js"});;
IE.fModule({f:function(exports,require,module,global){const MethodesObjet=require('MethodesObjet.js');const ObjetIdentite=require('ObjetIdentite.js');const GHtml=require('GHtml.js');const GTraductions=require('ObjetTraduction.js');const ObjetListeElements=require('ObjetListeElements.js');const GestionnaireBlocDeBase=require('GestionnaireBloc.js').GestionnaireBlocDeBase;const ObjetBlocPN=require('GestionnaireBlocPN.js').ObjetBlocPN;const ObjetChampFormulaire=require('ObjetChampFormulaire.js').ObjetChampFormulaire;const EGenreTypeChampForm=require('ObjetChampFormulaire.js').EGenreTypeChampForm;const EGenreTypeTel=require('ObjetChampFormulaire.js').EGenreTypeTel;const TypeThemeBouton=require('Type_ThemeBouton.js');const ObjetElement=require('ObjetElement.js');const EGenreEtat=require('Enumere_Etat.js');const GUID=require('GUID.js');const EGenreBoiteMessage=require('Enumere_BoiteMessage.js');const EGenreAction=require('Enumere_Action.js');const ObjetMenuContextuel=require('ObjetMenuContextuel.js');const GPosition=require('GPosition.js');const ObjetTri=require('ObjetTri.js');const ObjetFenetre=require('ObjetFenetre.js');const ObjetFenetre_DetailsAutreContact=require('ObjetFenetre_DetailsAutreContact.js');require('espace/css/ObjetCompte_AutresContacts.css');const EGenreEvntSaisieAutreContact={suppression:1,validation:2};const EGenreErreurFormAutresContacts={auMoinsUnTel:1,nomObligatoire:2};class ObjetCompte_AutresContacts extends ObjetIdentite{constructor(...aParams){super(...aParams);this.donneesRecues=false;this.param={listeAutresContacts:new ObjetListeElements(),listeLiensParente:new ObjetListeElements(),listeContactsAutresEnfants:new ObjetListeElements()};const lGuid=GUID.getId();this.idConteneurFiches=lGuid+'_conteneurFichesContact';this.idBoutonRecup=lGuid+'_btnRecup';this.gestionnaireBlocsAutresContacts=ObjetIdentite.creerInstance(GestionnaireBlocAutresContacts,{pere:this,evenement:this._surEvntGestionnaireAutresContacts});}
getControleur(aInstance){return $.extend(true,super.getControleur(this),{btnCreerContact:{event:function(){_evntBtnCreerContact.call(aInstance);}},btnRecupContact:{event:function(){const lElt=this.node;_evntBtnRecupContact.call(aInstance,{id:lElt.id});}},btnSupprimer:{event:function(aIndice){const lListe=aInstance.param.listeAutresContacts;const lElt=lListe.GetElement(aIndice);const lMsgConfirmSuppression=GTraductions.getValeur('InfosEnfantPrim.autresContacts.msgConfirmSuppression');GApplication.getMessage().afficher({type:EGenreBoiteMessage.Confirmation,message:lMsgConfirmSuppression,callback:function(aGenreAction){_evntSuppressionContactElt.call(aInstance,lElt,aGenreAction);}});}},btnDetails:{event:function(aIndice){const lListe=aInstance.param.listeAutresContacts;const lElt=lListe.GetElement(aIndice);const lCopie=lElt;const lFenetreMessage=ObjetFenetre.creerInstance(ObjetFenetre_DetailsAutreContact,{pere:this,initialiser:function(aInstanceFenetre){aInstanceFenetre.setOptionsFenetre({titre:lElt.GetLibelle(),listeBoutons:[GTraductions.getValeur('Annuler'),GTraductions.getValeur('Valider')],largeur:500});},evenement:function(aNumeroBouton){if(aNumeroBouton===1){const lInstance=aInstance.gestionnaireBlocsAutresContacts.instanceMetier;const lValidation=validerDonneesCorrectes.call(lInstance);if(lValidation.succes){_evntValiderContact.call(lInstance);} else{_surErreurValidation.call(lInstance,lValidation);}
aInstance.Pere.RecupererDonnees();}}});lFenetreMessage.SetDonnees(_composeBlocContact.call(aInstance,lCopie));aInstance.gestionnaireBlocsAutresContacts.refreshInstance(lElt.indiceInstanceMetier);lFenetreMessage.Afficher();}}});}
avecContactVideUniquement(){let lResult=false;const lNbrElement=this.param.listeAutresContacts.GetNbrElements();if(lNbrElement>0){const lElt=this.param.listeAutresContacts.GetElement(lNbrElement-1);lResult=estEltAutreContactVide.call(this,lElt);}
return lResult;}
setDonnees(aParam){$.extend(true,this.param,aParam);const lEltAucun=new ObjetElement(GTraductions.getValeur('Aucun'),0,null,0);this.param.listeLiensParente.insererElement(lEltAucun,0);this.gestionnaireBlocsAutresContacts.setOptions({listeLiensParente:this.param.listeLiensParente});this.donneesRecues=true;GHtml.setHtml(this.Nom,this.ConstruireAffichage(),{controleur:this.controleur});this.gestionnaireBlocsAutresContacts.refresh();this.refreshBtnRecupererContacts();}
refreshBtnRecupererContacts(){this.listeContactsRecuperables=_getListeContactsRecuperables.call(this);if(this.listeContactsRecuperables.GetNbrElements()>0){$('#'+this.idBoutonRecup.escapeJQ()).css('display','');} else{$('#'+this.idBoutonRecup.escapeJQ()).css('display','none');}}
ConstruireAffichage(){return _compose.call(this);}
getTitre(){return GTraductions.getValeur('InfosEnfantPrim.autresContacts.titreRubrique');}
_surEvntGestionnaireAutresContacts(aElt,aGenreEvnt){switch(aGenreEvnt){case EGenreEvntSaisieAutreContact.suppression:_supprimerContact.call(this,aElt,{avecFicheVideParDefaut:true});this.refreshBtnRecupererContacts();break;case EGenreEvntSaisieAutreContact.validation:_validerContact.call(this,aElt);break;}}
declencherCallback(aParam){if(this.Pere&&this.Evenement){this.callback.appel(aParam);}}}
function _getListeContactsRecuperables(){const lListe=new ObjetListeElements();const lNbr=this.param.listeContactsAutresEnfants.GetNbrElements();for(let i=0;i<lNbr;i++){const lElt=this.param.listeContactsAutresEnfants.GetElement(i);const lIndice=this.param.listeAutresContacts.getIndiceElementParFiltre(function(D){return lElt.GetNumero()===D.GetNumero();});if(lIndice=== -1){lListe.AddElement(lElt);}}
lListe.setTri([ObjetTri.init('Libelle')]);lListe.trier();return lListe;}
function _compose(){if(this.donneesRecues){return _composeAutresContacts.call(this);} else{return'';}}
function _composeAutresContacts(){const H=[];const lListe=this.param.listeAutresContacts;const lBtnCreer=['<ie-bouton ie-model="btnCreerContact" ie-icon="icon_plus" >',GTraductions.getValeur('InfosEnfantPrim.autresContacts.ajouterContact'),'</ie-bouton>'];const lBtnRecuperer=['<ie-bouton id="',this.idBoutonRecup,'" ie-model="btnRecupContact" ie-icon="icon_copier_liste" ie-iconsize="2.9rem" class="bouton-carre">',GTraductions.getValeur('InfosEnfantPrim.autresContacts.recupererContact'),'</ie-bouton>'];const lClassBtn="InlineBlock";const lStyleBtn="margin-right:10px; ";H.push('<div id="',this.idConteneurFiches,'" class="FlexContainer_AutresContacts">');let lElt;if(!this.avecContactVideUniquement()){for(let i=0,lNbr=lListe.GetNbrElements();i<lNbr;i++){lElt=lListe.GetElement(i);H.push('<div class="Espace" style="max-width:700px;display:flex; flex-direction :row;justify-content:space-between;align-items:center;">');H.push('<div class="conteneurGauche">');H.push(lElt.GetLibelle());H.push('</div>');H.push('<div class="conteneurDroit" style="display:flex;flex-direction:row;">');H.push('<ie-bouton ie-model="btnDetails(',i,')" class="',TypeThemeBouton.secondaire,'">',GTraductions.getValeur('PageCompte.Details'),'</ie-bouton>');H.push('<ie-bouton ie-icon="icon_trash" ie-model="btnSupprimer(',i,')" class="Espace btn-flat-minimal ',TypeThemeBouton.secondaire,'"></ie-bouton>');H.push('</div>');H.push('</div>');}}
H.push('<div class="NoWrap">');H.push('<div class="',lClassBtn,'" style="',lStyleBtn,'">',lBtnCreer.join(''),'</div>');H.push('<div class="',lClassBtn,'" style="',lStyleBtn,'">',lBtnRecuperer.join(''),'</div>');H.push('</div>');H.push('</div>');return H.join('');}
function _composeBlocContact(aElt){const H=[];const lBloc=this.gestionnaireBlocsAutresContacts.composeBloc(aElt);H.push('<div class="FlexItem_AutresContacts">');H.push(lBloc.html);H.push('</div>');return{html:H.join(''),controleur:lBloc.controleur};}
function _ajouterFichePourElt(aElt){this.param.listeAutresContacts.AddElement(aElt);const lNewBloc=_composeBlocContact.call(this,aElt);const lInstance=this;const lFenetreMessage=ObjetFenetre.creerInstance(ObjetFenetre_DetailsAutreContact,{pere:this,initialiser:function(aInstanceFenetre){aInstanceFenetre.setOptionsFenetre({titre:GTraductions.getValeur('InfosEnfantPrim.autresContacts.ajouterContact'),listeBoutons:[GTraductions.getValeur('Annuler'),GTraductions.getValeur('Valider')],largeur:500});},evenement:function(){const lInstanceSaisie=lInstance.gestionnaireBlocsAutresContacts.instanceMetier;const lValidation=validerDonneesCorrectes.call(lInstanceSaisie);if(lValidation.succes){_evntValiderContact.call(lInstanceSaisie);} else{_surErreurValidation.call(lInstanceSaisie,lValidation);}}});lFenetreMessage.SetDonnees(lNewBloc);this.gestionnaireBlocsAutresContacts.refreshInstance(aElt.indiceInstanceMetier);lFenetreMessage.Afficher();}
function _evntBtnCreerContact(){const lElt=getEltAutreContactVide.call(this);_ajouterFichePourElt.call(this,lElt);}
function _evntBtnRecupContact(aParam){ObjetMenuContextuel.afficher({pere:this,initCommandes:function(aMenu){this.listeContactsRecuperables.parcourir(function(D){aMenu.add(D.GetLibelle(),true,function(){if(this.avecContactVideUniquement()){const lEltFicheVide=this.param.listeAutresContacts.GetElement(0);lEltFicheVide.SetEtat(EGenreEtat.Suppression);_supprimerContact.call(this,lEltFicheVide,{avecFicheVideParDefaut:false});}
_ajouterFichePourElt.call(this,D);this.refreshBtnRecupererContacts();});});},id:{x:GPosition.getLeft(aParam.id),y:IE.estMobile?GPosition.getTop(aParam.id):GPosition.getTop(aParam.id)+GPosition.getHeight(aParam.id)+2}});}
function getEltAutreContactVide(){const lContactVide=new ObjetElement();lContactVide.nom='';lContactVide.prenom='';lContactVide.indMobile='';lContactVide.indDomicile='';lContactVide.indTravail='';lContactVide.telMobile='';lContactVide.telDomicile='';lContactVide.telTravail='';lContactVide.appelSiUrgent=true;lContactVide.autoriseARecuperer=true;lContactVide.lienParente=this.param.listeLiensParente.GetElementParNumero(0);lContactVide.SetEtat(EGenreEtat.Creation);return lContactVide;}
function estEltAutreContactVide(aElt){return((aElt.Etat===EGenreEtat.Creation)&&(aElt.nom==='')&&(aElt.prenom==='')&&(aElt.indMobile==='')&&(aElt.indDomicile==='')&&(aElt.indTravail==='')&&(aElt.telMobile==='')&&(aElt.telDomicile==='')&&(aElt.telTravail==='')&&(aElt.appelSiUrgent===true)&&(aElt.autoriseARecuperer===true)&&(aElt.lienParente&&(aElt.lienParente.GetNumero()===0)));}
function _supprimerContact(aElt,aParam){const lIndiceInstance=aElt.indiceInstanceMetier;const lNomZone=this.gestionnaireBlocsAutresContacts.reInitInstance(lIndiceInstance);$('#'+lNomZone.escapeJQ()).parent().removeClass('FlexItem_AutresContacts');const lIndice=this.param.listeAutresContacts.GetIndiceParElement(aElt);if(lIndice>=0&&MethodesObjet.isNumber(lIndice)){this.param.listeAutresContacts.remove(lIndice);}
if((aParam.avecFicheVideParDefaut===true)&&(this.param.listeAutresContacts.GetNbrElements()===0)){_evntBtnCreerContact.call(this);}
if(aElt.PourValidation()){const lListeSaisie=new ObjetListeElements();lListeSaisie.AddElement(aElt);this.declencherCallback({listeSaisie:lListeSaisie});}}
function _validerContact(aElt){const lListeSaisie=new ObjetListeElements();lListeSaisie.AddElement(aElt);this.declencherCallback({listeSaisie:lListeSaisie});}
class GestionnaireBlocAutresContacts extends GestionnaireBlocDeBase{constructor(...aParams){super(...aParams);}
composeBloc(aDataBloc){this.instanceMetier=this.getInstanceObjetMetier(aDataBloc,ObjetSaisieAutreContact);return{html:this.composeZoneInstance(this.instanceMetier),controleur:this.instanceMetier.controleur};}}
class ObjetSaisieAutreContact extends ObjetBlocPN{constructor(...aParams){super(...aParams);this.param={};}
getControleur(aInstance){return $.extend(true,super.getControleur(this),{cbAppelerSiUrgent:{getValue:function(){return!!aInstance.donnee&&!!aInstance.donnee.appelSiUrgent;},setValue:function(aValeur){if(!!aInstance.donnee){aInstance.donnee.appelSiUrgent=aValeur;aInstance.donnee.SetEtat(EGenreEtat.Modification);}}},cbAutoriserARecuperer:{getValue:function(){return!!aInstance.donnee&&!!aInstance.donnee.autoriseARecuperer;},setValue:function(aValeur){if(!!aInstance.donnee){aInstance.donnee.autoriseARecuperer=aValeur;aInstance.donnee.SetEtat(EGenreEtat.Modification);}}},btnValiderFen:{event:function(){const lValidation=validerDonneesCorrectes.call(aInstance);if(lValidation.succes){_evntValiderContact.call(aInstance);} else{_surErreurValidation.call(aInstance,lValidation);}},getDisabled:function(){const lValidation=validerDonneesCorrectes.call(aInstance);return!lValidation.succes;}},btnSupprimer:{event:function(){const lMsgConfirmSuppression=GTraductions.getValeur('InfosEnfantPrim.autresContacts.msgConfirmSuppression');GApplication.getMessage().afficher({type:EGenreBoiteMessage.Confirmation,message:lMsgConfirmSuppression,callback:function(aGenreAction){_evntSuppressionContact.call(aInstance,aGenreAction);}});}}});}
setParametres(aElement,aOptions){super.setParametres(aElement,aOptions);this.options=aOptions;}
ConstruireInstances(){this.identNom=this.Add(ObjetChampFormulaire,_evntNom.bind(this),_initChmpTexte.bind(this,{label:{str:GTraductions.getValeur('InfosEnfantPrim.autresContacts.nom')}}));this.identPrenom=this.Add(ObjetChampFormulaire,_evntPrenom.bind(this),_initChmpTexte.bind(this,{label:{str:GTraductions.getValeur('InfosEnfantPrim.autresContacts.prenom')}}));this.identLienParente=this.Add(ObjetChampFormulaire,_evntLienParente.bind(this),_initChmpCombo.bind(this,{label:{str:GTraductions.getValeur('InfosEnfantPrim.autresContacts.parente')}}));this.identTelDom=this.Add(ObjetChampFormulaire,_evntTel.bind(this,EGenreTypeTel.domicile),_initChmpTel.bind(this,{typeTel:EGenreTypeTel.domicile}));this.identTelMob=this.Add(ObjetChampFormulaire,_evntTel.bind(this,EGenreTypeTel.mobile),_initChmpTel.bind(this,{typeTel:EGenreTypeTel.mobile}));this.identTelPro=this.Add(ObjetChampFormulaire,_evntTel.bind(this,EGenreTypeTel.professionnel),_initChmpTel.bind(this,{typeTel:EGenreTypeTel.professionnel}));}
ConstruireStructureAffichage(){const H=[];if(this.donneesRecues){H.push('<div class="SaisieContact_Fiche">');H.push('<div class="switch-contain" onclick="event.stopPropagation();">','<ie-switch ie-model="cbAppelerSiUrgent">',GTraductions.getValeur('InfosEnfantPrim.autresContacts.cbAAppeler'),'</ie-switch>','</div>');H.push('<div class="switch-contain" onclick="event.stopPropagation();">','<ie-switch ie-model="cbAutoriserARecuperer">',GTraductions.getValeur('InfosEnfantPrim.autresContacts.cbAutoriseARecuperer'),'</ie-switch>','</div>');H.push('<div class="champ-contact" id="',this.GetNomInstance(this.identNom),'"></div>');H.push('<div class="champ-contact" id="',this.GetNomInstance(this.identPrenom),'"></div>');H.push('<div class="champ-contact" id="',this.GetNomInstance(this.identLienParente),'"></div>');H.push('<div class="message-tel">',GTraductions.getValeur('InfosEnfantPrim.autresContacts.infoTelObligatoire'),'</div>');H.push('<div class="champ-contact" id="',this.GetNomInstance(this.identTelMob),'"></div>');H.push('<div class="champ-contact" id="',this.GetNomInstance(this.identTelDom),'"></div>');H.push('<div class="champ-contact" id="',this.GetNomInstance(this.identTelPro),'"></div>');H.push('<div class="GrandEspaceHaut FlexItem_BtnContact">');H.push('<ie-bouton ie-model="btnValiderFen" class="'+TypeThemeBouton.primaire+'">',GTraductions.getValeur('Valider'),'</ie-bouton>');H.push('</div>');H.push('</div>');}
return H.join('');}
RecupererDonnees(){if(this.donneesRecues===true){this.GetInstance(this.identNom).setDonnees({valeur:this.donnee.nom});this.GetInstance(this.identPrenom).setDonnees({valeur:this.donnee.prenom});this.GetInstance(this.identLienParente).setDonnees({liste:this.options.listeLiensParente,selection:this.donnee.lienParente});this.GetInstance(this.identTelDom).setDonnees({valeur:{ind:this.donnee.indDomicile,tel:this.donnee.telDomicile}});this.GetInstance(this.identTelMob).setDonnees({valeur:{ind:this.donnee.indMobile,tel:this.donnee.telMobile}});this.GetInstance(this.identTelPro).setDonnees({valeur:{ind:this.donnee.indTravail,tel:this.donnee.telTravail}});}}
declencherCallback(aParam){if(this.Pere&&this.Evenement){this.callback.appel(aParam.donnee,aParam.genreEvnt);}}}
function _evntSurSaisieChampTel(){const lChmpTel=this.GetInstance(this.identTelMob);const lResult=validerAuMoinsUnTel.call(this);if(lResult.succes){lChmpTel.setMsgErreur({msg:''});} else{_surErreurValidation.call(this,lResult);}}
function _evntSurSaisieChampNom(){const lChmp=this.GetInstance(this.identNom);if(lChmp.avecMsgErreur()){const lResult=validerNom.call(this);if(lResult.succes){lChmp.setMsgErreur({msg:''});}}}
function _initChmpTexte(aParam,aInstance){const lParam=$.extend(true,{typeChamp:EGenreTypeChampForm.texte,maxLength:100,estOptionnel:false,label:{avecOption:true}},aParam);aInstance.setParametres(lParam);}
function _initChmpCombo(aParam,aInstance){const lParam=$.extend(true,{typeChamp:EGenreTypeChampForm.combo,estOptionnel:false,maxLength:100,label:{avecOption:true}},aParam);aInstance.setParametres(lParam);}
function _initChmpTel(aParam,aInstance){const lParam=$.extend(true,{typeChamp:EGenreTypeChampForm.tel,placeholder:{avecOption:true,str:'TODO Optionnel'}},aParam);aInstance.setParametres(lParam);}
function _evntNom(aParam){this.donnee.nom=aParam.valeur;this.donnee.SetEtat(EGenreEtat.Modification);_evntSurSaisieChampNom.call(this);}
function _evntPrenom(aParam){this.donnee.prenom=aParam.valeur;this.donnee.SetEtat(EGenreEtat.Modification);}
function _evntLienParente(aParam){this.donnee.lienParente=aParam.valeur;}
function _evntTel(aGenreTel,aParam){switch(aGenreTel){case EGenreTypeTel.domicile:this.donnee.indDomicile=aParam.valeur.ind;this.donnee.telDomicile=aParam.valeur.tel;break;case EGenreTypeTel.mobile:this.donnee.indMobile=aParam.valeur.ind;this.donnee.telMobile=aParam.valeur.tel;break;case EGenreTypeTel.professionnel:this.donnee.indTravail=aParam.valeur.ind;this.donnee.telTravail=aParam.valeur.tel;break;}
this.donnee.SetEtat(EGenreEtat.Modification);_evntSurSaisieChampTel.call(this);}
function _evntValiderContact(){this.donnee.SetEtat(EGenreEtat.Modification);this.declencherCallback({donnee:this.donnee,genreEvnt:EGenreEvntSaisieAutreContact.validation});}
function _evntSuppressionContact(aGenreAction){if(aGenreAction!==EGenreAction.Valider){return;}
if(this.donnee.Etat!==EGenreEtat.Suppression){this.donnee.SetEtat(EGenreEtat.Suppression);this.declencherCallback({donnee:this.donnee,genreEvnt:EGenreEvntSaisieAutreContact.suppression});}}
function _evntSuppressionContactElt(aElt,aGenreAction){if(aGenreAction!==EGenreAction.Valider){return;}
if(aElt.Etat!==EGenreEtat.Suppression){aElt.SetEtat(EGenreEtat.Suppression);const lListeSaisie=new ObjetListeElements();lListeSaisie.AddElement(aElt);this.declencherCallback({listeSaisie:lListeSaisie,genreEvnt:EGenreEvntSaisieAutreContact.suppression});}}
function validerDonneesCorrectes(){let lResult={succes:false,genreErreur:null};lResult=validerNom.call(this);if(lResult.succes===true){lResult=validerAuMoinsUnTel.call(this);}
return lResult;}
function validerAuMoinsUnTel(){let lTypeErreur=null;const lSucces=(this.donnee.telDomicile!=='')||(this.donnee.telMobile!=='')||(this.donnee.telTravail!=='');if(!lSucces){lTypeErreur=EGenreErreurFormAutresContacts.auMoinsUnTel;}
return{succes:lSucces,genreErreur:lTypeErreur};}
function validerNom(){let lTypeErreur=null;const lSucces=(this.donnee.nom!=='');if(!lSucces){lTypeErreur=EGenreErreurFormAutresContacts.nomObligatoire;}
return{succes:lSucces,genreErreur:lTypeErreur};}
function _surErreurValidation(aParam){switch(aParam.genreErreur){case EGenreErreurFormAutresContacts.auMoinsUnTel:this.GetInstance(this.identTelMob).setMsgErreur({msg:GTraductions.getValeur('InfosEnfantPrim.autresContacts.msgAuMoinsUnTel')});break;case EGenreErreurFormAutresContacts.nomObligatoire:this.GetInstance(this.identNom).setMsgErreur({msg:GTraductions.getValeur('InfosEnfantPrim.autresContacts.msgNomObligatoire')});break;default:;break;}}
module.exports=ObjetCompte_AutresContacts;},fn:"objetcompte_autrescontacts.js"});;
IE.fModule({f:function(exports,require,module,global){const{ObjetRequeteSaisie}=require('ObjetRequeteJSON.js');const Requetes=require('CollectionRequetes.js');class ObjetRequeteSaisieCompteEnfant extends ObjetRequeteSaisie{constructor(...aParams){super(...aParams);}
lancerRequete(aParams){$.extend(this.JSON,aParams);if(!!aParams.informationsMedicales){this.JSON.informationsMedicales=aParams.informationsMedicales.toJSONAll();}
if(!!aParams.allergies&&!!aParams.allergies.listeAllergenes){this.JSON.listeAllergenes=aParams.allergies.listeAllergenes;aParams.allergies.listeAllergenes.setSerialisateurJSON({methodeSerialisation:_ajouterActif,ignorerEtatsElements:true});this.JSON.autoriseConsultationAllergies=aParams.allergies.autoriseConsultationAllergies;}
if(!!aParams.restrictionsAlimentaires){this.JSON.restrictionsAlimentaires.setSerialisateurJSON({methodeSerialisation:_ajouterActif});}
if(!!aParams.listeNaturesDocumentsAFournir){this.JSON.listeNaturesDocumentsAFournir.setSerialisateurJSON({methodeSerialisation:_ajouterNatureDocuments});}
return this.appelAsynchrone();}
actionApresRequete(){this.callbackReussite.appel();}}
Requetes.inscrire('SaisieCompteEnfant',ObjetRequeteSaisieCompteEnfant);function _ajouterNatureDocuments(aElement,aJSON){if(!!aElement.listePJ){aJSON.listePJ=aElement.listePJ;aJSON.listePJ.setSerialisateurJSON({methodeSerialisation:_serialiserFichier});}}
function _serialiserFichier(aElement,aJSON){aJSON.idFichier=aElement.idFichier;}
function _ajouterActif(aElement,aJSON){aJSON.Actif=aElement.Actif;}
module.exports=ObjetRequeteSaisieCompteEnfant;},fn:"objetrequetesaisiecompteenfant.js"});;
IE.fModule({f:function(exports,require,module,global){const GHtml=require('_ObjetHtml.js').GHtml;const GTraductions=require('ObjetTraduction.js');const ObjetInterfacePage=require('InterfacePage.js');const ObjetListeElements=require('ObjetListeElements.js');const EGenreRessource=require('Enumere_Ressource.js');const{TypeDroits}=require('ObjetDroitsPN.js');const EGenreEtat=require('Enumere_Etat.js');const TUtilitaireUrl=require('UtilitaireUrl.js');const GUID=require('GUID.js');const EGenreBoiteMessage=require('Enumere_BoiteMessage.js');const EGenreAction=require('Enumere_Action.js');const{GDate}=require('ObjetDate.js');const ObjetFenetre=require('ObjetFenetre.js');const ObjetFenetre_UploadFichiers=require('ObjetFenetre_UploadFichiers.js');require('espace/css/UtilitairePageDonneesPersonnelles.css');class InterfaceDocumentsAFournir extends ObjetInterfacePage{constructor(...aParams){super(...aParams);this.idLibelle=GUID.getId();this.idPiecesJointes=GUID.getId();this.idBoutonPJ=GUID.getId();this.donnees={listeNaturesDocument:null};}
getNatureDocument(aNumeroNatureDocument){let lNatureDocument=null;if(!!this.donnees.listeNaturesDocument){lNatureDocument=this.donnees.listeNaturesDocument.GetElementParNumero(aNumeroNatureDocument);}
return lNatureDocument;}
getControleur(aInstance){return $.extend(true,super.getControleur(aInstance),{btnAjoutDocument:{getDisabled:function(aNumeroNatureDocument){const lNatureDoc=aInstance.getNatureDocument(aNumeroNatureDocument);return!lNatureDoc||!lNatureDoc.avecDepotAutorise||(!!lNatureDoc.listePJ&&lNatureDoc.listePJ.GetNbrElementsExistes()===1);},event:function(aNumeroNatureDocument){afficherFenetreAjoutFichier.call(aInstance,aNumeroNatureDocument);}},getHtmlListeDocuments:function(aNumeroNatureDocument){const lDisplayPJ=[];const lNatureDoc=aInstance.getNatureDocument(aNumeroNatureDocument);if(!!lNatureDoc&&!!lNatureDoc.listePJ&&lNatureDoc.listePJ.GetNbrElements()>0){lDisplayPJ.push(TUtilitaireUrl.construireListeUrls(lNatureDoc.listePJ,{genreRessource:EGenreRessource.DocJointEleve,IEModelChips:(!!lNatureDoc.avecDepotAutorise?'chipsPieceJointe':''),argsIEModelChips:[lNatureDoc.GetNumero()]}));} else{lDisplayPJ.push('<span class="AucunDocument">',GTraductions.getValeur('PageCompte.AucunFichierNAEteJoint'),'</span>');}
return lDisplayPJ.join('');},chipsPieceJointe:{eventBtn:function(aIndice,aNumeroNatureDocument){const lNatureDoc=aInstance.getNatureDocument(aNumeroNatureDocument);if(!!lNatureDoc&&!!lNatureDoc.listePJ){const lDocumentJointASupp=lNatureDoc.listePJ.GetElement(aIndice);if(!!lDocumentJointASupp){GApplication.getMessage().afficher({type:EGenreBoiteMessage.Confirmation,message:GTraductions.getValeur('PageCompte.ConfirmationSuppression'),callback:function(aGenreAction){if(aGenreAction===EGenreAction.Valider){lDocumentJointASupp.SetEtat(EGenreEtat.Suppression);lNatureDoc.SetEtat(EGenreEtat.Modification);if(!GApplication.estPrimaire){aInstance.SetEtatSaisie(true);}}}});}}}}});}
ConstruireAffichage(){const H=[];if(!!this.donnees.listeNaturesDocument&&this.donnees.listeNaturesDocument.GetNbrElements()>0){H.push('<div class="ZoneListeDocumentsAFournir">');this.donnees.listeNaturesDocument.parcourir(function(aNatureDoc){H.push(_construitBlocNatureDocuments(aNatureDoc));});H.push('</div>');}
return H.join('');}
getListeFichiersAUpload(){let lListeFichiersAFournir=null;if(!!this.donnees.listeNaturesDocument&&this.donnees.listeNaturesDocument.existeElementPourValidation()){this.donnees.listeNaturesDocument.parcourir(function(aNatureDoc){if(!!aNatureDoc&&aNatureDoc.PourValidation()&&!!aNatureDoc.listePJ&&aNatureDoc.listePJ.existeElementPourValidation()){aNatureDoc.listePJ.parcourir(function(aDocumentEleve){if(!!aDocumentEleve&&aDocumentEleve.Etat===EGenreEtat.Creation){if(!lListeFichiersAFournir){lListeFichiersAFournir=new ObjetListeElements();}
lListeFichiersAFournir.AddElement(aDocumentEleve);}});}});}
return lListeFichiersAFournir;}
SetDonnees(aDonnees){this.donnees=aDonnees;GHtml.setHtml(this.Nom,this.ConstruireAffichage(),{controleur:this.controleur});}
getTitre(){const lStrEnfant=GEtatUtilisateur.getMembre().GetLibelle();return GTraductions.getValeur('infosperso.DocumentAFournir',[lStrEnfant]);}
declencherCallback(aParam){if(this.Pere&&this.Evenement){this.callback.appel(aParam);}}}
function afficherFenetreAjoutFichier(aNumeroNatureDocument){const lNatureDoc=this.getNatureDocument(aNumeroNatureDocument);if(!!lNatureDoc){const lThis=this;const lObjetFenetreAjoutMultiple=ObjetFenetre.creerInstance(ObjetFenetre_UploadFichiers,{pere:lThis,evenement:function(aGenreBouton,aListeFichiers){if(aGenreBouton===EGenreAction.Valider){if(!lNatureDoc.listePJ){lNatureDoc.listePJ=new ObjetListeElements();}
if(!!aListeFichiers&&aListeFichiers.GetNbrElements()>0){lNatureDoc.listePJ.AddElement(aListeFichiers.GetPremierElement());lNatureDoc.SetEtat(EGenreEtat.Modification);if(!GApplication.estPrimaire){lThis.SetEtatSaisie(true);}
lThis.declencherCallback();}}
lObjetFenetreAjoutMultiple.Fermer();}});lObjetFenetreAjoutMultiple.setDonnees(EGenreRessource.DocumentJoint,{tailleMaxUploadFichier:GApplication.droits.get(TypeDroits.tailleMaxDocJointEtablissement),functionGetNomPdfGenere:function(){const lLibelleUtilisateur=GEtatUtilisateur.getMembre().GetLibelle();return lLibelleUtilisateur+'_'+GDate.FormatDate(GDate.getDateHeureCourante(),'%JJ%MM%AAAA_%hh%mm%ss')+'.pdf';}});lObjetFenetreAjoutMultiple.afficher();}}
function _construitBlocNatureDocuments(aNatureDocument){const H=[];if(!!aNatureDocument){const lLibelleNatureDocument=[aNatureDocument.GetLibelle()];if(!!aNatureDocument.avecDepotAutorise&&!!aNatureDocument.dateLimiteDepot){const lStrDate=GDate.FormatDate(aNatureDocument.dateLimiteDepot,'%JJ/%MM/%AAAA');lLibelleNatureDocument.push(' (',GTraductions.getValeur('PageCompte.aJoindreJusquau',[lStrDate]),')');}
H.push('<div class="BlocNatureDocumentEleve">');H.push('<div class="LibelleNatureDocumentEleve">',lLibelleNatureDocument.join(''),'</div>');H.push('<div class="BlocListeDocuments" ie-html="getHtmlListeDocuments(\'',aNatureDocument.GetNumero(),'\')"></div>');if(!!aNatureDocument.avecDepotAutorise){H.push('<ie-bouton class="BoutonAjouterDocument" ie-model="btnAjoutDocument(\'',aNatureDocument.GetNumero(),'\')">','<i class="material-icons icon_download_alt"></i>','<span>',GTraductions.getValeur('PageCompte.JoindreUnFichier'),'</span>','</ie-bouton>');}
H.push('</div>');}
return H.join('');}
module.exports=InterfaceDocumentsAFournir;},fn:"interfacedocumentsafournir.js"});;
IE.fModule({f:function(exports,require,module,global){const ObjetDonneesListeFlatDesign=require('ObjetDonneesListeFlatDesign.js');const TypeFiltreAffichage=require('Enumere_DonneesPersonnelles.js').TypeFiltreAffichage;class DonneesListe_FiltreCompte extends ObjetDonneesListeFlatDesign{constructor(aDonnees){super(aDonnees);this.setOptions({avecEvnt_ModificationSelection:true,avecEvnt_SelectionClick:true,hauteurMinCellule:35,avecTri:false,avecEllipsis:false,avecContenuTronque:false,avecBoutonActionLigne:false});}
getIconeGaucheContenuFormate(aParams){let lIcon='';switch(aParams.article.GetGenre()){case TypeFiltreAffichage.securisation:lIcon='icon_lock';break;case TypeFiltreAffichage.coords:lIcon='icon_uniF2BD';break;case TypeFiltreAffichage.communication:lIcon='icon_fiche_cours_partage';break;case TypeFiltreAffichage.notification:lIcon='icon_papillon_notif';break;case TypeFiltreAffichage.deconnexion:lIcon='icon_ne_pas_deranger';break;case TypeFiltreAffichage.droitImage:lIcon='icon_camera';break;case TypeFiltreAffichage.profilPrimEnfant:lIcon='icon_user';break;case TypeFiltreAffichage.signature:lIcon='icon_signature';break;case TypeFiltreAffichage.style:lIcon='icon_pipette';break;case TypeFiltreAffichage.cahierDeTexte:lIcon='icon_saisie_cahier_texte';break;case TypeFiltreAffichage.generalites:lIcon='icon_wrench';break;default:lIcon='icon_user';}
return aParams.article.nonSelectionnable?'':lIcon;}
AvecSelection(I,D){return!D.nonSelectionnable;}
AvecEvenement_Selection(I,D,aParams){return!aParams.article.nonSelectionnable;}}
DonneesListe_FiltreCompte.getColonnes=function(){return[{taille:'100%'}];};module.exports=DonneesListe_FiltreCompte;},fn:"donneesliste_filtrecompte.js"});;
IE.fModule({f:function(exports,require,module,global){const ObjetFenetre=require('ObjetFenetre.js');const GTraductions=require('ObjetTraduction.js');const ObjetSaisieMotDePasseCP=require('ObjetSaisieMotDePasseCP.js');const GChaine=require('GChaine.js');class ObjetFenetre_SaisieMdpCP extends ObjetFenetre{constructor(...aParams){super(...aParams);this.setOptionsFenetre({titre:GChaine.Insecable(GTraductions.getValeur('saisieMDP.TitreFenetre')),listeBoutons:[
GTraductions.getValeur('Annuler'),{valider:true,libelle:GTraductions.getValeur('Valider')}
],avecTailleSelonContenu:true,largeur:300,optionsMDP:{forcerModificationMdp:false}});}
ConstruireInstances(){this.identMDP=this.Add(ObjetSaisieMotDePasseCP);}
ComposeContenu(){return['<div id="',this.GetInstance(this.identMDP).GetNom(),'"></div>'].join('');}
SetDonnees(aDonneesReglesMdp){this.Afficher();this.GetInstance(this.identMDP).setOptions(Object.assign(this.optionsFenetre.optionsMDP||{},{donneesReglesMdp:aDonneesReglesMdp,callbackFocusValidation:function(){this.setBoutonFocus({valider:true});}.bind(this),callbackApresValidation:function(aParams){if(aParams){this.Fermer();this.callback.appel(!aParams.avecErreur,aParams);}}.bind(this)})).SetDonnees();this.positionnerFenetre();}
getControleur(aInstance){return $.extend(true,super.getControleur(this),{fenetreBtn:{getDisabled:function(aBoutonRepeat){return aBoutonRepeat.element.valider?!aInstance.GetInstance(aInstance.identMDP).avecValidationPossible():false;}}});}
SurValidation(ANumeroBouton){const lBouton=this.getBoutonNumero(ANumeroBouton);if(lBouton&&lBouton.valider){this.GetInstance(this.identMDP).valider();} else{this.Fermer();this.callback.appel(false);}}}
module.exports=ObjetFenetre_SaisieMdpCP;},fn:"objetfenetre_saisiemdpcp.js"});;
IE.fModule({f:function(exports,require,module,global){const GChaine=require('GChaine.js');const GTraductions=require('ObjetTraduction.js');const ObjetFenetre_SaisieMdpCP=require('ObjetFenetre_SaisieMdpCP.js');const ObjetSaisieMotDePasseCP=require('ObjetSaisieMotDePasseCP.js');class ObjetFenetre_ModificationIdentifiantMDP extends ObjetFenetre_SaisieMdpCP{constructor(...aParams){super(...aParams);this.changementMDP=true;this.changementMDPEleve=false;}
SetDonnees(...aParams){this.setOptionsFenetre({titre:this.changementMDPEleve?GTraductions.getValeur('PageCompte.titreEcranMotDePasseEnfant'):this.changementMDP?GTraductions.getValeur('PageCompte.titreEcranMotDePasse'):GTraductions.getValeur('PageCompte.titreEcranIdentifiant')});const lOptions={avecMDPActuel:!this.changementMDPEleve,avecReglesMDP:this.changementMDP,avecMdpNouveauDifferentDeActuel:this.changementMDP&&!this.changementMDPEleve,setReglesMDP:function(aJSON){GEtatUtilisateur.setReglesSaisieMotDePasse(aJSON);},avecMessageReussiteModif:true,libelleMDPActuel:this.changementMDP?GTraductions.getValeur('PageCompte.libelle1EcranMotDePasse'):GTraductions.getValeur('PageCompte.libelle1EcranIdentifiant'),libelleNewMDP:this.changementMDP?this.changementMDPEleve?GTraductions.getValeur('PageCompte.libelle1EcranMotDePasseEleve'):GTraductions.getValeur('PageCompte.libelle2EcranMotDePasse'):GTraductions.getValeur('PageCompte.libelle2EcranIdentifiant')+'<br/>'+GChaine.Format(GTraductions.getValeur('PageCompte.conseil2EcranIdentifiant'),[ObjetSaisieMotDePasseCP.C_TailleMinLogin]),libelleConfirmNewMDP:this.changementMDPEleve?GTraductions.getValeur('PageCompte.libelle2EcranMotDePasseEleve'):this.changementMDP?GTraductions.getValeur('PageCompte.libelle3EcranMotDePasse'):GTraductions.getValeur('PageCompte.libelle3EcranIdentifiant'),libelleEchecModification:GTraductions.getValeur('saisieMDP.EchecModification'),libelleReussiteModification:GTraductions.getValeur('saisieMDP.ReussiteModification'),libelleConfirmationIncorrecte:this.changementMDP?GTraductions.getValeur('saisieMDP.ConfirmationIncorrecte'):GTraductions.getValeur('PageCompte.message3Identifiant')};if(!this.changementMDP){lOptions.attrInputNouveau='type="text" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" ie-textbrut';}
this.GetInstance(this.identMDP).setOptions(lOptions);super.SetDonnees(...aParams);}}
module.exports=ObjetFenetre_ModificationIdentifiantMDP;},fn:"objetfenetre_modificationidentifiantmdp.js"});;
IE.fModule({f:function(exports,require,module,global){const TypeComparaisonRessourcesCoursCDT={RessourcesCommunes:0,RessourcesIdentiques:1,AuMoins1EleveEnCommun:2};module.exports.TypeComparaisonRessourcesCoursCDT=TypeComparaisonRessourcesCoursCDT;},fn:"typecomparaisonressourcescourscdt.js"});;
IE.fModule({f:function(exports,require,module,global){const TypeOptionPublicationCDT={OPT_PublicationDebutCours:0,OPT_PublicationFinCours:1};module.exports.TypeOptionPublicationCDT=TypeOptionPublicationCDT;},fn:"typeoptionpublicationcdt.js"});;
IE.fModule({f:function(exports,require,module,global){const GStyle=require('GStyle.js');const GTraductions=require('ObjetTraduction.js');const EGenreEspace=require('Enumere_Espace.js');const EGenreTypeContenu=require('Enumere_DonneesPersonnelles.js').EGenreTypeContenu;const EGenreTelephone=require('Enumere_DonneesPersonnelles.js').EGenreTelephone;const EListeIds=require('Enumere_DonneesPersonnelles.js').EListeIds;const{TypeDroits}=require('ObjetDroitsPN.js');const{GDate}=require('ObjetDate.js');const EGenreCryptage=require('Enumere_Cryptage.js');const GCryptage=require('ObjetCryptage.js');const EGenreDestinataire=require('Enumere_DonneesPersonnelles.js').EGenreDestinataire;const ETypeSwitch=require('Enumere_DonneesPersonnelles.js').ETypeSwitch;const MethodesTableau=require('MethodesTableau.js');const GChaine=require('GChaine.js');const ObjetTri=require('ObjetTri.js');const UtilitaireProjetAccompagnement=require('UtilitaireProjetAccompagnement.js');const EGenreTriElement=require('Enumere_TriElement.js');const EGenreEvenementObjetSaisie=require('Enumere_EvenementObjetSaisie.js');const EGenreSaisie=require('Enumere_Saisie.js');const ObjetRequeteSecurisationComptePreference=require('ObjetRequeteSecurisationCompte.js').ObjetRequeteSecurisationComptePreference;const TypeCommandeSecurisationCompteHttp=require('TypeSecurisationCompte.js').TypeCommandeSecurisationCompteHttp;const ObjetFenetre_ModificationIdentifiantMDP=require('ObjetFenetre_ModificationIdentifiantMDP.js');const ObjetFenetre=require('ObjetFenetre.js');const ObjetListeElements=require('ObjetListeElements.js');const ObjetElement=require('ObjetElement.js');const TypeFiltreAffichage=require('Enumere_DonneesPersonnelles.js').TypeFiltreAffichage;const TypeHttpGenerationPDFSco=require('TypeHttpGenerationPDFSco.js').TypeHttpGenerationPDFSco;const GenerationPDF=require('utilitairegenerationpdf.js');const OptionsPdf=require('OptionsPDFSco.js');const EGenreBoiteMessage=require('Enumere_BoiteMessage.js');const tag=require('tag.js');const UtilitaireChangementLangue=require('UtilitaireChangementLangue.js');const TypeComparaisonRessourcesCoursCDT=require('TypeComparaisonRessourcesCoursCDT.js').TypeComparaisonRessourcesCoursCDT;const TypeOptionPublicationCDT=require('TypeOptionPublicationCDT.js').TypeOptionPublicationCDT;const ObjetFenetre_Liste=require('ObjetFenetre_Liste.js');const ObjetDonneesListeFlatDesign=require('ObjetDonneesListeFlatDesign.js');const ObjetListe=require('ObjetListe.js');const EGenreRessource=require('Enumere_Ressource.js');const MethodesObjet=require('MethodesObjet.js');const ObjetPreferenceAccessibilite=require('ObjetPreferenceAccessibilite.js');require('espace/css/UtilitairePageDonneesPersonnelles.css');function UtilitairePageDonneesPersonnelles(){}
UtilitairePageDonneesPersonnelles.construireZoneGenerique=function(aTitre,aTypeContenu,aParams){var H=[];H.push('<div class="item-conteneur" tabindex="0">');if(!!aTitre){H.push(`<h4>${aTitre}</h4>`);}
H.push(`<div class="valeur-contain">`);switch(aTypeContenu){case EGenreTypeContenu.Notifications:H.push(_construireNotifications(aParams.envoiMail,aParams.notificationMail,aParams.notificationMailTravaux,aParams.gestionMailTravaux));break;case EGenreTypeContenu.DroitImage:H.push(_construireDroitImage(aParams));break;case EGenreTypeContenu.Autorisations:H.push(_construireAutorisations(aParams));break;case EGenreTypeContenu.DerniereConnexion:H.push(_construireDerniereConnexion());break;case EGenreTypeContenu.MotDePasse:H.push(_construireMotDePasse(aParams));break;case EGenreTypeContenu.Identifiant:H.push(_construireIdentifiant(aParams));break;case EGenreTypeContenu.Coordonnees:H.push(_construireCoordonnees(aParams));break;case EGenreTypeContenu.InfosCompteEnfant:H.push(_construireInformationsCompteEnfant(aParams));break;case EGenreTypeContenu.INE:H.push(aParams.numeroINE);break;case EGenreTypeContenu.AutorisationSortie:H.push('<div id="'+aParams.identiteAutorisations+'"></div>');break;case EGenreTypeContenu.ProjetsAccompagnement:{const lAvecControlePublication=!MethodesTableau.existe(GEtatUtilisateur.GenreEspace,[EGenreEspace.Parent,EGenreEspace.Mobile_Parent]);H.push(_construireProjetsAccompagnement(aParams,lAvecControlePublication));break;}
case EGenreTypeContenu.Medecin:H.push(this.composeMedecin(aParams));break;case EGenreTypeContenu.Allergies:if(!GEtatUtilisateur.estEspaceMobile()){H.push('<div id="'+aParams.identiteInfosAllergies+'"></div>');}
break;case EGenreTypeContenu.Informations:H.push(_construireInformations(aParams));break;case EGenreTypeContenu.PreferencesContact:H.push(_construirePreferencesContact(aParams));break;case EGenreTypeContenu.AutorisationsSupplementaires:H.push(_construireAutorisationsSupp(aParams));break;case EGenreTypeContenu.AutorisationsMessages:H.push(_construireAutorisationsMessages(aParams));break;case EGenreTypeContenu.CommunicationParents:H.push(_construireCommunicationsParents(aParams));break;case EGenreTypeContenu.ContenuCommunicationParents:H.push(_construireContenuCommunicationsParents(aParams));break;case EGenreTypeContenu.DepotDocuments:H.push('<div class="WhiteSpaceNormal InlineBlock" id="'+aParams.identListeDocumentsAFournir+'"></div>');break;case EGenreTypeContenu.sourcesConnexions:H.push('<div id="',aParams.idSourcesConnexions,'"></div>');break;case EGenreTypeContenu.Signature:H.push(_construireSignature(aParams));break;case EGenreTypeContenu.Generalites:if(MethodesTableau.existe(GEtatUtilisateur.GenreEspace,[EGenreEspace.Professeur,EGenreEspace.Mobile_Professeur])){H.push(_construireGeneralitesProfesseur(aParams));}
if(MethodesTableau.existe(GEtatUtilisateur.GenreEspace,[EGenreEspace.Professeur,EGenreEspace.Etablissement])){H.push(`<h4>${GTraductions.getValeur('infosperso.CouleursDesCours')}</h4>`);H.push(_construireEDT(aParams));}
break;case EGenreTypeContenu.CahierDeTexte:if(MethodesTableau.existe(GEtatUtilisateur.GenreEspace,[EGenreEspace.Professeur])&&GApplication.droits.get(TypeDroits.fonctionnalites.gestionCDT)){H.push(_construireCDT(aParams));}
break;case EGenreTypeContenu.Deconnexion:H.push(tag('div',{'ie-identite':'getIdentiteMessagerie'}));break;case EGenreTypeContenu.Style:H.push(_construireAccessibilite(aParams));H.push(_construirePagePersonnalisation(aParams.controleur,{avecEventFermeture:true}));break;}
H.push('</div>');H.push('</div>');return H.join('');};UtilitairePageDonneesPersonnelles.getControleur=function(aInstance){var avecSaisieCoordonnees=GApplication.droits.get(TypeDroits.compte.avecSaisieInfosPersoCoordonnees);var lControleur={tel:{getValue:function(aChamp){return this.instance.donnees.Informations[aChamp];},setValue:function(aChamp,aValue){this.instance.donnees.Informations[aChamp]=aValue;if(aChamp==='telephonePortable'){this.instance.donnees.Autorisations.SMSAutorise=(aValue!=='')&&this.instance.donnees.Autorisations.SMSAutorise;}},getDisabled:function(){return!GApplication.droits.get(TypeDroits.compte.avecSaisieInfosPersoCoordonnees);}},CBDiscussionAvecParents:{getValue:function(){return this.instance.donnees.Autorisations.optionCommunicationActivationdiscussion;},setValue:function(aValue){this.instance.donnees.Autorisations.optionCommunicationActivationdiscussion=aValue;GEtatUtilisateur.Identification.ressource.avecDiscussionResponsables=aValue;this.instance.SetEtatSaisie(true);},getDisabled:function(){return(false);}},CBCommuniquerMail:{getValue:function(){return this.instance.donnees.Autorisations.optionCommunicationPublicationMail;},setValue:function(aValue){this.instance.donnees.Autorisations.optionCommunicationPublicationMail=aValue;this.instance.SetEtatSaisie(true);},getDisabled:function(){return(false);}},indFixeMedecin:{getValue:function(){return this.instance.donnees.infosMedicales.medecin['indFixe'];},setValue:function(aValue){this.instance.donnees.infosMedicales.medecin['indFixe']=aValue;this.instance.SetEtatSaisie(true);}},telFixeMedecin:{getValue:function(){return this.instance.donnees.infosMedicales.medecin['telFixe'];},setValue:function(aValue){this.instance.donnees.infosMedicales.medecin['telFixe']=aValue;this.instance.SetEtatSaisie(true);}},indPortMedecin:{getValue:function(){return this.instance.donnees.infosMedicales.medecin['indMobile'];},setValue:function(aValue){this.instance.donnees.infosMedicales.medecin['indMobile']=aValue;this.instance.SetEtatSaisie(true);}},telPortMedecin:{getValue:function(){return this.instance.donnees.infosMedicales.medecin['telMobile'];},setValue:function(aValue){this.instance.donnees.infosMedicales.medecin['telMobile']=aValue;this.instance.SetEtatSaisie(true);}},nomMedecin:{getValue:function(){return this.instance.donnees.infosMedicales.medecin['nomMedecin'];},setValue:function(aValue){this.instance.donnees.infosMedicales.medecin['nomMedecin']=aValue;this.instance.SetEtatSaisie(true);}},adresse1Medecin:{getValue:function(){return this.instance.donnees.infosMedicales.medecin['adresse1'];},setValue:function(aValue){this.instance.donnees.infosMedicales.medecin['adresse1']=aValue;this.instance.SetEtatSaisie(true);}},adresse2Medecin:{getValue:function(){return this.instance.donnees.infosMedicales.medecin['adresse2'];},setValue:function(aValue){this.instance.donnees.infosMedicales.medecin['adresse2']=aValue;this.instance.SetEtatSaisie(true);}},CPMedecin:{getValue:function(){return this.instance.donnees.infosMedicales.medecin['codePostal'];},setValue:function(aValue){this.instance.donnees.infosMedicales.medecin['codePostal']=aValue;this.instance.SetEtatSaisie(true);}},VilleMedecin:{getValue:function(){return this.instance.donnees.infosMedicales.medecin['libellePostal'];},setValue:function(aValue){this.instance.donnees.infosMedicales.medecin['libellePostal']=aValue;this.instance.SetEtatSaisie(true);}},libellePreferencesContact:{getLibelle:function(){var libelle=[];if(this.instance.donnees.Autorisations.SMSAutorise){libelle.push(GTraductions.getValeur('infosperso.SMS'));}
if(this.instance.donnees.Autorisations.emailAutorise){var lTexteEmail=GTraductions.getValeur('infosperso.Email');}
if(this.instance.donnees.Autorisations.eMailEtablissementAutorise!==null&&this.instance.donnees.Autorisations.eMailParentAutorise!==null&&((GEtatUtilisateur.GenreEspace!==EGenreEspace.Parent)&&(GEtatUtilisateur.GenreEspace!==EGenreEspace.Mobile_Parent))){var libelleDetails=[];if(this.instance.donnees.Autorisations.eMailEtablissementAutorise){libelleDetails.push(GTraductions.getValeur('infosperso.EmailEtablissement').toLowerCase());}
if(this.instance.donnees.Autorisations.eMailParentAutorise){libelleDetails.push(GTraductions.getValeur('infosperso.EMailParents').toLowerCase());}
if(this.instance.donnees.Autorisations.eMailEtablissementAutorise||this.instance.donnees.Autorisations.eMailParentAutorise){lTexteEmail+=(' ('+libelleDetails.join(', ')+')');}}
if(this.instance.donnees.Autorisations.emailAutorise){libelle.push(lTexteEmail);}
if(this.instance.donnees.Autorisations.courrierPapierAutorise){libelle.push(GTraductions.getValeur('infosperso.Papier'));}
return libelle.join(', ');}},libelleCommunicationParents:{getLibelle:function(){var libelle=[];if(this.instance.donnees.Autorisations.optionCommunicationActivationdiscussion){libelle.push(GTraductions.getValeur('infosperso.communiquerEmail'));}
if(this.instance.donnees.Autorisations.optionCommunicationPublicationMail){libelle.push(GTraductions.getValeur('infosperso.discussionsAvecParents'));}
return libelle.join(', ');}},libelleInformations:{getLibelle:function(){var libelle=[];if(this.instance.donnees.Autorisations.estDestinataireInfosGenerales){libelle.push(GTraductions.getValeur('infosperso.titreInfosGen'));}
for(var i=0;i<this.instance.donnees.Autorisations.listeEleves.GetNbrElements();i++){var lEleve=this.instance.donnees.Autorisations.listeEleves.GetElement(i);var libellesEleve=[];libelle.push('<div> ');libelle.push(lEleve.GetLibelle()+' : ');if(lEleve.estDestinataireBulletin){libellesEleve.push(GTraductions.getValeur('infosperso.titreBulletin'));}
if(lEleve.estDestinataireInfosEleve){libellesEleve.push(GTraductions.getValeur('infosperso.titreInfosEleve'));}
if(lEleve.estDestinataireInfosProfesseur){libellesEleve.push(GTraductions.getValeur('infosperso.titreInfosProf'));}
libelle.push(libellesEleve.join(', '));libelle.push('</div>');}
return libelle.join('');}},eMail:{getValue:function(){return this.instance.donnees.Informations.eMail;},setValue:function(aChamp,aValue){this.instance.donnees.Informations.eMail=aValue.value;this.instance.donnees.Autorisations.emailAutorise=(aValue.value!=='');this.instance.SetEtatSaisie(true);}},cbEmailReserveAdministration:{getValue:function(){return this.instance.donnees.Informations.emailReserveAdmin;},setValue:function(aValue){this.instance.donnees.Informations.emailReserveAdmin=aValue;if(!!aValue){this.instance.donnees.Autorisations.eMailParentAutorise=false;}
this.instance.SetEtatSaisie(true);}},cbTelReserveAdministration:{getValue:function(){return this.instance.donnees.Informations.telReserveAdmin;},setValue:function(aValue){this.instance.donnees.Informations.telReserveAdmin=aValue;this.instance.SetEtatSaisie(true);}},switchNotification:{getValue:function(){return this.instance.donnees.notifications.notificationMail;},setValue:function(aValue){this.instance.donnees.notifications.notificationMail=aValue;this.instance.SetEtatSaisie(true);}},switchNotificationTravaux:{getValue:function(){return this.instance.donnees.notifications.notificationMailTravaux;},setValue:function(aValue){this.instance.donnees.notifications.notificationMailTravaux=aValue;this.instance.SetEtatSaisie(true);}},switchAutoriserImage:{getValue:function(){return!this.instance.donnees.droitImage.autoriser;},setValue:function(aValue){this.instance.donnees.droitImage.autoriser=!aValue;this.instance.SetEtatSaisie(true);}},switchAutoriserSignature:{getValue:function(){return!this.instance.donnees.Signature.autoriser;},setValue:function(aValue){this.instance.donnees.Signature.autoriser=!aValue;this.instance.Valider();},getDisabled:function(){return!this.instance.donnees.Signature.logo;}},switchSMSAutorise:{getValue:function(){return this.instance.donnees.Autorisations.SMSAutorise;},setValue:function(aValue){this.instance.donnees.Autorisations.SMSAutorise=aValue;this.instance.SetEtatSaisie(true);UtilitairePageDonneesPersonnelles.swapClass(EGenreDestinataire.SMS,aValue);},getDisabled:function(){return!(this.instance.donnees.Informations['telephonePortable']&&avecSaisieCoordonnees);}},switchEmailAutorise:{getValue:function(){return this.instance.donnees.Autorisations.emailAutorise;},setValue:function(aValue){this.instance.donnees.Autorisations.emailAutorise=aValue;if(!aValue){this.instance.donnees.Autorisations.eMailEtablissementAutorise=false;this.instance.donnees.Autorisations.eMailParentAutorise=false;}
this.instance.SetEtatSaisie(true);UtilitairePageDonneesPersonnelles.swapClass(EGenreDestinataire.Email,aValue);},getDisabled:function(){return!avecSaisieCoordonnees||!this.instance.donnees.Informations.eMail;}},switchEmailEtablissementAutorise:{getValue:function(){return this.instance.donnees.Autorisations.eMailEtablissementAutorise;},setValue:function(aValue){this.instance.donnees.Autorisations.eMailEtablissementAutorise=aValue;this.instance.SetEtatSaisie(true);},getDisabled:function(){return!(this.instance.donnees.Autorisations.emailAutorise&&avecSaisieCoordonnees);}},switchEmailParentAutorise:{getValue:function(){return this.instance.donnees.Autorisations.eMailParentAutorise;},setValue:function(aValue){this.instance.donnees.Autorisations.eMailParentAutorise=aValue;this.instance.SetEtatSaisie(true);},getDisabled:function(){return!(this.instance.donnees.Autorisations.emailAutorise&&avecSaisieCoordonnees&&!this.instance.donnees.Informations.emailReserveAdmin);}},switchCourrierPapierAutorise:{getValue:function(){return this.instance.donnees.Autorisations.courrierPapierAutorise;},setValue:function(aValue){this.instance.donnees.Autorisations.courrierPapierAutorise=aValue;this.instance.SetEtatSaisie(true);UtilitairePageDonneesPersonnelles.swapClass(EGenreDestinataire.Courrier,aValue);},getDisabled:function(){return!avecSaisieCoordonnees;}},switchMsg:{getValue(aIdent){return this.instance.donnees.Autorisations[aIdent];},setValue(aIdent,aValue){this.instance.donnees.Autorisations[aIdent]=aValue;this.instance.SetEtatSaisie(true);},getDisabled(){return!avecSaisieCoordonnees;}},btnMsgPublicMsg:{event(){_btnPublicMsg(this.instance);}},getHtmlBtnMsgPublicMsg(){let lNbCoches=0;this.instance.donnees.Autorisations.msgListePublics.parcourir((aArticle) =>{if(aArticle.estCoche){lNbCoches+=1;}});if(lNbCoches===0){return GTraductions.getValeur('infosperso.Tout');}
return`${lNbCoches}\\${this.instance.donnees.Autorisations.msgListePublics.GetNbrElements()}`;},switchMsgVieScolaire:{getValue:function(){return this.instance.donnees.Autorisations.estContactVS;},setValue:function(aValue){this.instance.donnees.Autorisations.estContactVS=aValue;this.instance.SetEtatSaisie(true);}},switchBulletin:{getValue:function(aChamp){return this.instance.donnees.Autorisations.listeEleves.GetElement(aChamp).estDestinataireBulletin;},setValue:function(aChamp,aValue){this.instance.donnees.Autorisations.listeEleves.GetElement(aChamp).estDestinataireBulletin=aValue;this.instance.SetEtatSaisie(true);},getDisabled:function(){return(!this.instance.donnees.Autorisations.emailAutorise&&!this.instance.donnees.Autorisations.courrierPapierAutorise);}},switchInfosEleve:{getValue:function(aChamp){return this.instance.donnees.Autorisations.listeEleves.GetElement(aChamp).estDestinataireInfosEleve;},setValue:function(aChamp,aValue){this.instance.donnees.Autorisations.listeEleves.GetElement(aChamp).estDestinataireInfosEleve=aValue;this.instance.SetEtatSaisie(true);},getDisabled:function(){return(!this.instance.donnees.Autorisations.emailAutorise&&
!this.instance.donnees.Autorisations.SMSAutorise&&
!this.instance.donnees.Autorisations.courrierPapierAutorise);}},switchInfosProfs:{getValue:function(aChamp){return this.instance.donnees.Autorisations.listeEleves.GetElement(aChamp).estDestinataireInfosProfesseur;},setValue:function(aChamp,aValue){this.instance.donnees.Autorisations.listeEleves.GetElement(aChamp).estDestinataireInfosProfesseur=aValue;this.instance.SetEtatSaisie(true);},getDisabled:function(){return(!this.instance.donnees.Autorisations.emailAutorise);}},switchInfosGen:{getValue:function(){return this.instance.donnees.Autorisations.estDestinataireInfosGenerales;},setValue:function(aValue){this.instance.donnees.Autorisations.estDestinataireInfosGenerales=aValue;this.instance.SetEtatSaisie(true);},getDisabled:function(){return(!this.instance.donnees.Autorisations.emailAutorise&&
!this.instance.donnees.Autorisations.SMSAutorise&&
!this.instance.donnees.Autorisations.courrierPapierAutorise);}},delaiNotif:{init:function(aCombo){aCombo.setOptions_ObjetSaisie({mode:EGenreSaisie.Combo,longueur:40,avecOuvertureDeroulantModale:(IE.estMobile?true:false),iconeGauche:'icon_time',deroulerListeSeulementSiPlusieursElements:false,initAutoSelectionAvecUnElement:false});this.instance.combo=aCombo;},getDonnees:function(){return this.instance.listeDelais;},getIndiceSelection:function(){var indice=0;for(var i=0;i<this.instance.listeDelais.GetNbrElements();i++){if(this.instance.listeDelais.GetElement(i).Numero===this.instance.donnees.notifications.delaiNotification){indice=i;}}
return indice;},event:function(aParametres){if(aParametres.genreEvenement===EGenreEvenementObjetSaisie.selection){const lDelai=this.instance.listeDelais.GetElement(aParametres.indice).Numero;if(this.instance.donnees.notifications.delaiNotification!==lDelai){this.instance.donnees.notifications.delaiNotification=lDelai;this.instance.SetEtatSaisie(true);}}}},estConsultable:{getValue:function(){return this.instance.donnees.infosMedicales.estConsultable;},setValue:function(aValue){this.instance.donnees.infosMedicales.estConsultable=aValue;this.instance.Valider();}},autoriseConsultationAllergies:{getValue:function(){return this.instance.donnees.allergies.autoriseConsultationAllergies;},setValue:function(aValue){this.instance.donnees.allergies.autoriseConsultationAllergies=aValue;this.instance.Valider();}},autoriseHospitalisation:{getValue:function(){return this.instance.donnees.infosMedicales.autoriseHospitalisation;},setValue:function(aValue){this.instance.donnees.infosMedicales.autoriseHospitalisation=aValue;this.instance.Valider();}},delaiNotifTravaux:{init:function(aCombo){aCombo.setOptions_ObjetSaisie({mode:EGenreSaisie.Combo,longueur:40,avecOuvertureDeroulantModale:(IE.estMobile?true:false),iconeGauche:'icon_time',deroulerListeSeulementSiPlusieursElements:false,initAutoSelectionAvecUnElement:false});this.instance.combo=aCombo;},getDonnees:function(){return this.instance.listeDelais;},getIndiceSelection:function(){var indice=0;for(var i=0;i<this.instance.listeDelais.GetNbrElements();i++){if(this.instance.listeDelais.GetElement(i).Numero===this.instance.donnees.notifications.delaiNotificationTravaux){indice=i;}}
return indice;},event:function(aParametres){if(aParametres.genreEvenement===EGenreEvenementObjetSaisie.selection){if(this.instance.donnees.notifications.delaiNotificationTravaux!==this.instance.listeDelais.GetElement(aParametres.indice).Numero){this.instance.SetEtatSaisie(true);}
this.instance.donnees.notifications.delaiNotificationTravaux=this.instance.listeDelais.GetElement(aParametres.indice).Numero;}}},btnImpressionAmenagements:{event:function(aNumProjet){var lProjet=this.instance.donnees.listeProjets.GetElementParNumeroEtGenre(aNumProjet);GenerationPDF.genererPDF({paramPDF:{genreGenerationPDF:TypeHttpGenerationPDFSco.ProjetAccompagnementPerso,projet:lProjet},optionsPDF:OptionsPdf.defaut});},getTitleBouton:function(){return GTraductions.getValeur('GenerationPDF.Etiquettes.ImpressionDEtiquettes');},getDisabled:function(){return false;}},btnUpload:{getOptionsSelecFile:function(){return{maxSize:this.instance.donnees.Signature.tailleMax,maxFiles:1,avecResizeImage:true,largeurMaxImageResize:this.instance.donnees.Signature.largeurMax,hauteurMaxImageResize:this.instance.donnees.Signature.hauteurMax,accept:'image/*'};},addFiles:function(aParametres){if(!!aParametres.eltFichier){this.instance.donnees.Signature.estSupprimee=false;this.instance.donnees.Signature.fichier=aParametres.eltFichier;this.instance.SetEtatSaisie(true);this.instance.Valider();}}},btnSupprimerUpload:{event:function(){GApplication.getMessage().afficher({type:EGenreBoiteMessage.Confirmation,message:GTraductions.getValeur('infosperso.msgSupprimerSignature'),callback:function(aBouton){if(aBouton===0){this.instance.donnees.Signature.estSupprimee=true;this.instance.SetEtatSaisie(true);this.instance.Valider();}}.bind(this)});}},getIdentiteAccessibilite:function(){return{class:ObjetPreferenceAccessibilite,pere:aInstance};},nodePhoto:function(){$(this.node).on('error',function(){$(this).closest('div').append('<i class="icone-alternative icon_uniF2BD"></i>');$(this).remove();});}};return lControleur;};function _construireProjetsAccompagnement(aParams,aAvecControlePublication){var H=[];H.push('<div class="WhiteSpaceNormal InlineBlock">');if(!!aParams.listeProjets){aParams.listeProjets.setTri([ObjetTri.init('estActif')]);aParams.listeProjets.trier(EGenreTriElement.Decroissant);H.push(UtilitaireProjetAccompagnement.composeListeProjetsAccompagnement(aParams.listeProjets,{avecLibelleConsultationEquipePeda:true,avecControlePublication:!!aAvecControlePublication}));}
H.push('</div>');return H.join('');}
function _construirePreferencesContact(aParams){var H=[];H.push('<div id="',aParams.id,'" class="WhiteSpaceNormal InlineBlock">');H.push('<div ie-model="libellePreferencesContact" class="Texte9" ie-html="getLibelle"></div>');H.push('</div>');return H.join('');}
function _construireInformations(aParams){var H=[];H.push('<div id="',aParams.id,'" class="WhiteSpaceNormal InlineBlock">');H.push('<div ie-model="libelleInformations"  ie-html="getLibelle"></div>');H.push('</div>');return H.join('');}
function _construireContenuCommunicationsParents(aParams){var H=[];H.push('<div id="',aParams.id,'" class="WhiteSpaceNormal InlineBlock">');H.push('<div ie-model="libelleCommunicationParents" class="Texte9" ie-html="getLibelle"></div>');H.push('</div>');return H.join('');}
UtilitairePageDonneesPersonnelles.composeMedecin=function(){var lLargeurIndicatif=36,lLargeurTel=110;var lHTML=[];lHTML.push(`<h5>${GTraductions.getValeur('InfosMedicales.MedecinTraitant')}</h5>\n              <div class="item-contain">\n                <div class="item-value">\n                  <label for="idNom" class="ie-titre-petit">${GTraductions.getValeur('InfosMedicales.NomMedecin')}</label>\n                  <input type="text" id="idNom" name="idNom" title="${GTraductions.getValeur('InfosMedicales.TitreNom')}" placeholder="${GTraductions.getValeur('InfosMedicales.TitreNom')}" ie-model="nomMedecin" size="50" maxlength="50" class="round-style" tabIndex="0" />\n              </div>\n              </div>\n              <div class="item-contain">\n              <div class="item-value">\n                  <label for="idAdresse1" class="ie-titre-petit">${GTraductions.getValeur('InfosMedicales.adresse1')}</label>\n                  <input type="text" id="idAdresse1"  title="${GTraductions.getValeur('InfosMedicales.adresse1')}" size="50" maxlength="50" class="round-style" ie-model="adresse1Medecin" tabIndex="0" />\n                  </div>\n              </div>\n\n              <div class="item-contain">\n              <div class="item-value">\n                <label for="idAdresse2" class="ie-titre-petit">${GTraductions.getValeur('InfosMedicales.adresse2')}</label>\n\n                  <input type="text" id="idAdresse2"  title="${GTraductions.getValeur('InfosMedicales.adresse2')}" size="50" maxlength="50" class="round-style" ie-model="adresse2Medecin" tabIndex="0" />\n                </div>\n              </div>\n\n              <div class="item-contain">\n              <div class="item-value">\n                <label for="idCpMedecin" class="ie-titre-petit">${GTraductions.getValeur('InfosMedicales.cpVille')}</label>\n                  <div class="flex-contain as-input">\n                    <input type="text" id="idCpMedecin" maxlength="8" title="${GTraductions.getValeur('InfosMedicales.CodePostal')}" ie-model="CPMedecin" tabIndex="0"  style="width: 6.5rem; margin-right:.4rem" />\n                    <span class="avec-separateur"></span>\n                    <input type="text"  title="${GTraductions.getValeur('InfosMedicales.Ville')}" ie-model="VilleMedecin" tabIndex="0"  style="${GStyle.composeWidth(lLargeurTel)}" />\n                  </div>\n                </div>\n            </div>\n\n            <div class="item-contain icon_home" title="${GTraductions.getValeur('InfosMedicales.Telephone')}">\n              <div class="item-value">\n                <div class="flex-contain">\n                  <input ie-model="indFixeMedecin" class="round-style m-right " ie-indicatiftel  style="${GStyle.composeWidth(lLargeurIndicatif)}; margin-right:.4rem" type="text" title="${GTraductions.getValeur('InfosMedicales.TitreTelephone')}" tabIndex="0"/>\n\n                  <input ie-model="telFixeMedecin" class="round-style" ie-telephone  style="${GStyle.composeWidth(lLargeurTel)}" type="text" title="${GTraductions.getValeur('InfosMedicales.TitreTelephone')}" tabIndex="0" />\n                </div>\n              </div>\n            </div>\n\n            <div class="item-contain icon_mobile_phone" title="${GTraductions.getValeur('infosperso.SMS')}">\n            <div class="item-value">\n              <div class="flex-contain">\n                <input ie-model="indPortMedecin" class="round-style m-right " ie-indicatiftel  style="${GStyle.composeWidth(lLargeurIndicatif)}; margin-right:.4rem" type="text" title="${GTraductions.getValeur('infosperso.SMS')}" tabIndex="0"/>\n\n                <input ie-model="telPortMedecin" class="round-style" ie-telephone  style="${GStyle.composeWidth(lLargeurTel)}" type="text" title="${GTraductions.getValeur('infosperso.SMS')}" tabIndex="0" />\n              </div>\n            </div>\n          </div>\n  `);lHTML.push('<div class="switch-contain">',UtilitairePageDonneesPersonnelles.composerSwitch(EListeIds.cbAutoriserHospitalisation,GTraductions.getValeur('infosperso.autoriserHospitalisation'),true,'autoriseHospitalisation'),'</div>');return lHTML.join('');};function _construireCoordonnees(aParams){var H=[],lTab;let lSrcPhoto;let lIndividu=GEtatUtilisateur.getUtilisateur();if(!!lIndividu&&!MethodesTableau.existe(lIndividu.GetGenre(),[EGenreRessource.Responsable,EGenreRessource.ResponsablePostulant,EGenreRessource.MaitreDeStage,EGenreRessource.InspecteurPedagogique])){lSrcPhoto=GChaine.composeUrl_ImgPhotoIndividu(lIndividu);}
H.push(`<div class="bloc-identite">`);lTab=[];if(aParams.civilite){lTab.push(aParams.civilite);}
if(aParams.nom){lTab.push(aParams.nom);}
if(aParams.prenoms){lTab.push(aParams.prenoms);}
H.push(`${(!!lSrcPhoto?`<div class="photo-contain"><img ie-load-src="${lSrcPhoto}" ie-imgviewer alt="${GTraductions.getValeur('PhotoDe_S',[lTab.join(' ')])}" ie-node="nodePhoto()"/></div>`:`<i class="icone-alternative icon_uniF2BD"></i>`)}`);if(lTab.length>0){H.push('<div class="info-principale">',lTab.join(' '),'</div>');}
if(aParams.avecInfosEntreprise){if(aParams.entreprise){H.push('<div class="info-principale">',aParams.entreprise.GetLibelle(),'</div>',!!aParams.entreprise.nomCommercial?'<div class="info-secondaire">'+aParams.entreprise.nomCommercial+'</div>':'');}
if(aParams.fonction){H.push('<div class="info-secondaire">',aParams.fonction.GetLibelle(),'</div>');}}
lTab=[];if(aParams.adresse1){lTab.push(aParams.adresse1);}
if(aParams.adresse2){lTab.push(aParams.adresse2);}
if(aParams.adresse3){lTab.push(aParams.adresse3);}
if(aParams.adresse4){lTab.push(aParams.adresse4);}
if(aParams.codePostal||aParams.ville){lTab.push(aParams.codePostal+' '+aParams.ville);}
if(aParams.province){lTab.push(aParams.province);}
if(aParams.pays){lTab.push(aParams.pays);}
H.push('<div class="info-secondaire">',lTab.join('<br/>'),'</div>');H.push(_composeZoneTelephone.bind(this)(aParams));H.push('</div>');return H.join('');}
function _composeZoneTelephone(aParams){var H=[];if(aParams.avecTelFixe){H.push(_composeTelephone.bind(this)(aParams,EGenreTelephone.telFixe));}
H.push(_composeTelephone.bind(this)(aParams,EGenreTelephone.telPort));if(aParams.avecTelFax){H.push(_composeTelephone.bind(this)(aParams,EGenreTelephone.fax));}
H.push(_composeEmail.bind(this)(aParams));return H.join('');}
function _composeTelephone(aParams,aGenre){var H=[],lIndicatif='',lTel='',lClassIcone='',lTitleImage;let lTitleChamps;let lTitleChampsIndicatif;let lPlaceholderChamps;switch(aGenre){case EGenreTelephone.telFixe:lTel='telephoneFixe';lIndicatif='indicatifFixe';lClassIcone='icon_home';lTitleImage=GTraductions.getValeur('infosperso.telephoneFixe');lTitleChamps=GTraductions.getValeur('infosperso.infoTelephoneFixe');lTitleChampsIndicatif=GTraductions.getValeur('infosperso.infoTelephoneFixe_indicatif');break;case EGenreTelephone.telPort:lTel='telephonePortable';lIndicatif='indicatifTel';lClassIcone='icon_mobile_phone';lTitleImage=GTraductions.getValeur('infosperso.SMS');lTitleChamps=GTraductions.getValeur('infosperso.infoSMS');lTitleChampsIndicatif=GTraductions.getValeur('infosperso.infoSMS_indicatif');break;case EGenreTelephone.fax:lTel='fax';lIndicatif='indicatifFax';lClassIcone='icon_tel_fax';lTitleImage=GTraductions.getValeur('infosperso.fax');lTitleChamps=GTraductions.getValeur('infosperso.infoFax');lTitleChampsIndicatif=GTraductions.getValeur('infosperso.infoFax_indicatif');break;}
if(!GApplication.droits.get(TypeDroits.compte.avecSaisieInfosPersoCoordonnees)&&!lIndicatif&&!lTel){return;}
const lAvecCbReserveAdmin=MethodesTableau.existe(GEtatUtilisateur.GenreEspace,[EGenreEspace.Etablissement,EGenreEspace.Mobile_Etablissement,EGenreEspace.Professeur,EGenreEspace.Mobile_Professeur]);const lDroitsModif=GApplication.droits.get(TypeDroits.compte.avecSaisieInfosPersoCoordonnees)&&lAvecCbReserveAdmin;H.push(`<div class="item-contain ${lClassIcone}" title="${lTitleImage}">`);H.push(`<div class="item-value">\n            <div class="flex-contain ">\n              <input ie-model="tel('${lIndicatif}')" class="round-style m-right " ie-indicatiftel ie-etatsaisie  style="${GStyle.composeWidth(aParams.largeurIndicatif)};margin-right:.4rem" type="text" ${lTitleChampsIndicatif?`aria-label="${lTitleChampsIndicatif}" title="${lTitleChampsIndicatif}"`:''} tabIndex="0"/>\n              <input ie-model="tel('${lTel}')" class="round-style" ie-telephone ie-etatsaisie style="${GStyle.composeWidth(aParams.largeurTel)}" type="text" ${lPlaceholderChamps?` placeholder="${lPlaceholderChamps}"`:''} ${lTitleChamps?`aria-label="${lTitleChamps}" title="${lTitleChamps}" `:''} tabIndex="0" />\n            </div>`);if(lDroitsModif){H.push(`<ie-checkbox ie-model="cbTelReserveAdministration">${GTraductions.getValeur('infosperso.reserveAdministration')}</ie-checkbox>`);}
H.push(`</div>`);H.push(`</div>`);return H.join('');}
function _composeEmail(aParams){var H=[];if(!GApplication.droits.get(TypeDroits.compte.avecSaisieInfosPersoCoordonnees)&&!aParams.eMail){return;}
var lAvecCbReserveAdmin=MethodesTableau.existe(GEtatUtilisateur.GenreEspace,[EGenreEspace.Etablissement,EGenreEspace.Mobile_Etablissement,EGenreEspace.Professeur,EGenreEspace.Mobile_Professeur]);const lDroitsModif=GApplication.droits.get(TypeDroits.compte.avecSaisieInfosPersoCoordonnees)&&lAvecCbReserveAdmin;H.push(`<div class="item-contain icon_arobase ${lDroitsModif?` flex-start`:` flex-center`} ">`);if(GApplication.droits.get(TypeDroits.compte.avecSaisieInfosPersoCoordonnees)){H.push(`<div class="item-value">`);H.push(`<input class="round-style"  ${IE.estMobile?'':`style="${GStyle.composeWidth(aParams.largeurEmail)}"`} type="text" ie-model="eMail" maxlength="255" id="${EListeIds.email}" placeholder="${GTraductions.getValeur('infosperso.infoEmail')}" value="${aParams.eMail||''}" aria-label="${GTraductions.getValeur('infosperso.infoEmail')}" title="${GTraductions.getValeur('infosperso.infoEmail')}" tabIndex="0" />`);if(lAvecCbReserveAdmin){H.push(`<ie-checkbox ie-model="cbEmailReserveAdministration">${GTraductions.getValeur('infosperso.reserveAdministration')}</ie-checkbox>`);}
H.push(`</div>`);} else{if(aParams.eMail){H.push('<div class="item-value"><span>',aParams.eMail||'','</span></div>');}}
H.push(`</div>`);return H.join('');}
function _construireInformationsCompteEnfant(aParams){var H=[];H.push(`<div class="texte-contain">\n            <p>${GTraductions.getValeur('PageCompte.MsgEnfant1')}</p>\n            <p>${GTraductions.getValeur('PageCompte.MsgEnfant2')}</p>\n          </div>`);H.push(`<div class="item-conteneur-inner">\n            <h4 >${GTraductions.getValeur('PageCompte.Identifiant')} :</h4>\n            <div class=valeur-contain">\n              <div class="flex-contain flex-center justify-between">\n                <div class="libelle-identification">${aParams.identifiant}</div>\n              </div>\n            </div>\n          </div>`);H.push(`<div class="item-conteneur-inner no-line">\n          <h4>${GTraductions.getValeur('PageCompte.MotDePasse')} :</h4>\n          <div class=valeur-contain">\n            <div class="flex-contain flex-center justify-between">\n              <div class="libelle-identification mdp">${aParams.informationsCompteMotDePasse}</div>\n              <ie-bouton id="${EListeIds.mdpEnfant}" tabindex="0">${GTraductions.getValeur('PageCompte.Modifier')}</ie-bouton>\n            </div>\n          </div>\n        </div>`);return H.join('');}
function _construireNotifications(aMailActif,aNotificationMail,aNotificationMailTravaux,aGestionMailTravaux){var H=[];if(aMailActif){H.push('<div class="notifications-contain">');var lGenreEspaceConcernes=[EGenreEspace.Etablissement,EGenreEspace.Mobile_Etablissement,EGenreEspace.Administrateur,EGenreEspace.Mobile_Administrateur,EGenreEspace.Professeur,EGenreEspace.PrimProfesseur,EGenreEspace.Mobile_Professeur,EGenreEspace.Mobile_PrimProfesseur,EGenreEspace.Accompagnant,EGenreEspace.PrimAccompagnant,EGenreEspace.Tuteur,EGenreEspace.Mobile_Tuteur,EGenreEspace.Mobile_Accompagnant,EGenreEspace.Mobile_PrimAccompagnant];var lGenreEspacesAccompagnants=[EGenreEspace.Accompagnant,EGenreEspace.Mobile_Accompagnant,EGenreEspace.Tuteur,EGenreEspace.Mobile_Tuteur,EGenreEspace.PrimAccompagnant,EGenreEspace.Mobile_PrimAccompagnant];H.push('<div class="notification-bloc">');if(MethodesTableau.existe(GEtatUtilisateur.GenreEspace,lGenreEspaceConcernes)){H.push(UtilitairePageDonneesPersonnelles.composerCheckbox(EListeIds.cbNotifs,GTraductions.getValeur('PreferencesNotifications.etreNotifieParEmail'),aNotificationMail,'switchNotification'));if(!GEtatUtilisateur.estEspaceMobile()){H.push(`<div class="temporisation-contain">\n                  ${GTraductions.getValeur('PreferencesNotifications.delaiTemporisation')}\n                  <ie-combo ie-model="delaiNotif"></ie-combo>\n              </div>`);}
H.push('</div>');if((!GEtatUtilisateur.pourPrimaire())&&(!GApplication.estEDT)&&(!MethodesTableau.existe(GEtatUtilisateur.GenreEspace,lGenreEspacesAccompagnants))&&!!aGestionMailTravaux){H.push('<div class="notification-bloc no-line">');H.push(UtilitairePageDonneesPersonnelles.composerCheckbox(EListeIds.cbNotifsTravaux,GTraductions.getValeur('PreferencesNotifications.etreNotifieEmailTravaux'),aNotificationMailTravaux,'switchNotificationTravaux'));if(!GEtatUtilisateur.estEspaceMobile()){H.push(`<div class="temporisation-contain">\n                    ${GTraductions.getValeur('PreferencesNotifications.delaiTemporisation')}\n                    <ie-combo ie-model="delaiNotifTravaux"></ie-combo>\n                  </div>`);}
H.push('</div>');}}
H.push('</div>');} else{H.push(GTraductions.getValeur('PreferencesNotifications.serveurNonConfigureNotif'));}
return H.join('');}
function _construireDerniereConnexion(){var H=[];let lMasque='%JJJJ %J %MMMM %AAAA '+GTraductions.getValeur('infosperso.SeparateurDateHeure')+' %hh:%mm';H.push(`<div class="date" >${GDate.FormatDate(GEtatUtilisateur.derniereConnexion,lMasque)}</div>`);return H.join('');}
function _construireMotDePasse(aParams){var H=[];H.push(`<div class="flex-contain flex-center justify-between">`);H.push('<div class="libelle-identification mdp"><span>',aParams.maskMdp,'</span></div>');H.push('<ie-bouton id="',EListeIds.mdp,'" tabindex="0">',GTraductions.getValeur('PageCompte.Modifier'),'</ie-bouton>');H.push(`</div>`);return H.join('');}
function _construireIdentifiant(aParams){var H=[];H.push(`<div class="flex-contain flex-center justify-between">`);H.push('<div class="libelle-identification">',GEtatUtilisateur.estEspaceMobile()?aParams.chaine:GChaine.ajouterEntites(GCryptage.decrypter({genreCryptage:EGenreCryptage.AES,chaine:aParams.chaine,cle:GApplication.getCommunication().cleAES,iv:GApplication.getCommunication().ivAES})),'</div>');if(MethodesTableau.existe(GEtatUtilisateur.GenreEspace,[EGenreEspace.Professeur,EGenreEspace.Mobile_Professeur,EGenreEspace.PrimProfesseur])){H.push('<ie-bouton id="',EListeIds.identifiant,'" tabindex="0">',GTraductions.getValeur('PageCompte.Modifier'),'</ie-bouton>');}
H.push(`</div>`);return H.join('');}
function _construireDroitImage(aParams){var H=[];H.push('<div class="WhiteSpaceNormal InlineBlock">');H.push('<div class="AlignementHaut">');H.push(UtilitairePageDonneesPersonnelles.composerCheckbox(EListeIds.cbDroitImage,MethodesTableau.existe(GEtatUtilisateur.GenreEspace,[EGenreEspace.Professeur,EGenreEspace.Mobile_Professeur,EGenreEspace.PrimProfesseur,EGenreEspace.Accompagnant,EGenreEspace.Mobile_Accompagnant,EGenreEspace.PrimAccompagnant,EGenreEspace.Mobile_PrimAccompagnant,EGenreEspace.Tuteur,EGenreEspace.Mobile_Tuteur,EGenreEspace.Etablissement,EGenreEspace.Mobile_Etablissement,EGenreEspace.Administrateur,EGenreEspace.Mobile_Administrateur])?GTraductions.getValeur('infosperso.autoriserImage',[GApplication.nomProduit]):GTraductions.getValeur('infosperso.autoriserImageParents',[GEtatUtilisateur.getMembre().GetLibelle(),GApplication.nomProduit]),aParams.avecImage,'switchAutoriserImage'));H.push('</div>');H.push('</div>');return H.join('');}
function _construirePagePersonnalisation(aControleur,aOptions){const H=[];if(!GApplication.estAppliMobile){H.push(`<h4>${GTraductions.getValeur('ParametresUtilisateur.Personnalisation')}</h4>`);if(MethodesTableau.existe(GEtatUtilisateur.GenreEspace,[EGenreEspace.Professeur,EGenreEspace.Etablissement,EGenreEspace.PrimProfesseur])){H.push(`<div class="inner-item-contain">\n              <ie-checkbox ie-model="accueil.cbAfficherPageAccueil">${GTraductions.getValeur('infosperso.AfficherAccueilDemarrage')}</ie-checkbox>\n            </div>`);}
H.push(`<div class="inner-item-contain">`);if(UtilitaireChangementLangue.avecChoixLangues()){H.push(`<div class="choice-contain">\n              <span class="libelle">${GTraductions.getValeur('ParametresUtilisateur.Langue')} : </span>\n              ${UtilitaireChangementLangue.construire(aControleur,aOptions)}
            </div>`);}
H.push('</div>');}
return H.join('');}
function _construireGeneralitesProfesseur(){const H=[];if(!IE.estMobile){H.push(`<div class="inner-item-contain flex-contain cols">\n              <ie-checkbox ie-model="generalites.cbMasquerDonneesAutresProfesseurs">\n                ${GTraductions.getValeur('infosperso.MasquerDonneesAutresProfesseurs')}
              </ie-checkbox>`);}
H.push(`<ie-checkbox ie-model="generalites.cbAvecGestionDesThemes">\n                ${GTraductions.getValeur('infosperso.AvecGestionDesThemes')}
              </ie-checkbox>`);if(GApplication.transformationFlux){H.push(tag('ie-checkbox',{'ie-model':'generalites.cbTransformationFlux'},GTraductions.getValeur('ActiverCompressionAutoPDF')));}
if(!IE.estMobile){H.push(`</div>`);}
return H.join('');}
function _construireAutorisations(aParams){var H=[];var switchOuCheckbox=!!aParams.avecSwitch?UtilitairePageDonneesPersonnelles.composerSwitch.bind():UtilitairePageDonneesPersonnelles.composerCheckbox.bind();H.push('<div class="autorisations-contain">');if(!GEtatUtilisateur.estEspaceMobile()){H.push('<p>',aParams.avecSaisie?GTraductions.getValeur('infosperso.titreDestinataire'):GTraductions.getValeur('infosperso.titreDestinataireConsultation'),'</p>');}
H.push('<div class="bloc-autorisation" role="group">');if(aParams.avecSMS&&aParams.SMSAutorise!==null){H.push(switchOuCheckbox(EListeIds.cbSMS,GTraductions.getValeur('infosperso.SMS'),aParams.SMSAutorise,'switchSMSAutorise',aParams.SMSAutoriseDisabled));}
if(aParams.emailAutorise!==null){H.push(switchOuCheckbox(EListeIds.cbMail,GTraductions.getValeur('infosperso.Email'),aParams.emailAutorise,'switchEmailAutorise',aParams.emailAutoriseDisabled));if(aParams.eMailEtablissementAutorise!==null&&aParams.eMailParentAutorise!==null&&((GEtatUtilisateur.GenreEspace!==EGenreEspace.Parent)&&(GEtatUtilisateur.GenreEspace!==EGenreEspace.Mobile_Parent))){H.push('<div class="sous-bloc">');H.push(switchOuCheckbox(EListeIds.cbMailEtab,GTraductions.getValeur('infosperso.EmailEtablissement'),aParams.eMailEtablissementAutorise,'switchEmailEtablissementAutorise',aParams.emailAutorise),switchOuCheckbox(EListeIds.cbParent,GTraductions.getValeur('infosperso.EMailParents'),aParams.eMailParentAutorise,'switchEmailParentAutorise',aParams.emailAutorise));H.push('</div>');}}
if(aParams.courrierPapierAutorise!==null){H.push(switchOuCheckbox(EListeIds.cbCourrier,GTraductions.getValeur('infosperso.Papier'),aParams.courrierPapierAutorise,'switchCourrierPapierAutorise',!aParams.avecSaisie));}
H.push('</div>');if(aParams.msgParent!==null&&aParams.msgEleve!==null){H.push(_construireAutorisationsMessages(aParams));}
if(aParams.construireAutorisationsSupp){H.push(_construireAutorisationsSupp(aParams));}
H.push('</div>');return H.join('');}
function _construireCommunicationsParents(aParams){var H=[];var lTexteAccepte,lTexteDiffuse;lTexteAccepte=aParams.estDelegue?aParams.nbClasses===1?GTraductions.getValeur('infosperso.avecLesResponsablesDeLaClasse',[aParams.delegueDesClasses]):GTraductions.getValeur('infosperso.avecLesResponsablesDesClasses',[aParams.delegueDesClasses]):aParams.nbClasses===1?GTraductions.getValeur('infosperso.avecRespDeleguesClasse',[aParams.delegueDesClasses]):GTraductions.getValeur('infosperso.avecRespDeleguesClasses',[aParams.delegueDesClasses]);lTexteDiffuse=aParams.estMembreCA?GTraductions.getValeur('infosperso.avecTousResponsables',[aParams.delegueDesClasses]):aParams.estDelegue?lTexteAccepte:'';H.push('<div class="WhiteSpaceNormal InlineBlock">');H.push('<div>');H.push(UtilitairePageDonneesPersonnelles.composerSwitch(EListeIds.cbMsgParent,GTraductions.getValeur('infosperso.discussionsAvecParents'),true,'CBDiscussionAvecParents',true));H.push('<div class="GrandEspaceGauche Italique">',lTexteAccepte,'</div>');if(aParams.estDelegue||aParams.estMembreCA){{H.push(UtilitairePageDonneesPersonnelles.composerSwitch(EListeIds.cbMsgProfsPerso,GTraductions.getValeur('infosperso.communiquerEmail'),true,'CBCommuniquerMail',true));}
H.push('<div class="GrandEspaceGauche Italique">',lTexteDiffuse,'</div>');}
H.push('</div>');H.push('</div>');return H.join('');}
function _construireAutorisationsMessages(aParams){var H=[];var switchOuCheckbox=!!aParams.avecSwitch?UtilitairePageDonneesPersonnelles.composerSwitch.bind():UtilitairePageDonneesPersonnelles.composerCheckbox.bind();if(aParams.msgParent!==null&&aParams.msgEleve!==null){H.push('<p>',GTraductions.getValeur('infosperso.AccepteDiscussionAvec'),'</p>');H.push('<div class="bloc-autorisation">');H.push(switchOuCheckbox('',GTraductions.getValeur('infosperso.DiscussionsProf'),null,`switchMsg('msgProfesseur')`,!aParams.avecSaisie));H.push(switchOuCheckbox('',GTraductions.getValeur('infosperso.DiscussionsPerso'),null,`switchMsg('msgPersonnel')`,!aParams.avecSaisie));H.push(switchOuCheckbox(EListeIds.cbMsgParent,GTraductions.getValeur('infosperso.DiscussionsParents')+'<span class="m-left">*</span>',aParams.msgParent,`switchMsg('msgParent')`,!aParams.avecSaisie));H.push(switchOuCheckbox(EListeIds.cbMsgEleve,GTraductions.getValeur('infosperso.DiscussionsEleves')+'<span class="m-left">*</span>',aParams.msgEleve,`switchMsg('msgEleve')`,!aParams.avecSaisie));if(aParams.estContactVS!==null&&aParams.estContactVS!==undefined){H.push(switchOuCheckbox(EListeIds.cbMsgContactVS,GTraductions.getValeur('infosperso.EstContactVS'),aParams.estContactVS,'switchMsgVieScolaire',aParams.avecSaisie));}
if(aParams.msgListePublics){H.push('<div class="groupes-contain">','<span class="libelle"><span class="asterisque">*</span>',GTraductions.getValeur('infosperso.PourLesClassesGroupes'),'</span>','<ie-bouton ie-model="btnMsgPublicMsg">...</ie-bouton>','<span class="m-left-l" ie-html="getHtmlBtnMsgPublicMsg"></span>','</div>');}
H.push('</div>');}
return H.join('');}
function _getClassImageDeDestinataire(aGenre,aActif){return aActif?'actif':'inactif';}
function _construireTitreAvecImages(aTitre,aGenre,aParams){var lImagesBulletin=[];lImagesBulletin.push(`<div class="labels-contain">\n                  <div class="libelle">${aTitre}</div>\n                  <div class="icones-contain">`);if(MethodesTableau.existe(aGenre,[ETypeSwitch.InfosEleve,ETypeSwitch.InfosGenerales])){lImagesBulletin.push('  <i role="img" class="icon_mobile_phone ',_getClassImageDeDestinataire(EGenreDestinataire.SMS,aParams.SMSAutorise),'" aria-label="',GChaine.toTitle(GTraductions.getValeur('infosperso.SMS')),'"></i>');}
lImagesBulletin.push('  <i role="img" class="icon_arobase ',_getClassImageDeDestinataire(EGenreDestinataire.Email,aParams.emailAutorise),'" aria-label="',GChaine.toTitle(GTraductions.getValeur('infosperso.Email')),'"></i>');if(MethodesTableau.existe(aGenre,[ETypeSwitch.Bulletin,ETypeSwitch.InfosEleve,ETypeSwitch.InfosGenerales])){lImagesBulletin.push('<i role="img" class="icon_envelope ',_getClassImageDeDestinataire(EGenreDestinataire.Courrier,aParams.courrierPapierAutorise),'" aria-label="',GChaine.toTitle(GTraductions.getValeur('infosperso.Papier')),'"></i>');}
lImagesBulletin.push('</div>');lImagesBulletin.push('</div>');return lImagesBulletin.join('');}
function _construireAutorisationsSupp(aParams){var lHtml=[];if(aParams.listeEleves.GetNbrElements()>0){lHtml.push(`<h4>${GTraductions.getValeur('infosperso.titreRecevoir')}</h4>`);lHtml.push('<div class="',!IE.estMobile?'bloc-decalage-gauche':'','">',UtilitairePageDonneesPersonnelles.composerCheckbox(EListeIds.cbDestinataireInfosGen,_construireTitreAvecImages(GTraductions.getValeur('infosperso.titreInfosGen'),ETypeSwitch.InfosGenerales,aParams),aParams.estDestinataireInfosGenerales,'switchInfosGen',aParams.avecSaisie),'</div>');for(var i=0;i<aParams.listeEleves.GetNbrElements();i++){var lEleve=aParams.listeEleves.GetElement(i);lHtml.push(`<h5> ${lEleve.GetLibelle()} </h5>`);lHtml.push('<div class="bloc-decalage-gauche" role="group">');if(!GApplication.estEDT){lHtml.push(UtilitairePageDonneesPersonnelles.composerCheckbox(EListeIds.cbDestinataireBulletin,_construireTitreAvecImages(GTraductions.getValeur('infosperso.titreBulletin'),ETypeSwitch.Bulletin,aParams),lEleve.estDestinataireBulletin,'switchBulletin('+i+')',aParams.avecSaisie));}
lHtml.push(UtilitairePageDonneesPersonnelles.composerCheckbox(EListeIds.cbDestinataireInfosEleve,_construireTitreAvecImages(GTraductions.getValeur('infosperso.titreInfosEleve'),ETypeSwitch.InfosEleve,aParams),lEleve.estDestinataireInfosEleve,'switchInfosEleve('+i+')',aParams.avecSaisie));lHtml.push(UtilitairePageDonneesPersonnelles.composerCheckbox(EListeIds.cbDestinataireInfosProf,_construireTitreAvecImages(GTraductions.getValeur('infosperso.titreInfosProf'),ETypeSwitch.InfosProfesseur,aParams),lEleve.estDestinataireInfosProfesseur,'switchInfosProfs('+i+')',aParams.avecSaisie));lHtml.push('</div>');}}
return lHtml.join('');}
UtilitairePageDonneesPersonnelles.composerSwitch=function(aID,aLibelle,aCheck,aModel){var lHtml=[];lHtml.push(`<div class="choice-contain">\n                <ie-switch name="${aID}" id="${aID}" ie-model="${aModel}">${aLibelle}</ie-switch>\n              </div>`);return lHtml.join('');};function _construireAccessibilite(){const H=[];H.push(tag('div',{class:'inner-item-contain flex-contain cols','ie-identite':'getIdentiteAccessibilite'}));return H.join('');}
function _construireSignature(aParams){var H=[];H.push(`<div id="${aParams.id}" class="item-conteneur">\n            <h4>${GTraductions.getValeur('infosperso.importerImageSignature')}</h4>\n            <div class="valeur-contain">`);if(!!aParams.signature&&!!aParams.signature.logo){var lImgSignature="data:image/png;base64,"+aParams.signature.logo;H.push(`<label class="ie-titre-petit">${GTraductions.getValeur('infosperso.apercu')}</label>\n                <div class="bloc-signature-wrapper">\n                    <figure class="signature-contain">\n                        <img  src="${lImgSignature}" />\n                    </figure>\n                    <ie-bouton ie-model="btnSupprimerUpload" id="${EListeIds.uploadSignature}">\n                        ${GTraductions.getValeur('infosperso.supprimerSignature')}\n                     </ie-bouton>\n                </div>`);} else{H.push(`<ie-bouton ie-icon="icon_piece_jointe "ie-model="btnUpload" ie-selecfile id="${EListeIds.uploadSignature}">${GTraductions.getValeur('infosperso.btnImporterSignature')}</ie-bouton>`);}
H.push('<div class="switch-contain">',UtilitairePageDonneesPersonnelles.composerSwitch(EListeIds.autoriserSignature,GTraductions.getValeur('infosperso.autoriserSignature'),true,'switchAutoriserSignature'),'</div>');H.push('</div>');return H.join('');}
function _construireCDT(){const H=[];H.push(`<h4 ie-if="ifElementProgramme">${GTraductions.getValeur('infosperso.ElementProgramme')}</h4>`);H.push(`<div class="inner-item-contain">\n            <ie-checkbox ie-model="CDT.cbElementProgrammeSaisie">${GTraductions.getValeur('infosperso.ElementProgrammeSaisie')}</ie-checkbox>\n          </div>`);H.push(`<h4>${GTraductions.getValeur('infosperso.NavigationCoursCDT')} : </h4>`);H.push(`<div class="inner-item-contain flex-contain cols">\n            <ie-checkbox ie-model="CDT.cbMatiereIdentique">${GTraductions.getValeur('infosperso.CoursMatiereIdentique')}</ie-checkbox>\n\n            <ie-radio ie-model="CDT.rbType(${TypeComparaisonRessourcesCoursCDT.RessourcesIdentiques})">${GTraductions.getValeur('infosperso.CoursRessourceIdentique')}</ie-radio>\n\n            <ie-radio ie-model="CDT.rbType(${TypeComparaisonRessourcesCoursCDT.RessourcesCommunes})">${GTraductions.getValeur('infosperso.CoursRessourceCommune')}</ie-radio>\n\n            <ie-radio ie-model="CDT.rbType(${TypeComparaisonRessourcesCoursCDT.AuMoins1EleveEnCommun})">${GTraductions.getValeur('infosperso.CoursEleveCommun')}</ie-radio>\n          </div>`);H.push(`<h4>${GTraductions.getValeur('infosperso.OptionsDePartage')} : </h4>`);H.push(`<div class="inner-item-contain">\n              <ie-checkbox ie-model="CDT.cbPartagePJAutorisee">${GTraductions.getValeur('infosperso.AutoriserConsultationPJAutresProfesseurs')}</ie-checkbox>\n          </div>`);H.push(`<h4>${GTraductions.getValeur('infosperso.OptionsPublicationAutoCDT')} : </h4>`);H.push(`<div class="inner-item-contain flex-contain cols">\n              <ie-radio ie-model="CDT.rbOptionPublication(${TypeOptionPublicationCDT.OPT_PublicationDebutCours})">${GTraductions.getValeur('infosperso.DesDebutCours')}</ie-radio>\n\n              <ie-radio ie-model="CDT.rbOptionPublication(${TypeOptionPublicationCDT.OPT_PublicationFinCours})">${GTraductions.getValeur('infosperso.ALaFinDuCours')}</ie-radio>\n\n          </div>`);H.push(`<h4 ie-if="ifParcoursEducatif">${GTraductions.getValeur('infosperso.ParcoursEducatifs')}</h4>`);H.push(`<div class="inner-item-contain">\n              <ie-checkbox ie-model="CDT.cbActiverParcoursEducatifs">${GTraductions.getValeur('infosperso.ActiverParcoursEducatifs')}</ie-checkbox>\n          </div>`);return H.join('');}
function _construireEDT(){const H=[];H.push(`<div class="flex-contain flex-center m-bottom m-top-xl">\n              ${GTraductions.getValeur('infosperso.LabelCouleur')}\n              <ie-combo  class="m-left-l" ie-model="EDT.comboCouleur"></ie-combo>\n          </div>`);H.push('<em>',GTraductions.getValeur('infosperso.TipCouleursDesCours'),'</em>');return H.join('');}
UtilitairePageDonneesPersonnelles.composerCheckbox=function(aID,aLibelle,aCheck,aModel){var lHtml=[];lHtml.push(`<div class="choice-contain">\n                <ie-checkbox ie-model="${aModel}" tabIndex="0">${aLibelle}</ie-checkbox>\n              </div>`);return lHtml.join('');};UtilitairePageDonneesPersonnelles.swapClass=function(aTypeImage,aActif){switch(aTypeImage){case EGenreDestinataire.SMS:var lIcone='icon_mobile_phone';break;case EGenreDestinataire.Email:lIcone='icon_arobase';break;case EGenreDestinataire.Courrier:lIcone='icon_envelope';break;}
var lTrue=(aActif?'inactif':'actif');var lFalse=(aActif?'actif':'inactif');var lListeImages=$('.'+lIcone+'.'+lTrue);lListeImages.each(function(){this.classList.remove(lTrue);this.classList.add(lFalse);});};UtilitairePageDonneesPersonnelles.fenetreModificationMDP=function(aInstancePere){ObjetFenetre.creerInstance(ObjetFenetre_ModificationIdentifiantMDP,{pere:aInstancePere},{optionsMDP:{classRequeteSecurisation:ObjetRequeteSecurisationComptePreference,actionRequeteSecurisation:TypeCommandeSecurisationCompteHttp.csch_AffecterMotDePassePersonnalise}}).SetDonnees(GEtatUtilisateur.reglesSaisieMotDePasse);};UtilitairePageDonneesPersonnelles.fenetreModificationIdentifiant=function(aInstancePere,aCallbackReussite){if(!GApplication.droits.get(TypeDroits.compte.avecSaisieIdentifiant)){return;}
ObjetFenetre.creerInstance(ObjetFenetre_ModificationIdentifiantMDP,{pere:aInstancePere,evenement:function(aReussiteModificationIdentification){if(aReussiteModificationIdentification){aCallbackReussite();}},initialiser:function(aInstance){aInstance.changementMDP=false;}},{optionsMDP:{classRequeteSecurisation:ObjetRequeteSecurisationComptePreference,actionRequeteSecurisation:TypeCommandeSecurisationCompteHttp.csch_ModifierLogin}}).SetDonnees();};UtilitairePageDonneesPersonnelles.getDonneesDefaut=function(){return{AvecSMS:true,Informations:{nom:'',prenoms:'',civilite:'',adresse1:'',adresse2:'',adresse3:'',adresse4:'',codePostal:'',ville:'',pays:'',eMail:null,telephonePortable:null,indicatifTel:null,numeroINE:'',telephoneFixe:null,fax:null,entreprise:null,fonction:null},Autorisations:{SMSAutorise:null,emailAutorise:null,eMailEtablissementAutorise:null,eMailParentAutorise:null,courrierPapierAutorise:null,estDestinataireInfosGenerales:false,listeEleves:new ObjetListeElements(),msgParent:null,msgEleve:null,estContactVS:null}};};UtilitairePageDonneesPersonnelles.avecNotifications=function(aDonnes){return aDonnes.notifications&&MethodesTableau.existe(GEtatUtilisateur.GenreEspace,[EGenreEspace.Etablissement,EGenreEspace.Mobile_Etablissement,EGenreEspace.Administrateur,EGenreEspace.Mobile_Administrateur,EGenreEspace.Professeur,EGenreEspace.Mobile_Professeur,EGenreEspace.PrimProfesseur,EGenreEspace.Mobile_PrimProfesseur,EGenreEspace.Accompagnant,EGenreEspace.PrimAccompagnant,EGenreEspace.Tuteur,EGenreEspace.Mobile_Tuteur,EGenreEspace.Mobile_Accompagnant,EGenreEspace.Mobile_PrimAccompagnant]);};UtilitairePageDonneesPersonnelles.avecSignature=function(){return MethodesTableau.existe(GEtatUtilisateur.GenreEspace,[
EGenreEspace.PrimProfesseur,EGenreEspace.Mobile_PrimProfesseur]);};UtilitairePageDonneesPersonnelles.getListeFiltresAff=function(aDonnes,aParametres){var lListe=new ObjetListeElements();let lElementTitre=new ObjetElement(GTraductions.getValeur('InfosEnfantPrim.compte.titre'));lElementTitre.nonSelectionnable=true;lElementTitre.Genre=TypeFiltreAffichage.interTitre;lElementTitre.estInterTitre=ObjetListe.typeInterTitre.h5;lListe.AddElement(lElementTitre);if(GEtatUtilisateur.derniereConnexion||GApplication.droits.get(TypeDroits.compte.avecSaisieIdentifiant)||GApplication.droits.get(TypeDroits.compte.avecSaisieMotDePasse)||aDonnes.securisation||aParametres.avecNumeroINE){lListe.add(new ObjetElement(GTraductions.getValeur('infosperso.Liste_SecurisationCompte'),0,TypeFiltreAffichage.securisation));}
if(GApplication.droits.get(TypeDroits.compte.avecInformationsPersonnelles)){lListe.add(new ObjetElement(GTraductions.getValeur('infosperso.Liste_MonProfil'),0,TypeFiltreAffichage.coords));}
if((aParametres.avecInfosAutorisations)||(UtilitairePageDonneesPersonnelles.avecNotifications(aDonnes))||(GApplication.droits.get(TypeDroits.avecDroitDeconnexionMessagerie))||(aDonnes.droitImage)||(!!aDonnes.Signature&&UtilitairePageDonneesPersonnelles.avecSignature())){lElementTitre=new ObjetElement(GTraductions.getValeur('ParametresUtilisateur.TitreCommunication'));lElementTitre.nonSelectionnable=true;lElementTitre.Genre=TypeFiltreAffichage.interTitre;lElementTitre.estInterTitre=ObjetListe.typeInterTitre.h5;lListe.AddElement(lElementTitre);}
if(aParametres.avecInfosAutorisations){lListe.add(new ObjetElement(GTraductions.getValeur('infosperso.Liste_PreferencesContact'),0,TypeFiltreAffichage.communication));}
if(UtilitairePageDonneesPersonnelles.avecNotifications(aDonnes)){lListe.add(new ObjetElement(GTraductions.getValeur('infosperso.Liste_Notification'),0,TypeFiltreAffichage.notification));}
if(GApplication.droits.get(TypeDroits.avecDroitDeconnexionMessagerie)){lListe.add(new ObjetElement(GTraductions.getValeur('infosperso.Liste_Deconnexion'),0,TypeFiltreAffichage.deconnexion));}
if(!!aDonnes.Signature&&UtilitairePageDonneesPersonnelles.avecSignature()){lListe.add(new ObjetElement(GTraductions.getValeur('infosperso.Liste_Signature'),0,TypeFiltreAffichage.signature));}
lElementTitre=new ObjetElement(GTraductions.getValeur('ParametresUtilisateur.TitrePreferences'));lElementTitre.nonSelectionnable=true;lElementTitre.estInterTitre=ObjetListe.typeInterTitre.h5;lElementTitre.Genre=TypeFiltreAffichage.interTitre;lListe.AddElement(lElementTitre);if(MethodesTableau.existe(GEtatUtilisateur.GenreEspace,[EGenreEspace.Professeur,EGenreEspace.Mobile_Professeur])){lListe.add(new ObjetElement(GTraductions.getValeur('infosperso.Liste_Generalites'),0,TypeFiltreAffichage.generalites));}
if(MethodesTableau.existe(GEtatUtilisateur.GenreEspace,[EGenreEspace.Professeur])&&GApplication.droits.get(TypeDroits.fonctionnalites.gestionCDT)){lListe.add(new ObjetElement(GTraductions.getValeur('infosperso.Liste_CahierTexte'),0,TypeFiltreAffichage.cahierDeTexte));}
lListe.add(new ObjetElement(GTraductions.getValeur('ParametresUtilisateur.StyleAccessibilite'),0,TypeFiltreAffichage.style));return lListe;};UtilitairePageDonneesPersonnelles.getStructurePourValidation=function(aDonnees,aStructure){let lValeur;if(GApplication.droits.get(TypeDroits.compte.avecSaisieInfosPersoCoordonnees)){aStructure.informations={};if(aDonnees.Informations.eMail!==null){lValeur=aDonnees.Informations.eMail;aStructure.informations.eMail=lValeur;aStructure.informations.emailReserveAdmin=aDonnees.Informations.emailReserveAdmin;}
aStructure.informations.telephoneFixe=aDonnees.Informations.telephoneFixe;aStructure.informations.indicatifFixe=aDonnees.Informations.indicatifFixe;aStructure.informations.telephonePortable=aDonnees.Informations.telephonePortable;aStructure.informations.indicatifTel=aDonnees.Informations.indicatifTel;aStructure.informations.fax=aDonnees.Informations.fax;aStructure.informations.indicatifFax=aDonnees.Informations.indicatifFax;aStructure.informations.telReserveAdmin=aDonnees.Informations.telReserveAdmin;}
if(GApplication.droits.get(TypeDroits.compte.avecSaisieInfosPersoAutorisations)){aStructure.autorisations={};if(aDonnees.Autorisations.SMSAutorise!==null){aStructure.autorisations.SMSAutorise=aDonnees.Autorisations.SMSAutorise;}
if(aDonnees.Autorisations.emailAutorise!==null){aStructure.autorisations.emailAutorise=aDonnees.Autorisations.emailAutorise;}
if(aDonnees.Autorisations.eMailEtablissementAutorise!==null){aStructure.autorisations.eMailEtablissementAutorise=aDonnees.Autorisations.eMailEtablissementAutorise;}
if(aDonnees.Autorisations.eMailParentAutorise!==null){aStructure.autorisations.eMailParentAutorise=aDonnees.Autorisations.eMailParentAutorise;}
if(aDonnees.Autorisations.courrierPapierAutorise!==null){aStructure.autorisations.courrierPapierAutorise=aDonnees.Autorisations.courrierPapierAutorise;}
if(aDonnees.Autorisations.msgParent!==null){aStructure.autorisations.msgParent=aDonnees.Autorisations.msgParent;}
if(aDonnees.Autorisations.msgEleve!==null){aStructure.autorisations.msgEleve=aDonnees.Autorisations.msgEleve;}
if(aDonnees.Autorisations.msgProfesseur!==null){aStructure.autorisations.msgProfesseur=aDonnees.Autorisations.msgProfesseur;}
if(aDonnees.Autorisations.msgPersonnel!==null){aStructure.autorisations.msgPersonnel=aDonnees.Autorisations.msgPersonnel;}
if(aDonnees.Autorisations.estContactVS!==null){aStructure.autorisations.estContactVS=aDonnees.Autorisations.estContactVS;}
if(!!aDonnees.Autorisations.msgListePublics){aStructure.autorisations.msgListePublics=aDonnees.Autorisations.msgListePublics.setSerialisateurJSON({ignorerEtatsElement:true,methodeSerialisation:(aElement) =>{return!!aElement.estCoche;}});}
aStructure.autorisations.discussionResponsables=aDonnees.Autorisations.optionCommunicationActivationdiscussion;aStructure.autorisations.publicationMail=aDonnees.Autorisations.optionCommunicationPublicationMail;}
if(aDonnees.notifications){aStructure.notifications={};aStructure.notifications.notificationMail=aDonnees.notifications.notificationMail;aStructure.notifications.delaiNotification=aDonnees.notifications.delaiNotification;aStructure.notifications.gestionMailTravaux=aDonnees.notifications.gestionMailTravaux;aStructure.notifications.notificationMailTravaux=aDonnees.notifications.notificationMailTravaux;aStructure.notifications.delaiNotificationTravaux=aDonnees.notifications.delaiNotificationTravaux;}
if(aDonnees.droitImage){aStructure.droitImage={};aStructure.droitImage.avecAutorisation=!aDonnees.droitImage.autoriser;}
if(GApplication.droits.get(TypeDroits.compte.avecSaisieInfosPersoAutorisations)){if(aDonnees.Autorisations.estDestinataireInfosGenerales!==null){aStructure.autorisations.estDestinataireInfosGenerales=aDonnees.Autorisations.estDestinataireInfosGenerales;}
if(GEtatUtilisateur.GenreEspace===EGenreEspace.Mobile_Parent){aStructure.autorisations.listeEleves=[];var i,lEleve,lJSONEleve;for(i=0;i<aDonnees.Autorisations.listeEleves.GetNbrElements();i++){lEleve=aDonnees.Autorisations.listeEleves.GetElement(i);lJSONEleve=lEleve.toJSON();aStructure.autorisations.listeEleves.push(lJSONEleve);lJSONEleve.estDestinataireBulletin=lEleve.estDestinataireBulletin;lJSONEleve.estDestinataireInfosEleve=lEleve.estDestinataireInfosEleve;lJSONEleve.estDestinataireInfosProfesseur=lEleve.estDestinataireInfosProfesseur;}}}
if(!!aDonnees.Signature){aStructure.signature={};aStructure.signature.estSupprimee=aDonnees.Signature.estSupprimee;aStructure.signature.autoriser=!aDonnees.Signature.autoriser;if(!!aDonnees.Signature.fichier){aStructure.signature.listeFichiers=new ObjetListeElements();aStructure.signature.listeFichiers.add(aDonnees.Signature.fichier);}}
return true;};function _btnPublicMsg(aInstance){const lListeArticles=new ObjetListeElements();let lCumulGroupe=null;const lListeCumulNiveau=new ObjetListeElements();aInstance.donnees.Autorisations.msgListePublics.parcourir((aArticle) =>{const lArticle=MethodesObjet.dupliquer(aArticle);if(lArticle.GetGenre()===EGenreRessource.Groupe){if(!lCumulGroupe){lCumulGroupe=new ObjetElement({Libelle:GTraductions.getValeur('Groupes'),estUnDeploiement:true,estDeploye:false,estCumulGroupe:true});lListeArticles.add(lCumulGroupe);}
lArticle.pere=lCumulGroupe;} else{let lCumul=lListeCumulNiveau.GetElementParNumero(lArticle.niveau.GetNumero());if(!lCumul){lCumul=lArticle.niveau;lCumul.estUnDeploiement=true;lCumul.estDeploye=false;lListeCumulNiveau.add(lCumul);lListeArticles.add(lCumul);}
lArticle.pere=lCumul;}
lListeArticles.add(lArticle);});lListeArticles.setTri([
ObjetTri.initRecursif('pere',[
ObjetTri.init(aArticle =>!!aArticle.estCumulGroupe),ObjetTri.init('Libelle')
])
]).trier();const lDonneesListe=new ObjetDonneesListeFlatDesign(lListeArticles).setOptions({avecBoutonActionLigne:false,avecCB:true,avecEvnt_CB:false,avecCocheCBSurLigne:true,avecSelection:false});ObjetFenetre.creerInstance(ObjetFenetre_Liste,{pere:aInstance,evenement:function(aGenreBouton){if(aGenreBouton!==1){return;}
aInstance.SetEtatSaisie(true);aInstance.donnees.Autorisations.msgListePublics.parcourir((aArticle) =>{const lArticleTableAff=lDonneesListe.Donnees.GetElementParNumero(aArticle.GetNumero());if(lArticleTableAff&&lArticleTableAff.estCoche!==aArticle.estCoche){aArticle.estCoche=!!lArticleTableAff.estCoche;}});},initialiser(aFenetre){aFenetre.setOptionsFenetre({titre:GTraductions.getValeur('infosperso.PourLesClassesGroupes'),largeur:300,hauteur:500,listeBoutons:[GTraductions.getValeur('Annuler'),GTraductions.getValeur('Valider')],modeActivationBtnValider:aFenetre.modeActivationBtnValider.toujoursActifs});aFenetre.paramsListe={optionsListe:{skin:ObjetListe.skin.flatDesign,boutons:[{genre:ObjetListe.typeBouton.deployer},{genre:ObjetListe.typeBouton.rechercher}],avecCBToutCocher:true}};}}).SetDonnees(lDonneesListe);}
module.exports=UtilitairePageDonneesPersonnelles;},fn:"utilitairepagedonneespersonnelles.js"});;
IE.fModule({f:function(exports,require,module,global){const ObjetDonneesListe=require('ObjetDonneesListe.js');const ObjetDonneesListeFlatDesign=require('ObjetDonneesListeFlatDesign.js');const EGenreEtat=require('Enumere_Etat.js');class DonneesListe_InfoMedicale extends ObjetDonneesListeFlatDesign{constructor(aDonnees){super(aDonnees);this.setOptions({avecCB:true,avecSelection:false,avecSuppression:false,avecDeploiement:true,avecCocheCBSurLigne:true});}
getValueCB(aParams){return aParams.article?aParams.article.Actif:false;}
setValueCB(aParams,aValue){aParams.article.SetEtat(EGenreEtat.Modification);aParams.article.Actif=aValue;}
GetCouleurCellule(){return ObjetDonneesListe.ECouleurCellule.Blanc;}
AvecMenuContextuel(){return false;}
avecBoutonActionLigne(){return false;}
getColonneTransfertEdition(){return DonneesListe_InfoMedicale.colonnes.coche;}}
DonneesListe_InfoMedicale.colonnes={coche:'infoMedicale_coche',libelle:'infoMedicale_libelle'};module.exports=DonneesListe_InfoMedicale;},fn:"donneesliste_infomedicale.js"});;
IE.fModule({f:function(exports,require,module,global){const DonneesListe_InfoMedicale=require('DonneesListe_InfoMedicale.js');const ObjetFenetre=require('ObjetFenetre.js');const ObjetListe=require('ObjetListe.js');const ObjetListeElements=require('ObjetListeElements.js');const GTraductions=require('ObjetTraduction.js');const EGenreEtat=require('Enumere_Etat.js');const ObjetElement=require('ObjetElement.js');const EGenreTriElement=require('Enumere_TriElement.js');const ObjetTri=require('ObjetTri.js');class ObjetFenetre_InfoMedicale extends ObjetFenetre{constructor(...aParams){super(...aParams);this.listeInfoMedicale=new ObjetListeElements();this.titreListe=GTraductions.getValeur('fenetreInfosMedicales.titre');}
ConstruireInstances(){this.IdentListe=this.Add(ObjetListe,_evenementListe.bind(this),_initialiserListe.bind(this));}
setParametres_InfoMedicale(aTitreListe){this.titreListe=aTitreListe;}
_formaterDonneesListeAllergies(aListeAllergies){if(aListeAllergies){const lTitreAlimentaire=GTraductions.getValeur('InfosMedicales.TitreAllergiesAlimentaires');const lTitreAutres=GTraductions.getValeur('InfosMedicales.TitreAllergiesAutres');let lListeAvecCumul=new ObjetListeElements();let lElementTitre=new ObjetElement(lTitreAlimentaire);lElementTitre.estUnDeploiement=true;lElementTitre.estDeploye=true;lElementTitre.estAlimentaire=true;lListeAvecCumul.AddElement(lElementTitre);aListeAllergies.parcourir(function(aAllergie){if(aAllergie.estAlimentaire){aAllergie.pere=lElementTitre;aAllergie.estUnDeploiement=false;aAllergie.estDeploye=true;lListeAvecCumul.AddElement(aAllergie);}});lElementTitre=new ObjetElement(lTitreAutres);lElementTitre.estUnDeploiement=true;lElementTitre.estDeploye=true;lElementTitre.estAlimentaire=false;lListeAvecCumul.AddElement(lElementTitre);aListeAllergies.parcourir(function(aAllergie){if(!aAllergie.estAlimentaire){aAllergie.pere=lElementTitre;aAllergie.estDeploye=true;aAllergie.estUnDeploiement=false;lListeAvecCumul.AddElement(aAllergie);}});lListeAvecCumul.setTri(ObjetTri.init('estAlimentaire',EGenreTriElement.Decroissant));lListeAvecCumul.trier();return lListeAvecCumul;}}
SetDonnees(aListeInfoMedicale,aEstListeAllergies){this.Afficher();const lListeAAfficher=(aEstListeAllergies===true)?this._formaterDonneesListeAllergies(aListeInfoMedicale):aListeInfoMedicale;this.listeInfoMedicale=lListeAAfficher;this.GetInstance(this.IdentListe).SetDonnees(new DonneesListe_InfoMedicale(this.listeInfoMedicale));}
Reset(){this.listeInfoMedicale=new ObjetListeElements();}
ComposeContenu(){const lHTML=[];lHTML.push('<table class="Table" border="0" cellpadding="0" cellspacing="0">','<tr><td id="'+this.GetNomInstance(this.IdentListe)+'" class="Table"></td></tr>','</table>');return lHTML.join('');}}
function _evenementListe(aParametres){aParametres.article.SetEtat(EGenreEtat.Modification);}
function _initialiserListe(aInstance){aInstance.setOptionsListe({skin:ObjetListe.skin.flatDesign,nonEditable:false});}
module.exports=ObjetFenetre_InfoMedicale;},fn:"objetfenetre_infomedicale.js"});;
IE.fModule({f:function(exports,require,module,global){const GHtml=require('GHtml.js');const ObjetFenetre=require('ObjetFenetre.js');const ObjetAbstraitInterface=require('ObjetInterface.js');const GTraductions=require('ObjetTraduction.js');const ObjetFenetre_InfoMedicale=require('ObjetFenetre_InfoMedicale.js');const UtilitairePageDonneesPersonnelles=require('UtilitairePageDonneesPersonnelles.js');const EGenreEtat=require('Enumere_Etat.js');const EListeIds=require('Enumere_DonneesPersonnelles.js').EListeIds;const ObjetRequeteSaisieCompteEnfant=require('ObjetRequeteSaisieCompteEnfant.js');const MethodesObjet=require('MethodesObjet.js');class ObjetInformationsMedicales extends ObjetAbstraitInterface{constructor(...aParams){super(...aParams);this.donnees={infosMedicales:null,listeRestrictionsAlimentaires:null};this.mangeALaCantine=false;this.donneesRecues=false;this.idNom='ZoneEditNomMedecin';this.idCommentaire='ZoneEditCommentaire';this.IdPremierElement=this.idNom;}
ConstruireInstances(){}
Valider(){const lInformationsMedicales=this.getDossierMedicalModifie();const lInformationsAllergies=this.getAllergiesModifie();this.SetEtatSaisie(false);new ObjetRequeteSaisieCompteEnfant(this,this.controleur.composeListeAllergies).lancerRequete({informationsMedicales:lInformationsMedicales,allergies:lInformationsAllergies,restrictionsAlimentaires:this.donnees.listeRestrictionsAlimentaires});}
getControleur(aInstance){const lControleurUtilitairePageDonneesPerso=UtilitairePageDonneesPersonnelles.getControleur(aInstance);Object.assign(lControleurUtilitairePageDonneesPerso,{btnAjouterAllergie:{event(){aInstance.ouvrirFenetreChoixAllergie();}},composeListeAllergies(){let lListeAllergiesActives=null;const lListeAllergies=aInstance.getListeAllergies();if(lListeAllergies){lListeAllergiesActives=lListeAllergies.getListeElements((D) =>{return((D.GetActif()===true)&&(D.Etat!==EGenreEtat.Modification))||((D.Etat===EGenreEtat.Modification)&&(D.GetActif()===false));});}
const H=[];const lAvecCroix=aInstance.allergiesModifiables;if(lListeAllergiesActives){lListeAllergiesActives.parcourir((aAllergie) =>{const lIEModel=lAvecCroix?`btnSupprimerAllergie('${aAllergie.GetNumero()}')`:'';H.push(`<ie-chips ie-model="${lIEModel}" class="m-all">${aAllergie.GetLibelle()}</ie-chips>`);});}
return H.join('');},btnSupprimerAllergie:{eventBtn(aNumeroAllergie){const lListeAllergies=aInstance.getListeAllergies();let lAuMoinsUneAllergie=false;if(lListeAllergies){let lAllergie=lListeAllergies.GetElementParNumero(aNumeroAllergie);if(lAllergie){lAllergie.SetActif(false);lAllergie.SetEtat(EGenreEtat.Modification);lListeAllergies.parcourir(function(aAllergene){if(aAllergene.GetActif()===true){lAuMoinsUneAllergie=true;}});if(lAuMoinsUneAllergie){aInstance.donnees.allergies.autoriseConsultationAllergies=true;}
aInstance.callback.appel();}}}},avecZoneRestrictionsAlimentaires(){return!!aInstance.mangeALaCantine;},btnAjouterRestrictionAlimentaire:{event(){aInstance.ouvrirFenetreChoixRestrictionAlimentaire();}},composeListeRestrictionsAlim(){let lListeRestrictionsActives=null;if(aInstance.donnees.listeRestrictionsAlimentaires){lListeRestrictionsActives=aInstance.donnees.listeRestrictionsAlimentaires.getListeElements((D) =>{return D.GetActif();});}
const H=[];const lAvecCroix=aInstance.regimesAlimentairesModifiables;if(lListeRestrictionsActives){lListeRestrictionsActives.parcourir((aRestrictionAlim) =>{const lIEModel=lAvecCroix?`btnSupprimerRestrictionAlim('${aRestrictionAlim.GetNumero()}')`:'';H.push(`<ie-chips ie-model="${lIEModel}" class="m-all">${aRestrictionAlim.GetLibelle()}</ie-chips>`);});}
return H.join('');},btnSupprimerRestrictionAlim:{eventBtn(aNumeroRestrictionAlim){if(aInstance.donnees.listeRestrictionsAlimentaires){let lRestrictionAlim=aInstance.donnees.listeRestrictionsAlimentaires.GetElementParNumero(aNumeroRestrictionAlim);if(lRestrictionAlim){lRestrictionAlim.SetActif(false);lRestrictionAlim.SetEtat(EGenreEtat.Modification);aInstance.callback.appel();}}}}});return $.extend(true,super.getControleur(aInstance),lControleurUtilitairePageDonneesPerso);}
SetDonnees(aParam){this.donnees.infosMedicales=aParam.infosMedicales;this.donnees.listeRestrictionsAlimentaires=MethodesObjet.dupliquer(aParam.restrictionsAlimentaires);this.donnees.listeRestrictionsAlimentairesSauvegarde=aParam.restrictionsAlimentaires;this.mangeALaCantine=aParam.mangeALaCantine;this.donnees.allergies=MethodesObjet.dupliquer(aParam.allergies);this.donnees.allergiesSauvegarde=aParam.allergies;this.allergiesModifiables=aParam.allergiesModifiables;this.regimesAlimentairesModifiables=aParam.regimesAlimentairesModifiables;this.largeur=500;this.donneesRecues=true;this.hauteur={};this.hauteur.infoRestrictions=140;this.lignesCommentaire=5;this.Afficher(this.ConstruireAffichage());}
getListeAllergies(){return!!this.donnees.allergies.listeAllergenes?this.donnees.allergies.listeAllergenes:null;}
ConstruireAffichage(){if(this.donneesRecues){return this.composePage();}
return'';}
composePage(){const lHTML=[];const lEstPrimaire=GApplication.estPrimaire;const lDoitEtreAffiche=!!this.donnees.infosMedicales;const lAvecAllergies=this.allergiesModifiables;const lAvecRegimes=this.regimesAlimentairesModifiables;if(lEstPrimaire){lHTML.push(`<span class="titreInfosMedicales ${IE.estMobile?'mobile':'desktop'}">${GTraductions.getValeur('InfosMedicales.Titre')}</span>`);}
if(lDoitEtreAffiche){lHTML.push(`<div class="item-conteneur">`);if(!lEstPrimaire){lHTML.push(`<h4>${GTraductions.getValeur('InfosMedicales.Titre')}</h4>`);}
lHTML.push(`<div class="valeur-contain ${GApplication.estPrimaire?'sansMarges':''}">`);lHTML.push(UtilitairePageDonneesPersonnelles.composeMedecin());lHTML.push('</div>');lHTML.push('</div>');if(lEstPrimaire){lHTML.push(`<span class="titreInfosMedicales ${IE.estMobile?'mobile':'desktop'}">${GTraductions.getValeur('InfosMedicales.AllergiesAutres')}</span>`);}
lHTML.push(`<div class="item-conteneur">`);if(!lEstPrimaire){lHTML.push(`<h4>${GTraductions.getValeur('InfosMedicales.AllergiesAutres')}</h4>`);}
lHTML.push(`<div class="valeur-contain ${GApplication.estPrimaire?'sansMarges':''}">`);lHTML.push(_composeAutresAllergies.call(this));lHTML.push('</div>');lHTML.push('</div>');}
if(lEstPrimaire){lHTML.push(`<span class="titreInfosMedicales ${IE.estMobile?'mobile':'desktop'}">${GTraductions.getValeur('InfosMedicales.AllergiesRepertoriees')}</span>`);}
lHTML.push(`<div class="item-conteneur">`);if(!lEstPrimaire){lHTML.push(`<h4>${GTraductions.getValeur('InfosMedicales.AllergiesRepertoriees')}</h4>`);}
lHTML.push(`<div class="valeur-contain ${GApplication.estPrimaire?'sansMarges':''}">`);lHTML.push(_composeAllergies.call(this,lAvecAllergies));lHTML.push('</div>');lHTML.push('</div>');lHTML.push(`<div class="item-conteneur" ie-if="avecZoneRestrictionsAlimentaires">\n                  <h4>${GTraductions.getValeur('PageCompte.PratiquesAlimentaires')}</h4>\n                  <div class="valeur-contain">`);lHTML.push(_composeRestrictionsAlimentaires.call(this,lAvecRegimes));lHTML.push('</div>');lHTML.push('</div>');return lHTML.join('');}
ouvrirFenetreChoixAllergie(){const lFenetreChoixAllergie=ObjetFenetre.creerInstance(ObjetFenetre_InfoMedicale,{pere:this,evenement:function(aBouton){if(aBouton===1){this.donnees.allergies.listeAllergenes=this.copieTravailListeAllergies;let lAuMoinsUneAllergie=false;this.donnees.allergies.listeAllergenes.parcourir(function(aAllergene){if(aAllergene.GetActif()===true){lAuMoinsUneAllergie=true;}});if(lAuMoinsUneAllergie){this.donnees.allergies.autoriseConsultationAllergies=true;}
this.callback.appel();}},initialiser:function(aInstance){aInstance.setParametres_InfoMedicale(GTraductions.getValeur('InfosMedicales.Allergies'));aInstance.setOptionsFenetre({titre:GTraductions.getValeur('InfosMedicales.SaisieAllergiesRepertoriees'),largeur:450,hauteur:600,listeBoutons:[GTraductions.getValeur('Annuler'),GTraductions.getValeur('Valider')]});}});this.copieTravailListeAllergies=MethodesObjet.dupliquer(this.getListeAllergies());lFenetreChoixAllergie.SetDonnees(this.copieTravailListeAllergies,true);}
ouvrirFenetreChoixRestrictionAlimentaire(){const lFenetreChoixRestrictionAlimentaire=ObjetFenetre.creerInstance(ObjetFenetre_InfoMedicale,{pere:this,evenement:function(aBouton){if(aBouton===1){this.donnees.listeRestrictionsAlimentaires=this.copieTravailListeRestrictions;this.callback.appel();}},initialiser:function(aInstance){aInstance.setParametres_InfoMedicale(GTraductions.getValeur('InfosMedicales.Restrictions'));aInstance.setOptionsFenetre({titre:GTraductions.getValeur('InfosMedicales.SaisieRestrictions'),largeur:300,hauteur:300,listeBoutons:[GTraductions.getValeur('Annuler'),GTraductions.getValeur('Valider')]});}});this.copieTravailListeRestrictions=MethodesObjet.dupliquer(this.donnees.listeRestrictionsAlimentaires);lFenetreChoixRestrictionAlimentaire.SetDonnees(this.copieTravailListeRestrictions);}
setValidation(aID){switch(aID){case this.idNom:this.donnees.infosMedicales.nomMedecin=GHtml.getValue(this.idNom);break;case this.idCommentaire:this.donnees.infosMedicales.commentaire=GHtml.getValue(this.idCommentaire);break;default:break;}
this.callback.appel();}
getDossierMedicalModifie(){return this.donnees.infosMedicales;}
getAllergiesModifie(){return this.donnees.allergies;}
getAlimentationModifie(){return this.donnees.listeRestrictionsAlimentaires;}}
function _composeAllergies(aAvecSaisie){const lHTML=[];lHTML.push(`<p class="m-top m-bottom-l">${GTraductions.getValeur('infosperso.infosImperieusesTitre')}</p>`);lHTML.push(`<p class="m-top m-bottom-l">${GTraductions.getValeur('infosperso.infosImperieusesAllergiesComplement')}</p>`);if(aAvecSaisie){lHTML.push(`<ie-bouton ie-model="btnAjouterAllergie" class="themeBoutonNeutre" title="${GTraductions.getValeur('InfosMedicales.AjouterAllergie')}">${GTraductions.getValeur('Ajouter')}</ie-bouton>`);}
lHTML.push('<div class="liste-chips" ie-html="composeListeAllergies"></div>');lHTML.push('<div class="switch-contain">',UtilitairePageDonneesPersonnelles.composerSwitch(EListeIds.cbAutoriserAllergies,GTraductions.getValeur('infosperso.infosAllergiesConsultables'),true,'autoriseConsultationAllergies'),'</div>');return lHTML.join('');}
function _composeRestrictionsAlimentaires(aAvecSaisie){const lHTML=[];if(aAvecSaisie){lHTML.push(`<ie-bouton ie-model="btnAjouterRestrictionAlimentaire" class="themeBoutonNeutre" title="${GTraductions.getValeur('InfosMedicales.AjouterRestriction')}">${GTraductions.getValeur('Ajouter')}</ie-bouton>`);}
lHTML.push('<div class="liste-chips" ie-html="composeListeRestrictionsAlim"></div>');return lHTML.join('');}
function _composeAutresAllergies(){const lHTML=[];const lLignes=this.lignesCommentaire+(this.mangeALaCantine?0:Math.floor(this.hauteur.infoRestrictions/(2*12)));lHTML.push(`<div class="item-contain">\n  <textarea maxlength="1000" tabIndex="0" id="${this.idCommentaire}" name="${this.idCommentaire}" onchange="${this.Nom}.setValidation (id)" class="round-style" rows="${lLignes}" style="width:100%;height:${this.mangeALaCantine?50:120}px;">\n  ${this.donnees.infosMedicales.commentaire?this.donnees.infosMedicales.commentaire:``}</textarea>\n  </div>`);lHTML.push(`<p class="m-top m-bottom">${GTraductions.getValeur('infosperso.infosMedicalesTitre')}</p>`);lHTML.push('<div class="switch-contain">',UtilitairePageDonneesPersonnelles.composerSwitch(EListeIds.cbExposerDossierMedical,GTraductions.getValeur('infosperso.infosMedicalesConsultables'),true,'estConsultable'),'</div>');return lHTML.join('');}
module.exports=ObjetInformationsMedicales;},fn:"pageinformationsmedicales.js"});;
IE.fModule({f:function(exports,require,module,global){const ObjetInterfacePage=require('InterfacePage.js');const Requetes=require('CollectionRequetes.js');const{ObjetRequeteConsultation,ObjetRequeteSaisie}=require('ObjetRequeteJSON.js');const ObjetCompte_AutorisationSortie=require('ObjetCompte_AutorisationSortie.js');const ObjetCompte_AutorisationImage=require('ObjetCompte_AutorisationImage.js');const ObjetCompte_AutresContacts=require('ObjetCompte_AutresContacts.js');const EStructureAffichage=require('Enumere_StructureAffichage.js');const ObjetRequeteSaisieCompteEnfant=require('ObjetRequeteSaisieCompteEnfant.js');const InterfaceDocumentsAFournir=require('InterfaceDocumentsAFournir.js');const DonneesListe_FiltreCompte=require('DonneesListe_FiltreCompte.js');const ObjetListe=require('ObjetListe.js');const ObjetListeElements=require('ObjetListeElements.js');const ObjetElement=require('ObjetElement.js');const TypeFiltreAffichage=require('Enumere_DonneesPersonnelles.js').TypeFiltreAffichage;const GTraductions=require('ObjetTraduction.js');const EGenreEvenementListe=require('Enumere_EvenementListe.js');const GUID=require('GUID.js');const GHtml=require('GHtml.js');const UtilitairePageDonneesPersonnelles=require('UtilitairePageDonneesPersonnelles.js');const ObjetInformationsMedicales=require('PageInformationsMedicales.js');require('espace/css/ObjetCompte_Generique.css');Requetes.inscrire('InfosEnfant',ObjetRequeteConsultation);Requetes.inscrire('SaisieAutorisationSortie',ObjetRequeteSaisie);Requetes.inscrire('SaisieAutorisationImage',ObjetRequeteSaisie);Requetes.inscrire('SaisieAutresContacts',ObjetRequeteSaisie);class InterfaceCompteInfosEnfantPrim extends ObjetInterfacePage{constructor(...aParams){super(...aParams);this.idMainPage=GUID.getId();this.idContenu=GUID.getId();this.setOptionsEcrans({nbNiveaux:2,avecBascule:IE.estMobile});this.contexte={niveauCourant:0,ecran:[InterfaceCompteInfosEnfantPrim.genreEcran.principal,InterfaceCompteInfosEnfantPrim.genreEcran.detail],selection:[]};}
getControleur(aInstance){return $.extend(true,super.getControleur(this),UtilitairePageDonneesPersonnelles.getControleur(),{btnRetourEcranPrec:{event:function(){this.revenirSurEcranPrecedent();}.bind(aInstance)}});}
ConstruireInstances(){this.identAutoriseSortie=this.Add(ObjetCompte_AutorisationSortie,_evntAutorisationSaisie.bind(this));this.identAutoriseImage=this.Add(ObjetCompte_AutorisationImage,_evntAutorisationImageSaisie.bind(this));this.identDocumentsAFournir=this.Add(InterfaceDocumentsAFournir,_evntSaisieDocuments.bind(this));this.identInformationsMedicales=this.Add(ObjetInformationsMedicales,_evenementInformationsMedicales.bind(this));this.identAutresContacts=this.Add(ObjetCompte_AutresContacts,_evntSaisieAutresContacts.bind(this));this.identListe=this.Add(ObjetListe,_evenementListe.bind(this),_initListe);}
SetParametresGeneraux(){this.avecBandeau=true;this.GenreStructure=EStructureAffichage.Autre;}
RecupererDonnees(){Requetes('InfosEnfant',this,_actionApresRequete.bind(this)).lancerRequete();}
ConstruireStructureAffichageAutre(){const H=[];let lLargeur=IE.estMobile?'class="Mobile"':'class="Desktop"';H.push('<div class="ObjetCompte compte-contain">');H.push('<div class="ObjetCompte_conteneur" style="width:100%">');H.push('<div id="',this.getIdDeNiveau({niveauEcran:0}),'" ',lLargeur,'>');H.push('<div ',lLargeur,'>');H.push('<div id="'+this.GetInstance(this.identListe).GetNom()+'" class="Conteneur_Liste"></div>');H.push('</div>');H.push('</div>');H.push('<div id="',this.getIdDeNiveau({niveauEcran:1}),'" ',IE.estMobile?'style="display: none;"':'','class="Conteneur_Detail">');H.push('<div style="display: none;" class="CarteCompteZoneGenerique" id="',this.idMainPage,'">');H.push('<label class="Gras">',GTraductions.getValeur('InfosEnfantPrim.autoriseSortie.titreRubrique'),'</label>');H.push('  <div  class="Espace GrandEspaceBas" id="'+this.GetInstance(this.identAutoriseSortie).GetNom()+'"></div>');H.push('<label class="Gras">',GTraductions.getValeur('infosperso.Liste_DroitImage'),'</label>');H.push('  <div  class="Espace GrandEspaceBas" id="'+this.GetInstance(this.identAutoriseImage).GetNom()+'"></div>');H.push('<div class="border-bottom" id="',this.GetNomInstance(this.identInformationsMedicales),'"></div>');H.push('<label class="Gras">',GTraductions.getValeur('infosperso.DocumentAFournir',GEtatUtilisateur.getMembre().GetLibelle()),'</label>');H.push('  <div  class="Espace GrandEspaceBas" id="'+this.GetInstance(this.identDocumentsAFournir).GetNom()+'"></div>');H.push('<label class="Gras">',GTraductions.getValeur('InfosEnfantPrim.autresContacts.titreRubrique'),'</label>');H.push('  <div  class="Espace" id="'+this.GetInstance(this.identAutresContacts).GetNom()+'"></div>');H.push('</div>');H.push('</div>');H.push('</div>');H.push('</div>');return H.join('');}
construireEcran(aEcran){const lElement=this.getCtxSelection({niveauEcran:0});switch(aEcran.genreEcran){case InterfaceCompteInfosEnfantPrim.genreEcran.principal:if(this.optionsEcrans.avecBascule){this.setHtmlStructureAffichageBandeau('');}
break;case InterfaceCompteInfosEnfantPrim.genreEcran.detail:this.setHtmlStructureAffichageBandeau(this.construireBandeauEcran(lElement));_actualiserAffichageDetails.call(this);break;default:}}
construireBandeauEcran(){const lHtml=[];return super.construireBandeauEcran(lHtml.join(''),{bgWhite:true});}
Valider(){const lInformationsMedicales=this.GetInstance(this.identInformationsMedicales).getDossierMedicalModifie();const lInformationsAllergies=this.GetInstance(this.identInformationsMedicales).getAllergiesModifie();this.SetEtatSaisie(false);new ObjetRequeteSaisieCompteEnfant(this,this.ActionSurValidation).lancerRequete({informationsMedicales:lInformationsMedicales,allergies:lInformationsAllergies,restrictionsAlimentaires:this.donnees.restrictionsAlimentaires});}}
InterfaceCompteInfosEnfantPrim.genreEcran={principal:'principal',detail:'detail'};function _evenementInformationsMedicales(){this.Valider();}
function _actionApresRequete(aJSON){if(aJSON){this.donneesRecues=true;this.donnees=aJSON;this.GetInstance(this.identAutoriseSortie).setDonnees({sortieAutorisee:aJSON.Informations.sortieAutorise});const lParams={infosMedicales:aJSON.infosMedicales,restrictionsAlimentaires:aJSON.restrictionsAlimentaires,mangeALaCantine:aJSON.mangeALaCantine,allergies:aJSON.allergies,allergiesModifiables:aJSON.allergiesModifiables,regimesAlimentairesModifiables:aJSON.regimesAlimentairesModifiables};this.GetInstance(this.identInformationsMedicales).SetDonnees(lParams);this.GetInstance(this.identAutoriseImage).setDonnees({autoriserImage:aJSON.Informations.autoriserImage});this.GetInstance(this.identDocumentsAFournir).SetDonnees({listeNaturesDocument:aJSON.listeNaturesDocumentsAFournir});this.listeNaturesDocumentsAFournir=aJSON.listeNaturesDocumentsAFournir;this.GetInstance(this.identAutresContacts).setDonnees({listeAutresContacts:aJSON.Informations.listeAutresContacts,listeLiensParente:aJSON.Informations.listeLiensParente,listeContactsAutresEnfants:aJSON.Informations.listeContactsAutresEnfants});let lListe=new ObjetListeElements();let lElementTitre=new ObjetElement(GTraductions.getValeur('InfosEnfantPrim.compte.titre'));lElementTitre.nonSelectionnable=true;lElementTitre.estInterTitre=ObjetListe.typeInterTitre.h5;lListe.AddElement(lElementTitre);lListe.add(new ObjetElement(GTraductions.getValeur('InfosEnfantPrim.compte.profil'),0,TypeFiltreAffichage.profilPrimEnfant));this.GetInstance(this.identListe).SetDonnees(new DonneesListe_FiltreCompte(lListe).setOptions({flatDesignMinimal:!IE.estMobile}),0);if(!IE.estMobile){this.GetInstance(this.identListe).SelectionnerLigne({ligne:1});}}}
function _initListe(aInstance){aInstance.setOptionsListe({colonnes:DonneesListe_FiltreCompte.getColonnes(),skin:ObjetListe.skin.flatDesign,hauteurAdapteContenu:true,colonnesSansBordureDroit:[true]});}
function _evenementListe(aParametres){const lCellulesSelections=this.GetInstance(this.identListe).getTableauCellulesSelection();this.ongletSelectionne=lCellulesSelections[0].article.GetGenre();let lEcranSrc,lEcranDest;switch(aParametres.genreEvenement){case EGenreEvenementListe.SelectionClick:case EGenreEvenementListe.ModificationSelection:if(this.optionsEcrans.avecBascule){lEcranSrc={niveauEcran:0,genreEcran:this.getCtxEcran({niveauEcran:0})};lEcranDest={niveauEcran:1,genreEcran:this.getCtxEcran({niveauEcran:1})};this.basculerEcran(lEcranSrc,lEcranDest);}
break;}
_actualiserAffichageDetails.call(this);}
function _actualiserAffichageDetails(){const lSelection=this.GetInstance(this.identListe).getElementSelection();switch(lSelection.GetGenre()){case TypeFiltreAffichage.profilPrimEnfant:GHtml.setDisplay(this.idMainPage,true);break;default:break;}}
function _evntAutorisationSaisie(aParam){const lObjetSaisie={estAutorise:aParam.estAutorise};Requetes('SaisieAutorisationSortie',this,_actionSurSaisie.bind(this)).lancerRequete(lObjetSaisie);}
function _evntAutorisationImageSaisie(aParam){const lObjetSaisie={avecImage:!aParam.estAutorise};Requetes('SaisieAutorisationImage',this,_actionSurSaisie.bind(this)).lancerRequete(lObjetSaisie);}
function _evntSaisieDocuments(){const lListeFichiersAFournir=this.GetInstance(this.identDocumentsAFournir).getListeFichiersAUpload();new ObjetRequeteSaisieCompteEnfant(this,this.ActionSurValidation).addUpload({listeFichiers:lListeFichiersAFournir}).lancerRequete({listeNaturesDocumentsAFournir:this.listeNaturesDocumentsAFournir});}
function _evntSaisieAutresContacts(aParam){aParam.listeSaisie.setSerialisateurJSON({methodeSerialisation:_serialisationListeAutresContacts.bind(this)});Requetes('SaisieAutresContacts',this,this.ActionSurValidation).lancerRequete(aParam);}
function _serialisationListeAutresContacts(aElement,aJSON){aJSON.nom=aElement.nom;aJSON.prenom=aElement.prenom;aJSON.indMobile=aElement.indMobile;aJSON.indDomicile=aElement.indDomicile;aJSON.indTravail=aElement.indTravail;aJSON.telMobile=aElement.telMobile;aJSON.telDomicile=aElement.telDomicile;aJSON.telTravail=aElement.telTravail;aJSON.appelSiUrgent=aElement.appelSiUrgent;aJSON.autoriseARecuperer=aElement.autoriseARecuperer;if(aElement.lienParente&&aElement.lienParente.GetNumero()!==0){aJSON.lienParente=aElement.lienParente.toJSON();}}
function _actionSurSaisie(){this.RecupererDonnees();}
module.exports=InterfaceCompteInfosEnfantPrim;},fn:"interfacecompteinfosenfantprim.js"});;
IE.fModule({f:function(exports,require,module,global){const InterfaceCompteInfosEnfantPrim=require('InterfaceCompteInfosEnfantPrim.js');const InterfacePage_Mobile=require('InterfacePage_Mobile.js');class ObjetAffichagePageCompteEnfants_Mobile extends InterfacePage_Mobile{ConstruireInstances(){this.identPage=this.Add(InterfaceCompteInfosEnfantPrim,null,null);}
Valider(){const lInstance=this.GetInstance(this.identPage);lInstance.Valider();}}
module.exports=ObjetAffichagePageCompteEnfants_Mobile;},fn:"mobile/script/interfacepagecompteenfants.js"});;
IE.fModule({f:function(exports,require,module,global){const{ObjetRequeteSaisie}=require('ObjetRequeteJSON.js');const Requetes=require('CollectionRequetes.js');class ObjetRequeteSaisieNotifications extends ObjetRequeteSaisie{constructor(...aParams){super(...aParams);}
lancerRequete(aParam){this.JSON=$.extend({},aParam);return this.appelAsynchrone();}
actionApresRequete(aXml,aGenreReponse){this.callbackReussite.appel(aXml,aGenreReponse,this.JSONRapportSaisie);}}
Requetes.inscrire('SaisiePreferencesNotifications',ObjetRequeteSaisieNotifications);module.exports=ObjetRequeteSaisieNotifications;},fn:"objetrequetesaisienotifications.js"});;
IE.fModule({f:function(exports,require,module,global){const{ObjetRequeteConsultation}=require('ObjetRequeteJSON.js');const Requetes=require('CollectionRequetes.js');class ObjetRequetePageInfosPerso extends ObjetRequeteConsultation{constructor(...aParams){super(...aParams);}
lancerRequete(aParam){this.JSON=aParam;return this.appelAsynchrone();}
actionApresRequete(){this.callbackReussite.appel(this.JSONReponse);}}
Requetes.inscrire('PageInfosPerso',ObjetRequetePageInfosPerso);module.exports=ObjetRequetePageInfosPerso;},fn:"objetrequetepageinfosperso.js"});;
IE.fModule({f:function(exports,require,module,global){const ObjetAbstraitInterface=require('ObjetInterface.js');const EStructureAffichage=require('Enumere_StructureAffichage.js');const GTraductions=require('ObjetTraduction.js');const ObjetRequeteSecurisationComptePreference=require('ObjetRequeteSecurisationCompte.js').ObjetRequeteSecurisationComptePreference;const GUID=require('GUID.js');const{TypeGenreSourceConnexion,TypeGenreSourceConnexionUtil,TypeCommandeSecurisationCompteHttp}=require('TypeSecurisationCompte.js');const ObjetFenetre=require('ObjetFenetre.js');const EGenreBoiteMessage=require('Enumere_BoiteMessage.js');const EGenreAction=require('Enumere_Action.js');const{GDate}=require('ObjetDate.js');const ObjetListe=require('ObjetListe.js');const ObjetDonneesListeFlatDesign=require('ObjetDonneesListeFlatDesign.js');const EGenreEvenementListe=require('Enumere_EvenementListe.js');class InterfaceParamListeSourcesConnexions extends ObjetAbstraitInterface{constructor(...aParams){super(...aParams);}
SetParametresGeneraux(){this.GenreStructure=EStructureAffichage.Autre;}
ConstruireInstances(){this.identListeSources=this.Add(ObjetListe,this.evenementListeSources,this.initialiserListeSources);}
initialiserListeSources(aInstance){aInstance.setOptionsListe({skin:ObjetListe.skin.flatDesign,hauteurAdapteContenu:Infinity});}
evenementListeSources(aParametres){switch(aParametres.genreEvenement){case EGenreEvenementListe.Edition:this.ouvrirFenetreDetailSource(aParametres.article);break;case EGenreEvenementListe.Suppression:{const lThis=this;GApplication.getMessage().afficher({type:EGenreBoiteMessage.Confirmation,message:GTraductions.getValeur('DoubleAuth.PrefConfirmerSupprimer'),callback:function(aNumeroBouton){if(aNumeroBouton===EGenreAction.Valider){new ObjetRequeteSecurisationComptePreference(lThis).lancerRequete({action:TypeCommandeSecurisationCompteHttp.csch_SupprimerSourceConnexionConnue,identifiantSysteme:aParametres.article.identifiantSysteme,genreSource:aParametres.article.GetGenre()}).then(function(){lThis.callback.appel({actualiser:true});});}}});break;}}}
ouvrirFenetreDetailSource(aSourceConnexion){const lTitre='<i class="'+TypeGenreSourceConnexionUtil.getIcone(aSourceConnexion.GetGenre())+' m-right"></i>'+aSourceConnexion.GetLibelle();const lFenetreMessage=ObjetFenetre.creerInstance(ObjetFenetre_DetailsAppareil,{pere:this,initialiser(aInstanceFenetre){aInstanceFenetre.setOptionsFenetre({titre:lTitre,largeur:600,listeBoutons:[GTraductions.getValeur('Fermer')]});},evenement(){if(aSourceConnexion.GetLibelle()){new ObjetRequeteSecurisationComptePreference(this).setOptions({gererMessageErreur:false}).lancerRequete({action:TypeCommandeSecurisationCompteHttp.csch_RenommerSourceConnexionConnue,identifiantSysteme:aSourceConnexion.identifiantSysteme,genreSource:aSourceConnexion.GetGenre(),libelleSaisi:aSourceConnexion.GetLibelle()}).catch(function(){}).then(function(){this.callback.appel({actualiser:true});}.bind(this));}}});lFenetreMessage.SetDonnees(aSourceConnexion);}
setDonnees(aDonnees){this.Initialiser();this.donnees=aDonnees;this.GetInstance(this.identListeSources).SetDonnees(new DonneesListe_SourcesConnexion(aDonnees.listeSourcesConnexions));}
ConstruireStructureAffichageAutre(){const H=[];H.push('<div>',`<div id="${this.GetInstance(this.identListeSources).GetNom()}"></div>`,'</div>');H.push('<p>',GTraductions.getValeur('DoubleAuth.PrefChoisirDEnregistrer'),'</p>');H.push('<p>',GTraductions.getValeur('DoubleAuth.PersonnesConfiance'),'</p>');H.push('<p>',GTraductions.getValeur('DoubleAuth.PrefPensezASupprimer'),'</p>');return H.join('');}}
class DonneesListe_SourcesConnexion extends ObjetDonneesListeFlatDesign{constructor(aDonnees){super(aDonnees);this.setOptions({avecSelection:false});}
getIconeGaucheContenuFormate(aParams){return TypeGenreSourceConnexionUtil.getIcone(aParams.article.GetGenre());}
AvecMenuContextuel(){return true;}
initialisationObjetContextuel(aParametres){if(!aParametres.menuContextuel){return;}
aParametres.menuContextuel.add(GTraductions.getValeur('PageCompte.Details'),true,function(){this.callback.appel({article:aParametres.article,genreEvenement:EGenreEvenementListe.Edition});},{icon:'icon_pencil'});aParametres.menuContextuel.add(GTraductions.getValeur('Supprimer'),true,function(){this.callback.appel({article:aParametres.article,genreEvenement:EGenreEvenementListe.Suppression});},{icon:'icon_trash'});aParametres.menuContextuel.SetDonnees();}}
class ObjetFenetre_DetailsAppareil extends ObjetFenetre{constructor(...aParams){super(...aParams);this.idContenu=GUID.getId();this.donnees={sourceConnexion:null,avecChangement:false};}
getControleur(aInstance){return $.extend(true,super.getControleur(aInstance),{txtNomSourceConnexion:{getValue(){return aInstance.donnees.sourceConnexion?aInstance.donnees.sourceConnexion.GetLibelle():'';},setValue(aValue){if(aInstance.donnees.sourceConnexion){aInstance.donnees.sourceConnexion.SetLibelle(aValue);aInstance.donnees.avecChangement=true;}}},getLibelleSysteme(){return aInstance.donnees.sourceConnexion?aInstance.donnees.sourceConnexion.libelleSysteme:'';},getStrDateDerniereConnexion(){let lStrDate='';if(aInstance.donnees.sourceConnexion&&aInstance.donnees.sourceConnexion.dateDerniereConnexion){lStrDate=GDate.FormatDate(aInstance.donnees.sourceConnexion.dateDerniereConnexion,' %JJ %MMMM %AAAA %hh%sh%mmm%ss');}
return lStrDate;},getStrGenreConnexion(){let lStrGenre='';if(aInstance.donnees.sourceConnexion){switch(aInstance.donnees.sourceConnexion.GetGenre()){case TypeGenreSourceConnexion.GSC_ClientLourd:lStrGenre=GTraductions.getValeur('PageCompte.Client');break;case TypeGenreSourceConnexion.GSC_ApplicationMobile:lStrGenre=GTraductions.getValeur('PageCompte.Mobile');break;case TypeGenreSourceConnexion.GSC_Navigateur:lStrGenre=GTraductions.getValeur('PageCompte.Navigateur');break;default:;}}
return lStrGenre;}});}
ComposeContenu(){const H=[];H.push(`<ul class="liste-recap">`);H.push(`<li class="field-contain">\n              <label>${GTraductions.getValeur('DoubleAuth.PrefListeLibelle')} : </label>\n              <input type="text" ie-model="txtNomSourceConnexion" class="round-style" />\n           </li>`);H.push(`<li class="field-contain">\n              <label>${GTraductions.getValeur('DoubleAuth.PrefListeAppareil')} : </label>\n              <span ie-html="getLibelleSysteme"></span>\n            </li>`);H.push(`<li class="field-contain">\n              <label>${GTraductions.getValeur('DoubleAuth.PrefListeDate')} : </label>\n              <span ie-html="getStrDateDerniereConnexion"></span>\n            </li>`);H.push(`<li class="field-contain">\n              <label>${GTraductions.getValeur('DoubleAuth.PrefListeIcone')} : </label>\n              <span ie-html="getStrGenreConnexion"></span>\n            </li>`);H.push(`</ul>`);return H.join('');}
SurValidation(){if(this.donnees.avecChangement){this.callback.appel();}
this.Fermer();}
SetDonnees(aSourceConnexion){this.donnees.avecChangement=false;this.donnees.sourceConnexion=aSourceConnexion;this.Afficher();}}
module.exports=InterfaceParamListeSourcesConnexions;},fn:"interfaceparamlistesourcesconnexions.js"});;
IE.fModule({f:function(exports,require,module,global){const Identite=require('ObjetIdentite.js');const GTraductions=require('ObjetTraduction.js');const SecurisationCompte=require('TypeSecurisationCompte.js');const TypeModeGestionDoubleAuthentification=SecurisationCompte.TypeModeGestionDoubleAuthentification;const TypeCommandeSecurisationCompteHttp=SecurisationCompte.TypeCommandeSecurisationCompteHttp;const ObjetRequeteSecurisationComptePreference=require('ObjetRequeteSecurisationCompte.js').ObjetRequeteSecurisationComptePreference;const ObjetFenetre=require('ObjetFenetre.js');const ObjetSaisieCodePIN=require('ObjetSaisieCodePIN.js');const ObjetChoixStrategieSecurisation=require('ObjetChoixStrategieSecurisation.js');class ObjetParamChoixStrategieSecurisation extends Identite{constructor(...aParams){super(...aParams);this.instanceChoix=Identite.creerInstance(ObjetChoixStrategieSecurisation,{pere:this});}
setDonnees(aDonnees){this.donnees=aDonnees;this.Afficher('<div id="'+this.instanceChoix.Nom+'"></div>');this.instanceChoix.setOptions({modeAffichage:ObjetChoixStrategieSecurisation.typeAffichage.prefUtilisateur,modesPossibles:aDonnees.modesPossibles,modeSecurisationParDefaut:GEtatUtilisateur.modeSecurisationParDefaut,callbackChoix:function(aGenre){_affecterChoix(this,aGenre);}.bind(this)}).setDonnees(aDonnees);}}
function _ouvrirFenetrePIN_promise(aInstance,aVerifierPIN){return new Promise(function(aResolve,aReject){const lOptionsPIN={classeRequete:ObjetRequeteSecurisationComptePreference,modePIN:aVerifierPIN?ObjetSaisieCodePIN.ModeSaisieValiderPIN.msControlePIN:ObjetSaisieCodePIN.ModeSaisieValiderPIN.msModifierPIN};ObjetFenetre.creerInstance(_ObjetFenetre_SaisieCodePIN,{pere:aInstance,evenement:function(){aReject();}},{titre:aVerifierPIN?GTraductions.getValeur('DoubleAuth.RenforcerSecuTitre'):GTraductions.getValeur('DoubleAuth.TitreFiche'),callbackPIN:function(aCodePIN){aResolve(aCodePIN);}}).setDonnees(lOptionsPIN,{mode:TypeModeGestionDoubleAuthentification.MGDA_SaisieCodePIN});});}
function _affecterChoix(aInstance,aGenreChoix){const lParamsRequete={};Promise.resolve().then(function(){if(aInstance.donnees.mode===TypeModeGestionDoubleAuthentification.MGDA_SaisieCodePIN){return _ouvrirFenetrePIN_promise(aInstance,true).then(function(aCodePIN){lParamsRequete.ancienCodePin=aCodePIN;});}}).then(function(){if(aGenreChoix===TypeModeGestionDoubleAuthentification.MGDA_SaisieCodePIN){return _ouvrirFenetrePIN_promise(aInstance,false).then(function(aCodePIN){Object.assign(lParamsRequete,{action:TypeCommandeSecurisationCompteHttp.csch_AffecterCodePIN,codePin:aCodePIN});});}
Object.assign(lParamsRequete,{action:TypeCommandeSecurisationCompteHttp.csch_AffecterModeDoubleAuthentification,mode:aGenreChoix});}).then(function(){return new ObjetRequeteSecurisationComptePreference(aInstance).lancerRequete(lParamsRequete);}).then(function(){aInstance.callback.appel({actualiser:true});},function(){});}
module.exports=ObjetParamChoixStrategieSecurisation;class _ObjetFenetre_SaisieCodePIN extends ObjetFenetre{constructor(...aParams){super(...aParams);this.setOptionsFenetre({avecTailleSelonContenu:true});}
ConstruireInstances(){this.identPIN=this.Add(ObjetSaisieCodePIN,function(aCodePIN){if(aCodePIN){this.optionsFenetre.callbackPIN(aCodePIN);this.Fermer();}});}
ComposeContenu(){return['<div id="',this.GetInstance(this.identPIN).GetNom(),'"></div>'].join('');}
setDonnees(aOptions,aDonnees){this.Afficher();this.GetInstance(this.identPIN).setOptions(aOptions).setDonnees(aDonnees);}}},fn:"objetparamchoixstrategiesecurisation.js"});;
IE.fModule({f:function(exports,require,module,global){const ECouleurDeTheme={Light:0,Legere:1,Legere2:2,Claire:3,Moyen1:4,Moyen2:5,Foncee:6,Sombre:7};module.exports=ECouleurDeTheme;},fn:"enumere_couleursdetheme.js"});;
IE.fModule({f:function(exports,require,module,global){const{ObjetRequeteSaisie}=require('ObjetRequeteJSON.js');const Requetes=require('CollectionRequetes.js');const GCache=require('Cache.js');class ObjetRequeteSaisieInformations extends ObjetRequeteSaisie{constructor(...aParams){super(...aParams);}
lancerRequete(aDonnees){$.extend(this.JSON,aDonnees);if(!!aDonnees.dossierMedical){this.JSON.dossierMedical=aDonnees.dossierMedical.toJSONAll();}
if(aDonnees.signature){this.JSON.signature={};this.JSON.signature.estSupprimee=aDonnees.signature.estSupprimee;this.JSON.signature.autoriser=aDonnees.signature.autoriser;if(aDonnees.signature.listeFichiers){this.JSON.signature.listeFichiers=aDonnees.signature.listeFichiers.setSerialisateurJSON({methodeSerialisation:_serialisationFichier.bind(this)});}}
if(GCache&&GCache.general){GCache.general._jetonViderCacheMessagerie=true;}
return this.appelAsynchrone();}
actionApresRequete(aXml,aGenreReponse){this.callbackReussite.appel(aXml,aGenreReponse,this.JSONRapportSaisie);}}
Requetes.inscrire('SaisieInformations',ObjetRequeteSaisieInformations);function _serialisationFichier(aElement,aJSON){const lIdFichier=aElement.idFichier!==undefined?aElement.idFichier:(aElement.Fichier!==undefined?aElement.Fichier.idFichier:null);if(lIdFichier!==null){aJSON.idFichier=''+lIdFichier;}}
module.exports=ObjetRequeteSaisieInformations;},fn:"objetrequetesaisieinformations.js"});;
IE.fModule({f:function(exports,require,module,global){const ObjetIdentite_Mobile=require('ObjetIdentite_Mobile.js');const GTraductions=require('ObjetTraduction.js');const ObjetRequeteSaisieNotifications=require('ObjetRequeteSaisieNotifications.js');const EGenreEspace=require('Enumere_Espace.js');const ObjetRequetePageInfosPerso=require('ObjetRequetePageInfosPerso.js');const UtilitairePageDonneesPersonnelles=require('UtilitairePageDonneesPersonnelles.js');const GHtml=require('GHtml.js');const EGenreTypeContenu=require('Enumere_DonneesPersonnelles.js').EGenreTypeContenu;const EListeIds=require('Enumere_DonneesPersonnelles.js').EListeIds;const{TypeDroits}=require('ObjetDroitsPN.js');const MethodesTableau=require('MethodesTableau.js');const GChaine=require('GChaine.js');const EGenreCryptage=require('Enumere_Cryptage.js');const GCryptage=require('ObjetCryptage.js');const GUID=require('GUID.js');const InterfaceParamListeSourcesConnexions=require('InterfaceParamListeSourcesConnexions.js');const ObjetParamChoixStrategieSecurisation=require('ObjetParamChoixStrategieSecurisation.js');const Identite=require('ObjetIdentite.js');const ObjetListe=require('ObjetListe.js');const DonneesListe_FiltreCompte=require('DonneesListe_FiltreCompte.js');const TypeFiltreAffichage=require('Enumere_DonneesPersonnelles.js').TypeFiltreAffichage;const EGenreEvenementListe=require('Enumere_EvenementListe.js');const ObjetPreferenceAccessibilite=require('ObjetPreferenceAccessibilite.js');const{GObjetWAI,EGenreRole,EGenreObjet}=require('ObjetWAI.js');const ObjetListeElements=require('ObjetListeElements.js');const GThemesCouleurs=require('ThemesCouleurs.js').GThemesCouleurs;const TypeThemeCouleur=require('TypeThemeCouleur.js').TypeThemeCouleur;const ECouleurDeTheme=require('Enumere_CouleursDeTheme.js');const GStyle=require('GStyle.js');const EGenreEvenementObjetSaisie=require('Enumere_EvenementObjetSaisie.js');const{Invocateur}=require('Invocateur.js');const ObjetTri=require('ObjetTri.js');const MethodesObjet=require('MethodesObjet.js');const ObjetPreferenceMessagerie=require('ObjetPreferenceMessagerie.js');const ObjetRequeteSaisieInformations=require('ObjetRequeteSaisieInformations.js');require('produit/css/PageCompteCommune.css');class ObjetPageCompte extends ObjetIdentite_Mobile{constructor(...aParams){super(...aParams);this.IdZoneChk='_zoneChk';const notificationPush=GEtatUtilisateur.Identification.ressource.notificationsPush;this.avecPush=notificationPush;this.idIntersticial=GUID.getId();this.idMainPage=GUID.getId();this.parametres={largeurLibelleInput:30,hauteurInput:20,largeurEmail:220,largeurIndicatif:45,largeurTel:115,maskMDP:'*********',avecInfosEntreprise:GEtatUtilisateur.GenreEspace===EGenreEspace.Entreprise,avecTelFixe:GEtatUtilisateur.GenreEspace===EGenreEspace.Entreprise,avecTelFax:GEtatUtilisateur.GenreEspace===EGenreEspace.Entreprise,avecNumeroINE:MethodesTableau.existe(GEtatUtilisateur.GenreEspace,[EGenreEspace.Eleve,EGenreEspace.Mobile_Eleve]),avecInfosAutorisations:MethodesTableau.existe(GEtatUtilisateur.GenreEspace,[EGenreEspace.Mobile_Parent,EGenreEspace.Mobile_Professeur,EGenreEspace.Mobile_Etablissement,EGenreEspace.Mobile_Accompagnant,EGenreEspace.Mobile_Administrateur])};this.donnees=UtilitairePageDonneesPersonnelles.getDonneesDefaut();this.instanceListeFiltre=Identite.creerInstance(ObjetListe,{pere:this,evenement:function(aParametres){switch(aParametres.genreEvenement){case EGenreEvenementListe.SelectionClick:if(aParametres.article){GEtatUtilisateur.setGenreAffichageCompteSelectionne(aParametres.article.GetGenre());_selectionnerFiltre.call(this,aParametres.article.GetGenre());}
break;}}});this.instanceSourcesConnexions=Identite.creerInstance(InterfaceParamListeSourcesConnexions,{pere:this,evenement:function(aParam){_evenementSecurisation.call(this,aParam);}});this.instanceChoixStratSecurisation=Identite.creerInstance(ObjetParamChoixStrategieSecurisation,{pere:this,evenement:function(aParam){_evenementSecurisation.call(this,aParam);}});}
toggleNotifs(aCoche){this.avecPush=!aCoche;new ObjetRequeteSaisieNotifications(this,this._evenementSurSaisieNotification).lancerRequete({avecPush:this.avecPush});}
_evenementSurSaisieNotification(){GEtatUtilisateur.Identification.ressource.notificationsPush=this.avecPush;}
getControleur(aInstance){let lControleur={getIdentiteAccessibilite:function(){return{class:ObjetPreferenceAccessibilite,pere:aInstance};},getIdentiteMessagerie:function(){return{class:ObjetPreferenceMessagerie,pere:aInstance};},generalites:{cbAvecGestionDesThemes:{getValue:function(){return GApplication.parametresUtilisateur.get('avecGestionDesThemes');},setValue:function(aValue){GApplication.parametresUtilisateur.set('avecGestionDesThemes',aValue);}},cbTransformationFlux:{getValue(){return GApplication.transformationFlux.getActif();},setValue(aValue){GApplication.transformationFlux.setActif(aValue);}}},comboTheme:{init:function(aInstance){aInstance.setOptions_ObjetSaisie({labelWAIZone:GTraductions.getValeur('WAI.ListeSelectionTheme'),roleWAIZone:EGenreRole.Menuitem,roleWAIEdit:EGenreRole.Option,labelWAIEdit:GObjetWAI.getInfo(EGenreObjet.NavigationHorizontalAvecValidation),avecEventSurFermetureListe:true,celluleAvecTexteHtml:true});const lListe=new ObjetListeElements();GThemesCouleurs.listeThemes.parcourir(function(aTheme){if(TypeThemeCouleur.estThemePrincipal(aTheme.GetGenre())){lListe.AddElement(MethodesObjet.dupliquer(aTheme));}});lListe.setTri([ObjetTri.init('Libelle')]).trier();const lTheme=GApplication.parametresUtilisateur.get('theme.theme');let lIndice=0;lListe.parcourir(function(aElement,aIndice){if(aElement.GetGenre()===lTheme){lIndice=aIndice;}
const lCouleur=GThemesCouleurs.getCouleurDuTheme(ECouleurDeTheme.Foncee,true,aElement.GetGenre());aElement.libelleHtml=['<span class="theme-color-choix">','<span class="color-sample" style="'+GStyle.composeCouleurFond(lCouleur)+'"></span>',aElement.GetLibelle(),'</span>'
].join('');});aInstance.SetDonnees(lListe,lIndice);},event:function(aParametres,aCombo){if(aParametres.genreEvenement===EGenreEvenementObjetSaisie.selection&&aCombo.InteractionUtilisateur){GApplication.parametresUtilisateur.set('theme.theme',aParametres.element.GetGenre());Invocateur.evenement('appelManuel_modificationTheme');}},getDisabled:function(){return GEtatUtilisateur.estAvecThemeAccessible();}},getNodeHeader:function(){$(this.node).on('click',function(){aInstance.closeNav();});}};return $.extend(true,super.getControleur(this),Object.assign(UtilitairePageDonneesPersonnelles.getControleur(),lControleur));}
closeNav(){GHtml.setDisplay(this.idIntersticial,false);GHtml.setDisplay(this.idMainPage,true);}
RecupererDonnees(){_envoiRequetePage.call(this);}
getStructurePourValidation(aStructure){return UtilitairePageDonneesPersonnelles.getStructurePourValidation(this.donnees,aStructure);}
Valider(){const lStructure={};if(this.getStructurePourValidation(lStructure)){this.SetEtatSaisie(false);const lFichiers=(!!lStructure.signature&&!!lStructure.signature.listeFichiers)?lStructure.signature.listeFichiers:new ObjetListeElements();new ObjetRequeteSaisieInformations(this,this.RecupererDonnees).addUpload({listeFichiers:lFichiers}).lancerRequete(lStructure);}}}
function _evenementSecurisation(aParam){if(aParam&&aParam.actualiser){const lElementScroll=GHtml.getElement(GApplication.getIdConteneur());const lScrollTop=lElementScroll.scrollTop;_envoiRequetePage.call(this).then(_selectionnerFiltre.bind(this,TypeFiltreAffichage.securisation)).then(function(){if(lScrollTop>0){lElementScroll.scrollTop=lScrollTop;}});}}
function _getLibelleParGenreAffichage(aGenreAffichageCourant){const lListe=UtilitairePageDonneesPersonnelles.getListeFiltresAff(this.donnees,this.parametres);let lLibelleAffichage='';lListe.parcourir((D) =>{if(D.GetGenre()===aGenreAffichageCourant){lLibelleAffichage=D.GetLibelle();return false;}});return lLibelleAffichage;}
function _selectionnerFiltre(aGenreAffichageCourant){const H=[];let lAvecContenu=true;H.push('<div class="navheader">');H.push('  <ie-btnimage ie-node="getNodeHeader" class="fleche-nav btnImageIcon icon_retour_mobile"></ie-btnimage>');H.push('  <h3>',_getLibelleParGenreAffichage.call(this,aGenreAffichageCourant),'</h3>');H.push('</div>');switch(aGenreAffichageCourant){case TypeFiltreAffichage.securisation:if(GEtatUtilisateur.derniereConnexion){H.push(UtilitairePageDonneesPersonnelles.construireZoneGenerique(GTraductions.getValeur('PageCompte.DerniereConnexion'),EGenreTypeContenu.DerniereConnexion));}
if(GApplication.droits.get(TypeDroits.compte.avecSaisieIdentifiant)){H.push('<div class="pc_traitSeparation"></div>');const lAuthentifiant=GChaine.ajouterEntites(GCryptage.decrypter({genreCryptage:EGenreCryptage.AES,chaine:this.donnees.authentifiant,cle:GApplication.getCommunication().cleAES,iv:GApplication.getCommunication().ivAES}));H.push(UtilitairePageDonneesPersonnelles.construireZoneGenerique(GTraductions.getValeur('PageCompte.Identifiant'),EGenreTypeContenu.Identifiant,{chaine:lAuthentifiant}));}
if(GApplication.droits.get(TypeDroits.compte.avecSaisieMotDePasse)){H.push('<div class="pc_traitSeparation"></div>');H.push(UtilitairePageDonneesPersonnelles.construireZoneGenerique(GTraductions.getValeur('PageCompte.MotDePasse'),EGenreTypeContenu.MotDePasse,{maskMdp:this.parametres.maskMDP}));}
if(this.donnees.securisation){H.push('<div class="pc_traitSeparation"></div>');H.push(UtilitairePageDonneesPersonnelles.construireZoneGenerique(GTraductions.getValeur('DoubleAuth.SecuriteRenforcee'),EGenreTypeContenu.sourcesConnexions,{idSourcesConnexions:this.instanceChoixStratSecurisation.Nom}));}
if(this.donnees.securisation&&this.donnees.securisation.listeSourcesConnexions){H.push('<div class="pc_traitSeparation"></div>');H.push(UtilitairePageDonneesPersonnelles.construireZoneGenerique(GTraductions.getValeur('DoubleAuth.AppareilsIdentifies'),EGenreTypeContenu.sourcesConnexions,{idSourcesConnexions:this.instanceSourcesConnexions.Nom}));}
if(this.parametres.avecNumeroINE){H.push(UtilitairePageDonneesPersonnelles.construireZoneGenerique(GTraductions.getValeur('PageCompte.NumeroINE'),EGenreTypeContenu.INE,{numeroINE:this.donnees.Informations.numeroINE}));}
break;case TypeFiltreAffichage.coords:if(GApplication.droits.get(TypeDroits.compte.avecInformationsPersonnelles)){const lParams={civilite:this.donnees.Informations.civilite,nom:this.donnees.Informations.nom,prenom:this.donnees.Informations.prenoms,avecInfosEntreprise:this.parametres.avecInfosEntreprise,entreprise:this.donnees.Informations.entreprise,fonction:this.donnees.Informations.fonction,adresse1:this.donnees.Informations.adresse1,adresse2:this.donnees.Informations.adresse2,adresse3:this.donnees.Informations.adresse3,adresse4:this.donnees.Informations.adresse4,codePostal:this.donnees.Informations.codePostal,ville:this.donnees.Informations.ville,province:this.donnees.Informations.province,pays:this.donnees.Informations.pays,eMail:this.donnees.Informations.eMail,largeurLibelleInput:this.parametres.largeurLibelleInput,largeurEmail:this.parametres.largeurEmail,hauteurInput:this.parametres.hauteurInput,largeurIndicatif:this.parametres.largeurIndicatif,avecTelFixe:this.parametres.avecTelFixe,avecTelFax:this.parametres.avecTelFax,largeurTel:this.parametres.largeurTel};if(!MethodesTableau.existe(GEtatUtilisateur.GenreEspace,[EGenreEspace.Mobile_Eleve,EGenreEspace.Mobile_Professeur,EGenreEspace.Mobile_Etablissement,EGenreEspace.Mobile_Administrateur])){const lParamsHorsEleve={avecSMS:this.donnees.Autorisations.SMSAutorise};$.extend(lParams,lParamsHorsEleve);}
H.push(UtilitairePageDonneesPersonnelles.construireZoneGenerique(GTraductions.getValeur('infosperso.Liste_MonProfil'),EGenreTypeContenu.Coordonnees,lParams));}
if(this.donnees.droitImage){H.push(UtilitairePageDonneesPersonnelles.construireZoneGenerique(GTraductions.getValeur('infosperso.droitImage'),EGenreTypeContenu.DroitImage,{droitImage:!this.donnees.droitImage.autoriser}));}
break;case TypeFiltreAffichage.communication:if(this.parametres.avecInfosAutorisations){const lAvecSaisie=GApplication.droits.get(TypeDroits.compte.avecSaisieInfosPersoAutorisations);const lParams={avecSaisie:lAvecSaisie,avecSMS:this.donnees.AvecSMS,SMSAutorise:this.donnees.Autorisations.SMSAutorise,SMSAutoriseDisabled:!lAvecSaisie||!this.donnees.Informations.telephonePortable,emailAutorise:this.donnees.Autorisations.emailAutorise,emailAutoriseDisabled:!lAvecSaisie||!this.donnees.Informations.eMail,emailEtablissementAutorise:this.donnees.Autorisations.eMailEtablissementAutorise,emailParentAutorise:this.donnees.Autorisations.eMailParentAutorise,courrierPapierAutorise:this.donnees.Autorisations.courrierPapierAutorise,msgParent:this.donnees.Autorisations.msgParent,msgEleve:this.donnees.Autorisations.msgEleve,msgProfesseur:this.donnees.Autorisations.msgProfesseur,msgPersonnel:this.donnees.Autorisations.msgPersonnel,msgListePublics:this.donnees.Autorisations.msgListePublics,estContactVS:this.donnees.Autorisations.estContactVS,listeEleves:this.donnees.Autorisations.listeEleves,estDestinataireInfosGenerales:this.donnees.Autorisations.estDestinataireInfosGenerales,listeAutorisations:this.listeAutorisations,construireAutorisationsSupp:MethodesTableau.existe(GEtatUtilisateur.GenreEspace,[EGenreEspace.Mobile_Parent])?_construireAutorisationsSupp.bind(this):null,avecSwitch:false};H.push(UtilitairePageDonneesPersonnelles.construireZoneGenerique(GTraductions.getValeur('PageCompte.Autorisations'),EGenreTypeContenu.Autorisations,lParams));}
if(MethodesTableau.existe(GEtatUtilisateur.GenreEspace,[EGenreEspace.Mobile_Parent])&&this.donnees.Autorisations.afficherCommunicationParents){const lParams={estDestinataireInfosGenerales:this.donnees.Autorisations.estDestinataireInfosGenerales,optionCommunicationActivationdiscussion:this.donnees.Autorisations.optionCommunicationActivationdiscussion,optionCommunicationPublicationMail:this.donnees.Autorisations.optionCommunicationPublicationMail,afficherOptionCommunicationPublicationEmail:this.donnees.Autorisations.afficherOptionCommunicationPublicationEmail,delegueDesClasses:this.donnees.Autorisations.delegueDesClasses,nbClasses:this.donnees.Autorisations.nbClasses,estDelegue:this.donnees.Autorisations.estDelegue,estMembreCA:this.donnees.Autorisations.estMembreCA};H.push(UtilitairePageDonneesPersonnelles.construireZoneGenerique(GTraductions.getValeur('infosperso.communicationsParents'),EGenreTypeContenu.CommunicationParents,lParams));}
break;case TypeFiltreAffichage.notification:if(UtilitairePageDonneesPersonnelles.avecNotifications(this.donnees)){H.push(UtilitairePageDonneesPersonnelles.construireZoneGenerique(GTraductions.getValeur('PreferencesNotifications.titreNotifications'),EGenreTypeContenu.Notifications,{envoiMail:this.donnees.envoiMailActif,notificationMail:this.donnees.notifications.notificationMail,gestionMailTravaux:this.donnees.notifications.gestionMailTravaux,notificationMailTravaux:this.donnees.notifications.notificationMailTravaux}));}
break;case TypeFiltreAffichage.signature:if(this.donnees.Signature){H.push(UtilitairePageDonneesPersonnelles.construireZoneGenerique('',EGenreTypeContenu.Signature,{signature:this.donnees.Signature}));}
break;case TypeFiltreAffichage.deconnexion:H.push(UtilitairePageDonneesPersonnelles.construireZoneGenerique(GTraductions.getValeur('infosperso.Liste_Deconnexion'),EGenreTypeContenu.Deconnexion));break;case TypeFiltreAffichage.style:H.push(UtilitairePageDonneesPersonnelles.construireZoneGenerique(GTraductions.getValeur('ParametresUtilisateur.Accessibilite'),EGenreTypeContenu.Style,{controleur:this.controleur}));break;case TypeFiltreAffichage.generalites:H.push(UtilitairePageDonneesPersonnelles.construireZoneGenerique(GTraductions.getValeur('infosperso.Generalites'),EGenreTypeContenu.Generalites,{controleur:this.controleur}));break;case TypeFiltreAffichage.interTitre:lAvecContenu=false;break;default:;}
if(lAvecContenu){GHtml.setDisplay(this.idMainPage,false);GHtml.setDisplay(this.idIntersticial,true);GHtml.setHtml(this.idIntersticial,H.join(''),{controleur:this.controleur});}
switch(aGenreAffichageCourant){case TypeFiltreAffichage.securisation:if(this.donnees.securisation){this.instanceChoixStratSecurisation.setDonnees(this.donnees.securisation);}
if(this.donnees.securisation&&this.donnees.securisation.listeSourcesConnexions){this.instanceSourcesConnexions.setDonnees(this.donnees.securisation);}
break;}
const lThis=this;$('#'+EListeIds.identifiant.escapeJQ()).on({mouseup:function(){_callbackIdentifiant.call(lThis);}});$('#'+EListeIds.mdp.escapeJQ()).on({mouseup:function(){_callbackMDP.call(lThis);}});}
function _construireAutorisationsSupp(){const lHtml=[];if(this.donnees.Autorisations.listeEleves.GetNbrElements()>0){lHtml.push('<div class="Gras EspaceHaut" style="clear:both;">',GTraductions.getValeur('infosperso.titreRecevoir'),'</div>');}
return lHtml.join('');}
function _construirePage(){const lHtml=[];lHtml.push('<div class="PageCompte">');lHtml.push('<div class="compte-contain" id="',this.idIntersticial,'" style="display:none;"></div>');lHtml.push('<div id="',this.idMainPage,'" style="display:block;">');lHtml.push('<div id="',this.instanceListeFiltre.Nom,'"></div>');lHtml.push('</div>');lHtml.push('</div>');return lHtml.join('');}
function _callbackMDP(){UtilitairePageDonneesPersonnelles.fenetreModificationMDP(this);}
function _callbackIdentifiant(){UtilitairePageDonneesPersonnelles.fenetreModificationIdentifiant(this,this.RecupererDonnees.bind(this));}
function _surReponseRequetePageInfosPerso(aDonnees){$.extend(true,this.donnees,aDonnees);GHtml.setHtml(this.Nom,_construirePage.bind(this)(),{controleur:this.controleur});const lListe=UtilitairePageDonneesPersonnelles.getListeFiltresAff(this.donnees,this.parametres);this.instanceListeFiltre.Initialiser();this.instanceListeFiltre.setOptionsListe({skin:ObjetListe.skin.flatDesign,colonnes:DonneesListe_FiltreCompte.getColonnes()}).SetDonnees(new DonneesListe_FiltreCompte(lListe).setOptions({avecSelection:false}));const lGenreElementASelectionner=GEtatUtilisateur.getGenreAffichageCompteSelectionne();if(!!lGenreElementASelectionner){_selectionnerFiltre.call(this,lGenreElementASelectionner);}}
function _envoiRequetePage(){return new ObjetRequetePageInfosPerso(this).lancerRequete().then(_surReponseRequetePageInfosPerso.bind(this));}
module.exports=ObjetPageCompte;},fn:"mobile/script/pagecompte.js"});;
IE.fModule({f:function(exports,require,module,global){const ObjetPageCompte=require('mobile/script/PageCompte.js');const InterfacePage_Mobile=require('InterfacePage_Mobile.js');const ObjetRequeteSaisieInformations=require('ObjetRequeteSaisieInformations.js');const ObjetListeElements=require('ObjetListeElements.js');class ObjetAffichagePageCompte_Mobile extends InterfacePage_Mobile{ConstruireInstances(){this.identPage=this.Add(ObjetPageCompte,null,null);}
Valider(){const lStructure={};if(this.GetInstance(this.identPage).getStructurePourValidation(lStructure)){this.SetEtatSaisie(false);const lFichiers=(!!lStructure.signature&&!!lStructure.signature.listeFichiers)?lStructure.signature.listeFichiers:new ObjetListeElements();new ObjetRequeteSaisieInformations(this,this.SurValidation).addUpload({listeFichiers:lFichiers}).lancerRequete(lStructure);}}
SurValidation(){this.GetInstance(this.identPage).afficher();}}
module.exports=ObjetAffichagePageCompte_Mobile;},fn:"mobile/script/interfacepagecompte.js"});;
IE.fModule({f:function(exports,require,module,global){const{ObjetRequeteConsultation}=require('ObjetRequeteJSON.js');const Requetes=require('CollectionRequetes.js');const GStyle=require('GStyle.js');const ObjetElement=require('ObjetElement.js');const ObjetListeElements=require('ObjetListeElements.js');const GCache=require('Cache.js');const ObjetDeserialiser=require('ObjetDeserialiser.js');class ObjetRequetePageAgenda extends ObjetRequeteConsultation{constructor(...aParams){super(...aParams);}
lancerRequete(aNumeroSemaine){this.JSON={NumeroSemaine:aNumeroSemaine,AvecListeClasses:GCache&&!GCache.agenda.existeDonnee('listeClassesGroupes')};return this.appelAsynchrone();}
actionApresRequete(){const lParam={DomaineDePresence:this.JSONReponse.DomaineDePresence,ListeClassesGroupes:null,parametreExportICal:this.JSONReponse.ParametreExportiCal,avecExportICal:this.JSONReponse.AvecExportiCal};lParam.listeEvenements=new ObjetDeserialiser().getListeEvenements(this.JSONReponse.ListeEvenements);lParam.listeFamilles=this.JSONReponse.listeFamilles||new ObjetListeElements();lParam.listeFamilles.parcourir(function(aElement){const lLibelleHtml=[];lLibelleHtml.push('<span class="AlignementMilieuVertical InlineBlock" style="width: 12px; height: 12px;',GStyle.composeCouleurFond(aElement.couleur),'"></span>');lLibelleHtml.push('<span class="AlignementMilieuVertical EspaceGauche">',aElement.Libelle,'</span>');aElement.libelleHtml=lLibelleHtml.join('');});lParam.listeJourDansMois=this.JSONReponse.listeJourDansMois||new ObjetListeElements();if(GCache){if(this.JSONReponse.ListeClassesGroupes){lParam.listeClassesGroupes=new ObjetListeElements().fromJSON(this.JSONReponse.ListeClassesGroupes,_ajouterClassesGroupes.bind(this));GCache.agenda.setDonnee('listeClassesGroupes',lParam.listeClassesGroupes);} else if(GCache.agenda.existeDonnee('listeClassesGroupes')){lParam.listeClassesGroupes=GCache.agenda.getDonnee('listeClassesGroupes');}}
lParam.dateFinPrevisionnel=this.JSONReponse.dateFinPrevisionnel;this.callbackReussite.appel(lParam);}}
Requetes.inscrire('PageAgenda',ObjetRequetePageAgenda);function _ajouterClassesGroupes(aJSON,aElement){if(aJSON.niveau){aElement.niveau=aJSON.niveau?new ObjetElement().fromJSON(aJSON.niveau):null;}
if(aJSON.EPeda){aElement.equipePedagogique=new ObjetListeElements().fromJSON(aJSON.EPeda);}}
module.exports=ObjetRequetePageAgenda;},fn:"objetrequetepageagenda.js"});;
IE.fModule({f:function(exports,require,module,global){const ObjetRequetePageAgenda=require('ObjetRequetePageAgenda.js');const GChaine=require('GChaine.js');const GHtml=require('GHtml.js');const InterfacePage_Mobile=require('InterfacePage_Mobile.js');const{GDate}=require('ObjetDate.js');const GTraductions=require('ObjetTraduction.js');const EGenreRessource=require('Enumere_Ressource.js');const UtilitaireVisios=require('UtilitaireVisiosSco.js').UtilitaireVisios;const tag=require('tag.js');class InterfacePageAgenda extends InterfacePage_Mobile{constructor(...aParams){super(...aParams);this.listeEvenements=null;}
RecupererDonnees(){this.ActualiserDonnees();}
ActualiserDonnees(){new ObjetRequetePageAgenda(this,_surRecupererDonneesAgenda.bind(this)).lancerRequete();}
getControleur(aInstance){return{getNodeVisio:function(aIndice){$(this.node).on('click',function(aEvent){var lElement=aInstance.listeEvenements.GetElement(aIndice);if(lElement&&lElement.visio){aEvent.stopPropagation();const lOptions={titre:GTraductions.getValeur('FenetreSaisieVisiosCours.URLAssocieeAuConseil')};UtilitaireVisios.ouvrirFenetreConsultVisio(lElement.visio,lOptions);}});}};}
doForMobileApp(){}}
function _getDateCourante(aListeEvenements){var N=aListeEvenements.GetNbrElements();for(var I=0;I<N;I++){var lEvenement=aListeEvenements.GetElement(I);if(GDate.GetJour(new Date())>=GDate.GetJour(lEvenement.DateDebut)){return lEvenement.DateDebut;}}
if(N>0){return aListeEvenements.GetElement(N-1).DateDebut;}}
function _surRecupererDonneesAgenda(aParam){var H=[],lIdSelection=this.Nom+'_selec';this.listeEvenements=aParam.listeEvenements;if(!!aParam.listeEvenements){if(aParam.listeEvenements.GetNbrElements()===0){H.push(this.composeAucuneDonnee(GTraductions.getValeur('Agenda.AucunEvenementPublie')));} else{H.push('<ul class="collection with-header bg-white" role="list">');var lDate,lDateCumul;var lDateCourante=_getDateCourante(aParam.listeEvenements);for(var I=0;I<aParam.listeEvenements.GetNbrElements();I++){var lEvenement=aParam.listeEvenements.GetElement(I);lDateCumul=lEvenement.DateDebut;if(!GDate.estJourEgal(lDate,lDateCumul)){H.push('<li ',(lDateCourante&&GDate.estJourEgal(lDateCourante,lDateCumul)?' id="'+lIdSelection+'"':''),' class="collection-header">',GDate.FormatDate(lDateCumul,'['+'%JJJJ %J %MMMM'+']'),'</li>');}
lDate=lDateCumul;H.push('<li class="collection-item" data-index="'+I+'" data-numero="'+lEvenement.GetNumero()+'" data-genre="'+lEvenement.GetGenre()+'">');H.push('<div style="padding-left: 5px; border-left: 5px solid '+lEvenement.CouleurCellule+';">');if(lEvenement.listeEleves&&lEvenement.listeEleves.length>0){H.push('<div style="float: right;margin-left: 5px;color: #b3b3b3; max-width: 90px;">'+lEvenement.listeEleves.join(', ')+'</div>');}
H.push('<div class="title">',lEvenement.GetLibelle(),'</div>');var lArrayInformationsEvenement=aParam.listeEvenements._getLibelleEvenement({evenement:lEvenement,avecTitre:false,avecDetailConseil:true,avecDateDuJour:false});if(!!lArrayInformationsEvenement){for(var J=0;J<lArrayInformationsEvenement.length;J++){if(lArrayInformationsEvenement[J]){H.push('<div>',lArrayInformationsEvenement[J],'</div>');}}}
if(!!lEvenement.listeDocJoints&&lEvenement.listeDocJoints.GetNbrElements()>0){H.push('<div>');lEvenement.listeDocJoints.parcourir(function(aDocumentJoint){H.push(GChaine.composerUrlLienExterne({documentJoint:aDocumentJoint,genreRessource:EGenreRessource.DocJointEtablissement})+'<br />');});H.push('</div>');}
if(lEvenement.visio){H.push(tag('i',{class:['btn-lien-visio',UtilitaireVisios.getNomIconePresenceVisios()],'ie-node':tag.funcAttr('getNodeVisio',I)}));}
H.push('</li>');}
H.push('</ul>');}}
GHtml.setHtml(this.Nom,H.join(''),{controleur:this.controleur});var lJQSelection=$('#'+lIdSelection.escapeJQ());if(lJQSelection.length===1){if(document.getElementById(lIdSelection)&&document.getElementById(lIdSelection).scrollIntoView){document.getElementById(lIdSelection).scrollIntoView(true);}}
this.doForMobileApp();}
module.exports=InterfacePageAgenda;},fn:"mobile/script/interfacepageagenda.js"});;
IE.fModule({f:function(exports,require,module,global){const{GDate}=require('ObjetDate.js');const Identite=require('ObjetIdentite.js');const ObjetElement=require('ObjetElement.js');const ObjetListeElements=require('ObjetListeElements.js');const tag=require('tag.js');const GTraductions=require('ObjetTraduction.js');require('ObjetCalendrierPeriode.css');class ObjetCalendrierPeriode extends Identite{constructor(...aParams){super(...aParams);this.options={premiereDate:GParametres.PremiereDate,derniereDate:GParametres.DerniereDate,avecJourCourant:true,avecJoursNonOuvres:true,avecJoursFeries:true,avecPeriodes:false,marquageJoursAvantDate:null,avecZoneDateUnique:false,journeeAvecClass:null,domaineOuvres:GParametres.JoursOuvres,avecEdition:false,avecEditionJoursFeries:false,avecEditionJoursNonOuvres:false};this.SetParametres();}
getControleur(aInstance){return $.extend(true,super.getControleur(aInstance),{getHint:function(aDate){const H=[];const lDate=GDate.getDateJour(new Date(aDate));H.push(tag('div',GDate.FormatDate(lDate,'%JJJJ %JJ %MMMM %AAAA').ucfirst()));if(!!aInstance.donnees.feries){for(let i=0,lNbr=aInstance.donnees.feries.GetNbrElements();i<lNbr;i++){const lFeries=aInstance.donnees.feries.GetElement(i);if(lDate>=aInstance.options.premiereDate&&GDate.getDateJour(lFeries.dateDebut)<=lDate&&GDate.getDateJour(lFeries.dateFin)>=lDate&&lDate<=aInstance.options.derniereDate){H.push(tag('div',lFeries.GetLibelle()));}}}
if(!!aInstance.donnees.Zones){for(let i=0,lNbr=aInstance.donnees.Zones.GetNbrElements();i<lNbr;i++){const lZone=aInstance.donnees.Zones.GetElement(i);lZone.donnees.parcourir(function(aJour){if(lDate>=aInstance.options.premiereDate&&GDate.getDateJour(aJour.dateDebut)<=lDate&&GDate.getDateJour(aJour.dateFin)>=lDate&&lDate<=aInstance.options.derniereDate){const lLibelle=!!aJour.GetLibelle()?aJour.GetLibelle():lZone.libelleLegende;H.push(tag('div',{class:'CalendrierPeriode flex-contain EspaceHaut'},tag('span',{class:!!lZone.class?lZone.class.join(' '):'',style:'width:2rem;height:2rem;border-radius:50%;margin-right:0.8rem;'+(!!lZone.couleur?'background-color:'+lZone.couleur+';':'')}),tag('div',{style:'align-self:center;'},lLibelle)));if(!!lZone.icon&&!!lZone.libelleIcon){H.push(tag('div',{class:'CalendrierPeriode'},tag('div',{class:'legende-ObjetCalendrier flex-contain EspaceHaut'},tag('span',{class:'legende-icon '+lZone.icon}),tag('div',{style:'align-self:center;margin-left:0.8rem;'},lZone.libelleIcon))));}}});}}
if(!!aInstance.donnees.periodes){for(let i=0,lNbr=aInstance.donnees.periodes.GetNbrElements();i<lNbr;i++){const lPeriode=aInstance.donnees.periodes.GetElement(i);lPeriode.donnees.parcourir(function(aJour){if(lDate>=aInstance.options.premiereDate&&GDate.getDateJour(aJour.dateDebut)<=lDate&&GDate.getDateJour(aJour.dateFin)>=lDate&&lDate<=aInstance.options.derniereDate){H.push(tag('div',{class:'flex-contain EspaceHaut'},tag('span',{style:'align-self:center;width:2rem;height:0.3rem;border-radius:1rem;margin-right:0.8rem;background-color:'+lPeriode.couleur+';'}),tag('div',{style:'align-self:center;'},lPeriode.GetLibelle())));}});}}
return H.join('');},surEdition:function(aDate){$(this.node).on({click:function(){const lDateClick=GDate.getDateJour(new Date(aDate));let lFeriesClick=null;if(!!aInstance.donnees.feries){for(let i=0,lNbr=aInstance.donnees.feries.GetNbrElements();i<lNbr;i++){const lFeries=aInstance.donnees.feries.GetElement(i);if(lDateClick>=aInstance.options.premiereDate&&GDate.getDateJour(lFeries.dateDebut)<=lDateClick&&GDate.getDateJour(lFeries.dateFin)>=lDateClick&&lDateClick<=aInstance.options.derniereDate){lFeriesClick=lFeries;}}}
if((lFeriesClick&&!aInstance.options.avecEditionJoursFeries)||(!aInstance.donnees.joursNonOuvres.domaine.GetValeur(lDateClick.getDay())&&!aInstance.options.avecEditionJoursNonOuvres)){return null;}
let lZoneClick=null;if(!!aInstance.donnees.Zones){for(let i=0,lNbr=aInstance.donnees.Zones.GetNbrElements();i<lNbr;i++){const lZone=aInstance.donnees.Zones.GetElement(i);lZone.donnees.parcourir(function(aJour){if(lDateClick>=aInstance.options.premiereDate&&GDate.getDateJour(aJour.dateDebut)<=lDateClick&&GDate.getDateJour(aJour.dateFin)>=lDateClick&&lDateClick<=aInstance.options.derniereDate){lZoneClick=lZone;}});}}
let lPeriodeClick=null;if(!!aInstance.donnees.periodes){for(let i=0,lNbr=aInstance.donnees.periodes.GetNbrElements();i<lNbr;i++){const lPeriode=aInstance.donnees.periodes.GetElement(i);lPeriode.donnees.parcourir(function(aJour){if(lDateClick>=aInstance.options.premiereDate&&GDate.getDateJour(aJour.dateDebut)<=lDateClick&&GDate.getDateJour(aJour.dateFin)>=lDateClick&&lDateClick<=aInstance.options.derniereDate){lPeriodeClick=lPeriode;}});}}
aInstance.callback.appel({date:lDateClick,feries:lFeriesClick,periode:lPeriodeClick,zone:lZoneClick});}});}});}
SetParametres(aOptions){$.extend(true,this.options,aOptions);this.Afficher();}
SetDonnees(aDonnees){let lDate,lElement;if($.isEmptyObject(this.options)){this.SetParametres();}
this.donnees={};if(aDonnees){$.extend(true,this.donnees,aDonnees);}
if(this.options.avecJoursNonOuvres){this.donnees.joursNonOuvres={donnees:new ObjetListeElements(),domaine:this.options.domaineOuvres};for(lDate=new Date(this.options.premiereDate.getTime());lDate<=this.options.derniereDate;lDate.setDate(lDate.getDate()+1)){if(this.donnees.joursNonOuvres.domaine.GetValeur(GDate.GetJourDeDate(lDate)+1)){continue;}
lElement=new ObjetElement();lElement.date=new Date(lDate.getTime());this.donnees.joursNonOuvres.donnees.AddElement(lElement);}}
if(this.options.avecJoursFeries){this.donnees.joursFeries={donnees:new ObjetListeElements(),domaine:GParametres.JoursFeries};if(!!this.donnees.feries){this.donnees.feries.parcourir((aJoursFeries) =>{for(lDate=new Date(aJoursFeries.dateDebut);lDate<=aJoursFeries.dateFin;lDate.setDate(lDate.getDate()+1)){lElement=new ObjetElement();lElement.date=new Date(lDate.getTime());this.donnees.joursFeries.donnees.AddElement(lElement);}});} else{for(lDate=new Date(this.options.premiereDate.getTime());lDate<=this.options.derniereDate;lDate.setDate(lDate.getDate()+1)){if(!this.donnees.joursFeries.domaine.GetValeur(GDate.getNbrJoursDepuisPremiereLundi(lDate)+1)){continue;}
lElement=new ObjetElement();lElement.date=new Date(lDate.getTime());this.donnees.joursFeries.donnees.AddElement(lElement);}}}
this.Afficher();if(!!this.donnees.joursFeries){this.donnees.joursFeries.donnees.parcourir(function(aJourFerie){let lCelluleDate=$('.conteneur-ObjetCalendrier').find('td[data-date="'+aJourFerie.date.toDateString()+'"]');if(!!lCelluleDate&&!!lCelluleDate.get(0)){lCelluleDate.addClass('date-joursFeries');if(!this.options.avecEditionJoursFeries&&this.options.avecZoneDateUnique){lCelluleDate=$('.conteneur-ObjetCalendrier').find('td[data-date="'+aJourFerie.date.toDateString()+'"] div.dates > div');if(!!lCelluleDate){lCelluleDate.removeClass('AvecEdition');}}}}.bind(this));}
if(!!this.donnees.joursNonOuvres){this.donnees.joursNonOuvres.donnees.parcourir(function(aJourOuvre){let lCelluleDate=$('.conteneur-ObjetCalendrier').find('td[data-date="'+aJourOuvre.date.toDateString()+'"]');if(!!lCelluleDate&&!!lCelluleDate.get(0)){lCelluleDate.addClass('date-joursNonOuvres');if(!this.options.avecEditionJoursNonOuvres&&this.options.avecZoneDateUnique){lCelluleDate=$('.conteneur-ObjetCalendrier').find('td[data-date="'+aJourOuvre.date.toDateString()+'"] div.dates > div');if(!!lCelluleDate){lCelluleDate.removeClass('AvecEdition');}}}}.bind(this));}
if(!!this.donnees.Zones){for(let i=0,lNbr=this.donnees.Zones.GetNbrElements();i<lNbr;i++){const lZone=this.donnees.Zones.GetElement(i);lZone.donnees.parcourir(function(aJour){for(let lDate=new Date(aJour.dateDebut);lDate<=aJour.dateFin&&lDate<=this.options.derniereDate;lDate.setDate(lDate.getDate()+1)){if(lDate>=this.options.premiereDate){let lCelluleDate=$('.conteneur-ObjetCalendrier').find('td[data-date="'+lDate.toDateString()+'"] div.dates').first();if(!!lCelluleDate&&!!lCelluleDate.get(0)){if(!!lCelluleDate.get(0).dataset.zone&&!this.options.avecZoneDateUnique){if(lCelluleDate.get(0).dataset.zone!==lZone.id){if(lDate.getTime()===aJour.dateDebut.getTime()){const lDateJourAvant=new Date(lDate);lDateJourAvant.setDate(lDate.getDate()-1);const lCelluleDateAvant=$('.conteneur-ObjetCalendrier').find('td[data-date="'+lDateJourAvant.toDateString()+'"] div.dates').first();if(!!lCelluleDateAvant&&!!lCelluleDateAvant.get(0)&&lCelluleDateAvant.get(0).dataset.zone&&lCelluleDateAvant.get(0).dataset.zone!==lZone.id){lCelluleDateAvant.addClass('date-periodeFin');}}
if(lDate.getTime()===aJour.dateFin.getTime()){const lDateJourApres=new Date(lDate);lDateJourApres.setDate(lDate.getDate()+1);const lCelluleDateApres=$('.conteneur-ObjetCalendrier').find('td[data-date="'+lDateJourApres.toDateString()+'"] div.dates').first();if(!!lCelluleDateApres&&!!lCelluleDateApres.get(0)&&lCelluleDateApres.get(0).dataset.zone&&lCelluleDateApres.get(0).dataset.zone!==lZone.id){lCelluleDateApres.addClass('date-periodeDebut');}}}
lCelluleDate.removeClass('date-periodeDebut');lCelluleDate.removeClass('date-periodeFin');}
lCelluleDate.attr('aria-hidden',false);if(this.options.avecZoneDateUnique){lCelluleDate=$('.conteneur-ObjetCalendrier').find('td[data-date="'+lDate.toDateString()+'"] div.dates > div');}
if(!!lCelluleDate){if(!!lZone.class){lCelluleDate.addClass(lZone.class.join(' '));}
if(!!lZone.couleur){lCelluleDate.attr('style','background-color:'+lZone.couleur+';color:'+(!!lZone.couleurTexte?lZone.couleurTexte:'black')+';font-weight:600;');}
if(!!lZone.icon){lCelluleDate.addClass(lZone.icon);}
if(!!lZone.ariaLabel){lCelluleDate.attr('aria-label',lZone.ariaLabel);}
lCelluleDate.removeClass('AvecEdition');lCelluleDate.attr('data-zone',lZone.id);}}}}
if(!this.options.avecZoneDateUnique){const lCelluleDateDebut=$('.conteneur-ObjetCalendrier').find('td[data-date="'+aJour.dateDebut.toDateString()+'"] div.dates').first();if(!!lCelluleDateDebut&&!!lCelluleDateDebut.get(0)){lCelluleDateDebut.addClass('date-periodeDebut');}
const lCelluleDateFin=$('.conteneur-ObjetCalendrier').find('td[data-date="'+aJour.dateFin.toDateString()+'"] div.dates').first();if(!!lCelluleDateFin&&!!lCelluleDateFin.get(0)){lCelluleDateFin.addClass('date-periodeFin');}}}.bind(this));}}
if(!!this.donnees.periodes&&this.options.avecPeriodes){for(let i=0,lNbr=this.donnees.periodes.GetNbrElements();i<lNbr;i++){const lPeriode=this.donnees.periodes.GetElement(i);lPeriode.donnees.parcourir(function(aJour){for(let lDate=new Date(aJour.dateDebut);lDate<=aJour.dateFin&&lDate<=this.options.derniereDate;lDate.setDate(lDate.getDate()+1)){if(lDate>=this.options.premiereDate){const lCelluleDate=$('.conteneur-ObjetCalendrier').find('td[data-date="'+lDate.toDateString()+'"] div.conteneur-periodes').first();if(!!lCelluleDate&&!!lCelluleDate.get(0)){lCelluleDate.IEHtmlAppend(tag('div',{style:'background-color:'+lPeriode.couleur+';'}));}}}}.bind(this));}}
if(this.options.avecJourCourant){const lCelluleDateAJD=$('.conteneur-ObjetCalendrier').find('td[data-date="'+GDate.aujourdhui.toDateString()+'"] > div');if(!!lCelluleDateAJD&&!!lCelluleDateAJD.get(0)){lCelluleDateAJD.addClass('date-aujourdhui');}}}
ConstruireAffichage(){const H=[];if(!!this.donnees){H.push('<div class="conteneur-ObjetCalendrier SansSelectionTexte">');let lMoisActuel=this.options.premiereDate.getMonth();let lAnneeActuelle=this.options.premiereDate.getFullYear();const lNbrMois=GDate.NombreMoisSurPeriode(this.options.premiereDate,this.options.derniereDate);for(let i=0;i<lNbrMois;i++){if(lMoisActuel===12){lMoisActuel=0;lAnneeActuelle++;}
const lParam={};if(i===0||i===lNbrMois-1){lParam.date=i===0?this.options.premiereDate:this.options.derniereDate;lParam.avantDate=i===0;}
H.push(this.composeHtmlMois(lMoisActuel,lAnneeActuelle,lParam));lMoisActuel++;}
H.push('</div>');}
return H.join('');}
composeHtmlMois(aMois,aAnnee,aParams){const H=[];H.push('<div class="conteneur-mois">');H.push(tag('div',{class:'nom-mois'},GTraductions.getValeur('Mois')[aMois].ucfirst()+'&nbsp;'+aAnnee));H.push('<table cellspacing="0">');H.push('<tr class="ligne-journee">');for(let i=0;i<7;i++){let lJourneeClass=this.options.domaineOuvres.GetValeur(i+1)||!this.options.avecJoursNonOuvres?'':'journee-nonOuvre';if(!!this.options.journeeAvecClass){this.options.journeeAvecClass.forEach((aJourneeClass) =>{lJourneeClass=!!aJourneeClass&&aJourneeClass.jours.GetValeur(i+1)?aJourneeClass.class:lJourneeClass;});}
H.push(tag('td',{class:lJourneeClass},GTraductions.getValeur('JoursCourt')[i].ucfirst()));}
H.push('</tr>');let lIndiceJour=1;let lJour=new Date(aAnnee,aMois,lIndiceJour);let lDay=GDate.GetJourDeDate(lJour);if(lDay!==0){H.push('<tr class="ligne-date">');for(let i=0;i<lDay;i++){H.push('<td></td>');}}
while(aMois===lJour.getMonth()){if(lDay===0){H.push('<tr class="ligne-date">');}
let lClassChiffre='';if(!!aParams&&!!aParams.date){if(aParams.avantDate){if(lIndiceJour<aParams.date.getDate()){lClassChiffre='date-horsPeriode';}} else{if(lIndiceJour>aParams.date.getDate()){lClassChiffre='date-horsPeriode';}}}
const lAvecEdition=this.options.avecEdition&&!(this.options.marquageJoursAvantDate&&GDate.estAvantJour(lJour,this.options.marquageJoursAvantDate));H.push(tag('td',{class:lClassChiffre,'data-date':lJour.toDateString(),'ie-hint':'getHint(\''+lJour+'\')'},tag('div',{class:(this.options.avecZoneDateUnique?'unique':'')},tag('div',{class:'dates'+(!!this.options.marquageJoursAvantDate&&GDate.estAvantJour(lJour,this.options.marquageJoursAvantDate)?' avant-date':'')+(!this.options.avecZoneDateUnique?' non-unique':''),'aria-hidden':'true','ie-node':lAvecEdition?`surEdition('${lJour}')`:''},this.options.avecZoneDateUnique?tag('div',{class:'dates-uniques'+(lAvecEdition?' AvecEdition':'')},lJour.getDate()):lJour.getDate()),this.options.avecPeriodes?tag('div',{class:'conteneur-periodes'}):'')));if(lDay===6){H.push('</tr>');}
lIndiceJour++;lJour=new Date(aAnnee,aMois,lIndiceJour);lDay=GDate.GetJourDeDate(lJour);}
H.push('</tr>');H.push('</table>');H.push('</div>');return H.join('');}
composeLegende(aParams){let lListeZones=new ObjetListeElements();if(!!aParams.listeZones){aParams.listeZones.parcourir(aZone =>{lListeZones.add(aZone);});lListeZones.trier();}
const T=[];T.push('<div class="legende-ObjetCalendrier">');if(!!aParams.donnees){T.push(tag('div',{class:'flex-contain'},tag('span',{class:'EspaceDroit'},GTraductions.getValeur('VacancesEtJoursFeries')),tag('span',{class:'legende-joursFeries'})));T.push(tag('div',{class:'flex-contain'},tag('span',GTraductions.getValeur('Aujourdhui')),tag('span',{class:'legende-aujourdhui'})));if(!!lListeZones&&lListeZones.GetNbrElements()){T.push('<div>');T.push(tag('h5',{class:'ie-titre'},!!aParams.libelleZones?aParams.libelleZones:GTraductions.getValeur('EntrepriseOuFormation')));for(let i=0;i<lListeZones.GetNbrElements();i++){const lZone=lListeZones.GetElement(i);T.push(tag('div',{class:'flex-contain'},tag('ie-checkbox ',{class:'legende-cb','ie-textright':true,'ie-model':'cbSelectZone('+lZone.GetPosition()+')'},lZone.libelleLegende),tag('span',{class:!!lZone.class?lZone.class.join(' '):'',style:'width:2rem;height:2rem;border-radius:50%;margin-left:auto;'+(!!lZone.couleur?'background-color:'+lZone.couleur+';':'')})));}
T.push('</div>');}
if(!!aParams.listePeriodes&&aParams.listePeriodes.GetNbrElements()){T.push('<div>');T.push(tag('h5',{class:'ie-titre'},!!aParams.libellePeriodes?aParams.libellePeriodes:GTraductions.getValeur('Periodes')));for(let i=0;i<aParams.listePeriodes.GetNbrElements();i++){const lPeriode=aParams.listePeriodes.GetElement(i);T.push(tag('div',{class:'flex-contain'},tag('ie-checkbox ',{class:'legende-cb','ie-textright':true,'ie-model':'cbSelectPeriode('+i+')'},lPeriode.GetLibelle()),tag('span',{style:'width:2rem;height:0.3rem;border-radius:1rem;margin-left:auto;background-color:'+lPeriode.couleur+';'})));}
T.push('</div>');}}
T.push('</div>');return T.join('');}}
module.exports=ObjetCalendrierPeriode;},fn:"objetcalendrierperiode.js"});;
IE.fModule({f:function(exports,require,module,global){const EStructureAffichage=require('Enumere_StructureAffichage.js');const ObjetCalendrierPeriode=require('ObjetCalendrierPeriode.js');const{GDate}=require('ObjetDate.js');const GTraductions=require('ObjetTraduction.js');const{GObjetWAI,EGenreRole,EGenreAttribut}=require('ObjetWAI.js');const EGenreOnglet=require('Enumere_Onglet.js');const InterfacePage_Mobile=require('InterfacePage_Mobile.js');const ObjetBoutonFlottant=require('ObjetBoutonFlottant.js');const ObjetFenetre=require('ObjetFenetre.js');class InterfacePageVacances extends InterfacePage_Mobile{constructor(...aParams){super(...aParams);this.idLegende=this.Nom+'_legende';}
ConstruireInstances(){this.IdentVacances=this.Add(ObjetCalendrierPeriode);}
SetParametresGeneraux(){this.IdentZoneAlClient=this.IdentVacances;this.GenreStructure=EStructureAffichage.Autre;this.avecBandeau=true;}
ConstruireStructureAffichageAutre(){const H=[];H.push('<div class="CalendrierPeriode">');H.push('<div id="'+this.Instances[this.IdentVacances].GetNom()+'"></div>');H.push('<div class="bt-contain" ie-identite="getIdentiteBouton"></div>');H.push('</div>');return H.join('');}
getControleur(aInstance){return $.extend(true,super.getControleur(aInstance),{getIdentiteBouton:function(){return{class:ObjetBoutonFlottant,pere:this,init:function(aBtn){aInstance.btnFlottant=aBtn;const lParam={listeBoutons:[{icone:"icon_diffuser_information",callback:_afficherLegende.bind(aInstance)}]};aBtn.setOptionsBouton(lParam);}};}});}
composeLegende(){const T=[];T.push(this.GetInstance(this.IdentVacances).composeLegende({donnees:GParametres.listeJoursFeries}));T.push('<div id="'+this.Nom+'_WAI" tabindex="0" class="Texte10 Espace" style="position:sticky;top:8.5rem;" ',GObjetWAI.composeRole(EGenreRole.List),' ',GObjetWAI.composeAttribut({genre:EGenreAttribut.label,valeur:GTraductions.getValeur('Onglet.Libelle')[EGenreOnglet.Vacances]}),'>',this.composeListeLibelles(),'</div>');return T.join('');}
composeListeLibelles(){const lHtml=[];for(let i=0;i<GParametres.listeJoursFeries.GetNbrElements();i++){const lElement=GParametres.listeJoursFeries.GetElement(i);if(lElement.GetLibelle()){const LPeriode=GDate.estDateEgale(lElement.dateDebut,lElement.dateFin)?GTraductions.getValeur('Le')+' '+GDate.FormatDate(lElement.dateDebut,'%JJ %MMMM'):GTraductions.getValeur('Du')+' '+GDate.FormatDate(lElement.dateDebut,'%JJ %MMMM')+' '+GTraductions.getValeur('Au')+' '+GDate.FormatDate(lElement.dateFin,'%JJ %MMMM');lHtml.push('<div tabindex="0" ',GObjetWAI.composeAttribut({genre:EGenreAttribut.label,valeur:lElement.GetLibelle()+":"+LPeriode}),' ',GObjetWAI.composeAttribut({genre:EGenreAttribut.readonly,valeur:'true'}),' ',GObjetWAI.composeRole(EGenreRole.Listitem),' class="EspaceBas GrasSurFocus">',lElement.GetLibelle(),' : ');lHtml.push('<div class="Gras">',LPeriode,'</div></div>');}}
return lHtml.join('');}
RecupererDonnees(){this.Instances[this.IdentVacances].SetDonnees({feries:GParametres.listeJoursFeries});}}
function _afficherLegende(){const lFenetre=ObjetFenetre.creerInstance(ObjetFenetre,{pere:this,initialiser:function(aInstance){aInstance.setOptionsFenetre({titre:GTraductions.getValeur('Legende'),avecScroll:true});}});lFenetre.Afficher('<div class="CalendrierPeriode" id="'+this.idLegende+'">'+this.composeLegende()+'</div>');}
module.exports=InterfacePageVacances;},fn:"mobile/script/interfacepagevacances.js"});;
IE.fModule({f:function(exports,require,module,global){const{ObjetRequeteConsultation}=require('ObjetRequeteJSON.js');const Requetes=require('CollectionRequetes.js');const ObjetElement=require('ObjetElement.js');class ObjetRequeteMethodeCalculMoyenne extends ObjetRequeteConsultation{constructor(...aParams){super(...aParams);}
lancerRequete(aParametres){this.JSON={Eleve:new ObjetElement(null,aParametres.numeroEleve),Classe:new ObjetElement(null,aParametres.numeroClasse),Service:new ObjetElement(null,aParametres.numeroServiceNotation),Periode:new ObjetElement(null,aParametres.numeroPeriodeNotation,aParametres.genreChoixNotation),MoyenneTrimestrielle:aParametres.moyenneTrimestrielle,MoyenneNette:aParametres.pourMoyenneNette,OrdreChronologique:aParametres.ordreChronologique};return this.appelAsynchrone();}
actionApresRequete(){this.callbackReussite.appel(this.JSONReponse);}}
Requetes.inscrire('MethodeCalculMoyenne',ObjetRequeteMethodeCalculMoyenne);module.exports=ObjetRequeteMethodeCalculMoyenne;},fn:"objetrequetemethodecalculmoyenne.js"});;
IE.fModule({f:function(exports,require,module,global){require('Espace/Css/DescriptionCalculMoyenne.css');const ObjetRequeteMethodeCalculMoyenne=require('ObjetRequeteMethodeCalculMoyenne.js');const GChaine=require('GChaine.js');const ObjetFenetre=require('ObjetFenetre.js');const GTraductions=require('ObjetTraduction.js');class ObjetFenetre_MethodeCalculMoyenne extends ObjetFenetre{constructor(...aParams){super(...aParams);this.donneesRecues=false;}
composeTitreFormule(){if(this.titreFenetre){this.setOptionsFenetre({titre:this.titreFenetre+'&nbsp;'});}
if(this.titreFormule){return this.titreFormule;}
const lLibelleMatiere=this.parametresCalcul.module?this.parametresCalcul.module.GetLibelle():(this.parametresCalcul.service?(this.parametresCalcul.service.matiere?this.parametresCalcul.service.matiere.GetLibelle():this.parametresCalcul.service.GetLibelle()):'');let lTitre;if(lLibelleMatiere.length>0){lTitre=this.parametresCalcul.pourMoyenneNette?GTraductions.getValeur('BulletinEtReleve.FenetreCalculMoyenneNetteAvecMatiere'):GTraductions.getValeur('BulletinEtReleve.FenetreCalculMoyenneBruteAvecMatiere');} else{lTitre=this.parametresCalcul.pourMoyenneNette?GTraductions.getValeur('BulletinEtReleve.FenetreCalculMoyenneNette'):GTraductions.getValeur('BulletinEtReleve.FenetreCalculMoyenneBrute');}
return GChaine.Format(lTitre,[this.parametresCalcul.libelleEleve,lLibelleMatiere]);}
ComposeContenu(){const T=[];if(this.donneesRecues){T.push('<div class="Texte10 Espace Gras" style="margin-bottom: 5px;">',this.composeTitreFormule(),'</div>');T.push('<div class="Texte10 Espace FondBlanc MethodeCalculMoyenne">'+this.formuleHTML+'</div>');}
return T.join('');}
SetDonnees(aParametresCalcul){this.parametresCalcul=aParametresCalcul;new ObjetRequeteMethodeCalculMoyenne(this,this.actionSurReponseRequete).lancerRequete(aParametresCalcul);}
actionSurReponseRequete(aJSON){this.formuleHTML=aJSON.FormuleHTML;this.donneesRecues=true;if(IE.estMobile){this.Afficher(this.ComposeContenu());} else{this.titreFormule=aJSON.titreFormule;this.titreFenetre=aJSON.titreFenetre;this.Actualiser();this.Afficher();}}}
module.exports=ObjetFenetre_MethodeCalculMoyenne;},fn:"objetfenetre_methodecalculmoyenne.js"});;
IE.fModule({f:function(exports,require,module,global){const GChaine=require('GChaine.js');const{GDate}=require('ObjetDate.js');const ObjetIdentite_Mobile=require('ObjetIdentite_Mobile.js');const ObjetListeElements=require('ObjetListeElements.js');const GTraductions=require('ObjetTraduction.js');const UtilitaireBulletinEtReleve_Mobile=require('UtilitaireBulletinEtReleve_Mobile.js');const EGenreDocumentJoint=require('Enumere_DocumentJoint.js');const ObjetElement=require('ObjetElement.js');const TypeFichierExterneHttpSco=require('TypeFichierExterneHttpSco.js').TypeFichierExterneHttpSco;const ObjetFenetre_MethodeCalculMoyenne=require('ObjetFenetre_MethodeCalculMoyenne.js');const ObjetFenetre=require('ObjetFenetre.js');const ObjetMoteurReleveBulletin=require('ObjetMoteurReleveBulletin.js').ObjetMoteurReleveBulletin;class ObjetDernieresNotes extends ObjetIdentite_Mobile{constructor(...aParams){super(...aParams);this.donneesRecues=false;this.triParMatiere=false;this.Service=null;this.construireObjets();this.moteur=new ObjetMoteurReleveBulletin();}
SetDonnees(aListeDevoirs,aEstTriParMatiere,aAvecDetailService,aAvecDetailDevoir,aMoyenneGenerale,aPeriode){if(aListeDevoirs){this.donneesRecues=true;this.listeDevoirs=aListeDevoirs;this.avecDetailService=aAvecDetailService;this.avecDetailDevoir=aAvecDetailDevoir;this.triParMatiere=aEstTriParMatiere;this.message=false;this.moyenneGenerale=aMoyenneGenerale;this.Periode=aPeriode;this.Afficher();}}
SetMessage(aMessage){this.message=aMessage;this.Afficher();}
construireObjets(){this.identFenetreMethodeCalculMoyenne=ObjetFenetre.creerInstance(ObjetFenetre_MethodeCalculMoyenne,{pere:this,initialiser:this.initialiserMethodeCalculMoyenne});this.identFenetreMethodeCalculMoyenne.destructionSurFermeture=false;}
initialiserMethodeCalculMoyenne(aInstance){aInstance.setOptionsFenetre({titre:GTraductions.getValeur('DernieresNotes.DetailsMethodeCalcMoy'),largeur:600,hauteur:300,listeBoutons:[GTraductions.getValeur('principal.fermer')],modale:false,avecRetaillage:false,avecScroll:false,largeurMin:600,hauteurMin:150});}
getControleur(aInstance){return $.extend(true,super.getControleur(this),{btnCalculMoyenne:{event:function(){aInstance.surClicMethodeCalculMoyenne();}}});}
ConstruireAffichage(){var lHtml=[];const lIconeEtoile='<i class="icon icon_star EspaceDroit"></i>';if(!!this.message){lHtml.push(this.composeAucuneDonnee(this.message));} else if(this.donneesRecues){var lService,lNumService,lDevoir,lEstBaremeParDefaut,lNbDevoirs=this.listeDevoirs.GetNbrElements();if(!this.triParMatiere){lHtml.push('<ul class="collection">');for(var i=0;i<lNbDevoirs;i++){lDevoir=this.listeDevoirs.GetElement(i);const lNoteAuDessusBareme=(lDevoir.note&&lDevoir.bareme&&lDevoir.note.getValeur()>lDevoir.bareme.getValeur());const lStrEtoile=lNoteAuDessusBareme?lIconeEtoile:'';lEstBaremeParDefaut=lDevoir.bareme.getValeur()===lDevoir.baremeParDefaut.getValeur()&&!lNoteAuDessusBareme;lHtml.push('<li class="collection-item with-action" onclick="',this.Nom,'.evenementSurClickDevoir(event, \'',lDevoir.GetNumero(),'\')" style="padding: 3px 12px;">');lHtml.push('<div style="padding: 10px 0 10px 5px; border-left: 5px solid '+(!!lDevoir.service.couleur&&lDevoir.service.couleur!==""?lDevoir.service.couleur:'#D4D4D4')+';">');lHtml.push('<div class="title" style="margin-right: 45px;">',lDevoir.service.GetLibelle(),'</div>');lHtml.push('<div class="AlignementHaut InlineBlock">',GDate.FormatDate(lDevoir.date,'['+GTraductions.getValeur('Le')+' %J %MMMM'+']'),'&nbsp;','</div>');if(!!lDevoir.moyenne&&lDevoir.moyenne.getNote()!==""){lHtml.push('<div class="AlignementHaut InlineBlock ">','(',(lDevoir.estEnGroupe?GTraductions.getValeur('accueil.moyGroupe'):GTraductions.getValeur('accueil.moyClasse')),'&nbsp;:&nbsp;',lDevoir.moyenne.getNote(),(lEstBaremeParDefaut?'':lDevoir.bareme.getBaremeEntier()),')','</div>');}
lHtml.push('<div class="secondary-content">');lHtml.push('<div class="Gras">',lStrEtoile,lDevoir.note.getNote(),'</div>',(lEstBaremeParDefaut?'':'<div class="right-align">'+lDevoir.bareme.getBaremeEntier()+'</div>'));lHtml.push('</div>');lHtml.push('<div class="EspaceHaut">');var lDocumentJoint,lLien;if(!!lDevoir.libelleCorrige){lDocumentJoint=new ObjetElement(lDevoir.libelleCorrige,lDevoir.GetNumero(),EGenreDocumentJoint.Fichier);lLien=GChaine.composerUrlLienExterne({documentJoint:lDocumentJoint,genreRessource:TypeFichierExterneHttpSco.DevoirCorrige,libelleEcran:GTraductions.getValeur('AfficherCorrige')});lHtml.push('<div class="right" style="padding-left: 10px;">',lLien,'</div>');}
if(!!lDevoir.libelleSujet){lDocumentJoint=new ObjetElement(lDevoir.libelleSujet,lDevoir.GetNumero(),EGenreDocumentJoint.Fichier);lLien=GChaine.composerUrlLienExterne({documentJoint:lDocumentJoint,genreRessource:TypeFichierExterneHttpSco.DevoirSujet,libelleEcran:GTraductions.getValeur('AfficherSujet')});lHtml.push('<div class="right">',lLien,'</div>');}
lHtml.push('<div class="clear"></div>');lHtml.push('</div>');lHtml.push('</div>');lHtml.push('</li>');}
lHtml.push('</ul>');} else{var lListeServices=this.getListeServices();var lNbrServices=lListeServices.GetNbrElements();lHtml.push('<ul class="collection with-header bg-white">');for(var j=0;j<lNbrServices;j++){lService=lListeServices.GetElement(j),lNumService=lService.GetNumero();lHtml.push('<li class="collection-header with-action" onclick="',this.Nom,'.evenementSurClickService(event, \'',lNumService,'\')" style="padding:3px 5px;">');lHtml.push('<div style="padding: 10px 5px; border-left: 5px solid '+(!!lService.couleur&&lService.couleur!==""?lService.couleur:'#D4D4D4')+';">');lHtml.push('<div class="left">',lService.GetLibelle(),'</div>');if(!!lService.moyEleve||lService.estMoyNR===true){var T=[];var lAvecMoyEleve=lService.moyEleve!==null&&lService.moyEleve!==undefined;if(lService.estMoyNR===true){T.push('<div>',this.moteur.composeHtmlMoyNR(),'</div>');}
if(lAvecMoyEleve){T.push(lService.moyEleve.getNote());}
lHtml.push('<div class="right">',T.join(''),'</div>');}
lHtml.push('<div class="clear"></div>');lHtml.push('</div>');lHtml.push('</li>');for(var k=0;k<lNbDevoirs;k++){if(lNumService===this.listeDevoirs.GetElement(k).service.GetNumero()){lDevoir=this.listeDevoirs.GetElement(k);const lNoteAuDessusBareme=(lDevoir.note&&lDevoir.bareme&&lDevoir.note.getValeur()>lDevoir.bareme.getValeur());lEstBaremeParDefaut=lDevoir.bareme.getValeur()===lDevoir.baremeParDefaut.getValeur()&&!lNoteAuDessusBareme;const lStrEtoile=lNoteAuDessusBareme?lIconeEtoile:'';lHtml.push('<li class="collection-item with-action" onclick="',this.Nom,'.evenementSurClickDevoir(event, \'',lDevoir.GetNumero(),'\')">');lHtml.push('<div class="left">');lHtml.push('<div class="AlignementHaut InlineBlock">',GDate.FormatDate(lDevoir.date,'['+GTraductions.getValeur('Le')+' %J %MMMM'+']'),'&nbsp;','</div>');if(!!lDevoir.moyenne){lHtml.push('<div class="AlignementHaut InlineBlock">','(',(lDevoir.estEnGroupe?GTraductions.getValeur('accueil.moyGroupe'):GTraductions.getValeur('accueil.moyClasse')),'&nbsp;:&nbsp;',lDevoir.moyenne.getNote(),(lEstBaremeParDefaut?'':lDevoir.bareme.getBaremeEntier()),')','</div>');}
lHtml.push('</div>');lHtml.push('<div class="right">','<div>',lStrEtoile,lDevoir.note.getNote(),'</div>',(lEstBaremeParDefaut?'':'<div class="right-align">'+lDevoir.bareme.getBaremeEntier()+'</div>'),'</div>');lHtml.push('<div class="clear"></div>');lHtml.push('<div class="EspaceHaut">');if(!!lDevoir.libelleCorrige){lDocumentJoint=new ObjetElement(lDevoir.libelleCorrige,lDevoir.GetNumero(),EGenreDocumentJoint.Fichier);lLien=GChaine.composerUrlLienExterne({documentJoint:lDocumentJoint,genreRessource:TypeFichierExterneHttpSco.DevoirCorrige,libelleEcran:GTraductions.getValeur('AfficherCorrige')});lHtml.push('<div class="right" style="padding-left: 10px;">',lLien,'</div>');}
if(!!lDevoir.libelleSujet){lDocumentJoint=new ObjetElement(lDevoir.libelleSujet,lDevoir.GetNumero(),EGenreDocumentJoint.Fichier);lLien=GChaine.composerUrlLienExterne({documentJoint:lDocumentJoint,genreRessource:TypeFichierExterneHttpSco.DevoirSujet,libelleEcran:GTraductions.getValeur('AfficherSujet')});lHtml.push('<div class="right">',lLien,'</div>');}
lHtml.push('<div class="clear"></div>');lHtml.push('</div>');lHtml.push('</li>');}}}
if(!!this.moyenneGenerale){if(!!this.moyenneGenerale.note&&this.moyenneGenerale.note.getNote()!==""){lHtml.push('<li class="collection-item raised with-action">');lHtml.push('<div class="left title" >'+GTraductions.getValeur('DernieresNotes.Moyenne_generale_eleve')+'</div>');lHtml.push('<div class="right title">'+this.moyenneGenerale.note.getNote()+'</div>');lHtml.push('<div class="clear"></div>');lHtml.push('</li>');}
if(!!this.moyenneGenerale.noteClasse&&this.moyenneGenerale.noteClasse.getNote()!==""){lHtml.push('<li class="collection-item raised with-action">');lHtml.push('<div class="left title" >'+GTraductions.getValeur('DernieresNotes.Moyenne_generale_classe')+'</div>');lHtml.push('<div class="right title">'+this.moyenneGenerale.noteClasse.getNote()+'</div>');lHtml.push('<div class="clear"></div>');lHtml.push('</li>');}}
lHtml.push('</ul>');}}
return lHtml.join('');}
evenementSurClickService(aEvent,aNumeroService){if($(aEvent.target).parentsUntil(aEvent.currentTarget).addBack().filter('a').length===0&&this.avecDetailService){var lListeServices=this.getListeServices();var lService=lListeServices.GetElementParNumero(aNumeroService);GInterface.openPanel(this.composePanelService(lService),{controleur:this.controleur});this.Service=lService;}}
evenementSurClickDevoir(aEvent,aNumeroDevoir){if($(aEvent.target).parentsUntil(aEvent.currentTarget).addBack().filter('a').length===0&&this.avecDetailDevoir){var lDevoir=this.listeDevoirs.GetElementParNumero(aNumeroDevoir);GInterface.openPanel(this.composePanelDevoir(lDevoir));}}
surClickProchainElement(aNumeroElement,aEstSuivant,aEstDevoir){var lIndiceElementActuel,lIndiceProchainElement,lProchainElement;if(!!aEstDevoir){lIndiceElementActuel=this.listeDevoirs.GetIndiceParNumeroEtGenre(aNumeroElement);if(!!aEstSuivant){lIndiceProchainElement=lIndiceElementActuel+1<this.listeDevoirs.GetNbrElements()?lIndiceElementActuel+1:0;} else{lIndiceProchainElement=lIndiceElementActuel===0?this.listeDevoirs.GetNbrElements()-1:lIndiceElementActuel-1;}
lProchainElement=this.listeDevoirs.GetElement(lIndiceProchainElement);GInterface.updatePanelContent(this.composePanelDevoir(lProchainElement));} else{if(this.avecDetailService){var lListeServices=this.getListeServices();lIndiceElementActuel=lListeServices.GetIndiceParNumeroEtGenre(aNumeroElement);if(!!aEstSuivant){lIndiceProchainElement=lIndiceElementActuel+1<lListeServices.GetNbrElements()?lIndiceElementActuel+1:0;} else{lIndiceProchainElement=lIndiceElementActuel===0?lListeServices.GetNbrElements()-1:lIndiceElementActuel-1;}
lProchainElement=lListeServices.GetElement(lIndiceProchainElement);GInterface.updatePanelContent(this.composePanelService(lProchainElement),{controleur:this.controleur});this.Service=lProchainElement;}}}
composePanelService(aService){var lHtml=[];lHtml.push('<div class="navheader with-title-close">','<div class="title-contain">','<h3>',GTraductions.getValeur('DernieresNotes.DetailsduService'),'</h3>','<ie-btnimage onclick="'+GInterface.GetNom()+'.closePanel();" class="btnImageIcon icon_fermeture_widget" ></ie-btnimage>','</div>');lHtml.push('<div class="nav-prec-suiv">');lHtml.push('<ie-btnimage onclick="',this.Nom,'.surClickProchainElement(\'',aService.GetNumero(),'\',',false,',',false,')" class="btnImageIcon icon_angle_left"></ie-btnimage>');lHtml.push('<div class="libelle-contain">');lHtml.push('<h4>',aService.GetLibelle(),'</h4>');if(!!aService.moyEleve||aService.estMoyNR===true){var T=[];if(aService.estMoyNR===true){T.push(this.moteur.composeHtmlMoyNR());}
if(aService.moyEleve!==null&&aService.moyEleve!==undefined){T.push(aService.moyEleve.getNote());}
lHtml.push('<div>'+T.join(' ')+'</div>');}
lHtml.push('</div>');lHtml.push('<ie-btnimage onclick="',this.Nom,'.surClickProchainElement(\'',aService.GetNumero(),'\',',true,',',false,')" class="btnImageIcon icon_angle_right"></ie-btnimage>');lHtml.push('</div>');lHtml.push('<div class="details-conteneur">');if(!!aService.moyClasse&&aService.moyClasse.getNote()!==""){var lLibelleMoyenne=aService.estServiceEnGroupe?GTraductions.getValeur('DernieresNotes.Moyenne_groupe'):GTraductions.getValeur('DernieresNotes.Moyenne_classe');lHtml.push(UtilitaireBulletinEtReleve_Mobile.composePetitBlocDonnees(lLibelleMoyenne,aService.moyClasse.getNote()));}
if(!!aService.moyMax&&aService.moyMax.getNote()!==""){lHtml.push(UtilitaireBulletinEtReleve_Mobile.composePetitBlocDonnees(GTraductions.getValeur('DernieresNotes.Moyenne_max_service'),aService.moyMax.getNote()));}
if(!!aService.moyMin&&aService.moyMin.getNote()!==""){lHtml.push(UtilitaireBulletinEtReleve_Mobile.composePetitBlocDonnees(GTraductions.getValeur('DernieresNotes.Moyenne_min_service'),aService.moyMin.getNote()));}
if(!!aService.nbDevoirs&&aService.nbDevoirs!==""){lHtml.push(UtilitaireBulletinEtReleve_Mobile.composePetitBlocDonnees(GTraductions.getValeur('DernieresNotes.Nombre_notes'),aService.nbDevoirs));}
lHtml.push('</div>');if(!!aService.moyEleve&&aService.moyEleve.estUneValeur()){lHtml.push('<div class="details-conteneur "><ie-bouton ie-model="btnCalculMoyenne">',GTraductions.getValeur('DernieresNotes.DetailsMethodeCalcMoy'),'</ie-bouton></div>');}
if(aService.estMoyNR===true){lHtml.push('<div class="',this.Nom,'_legende legende-conteneur">');lHtml.push('<h5>',GTraductions.getValeur('BulletinEtReleve.Legende'),'</h5>');lHtml.push('<ul>');lHtml.push('<li style="display:flex; align-items:flex-start; margin-top:1rem;">',this.moteur.composeHtmlMoyNR(),'<span class="libelle EspaceGauche">',GTraductions.getValeur('Notes.Colonne.HintMoyenneNR'),'</span>','</li>');lHtml.push('</ul>');lHtml.push('</div>');}
return lHtml.join('');}
composePanelDevoir(aDevoir){var lHtml=[];const lNoteAuDessusBareme=(aDevoir.note&&aDevoir.bareme&&aDevoir.note.getValeur()>aDevoir.bareme.getValeur());var lEstBaremeParDefaut=aDevoir.bareme.getValeur()===aDevoir.baremeParDefaut.getValeur();const lStrEtoile=lNoteAuDessusBareme?'<i class="icon icon_star EspaceDroit"></i>':'';var lAvecQCMRejouePlusieursFois=!!aDevoir.executionQCM&&!!aDevoir.executionQCM.dateExecCopieCachee;lHtml.push('<div class="navheader with-title-close">','<div class="title-contain">','<h3>',GTraductions.getValeur('DernieresNotes.DetailsduDevoir'),'</h3>','<ie-btnimage onclick="'+GInterface.GetNom()+'.closePanel();" class="btnImageIcon icon_fermeture_widget" ></ie-btnimage>','</div>');lHtml.push('<div class="nav-prec-suiv">','<ie-btnimage onclick="',this.Nom,'.surClickProchainElement(\'',aDevoir.GetNumero(),'\',',false,',',true,')" class="btnImageIcon icon_angle_left"></ie-btnimage>','<div class="libelle-contain"><h4>'+aDevoir.service.GetLibelle()+'</h4>'+GTraductions.getValeur('DernieresNotes.Note_du',[GDate.FormatDate(aDevoir.date,'%JJ/%MM')])+(!!aDevoir.ListeThemes&&aDevoir.ListeThemes.GetNbrElements()?'<span style="display:block">'+GTraductions.getValeur('Themes')+' : '+aDevoir.ListeThemes.getTableauLibelles().join(', ')+'</span>':'')+'</div>','<ie-btnimage onclick="',this.Nom,'.surClickProchainElement(\'',aDevoir.GetNumero(),'\',',true,',',true,')" class="btnImageIcon icon_angle_right"></ie-btnimage>','</div>');if(!!aDevoir.commentaire){lHtml.push(UtilitaireBulletinEtReleve_Mobile.composeAppreciation({intituleDAppreciation:GTraductions.getValeur('Commentaire'),contenuDAppreciation:aDevoir.commentaire,styleBlockIntitule:'color : #616161;',styleBlockContenu:'border:1px solid #616161; background-color: #F1F1F1;'}));}
lHtml.push('<div class="details-conteneur ">');if(!!aDevoir.note&&aDevoir.note.getNote()!==""){var lNoteEleve=[];lNoteEleve.push('<span class="Gras">',lStrEtoile,aDevoir.note.getNote(),'</span>');if(!lEstBaremeParDefaut||lNoteAuDessusBareme){lNoteEleve.push('<span>',aDevoir.bareme.getBaremeEntier(),'</span>');}
if(lAvecQCMRejouePlusieursFois){lNoteEleve.push('<span> *</span>');}
lHtml.push(UtilitaireBulletinEtReleve_Mobile.composePetitBlocDonnees(GTraductions.getValeur('DernieresNotes.Note_eleve'),lNoteEleve.join('')));}
if(!!aDevoir.moyenne&&aDevoir.moyenne.getNote()!==""){var lLibelleMoyenne=aDevoir.estEnGroupe?GTraductions.getValeur('DernieresNotes.Moyenne_groupe'):GTraductions.getValeur('DernieresNotes.Moyenne_classe');var lMoyClasse='<span class="Gras">'+aDevoir.moyenne.getNote()+'</span>'+(lEstBaremeParDefaut?'':'<span>'+aDevoir.bareme.getBaremeEntier()+'</span>');lHtml.push(UtilitaireBulletinEtReleve_Mobile.composePetitBlocDonnees(lLibelleMoyenne,lMoyClasse));}
if(!!aDevoir.noteMax&&aDevoir.noteMax.getNote()!==""){var lMoySup='<span class="Gras">'+aDevoir.noteMax.getNote()+'</span>'+(lEstBaremeParDefaut?'':'<span>'+aDevoir.bareme.getBaremeEntier()+'</span>');lHtml.push(UtilitaireBulletinEtReleve_Mobile.composePetitBlocDonnees(GTraductions.getValeur('DernieresNotes.Note_max_devoir'),lMoySup));}
if(!!aDevoir.noteMin&&aDevoir.noteMin.getNote()!==""){var noteMin='<span class="Gras">'+aDevoir.noteMin.getNote()+'</span>'+(lEstBaremeParDefaut?'':'<span>'+aDevoir.bareme.getBaremeEntier()+'</span>');lHtml.push(UtilitaireBulletinEtReleve_Mobile.composePetitBlocDonnees(GTraductions.getValeur('DernieresNotes.Note_min_devoir'),noteMin));}
if(aDevoir.coefficient!==undefined){lHtml.push(UtilitaireBulletinEtReleve_Mobile.composePetitBlocDonnees(GTraductions.getValeur('BulletinEtReleve.Coeff'),aDevoir.coefficient));}
lHtml.push('</div>');lHtml.push('<div class="EspaceDroit">');var lDocumentJoint,lLien;if(aDevoir.libelleCorrige){lDocumentJoint=new ObjetElement(aDevoir.libelleCorrige,aDevoir.GetNumero(),EGenreDocumentJoint.Fichier);lLien=GChaine.composerUrlLienExterne({documentJoint:lDocumentJoint,genreRessource:TypeFichierExterneHttpSco.DevoirCorrige,libelleEcran:GTraductions.getValeur('AfficherCorrige')});lHtml.push('<div class="right">',lLien,'</div>');}
if(aDevoir.libelleSujet){lDocumentJoint=new ObjetElement(aDevoir.libelleSujet,aDevoir.GetNumero(),EGenreDocumentJoint.Fichier);lLien=GChaine.composerUrlLienExterne({documentJoint:lDocumentJoint,genreRessource:TypeFichierExterneHttpSco.DevoirSujet,libelleEcran:GTraductions.getValeur('AfficherSujet')});lHtml.push('<div class="right">',lLien,'</div>');}
lHtml.push('<div class="clear"></div>');lHtml.push('</div>');if(!!aDevoir.execKiosque){lHtml.push('<div>',GChaine.composerUrlLienExterne({documentJoint:aDevoir.execKiosque,title:GTraductions.getValeur('AfficherCopieEleve'),libelleEcran:GTraductions.getValeur('AfficherCopieEleve')}),'</div>');}
if(lAvecQCMRejouePlusieursFois||aDevoir.estBonus||aDevoir.estFacultatif||aDevoir.estRamenerSur20){lHtml.push('<div class="Espace Italique">');if(lAvecQCMRejouePlusieursFois){var lStrTypeQCMGarde;if(!!aDevoir.executionQCM.garderMeilleureNote){lStrTypeQCMGarde=GTraductions.getValeur('ExecutionQCM.presentationCorrige.MeilleurResultat');} else{lStrTypeQCMGarde=GTraductions.getValeur('ExecutionQCM.presentationCorrige.DernierResultat');}
lHtml.push('<div>* ',GTraductions.getValeur('ExecutionQCM.presentationCorrige.QCMDejaRealise',[lStrTypeQCMGarde]),'</div>');}
if(aDevoir.estBonus){lHtml.push('<div>',GTraductions.getValeur('DernieresNotes.DevBonus'),'</div>');} else if(aDevoir.estFacultatif){lHtml.push('<div>',GTraductions.getValeur('DernieresNotes.DevFacultatif'),'</div>');}
if(aDevoir.estRamenerSur20){lHtml.push('<div>',GTraductions.getValeur('DernieresNotes.NoteRameneeSur',[aDevoir.baremeParDefaut.getValeur()]),'</div>');}
lHtml.push('</div>');}
return lHtml.join('');}
getListeServices(){var lListeServices=new ObjetListeElements();this.listeDevoirs.parcourir(function(D){var lServiceDeLaListeDevoirs=lListeServices.GetElementParNumero(D.service.GetNumero());if(!lServiceDeLaListeDevoirs){lServiceDeLaListeDevoirs=D.service;lServiceDeLaListeDevoirs.nbDevoirs=0;lListeServices.AddElement(D.service);}
lServiceDeLaListeDevoirs.nbDevoirs++;});return lListeServices;}
surClicMethodeCalculMoyenne(){var lService=this.Service;if(lService){var lEleve=GEtatUtilisateur.getMembre();var lClasse=lEleve.Classe;var lPeriode=this.Periode;var lParametresCalcul={libelleEleve:lEleve.GetLibelle(),numeroEleve:lEleve.GetNumero(),libelleClasse:lClasse.GetLibelle(),numeroClasse:lClasse.GetNumero(),libelleServiceNotation:lService.GetLibelle(),numeroServiceNotation:lService.GetNumero(),numeroPeriodeNotation:lPeriode.GetNumero(),genreChoixNotation:lPeriode.GetGenre(),moyenneTrimestrielle:true,pourMoyenneNette:true};if(this.identFenetreMethodeCalculMoyenne){this.identFenetreMethodeCalculMoyenne.SetDonnees(lParametresCalcul);}}}}
module.exports=ObjetDernieresNotes;},fn:"pagedernieresnotes.js"});;
IE.fModule({f:function(exports,require,module,global){const{ObjetRequeteConsultation}=require('ObjetRequeteJSON.js');const Requetes=require('CollectionRequetes.js');const EGenreTriElement=require('Enumere_TriElement.js');const ObjetTri=require('ObjetTri.js');class ObjetRequeteDernieresNotes extends ObjetRequeteConsultation{constructor(...aParams){super(...aParams);}
lancerRequete(aParams){this.JSON.Periode=aParams.periode;return this.appelAsynchrone();}
actionApresRequete(){if(!!this.JSONReponse.listeDevoirs){this.JSONReponse.listeDevoirs.setTri([ObjetTri.init('date',EGenreTriElement.Decroissant)]);this.JSONReponse.listeDevoirs.trier();if(!!this.JSONReponse.listeServices){const lListeServices=this.JSONReponse.listeServices;this.JSONReponse.listeDevoirs.parcourir(function(D){if(!!D.service){D.service=lListeServices.GetElementParNumero(D.service.GetNumero());}});}}
const lJSONResult={listeDevoirs:this.JSONReponse.listeDevoirs};if(!!this.JSONReponse.moyGenerale&&!this.JSONReponse.moyGenerale.estVide()&&!!this.JSONReponse.moyGeneraleClasse&&!this.JSONReponse.moyGeneraleClasse.estVide()){lJSONResult.moyenneGenerale={note:this.JSONReponse.moyGenerale,noteClasse:this.JSONReponse.moyGeneraleClasse,bareme:this.JSONReponse.baremeMoyGenerale,baremeParDefaut:this.JSONReponse.baremeMoyGeneraleParDefaut};}
lJSONResult.avecDetailDevoir=this.JSONReponse.avecDetailDevoir;lJSONResult.avecDetailService=this.JSONReponse.avecDetailService;this.callbackReussite.appel(lJSONResult);}}
Requetes.inscrire('DernieresNotes',ObjetRequeteDernieresNotes);module.exports=ObjetRequeteDernieresNotes;},fn:"objetrequetedernieresnotes.js"});;
IE.fModule({f:function(exports,require,module,global){const ObjetDernieresNotes=require('PageDernieresNotes.js');const MethodesObjet=require('MethodesObjet.js');const EGenreTriElement=require('Enumere_TriElement.js');const InterfacePage_Mobile=require('InterfacePage_Mobile.js');const ObjetElement=require('ObjetElement.js');const ObjetListeElements=require('ObjetListeElements.js');const ObjetSelection=require('ObjetSelection.js').ObjetSelection;const ObjetTabOnglets=require('ObjetTabOnglets.js');const GTraductions=require('ObjetTraduction.js');const ObjetTri=require('ObjetTri.js');const EGenreMessage=require('Enumere_Message.js');const EGenreRessource=require('Enumere_Ressource.js');const ObjetRequeteDernieresNotes=require('ObjetRequeteDernieresNotes.js');class InterfacePageDernieresNotes extends InterfacePage_Mobile{constructor(...aParams){super(...aParams);this.listePeriodes=new ObjetListeElements();this.periodeCourant=new ObjetElement();this.indiceParDefaut=0;this.listeTabs=new ObjetListeElements();}
ConstruireInstances(){this.identSelection=this.Add(ObjetSelection,this.surSelectionPeriode);this.identTabs=this.Add(ObjetTabOnglets);this.ObjetDernieresNotesParDate=this.Add(ObjetDernieresNotes);var lElementDate=new ObjetElement(GTraductions.getValeur('Date'),null,EGenreRessource.Date,null,false);lElementDate.idDiv=this.GetInstance(this.ObjetDernieresNotesParDate).GetNom();this.listeTabs.AddElement(lElementDate);this.ObjetDernieresNotesParMatiere=this.Add(ObjetDernieresNotes);var lElementMatiere=new ObjetElement(GTraductions.getValeur('Matiere'),null,EGenreRessource.Matiere,null,false);lElementMatiere.idDiv=this.GetInstance(this.ObjetDernieresNotesParMatiere).GetNom();this.listeTabs.AddElement(lElementMatiere);this.AddSurZone=[this.identSelection,this.identTabs];}
RecupererDonnees(){var lOngletInfosPeriodes=GEtatUtilisateur.getOngletInfosPeriodes();this.listePeriodes=lOngletInfosPeriodes.listePeriodes;if(!(this.listePeriodes&&this.listePeriodes.GetNbrElements())){return'';} else{var lNrPeriodeParDefaut=GEtatUtilisateur.getPage()&&GEtatUtilisateur.getPage().periode?GEtatUtilisateur.getPage().periode.GetNumero():lOngletInfosPeriodes.periodeParDefaut.GetNumero();this.indiceParDefaut=this.listePeriodes.GetIndiceParNumeroEtGenre(lNrPeriodeParDefaut);if(!this.indiceParDefaut){this.indiceParDefaut=0;}
this.periodeCourant=this.listePeriodes.GetElement(this.indiceParDefaut);this.GetInstance(this.identSelection).SetDonnees(this.listePeriodes,this.indiceParDefaut);}}
ActionSurRecupererNotes(aListe){if(!aListe.listeDevoirs.GetNbrElements()){this.listeTabs.GetElementParGenre(EGenreRessource.Matiere).Actif=true;this.listeTabs.GetElementParGenre(EGenreRessource.Date).Actif=true;var LMessage=typeof(EGenreMessage.PasDeNotes)==='number'?GTraductions.getValeur('Message')[EGenreMessage.PasDeNotes]:EGenreMessage.PasDeNotes;this.GetInstance(this.ObjetDernieresNotesParDate).SetMessage(LMessage);this.GetInstance(this.ObjetDernieresNotesParMatiere).SetMessage('');this.GetInstance(this.identTabs).SetDonnees(this.listeTabs,0);this.GetInstance(this.identTabs).SetVisible(false);} else{this.listeNotesParDate=aListe.listeDevoirs;this.listeNotesParDate.setTri([ObjetTri.init('date',EGenreTriElement.Decroissant),ObjetTri.init('service.Libelle')]);this.listeNotesParDate.trier();this.listeNotesParMatiere=MethodesObjet.dupliquer(aListe.listeDevoirs);this.listeNotesParMatiere.setTri([ObjetTri.init('service.ordre')]);this.listeNotesParMatiere.trier();this.listeTabs.GetElementParGenre(EGenreRessource.Matiere).Actif=true;this.listeTabs.GetElementParGenre(EGenreRessource.Date).Actif=true;this.GetInstance(this.ObjetDernieresNotesParMatiere).SetDonnees(this.listeNotesParMatiere,true,aListe.avecDetailService,aListe.avecDetailDevoir,aListe.moyenneGenerale,this.periodeCourant);this.GetInstance(this.ObjetDernieresNotesParDate).SetDonnees(this.listeNotesParDate,false,null,aListe.avecDetailDevoir,aListe.moyenneGenerale);this.GetInstance(this.identTabs).SetVisible(true);this.GetInstance(this.identTabs).SetDonnees(this.listeTabs,0);}}
RecupererDernieresNotes(){new ObjetRequeteDernieresNotes(this,this.ActionSurRecupererNotes).lancerRequete({periode:this.periodeCourant});}
surSelectionPeriode(aParam){this.periodeCourant=aParam.element;this.positionPeriodeCourant=this.listePeriodes.GetIndiceParElement(this.periodeCourant);this.RecupererDernieresNotes();}}
module.exports=InterfacePageDernieresNotes;},fn:"mobile/script/interfacepagedernieresnotes.js"});;
IE.fModule({f:function(exports,require,module,global){const{GDate}=require('ObjetDate.js');const ObjetIdentite_Mobile=require('ObjetIdentite_Mobile.js');const GTraductions=require('ObjetTraduction.js');const EGenreNiveauDAcquisition=require('Enumere_NiveauDAcquisition.js');const EGenreDocumentJoint=require('Enumere_DocumentJoint.js');const GChaine=require('GChaine.js');const ObjetElement=require('ObjetElement.js');const TypeFichierExterneHttpSco=require('TypeFichierExterneHttpSco.js').TypeFichierExterneHttpSco;class ObjetDernieresEvaluations extends ObjetIdentite_Mobile{constructor(...aParams){super(...aParams);this.donneesRecues=false;}
SetDonnees(aListeEvaluations,aEstAffichageParDate){if(!!aListeEvaluations){this.donneesRecues=true;this.listeEvaluations=aListeEvaluations;this.estAffichageParDate=aEstAffichageParDate;this.message=false;this.Afficher();}}
SetMessage(aMessage){this.message=aMessage;this.Afficher();}
ConstruireAffichage(){var lHtml=[];if(!!this.message){lHtml.push(this.composeAucuneDonnee(this.message));} else if(this.donneesRecues){lHtml.push(this.composeListeEvaluations());}
return lHtml.join('');}
composeListeEvaluations(){var lHtml=[];var i,lEvaluation,lNumeroServiceConcerne;var lNbrEvaluations=this.listeEvaluations.GetNbrElements();if(this.estAffichageParDate){lHtml.push('<ul class="collection">');for(i=0;i<lNbrEvaluations;i++){lEvaluation=this.listeEvaluations.GetElement(i);lHtml.push('<li class="collection-item with-action bg-white" onclick="',this.Nom,'.evenementSurClickEvaluation(\'',lEvaluation.GetNumero(),'\')" style="padding:3px 12px;">');lHtml.push(this.composeEvaluation(lEvaluation,this.estAffichageParDate));lHtml.push('</li>');}
lHtml.push('</ul>');} else{lHtml.push('<ul class="collection with-header">');lEvaluation=this.listeEvaluations.GetElement(0);lNumeroServiceConcerne=lEvaluation.matiere.serviceConcerne.GetNumero();lHtml.push('<li class="collection-header" style="padding:3px 5px;"> <div style="padding: 10px 5px; border-left: 5px solid '+(!!lEvaluation.matiere.couleur&&lEvaluation.matiere.couleur!==""?lEvaluation.matiere.couleur:'D4D4D4')+';">'+lEvaluation.matiere.GetLibelle()+'</div></li>');lHtml.push('<li class="collection-item with-action bg-white" onclick="',this.Nom,'.evenementSurClickEvaluation(\'',lEvaluation.GetNumero(),'\')" style="padding:3px 12px;">');lHtml.push(this.composeEvaluation(lEvaluation,this.estAffichageParDate));lHtml.push('</li>');for(i=1;i<lNbrEvaluations;i++){lEvaluation=this.listeEvaluations.GetElement(i);if(lNumeroServiceConcerne!==lEvaluation.matiere.serviceConcerne.GetNumero()){lHtml.push('<li class="collection-header" style="padding:3px 5px;"><div style="padding: 10px 5px; border-left: 5px solid '+(!!lEvaluation.matiere.couleur&&lEvaluation.matiere.couleur!==""?lEvaluation.matiere.couleur:'D4D4D4')+';">'+lEvaluation.matiere.GetLibelle()+'</div></li>');lNumeroServiceConcerne=lEvaluation.matiere.serviceConcerne.GetNumero();}
lHtml.push('<li class="collection-item with-action bg-white" onclick="',this.Nom,'.evenementSurClickEvaluation(\'',lEvaluation.GetNumero(),'\')" style="padding:3px 12px;">');lHtml.push(this.composeEvaluation(lEvaluation,this.estAffichageParDate));lHtml.push('</li>');}}
return lHtml.join('');}
composeEvaluation(aEvaluation,aTriParDate){var lHtml=[];var lNiveauDAcquisition;var lNbrNiveauxDAcquisitions=aEvaluation.listeNiveauxDAcquisitions.GetNbrElements();lHtml.push('<div style="padding: 10px 5px; border-left: 5px solid '+(!!aEvaluation.matiere.couleur&&aEvaluation.matiere.couleur!==""&&!!aTriParDate?aEvaluation.matiere.couleur:'D4D4D4')+';">');lHtml.push('<div class="InlineBlock AlignementHaut" style="'+(!!aTriParDate?'width:64%;':'width:50%;')+'">');if(!!aTriParDate){lHtml.push('<div class="Gras">',aEvaluation.matiere.GetLibelle(),'</div>');}
lHtml.push('<div>',GDate.FormatDate(aEvaluation.date,'['+GTraductions.getValeur('Le')+' '+' %J %MMMM'+']'),'</div>');lHtml.push('</div>');if(lNbrNiveauxDAcquisitions!==0){lHtml.push('<div class="InlineBlock AlignementHaut AlignementDroit" style="'+(!!aTriParDate?'width:35%;':'width:50%;')+'">');for(var i=0;i<lNbrNiveauxDAcquisitions;i++){lNiveauDAcquisition=GParametres.listeNiveauxDAcquisitions.GetElementParGenre(aEvaluation.listeNiveauxDAcquisitions.GetElement(i).GetGenre());lHtml.push('<div class="InlineBlock" style="padding: 0rem 0.2rem;">',EGenreNiveauDAcquisition.getImage(lNiveauDAcquisition),'</div>');}
lHtml.push('</div>');}
lHtml.push('</div>');return lHtml.join('');}
evenementSurClickEvaluation(aNumero){var lEvaluation=this.listeEvaluations.GetElementParNumero(aNumero);GInterface.openPanel(this.composePanelEvaluation(lEvaluation));}
composePanelEvaluation(aEvaluation){var lHtml=[];lHtml.push('<div class="navheader with-title-close">','    <div class="title-contain">','        <h3>',GTraductions.getValeur('evaluations.DetailsEvaluation'),'</h3>','        <ie-btnimage onclick="'+GInterface.GetNom()+'.closePanel();" class="btnImageIcon icon_fermeture_widget" ></ie-btnimage>','    </div>','    <div class="nav-prec-suiv">','      <ie-btnimage onclick="',this.Nom,'.surClickProchainElement(\'',aEvaluation.GetNumero(),'\',',false,')" class="btnImageIcon icon_angle_left"></ie-btnimage>','      <div class="libelle-contain">','        <h4>'+aEvaluation.matiere.GetLibelle()+'</h4>',GTraductions.getValeur('evaluations.EvaluationDuDate',[GDate.FormatDate(aEvaluation.date,'%JJ/%MM')]),(!!aEvaluation.ListeThemes&&aEvaluation.ListeThemes.GetNbrElements()?'<span style="display:block">'+GTraductions.getValeur('Themes')+' : '+aEvaluation.ListeThemes.getTableauLibelles().join(', ')+'</span>':''),'      </div>','      <ie-btnimage onclick="',this.Nom,'.surClickProchainElement(\'',aEvaluation.GetNumero(),'\',',true,')" class="btnImageIcon icon_angle_right"></ie-btnimage>','    </div>','</div>');lHtml.push('<div class="coefficent-conteneur">');lHtml.push('  <div class="libelle">'+aEvaluation.GetLibelle()+'</div>');lHtml.push('  <div class="coeff">'+GTraductions.getValeur('evaluations.CoefficientAbrege')+' : '+aEvaluation.coefficient+'</div>');lHtml.push('</div>');if(aEvaluation.descriptif!==""){lHtml.push('<div class="notes-data-conteneur">','<div class="libelle">',GTraductions.getValeur('Commentaire'),'</div>','<div class="descriptif">',aEvaluation.descriptif,'</div>','</div>');}
if(!!aEvaluation.listeNiveauxDAcquisitions&&!!aEvaluation.listeNiveauxDAcquisitions.GetNbrElements()){var listeNiveauxDAcquisitions=aEvaluation.listeNiveauxDAcquisitions,lNbNiveauxAcquisition=listeNiveauxDAcquisitions.GetNbrElements(),lNiveauDAcquisition;lHtml.push('<ul class="collection bg-white evaluations" style="overflow-y: auto;">');for(var j=0;j<lNbNiveauxAcquisition;j++){lNiveauDAcquisition=listeNiveauxDAcquisitions.GetElement(j);lHtml.push('<li class="collection-item">','  <div class="flex-contain">','    <div class="fix-bloc">'+EGenreNiveauDAcquisition.getImage(GParametres.listeNiveauxDAcquisitions.GetElementParGenre(lNiveauDAcquisition.GetGenre()))+'</div>');var lLibelleNiveauDAcquisition=_getLibelleNiveauDAcquisition(lNiveauDAcquisition);lHtml.push('    <div class="fluid-bloc">'+lLibelleNiveauDAcquisition+'</div>','  </div>');if(!!lNiveauDAcquisition.observation){lHtml.push('<div style="font-style:italic;">',lNiveauDAcquisition.observation,'</div>');}
var lPilierStrPrefixes=(!!lNiveauDAcquisition.pilier&&lNiveauDAcquisition.pilier.strPrefixes)?lNiveauDAcquisition.pilier.strPrefixes:"";lHtml.push('<div class="niveaux">',lPilierStrPrefixes,'</div>');lHtml.push('</li>');}
lHtml.push('</ul>');}
if(!!aEvaluation.libelleSujet||!!aEvaluation.libelleCorrige){lHtml.push('<div class="GrandEspaceHaut">');var lDocumentJoint,lLien;if(!!aEvaluation.libelleCorrige){lDocumentJoint=new ObjetElement(aEvaluation.libelleCorrige,aEvaluation.GetNumero(),EGenreDocumentJoint.Fichier);lLien=GChaine.composerUrlLienExterne({documentJoint:lDocumentJoint,genreRessource:TypeFichierExterneHttpSco.EvaluationCorrige,libelleEcran:GTraductions.getValeur('AfficherCorrige')});lHtml.push('<div class="right">',lLien,'</div>');}
if(!!aEvaluation.libelleSujet){lDocumentJoint=new ObjetElement(aEvaluation.libelleSujet,aEvaluation.GetNumero(),EGenreDocumentJoint.Fichier);lLien=GChaine.composerUrlLienExterne({documentJoint:lDocumentJoint,genreRessource:TypeFichierExterneHttpSco.EvaluationSujet,libelleEcran:GTraductions.getValeur('AfficherSujet')});lHtml.push('<div class="right">',lLien,'</div>');}
lHtml.push('<div class="clear"></div>');lHtml.push('</div>');}
if(!!aEvaluation.executionQCM&&!!aEvaluation.executionQCM.dateExecCopieCachee){var lStrTypeQCMGarde;if(!!aEvaluation.executionQCM.garderMeilleureNote){lStrTypeQCMGarde=GTraductions.getValeur('ExecutionQCM.presentationCorrige.MeilleurResultat');} else{lStrTypeQCMGarde=GTraductions.getValeur('ExecutionQCM.presentationCorrige.DernierResultat');}
lHtml.push('<div class="EspaceHaut10 Italique">',GTraductions.getValeur('ExecutionQCM.presentationCorrige.QCMDejaRealise',[lStrTypeQCMGarde]),'</div>');}
return lHtml.join('');}
surClickProchainElement(aNumeroElement,aEstSuivant){var lIndiceElementActuel,lIndiceProchainElement,lProchainElement;lIndiceElementActuel=this.listeEvaluations.GetIndiceParNumeroEtGenre(aNumeroElement);if(!!aEstSuivant){lIndiceProchainElement=lIndiceElementActuel+1<this.listeEvaluations.GetNbrElements()?lIndiceElementActuel+1:0;} else{lIndiceProchainElement=lIndiceElementActuel===0?this.listeEvaluations.GetNbrElements()-1:lIndiceElementActuel-1;}
lProchainElement=this.listeEvaluations.GetElement(lIndiceProchainElement);GInterface.updatePanelContent(this.composePanelEvaluation(lProchainElement));}}
function _getLibelleNiveauDAcquisition(aNiveau){var result='';if(!!aNiveau.sousItem){result=aNiveau.sousItem.GetLibelle();} else if(!!aNiveau.item){result=aNiveau.item.GetLibelle();} else{result=aNiveau.domaine.GetLibelle();}
return result;}
module.exports=ObjetDernieresEvaluations;},fn:"mobile/script/pagedernieresevaluations.js"});;
IE.fModule({f:function(exports,require,module,global){const{ObjetRequeteConsultation}=require('ObjetRequeteJSON.js');const Requetes=require('CollectionRequetes.js');const ObjetTri=require('ObjetTri.js');class ObjetRequeteDernieresEvaluations extends ObjetRequeteConsultation{constructor(...aParams){super(...aParams);}
lancerRequete(aParametres){$.extend(this.JSON,aParametres);return this.appelAsynchrone();}
actionApresRequete(){if(!!this.JSONReponse.listeEvaluations){this.JSONReponse.listeEvaluations.parcourir(function(D){if(!!D.listeNiveauxDAcquisitions){D.listeNiveauxDAcquisitions.setTri([ObjetTri.init('ordre')]);D.listeNiveauxDAcquisitions.trier();}});}
this.callbackReussite.appel(this.JSONReponse.listeEvaluations);}}
Requetes.inscrire('DernieresEvaluations',ObjetRequeteDernieresEvaluations);module.exports=ObjetRequeteDernieresEvaluations;},fn:"objetrequetedernieresevaluations.js"});;
IE.fModule({f:function(exports,require,module,global){const GUID=require('GUID.js');const GTraductions=require('ObjetTraduction.js');const EGenreNiveauDAcquisition=require('Enumere_NiveauDAcquisition.js');const TypeGenreValidationCompetence=require('TypeGenreValidationCompetence.js').TypeGenreValidationCompetence;const TypePositionnement=require('TypePositionnement.js').TypePositionnement;const ObjetFenetre=require('ObjetFenetre.js');const UtilitaireCompetences_Mobile={id:GUID.getId()};UtilitaireCompetences_Mobile.openPopupDetailLegende=function(avecNiveauxPositionnements){const lHtml=[];let lNiveauDAcquisition,lLibelleNiveau,lImageNiveau;const lNbrNiveauDAqcuisition=GParametres.listeNiveauxDAcquisitions.GetNbrElements();if(!!lNbrNiveauDAqcuisition){lHtml.push('<div style="padding: 1rem;">');lHtml.push('<div>',GTraductions.getValeur('competences.niveauDeMaitrise'),'</div>');for(let i=1;i<lNbrNiveauDAqcuisition;i++){if(GParametres.listeNiveauxDAcquisitions.GetElement(i).existeNumero()&&GParametres.listeNiveauxDAcquisitions.GetElement(i).actifPour.contains(TypeGenreValidationCompetence.tGVC_EvaluationEtItem)){lNiveauDAcquisition=GParametres.listeNiveauxDAcquisitions.GetElement(i);lLibelleNiveau=lNiveauDAcquisition.GetLibelle();lImageNiveau=EGenreNiveauDAcquisition.getImage(lNiveauDAcquisition);lHtml.push('<div style="padding-left: 1rem; padding-top: 0.5rem;">','<span style="display: inline-block; width: 2rem; text-align: center;">',lImageNiveau,'</span>','<span style="padding-left:',(!!GParametres.afficherAbbreviationNiveauDAcquisition?'2rem;':'1.2rem;'),'">',lLibelleNiveau,'</span>','</div>');}}
if(!!avecNiveauxPositionnements){lHtml.push('<div style="padding-top : 2rem;">',GTraductions.getValeur('competences.PositionnementLSU'),'</div>');for(let j=1;j<lNbrNiveauDAqcuisition;j++){lNiveauDAcquisition=GParametres.listeNiveauxDAcquisitions.GetElement(j);if(lNiveauDAcquisition.existeNumero()&&lNiveauDAcquisition.actifPour.contains(TypeGenreValidationCompetence.tGVC_Competence)){lLibelleNiveau=EGenreNiveauDAcquisition.getLibellePositionnement({niveauDAcquisition:lNiveauDAcquisition,genrePositionnement:TypePositionnement.POS_Echelle});lImageNiveau=EGenreNiveauDAcquisition.getImagePositionnement({niveauDAcquisition:lNiveauDAcquisition,genrePositionnement:TypePositionnement.POS_Echelle});lHtml.push('<div style="padding-left: 1rem; padding-top: 0.5rem;">','<span style="display: inline-block; width: 2rem; text-align: center;">',lImageNiveau,'</span>','<span style="padding-left:',(!!GParametres.afficherAbbreviationNiveauDAcquisition?'2rem;':'1.2rem;'),'">',lLibelleNiveau,'</span>','</div>');}}}
lHtml.push('</div>');}
ObjetFenetre.creerInstance(ObjetFenetre,{pere:this},{titre:GTraductions.getValeur('competences.Legende'),fermerFenetreSurClicHorsFenetre:true}).Afficher(lHtml.join(''));};module.exports=UtilitaireCompetences_Mobile;},fn:"utilitairecompetences_mobile.js"});;
IE.fModule({f:function(exports,require,module,global){const ObjetDernieresEvaluations=require('mobile/script/PageDernieresEvaluations.js');const MethodesObjet=require('MethodesObjet.js');const EStructureAffichage=require('Enumere_StructureAffichage.js');const EGenreTriElement=require('Enumere_TriElement.js');const InterfacePage_Mobile=require('InterfacePage_Mobile.js');const ObjetElement=require('ObjetElement.js');const ObjetListeElements=require('ObjetListeElements.js');const ObjetSelection=require('ObjetSelection.js').ObjetSelection;const ObjetTabOnglets=require('ObjetTabOnglets.js');const GTraductions=require('ObjetTraduction.js');const ObjetTri=require('ObjetTri.js');const ObjetRequeteDernieresEvaluations=require('ObjetRequeteDernieresEvaluations.js');const UtilitaireCompetences_Mobile=require('UtilitaireCompetences_Mobile.js');const ObjetBoutonFlottant=require('ObjetBoutonFlottant.js');class InterfacePageDernieresEvaluations_Mobile extends InterfacePage_Mobile{constructor(...aParams){super(...aParams);this.listePeriodes=new ObjetListeElements();this.periodeCourant=new ObjetElement();this.indiceParDefaut=0;this.listeTabs=new ObjetListeElements();this.listeEvaluationsParDate=new ObjetListeElements();this.idWrapper=this.Nom+'_wrapper';}
getControleur(aInstance){return $.extend(true,super.getControleur(this),{getIdentiteBouton:function(){return{class:ObjetBoutonFlottant,pere:this,init:function(aBtn){aInstance.btnFlottant=aBtn;var lParam={listeBoutons:[{icone:'icon_diffuser_information large',callback:aInstance.surClicLegende.bind(this,false)}]};aBtn.setOptionsBouton(lParam);}};},nodePdf:function(){$(this.node).on('click',function(){});}});}
SetParametresGeneraux(){super.SetParametresGeneraux();this.GenreStructure=EStructureAffichage.Autre;}
ConstruireInstances(){this.identSelection=this.Add(ObjetSelection,this.surSelectionPeriode);this.identTabs=this.Add(ObjetTabOnglets);this.ObjetDernieresEvaluationsParDate=this.Add(ObjetDernieresEvaluations);var lElementParDate=new ObjetElement(GTraductions.getValeur('Date'));lElementParDate.idDiv=this.GetInstance(this.ObjetDernieresEvaluationsParDate).GetNom();this.listeTabs.AddElement(lElementParDate);this.ObjetDernieresEvaluationsParMatiere=this.Add(ObjetDernieresEvaluations);var lElementParMatiere=new ObjetElement(GTraductions.getValeur('Matiere'));lElementParMatiere.idDiv=this.GetInstance(this.ObjetDernieresEvaluationsParMatiere).GetNom();this.listeTabs.AddElement(lElementParMatiere);this.AddSurZone=[this.identSelection,this.identTabs];}
ConstruireStructureAffichageAutre(){var lHtml=[];lHtml.push('<div id="'+this.idWrapper+'">','<div id="',this.GetInstance(this.ObjetDernieresEvaluationsParDate).GetNom(),'"></div>','<div id="',this.GetInstance(this.ObjetDernieresEvaluationsParMatiere).GetNom(),'"></div>','</div>');if(!this.btnFlottant){$("#"+GInterface.idZonePrincipale).IEHtmlAppend('<div class="is-sticky" ie-identite="getIdentiteBouton" ></div>',{controleur:this.controleur,avecCommentaireConstructeur:false});}
return lHtml.join('');}
surClicLegende(avecNiveauxPositionnements){UtilitaireCompetences_Mobile.openPopupDetailLegende(avecNiveauxPositionnements);}
RecupererDonnees(){var lOngletInfosPeriodes=GEtatUtilisateur.getOngletInfosPeriodes();this.listePeriodes=lOngletInfosPeriodes.listePeriodes;if(this.listePeriodes&&this.listePeriodes.GetNbrElements()){var lNrPeriodeParDefaut=GEtatUtilisateur.getPage()&&GEtatUtilisateur.getPage().periode?GEtatUtilisateur.getPage().periode.GetNumero():lOngletInfosPeriodes.periodeParDefaut.GetNumero();this.indiceParDefaut=this.listePeriodes.GetIndiceParNumeroEtGenre(lNrPeriodeParDefaut);if(!this.indiceParDefaut){this.indiceParDefaut=0;}
this.periodeCourant=this.listePeriodes.GetElement(this.indiceParDefaut);this.GetInstance(this.identSelection).SetDonnees(this.listePeriodes,this.indiceParDefaut,this.GetInstance(this.ObjetDernieresEvaluationsParDate).GetNom(),'');}}
ActionSurRecuperer(aListeEvaluations){if(!!aListeEvaluations&&!!aListeEvaluations.GetNbrElements()){this.listeEvaluationsParDate=aListeEvaluations;this.listeEvaluationsParDate.setTri([ObjetTri.init('date',EGenreTriElement.Decroissant),ObjetTri.init('matiere.Libelle')]);this.listeEvaluationsParDate.trier();this.listeEvaluationsParMatiere=MethodesObjet.dupliquer(aListeEvaluations);this.listeEvaluationsParMatiere.setTri([ObjetTri.init('matiere.ordre'),ObjetTri.init('matiere.Libelle'),ObjetTri.init('matiere.serviceConcerne'),ObjetTri.init('date',EGenreTriElement.Decroissant)]);this.listeEvaluationsParMatiere.trier();this.listeTabs.parcourir(function(ele){ele.Actif=true;});this.GetInstance(this.ObjetDernieresEvaluationsParDate).SetDonnees(this.listeEvaluationsParDate,true);this.GetInstance(this.ObjetDernieresEvaluationsParMatiere).SetDonnees(this.listeEvaluationsParMatiere,false);} else{this.listeTabs.parcourir(function(ele,index){ele.Actif=index===0;});this.GetInstance(this.ObjetDernieresEvaluationsParDate).SetMessage(GTraductions.getValeur('evaluations.AucuneEvaluationSurPeriode'));this.GetInstance(this.ObjetDernieresEvaluationsParMatiere).SetMessage(GTraductions.getValeur('evaluations.AucuneEvaluationSurPeriode'));}
this.GetInstance(this.identTabs).SetDonnees(this.listeTabs,0);var $wrapper=$('#'+this.idWrapper.escapeJQ());var $tailleLegende=0;var $legende=$wrapper.siblings('footer');if($legende.is(':visible')){$tailleLegende=$legende.height();}
$wrapper.css('margin-bottom',$tailleLegende+'px');}
RecupererDernieresEvaluations(){new ObjetRequeteDernieresEvaluations(this,this.ActionSurRecuperer).lancerRequete({periode:this.periodeCourant});}
surSelectionPeriode(aParam){this.periodeCourant=aParam.element;this.positionPeriodeCourant=this.listePeriodes.GetIndiceParElement(this.periodeCourant);this.RecupererDernieresEvaluations();}
free(...aParams){super.free(...aParams);if(this.btnFlottant){$('#'+this.btnFlottant.GetNom().escapeJQ()).remove();}}}
module.exports=InterfacePageDernieresEvaluations_Mobile;},fn:"mobile/script/interfacepagedernieresevaluations_mobile.js"});;
IE.fModule({f:function(exports,require,module,global){const{ObjetRequeteConsultation}=require('ObjetRequeteJSON.js');const MethodesTableau=require('MethodesTableau.js');const Requetes=require('CollectionRequetes.js');const ObjetElement=require('ObjetElement.js');const ObjetListeElements=require('ObjetListeElements.js');const GTraductions=require('ObjetTraduction.js');const ObjetTri=require('ObjetTri.js');const EGenreEspace=require('Enumere_Espace.js');const EGenreRessource=require('Enumere_Ressource.js');const ObjetDeserialiser=require('ObjetDeserialiser.js');const TypeGenreObservationVS=require('TypeGenreObservationVS.js').TypeGenreObservationVS;class ObjetRequetePageVieScolaire extends ObjetRequeteConsultation{constructor(...aParams){super(...aParams);}
lancerRequete(aDateDebut,aDateFin,aPeriode){this.JSON={DateDebut:aDateDebut,DateFin:aDateFin,periode:aPeriode};return this.appelAsynchrone();}
actionApresRequete(){this.recap=new ObjetListeElements();this.listeAbsences=new ObjetListeElements();this.autorisations=this.JSONReponse.autorisations;const lMessage=this.JSONReponse.message;const lTotaux={suivi:0,absence:0,excluCours:0,excluEtab:0,infirmerie:0,total:0};let lListeMatieres=new ObjetListeElements();if(!lMessage){this.listeAbsences=new ObjetDeserialiser().listeEvenementsVS(this.JSONReponse.listeAbsences,false);this.recap=this.initialiserRecapitulatif(this.JSONReponse.listeRecapitulatifs,this.JSONReponse.listeSanctionUtilisateur);this.listeAbsences.parcourir(_enrichirAbsence.bind(this));this.recap.setTri([ObjetTri.init(function(D){return D.getNombre()>0?1:2;}),ObjetTri.init('Position'),ObjetTri.init('Libelle')]);this.recap.trier();if(this.JSONReponse.Matieres){lListeMatieres=this.JSONReponse.Matieres;lListeMatieres.parcourir(_deserialiserDuree.bind(this,lTotaux));}}
this.callbackReussite.appel({listeRecapitulatifs:this.recap,listeAbsences:this.listeAbsences,autorisations:this.autorisations,totaux:lTotaux,listeMatieres:lListeMatieres,message:lMessage});}
creerElementRecapitulatifAbsences(aObjet){const lElement=new ObjetElement('',aObjet.numero,aObjet.genre,aObjet.position,true);lElement.genreObservation=aObjet.genreObservation;lElement.genreNature=aObjet.genreNature;lElement.Nombre=[];lElement.genresNaturesAR=[];lElement.getNombre=function(aGenre){let lResult=0;if(!aGenre){for(const i in this.Nombre){lResult+=this.Nombre[i];}} else{lResult=this.Nombre[aGenre];}
return lResult;}.bind(lElement);lElement.aNouvelInfo=function(){const lResult=false;if(!MethodesTableau.existe(GEtatUtilisateur.GenreEspace,[EGenreEspace.Parent,EGenreEspace.PrimParent])){return false;}
switch(this.Genre){case EGenreRessource.ObservationProfesseurEleve:case EGenreRessource.Absence:case EGenreRessource.Retard:case EGenreRessource.Punition:for(const i in this.genresNaturesAR){if(this.Nombre[i]>0){return true;}}
break;default:return false;}
return lResult;}.bind(lElement);if(aObjet.genre===EGenreRessource.Absence){lElement.nombreDemiJournees=aObjet.nombreDemiJournees;lElement.nombreDemiJourneesNonJustifies=aObjet.nombreDemiJourneesNonJustifies;lElement.nbrHeures=aObjet.nbrHeures;}
return lElement;}
initialiserRecapitulatif(aListeRecapitulatifs){let lObjet;const lListeRecapitulatifs=new ObjetListeElements();if(this.autorisations.observation){lObjet={genre:EGenreRessource.ObservationProfesseurEleve,genreObservation:TypeGenreObservationVS.OVS_ObservationParent};lObjet.position=EGenreRessource.getPositionAbsence(lObjet);lListeRecapitulatifs.AddElement(this.creerElementRecapitulatifAbsences(lObjet));lObjet={genre:EGenreRessource.ObservationProfesseurEleve,genreObservation:TypeGenreObservationVS.OVS_Encouragement};lObjet.position=EGenreRessource.getPositionAbsence(lObjet);lListeRecapitulatifs.AddElement(this.creerElementRecapitulatifAbsences(lObjet));lObjet={genre:EGenreRessource.ObservationProfesseurEleve,genreObservation:TypeGenreObservationVS.OVS_DefautCarnet};lObjet.position=EGenreRessource.getPositionAbsence(lObjet);lListeRecapitulatifs.AddElement(this.creerElementRecapitulatifAbsences(lObjet));lObjet={genre:EGenreRessource.ObservationProfesseurEleve,genreObservation:TypeGenreObservationVS.OVS_Autres};lObjet.position=EGenreRessource.getPositionAbsence(lObjet);lListeRecapitulatifs.AddElement(this.creerElementRecapitulatifAbsences(lObjet));}
if(this.autorisations.absence){lObjet={genre:EGenreRessource.Absence};lObjet.position=EGenreRessource.getPositionAbsence(lObjet);for(let i=0;i<aListeRecapitulatifs.GetNbrElements();i++){const lElement=aListeRecapitulatifs.GetElement(i);lObjet.nombreDemiJournees=lElement.NombreTotal;lObjet.nombreDemiJourneesNonJustifies=lElement.NombreNonJustifie;lObjet.nbrHeures=lElement.NbrHeures;}
lListeRecapitulatifs.AddElement(this.creerElementRecapitulatifAbsences(lObjet));}
if(this.autorisations.absenceRepas){lObjet={genre:EGenreRessource.AbsenceRepas};lObjet.position=EGenreRessource.getPositionAbsence(lObjet);lListeRecapitulatifs.AddElement(this.creerElementRecapitulatifAbsences(lObjet));}
if(this.autorisations.absenceInternat){lObjet={genre:EGenreRessource.AbsenceInternat};lObjet.position=EGenreRessource.getPositionAbsence(lObjet);lListeRecapitulatifs.AddElement(this.creerElementRecapitulatifAbsences(lObjet));}
if(this.autorisations.infirmerie){lObjet={genre:EGenreRessource.Infirmerie};lObjet.position=EGenreRessource.getPositionAbsence(lObjet);lListeRecapitulatifs.AddElement(this.creerElementRecapitulatifAbsences(lObjet));}
if(this.autorisations.retard){lObjet={genre:EGenreRessource.Retard};lObjet.position=EGenreRessource.getPositionAbsence(lObjet);lListeRecapitulatifs.AddElement(this.creerElementRecapitulatifAbsences(lObjet));}
if(this.autorisations.incident){lObjet={genre:EGenreRessource.Incident};lObjet.position=EGenreRessource.getPositionAbsence(lObjet);lListeRecapitulatifs.AddElement(this.creerElementRecapitulatifAbsences(lObjet));}
if(this.autorisations.punition||this.autorisations.exclusion){lObjet={genre:EGenreRessource.Punition};lObjet.position=EGenreRessource.getPositionAbsence(lObjet);lListeRecapitulatifs.AddElement(this.creerElementRecapitulatifAbsences(lObjet));}
if(this.autorisations.mesureConservatoire){lObjet={genre:EGenreRessource.MesureConservatoire};lObjet.position=EGenreRessource.getPositionAbsence(lObjet);lListeRecapitulatifs.AddElement(this.creerElementRecapitulatifAbsences(lObjet));}
if(this.autorisations.sanction){lObjet={genre:EGenreRessource.Sanction};lObjet.position=EGenreRessource.getPositionAbsence(lObjet);lListeRecapitulatifs.AddElement(this.creerElementRecapitulatifAbsences(lObjet));}
lListeRecapitulatifs.trier();lListeRecapitulatifs.getRecapitultatifDeGenre=_getRecapitultatifDeGenre.bind(lListeRecapitulatifs);return lListeRecapitulatifs;}
ajoutSurRecapitulatifSelonAbsence(aListeRecapitulatifs,aAbsence){const lIndice=aListeRecapitulatifs.getIndiceElementParFiltre(_filtreRecapitulatif.bind(this,aAbsence));const lElement=aListeRecapitulatifs.GetElement(lIndice);if(!!lElement){let lIx=0;if((aAbsence.GetGenre()===EGenreRessource.Absence||aAbsence.GetGenre()===EGenreRessource.Retard)){if(!aAbsence.justifie&&
aAbsence.avecSaisie&&(!aAbsence.motifParent||!aAbsence.motifParent.existeNumero())&&
!MethodesTableau.existe(lIx,lElement.genresNaturesAR)){lElement.genresNaturesAR.push(lIx);}
if(aAbsence.justifie){lIx=1;}}
if(aAbsence.GetGenre()===EGenreRessource.ObservationProfesseurEleve){if(!aAbsence.estLue&&
aAbsence.avecARObservation&&
!MethodesTableau.existe(lIx,lElement.genresNaturesAR)){lElement.genresNaturesAR.push(lIx);}
if(aAbsence.estLue||!aAbsence.avecARObservation){lIx=1;}}
if(aAbsence.GetGenre()===EGenreRessource.Punition||aAbsence.GetGenre()===EGenreRessource.Sanction||aAbsence.GetGenre()===EGenreRessource.Incident){if(aAbsence.GetGenre()===EGenreRessource.Incident){lIx=!!aAbsence.mesure?aAbsence.mesure.GetGenre():EGenreRessource.Aucune;} else{lIx=aAbsence.nature.GetGenre();if((aAbsence.GetGenre()===EGenreRessource.Punition)&&aAbsence.nature.estAvecARParent&&!aAbsence.parentAAccuseDeReception&&!MethodesTableau.existe(lIx,lElement.genresNaturesAR)){lElement.genresNaturesAR.push(lIx);}}}
if(lElement.Nombre[lIx]===undefined||lElement.Nombre[lIx]===null){lElement.Nombre[lIx]=0;}
if(aAbsence.GetGenre()===EGenreRessource.Punition||aAbsence.GetGenre()===EGenreRessource.Sanction||aAbsence.GetGenre()===EGenreRessource.Incident){if(!lElement.libelles){lElement.libelles=[];}
if(!lElement.libelles[lIx]&&!aAbsence.estProgrammation){if(aAbsence.GetGenre()===EGenreRessource.Incident){lElement.libelles[lIx]=_getTraductionMesure(lIx);} else{lElement.libelles[lIx]=aAbsence.nature.GetLibelle();}}}
if(!aAbsence.estProgrammation){lElement.Nombre[lIx]++;}}}}
Requetes.inscrire('PagePresence',ObjetRequetePageVieScolaire);function _getRecapitultatifDeGenre(aParams){const lPosition=EGenreRessource.getPositionAbsence(aParams);const lIndice=this.getIndiceElementParFiltre(function(aElement){return aElement.Position===lPosition;});let lRecap;if(lIndice> -1){lRecap=this.GetElement(lIndice);}
return lRecap;}
function _filtreRecapitulatif(aAbsence,aElement){const lObj={genre:aAbsence.GetGenre(),genreObservation:aAbsence.genreObservation};if(aAbsence.GetGenre()===EGenreRessource.Punition){lObj.genreNature=aAbsence.nature.GetGenre();}
const lPosition=EGenreRessource.getPositionAbsence(lObj);return aElement.Position===lPosition;}
function _getTraductionMesure(aGenre){switch(aGenre){case EGenreRessource.Punition:return GTraductions.getValeur('AbsenceVS.LieAPunition');case EGenreRessource.Sanction:return GTraductions.getValeur('AbsenceVS.LieASanction');case EGenreRessource.MesureConservatoire:return GTraductions.getValeur('AbsenceVS.LieAMesureConservatoire');case EGenreRessource.Aucune:return GTraductions.getValeur('AbsenceVS.SansMesureDiciplinaire');default:;return'';}}
function _enrichirAbsence(aElement){this.ajoutSurRecapitulatifSelonAbsence(this.recap,aElement);}
function _deserialiserDuree(aTotaux,aElement,aIndex,aListeOrigin){if(aElement.regroupement>0){aElement.estUnDeploiement=true;aElement.estDeploye=true;}
const lDansRegroupement=aElement.dansRegroupement;if(lDansRegroupement>0){const lIdxPere=aListeOrigin.getIndiceElementParFiltre(function(aElmOrigin){return aElmOrigin.regroupement===lDansRegroupement;});if(lIdxPere> -1){aElement.pere=aListeOrigin.GetElement(lIdxPere);}}
aElement.total=aElement.absence+aElement.excluCours+aElement.excluEtab;if(!aElement.estUnDeploiement){aTotaux.suivi+=aElement.suivi;aTotaux.absence+=aElement.absence;aTotaux.excluCours+=aElement.excluCours;aTotaux.excluEtab+=aElement.excluEtab;aTotaux.infirmerie+=aElement.infirmerie;aTotaux.total+=aElement.total;}}
module.exports=ObjetRequetePageVieScolaire;},fn:"objetrequetepageviescolaire.js"});;
IE.fModule({f:function(exports,require,module,global){const ObjetDonneesListeFlatDesign=require('ObjetDonneesListeFlatDesign.js');class DonneesListe_EvenementsVS extends ObjetDonneesListeFlatDesign{constructor(aDonnees){super(aDonnees);this.setOptions({avecEvnt_Selection:true,avecDeselectionSurNonSelectionnable:false,avecEvnt_SelectionDblClick:true,avecBoutonActionLigne:false,avecTri:false});}
avecVoileBleuHover(aParams){return(aParams.article.nombre!==0)&&(aParams.ligne!==0);}
getTitreZonePrincipale(aParams){return aParams.article.titreSection;}
getInfosSuppZonePrincipale(aParams){return aParams.article.detail;}
getZoneGauche(aParams){return'<div class="zone-contenu-format"><i aria-hidden="true" class="icon '+aParams.article.iconSection+'"></i></div>';}
getZoneComplementaire(aParams){const lClasses=[];if(aParams.ligne===0){lClasses.push('total');}
return'<span'+(lClasses.length?' class="'+lClasses.join(' ')+'"':'')+'>'+aParams.article.nombre+'</span>';}
getClass(aParams){const lClass='celluleEvenementVS '+((aParams.ligne===0)&&!GEtatUtilisateur.pourPrimaire()?'total':'');return lClass;}
getClassCelluleConteneur(){return'fd_ligne';}
GetVisible(aParams){return aParams.estVisible;}}
module.exports=DonneesListe_EvenementsVS;},fn:"donneesliste_evenementsvs.js"});;
IE.fModule({f:function(exports,require,module,global){const ObjetFenetre=require('ObjetFenetre.js');const TypeThemeBouton=require('Type_ThemeBouton.js');const GTraductions=require('ObjetTraduction.js');const tag=require('tag.js');const{GDate}=require('ObjetDate.js');const ObjetTri=require('ObjetTri.js');require('espace/css/ObjetFenetre_ServicesPeriscolairePourAbsence.css');class ObjetFenetre_ServicesPeriscolairePourAbsence extends ObjetFenetre{constructor(...aParams){super(...aParams);this.setOptionsFenetre({avecTailleSelonContenu:true});}
getControleur(aInstance){return $.extend(true,super.getControleur(this),{getDatesAbsence:function(){if(aInstance&&aInstance.donnees&&aInstance.donnees.absence){const lResult=[];if(GDate.getNbrJoursEntreDeuxDates(aInstance.donnees.absence.debut.date,aInstance.donnees.absence.fin.date)>=1){lResult.push(GDate.FormatDate(aInstance.donnees.absence.debut.date,`${GTraductions.getValeur('Du')} %JJJ %JJ/%MM/%AAAA ${aInstance.donnees.absence.debut.estMatin?GTraductions.getValeur('AbsenceVS.matin'):GTraductions.getValeur('AbsenceVS.apresMidi')}`));lResult.push(GDate.FormatDate(aInstance.donnees.absence.fin.date,`${GTraductions.getValeur('Au')} %JJJ %JJ/%MM/%AAAA ${aInstance.donnees.absence.fin.estMatin?GTraductions.getValeur('AbsenceVS.matin'):GTraductions.getValeur('AbsenceVS.apresMidi')}`));} else{let lSuff='';if(aInstance.donnees.absence.debut.estMatin===aInstance.donnees.absence.fin.estMatin){lSuff=aInstance.donnees.absence.debut.estMatin?GTraductions.getValeur('AbsenceVS.matin'):GTraductions.getValeur('AbsenceVS.apresMidi');}
lResult.push(GDate.FormatDate(aInstance.donnees.absence.debut.date,`[${GTraductions.getValeur('Le')} %JJJ %JJ/%MM/%AAAA] ${lSuff}`));}
return lResult.join(' ')+'. ';}
return'';},getListeServices:function(){if(aInstance&&aInstance.donnees&&aInstance.donnees.liste){const lResult=[];aInstance.donnees.liste.parcourir((aElement) =>{lResult.push(tag('ie-checkbox',{class:['fsp_cb_service'],'ie-model':tag.funcAttr('checkService',[aElement.GetNumero()])},aElement.GetLibelle()));});return lResult.join('');}
return'';},checkService:{getValue:function(aNumero){const lService=aInstance.donnees.liste.GetElementParNumero(aNumero);if(!!lService){return!lService.estPartiel;}
return false;},setValue:function(aNumero,aValue){const lService=aInstance.donnees.liste.GetElementParNumero(aNumero);if(!!lService){lService.estPartiel=!aValue;}}}});}
SetDonnees(aDonnees){this.donnees=aDonnees;if(this.donnees.liste){this.donnees.liste.setTri(ObjetTri.initRecursif('pere',[ObjetTri.init('heureOuverture'),ObjetTri.init('heureFermeture'),ObjetTri.init('Libelle')]));this.donnees.liste.trier();}
this.Afficher();}
ComposeContenu(){const lHtml=[];lHtml.push('<span class="fsp_absence">');lHtml.push(tag('span',{class:['fsp_absence_info']},`${GTraductions.getValeur('fenetreServicesPeriscolairePourAbsence.info')} `));lHtml.push(tag('span',{'ie-html':'getDatesAbsence',class:['fsp_absence_date']}));lHtml.push(tag('span',{class:['fsp_absence_suppl']},GTraductions.getValeur('fenetreServicesPeriscolairePourAbsence.suppl')));lHtml.push(tag('span',{'ie-html':'getListeServices',class:['fsp_liste_services']}));lHtml.push('</span>');return lHtml.join('');}
getParametresValidation(aNumeroBouton){const lParametres=super.getParametresValidation(aNumeroBouton);const lListe=this.donnees.liste.getListeElements((aElement) =>{return!aElement.estPartiel;});$.extend(lParametres,{liste:lListe});return lParametres;}
static ouvrir(aParams){const lFenetre=ObjetFenetre.creerInstance(ObjetFenetre_ServicesPeriscolairePourAbsence,{pere:aParams.pere,evenement:aParams.evenement},{modale:true,titre:GTraductions.getValeur('fenetreServicesPeriscolairePourAbsence.titre'),listeBoutons:[{libelle:GTraductions.getValeur('Annuler'),theme:TypeThemeBouton.secondaire},{libelle:GTraductions.getValeur('Valider'),valider:true,theme:TypeThemeBouton.primaire}],largeur:540,avecTailleSelonContenu:true});lFenetre.SetDonnees(aParams.donnees);}}
module.exports=ObjetFenetre_ServicesPeriscolairePourAbsence;},fn:"objetfenetre_servicesperiscolairepourabsence.js"});;
IE.fModule({f:function(exports,require,module,global){const{ObjetRequeteSaisie}=require('ObjetRequeteJSON.js');const Requetes=require('CollectionRequetes.js');class ObjetRequeteSaisieServicesPeriscolairePourAbsence extends ObjetRequeteSaisie{constructor(...aParams){super(...aParams);}
lancerRequete(aParams){aParams.liste.setSerialisateurJSON({ignorerEtatsElements:true});this.JSON=aParams;return this.appelAsynchrone();}
actionApresRequete(){this.callbackReussite.appel(this.JSONRapportSaisie,this.JSONReponse);}}
Requetes.inscrire('SaisieServicesPeriscolairePourAbsence',ObjetRequeteSaisieServicesPeriscolairePourAbsence);module.exports=ObjetRequeteSaisieServicesPeriscolairePourAbsence;},fn:"objetrequetesaisieservicesperiscolairepourabsence.js"});;
IE.fModule({f:function(exports,require,module,global){const ObjetFicheVSDetailElement=require('ObjetFicheVSDetailElement.js');const ObjetFenetre=require('ObjetFenetre.js');const ObjetRequeteSaisieVieScolaire=require('ObjetRequeteSaisieVieScolaire.js');const GUID=require('GUID.js');const MethodesObjet=require('MethodesObjet.js');const EGenreEtat=require('Enumere_Etat.js');const EStructureAffichage=require('Enumere_StructureAffichage.js');const ObjetListeElements=require('ObjetListeElements.js');const GTraductions=require('ObjetTraduction.js');const ObjetRequetePageVieScolaire=require('ObjetRequetePageVieScolaire.js');const EGenreRessource=require('Enumere_Ressource.js');const ObjetInterfacePage=require('ObjetInterfacePageCP.js');const ObjetUtilitaireAbsence=require('ObjetUtilitaireAbsence.js');const ObjetVSListeDetails=require('ObjetVSListeDetails.js');const ObjetVSDetailElement=require('ObjetVSDetailElement.js');const Toast=require('Toast.js').Toast;const ObjetListe=require('ObjetListe.js');const ETypeToast=require('Toast.js').ETypeToast;const ObjetElement=require('ObjetElement.js');const DonneesListe_EvenementsVS=require('DonneesListe_EvenementsVS.js');const{GDate}=require('ObjetDate.js');const EGenreEvenementListe=require('Enumere_EvenementListe.js');const GHtml=require('GHtml.js');const{TypeDroits}=require('ObjetDroitsPN.js');const ObjetVSFenetre_SaisieAbsence=require('ObjetVSFenetre_SaisieAbsence.js').ObjetVSFenetre_SaisieAbsence;const EGenreEspace=require('Enumere_Espace.js');const MethodesTableau=require('MethodesTableau.js');const TypeThemeBouton=require('Type_ThemeBouton.js');const EGenreOnglet=require('Enumere_Onglet.js');const ObjetFenetre_ServicesPeriscolairePourAbsence=require('ObjetFenetre_ServicesPeriscolairePourAbsence.js');const ObjetRequeteSaisieServicesPeriscolairePourAbsence=require('ObjetRequeteSaisieServicesPeriscolairePourAbsence.js');require('Produit/Css/FlatListeEvenementsVS.css');class InterfaceRecapitulatifVS extends ObjetInterfacePage{constructor(...aParams){super(...aParams);this.donnees={listeRecapitulatifs:new ObjetListeElements(),listeAbsences:new ObjetListeElements(),totaux:{},listeMatieres:new ObjetListeElements(),apresValidation:false,elementSelection:null};this.utilitaireAbsence=new ObjetUtilitaireAbsence();this.idEcranSaisie=GUID.getId();this.idSecondaire=GUID.getId();this.idDetails=GUID.getId();this.idElement=GUID.getId();this.identListeBoutons=GUID.getId();this.retourAccueil=false;this.setOptionsEcrans({nbNiveaux:4,avecBascule:IE.estMobile});this.contexte={niveauCourant:0,ecran:[InterfaceRecapitulatifVS.genreEcran.listeRecap,InterfaceRecapitulatifVS.genreEcran.listeElements,InterfaceRecapitulatifVS.genreEcran.visuElement,InterfaceRecapitulatifVS.genreEcran.ecranSaisie],selection:[],guidRef:GUID.getId()};}
getControleur(aInstance){return $.extend(true,super.getControleur(this),{btnRetourEcranPrec:{event:function(){if(!this.retourAccueil){this.revenirSurEcranPrecedent();} else{GEtatUtilisateur.setPage({Onglet:EGenreOnglet.Accueil});if(GEtatUtilisateur.getGenreOnglet()){var lGenreOnglet=GEtatUtilisateur.getGenreOnglet();GInterface.evenementSurOnglet(lGenreOnglet);}}}.bind(aInstance)},ajouterAbsence:{event:function(){aInstance.ajouterAbsence();}}});}
ConstruireInstances(){this.identListe=this.Add(ObjetListe,this.evenementPage);this.identListeDetails=this.Add(ObjetVSListeDetails,this.evenementListeDetails,_initVSListeDetails);this.identDetailElement=this.Add(ObjetVSDetailElement,this.evenementDetailElement);this.identSaisieElement=this.Add(ObjetVSFenetre_SaisieAbsence,this.evenementSaisieElement);}
evenementSaisieElement(aNumeroBouton,aDonnees){if(aNumeroBouton===1){var lRequete=new ObjetRequeteSaisieVieScolaire(this);var lListeAbsences=new ObjetListeElements().AddElement(aDonnees);lRequete.addUpload({listeFichiers:aDonnees.documents}).lancerRequete(lListeAbsences).then((aParams) =>{Toast.afficher({msg:GTraductions.getValeur('AbsenceVS.message.confirmerDeclaration'),type:ETypeToast.succes,dureeAffichage:4500})
;if(this.callbackApresSaisieAbsences){Object.assign(aParams,{absenceAjoutee:aDonnees});this.callbackApresSaisieAbsences(aParams);}});}}
SetParametresGeneraux(){this.AvecCadre=false;this.avecBandeau=true;this.AddSurZone=[this.identSelection];this.GenreStructure=EStructureAffichage.Autre;}
ConstruireStructureAffichageAutre(){var lHtml=[];var lClass=[];if(this.optionsEcrans.avecBascule){lClass.push('avecBascule');} else{lClass.push('sansBascule');}
if(IE.estMobile){lClass.push('mobile-recapVS mobile-main-content');} else{lClass.push('espace-recapVS');}
lHtml.push('<div class="ifc_RecapVS	ObjetFenetre_Edition_Contenu ',lClass.join(' '),'">');lClass.pop();lClass.push('ifc_RecapVS_EcranRecap');lHtml.push('<div id="',this.getIdDeNiveau({niveauEcran:0}),'"',' class="',lClass.join(' '),'">');lHtml.push('<div id="',this.GetInstance(this.identListe).GetNom(),'" style="height:100%;" class="FlatListeEvenementsVS ',GEtatUtilisateur.pourPrimaire()?'EspaceHaut':'','"></div>');lHtml.push('</div>');lClass.pop();lClass.push('ifc_RecapVS_EcranListe');lHtml.push('<div id="',this.getIdDeNiveau({niveauEcran:1}),'" class="',lClass.join(' '),'">');var lSaisie=GApplication.droits.get(TypeDroits.absences.avecDeclarerUneAbsence);if(GEtatUtilisateur.pourPrimaire()&&lSaisie){lHtml.push('<div class="btn-conteneur" style="display:none;" id="',this.identListeBoutons,'">');lHtml.push('  <ie-bouton ie-model="ajouterAbsence" class="',TypeThemeBouton.primaire,'">',GTraductions.getValeur('AbsenceVS.SaisirAbsenceParentPrim'),'</ie-bouton>');lHtml.push('</div>');}
lHtml.push('<div id="',this.GetInstance(this.identListeDetails).GetNom(),'" class="ifc_RecapVS_EcranListe_Content"></div>');lHtml.push('</div>');lClass.pop();lClass.push('ifc_RecapVS_EcranElement');lHtml.push('<div id="',this.getIdDeNiveau({niveauEcran:2}),'" class="',lClass.join(' '),'">');lHtml.push('<div id="',this.GetInstance(this.identDetailElement).GetNom(),'" class="ifc_RecapVS_EcranElement_Content contenu-edition"></div>');lHtml.push('</div>');lHtml.push('<div id="',this.getIdDeNiveau({niveauEcran:3}),'" class="',lClass.join(' '),'">');lHtml.push('<div id="',this.GetInstance(this.identSaisieElement).GetNom(),'" ></div>');lHtml.push('</div>');lHtml.push('</div>');return lHtml.join('');}
construireEcran(aEcran){var lHtmlBandeau='';switch(aEcran.genreEcran){case InterfaceRecapitulatifVS.genreEcran.ecranSaisie:return new Promise(function(aResolve){var lAbsenceAjoutee=new ObjetElement(null,null,EGenreRessource.Absence);lAbsenceAjoutee.estUneCreationParent=true;var lDateBornee=GDate.getDateBornee(GDate.aujourdhui);lAbsenceAjoutee.debut={date:lDateBornee,estMatin:true};lAbsenceAjoutee.fin={date:lDateBornee,estMatin:false};lAbsenceAjoutee.SetEtat(EGenreEtat.Creation);GHtml.setDisplay(GInterface.idZoneSelection,false);this.GetInstance(this.identSaisieElement).Initialiser();var lThis=this;this.GetInstance(this.identSaisieElement).setOptions({estSidePanel:true,avecBascule:true,instanceAppelante:this,retourAccueil:this.retourAccueil,callbackEnvoyer:function(){if(lThis.retourAccueil){GEtatUtilisateur.setPage({Onglet:EGenreOnglet.Accueil});if(GEtatUtilisateur.getGenreOnglet()){var lGenreOnglet=GEtatUtilisateur.getGenreOnglet();GInterface.evenementSurOnglet(lGenreOnglet);}} else{lThis.deselectionnerRecap();lThis.selectionnerRecap(lThis.objDonneesDuRecap);lThis.afficherListeElementsVSDeRecap();}}});this.GetInstance(this.identSaisieElement).SetDonnees(lAbsenceAjoutee);var lInstance=this.GetInstance(this.identSaisieElement);GHtml.setHtml(this.getIdDeNiveau({niveauEcran:3}),lInstance._composeSlide(),{controleur:lInstance.controleur});aResolve();}.bind(this));case InterfaceRecapitulatifVS.genreEcran.listeRecap:return new Promise(function(aResolve){this.Initialiser(true);aResolve();}.bind(this));case InterfaceRecapitulatifVS.genreEcran.listeElements:return new Promise(function(aResolve){if(this.optionsEcrans.avecBascule){var lDonnees=this.getCtxSelection({niveauEcran:0});lHtmlBandeau=this.construireBandeauEcranVisu({titre:lDonnees.recapitulatif.titreSection,sousTitre:this.periodeCourant.GetLibelle()});this.setHtmlStructureAffichageBandeau(lHtmlBandeau);}
if(!!this.objDonneesDuRecap){this.GetInstance(this.identListeDetails).SetDonnees(this.objDonneesDuRecap);}
aResolve();}.bind(this));case InterfaceRecapitulatifVS.genreEcran.visuElement:return new Promise(function(aResolve){var lElement=this.getCtxSelection({niveauEcran:1});var lElmPourSaisie=MethodesObjet.dupliquer(lElement);var lLibelle=_getLibelleDeGenre(lElement);lHtmlBandeau=this.construireBandeauEcranVisu({titre:lLibelle});if(this.optionsEcrans.avecBascule){this.setHtmlStructureAffichageBandeau(lHtmlBandeau);if(!!lElement){this.GetInstance(this.identDetailElement).SetDonnees(lElmPourSaisie);this.GetInstance(this.identDetailElement).afficher();}} else{this.fiche=ObjetFenetre.creerInstance(ObjetFicheVSDetailElement,{pere:this,evenement:this.utilitaireAbsence.eventApresFiche.bind(this,lElement),initialiser:false});this.fiche.setOptions({avecCallBackSurBouton:true});this.fiche.Initialiser();this.fiche.SetDonnees({element:lElmPourSaisie,titre:lLibelle});}
aResolve();}.bind(this));default:return new Promise(function(aResolve){aResolve();}.bind(this));}}
construireBandeauEcranVisu(aObjet){var H=[];H.push('<div class="titres-contain">');if(aObjet.titre){H.push('<h3 class="ifc_RecapVS_TexteBandeau">',aObjet.titre,'</h3>');}
if(aObjet.sousTitre){H.push('<div class="ifc_RecapVS_TexteBandeauSecondaire">',aObjet.sousTitre,'</div>');}
H.push('</div>');return this.construireBandeauEcran(H.join(''),{bgWhite:true});}
afficherListeElementsVSDeRecap(){var lEcranSrc={niveauEcran:0,genreEcran:this.getCtxEcran({niveauEcran:0}),dataEcran:this.getCtxSelection({niveauEcran:0})};var lEcranDest={niveauEcran:1,genreEcran:this.getCtxEcran({niveauEcran:1})};this.basculerEcran(lEcranSrc,lEcranDest);$('.ifc_RecapVS_EcranListe_Content').find('li:first-child').focus();}
afficherDetailElement(){var lEcranSrc={niveauEcran:1,genreEcran:this.getCtxEcran({niveauEcran:1}),dataEcran:this.getCtxSelection({niveauEcran:1})};var lEcranDest={niveauEcran:2,genreEcran:this.getCtxEcran({niveauEcran:2})};this.basculerEcran(lEcranSrc,lEcranDest);}
afficherEcranSaisie(){var lEcranSrc={niveauEcran:3,genreEcran:this.getCtxEcran({niveauEcran:3})};var lEcranDest={niveauEcran:0,genreEcran:this.getCtxEcran({niveauEcran:0}),dataEcran:this.getCtxSelection({niveauEcran:0})};this.basculerEcran(lEcranSrc,lEcranDest);}
RecupererDonnees(){}
ajouterAbsence(){if(IE.estMobile){var lEcranSrc={niveauEcran:0,genreEcran:this.getCtxEcran({niveauEcran:0}),dataEcran:this.getCtxSelection({niveauEcran:0})};var lEcranDest={niveauEcran:3,genreEcran:this.getCtxEcran({niveauEcran:3})};this.basculerEcran(lEcranSrc,lEcranDest);} else{var lParam={instanceAppel:this,idEcranPrincipal:this.idEcranPrincipal,idEcranSecondaire:this.idEcranSecondaire,estSidePanel:false,callbackApresSaisieAbsences:this.callbackApresSaisieAbsences.bind(this)};new ObjetUtilitaireAbsence().ajouterAbsence(lParam);}}
callbackApresSaisieAbsences(aParams){require('IELog.js').addLog('callbackApresSaisieAbsences : debut');if(!!aParams.servicesPeriscolairePourAbsence&&!!aParams.servicesPeriscolairePourAbsence.liste&&aParams.servicesPeriscolairePourAbsence.liste.GetNbrElements()){require('IELog.js').addLog('Avec services periscolaire pour absence');this.servicesPeriscolairePourAbsence=aParams.servicesPeriscolairePourAbsence;if(aParams.absenceAjoutee){if(this.servicesPeriscolairePourAbsence.absence){this.servicesPeriscolairePourAbsence.absence.debut=aParams.absenceAjoutee.debut;this.servicesPeriscolairePourAbsence.absence.fin=aParams.absenceAjoutee.fin;} else{this.servicesPeriscolairePourAbsence.absence=aParams.absenceAjoutee;}}
this.RecupererDonnees();} else if(!IE.estMobile){GInterface.retourSurNavigation({ignorerHistorique:true,onglet:GEtatUtilisateur.getGenreOnglet()});} else{if(this.retourAccueil){this.actionRetourAccueil();} else{this.deselectionnerRecap();this.selectionnerRecap(this.objDonneesDuRecap);this.afficherListeElementsVSDeRecap();}}}
actionRetourAccueil(){GEtatUtilisateur.setPage({Onglet:EGenreOnglet.Accueil});if(GEtatUtilisateur.getGenreOnglet()){var lGenreOnglet=GEtatUtilisateur.getGenreOnglet();GInterface.evenementSurOnglet(lGenreOnglet);}}
evenementPage(aParam){switch(aParam.genreEvenement){case EGenreEvenementListe.SelectionDblClick:if(GEtatUtilisateur.pourPrimaire()){if(aParam.article.GetGenre()===EGenreRessource.Absence){this.ajouterAbsence();}}
break;default:var lRecap;this.objDonneesDuRecap=null;var lGenre=aParam.article.GetGenre();if(lGenre===EGenreRessource.ObservationProfesseurEleve){for(var i=0,lNbrElem=this.donnees.listeRecapitulatifs.GetNbrElements();i<lNbrElem;i++){var lRecapitulatif=this.donnees.listeRecapitulatifs.GetElement(i);if(lRecapitulatif.genreObservation===aParam.article.genreObservation){lRecap=lRecapitulatif;}}} else{lRecap=this.donnees.listeRecapitulatifs.GetElementParGenre(lGenre);}
if(GEtatUtilisateur.pourPrimaire()){GHtml.setDisplay(this.identListeBoutons,aParam.article.GetGenre()===EGenreRessource.Absence);}
if((lGenre===EGenreRessource.Aucune)||(!!lRecap&&lRecap.Nombre&&lRecap.Nombre.length!==0)){if(lGenre===EGenreRessource.Aucune){this.objDonneesDuRecap={recapitulatif:{titreSection:GTraductions.getValeur('RecapAbsenceEleve.TotalDesHeuresManquees')},donnees:this.donnees.listeMatieres,genre:EGenreRessource.Aucune,totaux:this.donnees.totaux,utilitaireAbsence:this.utilitaireAbsence,autorisations:this.donnees.autorisations};} else{this.objDonneesDuRecap=this.utilitaireAbsence.getDonneesAAfficher.call(this,{recapitulatif:lRecap});}
this.deselectionnerRecap();this.selectionnerRecap(this.objDonneesDuRecap);this.afficherListeElementsVSDeRecap();} else if(!!lRecap&&lRecap.Nombre&&lRecap.Nombre.length===0){var lMessage=this.getRecapitulatifLibelle(lRecap);this.deselectionnerRecap();this.GetInstance(this.identListeDetails).setHtmlMessageVide(lMessage);}}}
evenementListeDetails(aParam){if(!!aParam.element){switch(aParam.evenement){case ObjetVSListeDetails.evenement.validationObservation:if(!aParam.element.estLue){aParam.element.estLue=true;aParam.element.SetEtat(EGenreEtat.Modification);new ObjetRequeteSaisieVieScolaire(this).lancerRequete(this.donnees.listeAbsences).then(function(){if(!!this.objDonneesDuRecap){this.GetInstance(this.identListeDetails).SetDonnees(this.objDonneesDuRecap);}
Toast.afficher({msg:GTraductions.getValeur('AbsenceVS.message.prisConnaissanceinfo'),type:ETypeToast.succes,dureeAffichage:4500});}.bind(this));}
break;case ObjetVSListeDetails.evenement.validationARPunition:if(!aParam.element.estLue){aParam.element.parentAAccuseDeReception=true;aParam.element.SetEtat(EGenreEtat.Modification);const lCleTraduction=aParam.element.GetGenre()===EGenreRessource.Incident?'AbsenceVS.message.ARIncident':'AbsenceVS.message.accuseDeReception';new ObjetRequeteSaisieVieScolaire(this).lancerRequete(this.donnees.listeAbsences).then(function(){if(!!this.objDonneesDuRecap){this.GetInstance(this.identListeDetails).SetDonnees(this.objDonneesDuRecap);}
Toast.afficher({msg:GTraductions.getValeur(lCleTraduction),type:ETypeToast.succes,dureeAffichage:4500});}.bind(this));}
break;case ObjetVSListeDetails.evenement.editionMotifParent:var lFenetres=$('.ObjetFicheVSDetailElement_racine');if(lFenetres.length!==0){lFenetres.remove();}
this.selectionnerDetailElement(aParam.element);this.afficherDetailElement();break;default:break;}}}
majAbsenceApresSaisie(aAbsenceOrig,aAbsenceSaisie){this.utilitaireAbsence._majAbsenceApresSaisie(aAbsenceOrig,aAbsenceSaisie);}
evenementDetailElement(aParam){if(!!aParam&&aParam.element){var lElement=this.getCtxSelection({niveauEcran:1});this.utilitaireAbsence.eventApresFiche.call(this,lElement,aParam);}}
deselectionnerRecap(){var lDataSelection=this.getCtxSelection({niveauEcran:0});if((lDataSelection!==null)&&(lDataSelection!==undefined)){if(!this.optionsEcrans.avecBascule){lDataSelection.estSelectionne=false;this.GetInstance(this.identListeDetails).SetDonnees();}
this.setCtxSelection({niveauEcran:0,dataEcran:null});}}
selectionnerRecap(aRecap){this.setCtxSelection({niveauEcran:0,dataEcran:aRecap});if(!this.optionsEcrans.avecBascule){var lSelection=this.getCtxSelection({niveauEcran:0});if((lSelection!==null)&&(lSelection!==undefined)){lSelection.estSelectionne=true;}}}
selectionnerDetailElement(aElement){this.setCtxSelection({niveauEcran:1,dataEcran:aElement});if(!this.optionsEcrans.avecBascule){var lSelection=this.getCtxSelection({niveauEcran:1});if((lSelection!==null)&&(lSelection!==undefined)){lSelection.estSelectionne=true;}}}
RecupererDonneesRecapVS(){if(this.periodeCourant.existeNumero()){this.periodeCourant=GParametres.listePeriodes.GetElementParNumero(this.periodeCourant.GetNumero());this.DateDebut=this.periodeCourant.dates.debut;this.DateFin=this.periodeCourant.dates.fin;} else{this.DateDebut=GParametres.PremiereDate;this.DateFin=GParametres.DerniereDate;}
new ObjetRequetePageVieScolaire(this,this.actionSurRecupererDonneesRecapVS).lancerRequete(this.DateDebut,this.DateFin,this.periodeCourant);}
actionSurRecupererDonneesRecapVS(aObjet){$.extend(this.donnees,aObjet);if(!!this.donnees.listeRecapitulatifs.GetNbrElements()){for(var i=0,lNbr=this.donnees.listeRecapitulatifs.GetNbrElements();i<lNbr;i++){var lRecap=this.donnees.listeRecapitulatifs.GetElement(i);lRecap.avecAutorisation=_estAutorise(lRecap,this.donnees.autorisations);lRecap.estVisible=lRecap.getNombre()>0;}
this.GetInstance(this.identListe).setOptionsListe({colonnes:[{taille:'100%'}
],skin:ObjetListe.skin.flatDesign,avecOmbreDroite:true});var lListeAvecAutorisation=this.donnees.listeRecapitulatifs.getListeElements(function(aElt){return aElt.avecAutorisation;});var lListeMiseEnForme=new ObjetListeElements();var aInstance=this;if(!GEtatUtilisateur.pourPrimaire()){var lTotal=new ObjetElement();lTotal.titreSection=GTraductions.getValeur('RecapAbsenceEleve.TotalDesHeuresManquees');var lTotaux=this.donnees.totaux;lTotal.iconSection='icon_time total';lTotal.Genre=EGenreRessource.Aucune;lTotal.detail=GTraductions.getValeur('RecapAbsenceEleve.TotalDesHeuresM_Info');lTotal.nombre=aInstance.getDureeTotal(lTotaux.total);lTotal.estVisible=true;lListeMiseEnForme.AddElement(lTotal);}
lListeAvecAutorisation.parcourir(function(aElt){var lElement=aElt;lElement.titreSection=aInstance.getRecapitulatifLibelle(aElt);lElement.iconSection=aInstance.getImage(aElt);lElement.detail=aInstance.getDetails(aElt).join(', ');lElement.nombre=aElt.getNombre();lListeMiseEnForme.AddElement(lElement);});this.GetInstance(this.identListe).SetDonnees(new DonneesListe_EvenementsVS(lListeMiseEnForme));if(!IE.estMobile){lRecap=this.donnees.listeRecapitulatifs.GetElementParGenre(EGenreRessource.Absence);if(lRecap&&lRecap.estVisible){this.objDonneesDuRecap=this.utilitaireAbsence.getDonneesAAfficher.call(this,{recapitulatif:lRecap});this.deselectionnerRecap();this.selectionnerRecap(this.objDonneesDuRecap);this.afficherListeElementsVSDeRecap();var lIndice=this.donnees.listeRecapitulatifs.GetIndiceParElement(lRecap);this.GetInstance(this.identListe).SelectionnerLigne({ligne:GEtatUtilisateur.pourPrimaire()?lIndice:++lIndice,avecScroll:true,avecEvenement:false});GHtml.setDisplay(this.identListeBoutons,true);} else{this.deselectionnerRecap();}}}
if(GEtatUtilisateur.getPage()||!!GEtatUtilisateur.Navigation.OptionsOnglet){var lPage=IE.estMobile?GEtatUtilisateur.getPage():GEtatUtilisateur.Navigation.OptionsOnglet;if(lPage&&lPage.executerSaisieAbsenceParent){if(!!lPage.retourAccueil){this.retourAccueil=lPage.retourAccueil;}
this.ajouterAbsence();GEtatUtilisateur.resetPage();}
if(lPage&&lPage.executerSaisieMotifAbsence){this.retourAccueil=true;var lGenreElement=lPage.element.GetGenre();lIndice=this.donnees.listeRecapitulatifs.getIndiceElementParFiltre(function(aElement){if(aElement.GetGenre()===EGenreRessource.ObservationProfesseurEleve){return aElement.genreObservation===lPage.element.genreObservation;} else{return aElement.GetGenre()===lGenreElement;}});lRecap=this.donnees.listeRecapitulatifs.GetElement(lIndice);this.objDonneesDuRecap=this.utilitaireAbsence.getDonneesAAfficher.call(this,{recapitulatif:lRecap});this.deselectionnerRecap();this.selectionnerRecap(this.objDonneesDuRecap);lIndice=this.donnees.listeRecapitulatifs.getIndiceElementParFiltre(function(aElement){return aElement.GetGenre()===lGenreElement;});this.GetInstance(this.identListe).SelectionnerLigne({ligne:GEtatUtilisateur.pourPrimaire()?lIndice:++lIndice,avecScroll:true,avecEvenement:false});this.afficherListeElementsVSDeRecap();var lAbsence=lPage.element;if((((lAbsence.GetGenre()===EGenreRessource.Absence)||(lAbsence.GetGenre()===EGenreRessource.Retard))&&(!lAbsence.justifie))&&(IE.estMobile)&&(MethodesTableau.existe(GEtatUtilisateur.GenreEspace,[EGenreEspace.Parent,EGenreEspace.Mobile_Parent,EGenreEspace.PrimParent,EGenreEspace.Mobile_PrimParent]))){var lElement=this.objDonneesDuRecap.donnees.GetElementParNumero(lPage.element.GetNumero());this.selectionnerDetailElement(lElement);this.afficherDetailElement();}
GEtatUtilisateur.resetPage();}}
if(this.servicesPeriscolairePourAbsence&&this.servicesPeriscolairePourAbsence.liste&&this.servicesPeriscolairePourAbsence.liste.GetNbrElements()){ObjetFenetre_ServicesPeriscolairePourAbsence.ouvrir({pere:this,evenement:function(aGenreBouton,aParams){if(aParams.bouton&&aParams.bouton.valider){if(aParams.liste&&aParams.liste.GetNbrElements()){new ObjetRequeteSaisieServicesPeriscolairePourAbsence(this).lancerRequete({liste:aParams.liste,debut:this.servicesPeriscolairePourAbsence.debut,fin:this.servicesPeriscolairePourAbsence.fin,eleve:GEtatUtilisateur.getMembre()}).then(() =>{if(this.retourAccueil){this.actionRetourAccueil();}});}} else{if(this.retourAccueil){this.actionRetourAccueil();}}
this.servicesPeriscolairePourAbsence=undefined;}.bind(this),donnees:{liste:this.servicesPeriscolairePourAbsence.liste,absence:this.servicesPeriscolairePourAbsence.absence}});}}
getRecapitulatifLibelle(aRecapitulatif){var lResult=this.utilitaireAbsence.getChaineTraductionGenreAbsenceTitre({genre:aRecapitulatif.Genre,genreObservation:aRecapitulatif.genreObservation,aucun:aRecapitulatif.getNombre()===0,genreNature:aRecapitulatif.genreNature,libelle:aRecapitulatif.Genre!==EGenreRessource.Sanction?aRecapitulatif.Genre!==EGenreRessource.MesureConservatoire?undefined:aRecapitulatif.GetLibelle().toUpperCase():aRecapitulatif.GetLibelle()});return lResult?lResult.ucfirst():'';}
getImage(aRecap){return EGenreRessource.getNomImageAbsence({genre:aRecap.Genre,genreObservation:aRecap.genreObservation,genreNature:aRecap.nature?aRecap.nature.Genre:undefined,justifie:(aRecap.justifie===undefined?true:aRecap.justifie),estProgrammation:(aRecap.estProgrammation===undefined?false:aRecap.estProgrammation),estLue:(aRecap.estLue===undefined?true:aRecap.estLue)});}
getDureeTotal(aPlaces){return aPlaces>0?GDate.FormatDureeEnMillisecondes(aPlaces*1000,'%hh%sh%mm'):'';}
getDetails(aRecap){aRecap.details=[];if(aRecap.GetGenre()===EGenreRessource.ObservationProfesseurEleve){this.remplirDetailObservation(aRecap);} else if(aRecap.GetGenre()===EGenreRessource.Absence){this.remplirDetailAbsence(aRecap);} else if((aRecap.GetGenre()===EGenreRessource.Retard)&&(aRecap.Nombre[0]>0)){this.remplirDetailRetard(aRecap);} else if(aRecap.GetGenre()===EGenreRessource.Punition||aRecap.GetGenre()===EGenreRessource.Sanction||aRecap.GetGenre()===EGenreRessource.Incident){this.remplirDetailPunitionSanctionIncident(aRecap);} else{aRecap.htmlContent='';}
return aRecap.details;}
Valider(aListePJs){var lRequete=new ObjetRequeteSaisieVieScolaire(this,this.ActionSurValidation);if(aListePJs&&aListePJs.GetNbrElements()>0){lRequete.addUpload({listeFichiers:aListePJs});}
lRequete.lancerRequete(this.donnees.listeAbsences);}
remplirDetailAbsence(aRecap){if(aRecap.Nombre[0]>0){aRecap.details.push(this.utilitaireAbsence.getXAbsencesNonJustifiees(aRecap.Nombre[0]).ucfirst());}
var lHeuresManquees=this.getHeuresCoursManquees(aRecap,true);if((lHeuresManquees!=='')&&!GEtatUtilisateur.pourPrimaire()){aRecap.details.push(lHeuresManquees);}}
remplirDetailRetard(aRecap){if(aRecap.Nombre[0]>0){aRecap.details.push(this.utilitaireAbsence.getDontXRetardNonJustifies(aRecap.Nombre[0]));}}
remplirDetailPunitionSanctionIncident(aRecap){for(var j in aRecap.Nombre){var lLibelle=aRecap.libelles[j];var lNombre=aRecap.Nombre[j];if(lNombre>0){aRecap.details.push(lLibelle+' : '+lNombre);}}}
remplirDetailObservation(aRecap){if(aRecap.Nombre[0]>0){aRecap.details.push(this.utilitaireAbsence.getDontXObservationsNonLu(aRecap.Nombre[0]));}}
getHeuresCoursManquees(aElement,aSansSpan){if(!aElement.nbrHeures||aElement.nbrHeures==='0h00'){return'';}
var lTrad='';if(parseInt(aElement.nbrHeures.charAt(0))<2){lTrad=GTraductions.getValeur('AbsenceVS.heureCoursManque',[aElement.nbrHeures]);} else{lTrad=GTraductions.getValeur('AbsenceVS.heuresCoursManquees',[aElement.nbrHeures]);}
if(aSansSpan){return lTrad;}
return'<span>'+lTrad+'</span><br>';}}
InterfaceRecapitulatifVS.genreEcran={listeRecap:'listeRecap',listeElements:'listeElements',visuElement:'visuElement',ecranSaisie:'ecranSaisie'};function _initVSListeDetails(aInstance){aInstance.setOptions({avecBascule:this.optionsEcrans.avecBascule});}
function _getLibelleDeGenre(aElement){var lResult='';switch(aElement.GetGenre()){case EGenreRessource.Absence:if(aElement.html&&aElement.html.avecSaisie){lResult=GTraductions.getValeur('AbsenceVS.JustifierAbsence');} else{lResult=GTraductions.getValeur('AbsenceVS.AbsenceDu',[aElement.infosDate.dateDebut]);}
break;case EGenreRessource.Retard:if(aElement.html&&aElement.html.avecSaisie){lResult=GTraductions.getValeur('AbsenceVS.JustifierRetard');} else{lResult=GTraductions.getValeur('AbsenceVS.RetardDu',[aElement.infosDate.dateDebut]);}
break;default:break;}
return lResult;}
function _estAutorise(aRecap,aAutorisations){if(!!aAutorisations){switch(aRecap.GetGenre()){case EGenreRessource.ObservationProfesseurEleve:return!!aAutorisations.observation;case EGenreRessource.Absence:return!!aAutorisations.absence;case EGenreRessource.AbsenceRepas:return!!aAutorisations.absenceRepas;case EGenreRessource.AbsenceInternat:return!!aAutorisations.absenceInternat;case EGenreRessource.Infirmerie:return!!aAutorisations.infirmerie;case EGenreRessource.Retard:return!!aAutorisations.retard;case EGenreRessource.Incident:return!!aAutorisations.incident;case EGenreRessource.Punition:return!!aAutorisations.exclusion||!!aAutorisations.punition;case EGenreRessource.Sanction:return!!aAutorisations.sanction;case EGenreRessource.MesureConservatoire:return!!aAutorisations.mesureConservatoire;default:return false;}} else{return false;}}
module.exports=InterfaceRecapitulatifVS;},fn:"produit/script/interfacerecapitulatifvs.js"});;
IE.fModule({f:function(exports,require,module,global){const InterfaceRecapitulatifVS=require('produit/script/InterfaceRecapitulatifVS.js');const ObjetSelection=require('ObjetSelection.js').ObjetSelection;class InterfaceRecapitulatifVS_Mobile extends InterfaceRecapitulatifVS{constructor(...aParams){super(...aParams);}
ConstruireInstances(){this.identSelection=this.Add(ObjetSelection,this.evenementSelection);super.ConstruireInstances();}
RecupererDonnees(){var lOngletInfosPeriodes=GEtatUtilisateur.getOngletInfosPeriodes();if(lOngletInfosPeriodes.message){this.GetInstance(this.identPage).SetMessage(lOngletInfosPeriodes.message);} else{if(!this.listePeriodes){this.listePeriodes=lOngletInfosPeriodes.listePeriodes;var lNrPeriodeParDefaut=GEtatUtilisateur.getPage()&&GEtatUtilisateur.getPage().periode?GEtatUtilisateur.getPage().periode.GetNumero():lOngletInfosPeriodes.periodeParDefaut.GetNumero();this.positionPeriodeCourant=this.listePeriodes.GetIndiceParNumeroEtGenre(lNrPeriodeParDefaut);if(!this.positionPeriodeCourant){this.positionPeriodeCourant=0;}
this.periodeCourant=this.listePeriodes.GetElement(this.positionPeriodeCourant);}
this.GetInstance(this.identSelection).SetDonnees(this.listePeriodes,this.positionPeriodeCourant,null,'');this.basculerVisibiliteSurGenreEcran(this.getCtxEcran({niveauEcran:0}));}}
evenementSelection(aParam){this.periodeCourant=aParam.element;this.positionPeriodeCourant=this.listePeriodes.GetIndiceParElement(this.periodeCourant);this.RecupererDonneesRecapVS();}}
module.exports=InterfaceRecapitulatifVS_Mobile;},fn:"mobile/script/interfacerecapitulatifvs_mobile.js"});;
IE.fModule({f:function(exports,require,module,global){const{ObjetRequeteConsultation}=require('ObjetRequeteJSON.js');const Requetes=require('CollectionRequetes.js');class ObjetRequeteDetailEvaluationsCompetences extends ObjetRequeteConsultation{constructor(...aParams){super(...aParams);}
lancerRequete(aParam){this.JSON={eleve:aParam.eleve,pilier:aParam.pilier,periode:aParam.periode,relationsESI:aParam.numRelESI,resultatSansLigneDeCumul:aParam.resultatSansLigneDeCumul,avecEdition:aParam.avecEdition};return this.appelAsynchrone();}
actionApresRequete(){this.callbackReussite.appel(this.JSONReponse);}}
Requetes.inscrire('DetailEvaluationsCompetences',ObjetRequeteDetailEvaluationsCompetences);module.exports=ObjetRequeteDetailEvaluationsCompetences;},fn:"objetrequetedetailevaluationscompetences.js"});;
IE.fModule({f:function(exports,require,module,global){const TypeGenreColonneBulletinCompetence={tCBdC_Services:0,tCBdC_EltProg:1,tCBdC_EltPilier:2,tCBdC_Jauge:3,tCBdC_NivAcqComp:4,tCBdC_Pourcentage:5,tCBdC_PosLSUP1:6,tCBdC_PosLSUP2:7,tCBdC_PosLSU:8,tCBdC_Note:9,tCBdC_MoyenneClasse:10,tCBdC_MoyenneInf:11,tCBdC_MoyenneSup:12,tCBdC_AppreciationA:13,tCBdC_AppreciationB:14,tCBdC_AppreciationC:15};module.exports.TypeGenreColonneBulletinCompetence=TypeGenreColonneBulletinCompetence;},fn:"typegenrecolonnebulletincompetence.js"});;
IE.fModule({f:function(exports,require,module,global){const TypeGenreElementBulletinCompetence={tEBPM_SurMatiere:0,tEBPM_Service:1,tEBPM_EltPilier:2,tEBPM_Competence:3,tEBPM_SousItem:4};module.exports.TypeGenreElementBulletinCompetence=TypeGenreElementBulletinCompetence;},fn:"typegenreelementbulletincompetence.js"});;
IE.fModule({f:function(exports,require,module,global){const TypeJaugeEvaluationBulletinCompetence={tJBC_Chronologique:0,tJBC_ParNiveau:1};module.exports.TypeJaugeEvaluationBulletinCompetence=TypeJaugeEvaluationBulletinCompetence;},fn:"typejaugeevaluationbulletincompetence.js"});;
IE.fModule({f:function(exports,require,module,global){const MethodesObjet=require('MethodesObjet.js');const GHtml=require('GHtml.js');const Identite=require('ObjetIdentite.js');const ObjetIdentite_Mobile=require('ObjetIdentite_Mobile.js');const ObjetElement=require('ObjetElement.js');const ObjetListeElements=require('ObjetListeElements.js');const GTraductions=require('ObjetTraduction.js');const ObjetTri=require('ObjetTri.js');const UtilitaireBulletinEtReleve_Mobile=require('UtilitaireBulletinEtReleve_Mobile.js');const EGenreNiveauDAcquisition=require('Enumere_NiveauDAcquisition.js');const EGenreRessource=require('Enumere_Ressource.js');const UtilitaireDeserialiserPiedBulletin=require('UtilitaireDeserialiserPiedBulletin.js');const ObjetRequeteDetailEvaluationsCompetences=require('ObjetRequeteDetailEvaluationsCompetences.js');const TypeGenreColonneBulletinCompetence=require('TypeGenreColonneBulletinCompetence.js').TypeGenreColonneBulletinCompetence;const TypeGenreElementBulletinCompetence=require('TypeGenreElementBulletinCompetence.js').TypeGenreElementBulletinCompetence;const TypeJaugeEvaluationBulletinCompetence=require('TypeJaugeEvaluationBulletinCompetence.js').TypeJaugeEvaluationBulletinCompetence;const TypePositionnement=require('TypePositionnement.js').TypePositionnement;const PiedDeBulletinMobile=require('PiedDeBulletinMobile.js');const TypeContexteBulletin=require('TypeContexteBulletin.js');const TypeReleveBulletin=require('TypeReleveBulletin.js');const ObjetFenetre=require('ObjetFenetre.js');class ObjetBulletinCompetences extends ObjetIdentite_Mobile{constructor(...aParams){super(...aParams);this.donneesRecues=false;this.estBilanParMatiere=false;this.listeElementsCompetence=new ObjetListeElements();const lToutesLesCompetences=new ObjetElement(GTraductions.getValeur('competences.ToutesLesCompetences'),'2',null,null,null);const lPositionementGeneral=new ObjetElement(GTraductions.getValeur('competences.PositionnementGeneral'),'1',null,null,null);this.listeElementsCompetence.AddElement(lToutesLesCompetences);this.listeElementsCompetence.AddElement(lPositionementGeneral);this.btnCombo=this.Nom+"_boutonCombo";this.modaleCombo=this.Nom+'_modaleZoneCombo';this.corpsDePage=this.Nom+'_corpsDePage';this.listeEvaluations=this.Nom+"_listeEvaluations";this.piedDePage=this.Nom+"_piedDeBulletin";this.eltProg=this.Nom+"_elementsDuProgramme";this.instancePiedDeBulletin=Identite.creerInstance(PiedDeBulletinMobile,{pere:this,evenement:null});this.instancePiedDeBulletin.setDonneesContexte({typeContexteBulletin:TypeContexteBulletin.CB_Eleve,avecSaisie:false,typeReleveBulletin:TypeReleveBulletin.BulletinCompetences});}
SetDonnees(aDonneesCorpsDePage,aEstBilanParMatiere){if(!!aDonneesCorpsDePage.maquette){this.donnees=aDonneesCorpsDePage;this.listeServices=new ObjetListeElements();this.estBilanParMatiere=aEstBilanParMatiere;this.donneesRecues=true;this.message=false;} else{this.donnees=false;this.estBilanParMatiere=false;this.donneesRecues=false;this.message=false;}
this.Afficher();const lDonneesPiedDeBulletin=new UtilitaireDeserialiserPiedBulletin().creerPiedDePage(this.donnees);const lDonneesAbsences=new UtilitaireDeserialiserPiedBulletin().creerAbsences(this.donnees);this.instancePiedDeBulletin.setDonneesPiedDeBulletin(lDonneesPiedDeBulletin,lDonneesAbsences);this.instancePiedDeBulletin.Afficher();}
Afficher(aHtml,aDirectionSlide){super.Afficher(aHtml,aDirectionSlide);if(!this.estBilanParMatiere){this.setTitreBoutonCombo(this.listeElementsCompetence.GetElement(0).GetNumero());}}
SetMessage(aMessage){this.message=aMessage;this.Afficher();}
ConstruireAffichage(){const lHtml=[];if(!!this.message){lHtml.push(this.composeAucuneDonnee(this.message));} else if(this.donneesRecues){this.formaterListes();if(!!this.estBilanParMatiere){lHtml.push(this.composeCorpsDePage(this.estBilanParMatiere));} else{lHtml.push(this.composeCombo());lHtml.push('<div id="',this.corpsDePage,'">'+this.composeCorpsDePage(this.estBilanParMatiere,"2")+'</div>');}
lHtml.push('<div id="',this.instancePiedDeBulletin.GetNom(),'"></div>');}
return lHtml.join('');}
_getInstanceModale(){const $objetModaleCombo=$("#"+this.modaleCombo.escapeJQ());let lInstanceObjetModaleCombo=M.Modal.getInstance($objetModaleCombo);if(!lInstanceObjetModaleCombo){M.Modal.init($objetModaleCombo,{});lInstanceObjetModaleCombo=M.Modal.getInstance($objetModaleCombo);}
return lInstanceObjetModaleCombo;}
afficherModale(){this._getInstanceModale().open();}
fermerModaleListe(){const lInstanceModale=this._getInstanceModale();if(lInstanceModale.isOpen){lInstanceModale.close();}}
formaterListes(){let lRegroupement=null;if(!!this.donnees&&this.donnees.listeLignes.GetNbrElements()){this.donnees.listeLignes.parcourir(function(D){if(D.GetGenre()===TypeGenreElementBulletinCompetence.tEBPM_SurMatiere){D.estUnDeploiement=true;D.estDeploye=true;lRegroupement=D;} else{if(D.GetGenre()===TypeGenreElementBulletinCompetence.tEBPM_EltPilier||(D.GetGenre()===TypeGenreElementBulletinCompetence.tEBPM_Service&&D.estDansRegroupement)){D.pere=lRegroupement;} else{lRegroupement=null;}}});}}
composeCorpsDePage(aEstBilanParMatiere,aNumero){const lHtml=[];let lGenrePositionnement,lElem=null,lExisteRegroupement=false;const lIdListeEvaluations=this.listeEvaluations+(!!aEstBilanParMatiere?'_BilanParMatiere':'_BilanTransversal_'+aNumero);if(!!this.donnees&&!!this.donnees.listeLignes&&this.donnees.listeLignes.GetNbrElements()){if(!!aEstBilanParMatiere||(!aEstBilanParMatiere&&aNumero==="1")){lHtml.push('<ul id="',lIdListeEvaluations,'"class="collection with-header bg-white bulletin">');for(let i=0,lNbrElem=this.donnees.listeLignes.GetNbrElements();i<lNbrElem;i++){lElem=this.donnees.listeLignes.GetElement(i);if(lElem.GetGenre()===TypeGenreElementBulletinCompetence.tEBPM_SurMatiere){lHtml.push('<li class="collection-header collection-group with-action">');lHtml.push('<div>'+lElem.strServiceEtProf+'</div>');lHtml.push('</li>');lExisteRegroupement=true;} else if(lElem.GetGenre()===TypeGenreElementBulletinCompetence.tEBPM_Service){const lEstDansRegroupement=!!lElem.estDansRegroupement;lHtml.push('<li class="collection-item with-action  ',lEstDansRegroupement?'':(!!lExisteRegroupement?' break-group':''),'" onclick="',this.Nom,'.ouvrirPanel(\'',lElem.GetNumero(),'\',',aEstBilanParMatiere,')" style="',lEstDansRegroupement?'padding:3px 0px 3px 12px;':'padding: 3px 0px 3px 16px;','">');lHtml.push('<div class="matiere-conteneur bullCompetences" style="border-color:'+(!!lElem.couleur&&lElem.couleur!==""?lElem.couleur:'D4D4D4')+';" >');lHtml.push('<div class="libelle">'+lElem.strServiceEtProf+'</div>');lHtml.push('<div class="infos-moy-eleve">');if(lElem.posLSUNote){lHtml.push('<div class="moyenne-eleve">');lHtml.push(lElem.posLSUNote.getNote());lHtml.push('</div>');}
if(!!this.donnees.maquette.avecNiveauxPositionnements){if(lElem.posLSUNiveau){lGenrePositionnement=this.donnees.typePositionnement||TypePositionnement.POS_Echelle;lHtml.push('<div class="nivMaitrise-eleve">');lHtml.push(EGenreNiveauDAcquisition.getImagePositionnement({niveauDAcquisition:lElem.posLSUNiveau,genrePositionnement:lGenrePositionnement}));lHtml.push('</div>');}}
lHtml.push('</div>');lHtml.push('</div>');lHtml.push('</li>');this.listeServices.AddElement(lElem);}}
lHtml.push('</ul>');} else if(!aEstBilanParMatiere&&aNumero==="2"){lHtml.push('<ul id="',lIdListeEvaluations,'" class="collection with-header bg-white bulletin">');for(let i=0,lNbrElem=this.donnees.listeLignes.GetNbrElements();i<lNbrElem;i++){lElem=this.donnees.listeLignes.GetElement(i);if(lElem.GetGenre()===TypeGenreElementBulletinCompetence.tEBPM_SurMatiere){lHtml.push('<li class="collection-header collection-group with-action">');lHtml.push('<div>'+lElem.strServiceEtProf+'</div>');lHtml.push('</li>');lExisteRegroupement=true;} else if(lElem.GetGenre()===TypeGenreElementBulletinCompetence.tEBPM_Service&&!!lElem.estDansRegroupement){lHtml.push('<li class="collection-item with-action" onclick="',this.Nom,'.ouvrirPanel(\'',lElem.GetNumero(),'\',',aEstBilanParMatiere,')" style="padding:3px 12px;">');lHtml.push(this.composeListeNiveauDAqcuisitions(lElem));lHtml.push('</li>');this.listeServices.AddElement(lElem);} else if(lElem.GetGenre()===TypeGenreElementBulletinCompetence.tEBPM_Service&&!lElem.estDansRegroupement){lHtml.push('<li class="collection-item with-action ',(!!lExisteRegroupement?' break-group':''),'" onclick="',this.Nom,'.ouvrirPanel(\'',lElem.GetNumero(),'\',',aEstBilanParMatiere,')" style="padding:3px 16px;">');lHtml.push(this.composeListeNiveauDAqcuisitions(lElem));lHtml.push('</li>');this.listeServices.AddElement(lElem);}}
lHtml.push('</ul>');} else{lHtml.push('<ul id="',lIdListeEvaluations,'"class="collection with-header bg-white bulletin">');for(let i=0,lNbrElem=this.donnees.listeLignes.GetNbrElements();i<lNbrElem;i++){lElem=this.donnees.listeLignes.GetElement(i);if(lElem.GetGenre()===TypeGenreElementBulletinCompetence.tEBPM_SurMatiere){lHtml.push('<li class="collection-header collection-group with-action">');lHtml.push('<div>'+lElem.strServiceEtProf+'</div>');lHtml.push('</li>');lExisteRegroupement=true;} else if(lElem.GetGenre()===TypeGenreElementBulletinCompetence.tEBPM_Service&&!!lElem.estDansRegroupement){lHtml.push('<li class="collection-item with-action" onclick="',this.Nom,'.ouvrirPanel(\'',lElem.GetNumero(),'\',',aEstBilanParMatiere,')" style="padding:3px 12px;">');lHtml.push('<div style="border-left: 5px solid '+(!!lElem.couleur&&lElem.couleur!==""?lElem.couleur:'D4D4D4')+'; padding: 10px 5px;">');lHtml.push('<div>'+lElem.strServiceEtProf+'</div>');lHtml.push(this.getImagePastille(lElem,aNumero));lHtml.push('</div>');lHtml.push('</li>');this.listeServices.AddElement(lElem);} else if(lElem.GetGenre()===TypeGenreElementBulletinCompetence.tEBPM_Service&&!lElem.estDansRegroupement){lHtml.push('<li class="collection-item with-action ',(!!lExisteRegroupement?' break-group':''),'" onclick="',this.Nom,'.ouvrirPanel(\'',lElem.GetNumero(),'\',',aEstBilanParMatiere,')" style="padding:3px 16px;">');lHtml.push('<div class="flex-contain" style="border-left: 5px solid '+(!!lElem.couleur&&lElem.couleur!==""?lElem.couleur:'D4D4D4')+'; padding: 10px 5px;">');lHtml.push('<div class="fluid-bloc">'+lElem.strServiceEtProf+'</div>');lHtml.push(this.getImagePastille(lElem,aNumero));lHtml.push('</div>');lHtml.push('</li>');this.listeServices.AddElement(lElem);}}
lHtml.push('</ul>');}}
return lHtml.join('');}
composeCombo(){const lHtml=[];lHtml.push('<div>');lHtml.push('<div class="right">');lHtml.push('<button id="',this.btnCombo,'" class="btn-flat triangleGrey" onclick="'+this.Nom+'.afficherModale();">&nbsp;</button>');lHtml.push('</div>');lHtml.push('<div class="clear"></div>');lHtml.push('</div>');lHtml.push('<div id="',this.modaleCombo,'" class="modal">');const lToutesLesCompetences=this.listeElementsCompetence.GetElement(0);lHtml.push('<ul class="collection" style="min-width:130px;">');lHtml.push('<li class="collection-item with-action" onclick="'+this.Nom+'.surClickElemDropDown(\'',lToutesLesCompetences.GetNumero(),'\')">',lToutesLesCompetences.GetLibelle()+'</li>');if(!!this.donnees.maquette.avecNiveauxPositionnements){const lPositionnementGeneral=this.listeElementsCompetence.GetElement(1);lHtml.push('<li class="collection-item with-action" onclick="'+this.Nom+'.surClickElemDropDown(\'',lPositionnementGeneral.GetNumero(),'\')">',lPositionnementGeneral.GetLibelle()+'</li>');}
if(!!this.donnees.listeLignes&&this.donnees.listeLignes.GetNbrElements()){let lElement=false,lNbrEleme=this.donnees.listeLignes.GetNbrElements(),i=0;while(!lElement&i<lNbrEleme){if(this.donnees.listeLignes.GetGenre(i)===TypeGenreColonneBulletinCompetence.tCBdC_EltPilier){lElement=this.donnees.listeLignes.GetElement(i);}
i++;}
if(!!lElement&&!!lElement.listeColonnesTransv&&lElement.listeColonnesTransv.GetNbrElements()){const lThis=this;lElement.listeColonnesTransv.parcourir(function(aElementCompetence){lThis.listeElementsCompetence.AddElement(aElementCompetence);lHtml.push('<li class="collection-item with-action" onclick="'+lThis.Nom+'.surClickElemDropDown(\'',aElementCompetence.GetNumero(),'\')">'+aElementCompetence.GetLibelle()+'</li>');});}}
lHtml.push('</ul>');lHtml.push('</div>');return lHtml.join('');}
ouvrirPanel(aNumeroService,aEstBilanParMatiere){GInterface.openPanel(this.composePanel(aNumeroService,aEstBilanParMatiere));$('#'+this.eltProg.escapeJQ()).children('ul').addClass("browser-default");}
composePanel(aNumeroElement,aEstBilanParMatiere){const lHtml=[];let lElemParent,lElem;if(!!aEstBilanParMatiere){const lListeElement=new ObjetListeElements();for(let i=0,lNbrServices=this.donnees.listeLignes.GetNbrElements();i<lNbrServices;i++){lElem=this.donnees.listeLignes.GetElement(i);if(lElem.GetNumero()===aNumeroElement&&(lElem.GetGenre()===TypeGenreElementBulletinCompetence.tEBPM_Competence||lElem.GetGenre()===TypeGenreElementBulletinCompetence.tEBPM_EltPilier)){lListeElement.AddElement(lElem);} else if(lElem.GetNumero()===aNumeroElement&&lElem.GetGenre()===TypeGenreElementBulletinCompetence.tEBPM_Service){lHtml.push('<div class="navheader with-title-close">','    <div class="title-contain">','        <h3>',GTraductions.getValeur('BulletinEtReleve.DetailsMatiere'),'</h3>','        <ie-btnimage onclick="'+GInterface.GetNom()+'.closePanel();" class="btnImageIcon icon_fermeture_widget" ></ie-btnimage>','    </div>','    <div class="nav-prec-suiv">','      <ie-btnimage onclick="',this.Nom,'.surClickProchainElement(\'',lElem.GetNumero(),'\',',false,',',aEstBilanParMatiere,')" class="btnImageIcon icon_angle_left"></ie-btnimage>','      <div class="libelle-contain">',this.composeBandeauService(lElem),'</div>','      <ie-btnimage onclick="',this.Nom,'.surClickProchainElement(\'',lElem.GetNumero(),'\',',true,',',aEstBilanParMatiere,')" class="btnImageIcon icon_angle_right"></ie-btnimage>','    </div>','</div>');lElemParent=lElem;}}
lHtml.push(this.composeListeCompetencesEvaluees(lListeElement,lElemParent,aEstBilanParMatiere));if(!!lElemParent){if((!!lElemParent.strEltProg&&lElemParent.hintEltProg!=="")||(!!lElemParent.strEltProg&&lElemParent.strEltProg!=="")){lHtml.push('<div style="padding:10px 5px 5px 5px;">');const lColonneEltProg=this.donnees.listeColonnes.GetElementParGenre(TypeGenreColonneBulletinCompetence.tCBdC_EltProg);const lLibellelColonneEltProg=!!lColonneEltProg&&lColonneEltProg.GetLibelle()!==""?lColonneEltProg.GetLibelle():"";lHtml.push('<div class="left-align color : #616161;">'+lLibellelColonneEltProg+'</div>');lHtml.push('<div id="'+this.eltProg+'" class="Espace">');if(!!lElemParent.strEltProg&&lElemParent.strEltProg!==""){lHtml.push(lElemParent.strEltProg);}
if(!!lElemParent.hintEltProg&&lElemParent.hintEltProg!==""){lHtml.push(lElemParent.hintEltProg);}
lHtml.push('</div>');lHtml.push('</div>');}
if(!!lElemParent.appreciationA&&lElemParent.appreciationA!==""){const lColonneAppreciationsParMatiere=this.donnees.listeColonnes.GetElementParGenre(TypeGenreColonneBulletinCompetence.tCBdC_AppreciationA);const lLibelleAppreciationsParMatiere=!!lColonneAppreciationsParMatiere&&lColonneAppreciationsParMatiere.GetLibelle()!==""?lColonneAppreciationsParMatiere.GetLibelle():"";lHtml.push(UtilitaireBulletinEtReleve_Mobile.composeAppreciation({intituleDAppreciation:lLibelleAppreciationsParMatiere,contenuDAppreciation:lElemParent.appreciationA,styleBlockIntitule:'color : #616161;',styleBlockContenu:'border:1px solid #616161; background-color: #F1F1F1;'}));}
if(!!lElemParent.appreciationB&&lElemParent.appreciationB!==""){const lColonneProgressionParMatiere=this.donnees.listeColonnes.GetElementParGenre(TypeGenreColonneBulletinCompetence.tCBdC_AppreciationB);const lLibelleProgressionParMatiere=!!lColonneProgressionParMatiere&&lColonneProgressionParMatiere.GetLibelle()!==""?lColonneProgressionParMatiere.GetLibelle():"";lHtml.push(UtilitaireBulletinEtReleve_Mobile.composeAppreciation({intituleDAppreciation:lLibelleProgressionParMatiere,contenuDAppreciation:lElemParent.appreciationB,styleBlockIntitule:'color : #616161;',styleBlockContenu:'border:1px solid #616161; background-color: #F1F1F1;'}));}
if(!!lElemParent.appreciationC&&lElemParent.appreciationC!==""){const lColonneConseilParMatiere=this.donnees.listeColonnes.GetElementParGenre(TypeGenreColonneBulletinCompetence.tCBdC_AppreciationC);const lLibelleConseilParMatiere=!!lColonneConseilParMatiere&&lColonneConseilParMatiere.GetLibelle()!==""?lColonneConseilParMatiere.GetLibelle():"";lHtml.push(UtilitaireBulletinEtReleve_Mobile.composeAppreciation({intituleDAppreciation:lLibelleConseilParMatiere,contenuDAppreciation:lElemParent.appreciationC,styleBlockIntitule:'color : #616161;',styleBlockContenu:'border:1px solid #616161; background-color: #F1F1F1;'}));}}} else{lElem=this.donnees.listeLignes.GetElementParNumero(aNumeroElement);lHtml.push('<div class="navheader with-title-close">','    <div class="title-contain">','        <h3>',GTraductions.getValeur('BulletinEtReleve.DetailsMatiere'),'</h3>','        <ie-btnimage onclick="'+GInterface.GetNom()+'.closePanel();" class="btnImageIcon icon_fermeture_widget" ></ie-btnimage>','    </div>','    <div class="nav-prec-suiv">','      <ie-btnimage onclick="',this.Nom,'.surClickProchainElement(\'',lElem.GetNumero(),'\',',false,',',aEstBilanParMatiere,')" class="btnImageIcon icon_angle_left"></ie-btnimage>','      <div class="libelle-contain">',this.composeBandeauService(lElem),'</div>','      <ie-btnimage onclick="',this.Nom,'.surClickProchainElement(\'',lElem.GetNumero(),'\',',true,',',aEstBilanParMatiere,')" class="btnImageIcon icon_angle_right"></ie-btnimage>','    </div>','</div>');if(!!lElem.listeColonnesTransv&&lElem.listeColonnesTransv.GetNbrElements()){lHtml.push(this.composeListeCompetencesEvaluees(lElem.listeColonnesTransv,null,aEstBilanParMatiere));}
if(!!lElem&&!!lElem.appreciationA&&lElem.appreciationA!==""){const lColonneAppreciationsTabTransv=this.donnees.listeColonnes.GetElementParGenre(TypeGenreColonneBulletinCompetence.tCBdC_AppreciationA);const lLibelleAppreciationsTabTransv=!!lColonneAppreciationsTabTransv&&lColonneAppreciationsTabTransv.GetLibelle()!==""?lColonneAppreciationsTabTransv.GetLibelle():"";lHtml.push(UtilitaireBulletinEtReleve_Mobile.composeAppreciation({intituleDAppreciation:lLibelleAppreciationsTabTransv,contenuDAppreciation:lElem.appreciationA,styleBlockIntitule:'color : #616161;',styleBlockContenu:'border:1px solid #616161; background-color: #F1F1F1;'}));}
if(!!lElem&&!!lElem.appreciationB&&lElem.appreciationB!==""){const lColonneProgressionTabTransv=this.donnees.listeColonnes.GetElementParGenre(TypeGenreColonneBulletinCompetence.tCBdC_AppreciationB);const lLibelleProgressionTabTransv=!!lColonneProgressionTabTransv&&lColonneProgressionTabTransv.GetLibelle()!==""?lColonneProgressionTabTransv.GetLibelle():"";lHtml.push(UtilitaireBulletinEtReleve_Mobile.composeAppreciation({intituleDAppreciation:lLibelleProgressionTabTransv,contenuDAppreciation:lElem.appreciationB,styleBlockIntitule:'color : #616161;',styleBlockContenu:'border:1px solid #616161; background-color: #F1F1F1;'}));}
if(!!lElem&&!!lElem.appreciationC&&lElem.appreciationC!==""){const lColonneConseilTabTransv=this.donnees.listeColonnes.GetElementParGenre(TypeGenreColonneBulletinCompetence.tCBdC_AppreciationC);const lLibelleConseilTabTransv=!!lColonneConseilTabTransv&&lColonneConseilTabTransv.GetLibelle()!==""?lColonneConseilTabTransv.GetLibelle():"";lHtml.push(UtilitaireBulletinEtReleve_Mobile.composeAppreciation({intituleDAppreciation:lLibelleConseilTabTransv,contenuDAppreciation:lElem.appreciationC,styleBlockIntitule:'color : #616161;',styleBlockContenu:'border:1px solid #616161; background-color: #F1F1F1;'}));}}
return lHtml.join('');}
composeBandeauService(aService){const lHtml=[];const lPourcentageReussite=this.donnees.listeColonnes.GetElementParGenre(TypeGenreColonneBulletinCompetence.tCBdC_Pourcentage);lHtml.push('<h4>'+aService.strServiceEtProf+'</h4>');lHtml.push('<div class="sub-titre-contain">');if(!!aService.pourcentage&&aService.pourcentage!==""&&!!lPourcentageReussite&&lPourcentageReussite.GetLibelle()!==""){lHtml.push('<div class="per-cent">'+GTraductions.getValeur('competences.TauxDeReussite')+" "+aService.pourcentage+"%"+'</div>');}
if(!!aService.posLSUNiveau){lHtml.push('<div class="pastille-conteneur">'+
EGenreNiveauDAcquisition.getImagePositionnement({niveauDAcquisition:aService.posLSUNiveau,genrePositionnement:this.donnees.typePositionnement||TypePositionnement.POS_Echelle})+'</div>');}
if(!!aService.posLSUNote){lHtml.push('<div>'+aService.posLSUNote.getNote()+'</div>');}
lHtml.push('</div>');return lHtml.join('');}
composeListeCompetencesEvaluees(aListeCompetencesEvaluees,aElementParent,aEstBilanParMatiere){const lHtml=[];if((!!aListeCompetencesEvaluees&&aListeCompetencesEvaluees.GetNbrElements())||!!aElementParent){lHtml.push('<ul class="collection with-header bg-white bulletin" style="overflow-Y:auto;">');if(!!aEstBilanParMatiere){if(!!aElementParent){lHtml.push(this.composeBarreNiveauxDAcquisitions(aElementParent));}
if(!!aListeCompetencesEvaluees&&aListeCompetencesEvaluees.GetNbrElements()){for(let i=0,lNbrCompetencesEvaluees=aListeCompetencesEvaluees.GetNbrElements();i<lNbrCompetencesEvaluees;i++){let lCompetence=aListeCompetencesEvaluees.GetElement(i);const lPourChronologique=this._estJaugeChronologique();const listeNiveaux=lPourChronologique?lCompetence.listeNiveauxChronologique:lCompetence.listeNiveaux;lHtml.push('<li class="collection-item ',(!!listeNiveaux?'with-action':''),'" onclick="'+(!!listeNiveaux?this.Nom+'.surClicJaugeEvaluations('+lCompetence.Position+')':''),'">','    <div class="evaluations-conteneur">','      <div class="description">',lCompetence.strElmtCompetence,'</div>','      <div class="pastilles">');if(!!listeNiveaux&&listeNiveaux.GetNbrElements()){for(let j=0,lNbrNiveau=listeNiveaux.GetNbrElements();j<lNbrNiveau;j++){const lNiveau=GParametres.listeNiveauxDAcquisitions.GetElementParElement(listeNiveaux.GetElement(j));const lNbr=listeNiveaux.GetElement(j).nbr;if((lNbr!==null)&&(lNbr!==undefined)){if(lNbr!==0){lHtml.push('<div class="pastille-nbr-conteneur">');lHtml.push('<div class="nbr">',lNbr,'</div>');lHtml.push('<div >',EGenreNiveauDAcquisition.getImage(lNiveau),'</div>');lHtml.push('</div>');}} else{lHtml.push('<div >',EGenreNiveauDAcquisition.getImage(lNiveau),'</div>');}}}
lHtml.push('</div>');lHtml.push('</div>');lHtml.push('</li>');}}} else{for(let i=0,lNbrCompetencesEvaluees=aListeCompetencesEvaluees.GetNbrElements();i<lNbrCompetencesEvaluees;i++){let lCompetence=aListeCompetencesEvaluees.GetElement(i);const lExisteUnNiveauAcqui=(!!lCompetence.niveauAcqui),lAUnNiveauAcquiSaisi=lExisteUnNiveauAcqui&&lCompetence.niveauAcqui.existeNumero(),lAUnNiveauAcquiCalcule=(!!lCompetence.niveauAcquiCalc&&lCompetence.niveauAcquiCalc.existeNumero());lHtml.push('<li class="collection-item" style="padding-left:4px; padding-right:4px;">');lHtml.push('<div>',lCompetence.GetLibelle(),'</div>');if(lExisteUnNiveauAcqui&&lAUnNiveauAcquiCalcule){if(lAUnNiveauAcquiSaisi){lHtml.push('<div class="secondary-content">',EGenreNiveauDAcquisition.getImage(lCompetence.niveauAcqui),'</div>');}
lHtml.push('<div class="secondary-content">',' (',EGenreNiveauDAcquisition.getImage(lCompetence.niveauAcquiCalc),')','</div>');} else if(lAUnNiveauAcquiSaisi||lAUnNiveauAcquiCalcule){if(lAUnNiveauAcquiSaisi){lHtml.push('<div class="secondary-content">',EGenreNiveauDAcquisition.getImage(lCompetence.niveauAcqui),'</div>');} else{lHtml.push('<div class="secondary-content"',EGenreNiveauDAcquisition.getImage(lCompetence.niveauAcquiCalc),'</div>');}}
lHtml.push('</li>');}}
lHtml.push('</ul>');}
return lHtml.join('');}
composeListeNiveauDAqcuisitions(aElem){const lHtml=[];lHtml.push('<div style="border-left: 5px solid '+(!!aElem.couleur&&aElem.couleur!==""?aElem.couleur:'D4D4D4')+'; padding: 10px 5px;">');lHtml.push('<div class="InlineBlock AlignementHaut" style="width:64%;">'+aElem.strServiceEtProf+'</div>');if(!!aElem.listeColonnesTransv&&aElem.listeColonnesTransv.GetNbrElements()){lHtml.push('<div class="InlineBlock AlignementHaut right-align" style="width:35%;">');for(let j=0,lNbrElement=aElem.listeColonnesTransv.GetNbrElements();j<lNbrElement;j++){const lObjetElementColonneTransv=aElem.listeColonnesTransv.GetElement(j),lExisteUnNiveauAcqui=(!!lObjetElementColonneTransv.niveauAcqui),lAUnNiveauAcquiSaisi=lExisteUnNiveauAcqui&&lObjetElementColonneTransv.niveauAcqui.existeNumero(),lAUnNiveauAcquiCalcule=(!!lObjetElementColonneTransv.niveauAcquiCalc&&lObjetElementColonneTransv.niveauAcquiCalc.existeNumero());if(lExisteUnNiveauAcqui&&lAUnNiveauAcquiCalcule){if(lAUnNiveauAcquiSaisi){lHtml.push('<div class="InlineBlock" style="',(!!GParametres.afficherAbbreviationNiveauDAcquisition?'padding:0rem 0.2rem;':''),'">',EGenreNiveauDAcquisition.getImage(lObjetElementColonneTransv.niveauAcqui),'</div>');} else{lHtml.push('<div class="InlineBlock" style="width:16px;">&nbsp;</div>');}
lHtml.push('<div class="InlineBlock"  style="',(!!GParametres.afficherAbbreviationNiveauDAcquisition?'padding:0rem 0.2rem;':''),'">',' (',EGenreNiveauDAcquisition.getImage(lObjetElementColonneTransv.niveauAcquiCalc),')','</div>');} else if(lAUnNiveauAcquiSaisi||lAUnNiveauAcquiCalcule){if(lAUnNiveauAcquiSaisi){lHtml.push('<div class="InlineBlock"  style="',(!!GParametres.afficherAbbreviationNiveauDAcquisition?'padding:0rem 0.2rem;':''),'">',EGenreNiveauDAcquisition.getImage(lObjetElementColonneTransv.niveauAcqui),'</div>');} else{lHtml.push('<div class="InlineBlock"  style="',(!!GParametres.afficherAbbreviationNiveauDAcquisition?'padding:0rem 0.2rem;':''),'">',EGenreNiveauDAcquisition.getImage(lObjetElementColonneTransv.niveauAcquiCalc),'</div>');}}}
lHtml.push('</div>');}
lHtml.push('</div>');return lHtml.join('');}
composeBarreNiveauxDAcquisitions(aElem){const lHtml=[];const lInfos=[];let lTotal=0,lElt;const lListeNiveauxDAcquisitions=MethodesObjet.dupliquer(GParametres.listeNiveauxDAcquisitions);let lNiveau,lGenre,lCouleur,lImage,lNombre,n=lListeNiveauxDAcquisitions.GetNbrElements();const lPourChronologique=this._estJaugeChronologique();const listeNiveaux=lPourChronologique?aElem.listeNiveauxChronologique:aElem.listeNiveaux;const avecAbsent=(!lPourChronologique&&aElem.GetGenre()===TypeGenreElementBulletinCompetence.tEBPM_EltPilier);const hint=aElem.hintNiveaux;const pourPastille=aElem.GetGenre()===TypeGenreElementBulletinCompetence.tEBPM_EltPilier;if(!!lPourChronologique&&listeNiveaux&&listeNiveaux.GetNbrElements()){lHtml.push('<li class="collection-header white valign-wrapper',(!!listeNiveaux?' with-action':''),'" style="padding: 0.6rem 0.0rem 0.6rem 0.3rem;" onclick="'+(!!listeNiveaux?this.Nom+'.surClicJaugeEvaluations('+aElem.Position+')':''),'">');const lSeparateur='';for(let i=0;i<listeNiveaux.GetNbrElements();i++){lNiveau=lListeNiveauxDAcquisitions.GetElementParGenre(listeNiveaux.GetGenre(i));lCouleur=EGenreNiveauDAcquisition.getCouleur(lNiveau);lHtml.push('<div class="InlineBlock" style="width:2rem; height:2rem; border: 1px solid #343434; background-color:',lCouleur,'">&nbsp;</div>');}
lHtml.push('</li>');return lHtml.join(lSeparateur);}
lListeNiveauxDAcquisitions.setTri([
ObjetTri.init('positionJauge')
]);lListeNiveauxDAcquisitions.trier();for(let i=0;i<n;i++){lNiveau=lListeNiveauxDAcquisitions.GetElement(i);if(lNiveau.existeNumero()){lGenre=lNiveau.GetGenre();if(avecAbsent||(lGenre!==EGenreNiveauDAcquisition.Absent&&lGenre!==EGenreNiveauDAcquisition.NonEvalue)){lCouleur=EGenreNiveauDAcquisition.getCouleur(lNiveau);lImage=EGenreNiveauDAcquisition.getImage(lNiveau,{avecTitle:!hint});lNombre=listeNiveaux&&listeNiveaux.GetElementParGenre(lGenre)?listeNiveaux.GetElementParGenre(lGenre).nbr:0;lTotal+=lNombre;if(lNombre!==0){lInfos.push({nombre:lNombre,couleur:lCouleur,image:lImage});}}}}
if(lInfos.length){lHtml.push('<li class="collection-header with-action jauge-conteneur"  onclick="'+this.Nom+'.surClicJaugeEvaluations(',aElem.Position,')">');for(let i=0;i<lInfos.length;i++){lElt=lInfos[i];if(pourPastille){lHtml.push('<div class="AlignementDroit EspaceDroit" style="width:',100/(n-2),'%;" >');if(!!lElt.nombre){lHtml.push('<div class="InlineBlock" style="margin-right: 5px;">',lElt.nombre,'</div><div class="InlineBlock">',lElt.image,'</div></div>');} else{lHtml.push('&nbsp;');}
lHtml.push('</div>');} else{if(!!lElt.nombre){lHtml.push('<div class="InlineBlock" style="border:1px solid #343434; background-color:',lElt.couleur,'; width:',lElt.nombre*100/lTotal,'%; height: 2rem">&nbsp;</div>');}}}
lHtml.push('</li>');}
return lHtml.join('');}
_estJaugeChronologique(){return this.donnees.maquette.genreJauge===TypeJaugeEvaluationBulletinCompetence.tJBC_Chronologique;}
surClickProchainElement(aNumeroElement,aEstSuivant,aEstBilanParMatiere){let lIndiceElementActuel,lIndiceProchainElement,lNumeroProchainElement;for(let i=0,lNbrElem=this.listeServices.GetNbrElements();i<lNbrElem;i++){if(aNumeroElement===this.listeServices.GetNumero(i)){lIndiceElementActuel=i;if(!!aEstSuivant){lIndiceProchainElement=lIndiceElementActuel+1<this.listeServices.GetNbrElements()?lIndiceElementActuel+1:0;lNumeroProchainElement=this.listeServices.GetNumero(lIndiceProchainElement);} else{lIndiceProchainElement=lIndiceElementActuel===0?this.listeServices.GetNbrElements()-1:lIndiceElementActuel-1;lNumeroProchainElement=this.listeServices.GetNumero(lIndiceProchainElement);}}}
if(!!lNumeroProchainElement){GInterface.updatePanelContent(this.composePanel(lNumeroProchainElement,aEstBilanParMatiere));$('#'+this.eltProg.escapeJQ()).children('ul').addClass("browser-default");}}
getImagePastille(aElement,aNumero){if(!!aElement.listeColonnesTransv&&aElement.listeColonnesTransv.GetNbrElements()){const lHtml=[];const lCompetence=aElement.listeColonnesTransv.GetElementParNumero(aNumero),lExisteUnNiveauAcqui=(!!lCompetence.niveauAcqui),lAUnNiveauAcquiSaisi=lExisteUnNiveauAcqui&&lCompetence.niveauAcqui.existeNumero(),lAUnNiveauAcquiCalcule=(!!lCompetence.niveauAcquiCalc&&lCompetence.niveauAcquiCalc.existeNumero());if(lExisteUnNiveauAcqui&&lAUnNiveauAcquiCalcule){if(lAUnNiveauAcquiSaisi){lHtml.push('<div class="fix-bloc">',EGenreNiveauDAcquisition.getImage(lCompetence.niveauAcqui),'</div>');}
lHtml.push('<div class="fix-bloc">',' (',EGenreNiveauDAcquisition.getImage(lCompetence.niveauAcquiCalc),')','</div>');} else if(lAUnNiveauAcquiSaisi||lAUnNiveauAcquiCalcule){if(lAUnNiveauAcquiSaisi){lHtml.push('<div class="fix-bloc">',EGenreNiveauDAcquisition.getImage(lCompetence.niveauAcqui),'</div>');} else{lHtml.push('<div class="fix-bloc"',EGenreNiveauDAcquisition.getImage(lCompetence.niveauAcquiCalc),'</div>');}}
return lHtml.join('');} else{return false;}}
surClickElemDropDown(aNumOption){$('#'+this.corpsDePage.escapeJQ()).html(this.composeCorpsDePage(this.estBilanParMatiere,aNumOption));this.setTitreBoutonCombo(aNumOption);this.fermerModaleListe();}
setTitreBoutonCombo(aNumOption){const lHtml=[];const lTitreBouton=this.listeElementsCompetence.GetElementParNumero(aNumOption).Libelle;lHtml.push('<span>',lTitreBouton,'</span>');GHtml.setHtml(this.btnCombo,lHtml.join(''));}
surClicJaugeEvaluations(aPositionElement){let lElement;for(let i=0,lNbrElem=this.donnees.listeLignes.GetNbrElements();i<lNbrElem;i++){if(this.donnees.listeLignes.GetElement(i).Position===aPositionElement){lElement=this.donnees.listeLignes.GetElement(i);}}
if(!!lElement&&!!lElement.relationsESI&&!!lElement.relationsESI.length){new ObjetRequeteDetailEvaluationsCompetences(this,_surReponseRequeteDetailEvaluations.bind(this,lElement)).lancerRequete({eleve:GEtatUtilisateur.getMembre(),periode:GEtatUtilisateur.Navigation.GetRessource(EGenreRessource.Periode),numRelESI:lElement.relationsESI});}}}
function _surReponseRequeteDetailEvaluations(aLigne ,aJSON){if(!!aLigne&&!!aJSON){const lHtml=[];lHtml.push('<ul class="collection with-header  bg-white bulletin">');for(let i=0,lNbrElem=aJSON.listeLignes.GetNbrElements();i<lNbrElem;i++){const lElement=aJSON.listeLignes.GetElement(i);if(lElement.GetGenre()===0||lElement.GetGenre()===1){lHtml.push('<li class="collection-header" style="border-bottom-color:#d1d1d1; background-color: #FFFFFF;">');lHtml.push('<div class="InlineBlock left-align" style="width:80%; vertical-align:top;">',lElement.GetLibelle(),'</div>');if(!!lElement.strCoef){lHtml.push('<div class="InlineBlock right-align" style="width:19%; vertical-align:top; padding-right:2px;">'+GTraductions.getValeur('competences.colonne.coef')+' '+lElement.strCoef,'</div>');}
lHtml.push('</li>');} else{const lNiveauAcqui=lElement.niveauAcqu;const lNiveauAcquiGlobal=GParametres.listeNiveauxDAcquisitions.GetElementParGenre(lNiveauAcqui.GetGenre());lHtml.push('<li class="collection-item">','<div style="padding-right: 2.5rem;">',lElement.GetLibelle(),(!!lNiveauAcqui&&!!lNiveauAcqui.observation?('<br/><span style="font-style: italic;">'+lNiveauAcqui.observation+'</span>'):''),'</div>','<div class="secondary-content" style="width: 2rem; text-align: center;',(!!GParametres.afficherAbbreviationNiveauDAcquisition?'right:0.9rem':''),'" >',EGenreNiveauDAcquisition.getImage(lNiveauAcquiGlobal),'</div>','</li>');}}
lHtml.push('</ul>');ObjetFenetre.creerInstance(ObjetFenetre,{pere:this},{titre:aLigne.GetLibelle(),fermerFenetreSurClicHorsFenetre:true}).Afficher(lHtml.join(''));}}
module.exports=ObjetBulletinCompetences;},fn:"pagebulletincompetences.js"});;
IE.fModule({f:function(exports,require,module,global){const{ObjetRequeteConsultation}=require('ObjetRequeteJSON.js');const Requetes=require('CollectionRequetes.js');class ObjetRequeteBulletinCompetences extends ObjetRequeteConsultation{constructor(...aParams){super(...aParams);}
lancerRequete(aParam){this.JSON={classe:aParam.classe,periode:aParam.periode,eleve:aParam.eleve,bulletin:aParam.bulletin};return this.appelAsynchrone();}
actionApresRequete(){const lListeLignes=this.JSONReponse.listeLignes;if(lListeLignes){lListeLignes.parcourir(function(aLigne){if(!!aLigne.niveauAcqComp){Object.assign(aLigne.niveauAcqComp,_getNiveauAcquisitionGlobal(aLigne.niveauAcqComp));}
if(!!aLigne.posLSUNiveauP1){Object.assign(aLigne.posLSUNiveauP1,_getNiveauAcquisitionGlobal(aLigne.posLSUNiveauP1));}
if(!!aLigne.posLSUNiveauP2){Object.assign(aLigne.posLSUNiveauP2,_getNiveauAcquisitionGlobal(aLigne.posLSUNiveauP2));}
if(!!aLigne.posLSUNiveau){Object.assign(aLigne.posLSUNiveau,_getNiveauAcquisitionGlobal(aLigne.posLSUNiveau));}
if(aLigne.listeColonnesTransv){aLigne.listeColonnesTransv.parcourir(function(aElementColonneTransv){if(!!aElementColonneTransv.niveauAcqui&&aElementColonneTransv.niveauAcqui.existeNumero()){Object.assign(aElementColonneTransv.niveauAcqui,_getNiveauAcquisitionGlobal(aElementColonneTransv.niveauAcqui));}
if(!!aElementColonneTransv.niveauAcquiCalc&&aElementColonneTransv.niveauAcquiCalc.existeNumero()){Object.assign(aElementColonneTransv.niveauAcquiCalc,_getNiveauAcquisitionGlobal(aElementColonneTransv.niveauAcquiCalc));}});}});}
this.callbackReussite.appel(this.JSONReponse);}}
Requetes.inscrire('BulletinCompetences',ObjetRequeteBulletinCompetences);function _getNiveauAcquisitionGlobal(aNiveauAcquision){return GParametres.listeNiveauxDAcquisitions.GetElementParGenre(aNiveauAcquision.GetGenre());}
module.exports=ObjetRequeteBulletinCompetences;},fn:"objetrequetebulletincompetences.js"});;
IE.fModule({f:function(exports,require,module,global){const TypeGenreBulletinCompetence={tGBC_ParMatiere:0,tGBC_Transversal:1};module.exports.TypeGenreBulletinCompetence=TypeGenreBulletinCompetence;},fn:"typegenrebulletincompetence.js"});;
IE.fModule({f:function(exports,require,module,global){const ObjetBulletinCompetences=require('PageBulletinCompetences.js');const ObjetRequeteBulletinCompetences=require('ObjetRequeteBulletinCompetences.js');const Identite=require('ObjetIdentite.js');const EStructureAffichage=require('Enumere_StructureAffichage.js');const EGenreEspace=require('Enumere_Espace.js');const EGenreRessource=require('Enumere_Ressource.js');const InterfacePage_Mobile=require('InterfacePage_Mobile.js');const ObjetElement=require('ObjetElement.js');const ObjetListeElements=require('ObjetListeElements.js');const ObjetSelection=require('ObjetSelection.js').ObjetSelection;const ObjetTabOnglets=require('ObjetTabOnglets.js');const GTraductions=require('ObjetTraduction.js');const TypeGenreBulletinCompetence=require('TypeGenreBulletinCompetence.js').TypeGenreBulletinCompetence;const UtilitaireCompetences_Mobile=require('UtilitaireCompetences_Mobile.js');const ObjetRequeteSaisieBulletinCompetences=require('ObjetRequeteSaisieBulletinCompetences.js');const ObjetBoutonFlottant=require('ObjetBoutonFlottant.js');const GenerationPDF=require('utilitairegenerationpdf.js');const OptionsPdf=require('OptionsPDFSco.js');const TypeHttpGenerationPDFSco=require('TypeHttpGenerationPDFSco.js').TypeHttpGenerationPDFSco;const{TypeDroits}=require('ObjetDroitsPN.js');const MethodesTableau=require('MethodesTableau.js');const UtilitaireGestionCloudEtPDF=require('UtilitaireGestionCloudEtPDF.js');class InterfacePageBulletinCompetences extends InterfacePage_Mobile{constructor(...aParams){super(...aParams);this.listePeriodes=new ObjetListeElements();this.periodeCourant=new ObjetElement();this.indiceParDefaut=0;this.idWrapper=this.Nom+'_wrapper';this.listeTabs=new ObjetListeElements();this.GenreStructure=EStructureAffichage.Autre;this.identBtnFlottant=null;this.avecGestionAccuseReception=MethodesTableau.existe(GEtatUtilisateur.GenreEspace,[EGenreEspace.Mobile_PrimParent,EGenreEspace.Mobile_Parent])&&(GEtatUtilisateur.pourPrimaire()||GApplication.droits.get(TypeDroits.fonctionnalites.gestionARBulletins));}
getControleur(aInstance){return $.extend(true,super.getControleur(this),{getIdentiteBouton:function(){return{class:ObjetBoutonFlottant,pere:this,init:function(aBtn){aInstance.identBtnFlottant=aBtn;const lListeBtn=[];if(GApplication.droits.get(TypeDroits.autoriserImpression)){lListeBtn.push({primaire:true,icone:"icon_pdf",callback:aInstance.AfficherModalitesGenerationPDF.bind(this,aInstance,_genererPdf)});}
lListeBtn.push({icone:'icon_diffuser_information large',callback:aInstance.surClicLegende.bind(this,true)});aBtn.setOptionsBouton({listeBoutons:lListeBtn});}};}});}
AfficherModalitesGenerationPDF(aInstance){let lParams={callbaskEvenement:aInstance.surEvenementFenetre.bind(aInstance),modeGestion:UtilitaireGestionCloudEtPDF.modeGestion.PDFEtCloud,avecDepot:true,avecTitreSelonOnglet:true};UtilitaireGestionCloudEtPDF.creerFenetreGestion(lParams);}
surEvenementFenetre(aLigne){const lService=GEtatUtilisateur.listeCloudDepotServeur.GetElement(aLigne);_genererPdf.call(this,!!lService?lService.GetGenre():null);}
ConstruireInstances(){this.identSelection=this.Add(ObjetSelection,this.surSelectionPeriode);if(this.avecGestionAccuseReception){this.identCbAccuseReception=this.Add(ObjetCheckBox,_surEvenementAccuseReception.bind(this));}
this.identTabs=this.Add(ObjetTabOnglets,null,_initialiserObjetTabs);this.identPageBilanParMatiere=this.Add(ObjetBulletinCompetences);const lObjElementParMatiere=new ObjetElement(GTraductions.getValeur('competences.BilanParMatiere'),null,TypeGenreBulletinCompetence.tGBC_ParMatiere);lObjElementParMatiere.Actif=false;lObjElementParMatiere.idDiv=this.GetInstance(this.identPageBilanParMatiere).GetNom();this.listeTabs.AddElement(lObjElementParMatiere);this.identPageBilanTransversal=this.Add(ObjetBulletinCompetences);const lObjElementBilanTransv=new ObjetElement(GTraductions.getValeur('competences.BilanTransversal'),null,TypeGenreBulletinCompetence.tGBC_Transversal);lObjElementBilanTransv.Actif=false;lObjElementBilanTransv.idDiv=this.GetInstance(this.identPageBilanTransversal).GetNom();this.listeTabs.AddElement(lObjElementBilanTransv);this.AddSurZone=[];this.AddSurZone.push(this.identSelection);if(!!this.identCbAccuseReception){this.AddSurZone.push(this.identCbAccuseReception);}
this.AddSurZone.push(this.identTabs);}
ConstruireStructureAffichageAutre(){const lHtml=[];lHtml.push('<div id="',this.idWrapper,'">','<div id="',this.GetInstance(this.identPageBilanParMatiere).GetNom(),'"></div>','<div id="',this.GetInstance(this.identPageBilanTransversal).GetNom(),'"></div>','</div>');if(!this.identBtnFlottant){$("#"+GInterface.idZonePrincipale).IEHtmlAppend('<div class="is-sticky" ie-identite="getIdentiteBouton" ></div>',{controleur:this.controleur,avecCommentaireConstructeur:false});this.identBtnFlottant.SetVisible(false);}
return lHtml.join('');}
surClicLegende(avecNiveauxPositionnements){UtilitaireCompetences_Mobile.openPopupDetailLegende(avecNiveauxPositionnements);}
RecupererDonnees(){const lOngletInfosPeriodes=GEtatUtilisateur.getOngletInfosPeriodes();this.listePeriodes=lOngletInfosPeriodes.listePeriodes;if(!(this.listePeriodes&&this.listePeriodes.GetNbrElements())){return'';} else{const lNrPeriodeParDefaut=GEtatUtilisateur.getPage()&&GEtatUtilisateur.getPage().periode?GEtatUtilisateur.getPage().periode.GetNumero():lOngletInfosPeriodes.periodeParDefaut.GetNumero();this.indiceParDefaut=this.listePeriodes.GetIndiceParNumeroEtGenre(lNrPeriodeParDefaut);if(!this.indiceParDefaut){this.indiceParDefaut=0;}
this.periodeCourant=this.listePeriodes.GetElement(this.indiceParDefaut);this.GetInstance(this.identSelection).SetDonnees(this.listePeriodes,this.indiceParDefaut,null,'');}}
ActionSurRecupererDonnees(aIndiceBulletin ,aParams){this.maquetteBulletin=aParams.maquette;if(!this.maquetteBulletin){this.listeTabs.GetElementParGenre(TypeGenreBulletinCompetence.tGBC_ParMatiere).Actif=true;this.listeTabs.GetElementParGenre(TypeGenreBulletinCompetence.tGBC_Transversal).Actif=false;this.GetInstance(this.identPageBilanParMatiere).SetMessage(aParams.Message);if(!!this.identCbAccuseReception){this.GetInstance(this.identCbAccuseReception).SetVisible(false);}
this.identBtnFlottant.SetVisible(false);} else{const lBulletin=this.maquetteBulletin.listeBulletins.GetElement(aIndiceBulletin||0);if(lBulletin&&lBulletin.GetGenre()===TypeGenreBulletinCompetence.tGBC_ParMatiere){this.GetInstance(this.identPageBilanParMatiere).SetDonnees(aParams,true);this.listeTabs.GetElementParGenre(TypeGenreBulletinCompetence.tGBC_ParMatiere).Actif=true;} else if(lBulletin&&lBulletin.GetGenre()===TypeGenreBulletinCompetence.tGBC_Transversal){this.GetInstance(this.identPageBilanTransversal).SetDonnees(aParams,false);this.listeTabs.GetElementParGenre(TypeGenreBulletinCompetence.tGBC_Transversal).Actif=true;if(aIndiceBulletin===0){this.listeTabs.GetElementParGenre(TypeGenreBulletinCompetence.tGBC_ParMatiere).Actif=false;}}
if(aIndiceBulletin<this.maquetteBulletin.listeBulletins.GetNbrElements()-1){this.lancerRequete(++aIndiceBulletin);return;}
if(!!this.identCbAccuseReception){this.GetInstance(this.identCbAccuseReception).SetVisible(true);let lCbAccuseReceptionValeur=false;let lReponsableAccuseReception=null;if(!!aParams.listeAccusesReception&&aParams.listeAccusesReception.GetNbrElements()>0){lReponsableAccuseReception=aParams.listeAccusesReception.GetPremierElement();if(!!lReponsableAccuseReception){lCbAccuseReceptionValeur=lReponsableAccuseReception.aPrisConnaissance;}}
this.GetInstance(this.identCbAccuseReception).SetDonnees(lCbAccuseReceptionValeur);this.GetInstance(this.identCbAccuseReception).SetVisible(!!lReponsableAccuseReception);}
this.identBtnFlottant.SetVisible(true);}
this.GetInstance(this.identTabs).SetDonnees(this.listeTabs,0);const $wrapper=$('#'+this.idWrapper.escapeJQ());let $tailleLegende=0;const $legende=$wrapper.siblings('footer');if($legende.is(':visible')){$tailleLegende=$legende.height();}
$wrapper.css('margin-bottom',$tailleLegende+'px');}
lancerRequete(aIndiceBulletin){new ObjetRequeteBulletinCompetences(this,this.ActionSurRecupererDonnees.bind(this,aIndiceBulletin)).lancerRequete({classe:GEtatUtilisateur.getMembre().Classe,periode:this.periodeCourant,eleve:GEtatUtilisateur.getMembre(),bulletin:this.maquetteBulletin?this.maquetteBulletin.listeBulletins.GetElement(aIndiceBulletin):undefined});}
free(...aParams){super.free(...aParams);if(this.identBtnFlottant){$('#'+this.identBtnFlottant.GetNom().escapeJQ()).remove();}}
surSelectionPeriode(aParam){this.periodeCourant=aParam.element;GEtatUtilisateur.Navigation.SetRessource(EGenreRessource.Periode,aParam.element);this.lancerRequete(TypeGenreBulletinCompetence.tGBC_ParMatiere);}}
function _genererPdf(aService){const lParametrageAffichage={genreGenerationPDF:TypeHttpGenerationPDFSco.BulletinDeCompetences,periode:GEtatUtilisateur.Navigation.GetRessource(EGenreRessource.Periode)};GenerationPDF.genererPDF({paramPDF:lParametrageAffichage,optionsPDF:OptionsPdf.BulletinDeCompetences,cloudCible:aService});}
function _surEvenementAccuseReception(aPrisConnaissance){new ObjetRequeteSaisieBulletinCompetences(this).lancerRequete({aPrisConnaissance:aPrisConnaissance});}
function _initialiserObjetTabs(aInstance){aInstance.SetParametres({avecSwipe:false});}
class ObjetCheckBox extends Identite{constructor(...aParams){super(...aParams);this.estActif=false;}
getControleur(aInstance){return $.extend(true,super.getControleur(aInstance),{cbAccuseReception:{getValue:function(){return aInstance.estActif;},setValue:function(aValue){aInstance.estActif=aValue;aInstance.callback.appel(aInstance.estActif);},getDisabled:function(){return aInstance.estActif;}}});}
SetDonnees(aEstActif){this.estActif=aEstActif;}
ConstruireAffichage(){const lHtml=[];lHtml.push('<div style="padding: 0.5rem;">','<ie-checkbox ie-textright class="AlignementMilieuVertical" ie-model="cbAccuseReception">',GTraductions.getValeur('BulletinEtReleve.JAiPrisConnaissanceDuBilanPeriodique'),'</ie-checkbox>','</div>');return lHtml.join('');}}
module.exports=InterfacePageBulletinCompetences;},fn:"mobile/script/interfacepagebulletincompetences.js"});;
IE.fModule({f:function(exports,require,module,global){const EGenreDocTelechargement={certificat:1,bulletin:2,attestation:3,documents:4,projetAcc:5};module.exports=EGenreDocTelechargement;},fn:"enumere_doctelechargement.js"});;
IE.fModule({f:function(exports,require,module,global){const{ObjetRequeteConsultation}=require('ObjetRequeteJSON.js');const Requetes=require('CollectionRequetes.js');const EGenreTriElement=require('Enumere_TriElement.js');const ObjetElement=require('ObjetElement.js');const ObjetListeElements=require('ObjetListeElements.js');const ObjetTri=require('ObjetTri.js');const GenerationPDF=require('UtilitaireGenerationPDF.js');const TypeHttpGenerationPDFSco=require('TypeHttpGenerationPDFSco.js').TypeHttpGenerationPDFSco;const EGenreDocTelechargement=require('Enumere_DocTelechargement.js');const OptionsPdf=require('OptionsPDFSco.js');const UtilitaireGestionCloudEtPDF=require('UtilitaireGestionCloudEtPDF.js');class ObjetRequeteDocumentsATelecharger extends ObjetRequeteConsultation{constructor(...aParams){super(...aParams);}
lancerRequete(aParam){this.JSON=Object.assign({avecNotes:false,avecCompetences:false,listeElevesBIA:undefined},aParam);if(this.JSON.listeElevesBIA&&this.JSON.listeElevesBIA.setSerialisateurJSON){this.JSON.listeElevesBIA.setSerialisateurJSON({ignorerEtatsElements:true});}
return this.appelAsynchrone();}
actionApresRequete(){const lListe=new ObjetListeElements();let lElement;if(this.JSONReponse.listeDocuments&&this.JSONReponse.listeDocuments.GetNbrElements()>0){this.JSONReponse.listeDocuments.parcourir(function(aDocument){const lElement=new ObjetElement(aDocument.Libelle,aDocument.Numero);lElement.annee=GParametres.PremiereDate.getFullYear();lElement.typeDocument=EGenreDocTelechargement.documents;lElement.event=function(){let lParams={callbaskEvenement:function(aLigne){const lService=GEtatUtilisateur.listeCloudDepotServeur.GetElement(aLigne);const lCloud=!!lService?lService.GetGenre():null;GenerationPDF.genererPDF({paramPDF:{avecDepot:true,genreGenerationPDF:TypeHttpGenerationPDFSco.DocumentTelechargeable,document:aDocument.toJSON()},cloudCible:lCloud});},titre:aDocument.Libelle,modeGestion:UtilitaireGestionCloudEtPDF.modeGestion.PDFEtCloud,avecDepot:true};UtilitaireGestionCloudEtPDF.creerFenetreGestion(lParams);};lListe.AddElement(lElement);});}
if(this.JSONReponse.listeDocumentsMembre&&this.JSONReponse.listeDocumentsMembre.GetNbrElements()>0){this.JSONReponse.listeDocumentsMembre.parcourir(function(aDocument){const lElement=new ObjetElement(aDocument.Libelle,aDocument.Numero);lElement.annee=GParametres.PremiereDate.getFullYear();lElement.typeDocument=EGenreDocTelechargement.documents;lElement.event=function(){let lParams={callbaskEvenement:function(aLigne){const lService=GEtatUtilisateur.listeCloudDepotServeur.GetElement(aLigne);const lCloud=!!lService?lService.GetGenre():null;GenerationPDF.genererPDF({paramPDF:{avecDepot:true,genreGenerationPDF:TypeHttpGenerationPDFSco.DocumentTelechargeableMembre,document:aDocument.toJSON()},cloudCible:lCloud});},titre:aDocument.Libelle,modeGestion:UtilitaireGestionCloudEtPDF.modeGestion.PDFEtCloud,avecDepot:true};UtilitaireGestionCloudEtPDF.creerFenetreGestion(lParams);};lListe.AddElement(lElement);});}
if(this.JSONReponse.listeProjetsAcc&&this.JSONReponse.listeProjetsAcc.GetNbrElements()>0){this.JSONReponse.listeProjetsAcc.parcourir(function(aDocument){const lElement=new ObjetElement(aDocument.GetLibelle(),aDocument.Numero);lElement.annee=GParametres.PremiereDate.getFullYear();lElement.typeDocument=EGenreDocTelechargement.projetAcc;lElement.dateDebut=aDocument.dateDebut;lElement.dateFin=aDocument.dateFin;lElement.event=function(){let lParams={callbaskEvenement:function(aLigne){const lService=GEtatUtilisateur.listeCloudDepotServeur.GetElement(aLigne);const lCloud=!!lService?lService.GetGenre():null;GenerationPDF.genererPDF({paramPDF:{avecDepot:true,genreGenerationPDF:TypeHttpGenerationPDFSco.ProjetAccompagnementPerso,projet:aDocument},cloudCible:lCloud,optionsPDF:OptionsPdf.defaut});},titre:aDocument.GetLibelle(),modeGestion:UtilitaireGestionCloudEtPDF.modeGestion.PDFEtCloud,avecDepot:true};UtilitaireGestionCloudEtPDF.creerFenetreGestion(lParams);};lListe.AddElement(lElement);});}
if(this.JSONReponse.listeBulletinsBIA&&this.JSONReponse.listeBulletinsBIA.GetNbrElements()>0){this.JSONReponse.listeBulletinsBIA.parcourir(function(aBulletin){lElement=new ObjetElement();lElement.typeDocument=EGenreDocTelechargement.bulletin;lElement.bulletin=aBulletin;lElement.annee=aBulletin.annee;lElement.event=function(){let lParams={callbaskEvenement:function(aLigne){const lService=GEtatUtilisateur.listeCloudDepotServeur.GetElement(aLigne);const lCloud=!!lService?lService.GetGenre():null;GenerationPDF.genererPDF({paramPDF:{avecDepot:true,genreGenerationPDF:TypeHttpGenerationPDFSco.BulletinBIA,nomFichier:aBulletin.nomFichier,ident:aBulletin.ident},cloudCible:lCloud});},titre:aBulletin.nomFichier,modeGestion:UtilitaireGestionCloudEtPDF.modeGestion.PDFEtCloud,avecDepot:true};UtilitaireGestionCloudEtPDF.creerFenetreGestion(lParams);};lListe.AddElement(lElement);});}
if(this.JSONReponse.listeAttestations&&this.JSONReponse.listeAttestations.GetNbrElements()>0){this.JSONReponse.listeAttestations.parcourir(function(aAttestation){lElement=new ObjetElement();lElement.typeDocument=EGenreDocTelechargement.attestation;lElement.abbreviation=aAttestation.abbreviation;if(aAttestation.date){lElement.date=aAttestation.date;lElement.annee=aAttestation.date.getFullYear();lElement.event=function(){let lParams={callbaskEvenement:function(aLigne){const lService=GEtatUtilisateur.listeCloudDepotServeur.GetElement(aLigne);const lCloud=!!lService?lService.GetGenre():null;GenerationPDF.genererPDF({paramPDF:{avecDepot:true,genreGenerationPDF:TypeHttpGenerationPDFSco.Attestation,attestation:aAttestation},cloudCible:lCloud});},titre:aAttestation.abbreviation,modeGestion:UtilitaireGestionCloudEtPDF.modeGestion.PDFEtCloud,avecDepot:true};UtilitaireGestionCloudEtPDF.creerFenetreGestion(lParams);};lListe.AddElement(lElement);}});}
lListe.setTri([
ObjetTri.init('annee',EGenreTriElement.Decroissant),ObjetTri.init('debutPeriodeNotation'),ObjetTri.init('libelleClasse'),ObjetTri.init('Libelle')
]).trier();this.callbackReussite.appel({liste:lListe});}}
Requetes.inscrire('DocumentsATelecharger',ObjetRequeteDocumentsATelecharger);module.exports=ObjetRequeteDocumentsATelecharger;},fn:"objetrequetedocumentsatelecharger.js"});;
IE.fModule({f:function(exports,require,module,global){const MethodesTableau=require('MethodesTableau.js');const InterfacePage_Mobile=require('InterfacePage_Mobile.js');const GTraductions=require('ObjetTraduction.js');const EGenreOnglet=require('Enumere_Onglet.js');const ObjetRequeteDocumentsATelecharger=require('ObjetRequeteDocumentsATelecharger.js');const EGenreDocTelechargement=require('Enumere_DocTelechargement.js');const{GDate}=require('ObjetDate.js');const ObjetSelection=require('ObjetSelection.js').ObjetSelection;const EGenreEspace=require('Enumere_Espace.js');const{ObjetRequeteConsultation}=require('ObjetRequeteJSON.js');const Requetes=require('CollectionRequetes.js');const ObjetTri=require('ObjetTri.js');const ObjetDonneesListe=require('ObjetDonneesListe.js');const EGenreEvenementListe=require('Enumere_EvenementListe.js');const ObjetListeElements=require('ObjetListeElements.js');Requetes.inscrire('ListeElevesBIA',ObjetRequeteConsultation);class InterfaceDocumentsATelecharger_Mobile extends InterfacePage_Mobile{constructor(...aParams){super(...aParams);this.avecSelecteurEleve=GEtatUtilisateur.GenreEspace===EGenreEspace.Mobile_Professeur;}
ConstruireInstances(){if(this.avecSelecteurEleve){this.identSelection=this.Add(ObjetSelection,_evenementSelection);this.AddSurZone=[this.identSelection];}
this.identListe=this.Add(require('ObjetListe.js'),function(aParametres){if(aParametres.genreEvenement===EGenreEvenementListe.SelectionClick&&aParametres.article.event){aParametres.article.event();}},function(aInstance){aInstance.setOptionsListe({colonnes:[{taille:'100%'}
]});});}
ConstruireAffichage(){if(this.listeDocs){return'<div id="'+this.GetInstance(this.identListe).Nom+'"></div>';}
return'';}
RecupererDonnees(){this.listeDocs=null;if(this.GetInstance(this.identSelection)){return Requetes('ListeElevesBIA',this).lancerRequete().then(function(aJSON){const lListe=aJSON.liste||new ObjetListeElements();lListe.parcourir(function(aEleve){aEleve.Libelle=aEleve.nom+' '+aEleve.prenom;}).setTri([
ObjetTri.init('nom'),ObjetTri.init('prenom')
]).trier();this.GetInstance(this.identSelection).SetVisible(lListe.GetNbrElements()>0);if(lListe.GetNbrElements()===0){this.GetInstance(this.identListe).Afficher(this.composeAucuneDonnee(GTraductions.getValeur('DocumentsATelecharger.Aucun')));} else{this.GetInstance(this.identSelection).SetDonnees(lListe,0,'','');}}.bind(this));} else{return _requeteDocuments.call(this);}}}
function _evenementSelection(aParam){_requeteDocuments.call(this,aParam.element.listeElevesBIA);}
function _requeteDocuments(aListeElevesBIA){this.listeDocs=null;return new ObjetRequeteDocumentsATelecharger(this).lancerRequete({avecNotes:MethodesTableau.existe(GEtatUtilisateur.getGenreOnglet(),[EGenreOnglet.BulletinAnneesPrec_Note,EGenreOnglet.DocumentsATelecharger]),avecCompetences:MethodesTableau.existe(GEtatUtilisateur.getGenreOnglet(),[EGenreOnglet.BulletinAnneesPrec_Competence,EGenreOnglet.DocumentsATelecharger]),listeElevesBIA:aListeElevesBIA}).then(function(aDonnees){this.listeDocs=aDonnees.liste;}.bind(this)).catch(function(){}).then(function(){this.Afficher();if(this.listeDocs&&this.listeDocs.GetNbrElements()===0){this.GetInstance(this.identListe).Afficher(this.composeAucuneDonnee(GTraductions.getValeur('DocumentsATelecharger.Aucun')));} else{this.GetInstance(this.identListe).SetDonnees(new DonneesListe_DocumentsATelechargerMobile(this.listeDocs));}}.bind(this));}
class DonneesListe_DocumentsATelechargerMobile extends ObjetDonneesListe{constructor(aDonnees){super(aDonnees);this.setOptions({avecEvnt_SelectionClick:true});}
GetValeur(I,D,aParams){const H=['<div class="iconic icon_pdf file-conteneur">'
];let lTitre1='';let lTitre2='';switch(aParams.article.typeDocument){case EGenreDocTelechargement.documents:lTitre1=aParams.article.Libelle;lTitre2=aParams.article.annee+' - '+(aParams.article.annee+1);break;case EGenreDocTelechargement.bulletin:lTitre1=aParams.article.bulletin.libelle+' - '+aParams.article.bulletin.libellePeriodeNotation+' - '+aParams.article.bulletin.libelleClasse;lTitre2=aParams.article.annee+' - '+(aParams.article.annee+1);break;case EGenreDocTelechargement.attestation:lTitre1=aParams.article.abbreviation+' - '+GDate.FormatDate(aParams.article.date,"%JJ/%MM/%AAAA");lTitre2=aParams.article.annee+' - '+(aParams.article.annee+1);break;case EGenreDocTelechargement.projetAcc:{let lArticle=aParams.article;lTitre1=aParams.article.GetLibelle();if(!!lArticle.dateDebut||!!lArticle.dateFin){let lLibelleDate;if(!!lArticle.dateDebut&&!!lArticle.dateFin){lLibelleDate=GTraductions.getValeur('Du')+' '+GDate.FormatDate(lArticle.dateDebut,"%JJ/%MM/%AAAA")+' '+GTraductions.getValeur('Au')+' '+GDate.FormatDate(lArticle.dateFin,"%JJ/%MM/%AAAA");} else{lLibelleDate=(!!lArticle.dateDebut)?GTraductions.getValeur('aPartirDu')+' '+GDate.FormatDate(lArticle.dateDebut,"%JJ/%MM/%AAAA"):GTraductions.getValeur('jusquAu')+' '+GDate.FormatDate(lArticle.dateFin,"%JJ/%MM/%AAAA");}
lTitre1+=' '+lLibelleDate;}
lTitre2=GTraductions.getValeur('PageCompte.AmenagementsProjet');break;}
default:;}
H.push('<div class="titre">',lTitre1||'','</div>','<div class="infos">',lTitre2||'','</div>','</div>');return H.join('');}
GetCouleurCellule(){return ObjetDonneesListe.ECouleurCellule.Blanc;}}
module.exports=InterfaceDocumentsATelecharger_Mobile;},fn:"interfacedocumentsatelecharger_mobile.js"});;
IE.fModule({f:function(exports,require,module,global){const GHtml=require('GHtml.js');const ObjetFenetre=require('ObjetFenetre.js');const GTraductions=require('ObjetTraduction.js');const ObjetMoteurBlog=require('ObjetMoteurBlog.js').ObjetMoteurBlog;const EGenreEtat=require('Enumere_Etat.js');const{TypeDroits}=require('ObjetDroitsPN.js');const TypeEtatCommentaireBillet=require('TypeEtatCommentaireBillet.js').TypeEtatCommentaireBillet;class ObjetFenetre_EditionCommentairesBlog extends ObjetFenetre{constructor(...aParams){super(...aParams);this.moteur=new ObjetMoteurBlog();this.commentaire=this.moteur.creerCommentaireParDefaut();this.commentaire.SetEtat(EGenreEtat.Creation);this.tailleMaxCommentaires=1000;this.idFooterCommentaire=this.Nom+'_footer-commentaireBlog';}
getControleur(aInstance){return $.extend(true,super.getControleur(this),{nodePhoto:function(){$(this.node).on('error',function(){$(this).parent().find('.ibe_util_photo_i').show();$(this).remove();});},saisieCommentaireBlog:{getValue:function(aNumeroCommentaire){const lCommentaire=aInstance.donnee.listeCommentaires.GetElementParNumero(aNumeroCommentaire);return(lCommentaire!==null&&lCommentaire!==undefined)?lCommentaire.texte:'';},setValue:function(aNumeroCommentaire,aValue){const lCommentaire=aInstance.donnee.listeCommentaires.GetElementParNumero(aNumeroCommentaire);if(lCommentaire!==null&&lCommentaire!==undefined){lCommentaire.texte=aValue;aInstance.donnee.SetEtat(EGenreEtat.Modification);}},getDisabled:function(){return GApplication.droits.get(TypeDroits.estEnConsultation);},node:function(){$(this.node).attr('placeholder',GTraductions.getValeur('blog.placeholderCommentaire'));}},btnEnvoyerCommentaire:{event:function(){this.callback.appel({billet:this.donnee,estCreation:true});if(this.fenetre!==null&&this.fenetre!==undefined){this._saisieCommentaireEnCours=true;this.fenetre.Fermer();}}.bind(aInstance),getDisabled:function(aNumeroCommentaire){const lCommentaire=aInstance.donnee.listeCommentaires.GetElementParNumero(aNumeroCommentaire);return GApplication.droits.get(TypeDroits.estEnConsultation)||((lCommentaire!==null)&&(lCommentaire!==undefined)&&(lCommentaire.Etat===EGenreEtat.Creation)&&(lCommentaire.texte===''));}},btnSupprCommentaire:{event:function(aNumeroCommentaire){this.moteur.surActionSupprimerCommentaire({numeroCommentaire:aNumeroCommentaire,billet:this.donnee,evntClbck:function(aParam){this.callback.appel(aParam);}.bind(this)});}.bind(aInstance),getDisabled:function(){return GApplication.droits.get(TypeDroits.estEnConsultation);}},btnAcceptCommentaire:{event:function(aNumeroCommentaire){this.moteur.surActionAccepterCommentaire({numeroCommentaire:aNumeroCommentaire,billet:this.donnee,evntClbck:function(aParam){this.callback.appel(aParam);}.bind(this)});}.bind(aInstance),getDisabled:function(aNumeroCommentaire){const lNumCommentaire=aNumeroCommentaire;const lBillet=this.donnee;const lCommentaire=lBillet.listeCommentaires.GetElementParNumero(lNumCommentaire);return(lCommentaire.etatCommentaire===TypeEtatCommentaireBillet.ECB_Publie)||GApplication.droits.get(TypeDroits.estEnConsultation);}.bind(aInstance)},btnRejetCommentaire:{event:function(aNumeroCommentaire){this.moteur.surActionRefuserCommentaire({numeroCommentaire:aNumeroCommentaire,billet:this.donnee,evntClbck:function(aParam){this.callback.appel(aParam);}.bind(this)});}.bind(aInstance),getDisabled:function(aNumeroCommentaire){const lNumCommentaire=aNumeroCommentaire;const lBillet=this.donnee;const lCommentaire=lBillet.listeCommentaires.GetElementParNumero(lNumCommentaire);return(lCommentaire.etatCommentaire===TypeEtatCommentaireBillet.ECB_Refuse)||GApplication.droits.get(TypeDroits.estEnConsultation);}.bind(aInstance)}});}
SetDonnees(aParams){this.donnee=aParams.donnee;this.contenuHtml=aParams.contenuHtml;this.Afficher(this.contenuHtml);if(aParams.footer){this.commentaire=aParams.footer.commentaire||this.commentaire;this.tailleMaxCommentaires=aParams.footer.tailleMaxCommentaires||this.tailleMaxCommentaires;GHtml.setHtml(this.idFooterCommentaire,this.moteur.composeEditionCommentaire({commentaire:this.commentaire,tailleMaxCommentaires:this.tailleMaxCommentaires}),{controleur:this.controleur});}
if(aParams&&aParams.avecFocusSurEdition===true){$('.editComment-conteneur textarea').focus();}}
ComposeBas(){return'<div id="'+this.idFooterCommentaire+'" style="width:100%;"></div>';}}
module.exports=ObjetFenetre_EditionCommentairesBlog;},fn:"objetfenetre_editioncommentairesblog.js"});;
IE.fModule({f:function(exports,require,module,global){const ObjetFenetre=require('ObjetFenetre.js');const ObjetListe=require('ObjetListe.js');const ObjetDonneesListeFlatDesign=require('ObjetDonneesListeFlatDesign.js');const ObjetListeElements=require('ObjetListeElements.js');class ObjetFenetre_ListeRedacteursBillet extends ObjetFenetre{constructor(...aParams){super(...aParams);}
ConstruireInstances(){this.identListe=this.Add(ObjetListe,null,_initialiserListe);}
SetDonnees(aBillet,aListeUserSpe){const lListeRedacteurs=new ObjetListeElements();let lEstSpe=false;if((aListeUserSpe!==null)&&(aListeUserSpe!==undefined)){aListeUserSpe.parcourir(function(aUsr){if(aBillet.auteur.GetNumero()===aUsr.GetNumero()){lEstSpe=true;}}.bind(this));}
aBillet.auteur.estSpe=lEstSpe;lListeRedacteurs.add(aBillet.auteur);aBillet.listeCoAuteurs.parcourir(function(D){if(D.Existe()){lEstSpe=false;if((aListeUserSpe!==null)&&(aListeUserSpe!==undefined)){aListeUserSpe.parcourir(function(aUsr){if(D.GetNumero()===aUsr.GetNumero()){lEstSpe=true;}});}
D.estSpe=lEstSpe;lListeRedacteurs.add(D);}}.bind(this));const lDonneesListe=new DonneesListe_RedacteursBillet(lListeRedacteurs);this.Afficher();this.GetInstance(this.identListe).SetDonnees(lDonneesListe);}
ComposeContenu(){const T=[];T.push('<div id="'+this.GetNomInstance(this.identListe)+'" class="redacteurs-list">&nbsp;</div>');return T.join('');}}
function _initialiserListe(aInstance){aInstance.setOptionsListe({colonnes:[{taille:'100%'}],skin:ObjetListe.skin.flatDesign});}
class DonneesListe_RedacteursBillet extends ObjetDonneesListeFlatDesign{constructor(aDonnees){super(aDonnees);this.setOptions({avecBoutonActionLigne:false,avecEvnt_Creation:false,flatDesignMinimal:true});}
getZoneGauche(aParams){return aParams.article.estSpe?'<div class="favori">&nbsp;</div>':'';}
getTitreZonePrincipale(aParams){return aParams.article.GetLibelle();}}
module.exports=ObjetFenetre_ListeRedacteursBillet;},fn:"objetfenetre_listeredacteursbillet.js"});;
IE.fModule({f:function(exports,require,module,global){require('espace/css/ObjetVignette.css');const Identite=require('ObjetIdentite.js');const GUID=require('GUID.js');const GHtml=require('GHtml.js');const EGenreEtat=require('Enumere_Etat.js');const EGenreBoiteMessage=require('Enumere_BoiteMessage.js');const EGenreAction=require('Enumere_Action.js');const GTraductions=require('ObjetTraduction.js');const GChaine=require('GChaine.js');const EGenreDocumentJoint=require('Enumere_DocumentJoint.js');const EFormatDocJoint=require('Enumere_FormatDocJoint.js');const ETypeEtatVignette={survol:'survol',selectionne:'selectionne',nonSelectionne:'nonSelectionne'};const ETypeEvntVignette={suppression:'suppression',editionLegende:'editionLegende'};class ObjetVignette extends Identite{constructor(...aParams){super(...aParams);this.ids={vignette:GUID.getId()};this.default={largeur:150,hauteur:150,hauteurEntete:30,avecImage:false,avecImgViewer:true,estDiapo:false,avecEtiquette:false,avecSelection:true,avecSurvol:true,avecSuppression:false,avecEditionLegende:false};this.estSurvole=false;this.estSelectionne=false;this.donneesRecues=false;}
getControleur(aInstance){return $.extend(true,super.getControleur(this),{getNodeVignette:function(){if(aInstance.param.avecSurvol===true){const lMap={'mouseover':function(){this.estSurvole=true;_actualiserSelonEtat.call(this);}.bind(aInstance),'mouseout':function(){this.estSurvole=false;_actualiserSelonEtat.call(this);}.bind(aInstance)};$(this.node).on(lMap);}},cbSelection:{getValue:function(){return aInstance.donnees.data.estSelectionne;},setValue:function(aValue){if(aInstance.param.avecSelection){const lData=aInstance.donnees.data;lData.estSelectionne=aValue;aInstance.estSelectionne=aValue;_actualiserSelonEtat.call(aInstance);aInstance.callback.appel({data:lData,estSelectionne:aValue});}}},estCbSelectionVisible:function(){return(aInstance.param.avecSelection);},btnSuppr:{event(aEvent){const lMsg=GTraductions.getValeur('MsgConfirmSupprDe',[aInstance.donnees.data.libelle||(aInstance.donnees.data.documentCasier?aInstance.donnees.data.documentCasier.GetLibelle():'')]);GApplication.getMessage().afficher({type:EGenreBoiteMessage.Confirmation,message:lMsg,callback:function(aAccepte){aInstance.evntSuppr(aAccepte);}});aEvent.stopPropagation();}},legendeVignette:{getValue:function(){return!!aInstance.donnees?aInstance.donnees.data.libelle:'';},setValue:function(aValue){aInstance.donnees.data.libelle=aValue;aInstance.donnees.data.libelleEnModification=true;}},getNodePhoto:function(){const lMap={'click':function(){_ouvrirLien.call(this);}.bind(aInstance),'error':function(){$(this).parent().append('<div style="text-align:center; width:100%;" ie-node="getNodeDoc"><i class="icon_warning_sign" style="font-size:30px;"></i></div>');$(this).parent().on({'click':function(){_ouvrirLien.call(this);}.bind(aInstance)});$(this).remove();}};$(this.node).on(lMap);},getNodeDoc:function(){const lMap={'click':function(){_ouvrirLien.call(this);}.bind(aInstance)};$(this.node).on(lMap);}});}
setParam(aParam){this.param=$.extend(this.default,aParam);}
setDonnees(aParam){this.donneesRecues=true;this.donnees=aParam;this.data=aParam.data;if(this.data.estSelectionne!==null&&this.data.estSelectionne!==undefined){this.estSelectionne=this.data.estSelectionne;}}
afficher(){const H=[];if(this.donneesRecues){const lHeight=this.param.avecImage&&this.param.hauteur>0?' height:'+this.param.hauteur+'px; ':'';const lWidth=this.param.avecImage&&this.param.largeur>0?' width:'+this.param.largeur+'px; ':'';const lHautLien=this.param.hauteurEntete;H.push('<div class="vignette ',(this.param.estDiapo?' modeDiapo ':''),' nonSelectionne" id="',this.ids.vignette,'" ',GHtml.composeAttr('ie-node','getNodeVignette'),' style="',lWidth,'" >');if(this.param.avecImage){H.push('<div class="zoneImage" style=" ',lHeight,'">');if(this.donnees.estImg===true){H.push('<img ie-load-src="',this.donnees.lien,'" ',this.param.avecImgViewer?' ie-imgviewer ':'ie-node="getNodePhoto"',' />');} else{let lIcon='';const lGenreFichier=EFormatDocJoint.getGenreDeFichier(GChaine.extraireExtensionFichier(this.donnees.data.documentCasier.GetLibelle()));if(lGenreFichier!==EFormatDocJoint.Inconnu){lIcon=EFormatDocJoint.getClassIconDeGenre(lGenreFichier);} else{if(this.donnees.data.documentCasier.GetGenre()===EGenreDocumentJoint.Cloud){lIcon='icon_cloud';} else if(this.donnees.data.documentCasier.GetGenre()===EGenreDocumentJoint.Url){lIcon='icon_globe';} else if(this.donnees.data.documentCasier.GetGenre()===EGenreDocumentJoint.LienKiosque){lIcon='icon_external_link';} else if(this.donnees.data.documentCasier.GetGenre()===EGenreDocumentJoint.LienVisio){lIcon='icon_cours_virtuel';} else{lIcon='icon_file_alt';}}
const lPoliceIcone=this.param.policeIcone;H.push('<div class="docs-wrapper" ie-node="getNodeDoc">','<i class="',lIcon,'" style="font-size:',lPoliceIcone,'px;"></i>',(this.param.avecSelection?'<div class="libelle m-top-l ellipsis-multilignes" title="'+this.donnees.data.libelle+'">'+this.donnees.data.libelle+'</div>':''),'</div>');}
if(this.param.avecEtiquette&&this.donnees.strEtiquette){H.push('<ie-chips class="etiquette tag-style color-theme">',this.donnees.strEtiquette,'</ie-chips>');}
if(this.param.avecSelection){H.push('<ie-checkbox class="actionHautDroite" ie-model="cbSelection" ie-display="estCbSelectionVisible"></ie-checkbox>');} else if(this.param.avecSuppression){H.push('<ie-btnicon ie-model="btnSuppr" class="icon_remove actionHautDroite"></ie-btnicon>');}
H.push('</div>');}
if(!this.param.avecSelection){H.push('<div style=" height:',lHautLien,'px;" class="zoneLibelle ',(this.param.avecImage?'':'sansImage '),(this.param.avecEditionLegende?'edit ':''),(!this.param.avecSelection?'centrer ':''),'">');if(this.param.avecEditionLegende){H.push('<div class="m-top-xl" style="width:100%">');H.push('<div class="ie-titre-petit">',GTraductions.getValeur('blog.billet.titre'),'</div>');H.push('<input type="text" class="round-style" ie-model="legendeVignette" style="width:100%" placeholder="',GTraductions.getValeur('blog.billet.rediger'),'"/>');H.push('</div>');} else{H.push('<div class="ellipsis-multilignes" title="',this.donnees.data.libelle,'">',this.donnees.data.libelle,'</div>');}
H.push('</div>');}
H.push('</div>');}
return H.join('');}
evntSuppr(aAccepte){if(aAccepte!==EGenreAction.Valider){return;}
const lData=this.donnees.data;lData.SetEtat(EGenreEtat.Suppression);this.callback.appel({evnt:ETypeEvntVignette.suppression,data:lData,vignette:this.donnees});}}
function _getEtatCourant(){return(this.param.avecSurvol&&this.estSurvole===true)?ETypeEtatVignette.survol:(this.param.avecSelection&&this.estSelectionne?ETypeEtatVignette.selectionne:ETypeEtatVignette.nonSelectionne);}
function getClassEtat(){const lEtat=_getEtatCourant.call(this);switch(lEtat){case ETypeEtatVignette.survol:return'survol';case ETypeEtatVignette.selectionne:return'selectionne';case ETypeEtatVignette.nonSelectionne:return'nonSelectionne';}}
function _actualiserSelonEtat(){const lClassEtat=getClassEtat.call(this);$('#'+this.ids.vignette.escapeJQ()).removeClass('nonSelectionne survol selectionne').addClass(lClassEtat);}
function _ouvrirLien(){window.open(this.donnees.lien);}
module.exports={ObjetVignette,ETypeEvntVignette};},fn:"objetvignette.js"});;
IE.fModule({f:function(exports,require,module,global){const GChaine=require('GChaine.js');const ObjetVignette=require('ObjetVignette.js').ObjetVignette;const EGenreEtat=require('Enumere_Etat.js');class ObjetDiapoCarrousel extends ObjetVignette{constructor(...aParams){super(...aParams);}
ConstruireAffichage(){return this.afficher();}
setParametres(aElement,aOptions){const lOptions={genreRessource:null,dimensionPhoto:300,avecEtiquette:false,avecSuppression:false,avecEditionLegende:false,afficherNomFichierSiLibelleVide:false};if(aOptions===null||aOptions===undefined){aOptions={};}
$.extend(lOptions,aOptions);const lParamVignette={avecSurvol:true,avecSelection:false,avecImage:true,avecImgViewer:true,estDiapo:true,avecEtiquette:lOptions.avecEtiquette,avecSuppression:lOptions.avecSuppression,avecEditionLegende:lOptions.avecEditionLegende,largeur:lOptions.dimensionPhoto,hauteur:lOptions.dimensionPhoto,hauteurEntete:50};this.setParam(lParamVignette);const lDocCasier=aElement.documentCasier;$.extend(aElement,{libelle:!!aElement.libelle?aElement.libelle:(aElement.GetLibelle()!==''?aElement.GetLibelle():lOptions.afficherNomFichierSiLibelleVide===true?lDocCasier.GetLibelle():'')});const lData={data:aElement,lien:lDocCasier.Etat===EGenreEtat.Creation?lDocCasier.urlBlob:GChaine.creerUrlBruteLienExterne(lDocCasier,{genreRessource:lOptions.genreRessource,miniature:lDocCasier.miniature}),strEtiquette:lParamVignette.avecEtiquette&&aElement.strEtiquette?aElement.strEtiquette:'',estImg:true,estSiteWeb:false,estFichier:false,estCloud:false};this.setDonnees(lData);}}
module.exports=ObjetDiapoCarrousel;},fn:"objetdiapocarrousel.js"});;
IE.fModule({f:function(exports,require,module,global){const GestionnaireBlocDeBase=require('GestionnaireBloc.js').GestionnaireBlocDeBase;const ObjetDiapoCarrousel=require('ObjetDiapoCarrousel.js');class GestionnaireBlocDiapoCarrousel extends GestionnaireBlocDeBase{constructor(...aParams){super(...aParams);}
composeBloc(aDataBloc){const lInstance=this.getInstanceObjetMetier(aDataBloc,ObjetDiapoCarrousel);return{html:this.composeZoneInstance(lInstance),controleur:lInstance.controleur};}}
module.exports=GestionnaireBlocDiapoCarrousel;},fn:"gestionnaireblocdiapocarrousel.js"});;
IE.fModule({f:function(exports,require,module,global){require('Produit/Css/ObjetGalerieCarrousel.css');const Identite=require('ObjetIdentite.js');const GTraductions=require('ObjetTraduction.js');const GUID=require('GUID.js');const GHtml=require('GHtml.js');const GPosition=require('GPosition.js');const GestionnaireBlocDiapoCarrousel=require('GestionnaireBlocDiapoCarrousel.js');const ObjetIdentite=require('ObjetIdentite.js');const EGenreEtat=require('Enumere_Etat.js');const ETypeEvntVignette=require('ObjetVignette.js').ETypeEvntVignette;const ObjetListeElements=require('ObjetListeElements.js');class ObjetGalerieCarrousel extends Identite{constructor(...aParams){super(...aParams);this.ids={conteneurDiapos:GUID.getId(),zoneNavigation:GUID.getId(),indicateursNavigation:GUID.getId()};this.gestionnaireBlocsDiapos=ObjetIdentite.creerInstance(GestionnaireBlocDiapoCarrousel,{pere:this,evenement:this.surEvntGestionnaireDiapos});}
getControleur(aInstance){return $.extend(true,super.getControleur(this),{nodeZoneVisu:function(){$(this.node).on({swipeleft:function(){_naviguerDiapoSuivante.call(aInstance);if(!aInstance.options.bouclerSurNavigation){aInstance.$refresh();}},swiperight:function(){_naviguerDiapoPrecedente.call(aInstance);if(!aInstance.options.bouclerSurNavigation){aInstance.$refresh();}}});},avecAffBtnAutour:function(){return aInstance.options.avecFlechesAutourDesDiapos&&_avecAffichageZoneNavigation.call(aInstance);},avecAffBtnZoneNav:function(){return!aInstance.options.avecFlechesAutourDesDiapos;},btnPrec:{event(){_naviguerDiapoPrecedente.call(aInstance);},getTitle(){return GTraductions.getValeur('Precedent');},getDisabled(){return aInstance.options.bouclerSurNavigation?false:!_existeDiapoPrecedente.call(aInstance);}},btnSuiv:{event(){_naviguerDiapoSuivante.call(aInstance);},getTitle(){return GTraductions.getValeur('Suivant');},getDisabled(){if(aInstance.options.bouclerSurNavigation){return false;}
let lSuivanteDerniereVisible=_getNumDerniereDiapoVisible.call(aInstance)+1;return!_estDiapoExistante.call(aInstance,lSuivanteDerniereVisible);}},avecAffIndicateursNav:function(){return aInstance.options.avecIndicateursNavigation;}});}
ConstruireAffichage(){const H=[];H.push('<div class="ObjetGalerieCarrousel">');H.push('<div class="zoneContenu">');H.push('<ie-btnicon ie-model="btnPrec" ie-display="avecAffBtnAutour" class="icon_angle_left btnAutour"></ie-btnicon>');H.push('<div class="zoneVisu" ie-node="nodeZoneVisu">');H.push('<div id="',this.ids.conteneurDiapos,'" class="conteneurDiapos ie-imgviewer-container">');H.push('</div>');H.push('</div>');H.push('<ie-btnicon ie-model="btnSuiv" ie-display="avecAffBtnAutour" class="icon_angle_right btnAutour"></ie-btnicon>');H.push('</div>');H.push('<div id="',this.ids.zoneNavigation,'" class="zoneNavigation">');H.push('</div>');H.push('</div>');return H.join('');}
setOptions(aOptions){this.options=$.extend({dimensionPhoto:50,nbMaxDiaposEnZoneVisible:4,bouclerSurNavigation:true,avecCmpSurDiapo:false,avecFlechesAutourDesDiapos:true,avecIndicateursNavigation:false,avecSuppression:false,avecEditionLegende:false},aOptions);}
initialiserCarrousel(){this.numDiapoCourante=1;this.numDerniereDiapo=0;this.dimensionPhotoAdaptee=null;this.nbTotalDiapos=0;}
setDonnees(aParam){this.initialiserCarrousel();this.listeDiapos=aParam.listeDiapos;this.ressourceDocJoint=aParam.ressourceDocJoint;this.nbDiaposVisibles=_determinerNbDiaposAAfficher.call(this);this.gestionnaireBlocsDiapos.setOptions({genreRessource:this.ressourceDocJoint,dimensionPhoto:this.dimensionPhotoAdaptee!==null?this.dimensionPhotoAdaptee:this.options.dimensionPhoto,avecEtiquette:this.options.avecCmpSurDiapo,avecSuppression:this.options.avecSuppression,avecEditionLegende:this.options.avecEditionLegende,afficherNomFichierSiLibelleVide:this.options.afficherNomFichierSiLibelleVide});GHtml.setHtml(this.ids.conteneurDiapos,this.composerDiapos(),{instance:this});this.gestionnaireBlocsDiapos.refresh();if(_avecUnEltDeLaZoneNavigation.call(this)){GHtml.setHtml(this.ids.zoneNavigation,this.composerZoneNavigation(),{instance:this});_actualiserZoneNavigation.call(this);} else{_cacherEltParId.call(this,this.ids.zoneNavigation);this.$refresh();}}
composerDiapos(){const H=[];if((this.listeDiapos!==null)&&(this.listeDiapos!==undefined)&&this.listeDiapos.GetNbrElements()>0){let lCmp=0;let lNumDiapoCourante=0;let lListeDiapos=this.listeDiapos.getListeElements(function(D){return D.Existe();});this.nbTotalDiapos=lListeDiapos.GetNbrElements();const lAvecEtiquette=this.options.avecCmpSurDiapo&&_avecAffichageZoneNavigation.call(this);let lCss;lListeDiapos.parcourir(function(D){lCmp++;lNumDiapoCourante=lCmp;this.numDerniereDiapo=lCmp;lCss=lNumDiapoCourante<=this.nbDiaposVisibles?'on':'off';D.numDiapo=lNumDiapoCourante;if(lAvecEtiquette){D.strEtiquette=_strClassementDiapoNumero.call(this,lNumDiapoCourante);}
H.push(_composerHtmlDiapo.call(this,{numDiapo:lNumDiapoCourante,orderDiapo:lCmp,dataDiapo:D,cssDiapo:lCss}));}.bind(this));}
return H.join('');}
composerZoneNavigation(){const H=[];H.push('<ie-btnicon ie-model="btnPrec" ie-display="avecAffBtnZoneNav" class="icon_angle_left"></ie-btnicon>');H.push('<div ie-display="avecAffIndicateursNav" id="',this.ids.indicateursNavigation,'" class="indicateurNav"></div>');H.push('<ie-btnicon ie-model="btnSuiv" ie-display="avecAffBtnZoneNav" class="icon_angle_right"></ie-btnicon>');return H.join('');}
surEvntGestionnaireDiapos(aParam){if(aParam){switch(aParam.evnt){case ETypeEvntVignette.suppression:_surSuppressionDiapo.call(this,aParam.data);break;}}}
libererUrlsBlob(){this.listeDiapos.parcourir(function(aDiapo){if(_docDeLaDiapoEstUnBlob.call(this,aDiapo)&&aDiapo.documentCasier.urlBlob){URL.revokeObjectURL(aDiapo.documentCasier.urlBlob);aDiapo.documentCasier.urlBlob=null;}}.bind(this));}
ajouterDiapo(aData){if(aData.Existe()){if((this.listeDiapos===null)||(this.listeDiapos===undefined)){this.listeDiapos=new ObjetListeElements();}
if(_docDeLaDiapoEstUnBlob.call(this,aData)){aData.documentCasier.urlBlob=URL.createObjectURL(aData.documentCasier.fichier.file);}
this.listeDiapos.AddElement(aData);const lEstCas1ereDiapo=(this.numDerniereDiapo===0);if(!lEstCas1ereDiapo){_decalerOrdreDesDiaposSuivantLaDiapoNumero.call(this,this.numDerniereDiapo,1);}
let lNumDerniereDiapoApresAjout=this.numDerniereDiapo+1;aData.numDiapo=lNumDerniereDiapoApresAjout;let lOrderDiapoAAjouter=lEstCas1ereDiapo?1:_getOrderDiapoNumero.call(this,this.numDerniereDiapo)+1;let lHtmlDiapo=_composerHtmlDiapo.call(this,{numDiapo:lNumDerniereDiapoApresAjout,orderDiapo:lOrderDiapoAAjouter,dataDiapo:aData,cssDiapo:'off'});$('#'+this.ids.conteneurDiapos.escapeJQ()).append(lHtmlDiapo);this.gestionnaireBlocsDiapos.refreshInstance(aData.indiceInstanceMetier);this.nbTotalDiapos=this.nbTotalDiapos+1;this.numDerniereDiapo=lNumDerniereDiapoApresAjout;if(lEstCas1ereDiapo){_montrerLesDiaposVisibles.call(this);} else{_deplacerDiaposDansCarrousel.call(this,-(lOrderDiapoAAjouter-1));}
_actualiserZoneNavigation.call(this);}}}
function _docDeLaDiapoEstUnBlob(aDiapo){let lDoc=aDiapo.documentCasier;return lDoc&&lDoc.Etat===EGenreEtat.Creation&&lDoc.fichier&&lDoc.fichier.file;}
function _composerHtmlDiapo(aParam){let lStyle=this.options.bouclerSurNavigation?' order:'+aParam.orderDiapo+'; ':'';const H=[];H.push('<div id="',_getIdDiapoNumero.call(this,aParam.numDiapo),'" class="diapo ',aParam.cssDiapo,'" style="',lStyle,' width:',this.dimensionPhotoAdaptee!==null?this.dimensionPhotoAdaptee:this.options.dimensionPhoto,'px;">');let lBloc=this.gestionnaireBlocsDiapos.composeBloc(aParam.dataDiapo);H.push(lBloc.html);H.push('</div>');return H.join('');}
function _decalerOrdreDesDiaposSuivantLaDiapoNumero(aNumDiapo,aDecalage){let lOrdreCourantDiapoDeRef=_getOrderDiapoNumero.call(this,aNumDiapo);let lNbDiaposADecaler=this.numDerniereDiapo-lOrdreCourantDiapoDeRef;for(let i=1,lNbr=lNbDiaposADecaler;i<=lNbr;i++){let lNumADecaler=aNumDiapo+i;if(_estDiapoExistante.call(this,lNumADecaler)||this.options.bouclerSurNavigation){let lNumADecalerSelonModulo=_getNumDiapoSelonModulo.call(this,lNumADecaler);let lEltDiapoADecaler=_getIdDiapoNumero.call(this,lNumADecalerSelonModulo);let lOrdreCourant=_getOrderDiapoNumero.call(this,lNumADecalerSelonModulo);let lOrdreAVenir=(lOrdreCourant+aDecalage);$('#'+lEltDiapoADecaler.escapeJQ()).css('order',lOrdreAVenir);}}}
function _getOrderDiapoNumero(aNumDiapo){let lEltDiapo=_getIdDiapoNumero.call(this,aNumDiapo);return parseInt($('#'+lEltDiapo.escapeJQ()).css('order'));}
function _composerIndicateursNavigation(){return _strClassementDiapoNumero.call(this,this.numDiapoCourante);}
function _actualiserIndicateursNavigation(){if(this.options.avecIndicateursNavigation){GHtml.setHtml(this.ids.indicateursNavigation,_composerIndicateursNavigation.call(this),{instance:this});}}
function _avecUnEltDeLaZoneNavigation(){const lAvecFlechesDansZoneNav=!this.options.avecFlechesAutourDesDiapos;const lAvecIndicateursNav=this.options.avecIndicateursNavigation;return lAvecFlechesDansZoneNav||lAvecIndicateursNav;}
function _actualiserZoneNavigation(){if(_avecUnEltDeLaZoneNavigation.call(this)){let lId=this.ids.zoneNavigation;if(_avecAffichageZoneNavigation.call(this)){_montrerEltParId.call(this,lId);_actualiserIndicateursNavigation.call(this);} else{_cacherEltParId.call(this,lId);}}}
function _determinerNbDiaposAffichables(){let lWidthDispo=GPosition.getWidth(this.ids.conteneurDiapos)-(2*20);if(this.options.avecSuppression&&this.options.avecFlechesAutourDesDiapos&&!_avecAffichageZoneNavigation.call(this)){lWidthDispo=lWidthDispo-2*(40);}
let lWidthDiapo=this.options.dimensionPhoto+20;let lResult=Math.floor(lWidthDispo/lWidthDiapo);if(lResult===0){this.dimensionPhotoAdaptee=lWidthDispo;lResult=1;} else if(lResult===1){this.dimensionPhotoAdaptee=lWidthDiapo;}
if(lResult===1){this.dimensionPhotoAdaptee=this.dimensionPhotoAdaptee+(2*20);$('#'+this.ids.conteneurDiapos.escapeJQ()).addClass('onlyOne');}
return lResult;}
function _determinerNbDiaposAAfficher(){let lNbDiaposPossibles=_determinerNbDiaposAffichables.call(this);let lNbDiaposMax=this.options.nbMaxDiaposEnZoneVisible;return Math.min(lNbDiaposMax,lNbDiaposPossibles);}
function _existeDiapoPrecedente(){return(this.numDiapoCourante>1);}
function _estDiapoExistante(aNum){return(aNum>=1)&&(aNum<=this.numDerniereDiapo);}
function _avecAffichageZoneNavigation(){let lResult=true;if(!_contientAuMoinsUneDiapo.call(this)||_contientDiapoUnique.call(this)||_toutesLesDiaposSontVisibles.call(this)){lResult=false;}
return lResult;}
function _getNumDerniereDiapoVisible(){return(this.numDiapoCourante+this.nbDiaposVisibles-1);}
function _getIdDiapoNumero(aNum){return this.Nom+'_'+aNum;}
function _cacherEltParId(aId){$('#'+aId.escapeJQ()).removeClass('on').addClass('off');}
function _montrerEltParId(aId){$('#'+aId.escapeJQ()).removeClass('off').addClass('on');}
function _cacherLesDiaposVisibles(){for(let i=this.numDiapoCourante,lNbr=this.numDiapoCourante+this.nbDiaposVisibles-1;i<=lNbr;i++){_cacherDiapoNumero.call(this,_getNumDiapoSelonModulo.call(this,i));}}
function _montrerLesDiaposVisibles(){for(let i=this.numDiapoCourante,lNbr=this.numDiapoCourante+this.nbDiaposVisibles-1;i<=lNbr;i++){_montrerDiapoNumero.call(this,_getNumDiapoSelonModulo.call(this,i));}}
function _cacherDiapoNumero(aNumDiapo){let lId=_getIdDiapoNumero.call(this,aNumDiapo);_cacherEltParId.call(this,lId);}
function _montrerDiapoNumero(aNumDiapo){let lId=_getIdDiapoNumero.call(this,aNumDiapo);_montrerEltParId.call(this,lId);}
function _contientAuMoinsUneDiapo(){return this.nbTotalDiapos>0;}
function _contientDiapoUnique(){return this.nbTotalDiapos===1;}
function _toutesLesDiaposSontVisibles(){return(this.nbTotalDiapos<=this.nbDiaposVisibles);}
function _strClassementDiapoNumero(aNumDiapo){return aNumDiapo+'/'+this.nbTotalDiapos;}
function _reordonnerDiapos(aDecalage){if(this.options.bouclerSurNavigation){for(let i=1,lNbr=this.numDerniereDiapo;i<=lNbr;i++){let lEltDiapo=_getIdDiapoNumero.call(this,i);let lOrdreCourant=_getOrderDiapoNumero.call(this,i);let lOrdreAVenir=(lOrdreCourant+aDecalage);if((aDecalage<0)&&(lOrdreAVenir<1)){lOrdreAVenir=lOrdreAVenir+this.numDerniereDiapo;}
if((aDecalage>0)&&(lOrdreAVenir>this.numDerniereDiapo)){lOrdreAVenir=lOrdreAVenir-this.numDerniereDiapo;}
$('#'+lEltDiapo.escapeJQ()).css('order',lOrdreAVenir);}}}
function _getNumDiapoSelonModulo(aNum){let lNumModulo=aNum%this.numDerniereDiapo;if(lNumModulo===0){lNumModulo=this.numDerniereDiapo;}
return lNumModulo;}
function _deplacerDiaposDansCarrousel(aDecalage){if(!this.options.bouclerSurNavigation){return;}
_cacherLesDiaposVisibles.call(this);_reordonnerDiapos.call(this,aDecalage);this.numDiapoCourante=_getNumDiapoSelonModulo.call(this,(this.numDiapoCourante-aDecalage));_montrerLesDiaposVisibles.call(this);_actualiserIndicateursNavigation.call(this);}
function _naviguerDiapoSuivante(){_deplacerDiaposDansCarrousel.call(this,-1);}
function _naviguerDiapoPrecedente(){_deplacerDiaposDansCarrousel.call(this,1);}
function _surSuppressionDiapo(aData){let lNumDiapo=aData.numDiapo;let lNumDiapoAMontrer=_getNumDerniereDiapoVisible.call(this)+1;if(_estDiapoExistante.call(this,lNumDiapoAMontrer)||this.options.bouclerSurNavigation){_montrerDiapoNumero.call(this,_getNumDiapoSelonModulo.call(this,lNumDiapoAMontrer));}
let lIdDiapoASupprimer=_getIdDiapoNumero.call(this,lNumDiapo);_decalerOrdreDesDiaposSuivantLaDiapoNumero.call(this,lNumDiapo,-1);let lEltDomASupprimer=document.getElementById(lIdDiapoASupprimer);if(lEltDomASupprimer.parentNode){lEltDomASupprimer.parentNode.removeChild(lEltDomASupprimer);}
for(let i=lNumDiapo+1,lNbr=this.numDerniereDiapo;i<=lNbr;i++){let lNouveauNum=i-1;let lNouvelId=_getIdDiapoNumero.call(this,lNouveauNum);let lEltAModifier=document.getElementById(_getIdDiapoNumero.call(this,i));lEltAModifier.id=lNouvelId;}
this.numDerniereDiapo=this.numDerniereDiapo-1;this.nbTotalDiapos=this.nbTotalDiapos-1;_actualiserInstancesDiaposSurSuppression.call(this,aData);_actualiserZoneNavigation.call(this);}
function _actualiserInstancesDiaposSurSuppression(aData){let lIndInstance=aData.indiceInstanceMetier;aData.numDiapo=null;for(let i=lIndInstance+1,lNbr=this.gestionnaireBlocsDiapos._instances.length;i<lNbr;i++){let lInstanceDiapo=this.gestionnaireBlocsDiapos._instances[i];let lDataDiapo=lInstanceDiapo.data;if(lDataDiapo.numDiapo!==null){lDataDiapo.numDiapo=lDataDiapo.numDiapo-1;}}}
module.exports=ObjetGalerieCarrousel;},fn:"objetgaleriecarrousel.js"});;
IE.fModule({f:function(exports,require,module,global){const ObjetIdentite=require('ObjetIdentite.js');const{ObjetMoteurBlog,EGenreEvntBillet}=require('ObjetMoteurBlog.js');const EGenreEspace=require('Enumere_Espace.js');const ObjetListeElements=require('ObjetListeElements.js');const GTraductions=require('ObjetTraduction.js');const EGenreEtat=require('Enumere_Etat.js');const TypeEtatCommentaireBillet=require('TypeEtatCommentaireBillet.js').TypeEtatCommentaireBillet;const{TypeDroits}=require('ObjetDroitsPN.js');const ObjetMenuContextuel=require('ObjetMenuContextuel.js');const ObjetFenetre=require('ObjetFenetre.js');const ObjetFenetre_EditionCommentairesBlog=require('ObjetFenetre_EditionCommentairesBlog.js');const ObjetFenetre_ListeRedacteursBillet=require('ObjetFenetre_ListeRedacteursBillet.js');const ObjetGalerieCarrousel=require('ObjetGalerieCarrousel.js');const Identite=require('ObjetIdentite.js');require('produit/css/ObjetBlocBillet.css');class ObjetBlocBillet extends ObjetIdentite{constructor(...aParams){super(...aParams);this.moteur=new ObjetMoteurBlog();this._saisieCommentaireEnCours=false;this.identGalerie=Identite.creerInstance(ObjetGalerieCarrousel,{pere:this});}
getControleur(aInstance){return $.extend(true,super.getControleur(this),{btnCommenter:{event:function(){_afficherVoletCommentaires.call(this,{avecFocusSurEdition:true,titre:GTraductions.getValeur('blog.ajouterCommentaire')});}.bind(aInstance),getDisabled:function(){return false;}},btnVoirCommentaires:{event:function(){const lTitre=this.moteur.strTitreCommentaires({billet:this.donnee});_afficherVoletCommentaires.call(this,{titre:lTitre});}.bind(aInstance),getDisabled:function(){return false;}},btnVoirRedacteurs:{event:function(){_afficherVoletRedacteurs.call(this);}.bind(aInstance),getDisabled:function(){return false;}},nodePhoto:function(){$(this.node).on('error',function(){$(this).parent().find('.ibe_util_photo_i').show();$(this).remove();});},btnEditerBillet:{event:function(){this.callback.appel(this.donnee,EGenreEvntBillet.SurEdition);}.bind(aInstance)},btnPublierBillet:{event:function(){this.callback.appel(this.donnee,EGenreEvntBillet.SurModifPublication);}.bind(aInstance)},btnSupprimerBillet:{event:function(){this.moteur.evntsurSuppressionBillet(this.donnee,function(){this.callback.appel(this.donnee,EGenreEvntBillet.SurSuppression);}.bind(this));}.bind(aInstance)},btnActionsBillet:{event:function(){const lBillet=this.donnee;ObjetMenuContextuel.afficher({pere:this,initCommandes:function(aMenu){if(this.moteur.estBilletEditable(lBillet)){aMenu.add(GTraductions.getValeur('blog.EditerBillet'),true,function(){this.callback.appel(lBillet,EGenreEvntBillet.SurEdition);}.bind(this));aMenu.add(GTraductions.getValeur('blog.Depublier'),true,function(){this.callback.appel(lBillet,EGenreEvntBillet.SurModifPublication);}.bind(this));}
if(this.moteur.estBilletCommentable(lBillet)){aMenu.add(GTraductions.getValeur('blog.VoirLesCommentaires'),true,function(){const lTitre=this.moteur.strTitreCommentaires({billet:lBillet});_afficherVoletCommentaires.call(this,{titre:lTitre});}.bind(this));aMenu.add(GTraductions.getValeur('blog.commenter'),true,function(){_afficherVoletCommentaires.call(this,{avecFocusSurEdition:true,titre:GTraductions.getValeur('blog.ajouterCommentaire')});}.bind(this));}}});}.bind(aInstance)},btnSupprCommentaire:{event:function(aNumeroCommentaire){this.moteur.surActionSupprimerCommentaire({numeroCommentaire:aNumeroCommentaire,billet:this.donnee,evntClbck:function(aParam){this.editerCommentaire(aParam);}.bind(this)});}.bind(aInstance),getDisabled:function(){return GApplication.droits.get(TypeDroits.estEnConsultation);}},btnAcceptCommentaire:{event:function(aNumeroCommentaire){this.moteur.surActionAccepterCommentaire({numeroCommentaire:aNumeroCommentaire,billet:this.donnee,evntClbck:function(aParam){this.editerCommentaire(aParam);}.bind(this)});}.bind(aInstance),getDisabled:function(aNumeroCommentaire){const lNumCommentaire=aNumeroCommentaire;const lBillet=this.donnee;const lCommentaire=lBillet.listeCommentaires.GetElementParNumero(lNumCommentaire);return(lCommentaire.etatCommentaire===TypeEtatCommentaireBillet.ECB_Publie)||GApplication.droits.get(TypeDroits.estEnConsultation);}.bind(aInstance)},btnRejetCommentaire:{event:function(aNumeroCommentaire){this.moteur.surActionRefuserCommentaire({numeroCommentaire:aNumeroCommentaire,billet:this.donnee,evntClbck:function(aParam){this.editerCommentaire(aParam);}.bind(this)});}.bind(aInstance),getDisabled:function(aNumeroCommentaire){const lNumCommentaire=aNumeroCommentaire;const lBillet=this.donnee;const lCommentaire=lBillet.listeCommentaires.GetElementParNumero(lNumCommentaire);return(lCommentaire.etatCommentaire===TypeEtatCommentaireBillet.ECB_Refuse)||GApplication.droits.get(TypeDroits.estEnConsultation);}.bind(aInstance)}});}
editerCommentaire(aParam){if(aParam&&aParam.billet){this.donnee=aParam.billet;}
this.donnee.SetEtat(EGenreEtat.Modification);this.donnee.commentairesUniquement=true;if(!aParam.estCreation){this.donnee.listeCommentaires.removeFilter(function(aElt){return aElt.Etat===EGenreEtat.Creation;});}
const lEstEcranOuvert=(this.fenetre!==null&&this.fenetre!==undefined);this.callback.appel(this.donnee,EGenreEvntBillet.SurEditionCommentaire,{ecranCommentaires:lEstEcranOuvert});if(this.fenetre!==null&&this.fenetre!==undefined){this.fenetre.Fermer();this.fenetre=null;}}
ConstruireAffichage(){const lListeUserSpecial=_getListeUsersSpeciaux.call(this);return this.afficher({listeUsrSpe:lListeUserSpecial});}
afficher(aParam){return this.moteur.composeCardBillet({billet:this.donnee,listeUsrSpe:aParam.listeUsrSpe,nbRedacteursMax:4,ignorerCreation:true,idGalerieCarrousel:this.identGalerie.GetNom()});}
RecupererDonnees(){this.moteur.initCarrousel({instance:this.identGalerie,donnee:this.donnee});}
setParametres(aElement,aOptions){this.donneesRecues=true;this.donnee=aElement;this.tailleMaxCommentaires=aOptions.tailleMaxCommentaires;}
actualiserSelonCtx(aCtx){if(aCtx.ouvrirCommentaires===true){_afficherVoletCommentaires.call(this,{});}}}
function _getListeUsersSpeciaux(){let lListeUserSpecial;switch(GEtatUtilisateur.GenreEspace){case EGenreEspace.Mobile_PrimEleve:case EGenreEspace.PrimEleve:case EGenreEspace.Mobile_PrimProfesseur:case EGenreEspace.PrimProfesseur:lListeUserSpecial=new ObjetListeElements().AddElement(GEtatUtilisateur.getUtilisateur());break;case EGenreEspace.Mobile_PrimParent:case EGenreEspace.PrimParent:lListeUserSpecial=GEtatUtilisateur.Identification.ListeRessources;break;}
return lListeUserSpecial;}
function _afficherVoletRedacteurs(){const lNbRedacteurs=this.moteur.nbRedacteursBillet(this.donnee);this.fenetre=ObjetFenetre.creerInstance(ObjetFenetre_ListeRedacteursBillet,{pere:this,evenement:null,initialiser:function(aInstance){aInstance.setOptionsFenetre({titre:GTraductions.getValeur('blog.tousLesRedacteursN',[lNbRedacteurs]),largeur:350,hauteur:500,avecScroll:true});}});const lListeUserSpecial=_getListeUsersSpeciaux.call(this);this.fenetre.SetDonnees(this.donnee,lListeUserSpecial);}
function _afficherVoletCommentaires(aParam){this.fenetre=ObjetFenetre.creerInstance(ObjetFenetre_EditionCommentairesBlog,{pere:this,evenement:function(aParam){if(aParam&&aParam!== -1){this.editerCommentaire(aParam);}}.bind(this),initialiser:function(aInstance){aInstance.setOptionsFenetre({titre:aParam.titre!==null&&aParam.titre!==undefined?aParam.titre:this.moteur.strTitreCommentaires({billet:this.donnee}),largeur:500,hauteurMaxContenu:600,avecScroll:true,listeBoutons:[],callbackFermer:function(){if(this._saisieCommentaireEnCours!==true){this.donnee.listeCommentaires.removeFilter(function(aElt){return aElt.Etat===EGenreEtat.Creation;});}
this._saisieCommentaireEnCours=false;this.fenetre=null;}.bind(this),bloquerFocus:aParam&&aParam.avecFocusSurEdition===true,avecComposeBasInFooter:true});}.bind(this)});const lHtmlContenu=this.moteur.existeCommentairesSurBillet(this.donnee)?this.moteur.composeCardsCommentairesBillet({billet:this.donnee,ignorerCreation:true}):this.moteur.composeMsgAucun({str:GTraductions.getValeur('blog.aucunCommentaire')});const lListeEltCreation=this.donnee.listeCommentaires.getListeElements(function(aElement){return aElement.Etat===EGenreEtat.Creation;});const lNbr=lListeEltCreation.GetNbrElements();let lCommentaire;if(lNbr>1){lCommentaire=lListeEltCreation.GetElement(0);} else{if(lNbr===1){lCommentaire=lListeEltCreation.GetElement(0);} else{lCommentaire=this.moteur.creerCommentaireParDefaut();lCommentaire.SetEtat(EGenreEtat.Creation);this.donnee.listeCommentaires.AddElement(lCommentaire);}}
this.fenetre.SetDonnees({donnee:this.donnee,contenuHtml:lHtmlContenu,footer:{commentaire:lCommentaire,tailleMaxCommentaires:this.tailleMaxCommentaires},avecFocusSurEdition:aParam.avecFocusSurEdition});}
module.exports=ObjetBlocBillet;},fn:"objetblocbillet.js"});;
IE.fModule({f:function(exports,require,module,global){const GestionnaireBlocDeBase=require('GestionnaireBloc.js').GestionnaireBlocDeBase;const ObjetBlocBillet=require('ObjetBlocBillet.js');class GestionnaireBlocBilletsBlog extends GestionnaireBlocDeBase{constructor(...aParams){super(...aParams);}
composeBloc(aDataBloc){const lInstance=this.getInstanceObjetMetier(aDataBloc,ObjetBlocBillet);return{html:this.composeZoneInstance(lInstance),controleur:lInstance.controleur};}}
module.exports=GestionnaireBlocBilletsBlog;},fn:"gestionnaireblocbilletsblog.js"});;
IE.fModule({f:function(exports,require,module,global){const{ObjetRequeteConsultation}=require('ObjetRequeteJSON.js');const Requetes=require('CollectionRequetes.js');const ObjetListeElements=require('ObjetListeElements.js');const ObjetElement=require('ObjetElement.js');const GTraductions=require('ObjetTraduction.js');const ObjetMoteurBlog=require('ObjetMoteurBlog.js').ObjetMoteurBlog;class ObjetRequetePageBlogFilActus extends ObjetRequeteConsultation{constructor(...aParams){super(...aParams);this.moteur=new ObjetMoteurBlog();}
lancerRequete(aParametres){this.JSON={};$.extend(this.JSON,aParametres);return this.appelAsynchrone();}
actionApresRequete(){const lListeCategories=this.moteur.deserialiserListeCategories(this.JSONReponse.listeCategories,true);const lTailleMaxCommentaires=this.JSONReponse.tailleMaxCommentaires;const lListeBillets=this.JSONReponse.listeBillets;lListeBillets.parcourir(function(aBillet){const lCategorie=aBillet.categorie;if(lCategorie===null||lCategorie===undefined){aBillet.categorie=new ObjetElement(GTraductions.getValeur('fenetre.Aucune'),null,0);aBillet.categorie.eltAucun=true;}
aBillet.listeCommentaires=this.moteur.deserialiserListeCommentaires(aBillet.listeCommentaires);aBillet.listeDocuments=_deserialiserDocuments(aBillet.listeDocuments);aBillet.contenu=aBillet.descriptif;}.bind(this));this.callbackReussite.appel({listeCategories:lListeCategories,listeBillets:lListeBillets,listeClasses:this.JSONReponse.listeClasses,tailleMaxCommentaires:lTailleMaxCommentaires});}}
Requetes.inscrire('PageBlogFilActus',ObjetRequetePageBlogFilActus);function _deserialiserDocuments(aListeDonnees){const lResult=new ObjetListeElements();aListeDonnees.parcourir(function(aDocCasier){const lRelation=new ObjetElement('',aDocCasier.GetNumero());lRelation.documentCasier=aDocCasier;lRelation.libelle=aDocCasier.commentaire;lResult.AddElement(lRelation);}.bind(this));return lResult;}
module.exports=ObjetRequetePageBlogFilActus;},fn:"objetrequetepageblogfilactus.js"});;
IE.fModule({f:function(exports,require,module,global){const{ObjetRequeteSaisie}=require('ObjetRequeteJSON.js');const Requetes=require('CollectionRequetes.js');const GChaine=require('GChaine.js');const TypeChaineHtml=require('TypeChaineHtml.js');class ObjetRequeteSaisieBlog extends ObjetRequeteSaisie{constructor(...aParams){super(...aParams);}
lancerRequete(aParam){aParam.listeBillets.setSerialisateurJSON({methodeSerialisation:_serialiser_Billet.bind(this)});this.JSON.listeBillets=aParam.listeBillets;return this.appelAsynchrone();}
actionApresRequete(aXml,aGenreReponse){this.callbackReussite.appel(aXml,aGenreReponse,this.JSONRapportSaisie);}}
Requetes.inscrire('SaisieBlog',ObjetRequeteSaisieBlog);function _serialiser_Billet(aBillet,aJSON){aJSON.commentairesUniquement=(aBillet.commentairesUniquement===true);if(aBillet.commentairesUniquement!==true){aJSON.titre=aBillet.titre;aJSON.contenu=new TypeChaineHtml(aBillet.contenu);aJSON.estTypeDiffEcole=aBillet.estTypeDiffEcole;aJSON.autoriseCommentaires=aBillet.autoriseCommentaires;if(aBillet.listeCoAuteurs){aBillet.listeCoAuteurs.setSerialisateurJSON({ignorerEtatsElements:true});aJSON.listeCoAuteurs=aBillet.listeCoAuteurs;}
if(aBillet.categorie){aJSON.categorie=aBillet.categorie;}
if((aBillet.estPublie!==null)&&(aBillet.estPublie!==undefined)){aJSON.estPublie=aBillet.estPublie;}
if((aBillet.conserverDate!==null)&&(aBillet.conserverDate!==undefined)){aJSON.conserverDate=aBillet.conserverDate;}
if(aBillet.listeDocuments){aBillet.listeDocuments.setSerialisateurJSON({methodeSerialisation:_serialiser_DocumentBillet.bind(this)});aJSON.listeDocuments=aBillet.listeDocuments;}}
if(aBillet.listeCommentaires){aBillet.listeCommentaires.setSerialisateurJSON({methodeSerialisation:_serialiser_Commentaire.bind(this)});aJSON.listeCommentaires=aBillet.listeCommentaires;}}
function _serialiser_Commentaire(aCommentaire,aJSON){aJSON.texte=aCommentaire.texte;aJSON.etatCommentaire=aCommentaire.etatCommentaire;}
function _serialiser_DocumentBillet(aDocumentBillet,aJSON){if(aDocumentBillet.documentCasier){aJSON.documentCasier=aDocumentBillet.documentCasier.toJSON();if(aDocumentBillet.libelleEnModification){aJSON.documentCasier.commentaire=aDocumentBillet.libelle;}
_serialiser_DocumentCasier.call(this,aDocumentBillet.documentCasier,aJSON.documentCasier);}}
function _serialiser_DocumentCasier(aDocumentCasier,aJSON){const lIdFichier=aDocumentCasier.idFichier!==undefined?aDocumentCasier.idFichier:(aDocumentCasier.fichier!==undefined?aDocumentCasier.fichier.idFichier:null);if(lIdFichier!==null){aJSON.idFichier=GChaine.CardinalToStr(lIdFichier);}
if(aDocumentCasier.url!==null&&aDocumentCasier.url!==undefined){aJSON.url=aDocumentCasier.url;}}
module.exports=ObjetRequeteSaisieBlog;},fn:"objetrequetesaisieblog.js"});;
IE.fModule({f:function(exports,require,module,global){const ObjetInterfacePage=require('ObjetInterfacePageCP.js');const{ObjetMoteurBlog,EGenreEvntBillet}=require('ObjetMoteurBlog.js');const ObjetIdentite=require('ObjetIdentite.js');const GestionnaireBlocBilletsBlog=require('GestionnaireBlocBilletsBlog.js');const ObjetRequetePageBlogFilActus=require('ObjetRequetePageBlogFilActus.js');const ObjetTri=require('ObjetTri.js');const EGenreTriElement=require('Enumere_TriElement.js');const GUID=require('GUID.js');const GHtml=require('GHtml.js');const EStructureAffichage=require('Enumere_StructureAffichage.js');const EGenreSaisie=require('Enumere_Saisie.js');const EGenreEvenementObjetSaisie=require('Enumere_EvenementObjetSaisie.js');const ObjetRequeteSaisieBlog=require('ObjetRequeteSaisieBlog.js');const GTraductions=require('ObjetTraduction.js');const ObjetFenetre_EditionBilletBlog=require('ObjetFenetre_EditionBilletBlog.js');const MethodesTableau=require('MethodesTableau.js');const EGenreEspace=require('Enumere_Espace.js');const EGenreEtat=require('Enumere_Etat.js');const{TypeDroits}=require('ObjetDroitsPN.js');const ObjetBoutonFlottant=require('ObjetBoutonFlottant.js');class InterfaceBlogFilActu extends ObjetInterfacePage{constructor(...aParams){super(...aParams);this.moteur=new ObjetMoteurBlog();this.ids={listeBillets:GUID.getId()};const lEstEspaceProf=MethodesTableau.existe(GEtatUtilisateur.GenreEspace,[EGenreEspace.PrimProfesseur,EGenreEspace.Mobile_PrimProfesseur]);this.avecAuteurBillet=MethodesTableau.existe(GEtatUtilisateur.GenreEspace,[EGenreEspace.PrimProfesseur,EGenreEspace.PrimEleve,EGenreEspace.Mobile_PrimProfesseur,EGenreEspace.Mobile_PrimEleve]);this.avecCBFiltreModerer=lEstEspaceProf;this.avecCBFiltreLesMiens=this.moteur.avecFiltreLesMiens(GEtatUtilisateur.GenreEspace);this.estFiltreLesMiens=false;this.estFiltreModerer=false;this.avecFiltreSelonMembre=this.moteur.avecFiltreSelonMembre(GEtatUtilisateur.GenreEspace);this.avecDroitAutorisationCommentaires=lEstEspaceProf;this.avecDroitEditionCategories=lEstEspaceProf;this.avecDroitEditionEtatPublication=this.moteur.avecGestionPublication(GEtatUtilisateur.GenreEspace);this.avecDroitFichiersJoints=lEstEspaceProf&&GApplication.droits.get(TypeDroits.cahierDeTexte.avecSaisiePieceJointe);this.categorie=null;this.contexte=null;this.avecPageFondBlanc=true;}
getControleur(aInstance){return $.extend(true,super.getControleur(this),{btnCreerBillet:{event:function(){_evntBtnCreerBillet.call(this);}.bind(aInstance)},visibiliteFiltreModerer:function(){return this.avecCBFiltreModerer;}.bind(aInstance),cbFiltreModerer:{getValue:function(){return this.estFiltreModerer;}.bind(aInstance),setValue:function(aValue){if((aValue!==null)&&(aValue!==undefined)){this.estFiltreModerer=aValue;this.afficherSelonFiltres();}}.bind(aInstance)},visibiliteFiltreMiens:function(){return this.avecCBFiltreLesMiens;}.bind(aInstance),cbFiltreMiens:{getValue:function(){return this.estFiltreLesMiens;}.bind(aInstance),setValue:function(aValue){if((aValue!==null)&&(aValue!==undefined)){this.estFiltreLesMiens=aValue;this.afficherSelonFiltres();}}.bind(aInstance)},comboCategorie:{init:function(aCombo){aCombo.setOptions_ObjetSaisie({mode:EGenreSaisie.Combo,longueur:IE.estMobile?200:150});},getDonnees:function(){if(this.listeCategories!==null&&this.listeCategories!==undefined){return this.listeCategories;}}.bind(aInstance),getIndiceSelection:function(){if((this.categorie!==null)&&(this.categorie!==undefined)){return this.listeCategories.GetIndiceParElement(this.categorie);} else{return 0;}}.bind(aInstance),event:function(aParametres){if((aParametres.genreEvenement===EGenreEvenementObjetSaisie.selection)&&(this.categorie===null||this.categorie===undefined||this.categorie.GetNumero()!==aParametres.element.GetNumero())){this.categorie=aParametres.element;this.afficherSelonFiltres();}}.bind(aInstance)},getIdentiteBouton:function(){return{class:ObjetBoutonFlottant,pere:this,init:function(aBtn){aInstance.btnFlottant=aBtn;var lParam={listeBoutons:[{primaire:true,icone:'icon_plus_fin large',callback:_evntBtnCreerBillet.bind(aInstance)}]};aBtn.setOptionsBouton(lParam);}};}});}
ConstruireInstances(){this.gestionnaireBillets=ObjetIdentite.creerInstance(GestionnaireBlocBilletsBlog,{pere:this,evenement:this._surEvntGestionnaireBillets});if(this.avecAuteurBillet){if(ObjetFenetre_EditionBilletBlog){this.identEditionBillet=this.addFenetre(ObjetFenetre_EditionBilletBlog,_evntEditionBillet.bind(this),this.moteur.initEditionBillet.bind(this));}}}
SetParametresGeneraux(){this.GenreStructure=EStructureAffichage.Autre;this.avecBandeau=true;if(IE.estMobile){this.AddSurZone=[];this.AddSurZone.push({html:this.composeFiltres()});}}
ConstruireStructureAffichageAutre(){const H=[];if(!IE.estMobile){H.push('<div class="filtre-actu">',this.composeFiltres(),'</div>');}
H.push('<div class="page-billet-actu" id="',this.ids.listeBillets,'"></div>');if(IE.estMobile&&!this.btnFlottant&&this.avecAuteurBillet){$("#"+GInterface.idZonePrincipale).IEHtmlAppend('<div class="is-sticky" ie-identite="getIdentiteBouton" ></div>',{controleur:this.controleur,avecCommentaireConstructeur:false});}
return H.join('');}
RecupererDonnees(){new ObjetRequetePageBlogFilActus(this,_actionSurRecupererDonnees.bind(this)).lancerRequete({estModeAdmin:false});}
scrollerSurBillet(aParam){if(aParam===null||aParam===undefined){return;}
const lBillet=aParam.billet;if(lBillet!==null&&lBillet!==undefined){const lInstanceBlocBillet=this.gestionnaireBillets.getInstanceObjetMetier(lBillet);if(lInstanceBlocBillet!==null&&lInstanceBlocBillet!==undefined){const lJEltEntete=$('#'+lInstanceBlocBillet.GetNom().escapeJQ()+' .zone-entete');if((lJEltEntete!==null)&&(lJEltEntete!==undefined)){lJEltEntete.focus();const lHauteurEnteteFixeEspace=$('.navbar-fixed').height();const lEspacement=10;const lTopVoulu=lHauteurEnteteFixeEspace+lEspacement;const lTopReel=lJEltEntete.position().top;const lDecallage=lTopReel-lTopVoulu;if(lDecallage>0){const lIdZoneScroll='div';const lZoneScroll=GHtml.getElement(lIdZoneScroll);lZoneScroll.scrollTop=lZoneScroll.scrollTop+lDecallage;}}}}}
composeFiltres(){const lFiltres=[];lFiltres.push('<header class="nav-page-profonde-container bg-white filtres-contain flex-contain">');if(!IE.estMobile&&this.avecAuteurBillet){lFiltres.push(this.moteur.composeHtmlBtnCreerBillet());}
const lCBModerer=['<div><ie-checkbox ie-display="visibiliteFiltreModerer" ie-model="cbFiltreModerer">',GTraductions.getValeur('blog.uniquAModerer'),'</ie-checkbox></div>'];const lCBLesMiens=['<div><ie-checkbox ie-display="visibiliteFiltreMiens" ie-model="cbFiltreMiens">',this.moteur.strFiltreLesMiens(GEtatUtilisateur.GenreEspace),'</ie-checkbox></div>'];const lComboCategorie=['<div><ie-combo class="on-mobile" ie-model="comboCategorie"></ie-combo></div>'];if(IE.estMobile){lFiltres.push(lComboCategorie.join(''));lFiltres.push(lCBModerer.join(''));lFiltres.push(lCBLesMiens.join(''));} else{lFiltres.push(lCBModerer.join(''));lFiltres.push(lCBLesMiens.join(''));lFiltres.push(lComboCategorie.join(''));}
lFiltres.push('</header>');return lFiltres.join('');}
afficherSelonFiltres(){const lListeFiltree=this.listeBillets.getListeElements(function(aElement){return((this.categorie!==null)&&(this.categorie!==undefined)&&((this.categorie.toutesLesCategories===true)||((this.categorie.eltAucun===true)&&!aElement.categorie.existeNumero())||(aElement.categorie.GetNumero()===this.categorie.GetNumero()))&&(this.avecCBFiltreModerer===false||this.estFiltreModerer===false||this.moteur.estBilletVisibleSelonFiltreModerer({billet:aElement,genreEspace:GEtatUtilisateur.GenreEspace,listeClasses:this.listeClasses}))&&((this.avecCBFiltreLesMiens===false)||(this.estFiltreLesMiens===false)||this.moteur.estBilletVisibleSelonFiltreMien({billet:aElement,genreEspace:GEtatUtilisateur.GenreEspace,listeClasses:this.listeClasses}))&&((this.avecFiltreSelonMembre===false)||aElement.estTypeDiffEcole||this.moteur.estBilletDeClasseDuMembre(aElement)));}.bind(this));lListeFiltree.setTri([
ObjetTri.init(function(D){return D.dateAffichage;}.bind(this),EGenreTriElement.Decroissant),ObjetTri.init('dateCreation',EGenreTriElement.Decroissant)
]);lListeFiltree.trier();_actualiserPage.call(this,lListeFiltree);}
_surEvntGestionnaireBillets(aBillet,aGenreEvnt,aParam){switch(aGenreEvnt){case EGenreEvntBillet.SurEdition:_evntEditerBillet.call(this,aBillet);break;case EGenreEvntBillet.SurModifPublication:aBillet.estPublie=!aBillet.estPublie;aBillet.SetEtat(EGenreEtat.Modification);this.moteur.surValidationBillet({billet:aBillet,clbck:function(){this.Valider();}.bind(this)});break;case EGenreEvntBillet.SurEditionCommentaire:{const lDivPere=GHtml.getElement(GApplication.getIdConteneur());this.contexte={numeroBillet:aBillet.GetNumero(),ecranCommentaires:aParam.ecranCommentaires,scrollTop:lDivPere?lDivPere.scrollTop:0};this.Valider();break;}
case EGenreEvntBillet.SurSuppression:this.Valider();break;}}
Valider(aParam){const lClbckSurValidation=(aParam!==null)&&(aParam!==undefined)&&aParam.clbck?aParam.clbck:this.ActionSurValidation;const lParamUpload={};const lListeFichiers=aParam?aParam.listeFichiers:null;if((lListeFichiers!==null)&&(lListeFichiers!==undefined)&&(lListeFichiers.GetNbrElements()>0)){$.extend(lParamUpload,{listeFichiers:lListeFichiers});}
const llisteClouds=aParam?aParam.listeClouds:null;if((llisteClouds!==null)&&(llisteClouds!==undefined)&&(llisteClouds.GetNbrElements()>0)){$.extend(lParamUpload,{listeDJCloud:llisteClouds});}
new ObjetRequeteSaisieBlog(this,lClbckSurValidation).addUpload(lParamUpload).lancerRequete({listeBillets:this.listeBillets});}
free(...aParams){super.free(...aParams);if(this.btnFlottant){$('#'+this.btnFlottant.GetNom().escapeJQ()).remove();}}}
function _actionSurRecupererDonnees(aDonnees){this.listeCategories=aDonnees.listeCategories;this.listeBillets=aDonnees.listeBillets;this.listeClasses=aDonnees.listeClasses;this.tailleMaxCommentaires=aDonnees.tailleMaxCommentaires;this.gestionnaireBillets.setOptions({tailleMaxCommentaires:this.tailleMaxCommentaires});this.estProfNonReferent=this.moteur.estProfNonReferent(GEtatUtilisateur.GenreEspace,this.listeClasses);if(this.estProfNonReferent===true){this.avecCBFiltreLesMiens=false;this.estFiltreLesMiens=false;}
let lInitCategorie=(this.categorie===null)||(this.categorie===undefined);if(lInitCategorie===false){const lIndice=this.listeCategories.GetIndiceParNumeroEtGenre(this.categorie.GetNumero());lInitCategorie=(lIndice===null||lIndice===undefined||lIndice=== -1);}
if(lInitCategorie===true){this.categorie=this.listeCategories.GetElement(0);}
this.afficherSelonFiltres();const lSelection=GEtatUtilisateur.getBilletBlog();if((lSelection!==null)&&(lSelection!==undefined)&&this.listeBillets!==null&&this.listeBillets!==undefined){const lBilletSelectionne=this.listeBillets.GetElementParNumero(lSelection.GetNumero());this.scrollerSurBillet({billet:lBilletSelectionne});GEtatUtilisateur.setBilletBlog(null);}}
function _actualiserPage(aListeFiltree){if(aListeFiltree===null||aListeFiltree===undefined){return;}
if(aListeFiltree.GetNbrElements()===0){_afficherMessage.call(this,'<div>'+GTraductions.getValeur('blog.aucunBillet')+'</div>'+'<div style="align-self: center;" class="Image_No_Data no-blog-data"></div>');} else{_afficherPage.call(this,aListeFiltree);}}
function _afficherMessage(aMessage){GHtml.setHtml(this.ids.listeBillets,this.composeMessage(aMessage));}
function _afficherPage(aListeFiltree){const lHtml=[];aListeFiltree.parcourir(function(aBillet){const lBloc=this.gestionnaireBillets.composeBloc(aBillet);lHtml.push(lBloc.html);}.bind(this));GHtml.setHtml(this.ids.listeBillets,lHtml.join(''),{controleur:this.controleur});this.gestionnaireBillets.refresh();if((this.contexte!==null)&&(this.contexte!==undefined)&&(this.contexte.numeroBillet!==null)&&(this.contexte.numeroBillet!==undefined)){const lBillet=aListeFiltree.GetElementParNumero(this.contexte.numeroBillet);if(lBillet){if(this.contexte.scrollTop!==null&&this.contexte.scrollTop!==undefined&&this.contexte.scrollTop>0){const lDivPere=GHtml.getElement(GApplication.getIdConteneur());lDivPere.scrollTop=this.contexte.scrollTop;} else{this.scrollerSurBillet({billet:lBillet});}
if(this.contexte.ecranCommentaires===true){const lInstanceBlocBillet=this.gestionnaireBillets.getInstanceObjetMetier(lBillet);if((lInstanceBlocBillet!==null)&&(lInstanceBlocBillet!==undefined)){lInstanceBlocBillet.actualiserSelonCtx({ouvrirCommentaires:this.contexte.ecranCommentaires});}}}}
this.contexte=null;}
function _evntBtnCreerBillet(){this.moteur.ouvrirFenetreSurCreerBillet({instanceFenetre:this.GetInstance(this.identEditionBillet),listeCategories:this.listeCategories,listeEleves:_getListeElevesDeClasses.call(this),elevesAvecCumulParClasse:((this.listeClasses!==null)&&(this.listeClasses!==undefined)&&(this.listeClasses.GetNbrElements()>1)),categorieParDefaut:_getCategorieParDefaut.call(this),avecCocheAutorisationCommentaires:this.avecDroitAutorisationCommentaires,avecEditionCategories:this.avecDroitEditionCategories,avecEditionEtatPublication:this.avecDroitEditionEtatPublication,avecEditionRedacteurs:(this.estProfNonReferent!==true),avecEditionDiffusion:(this.estProfNonReferent!==true),avecMediatheque:(this.estProfNonReferent!==true),estTypeDiffEcole:this.estProfNonReferent,tailleMaxCommentaires:this.tailleMaxCommentaires,listeClasses:this.listeClasses,avecFichiersJoints:this.avecDroitFichiersJoints});}
function _evntEditerBillet(aBillet){this.moteur.ouvrirFenetreSurEditerBillet({instanceFenetre:this.GetInstance(this.identEditionBillet),billet:aBillet,listeCategories:this.listeCategories,listeEleves:_getListeElevesDeClasses.call(this),elevesAvecCumulParClasse:((this.listeClasses!==null)&&(this.listeClasses!==undefined)&&(this.listeClasses.GetNbrElements()>1)),avecCocheAutorisationCommentaires:this.avecDroitAutorisationCommentaires,avecEditionCategories:this.avecDroitEditionCategories,avecEditionEtatPublication:this.avecDroitEditionEtatPublication,avecEditionRedacteurs:(this.estProfNonReferent!==true),avecEditionDiffusion:(this.estProfNonReferent!==true),avecMediatheque:(this.estProfNonReferent!==true),estTypeDiffEcole:this.estProfNonReferent,tailleMaxCommentaires:this.tailleMaxCommentaires,listeClasses:this.listeClasses,avecFichiersJoints:this.avecDroitFichiersJoints});}
function _getListeElevesDeClasses(){return this.moteur.getListeElevesDeClasses(this.listeClasses);}
function _getCategorieParDefaut(){if((this.categorie!==null)&&(this.categorie!==undefined)){if(this.categorie.toutesLesCategories!==true){return this.categorie;}}
return this.moteur.getCategorieAucune(this.listeCategories);}
function _evntEditionBillet(aParam){if(aParam.estEvntActualisation===true){this.listeCategories=this.moteur.deserialiserListeCategories(aParam.listeCategories,true);this.$refresh();}
if(!!aParam.donnee){if(aParam.estCreation){this.listeBillets.AddElement(aParam.donnee);this.Valider({listeFichiers:aParam.listeFichiers,listeClouds:aParam.listeClouds});} else{const lIndice=this.listeBillets.GetIndiceParElement(aParam.donnee);if(lIndice>=0){this.listeBillets.AddElement(aParam.donnee,lIndice);this.Valider({listeFichiers:aParam.listeFichiers,listeClouds:aParam.listeClouds});} else{}}}}
module.exports=InterfaceBlogFilActu;},fn:"produit/script/interfaceblogfilactu.js"});;
IE.fModule({f:function(exports,require,module,global){const EGenreAffichageFicheStage={Suivi:0,Entreprise:1,Details:2,Appreciations:3};module.exports.EGenreAffichageFicheStage=EGenreAffichageFicheStage;const GTraductions=require('ObjetTraduction.js');const EGenreAffichageFicheStageUtil={getTraductionOnglet(aGenreOnglet){switch(aGenreOnglet){case EGenreAffichageFicheStage.Entreprise:return GTraductions.getValeur('FicheStage.entreprise');case EGenreAffichageFicheStage.Details:return GTraductions.getValeur('FicheStage.details');case EGenreAffichageFicheStage.Suivi:return GTraductions.getValeur('FicheStage.suivi');case EGenreAffichageFicheStage.Appreciations:return GTraductions.getValeur('FicheStage.appreciations');default:return;}}};module.exports.EGenreAffichageFicheStageUtil=EGenreAffichageFicheStageUtil;},fn:"enumere_affichagefichestage.js"});;
IE.fModule({f:function(exports,require,module,global){const InterfacePage_Mobile=require('InterfacePage_Mobile.js');const ObjetSelection=require('ObjetSelection.js').ObjetSelection;const ObjetListeElements=require('ObjetListeElements.js');const ObjetTabOnglets=require('ObjetTabOnglets.js');const ObjetElement=require('ObjetElement.js');const{EGenreAffichageFicheStage,EGenreAffichageFicheStageUtil}=require('Enumere_AffichageFicheStage.js');class InterfaceFicheStageCP_Mobile extends InterfacePage_Mobile{constructor(...aParams){super(...aParams);this.listeTabs=new ObjetListeElements();}
ConstruireInstances(){if(this.parametres.avecSelectionEtudiant){this.identCmbEtudiant=this.Add(ObjetSelection,this.evntCmbEtudiant);}
this.identCmbStage=this.Add(ObjetSelection,this.evntCmbStage,_initCmb);this.identPage=this.creerInstancePage();this.identPageSuivi=this.creerInstanceSuivi();this.identTabs=this.Add(ObjetTabOnglets,this.eventModeAffStage);this.ObjetFicheStage_Suivi=this.creerInstancePageTabs();const lElementSuivi=new ObjetElement(EGenreAffichageFicheStageUtil.getTraductionOnglet(EGenreAffichageFicheStage.Suivi),null,EGenreAffichageFicheStage.Suivi,null,true);lElementSuivi.idDiv=this.GetInstance(this.ObjetFicheStage_Suivi).GetNom();this.listeTabs.AddElement(lElementSuivi);this.ObjetFicheStage_Entreprise=this.creerInstancePageTabs();const lElementEntreprise=new ObjetElement(EGenreAffichageFicheStageUtil.getTraductionOnglet(EGenreAffichageFicheStage.Entreprise),null,EGenreAffichageFicheStage.Entreprise,null,true);lElementEntreprise.idDiv=this.GetInstance(this.ObjetFicheStage_Entreprise).GetNom();this.listeTabs.AddElement(lElementEntreprise);this.ObjetFicheStage_Details=this.creerInstancePageTabs();const lElementDetails=new ObjetElement(EGenreAffichageFicheStageUtil.getTraductionOnglet(EGenreAffichageFicheStage.Details),null,EGenreAffichageFicheStage.Details,null,true);lElementDetails.idDiv=this.GetInstance(this.ObjetFicheStage_Details).GetNom();this.listeTabs.AddElement(lElementDetails);this.AddSurZone=[];if(this.identCmbEtudiant!==undefined){this.AddSurZone.push(this.identCmbEtudiant);}
if(this.parametres.avecSelectionEleve){this.AddSurZone.push(this.identComboClasse);this.AddSurZone.push(this.identComboEleve);}
this.AddSurZone.push(this.identCmbStage);this.AddSurZone.push(this.identTabs);}
surEvenementPageStage(aParam){if(!aParam){this.RecupererDonnees();} else if(aParam.suivi){$('#'+this.GetInstance(this.identPage).GetNom().escapeJQ()).hide();$('#'+GInterface.idZoneSelection.escapeJQ()).hide();this.GetInstance(this.identPageSuivi).SetDonnees(aParam.suivi,this.stage,{evenements:this.listeEvenementsSuiviStage,lieux:this.listeLieuxSuiviStage});$('#'+this.GetInstance(this.identPageSuivi).GetNom().escapeJQ()).show();}}
creerInstancePage(){}
creerInstanceSuivi(){}
creerInstancePageTabs(){}
Actualiser(){}
eventModeAffStage(){}}
function _initCmb(aInstance){aInstance.SetParametres({avecBoutonsPrecedentSuivant:false});}
module.exports=InterfaceFicheStageCP_Mobile;},fn:"interfacefichestagecp_mobile.js"});;
IE.fModule({f:function(exports,require,module,global){const ObjetIdentite_Mobile=require('ObjetIdentite_Mobile.js');const{EGenreAffichageFicheStage}=require('Enumere_AffichageFicheStage.js');require('PageFicheStage.css');class PageFicheStageCP_Mobile extends ObjetIdentite_Mobile{constructor(...aParams){super(...aParams);this.initParametres();}
initParametres(){this.parametres={avecEdition:false,avecEditionDocumentsJoints:false,avecEditionSuivisDeStage:false,avecCommentaire:false};}
setParametres(aParametres){$.extend(this.parametres,aParametres);}
SetDonnees(aDonnees){this.donnees=aDonnees.stage;this.listePJ=aDonnees.pj;this.selectOngletStage=aDonnees.genreOnglet;this.evenements=aDonnees.evenements,this.lieux=aDonnees.lieux,this.instanceListeSuivis=this.creerInstanceListeSuivis();this.controleur={};this.controleur=this.getControleur(this);this.Afficher();if(this.selectOngletStage===EGenreAffichageFicheStage.Suivi){this.initialiserListeSuivis();}}
creerInstanceListeSuivis(){}
initialiserListeSuivis(){}}
module.exports=PageFicheStageCP_Mobile;},fn:"pagefichestagecp_mobile.js"});;
IE.fModule({f:function(exports,require,module,global){const{ObjetRequeteSaisie}=require('ObjetRequeteJSON.js');const Requetes=require('CollectionRequetes.js');const EGenreEtat=require('Enumere_Etat.js');const ObjetElement=require('ObjetElement.js');class ObjetRequeteSaisieAppreciationFinDeStage extends ObjetRequeteSaisie{constructor(...aParams){super(...aParams);}
lancerRequete(aParam){this.JSON.eleve=new ObjetElement('',aParam.numEleve);aParam.stage.SetEtat(EGenreEtat.Modification);this.JSON.stage=aParam.stage.toJSON();serialiserAnnexe(aParam.stage,this.JSON.stage);aParam.listePJ.setSerialisateurJSON({methodeSerialisation:serialiserDocumentsJoints.bind(this)});this.JSON.listeFichiers=aParam.listePJ;return this.appelAsynchrone();}
actionApresRequete(aXml,aGenreReponse){this.callbackReussite.appel(aXml,aGenreReponse,this.JSONRapportSaisie);}}
Requetes.inscrire('SaisieAppreciationFinDeStage',ObjetRequeteSaisieAppreciationFinDeStage);function serialiserAnnexe(aStage,aJSON){aJSON.sujetDetaille=aStage.sujetDetaille;aJSON.objectifs=aStage.objectifs;aJSON.activitesPrevues=aStage.activitesPrevues;aJSON.competencesVisees=aStage.competencesVisees;aJSON.modalitesConcertation=aStage.modalitesConcertation;aJSON.modalitesEvaluation=aStage.modalitesEvaluation;aJSON.commentaire=aStage.commentaire;aStage.suiviStage.setSerialisateurJSON({methodeSerialisation:serialiserSuiviStage.bind(this)});aJSON.suiviStage=aStage.suiviStage;aStage.appreciations.setSerialisateurJSON({methodeSerialisation:serialiserAppreciations.bind(this)});aJSON.appreciations=aStage.appreciations;aStage.listePJ.setSerialisateurJSON({methodeSerialisation:serialiserDocumentsJoints.bind(this)});aJSON.listePJ=aStage.listePJ;}
function serialiserSuiviStage(aElement,aJSON){$.extend(aJSON,aElement.copieToJSON());if(aElement.listePJ){aElement.listePJ.setSerialisateurJSON({methodeSerialisation:serialiserDocumentsJoints.bind(this)});aJSON.listePJ=aElement.listePJ;}}
function serialiserDocumentsJoints(aDocument,aJSON){$.extend(aJSON,aDocument.copieToJSON());}
function serialiserAppreciations(aElement,aJSON){$.extend(aJSON,aElement.copieToJSON());}
module.exports=ObjetRequeteSaisieAppreciationFinDeStage;},fn:"objetrequetesaisieappreciationfindestage.js"});;
IE.fModule({f:function(exports,require,module,global){const MethodesObjet=require('MethodesObjet.js');const ObjetFenetre=require('ObjetFenetre.js');const GTraductions=require('ObjetTraduction.js');class ObjetFenetre_AnnexePedagogique extends ObjetFenetre{constructor(...aParams){super(...aParams);this.id={blocSujetDetaille:this.Nom+'_blocSujetDetaille',blocCommentaire:this.Nom+'_blocCommentaire',blocObjectifs:this.Nom+'_blocObjectifs',blocActivitesPrevues:this.Nom+'_blocActivitesPrevues',blocCompetencesVisees:this.Nom+'_blocCompetencesVisees',blocModalitesConcertation:this.Nom+'_blocModalitesConcertation',blocModalitesEvaluation:this.Nom+'_blocModalitesEvaluation',sujetDetaille:this.Nom+'_sujetDetaille',commentaire:this.Nom+'_commentaire',objectifs:this.Nom+'_objectifs',activitesPrevues:this.Nom+'_activitesPrevues',competencesVisees:this.Nom+'_competencesVisees',modalitesConcertation:this.Nom+'_modalitesConcertation',modalitesEvaluation:this.Nom+'_modalitesEvaluation'};this.donnees={sujetDetaille:null,commentaire:null,objectifs:null,activitesPrevues:null,competencesVisees:null,modalitesConcertation:null,modalitesEvaluation:null};this.parametres={avecEdition:false};}
setParametres_AnnexePedagogique(aParametres){$.extend(this.parametres,aParametres);}
getControleur(aInstance){return $.extend(true,super.getControleur(this),{getClassSujetDetaille:function(){return!!aInstance.donnees.sujetDetaille&&aInstance.donnees.sujetDetaille!==''?'active':'';},getClassCommentaire:function(){return!!aInstance.donnees.commentaire&&aInstance.donnees.commentaire!==''?'active':'';},getClassObjectifs:function(){return!!aInstance.donnees.objectifs&&aInstance.donnees.objectifs!==''?'active':'';},getClassActivitesPrevues:function(){return!!aInstance.donnees.activitesPrevues&&aInstance.donnees.activitesPrevues!==''?'active':'';},getClassCompetencesVisees:function(){return!!aInstance.donnees.competencesVisees&&aInstance.donnees.competencesVisees!==''?'active':'';},getClassModalitesConcertation:function(){return!!aInstance.donnees.modalitesConcertation&&aInstance.donnees.modalitesConcertation!==''?'active':'';},getClassModalitesEvaluation:function(){return!!aInstance.donnees.modalitesEvaluation&&aInstance.donnees.modalitesEvaluation!==''?'active':'';},txtSujetDetaille:{getValue:function(){return!!aInstance.donnees.sujetDetaille?aInstance.donnees.sujetDetaille:'';},setValue:function(aValeur){if(!!aInstance.donnees){aInstance.donnees.sujetDetaille=aValeur;aInstance.verifierDonnees();}}},txtCommentaire:{getValue:function(){return!!aInstance.donnees.commentaire?aInstance.donnees.commentaire:'';},setValue:function(aValeur){if(!!aInstance.donnees){aInstance.donnees.commentaire=aValeur;aInstance.verifierDonnees();}}},txtObjectifs:{getValue:function(){return!!aInstance.donnees.objectifs?aInstance.donnees.objectifs:'';},setValue:function(aValeur){if(!!aInstance.donnees){aInstance.donnees.objectifs=aValeur;aInstance.verifierDonnees();}}},txtActivitesPrevues:{getValue:function(){return!!aInstance.donnees.activitesPrevues?aInstance.donnees.activitesPrevues:'';},setValue:function(aValeur){if(!!aInstance.donnees){aInstance.donnees.activitesPrevues=aValeur;aInstance.verifierDonnees();}}},txtCompetencesVisees:{getValue:function(){return!!aInstance.donnees.competencesVisees?aInstance.donnees.competencesVisees:'';},setValue:function(aValeur){if(!!aInstance.donnees){aInstance.donnees.competencesVisees=aValeur;aInstance.verifierDonnees();}}},txtModalitesConcertation:{getValue:function(){return!!aInstance.donnees.modalitesConcertation?aInstance.donnees.modalitesConcertation:'';},setValue:function(aValeur){if(!!aInstance.donnees){aInstance.donnees.modalitesConcertation=aValeur;aInstance.verifierDonnees();}}},txtModalitesEvaluation:{getValue:function(){return!!aInstance.donnees.modalitesEvaluation?aInstance.donnees.modalitesEvaluation:'';},setValue:function(aValeur){if(!!aInstance.donnees){aInstance.donnees.modalitesEvaluation=aValeur;aInstance.verifierDonnees();}}}});}
SetDonnees(aObjet,aParametres){$.extend(this.donnees,aObjet);$.extend(this.parametres,aParametres);this.reference=MethodesObjet.dupliquer(this.donnees);this.Afficher(null);if(this.donnees.sujetDetaille===null){$('#'+this.id.blocSujetDetaille.escapeJQ()).hide();}
if(this.donnees.commentaire===null||!this.parametres.avecCommentaire){$('#'+this.id.blocCommentaire.escapeJQ()).hide();}
if(this.donnees.objectifs===null){$('#'+this.id.blocObjectifs.escapeJQ()).hide();}
if(this.donnees.activitesPrevues===null){$('#'+this.id.blocActivitesPrevues.escapeJQ()).hide();}
if(this.donnees.competencesVisees===null){$('#'+this.id.blocCompetencesVisees.escapeJQ()).hide();}
if(this.donnees.modalitesConcertation===null){$('#'+this.id.blocModalitesConcertation.escapeJQ()).hide();}
if(this.donnees.modalitesEvaluation===null){$('#'+this.id.blocModalitesEvaluation.escapeJQ()).hide();}
$('#'+this.Nom.escapeJQ()+' textarea').prop('disabled',!this.parametres.avecEdition);this.SetBoutonActif(1,false);}
ComposeContenu(){const lHTML=[];const lAttributTxtArea=IE.estMobile?'ie-autoresize style="max-height: 11rem;height: 100%;overflow:auto"':'class="Texte10 Gras round-style" ie-autoresize style="width: 100%;min-height: 4rem;max-height: 11rem;height: 100%;"';lHTML.push('<div id="',this.id.blocSujetDetaille,'" class="input-field EspaceHaut">','<label ie-class="getClassSujetDetaille">',GTraductions.getValeur('FenetreAnnexePedaStage.sujetDetaille'),'</label>','<ie-textareamax ie-model="txtSujetDetaille" id="',this.id.sujetDetaille,'" ',lAttributTxtArea,'>',this.donnees.sujetDetaille,'</ie-textareamax>','</div>');lHTML.push('<div id="',this.id.blocCommentaire,'" class="input-field EspaceHaut">','<label ie-class="getClassCommentaire">',GTraductions.getValeur('FenetreAnnexePedaStage.commentaire'),'</label>','<ie-textareamax ie-model="txtCommentaire" id="',this.id.commentaire,'" ',lAttributTxtArea,'>',this.donnees.commentaire,'</ie-textareamax>','</div>');lHTML.push('<div id="',this.id.blocObjectifs,'" class="input-field EspaceHaut">','<label ie-class="getClassObjectifs">',GTraductions.getValeur('FenetreAnnexePedaStage.objectifs'),'</label>','<ie-textareamax ie-model="txtObjectifs" id="',this.id.objectifs,'" ',lAttributTxtArea,'>',this.donnees.objectifs,'</ie-textareamax>','</div>');lHTML.push('<div id="',this.id.blocActivitesPrevues,'" class="input-field EspaceHaut">','<label ie-class="getClassActivitesPrevues">',GTraductions.getValeur('FenetreAnnexePedaStage.activitesPrevues'),'</label>','<ie-textareamax ie-model="txtActivitesPrevues" id="',this.id.activitesPrevues,'" ',lAttributTxtArea,'>',this.donnees.activitesPrevues,'</ie-textareamax>','</div>');lHTML.push('<div id="',this.id.blocCompetencesVisees,'" class="input-field EspaceHaut">','<label ie-class="getClassCompetencesVisees">',GTraductions.getValeur('FenetreAnnexePedaStage.competencesVisees'),'</label>','<ie-textareamax ie-model="txtCompetencesVisees" id="',this.id.competencesVisees,'" ',lAttributTxtArea,'>',this.donnees.competencesVisees,'</ie-textareamax>','</div>');lHTML.push('<div id="',this.id.blocModalitesConcertation,'" class="input-field EspaceHaut">','<label ie-class="getClassModalitesConcertation">',GTraductions.getValeur('FenetreAnnexePedaStage.modalitesConcertation'),'</label>','<ie-textareamax ie-model="txtModalitesConcertation" id="',this.id.modalitesConcertation,'" ',lAttributTxtArea,'>',this.donnees.modalitesConcertation,'</ie-textareamax>','</div>');lHTML.push('<div id="',this.id.blocModalitesEvaluation,'" class="input-field EspaceHaut">','<label ie-class="getClassModalitesEvaluation">',GTraductions.getValeur('FenetreAnnexePedaStage.modalitesEvaluation'),'</label>','<ie-textareamax ie-model="txtModalitesEvaluation" id="',this.id.modalitesEvaluation,'" ',lAttributTxtArea,'>',this.donnees.modalitesEvaluation,'</ie-textareamax>','</div>');return lHTML.join('');}
verifierDonnees(){if(this.donnees.sujetDetaille!==this.reference.sujetDetaille||this.donnees.commentaire!==this.reference.commentaire||this.donnees.objectifs!==this.reference.objectifs||this.donnees.activitesPrevues!==this.reference.activitesPrevues||this.donnees.competencesVisees!==this.reference.competencesVisees||this.donnees.modalitesConcertation!==this.reference.modalitesConcertation||this.donnees.modalitesEvaluation!==this.reference.modalitesEvaluation){this.SetBoutonActif(1,true);} else{this.SetBoutonActif(1,false);}}
SurValidation(aNumeroBouton){this.Fermer();this.callback.appel(aNumeroBouton,this.donnees);}}
module.exports=ObjetFenetre_AnnexePedagogique;},fn:"objetfenetre_annexepedagogique.js"});;
IE.fModule({f:function(exports,require,module,global){const MethodesObjet=require('MethodesObjet.js');const{EGenreRole}=require('ObjetWAI.js');const EGenreEtat=require('Enumere_Etat.js');const EGenreEvenementObjetSaisie=require('Enumere_EvenementObjetSaisie.js');const ObjetCelluleDate=require('ObjetCelluleDate.js');const{GDate}=require('ObjetDate.js');const ObjetListeElements=require('ObjetListeElements.js');const ObjetFenetre=require('ObjetFenetre.js');const GTraductions=require('ObjetTraduction.js');const TUtilitaireUrl=require('UtilitaireUrl.js');const EGenreAction=require('Enumere_Action.js');const ObjetTri=require('ObjetTri.js');require('ObjetFenetre_SuiviStage.css');class ObjetFenetre_SuiviStage extends ObjetFenetre{constructor(...aParams){super(...aParams);this.listes={evenements:null,lieux:null};this.parametres={libellePublication:GTraductions.getValeur('FenetreSuiviStage.Publier'),maxSizeDocumentJoint:0};this.setOptionsFenetre({largeur:400,hauteur:320,listeBoutons:[GTraductions.getValeur('Annuler'),GTraductions.getValeur('Valider')]});}
ConstruireInstances(){this.identDate=this.Add(ObjetCelluleDate,evenementSelecteurDate.bind(this));}
setParametresFenetreSuivi(aParametres){Object.assign(this.parametres,aParametres);}
getControleur(aInstance){return $.extend(true,super.getControleur(this),{cbAvecHeure:{getValue:function(){return!!aInstance.suivi&&!!aInstance.suivi.avecHeure;},setValue:function(aValeur){if(!!aInstance.suivi){aInstance.suivi.avecHeure=aValeur;aInstance.suivi.SetEtat(EGenreEtat.Modification);}}},inputHeure:{getValue:function(){const lDate=aInstance.suivi?aInstance.suivi.date:null;return!!lDate?GDate.FormatDate(lDate,'%hh:%mm'):'';},setValue:function(aValue,aParamsSetter){if(!!aInstance.suivi){const lDate=aInstance.suivi.date;if(!lDate){return;}
lDate.setHours(aParamsSetter.time.heure);lDate.setMinutes(aParamsSetter.time.minute);aInstance.suivi.SetEtat(EGenreEtat.Modification);}},getDisabled:function(){return!aInstance.suivi||!aInstance.suivi.avecHeure;}},comboEvenements:{init:function(aCombo){aCombo.setOptions_ObjetSaisie({estLargeurAuto:false,avecOuvertureDeroulantModale:IE.estMobile,avecTriListeElements:false,celluleAvecTexteHtml:true,labelWAIZone:GTraductions.getValeur('FenetreSuiviStage.Evenement'),roleWAIEdit:EGenreRole.Option});},getDonnees:function(aDonnees){if(!aDonnees){return aInstance.listes.evenements;}},getIndiceSelection:function(){let lIndice=0;if(!!aInstance.suivi&&!!aInstance.suivi.evenement){lIndice=aInstance.listes.evenements.GetIndiceParNumeroEtGenre(aInstance.suivi.evenement.GetNumero());}
return Math.max(lIndice,0);},event:function(aParametres){if(aParametres.genreEvenement===EGenreEvenementObjetSaisie.selection&&!!aParametres.element&&!!aInstance.suivi){aInstance.suivi.evenement=aParametres.element;aInstance.suivi.SetLibelle(aParametres.element.GetLibelle());aInstance.suivi.SetEtat(EGenreEtat.Modification);}}},comboLieux:{init:function(aCombo){aCombo.setOptions_ObjetSaisie({estLargeurAuto:false,placeHolder:GTraductions.getValeur('FenetreSuiviStage.ChoixLieu'),avecOuvertureDeroulantModale:IE.estMobile,avecTriListeElements:false,labelWAIZone:GTraductions.getValeur('FenetreSuiviStage.Lieu'),roleWAIEdit:EGenreRole.Option});},getDonnees:function(aDonnees){if(!aDonnees){return aInstance.listes.lieux;}},getIndiceSelection:function(){let lIndice=0;if(!!aInstance.suivi&&!!aInstance.suivi.lieu){lIndice=aInstance.listes.lieux.GetIndiceParNumeroEtGenre(aInstance.suivi.lieu.GetNumero());}
return Math.max(lIndice,0);},event:function(aParametres){if(aParametres.genreEvenement===EGenreEvenementObjetSaisie.selection&&!!aParametres.element&&!!aInstance.suivi){aInstance.suivi.lieu=aParametres.element;aInstance.suivi.SetEtat(EGenreEtat.Modification);}}},modelAjouterPJ:{getOptionsSelecFile:function(){return{maxSize:aInstance.parametres.maxSizeDocumentJoint};},addFiles:function(aParams){if(!!aInstance.suivi){if(!aInstance.suivi.listePJ){aInstance.suivi.listePJ=new ObjetListeElements();}
aInstance.suivi.listePJ.AddElement(aParams.eltFichier);aInstance.listePJEleve.AddElement(aParams.eltFichier);aInstance.suivi.SetEtat(EGenreEtat.Modification);}}},getLibellesPiecesJointes:function(){const lDisplayListePJ=[];if(!!aInstance.suivi&&!!aInstance.suivi.listePJ){lDisplayListePJ.push(TUtilitaireUrl.construireListeUrls(aInstance.suivi.listePJ,{IEModelChips:'chipsPieceJointe'}));}
return lDisplayListePJ.join('');},chipsPieceJointe:{eventBtn:function(aIndice){if(!!aInstance.suivi&&!!aInstance.suivi.listePJ){const lPieceJointeASupp=aInstance.suivi.listePJ.GetElement(aIndice);if(!!lPieceJointeASupp){lPieceJointeASupp.SetEtat(EGenreEtat.Suppression);aInstance.suivi.SetEtat(EGenreEtat.Modification);}}}},txtCommentaire:{getValue:function(){return!!aInstance.suivi?aInstance.suivi.commentaire:'';},setValue:function(aValeur){if(!!aInstance.suivi){aInstance.suivi.commentaire=aValeur;aInstance.suivi.SetEtat(EGenreEtat.Modification);}}},getClassLabelCommentaire:function(){return!!aInstance.suivi&&!!aInstance.suivi.commentaire&&aInstance.suivi.commentaire!==''?'active':'';},cbPublierSuivi:{getValue:function(){return!!aInstance.suivi&&!!aInstance.suivi.publier;},setValue:function(aValue){if(!!aInstance.suivi){aInstance.suivi.publier=aValue;aInstance.suivi.SetEtat(EGenreEtat.Modification);}},getLibelle:function(){return aInstance.parametres.libellePublication;}}});}
SetDonnees(aParam){this.listes.evenements=aParam.evenements;this.listes.lieux=aParam.lieux;if(!!this.listes.evenements){this.listes.evenements.setTri([ObjetTri.init('Libelle')]);this.listes.evenements.trier();}
if(!!this.listes.lieux){this.listes.lieux.setTri([ObjetTri.init('Libelle')]);this.listes.lieux.trier();}
this.suivi=MethodesObjet.dupliquer(aParam.suivi);this.listePJEleve=MethodesObjet.dupliquer(aParam.listePJEleve);this.GetInstance(this.identDate).SetDonnees(this.suivi.date);this.Afficher();}
ComposeContenu(){const H=[];H.push(`<div class="flex-contain cols p-top-l">\n              <div class="field-contain no-line dates-contain as-grid">\n                <label>${GTraductions.getValeur('FenetreSuiviStage.Date')} : </label>\n                <div id="${this.GetInstance(this.identDate).GetNom()}" class="date-wrapper"></div>\n              </div>\n              <div class="field-contain time-conteneur as-grid">\n                <ie-checkbox ie-model="cbAvecHeure">${GTraductions.getValeur('FenetreSuiviStage.AfficherDate')}</ie-checkbox>\n                <div id="wrapperInputHeure" class="gd-self-end"><input type="time" ie-model="inputHeure" class="round-style input-time" /></div>\n              </div>\n              <div class="field-contain as-grid">\n                <label>${GTraductions.getValeur('FenetreSuiviStage.Evenement')} : </label>\n                <div><ie-combo ie-model="comboEvenements" class="full-width events-contain"></ie-combo></div>\n              </div>\n              <div class="field-contain as-grid">\n                <label class="fix-bloc">${GTraductions.getValeur('FenetreSuiviStage.Lieu')} : </label>\n                <div><ie-combo ie-model="comboLieux" class="full-width"></ie-combo></div>\n              </div>\n              <div class="pj-global-conteneur">\n                <div class="select-file icon_piece_jointe" ie-model="modelAjouterPJ" ie-selecfile><span class="label-pj">${GTraductions.getValeur('FicheEleve.ajouterPJ')}</span></div>\n                <div ie-html="getLibellesPiecesJointes"></div>\n              </div>\n              <div class="field-contain">\n                <label class="only-mobile m-bottom-l" ie-class="getClassLabelCommentaire">${GTraductions.getValeur('FenetreSuiviStage.Commentaire')}</label>\n                <ie-textareamax tabIndex="0"  class="txt-comment round-style fluid-bloc full-width"  ie-autoresize ie-model="txtCommentaire" style="max-height: 11rem; ${!IE.estMobile?`min-height:4rem;`:`overflow:auto;`}"  placeholder="${GTraductions.getValeur('FicheEleve.redigezCommentaire')}"></ie-textareamax>\n              </div>\n              <div class="public-team">\n              <ie-checkbox ie-model="cbPublierSuivi"></ie-checkbox>\n              </div>\n            </div>`);return H.join('');}
SurValidation(ANumeroBouton){this.Fermer();const lGenreAction=ANumeroBouton===1?EGenreAction.Valider:EGenreAction.Annuler;this.callback.appel(lGenreAction,this.suivi,this.listePJEleve);}}
ObjetFenetre_SuiviStage.ouvrir=function(aParametres){const lFenetre=ObjetFenetre.creerInstance(ObjetFenetre_SuiviStage,{pere:aParametres.pere,evenement:aParametres.evenement,initialiser:aParametres.initialiser});if(aParametres.optionsFenetre){lFenetre.setOptionsFenetre(aParametres.optionsFenetre);}
lFenetre.SetDonnees(aParametres.donnees);};function evenementSelecteurDate(aDate){if(!GDate.estJourEgal(this.suivi.date,aDate)){this.suivi.SetEtat(EGenreEtat.Modification);this.suivi.date=aDate;}}
module.exports=ObjetFenetre_SuiviStage;},fn:"objetfenetre_suivistage.js"});;
IE.fModule({f:function(exports,require,module,global){const MethodesObjet=require('MethodesObjet.js');const ObjetFenetre=require('ObjetFenetre.js');const GTraductions=require('ObjetTraduction.js');class ObjetFenetre_AppreciationsStage extends ObjetFenetre{constructor(...aParams){super(...aParams);this.setOptionsFenetre({titre:GTraductions.getValeur('FicheStage.appreciations'),largeur:500,listeBoutons:[GTraductions.getValeur('Annuler'),GTraductions.getValeur('Valider')]});}
getControleur(aInstance){return $.extend(true,super.getControleur(this),{txtAppreciation:{getValue:function(aNumero){const lAppreciation=aInstance.donnees.GetElementParNumero(aNumero);return!!lAppreciation?lAppreciation.appreciation:'';},setValue:function(aNumero,aValeur){const lAppreciation=aInstance.donnees.GetElementParNumero(aNumero);if(!!lAppreciation){lAppreciation.appreciation=aValeur;}}}});}
ComposeContenu(){if(!this.donnees){return'';}
const lHTML=[];const lAttributTxtArea=IE.estMobile?'ie-autoresize style="max-height: 11rem;height: 100%;overflow:auto" class="m-top-l"':'class="Texte10 Gras round-style" ie-autoresize style="width: 100%;min-height: 4rem;max-height: 11rem;height: 100%;"';this.donnees.parcourir((aAppreciation) =>{if(aAppreciation.avecEditionAppreciation){lHTML.push('<div class="input-field EspaceHaut">','<label>',aAppreciation.GetLibelle(),'</label>','<ie-textareamax ie-model="txtAppreciation(\'',aAppreciation.GetNumero(),'\')"  ',lAttributTxtArea,'>',aAppreciation.appreciation,'</ie-textareamax>','</div>');}});return lHTML.join('');}
SetDonnees(aDonnees){this.donnees=MethodesObjet.dupliquer(aDonnees);this.Afficher(this.ComposeContenu());}
SurValidation(aNumeroBouton){this.Fermer();this.callback.appel(aNumeroBouton,this.donnees);}}
module.exports=ObjetFenetre_AppreciationsStage;},fn:"objetfenetre_appreciationsstage.js"});;
IE.fModule({f:function(exports,require,module,global){const GChaine=require('GChaine.js');const{GDate}=require('ObjetDate.js');const GTraductions=require('ObjetTraduction.js');const tag=require('tag.js');const EGenreBoiteMessage=require('Enumere_BoiteMessage.js');const EGenreEtat=require('Enumere_Etat.js');const ObjetRequeteSaisieAppreciationFinDeStage=require('ObjetRequeteSaisieAppreciationFinDeStage.js');const ObjetFenetre=require('ObjetFenetre.js');const ObjetFenetre_UploadFichiers=require('ObjetFenetre_UploadFichiers.js');const EGenreAction=require('Enumere_Action.js');const EGenreRessource=require('Enumere_Ressource.js');const{TypeDroits}=require('ObjetDroitsPN.js');const ObjetFenetre_AnnexePedagogique=require('ObjetFenetre_AnnexePedagogique.js');const ObjetFenetre_SuiviStage=require('ObjetFenetre_SuiviStage.js');const ObjetElement=require('ObjetElement.js');const ObjetListeElements=require('ObjetListeElements.js');const ObjetMenuContextuel=require('ObjetMenuContextuel.js');const ObjetFenetre_AppreciationsStage=require('ObjetFenetre_AppreciationsStage.js');const ObjetTri=require('ObjetTri.js');require('LiensCommunications.css');const UtilitaireFicheStage={};UtilitaireFicheStage.ComposeBlocEntreprise=function(aDonnees){const H=[];H.push(_composeBlocEntrepriseAccueil(aDonnees));if(!!aDonnees.maitreDeStage&&aDonnees.maitreDeStage.GetNbrElements()){H.push(_composeBlocEntrepriseMDS(aDonnees));}
H.push(_composeBlocEntrepriseHoraires(aDonnees));return H.join('');};function _composeBlocEntrepriseAccueil(aDonnees){const H=[];const lEntreprise=aDonnees.entreprise;if(lEntreprise){H.push(`<section class="entreprise-accueil">\n              <h4 class="ie-titre-couleur">${GTraductions.getValeur('FicheStage.entrepriseAccueil')}</h4>\n                <div class="flex-wrapper">`);H.push(`<div class="sous-section">`);H.push(tag('div',{class:'conteneur-nom'},tag('i',{class:!!lEntreprise.estSiegeSocial?'icon_building':'icon_entreprise'}),tag('div',tag('div',{class:'ie-titre'},lEntreprise.GetLibelle()+(!!lEntreprise.estSiegeSocial?` (${GTraductions.getValeur('FicheStage.siegeSocial')})`:'')),!!lEntreprise.nomCommercial?tag('span',lEntreprise.nomCommercial):'')));if(!!lEntreprise.adresse1||!!lEntreprise.adresse2||!!lEntreprise.adresse3||!!lEntreprise.adresse4||!!lEntreprise.codePostal||!!lEntreprise.ville||!!lEntreprise.pays){const strCPVillePays=[];if(!!lEntreprise.codePostal||!!lEntreprise.ville||!!lEntreprise.pays){if(!!lEntreprise.codePostal){strCPVillePays.push(lEntreprise.codePostal);}
if(!!lEntreprise.ville){strCPVillePays.push(lEntreprise.ville);}
if(!!lEntreprise.pays){strCPVillePays.push(lEntreprise.pays);}}
H.push(tag('div',{class:'conteneur-adresse'},tag('ul',!!lEntreprise.adresse1?tag('li',lEntreprise.adresse1):'',!!lEntreprise.adresse2?tag('li',lEntreprise.adresse2):'',!!lEntreprise.adresse3?tag('li',lEntreprise.adresse3):'',!!lEntreprise.adresse4?tag('li',lEntreprise.adresse4):'',!!strCPVillePays.length?tag('li',strCPVillePays.join(' ')):'')));}
H.push(`</div>`);if(!!lEntreprise.site||!!lEntreprise.telFixe||!!lEntreprise.mobile||!!lEntreprise.fax||!!lEntreprise.email){H.push(`<div class="sous-section conteneur-info">`);if(!!lEntreprise.mobile){H.push(tag('div',{class:'lien-communication tel-mobile',title:GTraductions.getValeur('FicheStage.TelPortable')},tag('a',{href:'tel:'+GChaine.formatTelephoneAvecIndicatif(lEntreprise.indMobile,lEntreprise.mobile)},GChaine.formatTelephone(lEntreprise.mobile))));}
if(!!lEntreprise.telFixe){H.push(tag('div',{class:'lien-communication tel',title:GTraductions.getValeur('FicheStage.TelFixe')},tag('a',{href:'tel:'+GChaine.formatTelephoneAvecIndicatif(lEntreprise.indFix,lEntreprise.telFixe)},GChaine.formatTelephone(lEntreprise.telFixe))));}
if(!!lEntreprise.fax){H.push(tag('div',{class:'lien-communication',title:GTraductions.getValeur('FicheStage.Fax')},tag('a',{href:'fax:'+GChaine.formatTelephone(lEntreprise.fax)},GChaine.formatTelephone(lEntreprise.fax))));}
if(!!lEntreprise.site){H.push(tag('div',{class:'lien-communication'},tag('a',{href:GChaine.encoderUrl(GChaine.verifierURLHttp(lEntreprise.site))},lEntreprise.site)));}
if(!!lEntreprise.email){H.push(tag('div',{class:'lien-communication'},tag('a',{href:'mailto:'+lEntreprise.email,target:'_blank'},lEntreprise.email)));}
H.push(`</div>`);}
if(lEntreprise.responsable||lEntreprise.commentairePublie){H.push('<div>');if(lEntreprise.responsable){H.push(`<div class="sous-section conteneur-responsable">\n                <h5 class="ie-titre-petit">${GTraductions.getValeur('FicheStage.responsableEntreprise')} : </h5>\n                <span>${lEntreprise.responsable.GetLibelle()}</span>\n              </div>`);}
if(lEntreprise.commentairePublie){H.push(tag('div',{class:'sous-section'},lEntreprise.commentairePublie));}
H.push('</div>');}
H.push('</div>');H.push(`</section>`);}
return H.join('');}
function _composeBlocEntrepriseMDS(aDonnees){const H=[];const lListe=aDonnees.maitreDeStage;const lLibelleTitre=(lListe.GetNbrElements()>1?GTraductions.getValeur('FicheStage.maitresDeStage'):GTraductions.getValeur('FicheStage.maitreDeStage'));H.push(`<section class="entreprise-maitres">\n            <h4 class="ie-titre-couleur">${lLibelleTitre}</h4>\n              <div class="flex-wrapper">`);lListe.parcourir(function(aMDS){H.push(`<div class="conteneur-maitre-stage">\n                <div class="sous-section conteneur-nom">\n                  <span class="nom-maitre">${aMDS.GetLibelle()}</span>\n                  ${(!!aMDS.fonction)?`<div class="fonction">${aMDS.fonction}</div>`:''}
                </div>`);H.push(`<div class="sous-section conteneur-info">`);if(!!aMDS.telPortable){H.push(tag('div',{class:'lien-communication tel-mobile',title:GTraductions.getValeur('FicheStage.MDS.Portable')},tag('a',{href:'tel:'+GChaine.formatTelephoneAvecIndicatif(aMDS.indPortable,aMDS.telPortable)},GChaine.formatTelephone(aMDS.telPortable))));}
if(!!aMDS.telFixe){H.push(tag('div',{class:'lien-communication tel',title:GTraductions.getValeur('FicheStage.MDS.TelFixe')},tag('a',{href:'tel:'+GChaine.formatTelephoneAvecIndicatif(aMDS.indFixe,aMDS.telFixe)},GChaine.formatTelephone(aMDS.telFixe))));}
if(!!aMDS.fax){H.push(tag('div',{class:'lien-communication',title:GTraductions.getValeur('FicheStage.MDS.Fax')},tag('a',{href:'fax:'+GChaine.formatTelephone(aMDS.fax)},GChaine.formatTelephone(aMDS.fax))));}
if(!!aMDS.email){H.push(tag('div',{class:'lien-communication'},tag('a',{href:'mailto:'+aMDS.email,target:'_blank'},aMDS.email)));}
H.push(`</div>\n          </div>`);});H.push('</div>');H.push('</section>');return H.join('');}
function _composeBlocEntrepriseHoraires(aDonnees){const H=[];const lListeJours=aDonnees.horairesJours;H.push(`<section>`);if(!!lListeJours&&lListeJours.GetNbrElements()){let lAvecHoraire=false;lListeJours.parcourir(function(aJour){if(aJour&&aJour.horaires&&aJour.horaires.GetNbrElements()){lAvecHoraire=true;}});if(lAvecHoraire||(!!aDonnees.dateDebut&&!!aDonnees.dateFin)){H.push(tag('h4',{class:'ie-titre-couleur'},GTraductions.getValeur('FicheStage.PresenceDansEntreprise')));}
H.push('<div class="flex-wrapper">');if(!!aDonnees.dateDebut&&!!aDonnees.dateFin){H.push('<div class="Bloc-entreprise-dates',!IE.estMobile?' conteneur-Espace':'','">');H.push(tag('h5',{class:'ie-titre-petit'},GTraductions.getValeur('FicheStage.stageDates')));H.push(tag('div',{class:''},GDate.FormatDate(aDonnees.dateDebut,GTraductions.getValeur('Du')+' %JJ/%MM/%AAAA')+GDate.FormatDate(aDonnees.dateFin,' '+GTraductions.getValeur('Au')+' %JJ/%MM/%AAAA')+(!!aDonnees.nbSemaines?' ('+aDonnees.nbSemaines+')':'')));H.push('</div>');}
if(lAvecHoraire){H.push('<div>');H.push('<div class="Bloc-entreprise-horaire">');H.push(tag('h5',{class:'ie-titre-petit'},GTraductions.getValeur('FicheStage.stageHoraires')));lListeJours.parcourir(function(aJour){if(aJour&&aJour.horaires&&(aJour.horaires.GetNbrElements()>0)){H.push('<div class="flex-contain conteneur-journee">','<div class="Gras nom-journee" style="width:6rem;">',aJour.GetLibelle(),'</div>');H.push('<div>');for(let i=0,lNbr=aJour.horaires.GetNbrElements();i<lNbr;i++){if(i>0){H.push(tag('span',{class:''},' / '));}
H.push(tag('span',{class:''},aJour.horaires.GetElement(i).GetLibelle()));}
H.push('</div>');H.push(tag('div',{class:'Gras heure-journee'},aJour.heuresJournee));H.push('</div>');}});H.push(tag('div',{class:'flex-contain conteneur-total-hebdo'},tag('div',{class:'Gras ie-titre-petit titre-total avecMarginTop'},GTraductions.getValeur('FicheStage.totalHebdo')),tag('div',{class:'chips-total-stage'},tag('ie-chips',{class:'tag-style'},aDonnees.heuresHebdo))));H.push('</div>');H.push('</div>');}
H.push('</div>');}
H.push('</section>');return H.join('');}
UtilitaireFicheStage.ComposeBlocDetails=function(aDonnees,aParams){const H=[];H.push(_composeBlocDetailsEnseignants(aDonnees));H.push(_composeBlocDetailsSujet(aDonnees,aParams));if(aDonnees.listePJ&&aDonnees.listePJ.GetNbrElements()){H.push(_composeBlocDocumentsJoints(aDonnees,aParams));}
H.push(_composeBlocDetailsAnnexes(aDonnees,aParams));if(aParams.parametres.avecEdition||aParams.parametres.avecEditionDocumentsJoints){_ajoutControleurEditionDetails(aDonnees,aParams);}
return H.join('');};function _composeBlocDetailsEnseignants(aDonnees){const H=[];H.push('<section class="Bloc-details-enseignants">');H.push(tag('h4',{class:'ie-titre-couleur'},aDonnees.GetLibelle()+(aDonnees.nbJours?' ('+GTraductions.getValeur('FicheStage.dureeDetails')+' : '+aDonnees.nbJours+')':'')));H.push('<div class="conteneur-enseignants">');if(!!aDonnees.professeur&&aDonnees.professeur.GetNbrElements()){H.push(tag('div',{class:'Gras ie-titre-petit'},aDonnees.professeur.GetNbrElements()>1?GTraductions.getValeur('FicheStage.profsReferents'):GTraductions.getValeur('FicheStage.profReferent')));H.push(tag('div',{class:''},aDonnees.professeur.getTableauLibelles().join(', ')));H.push('</div>');}
H.push('</section>');return H.join('');}
function _composeBlocDetailsSujet(aDonnees,aParams){const H=[];H.push('<section class="Bloc-details-sujetCommentaire">');H.push('  <div class="conteneur-sujetCommentaire">');H.push(tag('div',{class:'flex-contain'},tag('div',{class:'Gras ie-titre-petit'},GTraductions.getValeur('FenetreAnnexePedaStage.sujetDetaille')),aParams.parametres.avecEdition?tag('ie-btnicon',{class:'icon_pencil','ie-model':'modifierSujet',title:GTraductions.getValeur('Modifier')}):''));const lSujetDetail=aDonnees.sujetDetaille;H.push(tag('div',{class:''},GChaine.ToHTML(lSujetDetail)||GTraductions.getValeur('FicheStage.pasDeSujetDetaille')));H.push('  </div>');H.push('</section>');return H.join('');}
function _composeBlocDocumentsJoints(aDonnees){const H=[];H.push('<section class="Bloc-details-documentsJoints">');H.push(tag('div',{class:'Gras ie-titre-petit'},GTraductions.getValeur('FicheStage.documentsJoints')));H.push('<div class="m-bottom-l">');const lGenresPJ={};aDonnees.listePJ.parcourir(aPJ =>{if(lGenresPJ[aPJ.genreDocJoint.GetGenre()]!==aPJ.genreDocJoint.GetGenre()){lGenresPJ[aPJ.genreDocJoint.GetGenre()]=aPJ.genreDocJoint.GetLibelle();}});for(const lGenre in lGenresPJ){H.push('<div class="bloc-pj">');H.push(lGenresPJ[lGenre]!==''?`${lGenresPJ[lGenre]} : `:`${GTraductions.getValeur('FicheStage.autreDocJoint')} : `);H.push('<div class="m-left">');aDonnees.listePJ.parcourir(aPJ =>{if(lGenre===''+aPJ.genreDocJoint.GetGenre()){H.push(GChaine.composerUrlLienExterne({documentJoint:aPJ,maxWidth:250}));}});H.push('</div>');H.push('</div>');}
H.push('</div>');H.push('</section>');return H.join('');}
function _composeBlocDetailsAnnexes(aDonnees,aParams){const H=[];H.push('<section class="Bloc-details-annexes">');H.push(tag('div',{class:'flex-contain conteneur-annexe'},tag('h4',{class:'ie-titre-couleur'},GTraductions.getValeur('FenetreAnnexePedaStage.annexePedagogique')),aParams.parametres.avecEdition?tag('ie-btnicon',{class:'icon_pencil','ie-model':'modifierAnnexe',title:GTraductions.getValeur('Modifier')}):''));if(aDonnees.objectifs){H.push('  <div class="conteneur-annexe">');H.push(tag('div',{class:'Gras ie-titre-petit'},GTraductions.getValeur('FenetreAnnexePedaStage.objectifs')));H.push(tag('div',{class:''},GChaine.ToHTML(aDonnees.objectifs)));H.push(' </div>');}
if(aDonnees.activitesPrevues){H.push('  <div class="conteneur-annexe">');H.push(tag('div',{class:'Gras ie-titre-petit'},GTraductions.getValeur('FenetreAnnexePedaStage.activitesPrevues')));H.push(tag('div',{class:''},GChaine.ToHTML(aDonnees.activitesPrevues)));H.push(' </div>');}
if(aDonnees.competencesVisees){H.push('  <div class="conteneur-annexe">');H.push(tag('div',{class:'Gras ie-titre-petit'},GTraductions.getValeur('FenetreAnnexePedaStage.competencesVisees')));H.push(tag('div',{class:''},GChaine.ToHTML(aDonnees.competencesVisees)));H.push(' </div>');}
if(aDonnees.modalitesConcertation){H.push('  <div class="conteneur-annexe">');H.push(tag('div',{class:'Gras ie-titre-petit'},GTraductions.getValeur('FenetreAnnexePedaStage.modalitesConcertation')));H.push(tag('div',{class:''},GChaine.ToHTML(aDonnees.modalitesConcertation)));H.push(' </div>');}
if(aDonnees.modalitesEvaluation){H.push('  <div class="conteneur-annexe">');H.push(tag('div',{class:'Gras ie-titre-petit'},GTraductions.getValeur('FenetreAnnexePedaStage.modalitesEvaluation')));H.push(tag('div',{class:''},GChaine.ToHTML(aDonnees.modalitesEvaluation)));H.push(' </div>');}
H.push('</section>');return H.join('');}
UtilitaireFicheStage.ComposeSurSuivi=function(aDonnee,aParams){const H=[];const lSuivi=aDonnee;const lAvecEdition=aParams.parametres.avecEditionSuivisDeStage&&!!lSuivi.editable;H.push('<div class="Bloc-suivi">');if(IE.estMobile){H.push(tag('div',{class:'flex-contain conteneur-header'},tag('ie-btnicon',{class:'icon_retour_mobile','ie-model':'retourPrec',title:GTraductions.getValeur('FicheStage.listeSuivis.RetourListeSuivi')}),tag('div',{class:'ie-titre titre-suivi'},GTraductions.getValeur('FicheStage.listeSuivis.SuiviDuX',GDate.FormatDate(lSuivi.date,'%JJ/%MM/%AAAA')))));}
if(lAvecEdition){H.push(tag('div',{class:'flex-contain conteneur-icones'},tag('ie-btnicon',{class:'icon_trash','ie-model':'supprSuivi',title:GTraductions.getValeur('FicheStage.listeSuivis.MenuCtxSupprimerSuivi')}),tag('ie-btnicon',{class:!lSuivi.publier?'icon_info_sondage_publier':'icon_info_sondage_non_publier','ie-model':'publierSuivi',title:lSuivi.publier?GTraductions.getValeur('FicheStage.listeSuivis.MenuCtxPasPublierSuivi'):GTraductions.getValeur('FicheStage.listeSuivis.MenuCtxPublierSuivi')}),tag('ie-btnicon',{class:'icon_pencil','ie-model':'modifSuivi',title:GTraductions.getValeur('FicheStage.listeSuivis.MenuCtxModifierSuivi')}),tag('ie-btnicon',{class:'icon_ellipsis_vertical',id:aParams.pere+'_btnCxt','ie-model':'menuCxt'})));}
H.push('<div class="conteneur-suivi',!lAvecEdition?' margin-espace-haut':'','">',tag('div',{class:'flex-contain conteneur-info-suivi'},tag('div',{class:'m-right'},tag('div',{class:'date-contain'},GDate.FormatDate(lSuivi.date,'%JJ %MMM')),!!lSuivi.evenement.couleur?tag('div',{class:'conteneur-couleur-evenement',style:'background-color:'+lSuivi.evenement.couleur+';'}):''),tag('div',{class:'conteneur-milieu'},tag('div',{class:'ie-titre Gras'},lSuivi.evenement.GetLibelle()),tag('div',{class:'ie-titre-petit'},lSuivi.responsable),aParams.parametres.avecEditionSuivisDeStage&&lSuivi.publier?tag('div',tag('i',{class:'icon_info_sondage_publier'}),tag('span',{class:'ie-titre-petit'},GTraductions.getValeur('FicheStage.listeSuivis.etatPublication'))):'')));if(lSuivi.avecHeure||!!lSuivi.lieu){H.push(tag('div',{class:'conteneur-heure-lieu'},lSuivi.avecHeure?tag('div',{class:''},tag('span',{class:''},GTraductions.getValeur('FicheStage.listeSuivis.Heure')+' : '),tag('span',{class:'ie-titre-petit'},GDate.FormatDate(lSuivi.date,'%hh%sh%mm'))):'',!!lSuivi.lieu&&lSuivi.lieu.GetLibelle()?tag('div',{class:''},tag('span',{class:''},GTraductions.getValeur('FicheStage.listeSuivis.Lieu')+' : '),tag('span',{class:'ie-titre-petit'},lSuivi.lieu.GetLibelle())):''));}
if(lSuivi.commentaire){H.push(tag('div',{class:'conteneur-commentaire'},GChaine.ToHTML(lSuivi.commentaire)));}
if(lAvecEdition){H.push('<div class="flex-contain conteneur-pj">');H.push(tag('ie-btnicon',{class:'icon_piece_jointe','ie-model':'ajoutPJSuivi',title:GTraductions.getValeur('FicheStage.AjouterPiecesJointes')}));if(!!lSuivi.listePJ&&lSuivi.listePJ.GetNbrElements()){const lIEModelChips=_getIEModelChipsPJSuivi(lSuivi,aParams);H.push('<div>');for(let i=0,lNbr=lSuivi.listePJ.GetNbrElements();i<lNbr;i++){H.push(tag('span',{class:'chips-pj'},GChaine.composerUrlLienExterne({documentJoint:lSuivi.listePJ.GetElement(i),maxWidth:250,ieModelChips:lIEModelChips,argsIEModel:[lSuivi.listePJ.GetElement(i).GetNumero()]})));}
H.push('</div>');H.push('</div>');}} else if(lSuivi.listePJ&&lSuivi.listePJ.GetNbrElements()){H.push('<div class="conteneur-pj">');for(let i=0,lNbr=lSuivi.listePJ.GetNbrElements();i<lNbr;i++){H.push(tag('span',{class:'chips-pj'},GChaine.composerUrlLienExterne({documentJoint:lSuivi.listePJ.GetElement(i),maxWidth:250})));}
H.push('</div>');}
H.push('</div>');H.push('</div>');if(aParams.controleur){_ajoutControleurSurSuivi(lSuivi,aParams);}
return H.join('');};UtilitaireFicheStage.ComposeBlocAppreciations=function(aDonnees,aParams){const H=[];if(!!aDonnees.appreciations){aDonnees.appreciations.setTri([ObjetTri.init('Genre')]);aDonnees.appreciations.trier();if(!!aDonnees.professeur&&aDonnees.professeur.GetNbrElements()){H.push(_composeBlocAppreciationsProfs(aDonnees));}
if(!!aDonnees.maitreDeStage&&aDonnees.maitreDeStage.GetNbrElements()){H.push(_composeBlocAppreciationsMDS(aDonnees));}
_ajouterControleurEditionAppreciations(aDonnees,aParams);}
return H.join('');};function _composeBlocAppreciationsProfs(aDonnees){const H=[];const lListe=aDonnees.appreciations.getListeElements((aAppreciation) =>{return aAppreciation.GetGenre()===EGenreRessource.Enseignant;});H.push('<section class="Bloc-appreciations">');H.push(tag('h4',{class:'ie-titre-couleur'},GTraductions.getValeur('FicheStage.appreciations')));H.push(_construireAppreciations(lListe,lListe.GetNbrElements()>1?GTraductions.getValeur('FicheStage.profsReferents'):GTraductions.getValeur('FicheStage.profReferent')));H.push('</section>');return H.join('');}
function _composeBlocAppreciationsMDS(aDonnees){const H=[];const lListe=aDonnees.appreciations.getListeElements((aAppreciation) =>{return aAppreciation.GetGenre()===EGenreRessource.MaitreDeStage;});H.push('<section class="Bloc-appreciations">');H.push(_construireAppreciations(lListe,lListe.GetNbrElements()>1?GTraductions.getValeur('FicheStage.maitresDeStage'):GTraductions.getValeur('FicheStage.maitreDeStage')));H.push('</section>');return H.join('');}
function _construireAppreciations(aDonnees,aLibelle){const H=[];if(!!aDonnees&&aDonnees.GetNbrElements()){let lAvecEdition=false;aDonnees.parcourir(aAppreciation =>{if(aAppreciation.avecEditionAppreciation){lAvecEdition=true;}});H.push('<div class="conteneur-appreciation">');H.push(tag('div',{class:'flex-contain Gras ie-titre-petit'},aLibelle,lAvecEdition?tag('ie-btnicon',{class:'icon_pencil','ie-model':'modifierAppreciation',title:GTraductions.getValeur('Modifier')}):''));aDonnees.parcourir((aAppreciation) =>{H.push(tag('div',{class:'nom-auteur'},aAppreciation.GetLibelle()));H.push(tag('div',{class:'m-bottom'},aAppreciation.appreciation));});H.push('</div>');}
return H.join('');}
function _ajoutControleurEditionDetails(aDonnees,aParams){const lControleur=aParams.controleur;if(lControleur){if(!lControleur.modifierSujet){lControleur.modifierSujet={event:function(){const lInstance=this.instance;const lFenetreAnnexePedagogique=ObjetFenetre.creerInstance(ObjetFenetre_AnnexePedagogique,{pere:lInstance,evenement:function(aGenreBouton,aDonneesFenetre){if(aGenreBouton===1){aDonnees.sujetDetaille=aDonneesFenetre.sujetDetaille;aDonnees.commentaire=aDonneesFenetre.commentaire;aDonnees.SetEtat(EGenreEtat.Modification);lInstance.SetEtatSaisie(true);_requeteSaisieFicheStage.call(lInstance,{listePJ:aDonnees.listePJ,stage:aDonnees});}
lFenetreAnnexePedagogique.Fermer();},initialiser:function(aInstance){const lBoutons=aParams.parametres.avecEdition?[GTraductions.getValeur('Annuler'),GTraductions.getValeur('Valider')]:[GTraductions.getValeur('Fermer')];aInstance.setOptionsFenetre({titre:GTraductions.getValeur('Modifier'),largeur:500,listeBoutons:lBoutons});aInstance.setParametres_AnnexePedagogique({avecEdition:this.parametres.avecEdition});}});lFenetreAnnexePedagogique.SetDonnees({sujetDetaille:aDonnees.sujetDetaille,commentaire:aDonnees.commentaire},aParams.parametres);}};}
if(!lControleur.modifierAnnexe){lControleur.modifierAnnexe={event:function(){const lInstance=this.instance;const lFenetreAnnexePedagogique=ObjetFenetre.creerInstance(ObjetFenetre_AnnexePedagogique,{pere:lInstance,evenement:function(aGenreBouton,aDonneesFenetre){if(aGenreBouton===1){aDonnees.objectifs=aDonneesFenetre.objectifs;aDonnees.activitesPrevues=aDonneesFenetre.activitesPrevues;aDonnees.competencesVisees=aDonneesFenetre.competencesVisees;aDonnees.modalitesConcertation=aDonneesFenetre.modalitesConcertation;aDonnees.modalitesEvaluation=aDonneesFenetre.modalitesEvaluation;aDonnees.SetEtat(EGenreEtat.Modification);lInstance.SetEtatSaisie(true);_requeteSaisieFicheStage.call(lInstance,{listePJ:aDonnees.listePJ,stage:aDonnees});}
lFenetreAnnexePedagogique.Fermer();},initialiser:function(aInstance){const lBoutons=aParams.parametres.avecEdition?[GTraductions.getValeur('Annuler'),GTraductions.getValeur('Valider')]:[GTraductions.getValeur('Fermer')];aInstance.setOptionsFenetre({titre:GTraductions.getValeur('FenetreAnnexePedaStage.annexePedagogique'),largeur:500,listeBoutons:lBoutons});aInstance.setParametres_AnnexePedagogique({avecEdition:this.parametres.avecEdition});}});lFenetreAnnexePedagogique.SetDonnees({objectifs:aDonnees.objectifs,activitesPrevues:aDonnees.activitesPrevues,competencesVisees:aDonnees.competencesVisees,modalitesConcertation:aDonnees.modalitesConcertation,modalitesEvaluation:aDonnees.modalitesEvaluation},aParams.parametres);}};}
if(!lControleur.ajoutPJ){lControleur.ajoutPJ={event:function(){const lInstance=this.instance;afficherFenetreAjoutFichiers.call(lInstance,function(aListeFichiers){aDonnees.listePJ=aListeFichiers;_requeteSaisieFicheStage.call(lInstance,{listePJ:aListeFichiers,stage:aDonnees});});}};}}}
function _getIEModelChipsPJSuivi(aSuivi,aParams){const lControleur=aParams.controleur;if(!lControleur){return'';}
lControleur.chipsPJSuivi={eventBtn:function(aNumero){const lPieceJointe=aSuivi.listePJ.GetElementParNumero(aNumero);const lStage=aParams.stage;GApplication.getMessage().afficher({type:EGenreBoiteMessage.Confirmation,message:GTraductions.getValeur('selecteurPJ.msgConfirmPJ',lPieceJointe.GetLibelle()),callback:(function(aBouton){if(aBouton===0){const lInstance=this.instance;if(!!lPieceJointe){lPieceJointe.SetEtat(EGenreEtat.Suppression);aSuivi.SetEtat(EGenreEtat.Modification);const lListePJ=new ObjetListeElements();if(!!aSuivi.listePJ){lListePJ.FusionnerListe(aSuivi.listePJ);}
_requeteSaisieFicheStage.call(lInstance,{callbackParam:{suivi:aSuivi},listePJ:lListePJ,stage:lStage,then:function(){aSuivi.listePJ.remove(aSuivi.listePJ.GetIndiceParNumeroEtGenre(lPieceJointe.GetNumero()));}});}}}).bind(this)});}};return'chipsPJSuivi';}
function _ajoutControleurSurSuivi(aSuivi,aParams){const lControleur=aParams.controleur;const lStage=aParams.stage;if(lControleur){lControleur.supprSuivi={event:function(){const lInstance=this.instance;_supprimerSuivi.call(this,{suivi:aSuivi,stage:lStage,instance:lInstance});}};lControleur.publierSuivi={event:function(){const lInstance=this.instance;_publierSuivi.call(this,{suivi:aSuivi,stage:lStage,instance:lInstance});}};lControleur.modifSuivi={event:function(){const lInstance=this.instance;_modifierSuivi.call(this,{suivi:aSuivi,stage:lStage,instance:lInstance,evenements:aParams.evenements,lieux:aParams.lieux});}};lControleur.menuCxt={event:function(){const lInstance=this.instance;ObjetMenuContextuel.afficher({pere:this,id:aParams.pere+'_btnCxt',initCommandes:function(aMenu){aMenu.add(GTraductions.getValeur('FicheStage.listeSuivis.MenuCtxSupprimerSuivi'),true,function(){_supprimerSuivi.call(this,{suivi:aSuivi,stage:lStage,instance:lInstance});}.bind(this),{icon:'icon_trash'});const lLibellePublication=aSuivi.publier?GTraductions.getValeur('FicheStage.listeSuivis.MenuCtxPasPublierSuivi'):GTraductions.getValeur('FicheStage.listeSuivis.MenuCtxPublierSuivi');aMenu.add(lLibellePublication,true,function(){_publierSuivi.call(this,{suivi:aSuivi,stage:lStage,instance:lInstance});}.bind(this),{icon:aSuivi.publier?'icon_info_sondage_non_publier':'icon_info_sondage_publier'});aMenu.add(GTraductions.getValeur('FicheStage.listeSuivis.MenuCtxModifierSuivi'),true,function(){_modifierSuivi.call(this,{suivi:aSuivi,stage:lStage,instance:lInstance,evenements:aParams.evenements,lieux:aParams.lieux});}.bind(this),{icon:'icon_pencil'});}});}};lControleur.ajoutPJSuivi={event:function(){const lInstance=this.instance;afficherFenetreAjoutFichiers.call(lInstance,function(aListeFichiers){if(!!aSuivi.listePJ){aListeFichiers.parcourir(function(aPJ){aSuivi.listePJ.add(aPJ);});} else{aSuivi.listePJ=aListeFichiers;}
aSuivi.SetEtat(EGenreEtat.Modification);_requeteSaisieFicheStage.call(lInstance,{callbackParam:{suivi:aSuivi},listePJ:aListeFichiers,stage:lStage});});}};}}
function _ajouterControleurEditionAppreciations(aDonnees,aParams){const lControleur=aParams.controleur;if(lControleur){if(!lControleur.modifierAppreciation){lControleur.modifierAppreciation={event:function(){const lInstance=this.instance;const lFenetre=ObjetFenetre.creerInstance(ObjetFenetre_AppreciationsStage,{pere:lInstance,evenement:function(aGenreBouton,aDonneesFenetre){if(aGenreBouton===1){let lAvecModif=false;aDonneesFenetre.parcourir((aAppreciation) =>{const lAppreciation=aDonnees.appreciations.GetElementParNumero(aAppreciation.GetNumero());if(lAppreciation&&lAppreciation.appreciation!==aAppreciation.appreciation){lAppreciation.appreciation=aAppreciation.appreciation;lAppreciation.SetEtat(EGenreEtat.Modification);lAvecModif=true;}});if(lAvecModif){aDonnees.SetEtat(EGenreEtat.Modification);lInstance.SetEtatSaisie(true);_requeteSaisieFicheStage.call(lInstance,{listePJ:aDonnees.listePJ,stage:aDonnees});}}
lFenetre.Fermer();},initialiser:function(aInstance){const lBoutons=[GTraductions.getValeur('Annuler'),GTraductions.getValeur('Valider')];aInstance.setOptionsFenetre({titre:GTraductions.getValeur('Modifier'),largeur:500,listeBoutons:lBoutons});}});lFenetre.SetDonnees(aDonnees.appreciations);}};}}}
function afficherFenetreAjoutFichiers(aCallbackSurValidation){let lThis=this;let lObjetFenetreAjoutMultiple=ObjetFenetre.creerInstance(ObjetFenetre_UploadFichiers,{pere:lThis,evenement:function(aGenreBouton,aListeFichiers){if(aGenreBouton===EGenreAction.Valider){if(!!aCallbackSurValidation){aCallbackSurValidation.call(lThis,aListeFichiers);}}
lObjetFenetreAjoutMultiple.Fermer();}});lObjetFenetreAjoutMultiple.setDonnees(EGenreRessource.DocumentJoint,{tailleMaxUploadFichier:GApplication.droits.get(TypeDroits.tailleMaxDocJointEtablissement)});lObjetFenetreAjoutMultiple.afficher();}
UtilitaireFicheStage.composeFenetreCreerSuivi=function(aThis){const lSuivi=_creerNouveauSuivi();const lFenetreSuiviStage=ObjetFenetre.creerInstance(ObjetFenetre_SuiviStage,{pere:aThis,evenement:function(aNumeroBouton,aSuiviModifie,aListePJ){if(aNumeroBouton===EGenreAction.Valider){if(aSuiviModifie.Etat===EGenreEtat.Creation&&aSuiviModifie){aThis.donnees.suiviStage.AddElement(aSuiviModifie);}
if(!!aSuiviModifie){_requeteSaisieFicheStage.call(aThis,{callbackParam:{suivi:aSuiviModifie},listePJ:aListePJ,stage:aThis.donnees});}}
lFenetreSuiviStage.Fermer();},initialiser:function(aInstance){aInstance.setOptionsFenetre({titre:GTraductions.getValeur('FenetreSuiviStage.CreerSuivi')});aInstance.setParametresFenetreSuivi({libellePublication:GTraductions.getValeur('FicheStage.listeSuivis.hintPublication'),maxSizeDocumentJoint:GApplication.droits.get(TypeDroits.tailleMaxDocJointEtablissement)});}});const lListePJEleves=new ObjetListeElements();if(!!lSuivi.listePJ){lListePJEleves.FusionnerListe(lSuivi.listePJ);}
lFenetreSuiviStage.SetDonnees({suivi:lSuivi,evenements:aThis.evenements,lieux:aThis.lieux,listePJEleve:lListePJEleves});};function _creerNouveauSuivi(){const lNouveauSuivi=new ObjetElement();lNouveauSuivi.date=GDate.getDateCourante();lNouveauSuivi.avecSaisiePossible=true;lNouveauSuivi.SetEtat(EGenreEtat.Creation);return lNouveauSuivi;}
function _supprimerSuivi(aParams){const lSuivi=aParams.suivi,lInstance=aParams.instance,lStage=aParams.stage;GApplication.getMessage().afficher({type:EGenreBoiteMessage.Confirmation,message:GTraductions.getValeur('FicheStage.listeSuivis.MsgConfirmSuppSuivi')}).then(function(aGenreAction){if(aGenreAction===EGenreAction.Valider){lSuivi.SetEtat(EGenreEtat.Suppression);_requeteSaisieFicheStage.call(lInstance,{listePJ:lStage.listePJ,stage:lStage});}}.bind(this));}
function _publierSuivi(aParams){const lSuivi=aParams.suivi,lInstance=aParams.instance,lStage=aParams.stage;lSuivi.publier=!lSuivi.publier;lSuivi.SetEtat(EGenreEtat.Modification);_requeteSaisieFicheStage.call(lInstance,{callbackParam:{suivi:lSuivi},listePJ:lStage.listePJ,stage:lStage});}
function _modifierSuivi(aParams){const lSuivi=aParams.suivi,lInstance=aParams.instance,lStage=aParams.stage;const lFenetreSuiviStage=ObjetFenetre.creerInstance(ObjetFenetre_SuiviStage,{pere:lInstance,evenement:function(aNumeroBouton,aSuiviModifie){if(aNumeroBouton===EGenreAction.Valider){if(lSuivi){const lIndiceSuiviConcerne=lStage.suiviStage.GetIndiceParNumeroEtGenre(aSuiviModifie.GetNumero());lStage.suiviStage.AddElement(aSuiviModifie,lIndiceSuiviConcerne);}
if(!!aSuiviModifie){Object.assign(lSuivi,aSuiviModifie);const lListePJ=new ObjetListeElements();if(!!lSuivi.listePJ){lSuivi.listePJ.parcourir(function(aPJ){if(aPJ.Etat!==EGenreEtat.Suppression){lListePJ.add(aPJ);}});}
lSuivi.listePJ=lListePJ;_requeteSaisieFicheStage.call(lInstance,{callbackParam:{suivi:lSuivi},listePJ:aSuiviModifie.listePJ,stage:lStage});}}
lFenetreSuiviStage.Fermer();},initialiser:function(aInstance){aInstance.setOptionsFenetre({titre:GTraductions.getValeur('FenetreSuiviStage.ModifierSuivi')});aInstance.setParametresFenetreSuivi({libellePublication:GTraductions.getValeur('FicheStage.listeSuivis.hintPublication'),maxSizeDocumentJoint:GApplication.droits.get(TypeDroits.tailleMaxDocJointEtablissement)});}});const lListePJ=new ObjetListeElements();if(!!lSuivi.listePJ){lListePJ.FusionnerListe(lSuivi.listePJ);}
lFenetreSuiviStage.SetDonnees({suivi:lSuivi,evenements:aParams.evenements,lieux:aParams.lieux,listePJEleve:lListePJ});}
function _requeteSaisieFicheStage(aParams){new ObjetRequeteSaisieAppreciationFinDeStage(this).addUpload({listeFichiers:aParams.listePJ}).lancerRequete({numEleve:aParams.stage.numeroEleve,stage:aParams.stage,appreciations:aParams.stage.appreciations,listePJ:aParams.listePJ}).then(function(){if(!!aParams.then){aParams.then();}
this.ActionSurValidation(aParams.callbackParam);}.bind(this));}
module.exports=UtilitaireFicheStage;},fn:"utilitairefichestage.js"});;
IE.fModule({f:function(exports,require,module,global){const ObjetDonneesListeFlatDesign=require('ObjetDonneesListeFlatDesign.js');const{GDate}=require('ObjetDate.js');const GTraductions=require('ObjetTraduction.js');const tag=require('tag.js');class DonneesListe_SuiviStage extends ObjetDonneesListeFlatDesign{constructor(aDonnees,aParametres){super(aDonnees);this.parametres=aParametres;this.setOptions({avecSelection:true,avecEdition:false,avecSuppression:false,avecEvnt_Selection:true,flatDesignMinimal:true,avecBoutonActionLigne:false});}
AvecMenuContextuel(){return false;}
getClassCelluleConteneur(){return'AvecMain';}
getZoneGauche(aParams){const H=[];const lSuivi=aParams.article;H.push(tag('div',{class:''},tag('time',{class:'date-contain'},GDate.FormatDate(lSuivi.date,'%JJ %MMM')),!!lSuivi.evenement.couleur?tag('div',{class:'conteneur-couleur-evenement',style:'background-color:'+lSuivi.evenement.couleur+';'}):''));return H.join('');}
getTitreZonePrincipale(aParams){const lSuivi=aParams.article;return tag('div',{class:'ie-titre Gras'},lSuivi.evenement.GetLibelle());}
getInfosSuppZonePrincipale(aParams){const lSuivi=aParams.article;return tag('div',{class:'ie-titre-petit'},(!!lSuivi.strResponsable?lSuivi.strResponsable:'')+(!!lSuivi.responsable?lSuivi.responsable:'')+_getStringStatut(lSuivi));}
getZoneMessage(aParams){const lSuivi=aParams.article;return tag('div',{class:'conteneur-commentaire-court'},lSuivi.commentaire);}
getZoneComplementaire(aParams){const H=[];const lSuivi=aParams.article;H.push(lSuivi.avecHeure?tag('div',{class:'conteneur-heure'},GDate.FormatDate(lSuivi.date,'%hh%sh%mm')):'',tag('div',{class:'flex-contain'},!!lSuivi.listePJ&&lSuivi.listePJ.GetNbrElements()?tag('i',{class:'icon_piece_jointe'}):'',this.parametres.avecEditionSuivisDeStage&&!!lSuivi.editable?tag('i',{class:lSuivi.publier?'icon_info_sondage_publier':'icon_info_sondage_non_publier'}):''));return H.join('');}}
function _getStringStatut(aSuivi){if(!aSuivi){return'';}
if(aSuivi.estMaitreDeStage){return' ('+GTraductions.getValeur('FicheStage.maitreDeStage')+')';} else if(aSuivi.estMaitreOuTuteur){return' ('+GTraductions.getValeur('FicheStage.maitreOuTuteur')+')';} else if(aSuivi.estTuteur){return' ('+GTraductions.getValeur('FicheStage.enseignTuteur')+')';} else if(aSuivi.estResponsable){return' ('+GTraductions.getValeur('FicheStage.enseignResp')+')';} else{return'';}}
module.exports=DonneesListe_SuiviStage;},fn:"donneesliste_suivistage.js"});;
IE.fModule({f:function(exports,require,module,global){const PageFicheStageCP_Mobile=require('PageFicheStageCP_Mobile.js');const UtilitaireFicheStage=require('UtilitaireFicheStage.js');const tag=require('tag.js');const GTraductions=require('ObjetTraduction.js');const ObjetListe=require('ObjetListe.js');const DonneesListe_SuiviStage=require('DonneesListe_SuiviStage.js');const EGenreEvenementListe=require('Enumere_EvenementListe.js');const Identite=require('ObjetIdentite.js');const{EGenreAffichageFicheStage}=require('Enumere_AffichageFicheStage.js');const ObjetFenetre=require('ObjetFenetre.js');class PageFicheStage_Mobile extends PageFicheStageCP_Mobile{constructor(...aParams){super(...aParams);}
creerInstanceListeSuivis(){return Identite.creerInstance(ObjetListe,{pere:this,evenement:_evenementListeSuivis.bind(this)});}
initialiserListeSuivis(){this.instanceListeSuivis.Initialiser();this.instanceListeSuivis.setOptionsListe({colonnes:[{id:'PageFicheStageMobile_ListeSuivis',taille:'100%'}],skin:ObjetListe.skin.flatDesign,messageContenuVide:GTraductions.getValeur('FicheStage.listeSuivis.AucunSuivi'),avecOmbreDroite:true,hauteurZoneContenuListeMin:200,avecLigneCreation:this.parametres.avecEditionSuivisDeStage,titreCreation:GTraductions.getValeur('FenetreSuiviStage.NouveauSuivi')}).SetDonnees(new DonneesListe_SuiviStage(this.donnees.suiviStage,this.parametres));}
getControleur(aInstance){return $.extend(true,super.getControleur(this),{getInfoConvention:{event:function(){const T=[];let lIcon='';if(aInstance.donnees.conventionSigneeEleve){lIcon='icon_ok';} else{lIcon='icon_remove';}
T.push(tag('div',tag('i',{class:lIcon}),GTraductions.getValeur('FicheStage.parEleve')));if(aInstance.donnees.conventionSigneeEntreprise){lIcon='icon_ok';} else{lIcon='icon_remove';}
T.push(tag('div',tag('i',{class:lIcon}),GTraductions.getValeur('FicheStage.parEntreprise')));if(aInstance.donnees.conventionSigneeEtablissement){lIcon='icon_ok';} else{lIcon='icon_remove';}
T.push(tag('div',tag('i',{class:lIcon}),GTraductions.getValeur('FicheStage.parEtablissement')));_getInfoConvention.call(aInstance,tag('div',{class:'hint-convention'},T.join('')));}}});}
ConstruireAffichage(){const H=[];switch(this.selectOngletStage){case EGenreAffichageFicheStage.Entreprise:H.push('<div class="conteneur-FicheStage">');H.push(UtilitaireFicheStage.ComposeBlocEntreprise(this.donnees,{controleur:this.controleur}));H.push('</div>');break;case EGenreAffichageFicheStage.Details:H.push('<div class="conteneur-FicheStage">');H.push(UtilitaireFicheStage.ComposeBlocDetails(this.donnees,{parametres:this.parametres,controleur:this.controleur}));H.push('</div>');break;case EGenreAffichageFicheStage.Suivi:{let lConventionEtiquette='';let lCpt=0;if(this.donnees.conventionSigneeEleve){lCpt++;}
if(this.donnees.conventionSigneeEntreprise){lCpt++;}
if(this.donnees.conventionSigneeEtablissement){lCpt++;}
if(lCpt>0){lConventionEtiquette=tag('ie-chips',{class:'tag-style color-theme'},GTraductions.getValeur('FicheStage.conventionSignee')+' '+lCpt+'/3')+tag('ie-btnicon',{class:'icon_question avecFond','ie-model':'getInfoConvention'});} else{lConventionEtiquette=tag('ie-chips',{class:'tag-style'},GTraductions.getValeur('FicheStage.conventionNonSignee'));}
H.push(tag('div',{class:'onglet-suivi'},tag('div',{class:'conteneur-convention'},lConventionEtiquette),tag('div',{class:'conteneur-liste-suivi',id:this.instanceListeSuivis.GetNom()})));break;}
case EGenreAffichageFicheStage.Appreciations:H.push('<div class="conteneur-FicheStage">');H.push(UtilitaireFicheStage.ComposeBlocAppreciations(this.donnees,{parametres:this.parametres,controleur:this.controleur}));H.push('</div>');break;default:break;}
return H.join('');}
ActionSurValidation(){this.callback.appel();}}
function _evenementListeSuivis(aParams){switch(aParams.genreEvenement){case EGenreEvenementListe.Creation:UtilitaireFicheStage.composeFenetreCreerSuivi(this);break;case EGenreEvenementListe.Selection:this.suivi=aParams.article;this.callback.appel({suivi:this.suivi});break;}}
function _getInfoConvention(aHtml){const lFenetre=ObjetFenetre.creerInstance(ObjetFenetre,{pere:this,initialiser:function(aInstance){aInstance.setOptionsFenetre({titre:GTraductions.getValeur('FicheStage.conventionSignee')});}});lFenetre.Afficher(aHtml);}
module.exports=PageFicheStage_Mobile;},fn:"pagefichestage_mobile.js"});;
IE.fModule({f:function(exports,require,module,global){const ObjetIdentite_Mobile=require('ObjetIdentite_Mobile.js');const UtilitaireFicheStage=require('UtilitaireFicheStage.js');require('PageFicheStage.css');class PageSuiviStage_Mobile extends ObjetIdentite_Mobile{constructor(...aParams){super(...aParams);this.initParametres();}
initParametres(){this.parametres={avecEditionSuivisDeStage:false};}
setParametres(aParametres){$.extend(this.parametres,aParametres);}
getControleur(aInstance){return $.extend(true,super.getControleur(this),{retourPrec:{event:function(){aInstance.callback.appel();}}});}
SetDonnees(aSuivi,aStage,aParam){this.suivi=aSuivi;this.stage=aStage;this.evenements=aParam.evenements,this.lieux=aParam.lieux,this.controleur={};this.controleur=this.getControleur(this);this.Afficher();}
ConstruireAffichage(){const H=[];if(this.suivi){H.push('<div class="conteneur-FicheStage">');H.push(UtilitaireFicheStage.ComposeSurSuivi(this.suivi,{parametres:this.parametres,controleur:this.controleur,stage:this.stage,evenements:this.evenements,lieux:this.lieux,pere:this.Nom}));H.push('</div>');}
return H.join('');}
ActionSurValidation(aParamCallBack){if(aParamCallBack){this.callback.appel({suivi:aParamCallBack.suivi,stage:this.stage});} else{this.callback.appel();}}}
module.exports=PageSuiviStage_Mobile;},fn:"pagesuivistage_mobile.js"});;
IE.fModule({f:function(exports,require,module,global){const{ObjetRequeteConsultation}=require('ObjetRequeteJSON.js');const Requetes=require('CollectionRequetes.js');const ObjetElement=require('ObjetElement.js');class ObjetRequetePageStageGeneral extends ObjetRequeteConsultation{constructor(...aParams){super(...aParams);}
lancerRequete(aNumeroEleve){this.JSON.Eleve=new ObjetElement('',aNumeroEleve);return this.appelAsynchrone();}
actionApresRequete(){const lListeStages=this.JSONReponse.Stages;const lListeEvenements=this.JSONReponse.Evenements;lListeEvenements.parcourir(function(D){if(!D.couleur){D.couleur=GCouleur.blanc;}
D.libelleHtml=`<span class="colored-square-libelle" style="--colour-square : ${D.couleur}">${D.GetLibelle()}</span>`;});const lListeLieux=this.JSONReponse.Lieux;lListeLieux.AddElement(new ObjetElement('',0));lListeLieux.trier();const lAvecEditionAnnexePedagogique=!!this.JSONReponse.AvecEditionAnnexePedagogique;this.callbackReussite.appel(lListeStages,lListeEvenements,lListeLieux,lAvecEditionAnnexePedagogique);}}
Requetes.inscrire('PageStage.General',ObjetRequetePageStageGeneral);module.exports=ObjetRequetePageStageGeneral;},fn:"objetrequetepagestagegeneral.js"});;
IE.fModule({f:function(exports,require,module,global){const{ObjetRequeteConsultation}=require('ObjetRequeteJSON.js');const Requetes=require('CollectionRequetes.js');const ObjetElement=require('ObjetElement.js');const ObjetListeElements=require('ObjetListeElements.js');const ObjetTri=require('ObjetTri.js');class ObjetRequetePageAppreciationFinDeStage extends ObjetRequeteConsultation{constructor(...aParams){super(...aParams);}
actionApresRequete(){const lStage=this.JSONReponse.stage?this.JSONReponse.stage:null;if(!!lStage){lStage.appreciations=new ObjetListeElements();lStage.maitreDeStage.parcourir(function(aMaitreDeStage){const lElmAppreciation=new ObjetElement(aMaitreDeStage.Libelle,aMaitreDeStage.Numero,aMaitreDeStage.Genre);lElmAppreciation.avecEditionAppreciation=aMaitreDeStage.avecEditionAppreciation;lElmAppreciation.appreciation=aMaitreDeStage.appreciation;lStage.appreciations.AddElement(lElmAppreciation);});lStage.maitreDeStage.trier();lStage.professeur.parcourir(function(aProfesseur){const lElmAppreciation=new ObjetElement(aProfesseur.Libelle,aProfesseur.Numero,aProfesseur.Genre);lElmAppreciation.avecEditionAppreciation=aProfesseur.avecEditionAppreciation;lElmAppreciation.appreciation=aProfesseur.appreciation;lStage.appreciations.AddElement(lElmAppreciation);});lStage.professeur.trier();lStage.suiviStage.setTri([ObjetTri.init('date'),ObjetTri.init('Libelle'),ObjetTri.init('Numero')]);lStage.suiviStage.trier();}
const lListePJEleve=this.JSONReponse.listeDJEleve?this.JSONReponse.listeDJEleve:new ObjetListeElements();this.callbackReussite.appel({stage:lStage,listePJEleve:lListePJEleve});}}
Requetes.inscrire('PageAppreciationFinDeStage',ObjetRequetePageAppreciationFinDeStage);module.exports=ObjetRequetePageAppreciationFinDeStage;},fn:"objetrequetepageappreciationfindestage.js"});;
IE.fModule({f:function(exports,require,module,global){const{ObjetRequeteConsultation}=require('ObjetRequeteJSON.js');const Requetes=require('CollectionRequetes.js');const ObjetElement=require('ObjetElement.js');const ObjetListeElements=require('ObjetListeElements.js');class ObjetRequeteListeServices extends ObjetRequeteConsultation{constructor(...aParams){super(...aParams);}
lancerRequete(aUtilisateur,aRessource,aPeriode,aEleve,aPilier){this.JSON={Professeur:aUtilisateur,Ressource:aRessource,Periode:aPeriode,Eleve:aEleve,Pilier:aPilier};return this.appelAsynchrone();}
actionApresRequete(){const lListeServices=new ObjetListeElements();this.JSONReponse.services.parcourir(_ajouterServices.bind(null,lListeServices,true));this.callbackReussite.appel(lListeServices);}}
Requetes.inscrire('ListeServices',ObjetRequeteListeServices);function _ajouterServices(aListe,aEstService,aElement){aElement.estUnService=aEstService;if(!aElement.classe){aElement.classe=new ObjetElement('');}
if(!aElement.groupe){aElement.groupe=new ObjetElement('');}
aListe.AddElement(aElement);if(aElement.services){aElement.services.parcourir(_ajouterServices.bind(null,aListe,false));}}
module.exports=ObjetRequeteListeServices;},fn:"objetrequetelisteservices.js"});;
IE.fModule({f:function(exports,require,module,global){const{ObjetRequeteConsultation}=require('ObjetRequeteJSON.js');const EGenreRessource=require('Enumere_Ressource.js');const Requetes=require('CollectionRequetes.js');const ObjetElement=require('ObjetElement.js');const ObjetListeElements=require('ObjetListeElements.js');const GTraductions=require('ObjetTraduction.js');const ObjetTri=require('ObjetTri.js');const ObjetRequeteListeServices=require('ObjetRequeteListeServices.js');const EGenreMessage=require('Enumere_Message.js');const{GDate}=require('ObjetDate.js');const EGenreTriElement=require('Enumere_TriElement.js');const GImage=require('ObjetImage.js');const EGenreEspace=require('Enumere_Espace.js');const MethodesTableau=require('MethodesTableau.js');const EGenreOnglet=require('Enumere_Onglet.js');const MethodesObjet=require('MethodesObjet.js');Requetes.inscrire('listeClassesGroupes',ObjetRequeteConsultation);Requetes.inscrire('ListePeriodes',ObjetRequeteConsultation);Requetes.inscrire('ListeEleves',ObjetRequeteConsultation);class MoteurSelectionContexte{constructor(){this.selection={classe:null};}
getListeClasses(aParam){if(MethodesTableau.existe(GEtatUtilisateur.GenreEspace,[EGenreEspace.Mobile_Etablissement,EGenreEspace.Mobile_Administrateur])){_actionSurGetListeClasses.call(this,aParam);} else{Requetes('listeClassesGroupes',this,function(aJSON){_actionSurGetListeClasses.call(this,aParam,aJSON);}.bind(this)).lancerRequete();}}
getListePeriodes(aParam){Requetes('ListePeriodes',this,function(aXML){const lListePeriodes=_actionSurGetListePeriodes.call(this,aXML);if(!!lListePeriodes){const lParamClbck={listeElts:lListePeriodes};aParam.clbck.call(aParam.pere,lParamClbck);}}.bind(this)).lancerRequete({ressource:aParam.classe});}
getListeServices(aParam){new ObjetRequeteListeServices(this,function(aXML){const lListeServices=_actionSurGetListeServices.call(this,aXML);if(!!lListeServices){const lDefault=_getServiceParDefaut.call(this,lListeServices,{classe:aParam.classe});const lIndiceDefault=lListeServices.GetIndiceParElement(lDefault);const lParamClbck={listeElts:lListeServices,indiceEltParDefaut:lIndiceDefault};aParam.clbck.call(aParam.pere,lParamClbck);}}.bind(this)).lancerRequete(aParam.utilisateur,aParam.classe,aParam.periode);}
getListeEleves(aParam){GEtatUtilisateur.Navigation.SetRessource(EGenreRessource.Classe,aParam.classe);Requetes('ListeEleves',this,function(aJSON){const lListeEleves=_actionSurRequeteListeEleves.call(this,aParam,aJSON);if(!!lListeEleves){const lParamClbck={listeElts:lListeEleves};aParam.clbck.call(aParam.pere,lParamClbck);}}.bind(this)).lancerRequete({ressource:aParam.classe,listeRessources:GEtatUtilisateur.Navigation.getRessources(EGenreRessource.Classe).setSerialisateurJSON({ignorerEtatsElements:true})});}
getLibelleMenu(aParam){switch(aParam.genreRessource){case(EGenreRessource.Classe):return(aParam.avecGroupe===true)?GTraductions.getValeur('competences.ClasseGroupe'):GTraductions.getValeur('Classe');case(EGenreRessource.Matiere):return GTraductions.getValeur('Matiere');case(EGenreRessource.Periode):return GTraductions.getValeur('Periode');case(EGenreRessource.Pilier):return GTraductions.getValeur('Competence');case(EGenreRessource.Service):return GTraductions.getValeur('Service');case(EGenreRessource.Eleve):return GTraductions.getValeur('Eleve');case(EGenreRessource.Competence):return GTraductions.getValeur('Competence');case(EGenreRessource.Appreciation):return GTraductions.getValeur('Appreciation');case(EGenreRessource.DisciplineLivretScolaire):return GTraductions.getValeur('Discipline');case(EGenreRessource.Palier):return GTraductions.getValeur('competences.palier');case(EGenreRessource.Salle):return GTraductions.getValeur('Salle');case(EGenreRessource.Enseignant):return GTraductions.getValeur('Professeur');case(EGenreRessource.Personnel):return GTraductions.getValeur('Personnel');case EGenreRessource.Materiel:return GTraductions.getValeur('Materiel');default:return null;}}
getGenreMessageAucunElement(aGenreRessource){switch(aGenreRessource){case(EGenreRessource.Classe):return EGenreMessage.AucuneClasseDisponible;case(EGenreRessource.Matiere):return EGenreMessage.AucunMatiere;case(EGenreRessource.Periode):return EGenreMessage.AucunePeriodes;case(EGenreRessource.Pilier):return null;case(EGenreRessource.Service):return EGenreMessage.AucunService;case(EGenreRessource.Eleve):{const lRessource=GEtatUtilisateur.Navigation.GetRessource(EGenreRessource.Classe);return lRessource&&lRessource.GetGenre()===EGenreRessource.Groupe?EGenreMessage.AucunElevePourGroupe:EGenreMessage.AucunElevePourClasse;}
case(EGenreRessource.Appreciation):return EGenreMessage.AucunAppreciation;case(EGenreRessource.DisciplineLivretScolaire):return EGenreMessage.AucuneDiciplineLivret;case(EGenreRessource.Palier):return EGenreMessage.AucunPalier;case(EGenreRessource.Salle):return EGenreMessage.AucuneSalleDisponible;case EGenreRessource.Enseignant:case EGenreRessource.Personnel:return null;case EGenreRessource.Materiel:return EGenreMessage.AucunMaterielDisponible;default:return null;}}
remplirSelecteur(aParam){const lListe=aParam.listeElts;aParam.instance.SetDonnees(lListe,aParam.indiceEltParDefaut);const lCombo=aParam.instance.getCombo();lCombo.SetActif(true);if(!lListe||lListe.GetNbrElements()===0){const lGenreMessageAucunElement=this.getGenreMessageAucunElement(aParam.genreRessource);const lMsg=lGenreMessageAucunElement?GTraductions.getValeur('Message')[lGenreMessageAucunElement]:'';aParam.clbck.call(aParam.pere,lMsg);const lLibelle=this.getLibelleMenu({genreRessource:aParam.genreRessource,avecGroupe:true});lCombo.setOptions_ObjetSaisie({placeHolder:lLibelle});lCombo.SetActif(false);}}
formatterListeCours(aParam){const lListeCours=aParam.listeCours;const lGenreTri=(aParam.genreTri!==undefined)&&(aParam.genreTri!==null)?aParam.genreTri:EGenreTriElement.Decroissant;if(lListeCours.GetNbrElements()>0){for(let i=0,lNbr=lListeCours.GetNbrElements();i<lNbr;i++){const lElementCours=lListeCours.GetElement(i);const lDateDebut=GDate.PlaceAnnuelleEnDate(lElementCours.Debut,false);const lDateFin=GDate.PlaceAnnuelleEnDate(lElementCours.Fin,true);lElementCours.dateDebut=new Date(lElementCours.DateDuCours.getFullYear(),lElementCours.DateDuCours.getMonth(),lElementCours.DateDuCours.getDate(),lDateDebut.getHours(),lDateDebut.getMinutes(),lDateDebut.getSeconds(),lDateDebut.getMilliseconds());lElementCours.dateFin=new Date(lElementCours.DateDuCours.getFullYear(),lElementCours.DateDuCours.getMonth(),lElementCours.DateDuCours.getDate(),lDateFin.getHours(),lDateFin.getMinutes(),lDateFin.getSeconds(),lDateFin.getMilliseconds());lElementCours.Libelle=GDate.FormatDate(lElementCours.DateDuCours,`[%JJJ %J %MMM]`)+' '+
GDate.FormatDate(lDateDebut,GTraductions.getValeur('De')+' %hh:%mm')+' '+
GDate.FormatDate(lDateFin,GTraductions.getValeur('A')+' %hh:%mm');const lPublics=[];for(let J=0;J<lElementCours.ListeContenus.GetNbrElements();J++){const lElementContenu=lElementCours.ListeContenus.GetElement(J);const lGenre=lElementContenu.GetGenre();switch(lGenre){case EGenreRessource.Classe:case EGenreRessource.PartieDeClasse:case EGenreRessource.Groupe:lPublics.push(lElementContenu.GetLibelle());break;}}
lElementCours.classe=lPublics.join(', ');lElementCours.sousTitre=(lElementCours.classe?lElementCours.classe:'')+(lElementCours.estSortiePedagogique?' - '+GTraductions.getValeur('EDT.AbsRess.SortiePedagogique'):'')+(lElementCours.matiere&&lElementCours.matiere.GetLibelle()?' - '+lElementCours.matiere.GetLibelle():'')+(lElementCours.NomImageAppelFait?' '+'<div class="InlineBlock AlignementMilieuVertical">'+GImage.composeImage('Image_'+lElementCours.NomImageAppelFait,16)+'</div>':'');}
lListeCours.setTri([ObjetTri.init('DateDuCours',lGenreTri),ObjetTri.init('Debut',lGenreTri)]);lListeCours.trier();return lListeCours;}}}
function _actionSurGetListeClasses(aParam,aJSON){const lListeClasse=MethodesTableau.existe(GEtatUtilisateur.GenreEspace,[EGenreEspace.Mobile_Etablissement,EGenreEspace.Mobile_Administrateur])?GEtatUtilisateur.getListeClasses({avecClasse:true,avecGroupe:true,uniquementClasseEnseignee:true}):aJSON.listeClassesGroupes;const lAvecMesServices=MethodesTableau.existe(GEtatUtilisateur.GenreEspace,[
EGenreEspace.Mobile_Professeur
])&&MethodesTableau.existe(GEtatUtilisateur.getGenreOnglet(),[
EGenreOnglet.SaisieNotes
]);const lListe=new ObjetListeElements();let lGenre;let lAvecClasse=false;let lAvecGroupe=false;for(let I=0;I<lListeClasse.GetNbrElements();I++){lGenre=lListeClasse.GetGenre(I);if(lGenre===EGenreRessource.Classe){lAvecClasse=true;}
if(lGenre===EGenreRessource.Groupe){lAvecGroupe=true;}}
lListe.FusionnerListe(lListeClasse);if(lAvecMesServices){const lMesServices=new ObjetElement(GTraductions.getValeur('MesServices'),-1,EGenreRessource.Aucune,null);lMesServices.AvecSelection=true;lListe.AddElement(lMesServices);}
if(lAvecClasse&&lAvecGroupe){let lElement=new ObjetElement(GTraductions.getValeur('Classe'),-1,EGenreRessource.Classe,null);lElement.AvecSelection=false;lListe.AddElement(lElement);lElement=new ObjetElement(GTraductions.getValeur('Groupe'),-1,EGenreRessource.Groupe,null);lElement.AvecSelection=false;lListe.AddElement(lElement);}
lListe.setTri([
ObjetTri.init(function(D){return D.GetGenre()!==EGenreRessource.Aucune;}),ObjetTri.init(function(D){return D.GetNumero()!==0;}),ObjetTri.init(function(D){return D.GetGenre()!==EGenreRessource.Classe;}),ObjetTri.init(function(D){return D.GetNumero()!== -1;}),ObjetTri.init('Libelle')
]);lListe.trier();if(!!lListe){const lDefault=_getClasseParDefaut.call(this,lListe);const lIndiceDefault=lListe.GetIndiceParElement(lDefault);const lParamClbck={listeElts:lListe,indiceEltParDefaut:lIndiceDefault};aParam.clbck.call(aParam.pere,lParamClbck);}
return lListe;}
function _getClasseParDefaut(aListeClasses){let lClasse=null;if((this.selection.classe!==null)&&(this.selection.classe!==undefined)){lClasse=aListeClasses.GetElementParNumero(this.selection.classe.GetNumero());}
if((lClasse!==null)&&(lClasse!==undefined)){return lClasse;}
aListeClasses.parcourir(function(aElement){if((aElement.GetNumero()!==0)&&(aElement.GetNumero()!== -1)){lClasse=aElement;return false;}});return lClasse;}
function _actionSurGetListePeriodes(aXml){return aXml.listePeriodes;}
function _getServiceParDefaut(aListeServices,aParam){let lServiceParDefaut=null;const lRessource=aParam.classe;aListeServices.parcourir(function(aElement){if(aElement._estSurProfesseur){if(!lServiceParDefaut||aElement.estUnService){if(!lServiceParDefaut||!(lRessource.GetGenre()===EGenreRessource.Classe&&aElement._estServicePartie)){lServiceParDefaut=aElement;}}}});return lServiceParDefaut;}
function _actionSurGetListeServices(aListeServices){const lListe=aListeServices;let lServicePere=null;lListe.parcourir(function(aElement){const lLibelleClasse=aElement.classe.GetLibelle();const lLibelleGroupe=aElement.groupe.GetLibelle();const lLibelleClasseGroupe=lLibelleClasse+(lLibelleClasse&&lLibelleGroupe?' > ':'')+lLibelleGroupe;let lLibelleProfesseurs=[];let lEstSurProfesseur=false;for(let I=0;aElement.listeProfesseurs&&I<aElement.listeProfesseurs.GetNbrElements();I++){lLibelleProfesseurs.push(aElement.listeProfesseurs.GetLibelle(I));if(aElement.listeProfesseurs.GetNumero(I)===GEtatUtilisateur.getUtilisateur().GetNumero()){lEstSurProfesseur=true;}}
lLibelleProfesseurs=lLibelleProfesseurs.join('<br>');aElement._libelleClasseGroupe=lLibelleClasseGroupe;aElement._libelleProfesseurs=lLibelleProfesseurs;aElement._estSurProfesseur=lEstSurProfesseur;if(aElement.estUnService){lServicePere=aElement;} else{aElement.pere=lServicePere;aElement.SetLibelle('&nbsp;&nbsp;&nbsp;&nbsp;'+aElement.GetLibelle());}
const T=[];T.push(lLibelleClasseGroupe,' - ',lLibelleProfesseurs);aElement.sousTitre=T.join('');}.bind(this));lListe.setTri([
ObjetTri.initRecursif('pere',[
ObjetTri.init(function(D){return D.matiere&&D.matiere.GetNumero()?1:0;}),ObjetTri.init(function(D){return D.matiere?D.matiere.GetLibelle():'';}),ObjetTri.init(function(D){return D._libelleClasseGroupe;}),ObjetTri.init(function(D){return D._libelleProfesseurs;}),ObjetTri.init(function(D){return!D.estUnService;}),ObjetTri.init(function(D){return D.GetNumero();})
])
]);lListe.trier();return lListe;}
function _actionSurRequeteListeEleves(aXml,aJSON){const lListeEleves=new ObjetListeElements();if(this.avecDeLaClasse){const lDonneeDeLaClasse=new ObjetElement(this.estUneClasse?'< '+GTraductions.getValeur('DeLaClasse')+' >':'< '+GTraductions.getValeur('DuGroupe')+' >',0,null,-1);lListeEleves.AddElement(lDonneeDeLaClasse);}
aJSON.listeEleves.parcourir(function(D){const lEleve=MethodesObjet.dupliquer(D);lListeEleves.AddElement(lEleve);});lListeEleves.setTri([
ObjetTri.init(function(D){return D.GetNumero()!==0;}),ObjetTri.init('Position')
]);lListeEleves.trier();return lListeEleves;}
module.exports=MoteurSelectionContexte;},fn:"moteurselectioncontexte.js"});;
IE.fModule({f:function(exports,require,module,global){const MethodesObjet=require('MethodesObjet.js');const InterfaceFicheStageCP_Mobile=require('InterfaceFicheStageCP_Mobile.js');const PageFicheStage_Mobile=require('PageFicheStage_Mobile.js');const EGenreDocumentJoint=require('Enumere_DocumentJoint.js');const EGenreEspace=require('Enumere_Espace.js');const{TypeDroits}=require('ObjetDroitsPN.js');const ControleSaisieEvenement=require('ControleSaisieEvenement.js');const GHtml=require('_ObjetHtml.js').GHtml;const ObjetPageSuiviStage=require('PageSuiviStage_Mobile.js');const{EGenreAffichageFicheStage,EGenreAffichageFicheStageUtil}=require('Enumere_AffichageFicheStage.js');const ObjetRequetePageStageGeneral=require('ObjetRequetePageStageGeneral.js');const EGenreRessource=require('Enumere_Ressource.js');const ObjetRequetePageAppreciationFinDeStage=require('ObjetRequetePageAppreciationFinDeStage.js');const ObjetElement=require('ObjetElement.js');const ObjetSelection=require('ObjetSelection.js').ObjetSelection;const MoteurSelectionContexte=require('MoteurSelectionContexte.js');class InterfaceFicheStage_Mobile extends InterfaceFicheStageCP_Mobile{constructor(...aParams){super(...aParams);this.moteurSelectionContexte=new MoteurSelectionContexte();this.parametres={avecEdition:false,avecEditionSuivisDeStage:false,avecSelectionEleve:GEtatUtilisateur.GenreEspace===EGenreEspace.Mobile_Professeur,tailleMaxPieceJointe:GApplication.droits.get(TypeDroits.tailleMaxDocJointEtablissement)};}
creerInstancePage(){return this.Add(PageFicheStage_Mobile,this.surEvenementPageStage);}
creerInstanceSuivi(){return this.Add(ObjetPageSuiviStage,_evtPageSuiviStage.bind(this));}
creerInstancePageTabs(){return this.Add(PageFicheStage_Mobile);}
ConstruireInstances(){this.identComboClasse=this.Add(ObjetSelection,_evntSelecteur.bind(this,{genreSelecteur:EGenreRessource.Classe,genreSelecteurSuivant:EGenreRessource.Eleve,estDernierSelecteur:false}),_initSelecteur.bind(this));this.identComboEleve=this.Add(ObjetSelection,_evntSelecteur.bind(this,{genreSelecteur:EGenreRessource.Eleve,genreSelecteurSuivant:null,estDernierSelecteur:true}),_initSelecteur.bind(this));super.ConstruireInstances();const lOngletAppreciations=new ObjetElement(EGenreAffichageFicheStageUtil.getTraductionOnglet(EGenreAffichageFicheStage.Appreciations),null,EGenreAffichageFicheStage.Appreciations);lOngletAppreciations.icone='icon_post_it_rempli';this.listeTabs.add(lOngletAppreciations);}
evntCmbStage(aParams){const lThis=this;const lStage=aParams.element;ControleSaisieEvenement(function(){if(lStage&&lStage.GetNumero()&&(!lThis.stage||(lStage.GetNumero()!==lThis.stage.GetNumero()))){lThis.stage=lStage;const lEleve=new ObjetElement('',lThis.numeroEleve||GEtatUtilisateur.getMembre().GetNumero());new ObjetRequetePageAppreciationFinDeStage(lThis,_surReponse.bind(lThis)).lancerRequete({eleve:lEleve,stage:lThis.stage});}});}
eventModeAffStage(aParam){if(aParam){this.selectModeAffStage=aParam.GetGenre();$('#'+GApplication.getIdConteneur()).scrollTop(0);this.GetInstance(this.identPage).SetDonnees({stage:this.stage,pj:this.listeDocJointsStage,genreOnglet:this.selectModeAffStage,evenements:this.listeEvenementsSuiviStage,lieux:this.listeLieuxSuiviStage});}}
RecupererDonnees(){this.SetEtatSaisie(false);this.stage=undefined;switch(GEtatUtilisateur.GenreEspace){case EGenreEspace.Mobile_Eleve:case EGenreEspace.Mobile_Parent:this.numeroEleve=GEtatUtilisateur.getMembre()?GEtatUtilisateur.getMembre().GetNumero():0;new ObjetRequetePageStageGeneral(this,_surListeStage.bind(this)).lancerRequete(this.numeroEleve);break;case EGenreEspace.Mobile_Professeur:if(this.numeroClasse&&this.numeroEleve){new ObjetRequetePageStageGeneral(this,_surListeStage.bind(this)).lancerRequete(this.numeroEleve);} else{this.moteurSelectionContexte.getListeClasses({pere:this,clbck:function(aParam){this.moteurSelectionContexte.remplirSelecteur($.extend({},aParam,{instance:this.GetInstance(this.identComboClasse),genreRessource:EGenreRessource.Classe,pere:this,clbck:this.AfficherMessage.bind(this)}));}.bind(this)});}
break;default:;break;}}
Actualiser(){if(this.selectModeAffStage===undefined){this.selectModeAffStage=EGenreAffichageFicheStage.Suivi;this.GetInstance(this.identTabs).SetDonnees(this.listeTabs);}
this.GetInstance(this.identTabs).selectOnglet(this.listeTabs.GetIndiceParNumeroEtGenre(null,this.selectModeAffStage));}
AfficherMessage(AMessage){GHtml.setHtml(this.GetInstance(this.identPage).GetNom(),'<div class="Texte12 Gras AlignementMilieu"><br>'+AMessage+'</div>');}}
function _initSelecteur(aInstance){aInstance.SetParametres({avecBoutonsPrecedentSuivant:false});}
function _evntSelecteur(aContexte,aParam){if(!aContexte.estDernierSelecteur){this.numeroClasse=!!aParam.element?aParam.element.GetNumero():0;this.moteurSelectionContexte.getListeEleves({classe:aParam.element,pere:this,clbck:function(aParam){this.moteurSelectionContexte.remplirSelecteur($.extend({},aParam,{instance:this.GetInstance(this.identComboEleve),genreRessource:EGenreRessource.Eleve,pere:this,clbck:this.AfficherMessage.bind(this)}));}.bind(this)});} else{this.numeroEleve=!!aParam.element?aParam.element.GetNumero():0;this.RecupererDonnees();}}
function _evtPageSuiviStage(aParam){if(!aParam){$('#'+this.GetInstance(this.identPage).GetNom().escapeJQ()).show();$('#'+GInterface.idZoneSelection.escapeJQ()).show();$('#'+this.GetInstance(this.identPageSuivi).GetNom().escapeJQ()).hide();this.RecupererDonnees();} else if(aParam.suivi){this.GetInstance(this.identPageSuivi).SetDonnees(aParam.suivi,aParam.stage,{evenements:this.listeEvenementsSuiviStage,lieux:this.listeLieuxSuiviStage});}}
function _surReponse(aJSON){this.stage=aJSON.stage;this.stage.numeroEleve=this.numeroEleve;GEtatUtilisateur.Navigation.SetRessource(EGenreRessource.Stage,this.stage);this.parametres.avecEdition=this.stage.avecEditionAnnexe;this.parametres.avecEditionSuivisDeStage=this.stage.avecEdition;this.GetInstance(this.identPage).setParametres({avecEdition:this.parametres.avecEdition,avecEditionDocumentsJoints:this.parametres.avecEdition,avecEditionSuivisDeStage:this.parametres.avecEditionSuivisDeStage,tailleMaxPieceJointe:this.parametres.tailleMaxPieceJointe});this.GetInstance(this.identPageSuivi).setParametres({avecEditionSuivisDeStage:this.parametres.avecEditionSuivisDeStage});this.listePJSuivis=null;if(!!this.stage.suiviStage){const lThis=this;this.stage.suiviStage.parcourir(function(aSuivi){if(lThis.listeEvenementsSuiviStage&&!!aSuivi.evenement){const lEvenementDeListeComplete=lThis.listeEvenementsSuiviStage.GetElementParNumero(aSuivi.evenement.GetNumero());if(!!lEvenementDeListeComplete){aSuivi.evenement=lEvenementDeListeComplete;}}
if(!!lThis.listeLieuxSuiviStage&&!!aSuivi.lieu){const lLieuDeListeComplete=lThis.listeLieuxSuiviStage.GetElementParNumero(aSuivi.lieu.GetNumero());if(!!lLieuDeListeComplete){aSuivi.lieu=lLieuDeListeComplete;}}});}
aJSON.listePJEleve.parcourir(function(aPieceJointe){aPieceJointe.actif=true;aPieceJointe.Genre=EGenreDocumentJoint.Fichier;});this.listeDocJointsStage=MethodesObjet.dupliquer(aJSON.listePJEleve);this.Actualiser();}
function _surListeStage(aListeStages,aListeEvenements,aListeLieux){this.listeEvenementsSuiviStage=aListeEvenements;this.listeLieuxSuiviStage=aListeLieux;const lListeStages=aListeStages;if(!!lListeStages&&lListeStages.GetNbrElements()>0){let lIndice=0;const lStageSelect=GEtatUtilisateur.Navigation.GetRessource(EGenreRessource.Stage);if(!!lStageSelect){lIndice=lListeStages.getIndiceElementParFiltre(function(aElement){return aElement.GetNumero()===lStageSelect.GetNumero();});}
lListeStages.parcourir(aStage =>{if(aStage.periode){aStage.SetLibelle('<div>'+aStage.GetLibelle()+'</div><div>'+aStage.periodeDebutFin+'</div>');}});this.GetInstance(this.identCmbStage).SetVisible(true);this.GetInstance(this.identCmbStage).SetDonnees(lListeStages,Math.max(lIndice,0));} else{this.GetInstance(this.identCmbStage).SetVisible(false);}}
module.exports=InterfaceFicheStage_Mobile;},fn:"interfacefichestage_mobile.js"});;
IE.fModule({f:function(exports,require,module,global){const ObjetFenetre=require('ObjetFenetre.js');const ObjetCelluleDate=require('ObjetCelluleDate.js');const tag=require('tag.js');const GTraductions=require('ObjetTraduction.js');class ObjetFenetre_FiltrePeriodeOffresStages extends ObjetFenetre{constructor(...aParams){super(...aParams);this.donnees=null;}
ConstruireInstances(){this.identDateDebut=this.Add(ObjetCelluleDate,_evenementDate.bind(this,true),_initDate);this.identDateFin=this.Add(ObjetCelluleDate,_evenementDate.bind(this,false),_initDate);}
ComposeContenu(){const T=[];T.push(tag('div',{class:'flex-contain'},tag('div',{class:'Gras EspaceDroit MargeHaut'},GTraductions.getValeur('Du').ucfirst()),tag('div',{class:'EspaceDroit',id:this.GetInstance(this.identDateDebut).GetNom()}),tag('div',{class:'Gras EspaceDroit MargeHaut'},GTraductions.getValeur('Au').ucfirst()),tag('div',{class:'EspaceDroit',id:this.GetInstance(this.identDateFin).GetNom()})));return T.join('');}
SetDonnees(aDonnees){this.donnees=aDonnees;this.dateDebut=this.donnees.dateDebut?new Date(this.donnees.dateDebut):null;this.dateFin=this.donnees.dateDebut?new Date(this.donnees.dateFin):null;this.GetInstance(this.identDateDebut).SetDonnees(this.dateDebut);this.GetInstance(this.identDateFin).SetDonnees(this.dateFin);}
SurValidation(aNumeroBouton){let lModif=false;if(aNumeroBouton===2&&!!this.dateDebut&&!!this.dateFin){lModif=true;} else if(aNumeroBouton===1){this.dateDebut=null;this.dateFin=null;lModif=true;}
if(lModif){this.donnees.dateDebut=this.dateDebut;this.donnees.dateFin=this.dateFin;}
this.callback.appel(aNumeroBouton,lModif);this.Fermer();}}
function _initDate(aInstance){aInstance.setParametres_Fenetre(GParametres.PremierLundi,GParametres.PremiereDate,GParametres.DerniereDate);}
function _evenementDate(aEstDateDebut ,aDate){if(aEstDateDebut){this.dateDebut=aDate;if(this.dateDebut>this.dateFin){this.dateFin=new Date(this.dateDebut.getTime());this.GetInstance(this.identDateFin).SetDonnees(this.dateFin);}} else{this.dateFin=aDate;if(this.dateDebut>this.dateFin){this.dateDebut=new Date(this.dateFin.getTime());this.GetInstance(this.identDateDebut).SetDonnees(this.dateDebut);}}}
module.exports=ObjetFenetre_FiltrePeriodeOffresStages;},fn:"objetfenetre_filtreperiodeoffresstages.js"});;
IE.fModule({f:function(exports,require,module,global){const ObjetFenetre=require('ObjetFenetre.js');const GTraductions=require('ObjetTraduction.js');const ObjetSaisie=require('ObjetSaisie.js');const EGenreSaisie=require('Enumere_Saisie.js');const EGenreEvenementObjetSaisie=require('Enumere_EvenementObjetSaisie.js');const MethodesObjet=require('MethodesObjet.js');const ObjetElement=require('ObjetElement.js');const ObjetListeElements=require('ObjetListeElements.js');const ObjetFenetre_FiltrePeriodeOffresStages=require('ObjetFenetre_FiltrePeriodeOffresStages.js');const{GDate}=require('ObjetDate.js');class ObjetFenetre_FiltreEntreprise_Mobile extends ObjetFenetre{constructor(...aParams){super(...aParams);this.setOptionsFenetre({titre:GTraductions.getValeur('liste.Filtrer'),listeBoutons:[GTraductions.getValeur('Annuler'),GTraductions.getValeur('Valider')]});this.filtre={periode:new ObjetElement({dateDebut:GDate.aujourdhui,dateFin:GDate.aujourdhui}),sujet:'',seulementAvecOffres:false,nbrSemaines:0,activite:new ObjetListeElements()};}
ConstruireInstances(){this.identFiltreActivite=this.Add(ObjetSaisie,_evnFiltreActivite.bind(this),function(aInstance){aInstance.setOptions_ObjetSaisie({mode:EGenreSaisie.Combo,multiSelection:true,longueur:220,libelleHaut:GTraductions.getValeur('OffreStage.titre.Activite'),avecDesignMobile:true,getInfosElementCB:function(aElement){const lEstCumul=aElement.GetNumero()=== -1;return{estCumul:lEstCumul,estFilsCumul:function(aFils){return aElement.GetGenre()=== -1&&aElement.GetGenre()!==aFils.GetGenre();},setModifierSelection:function(aParametresModifie){if(aParametresModifie.elementSourceSelectionne&&
aElement.GetGenre()=== -1&&aElement.GetGenre()!==aParametresModifie.elementSource.GetGenre()){return true;}}};}});});if(this.options.avecPeriode&&this.options.avecFiltrePeriode){this.idFenetrePeriode=this.addFenetre(ObjetFenetre_FiltrePeriodeOffresStages,_evntFenetrePeriode.bind(this),_initFenetrePeriode);}}
getControleur(aInstance){return $.extend(true,super.getControleur(aInstance),{nbSemaines:{getValue:function(){return aInstance.filtre.nbrSemaines||'';},setValue:function(aValue){aInstance.filtre.nbrSemaines=parseInt(aValue);if(!MethodesObjet.isNumber(aInstance.filtre.nbrSemaines)){aInstance.filtre.nbrSemaines=0;}}},cbFiltreSeulementAvecOffres:{getValue:function(){return aInstance.filtre.seulementAvecOffres;},setValue:function(aValue){aInstance.filtre.seulementAvecOffres=aValue;}},getPeriode:function(){return aInstance&&aInstance.filtre.periode&&aInstance.filtre.periode.libelle?aInstance.filtre.periode.libelle.ucfirst():' ';},eventPeriode:function(){$(this.node).on({click:function(){if(aInstance&&aInstance.options.avecPeriode&&aInstance.options.avecFiltrePeriode){_evntOuvertureFenetrePeriode.call(aInstance);}}.bind(aInstance)});},sujet:{getValue:function(){return aInstance?aInstance.filtre.sujet:'';},setValue:function(aValue){if(aInstance){aInstance.filtre.sujet=aValue;}}},afficherPeriode:function(){return aInstance.options.avecPeriode&&aInstance.options.avecFiltrePeriode;}});}
SetDonnees(aFiltres,aOptions,aListeActivites){this.filtre=aFiltres;this.options=aOptions;this.GetInstance(this.identFiltreActivite).SetDonnees(aListeActivites,this.filtre.activite);this.GetInstance(this.identFiltreActivite).SetContenu(this.filtre.activite);this.Afficher();}
ComposeContenu(){const H=[];H.push('<div class="filtre-conteneur-mobile">');H.push(`<div class="champs-filtre">\n              <input type="text" ie-model="sujet" class="round-style sujet" placeholder="${GTraductions.getValeur('OffreStage.titre.Sujet')}"/>\n            </div>\n\n            <div class="champs-filtre">\n              <div id="${this.GetInstance(this.identFiltreActivite).GetNom()}"></div>\n            </div>`);H.push(`<div ie-if="afficherPeriode" class="champs-filtre">\n                <label>${GTraductions.getValeur('OffreStage.titre.Periode')}</label>\n                <i class="icon_calendar_empty"></i>\n                <div ie-node="eventPeriode" class="like-input as-calendar" style="background-color:#fff;">\n                  <div class="periode" ie-texte="getPeriode" ></div>\n                </div>\n            </div>`);H.push(`<div class="champs-filtre flex-contain">\n              <div>${GTraductions.getValeur('OffreStage.dureeMinimale')}</div>\n              <input type="text" ie-model="nbSemaines" ie-mask="/[^0-9]/i"  size="2" maxlength="2" class="round-style semaine" />\n            </div>`);H.push(`<div class="fields-wrapper champs-filtre">\n              <ie-checkbox ie-textleft ie-model="cbFiltreSeulementAvecOffres">${GTraductions.getValeur('OffreStage.titre.FiltreSeulementAvecOffre')}
            </div>`);H.push('</div>');return H.join('');}}
function _evnFiltreActivite(aGenreEvenement,aElement,aIndice,aGenre,aValeur,aSurSetDonnees,aListeSelections){if(EGenreEvenementObjetSaisie.selection===aGenreEvenement&&aListeSelections){this.filtre.activite=aListeSelections;}}
function _evntOuvertureFenetrePeriode(){if(!this.filtre.periode){this.filtre.periode=new ObjetElement('');this.filtre.periode.dateDebut=null;this.filtre.periode.dateFin=null;}
this.GetInstance(this.idFenetrePeriode).SetDonnees(this.filtre.periode);this.GetInstance(this.idFenetrePeriode).Afficher();}
function _initFenetrePeriode(aInstance){aInstance.setOptionsFenetre({titre:GTraductions.getValeur('OffreStage.periodePossibleDeStage'),largeur:350,listeBoutons:[GTraductions.getValeur('Annuler'),GTraductions.getValeur('Supprimer'),GTraductions.getValeur('Valider')]});}
function _evntFenetrePeriode(aNumeroBouton,aEstModif){let lLibelle='';if(aEstModif){if(!!this.filtre.periode.dateDebut){if(GDate.estDateEgale(this.filtre.periode.dateDebut,this.filtre.periode.dateFin)){lLibelle=GTraductions.getValeur('Le')+' '+GDate.FormatDate(this.filtre.periode.dateDebut,'%JJ/%MM/%AA');} else{lLibelle=GTraductions.getValeur('Du')+' '+GDate.FormatDate(this.filtre.periode.dateDebut,'%JJ/%MM/%AA');lLibelle+=' '+GTraductions.getValeur('Au')+' '+GDate.FormatDate(this.filtre.periode.dateFin,'%JJ/%MM/%AA');}}
this.filtre.periode.libelle=lLibelle;}}
module.exports=ObjetFenetre_FiltreEntreprise_Mobile;},fn:"objetfenetre_filtreentreprise_mobile.js"});;
IE.fModule({f:function(exports,require,module,global){const ObjetDonneesListeFlatDesign=require('ObjetDonneesListeFlatDesign.js');const GTraductions=require('ObjetTraduction.js');const tag=require('tag.js');class DonneesListe_ListeEntreprises extends ObjetDonneesListeFlatDesign{constructor(aDonnees,aParametres){super(aDonnees);this.parametres=aParametres;this.setOptions({avecSelection:true,avecEdition:false,avecSuppression:false,avecEvnt_Selection:true,avecBoutonActionLigne:false});}
AvecMenuContextuel(){return false;}
getClassCelluleConteneur(){return'AvecMain';}
getIconeGaucheContenuFormate(aParams){const lEntreprise=aParams.article;return lEntreprise.estSiegeSocial?'icon_building':'icon_entreprise';}
getTitreZonePrincipale(aParams){if(!aParams.article){return'';}
const lStrEntreprise=aParams.article.GetLibelle()+(!!aParams.article.nomCommercial?` ${tag('span',{style:'font-weight:400;'}, '/ ' + aParams.article.nomCommercial)}`:'');return lStrEntreprise;}
getInfosSuppZonePrincipale(aParams){const lEntreprise=aParams.article;const H=[];if(!!lEntreprise){H.push(!!lEntreprise.codePostal||!!lEntreprise.ville?tag('div',(lEntreprise.codePostal||'')+' '+(lEntreprise.ville||'')):'');H.push(!!lEntreprise.activite?tag('div',lEntreprise.activite.GetLibelle()):'');H.push(!!lEntreprise.siret?tag('div',GTraductions.getValeur('OffreStage.titre.NumeroSiret')+' : '+lEntreprise.siret):'');}
return H.join('');}
getZoneComplementaire(aParams){const H=[];if(!this.enConstruction_cacheRechercheTexte){const lEntreprise=aParams.article;if(!!lEntreprise){const lNbOffres=lEntreprise.listeOffresStages?lEntreprise.listeOffresStages.GetNbrElements():0;if(lNbOffres>0){H.push(tag('div',{class:'offre-pourvu'},lNbOffres+` ${lNbOffres>1?GTraductions.getValeur('OffreStage.offres'):GTraductions.getValeur('OffreStage.offre')}`));}
if(lEntreprise.estPublie===false){H.push(tag('div',IE.estMobile?GTraductions.getValeur('OffreStage.nonPubliee'):GTraductions.getValeur('OffreStage.nonPublieeSurEspaceParentsEleves')));}}}
return H.join('');}
GetVisible(aArticle){return!aArticle||aArticle.visible;}}
module.exports=DonneesListe_ListeEntreprises;},fn:"donneesliste_listeentreprises.js"});;
IE.fModule({f:function(exports,require,module,global){const{GDate}=require('ObjetDate.js');const GTraductions=require('ObjetTraduction.js');function UtilitaireStage(){}
UtilitaireStage.composeLibelleDatePeriodes=function(aPeriodes){const lLibelle=[];if(aPeriodes){for(let i=0;i<aPeriodes.GetNbrElements();i++){const lPeriode=aPeriodes.GetElement(i);lLibelle.push(_composeLibelleDatePeriode(lPeriode));}}
return lLibelle.join(' - ');};UtilitaireStage.composeLibelleDatePeriodesEntreLe=function(aPeriodes){const lLibelle=[];if(aPeriodes){for(let i=0;i<aPeriodes.GetNbrElements();i++){const lPeriode=aPeriodes.GetElement(i);const lStr=_composeLibelleDatePeriodeEntreLe(lPeriode);if(!!lStr){lLibelle.push(lStr);}}}
if(lLibelle.length>0){return GTraductions.getValeur('OffreStage.entre')+' '+lLibelle.join(' '+GTraductions.getValeur('ou')+' ');}
return'';};UtilitaireStage.composeLibelleDatePeriode=function(aPeriode){return _composeLibelleDatePeriode(aPeriode);};function _composeLibelleDatePeriode(aPeriode){let lLibelle='';if(!!aPeriode&&aPeriode.Existe()&&aPeriode.dateDebut&&(aPeriode.dateDebut.getTime()>0)){if(GDate.estDateEgale(aPeriode.dateDebut,aPeriode.dateFin)){lLibelle=GTraductions.getValeur('Le')+' '+GDate.FormatDate(aPeriode.dateDebut,'%JJ/%MM/%AA');} else{lLibelle=GTraductions.getValeur('Du')+' '+GDate.FormatDate(aPeriode.dateDebut,'%JJ/%MM/%AA');lLibelle+=' '+GTraductions.getValeur('Au')+' '+GDate.FormatDate(aPeriode.dateFin,'%JJ/%MM/%AA');}}
return lLibelle;}
UtilitaireStage.composeLibelleDatePeriodeEntreLe=function(aPeriode){const lResult=_composeLibelleDatePeriodeEntreLe(aPeriode);return lResult?GTraductions.getValeur('OffreStage.entre')+' '+lResult:'';};function _composeLibelleDatePeriodeEntreLe(aPeriode){let lLibelle='';if(!!aPeriode&&aPeriode.Existe()&&aPeriode.dateDebut&&aPeriode.dateDebut.getTime()>0){if(GDate.estDateEgale(aPeriode.dateDebut,aPeriode.dateFin)){lLibelle=GTraductions.getValeur('Le')+' '+GDate.FormatDate(aPeriode.dateDebut,'%JJ/%MM/%AA');} else{lLibelle=GTraductions.getValeur('OffreStage.entreLeXEtLeX',[GDate.FormatDate(aPeriode.dateDebut,'%JJ/%MM/%AA'),GDate.FormatDate(aPeriode.dateFin,'%JJ/%MM/%AA')]);}}
return lLibelle;}
module.exports=UtilitaireStage;},fn:"utilitairestage.js"});;
IE.fModule({f:function(exports,require,module,global){const ObjetCalendrierPeriode=require('ObjetCalendrierPeriode.js');const ObjetFenetre=require('ObjetFenetre.js');const ObjetElement=require('ObjetElement.js');const ObjetListeElements=require('ObjetListeElements.js');class ObjetFenetre_CalendrierStagePeriode extends ObjetFenetre{constructor(...aParams){super(...aParams);}
ConstruireInstances(){this.identCalendrier=this.Add(ObjetCalendrierPeriode,null,function(aInstance){aInstance.SetParametres({avecPeriodes:true});});}
ComposeContenu(){const H=[];H.push('<div class="CalendrierPeriode">');H.push('<div id="',this.GetNomInstance(this.identCalendrier),'"></div>');H.push('</div>');return H.join('');}
SetDonnees(aOffreStage){this.donnees={};this.donnees.Zones=new ObjetListeElements();let lObjZone=new ObjetElement(aOffreStage.GetLibelle());lObjZone.donnees=aOffreStage.periodes;lObjZone.class=['zone-stageContexte'];this.donnees.Zones.add(lObjZone);this.GetInstance(this.identCalendrier).SetDonnees(this.donnees);}}
module.exports=ObjetFenetre_CalendrierStagePeriode;},fn:"objetfenetre_calendrierstageperiode.js"});;
IE.fModule({f:function(exports,require,module,global){const Identite=require('ObjetIdentite.js');const GTraductions=require('ObjetTraduction.js');const UtilitaireStage=require('UtilitaireStage.js');const GChaine=require('GChaine.js');const tag=require('tag.js');const ObjetFenetre=require('ObjetFenetre.js');const ObjetFenetre_CalendrierStagePeriode=require('ObjetFenetre_CalendrierStagePeriode.js');require('espace/css/ObjetDetailOffreStage.css');class ObjetDetailOffreStage extends Identite{constructor(...aParams){super(...aParams);this.initOptions();}
initOptions(){this._options={avecPeriode:false,avecPeriodeUnique:true,avecEdition:false,avecGestionPJ:false};}
setOptions(aOptions){$.extend(this._options,aOptions);}
getControleur(aInstance){return $.extend(true,super.getControleur(this),{btnCalendrier:{event:function(aOffreNumero){const lFenetre=ObjetFenetre.creerInstance(ObjetFenetre_CalendrierStagePeriode,{pere:aInstance,initialiser:function(aInstance){aInstance.setOptionsFenetre({titre:GTraductions.getValeur('OffreStage.PeriodePossible'),largeur:1000,hauteurMaxContenu:650,avecScroll:true});}});const lOffre=aInstance.entreprise.listeOffresStages.GetElementParNumero(aOffreNumero);if(!!lOffre){lFenetre.SetDonnees(lOffre);lFenetre.Afficher();}}}});}
setDonnees(aDonnees,aOnglet){this.entreprise=aDonnees.entreprise;if(IE.estMobile){this.genreOnglet=aOnglet;}
_actualiser.bind(this)();}
actualiserAffichage(){_actualiser.bind(this)();}
ConstruireAffichage(){if(!this.entreprise||!this.entreprise.visible){return this.composeMessage(GTraductions.getValeur('OffreStage.selectEntreprise'));}
const H=[];if(IE.estMobile){H.push('<div class="detailoffrestage">');if(this.genreOnglet===0){H.push(tag('div',{class:'conteneur-detailEntreprise'},_composeContenuDetailEntreprise.call(this)));} else{H.push(tag('div',_composeContenuDetailOffres.call(this)));}
H.push('</div>');} else{H.push(tag('div',{class:'detailoffrestage'},tag('div',{class:'conteneur-detailEntreprise'},_composeContenuDetailEntreprise.call(this)),tag('div',_composeContenuDetailOffres.call(this))));}
return H.join('');}}
function _actualiser(){this.Afficher();}
function _composeContenuDetailEntreprise(){const H=[];if(!IE.estMobile){H.push(tag('h3',{class:'ie-titre-couleur'},GTraductions.getValeur('OffreStage.details')));}
const lNomEntreprise=this.entreprise.GetLibelle();const lStrActivite=(this.entreprise.activite?this.entreprise.activite.GetLibelle():'');const lAdresseComplete=[];lAdresseComplete.push(this.entreprise.adresse1?tag('div',this.entreprise.adresse1):'');lAdresseComplete.push(this.entreprise.adresse2?tag('div',this.entreprise.adresse2):'');lAdresseComplete.push(this.entreprise.adresse3?tag('div',this.entreprise.adresse3):'');lAdresseComplete.push(this.entreprise.adresse4?tag('div',this.entreprise.adresse4):'');if(this.entreprise.codePostal||this.entreprise.ville){lAdresseComplete.push(tag('div',(this.entreprise.codePostal?this.entreprise.codePostal:'')+' '+(this.entreprise.ville?this.entreprise.ville:'')));}
if(IE.estMobile){let lNbNonPourvu=0;const lNbOffres=this.entreprise.listeOffresStages?this.entreprise.listeOffresStages.GetNbrElements():0;if(lNbOffres>0){this.entreprise.listeOffresStages.parcourir(aOffre =>{if(aOffre.nbPourvus!==aOffre.nbPropose){lNbNonPourvu++;}});H.push(tag('div',{class:'theme_color_moyen1 m-bottom'},lNbOffres+` ${lNbOffres>1?GTraductions.getValeur('OffreStage.offres'):GTraductions.getValeur('OffreStage.offre')} ${lNbNonPourvu>0?`(${lNbNonPourvu} ${lNbNonPourvu>1?GTraductions.getValeur('OffreStage.nonPourvueS'):GTraductions.getValeur('OffreStage.nonPourvue')})`:''}`));}
H.push(tag('div',{class:'m-bottom'},lAdresseComplete.join('')),tag('div',lStrActivite),!!this.entreprise.siret?tag('div',GTraductions.getValeur('OffreStage.titre.NumeroSiret')+' : '+this.entreprise.siret):'');} else{H.push(tag('div',{class:'header-detail'},tag('div',{class:'flex-contain m-bottom'},tag('i',{class:this.entreprise.estSiegeSocial?'icon_building':'icon_entreprise'}),tag('div',tag('div',{class:'Gras'},lNomEntreprise+(this.entreprise.estSiegeSocial?' ('+GTraductions.getValeur('FicheStage.siegeSocial')+')':'')),!!this.entreprise.nomCommercial?tag('div',this.entreprise.nomCommercial):'')),tag('div',{class:'m-bottom'},lAdresseComplete.join('')),tag('div',lStrActivite),!!this.entreprise.siret?tag('div',GTraductions.getValeur('OffreStage.titre.NumeroSiret')+' : '+this.entreprise.siret):''));}
if(!!this.entreprise.numeroMobile||!!this.entreprise.numeroFixe||!!this.entreprise.email||!!this.entreprise.siteInternet){H.push(tag('div',{class:'conteneur-numeros'},!!this.entreprise.numeroMobile?tag('div',{class:'lien-communication tel-mobile',title:GTraductions.getValeur('FicheStage.TelPortable')},tag('a',{href:'tel:'+GChaine.formatTelephoneAvecIndicatif(this.entreprise.indMobile,this.entreprise.numeroMobile)},GChaine.formatTelephone(this.entreprise.numeroMobile))):'',!!this.entreprise.numeroFixe?tag('div',{class:'lien-communication tel',title:GTraductions.getValeur('FicheStage.TelFixe')},tag('a',{href:'tel:'+GChaine.formatTelephoneAvecIndicatif(this.entreprise.indFixe,this.entreprise.numeroFixe)},GChaine.formatTelephone(this.entreprise.numeroFixe))):'',!!this.entreprise.email?tag('div',{class:'lien-communication'},tag('a',{href:'mailto:'+this.entreprise.email,target:'_blank'},this.entreprise.email)):'',!!this.entreprise.siteInternet?tag('div',{class:'lien-communication'},tag('a',{href:GChaine.encoderUrl(GChaine.verifierURLHttp(this.entreprise.siteInternet))},this.entreprise.siteInternet)):''));}
if(!!this.entreprise.commentairePublie){H.push(tag('div',{class:'conteneur-bloc'},tag('div',{class:'Gras ie-titre-petit'},GTraductions.getValeur('OffreStage.commentairePublieFamille')),tag('div',{class:'conteneur-texte'},this.entreprise.commentairePublie)));}
if(!!this.entreprise.commentaireInterne){H.push(tag('div',{class:'conteneur-bloc'},tag('div',{class:'Gras ie-titre-petit'},GTraductions.getValeur('OffreStage.commentaireInterne')),tag('div',{class:'conteneur-texte'},this.entreprise.commentaireInterne)));}
if(!!this.entreprise.documents&&this.entreprise.documents.GetNbrElements()>0){H.push('<div class="conteneur-bloc">');for(let i=0,lNbr=this.entreprise.documents.GetNbrElements();i<lNbr;i++){H.push(tag('span',{class:'chips-pj'},GChaine.composerUrlLienExterne({documentJoint:this.entreprise.documents.GetElement(i),maxWidth:250})));}
H.push('</div>');}
return H.join('');}
function _composeContenuDetailOffres(){const H=[];const nbOffresStages=this.entreprise.listeOffresStages?this.entreprise.listeOffresStages.GetNbrElements():0;if(nbOffresStages){if(!IE.estMobile){H.push(tag('h3',{class:'ie-titre-couleur'},GTraductions.getValeur('OffreStage.offres').ucfirst()+' ('+nbOffresStages+')'));}
for(let i=0;i<nbOffresStages;i++){H.push(tag('div',{class:i>0?'conteneur-detailsOffre':''},_composeContenuDetailOffre.call(this,this.entreprise.listeOffresStages.GetElement(i))));}}
return H.join('');}
function _composeContenuDetailOffre(aOffreStage){const H=[];const lPourvue=aOffreStage.nbPourvus===aOffreStage.nbPropose;H.push(tag('div',{class:'header-conteneur'},tag('div',{class:lPourvue?'titre-pourvue':'ie-titre-couleur'},aOffreStage.sujet.GetLibelle()),tag('div',tag('ie-chips',{class:'tag-style'+(!lPourvue?' color-theme':'')},lPourvue?GTraductions.getValeur('OffreStage.pourvue'):GTraductions.getValeur('OffreStage.nonPourvue')))));H.push(tag('div',{class:'conteneur-bloc'},tag('div',{class:'Gras ie-titre-petit'},GTraductions.getValeur('OffreStage.SujetDetaille')+' :'),!!aOffreStage.sujetDetaille?tag('div',{class:'conteneur-texte'},aOffreStage.sujetDetaille):''));if(this._options.avecPeriode){let lLibelle;if(this._options.avecPeriodeUnique){lLibelle=UtilitaireStage.composeLibelleDatePeriodeEntreLe(aOffreStage.periode);} else if(!!aOffreStage.periodes&&aOffreStage.periodes.GetNbrElements()){lLibelle=tag('ie-bouton',{class:'small-bt themeBoutonSecondaire m-left','ie-model':'btnCalendrier(\''+aOffreStage.GetNumero()+'\')'},GTraductions.getValeur('OffreStage.voirCalendrier'));}
H.push(tag('div',{class:'conteneur-bloc'},tag('div',{class:'Gras ie-titre-petit'},GTraductions.getValeur('OffreStage.dureeEtPeriode')+' :'),tag('div',{class:'conteneur-texte'},aOffreStage.duree+' '+(!!lLibelle?lLibelle:'('+GTraductions.getValeur('OffreStage.aucunePeriodeImposee')+')'))));}
if(aOffreStage.commentaire){H.push(tag('div',{class:'conteneur-bloc'},tag('div',{class:'Gras ie-titre-petit'},GTraductions.getValeur('OffreStage.Commentaire')+' :'),tag('div',{class:'conteneur-texte'},aOffreStage.commentaire)));}
if(this._options.avecGestionPJ&&aOffreStage.piecesjointes&&aOffreStage.piecesjointes.GetNbrElements()>0){H.push('<div class="conteneur-bloc">');for(let i=0,lNbr=aOffreStage.piecesjointes.GetNbrElements();i<lNbr;i++){H.push(tag('span',{class:'chips-pj'},GChaine.composerUrlLienExterne({documentJoint:aOffreStage.piecesjointes.GetElement(i),maxWidth:250})));}
H.push('</div>');}
return H.join('');}
module.exports=ObjetDetailOffreStage;},fn:"objetdetailoffrestage.js"});;
IE.fModule({f:function(exports,require,module,global){const InterfacePage_Mobile=require('InterfacePage_Mobile.js');const ObjetElement=require('ObjetElement.js');const ObjetListe=require('ObjetListe.js');const GTraductions=require('ObjetTraduction.js');const EStructureAffichage=require('Enumere_StructureAffichage.js');const ObjetFenetre=require('ObjetFenetre.js');const ObjetFenetre_FiltreEntreprise_Mobile=require('ObjetFenetre_FiltreEntreprise_Mobile.js');const MethodesObjet=require('MethodesObjet.js');const tag=require('tag.js');const DonneesListe_ListeEntreprises=require('DonneesListe_ListeEntreprises.js');const ObjetListeElements=require('ObjetListeElements.js');const ObjetTri=require('ObjetTri.js');const ObjetTabOnglets=require('ObjetTabOnglets.js');const ObjetDetailOffreStage=require('ObjetDetailOffreStage.js');const{GDate}=require('ObjetDate.js');const ComparateurChaines=require('ComparateurChaines.js');require('PageOffresStages.css');class InterfaceListeEntreprisesCP extends InterfacePage_Mobile{constructor(...aParams){super(...aParams);this.options={avecPeriode:false,avecFiltrePeriode:false,avecPeriodeUnique:true,avecGestionPJ:false,genreRessourcePJ:-1};this.filtresParDefaut={periode:new ObjetElement({dateDebut:GDate.aujourdhui,dateFin:GDate.aujourdhui}),sujet:'',seulementAvecOffres:false,nbrSemaines:0,activite:new ObjetListeElements()};_setFiltre.call(this);this.GenreStructure=EStructureAffichage.Autre;}
ConstruireInstances(){this.identListeEntreprises=this.Add(ObjetListe,_evnSelectListeEntreprise.bind(this),_initListe.bind(this));this.identDetailOffreDeStage=this.Add(ObjetDetailOffreStage,null,_initDetail.bind(this));this.GetInstance(this.identDetailOffreDeStage).SetVisible(false);this.identTabs=this.Add(ObjetTabOnglets,_evntModeAffDetailOffreStage.bind(this),function(aInstance){aInstance.setOptions({afficherOngletUnique:true});});this.AddSurZone=[{html:_composeBandeau.call(this),controleur:this.controleur},{html:'<div id="'+this.GetInstance(this.identTabs).GetNom()+'"></div>'}];this.IdPremierElement=this.identListeEntreprises;}
setOptions(aOptions){$.extend(this.options,aOptions);}
getControleur(aInstance){return $.extend(true,super.getControleur(aInstance),{afficherBandeau:function(){return aInstance.GetInstance(aInstance.identDetailOffreDeStage).Visible;},retour:{event:function(){$('#'+aInstance.GetInstance(aInstance.identListeEntreprises).GetNom().escapeJQ()).show();aInstance.GetInstance(aInstance.identDetailOffreDeStage).SetVisible(false);$('#'+aInstance.GetInstance(aInstance.identTabs).GetNom().escapeJQ()).hide();aInstance.GetInstance(aInstance.identListeEntreprises).SelectionnerLigne({deselectionnerTout:true,ligne:-1});}},nomEntrepriseHTML:function(){const H=[];if(aInstance.entrepriseSelectionnee){H.push(tag('div',tag('i',{class:aInstance.entrepriseSelectionnee.estSiegeSocial?'icon_building':'icon_entreprise'}),tag('span',{class:'Gras'},aInstance.entrepriseSelectionnee.GetLibelle()+(aInstance.entrepriseSelectionnee.estSiegeSocial?' ('+GTraductions.getValeur('FicheStage.siegeSocial')+')':''))),aInstance.entrepriseSelectionnee.nomCommercial?tag('div',{class:'text-center'},aInstance.entrepriseSelectionnee.nomCommercial):'');}
return H.join('');}});}
ConstruireStructureAffichageAutre(){return['<div class="PageOffreStage-conteneur">','<div class="liste-offres" id="',this.GetInstance(this.identListeEntreprises).GetNom(),'"></div>','<div id="',this.GetInstance(this.identDetailOffreDeStage).GetNom(),'" class="detail-offre" tabIndex="-1"></div>','</div>'].join('');}
getEtatFiltre(){return this.filtre.nbrSemaines>0||this.filtre.seulementAvecOffres||this.filtre.sujet!==''||(this.filtre.activite.GetNbrElements()>0&&this.filtre.activite.GetNbrElements()<this.listeActivites.GetNbrElements()-1)||!GDate.estJourEgal(this.filtre.periode.dateDebut,this.filtre.periode.dateFin);}
traiterDonnees(){if(this.listeEntreprises){let lEntreprise;this.listeActivites=new ObjetListeElements();let LActiviteAjoute=false;for(let i=0,nbEntreprises=this.listeEntreprises.GetNbrElements();i<nbEntreprises;i++){lEntreprise=this.listeEntreprises.GetElement(i);if(lEntreprise.activite){const lActivite=MethodesObjet.dupliquer(lEntreprise.activite);if(this.listeActivites.GetIndiceParNumeroEtGenre(lActivite.GetNumero())===undefined){lActivite.Position=2;this.listeActivites.AddElement(lActivite);}} else{if(!LActiviteAjoute){const lAucuneActivite=new ObjetElement(GTraductions.getValeur('OffreStage.ActiviteNonDefini'),null,0,1);lAucuneActivite.filtreAucun=true;this.listeActivites.AddElement(lAucuneActivite);LActiviteAjoute=true;}}
lEntreprise.visible=true;}
this.listeActivites.add(new ObjetElement('<div class="Gras">'+GTraductions.getValeur('OffreStage.touteLesActivites')+'</div>',-1,-1,0));this.listeActivites.trier();_trierListe(this.listeEntreprises);}
this.GetInstance(this.identListeEntreprises).SetDonnees(new DonneesListe_ListeEntreprises(this.listeEntreprises));$('#'+this.GetInstance(this.identListeEntreprises).GetNom().escapeJQ()).show();this.GetInstance(this.identDetailOffreDeStage).SetVisible(false);$('#'+this.GetInstance(this.identTabs).GetNom().escapeJQ()).hide();}}
function _composeBandeau(){const H=[];H.push('<div ie-if="afficherBandeau" class="Bandeau-filtre">','<ie-btnicon class="icon_retour_mobile" title="',GTraductions.getValeur('OffreStage.retourListe'),'" ie-model="retour"></ie-btnicon>','<div ie-html="nomEntrepriseHTML" class="bandeau-nom"></div>','</div>');return H.join('');}
function _initListe(aInstance){const lThis=this;const lObjOptionsListe={skin:ObjetListe.skin.flatDesign,colonnes:[{taille:'100%'}],messageContenuVide:GTraductions.getValeur('OffreStage.aucuneEntreprise'),boutons:[{genre:ObjetListe.typeBouton.rechercher},{genre:ObjetListe.typeBouton.filtrer,event(){_ouvrirFenetreFiltre.call(lThis);}}
]};if(this.options.largeurImage!==undefined){lObjOptionsListe.largeurImage=this.options.largeurImage;}
aInstance.setOptionsListe(lObjOptionsListe);}
function _evnSelectListeEntreprise(aParametres){this.entrepriseSelectionnee=this.listeEntreprises.GetElement(aParametres.ligne);$('#'+this.GetInstance(this.identListeEntreprises).GetNom().escapeJQ()).hide();this.listeTabs=new ObjetListeElements();const lDetailStage=new ObjetElement({Libelle:GTraductions.getValeur('OffreStage.details'),Genre:0});this.listeTabs.AddElement(lDetailStage);const lAvecOffre=!!this.entrepriseSelectionnee.listeOffresStages&&!!this.entrepriseSelectionnee.listeOffresStages.GetNbrElements();let lPourvu=true;if(lAvecOffre){this.entrepriseSelectionnee.listeOffresStages.parcourir((aOffre) =>{if(aOffre.nbPourvus!==aOffre.nbPropose){lPourvu=false;}});const lOffreStage=new ObjetElement({Libelle:GTraductions.getValeur('OffreStage.offres').ucfirst()+(lAvecOffre?' ('+this.entrepriseSelectionnee.listeOffresStages.GetNbrElements()+')':''),Genre:1});this.listeTabs.AddElement(lOffreStage);}
const lAvecNonPourvu=lAvecOffre&&!lPourvu;this.GetInstance(this.identTabs).SetDonnees(this.listeTabs);$('#'+this.GetInstance(this.identTabs).GetNom().escapeJQ()).show();this.GetInstance(this.identTabs).selectOnglet(lAvecOffre&&lAvecNonPourvu?1:0);}
function _initDetail(aInstance){aInstance.setOptions({avecPeriode:this.options.avecPeriode,avecPeriodeUnique:this.options.avecPeriodeUnique,avecGestionPJ:this.options.avecGestionPJ,genreRessourcePJ:this.options.genreRessourcePJ});}
function _ouvrirFenetreFiltre(){const lFiltreCopie=Object.assign({},this.filtre);const lFenetre=ObjetFenetre.creerInstance(ObjetFenetre_FiltreEntreprise_Mobile,{pere:this,evenement:function(aNumeroBouton){if(aNumeroBouton!==1){this.filtre=lFiltreCopie;} else{_evnFiltre.call(this);}},initialiser:function(aInstance){$.extend(aInstance.options,this.options);}});lFenetre.SetDonnees(this.filtre,this.options,this.listeActivites);}
function _setFiltre(){this.filtre=MethodesObjet.dupliquer(this.filtresParDefaut);}
function _evnFiltre(){const lArrActivites=this.filtre.activite.getTableauNumeros();const lEstActiviteVide=this.filtre.activite.getIndiceElementParFiltre(function(aElement){return aElement.filtreAucun;})>-1;this.listeEntreprises.parcourir(function(aEntreprise){const lFiltreActivite=(lArrActivites.length===0)||(aEntreprise&&aEntreprise.activite&&$.inArray(aEntreprise.activite.GetNumero(),lArrActivites)> -1)||(lEstActiviteVide&&aEntreprise&&(!aEntreprise.activite||!aEntreprise.activite.existeNumero()));const lFiltreSeulementAvecOffres=!this.filtre.seulementAvecOffres||(aEntreprise.listeOffresStages&&aEntreprise.listeOffresStages.GetNbrElements()>0);const lNbOffresStages=aEntreprise.listeOffresStages?aEntreprise.listeOffresStages.GetNbrElements():0;let lOffre=null;let lFiltreSujet=true;if(this.filtre.sujet){lFiltreSujet=false;let lStrRecherche=this.filtre.sujet;lStrRecherche=lStrRecherche.trim?lStrRecherche.trim().replace(/\s\s/g,'').replace(/[-[\]/{}()*+?.\\^$|']/g,'\\$&'):'';const lRecherche=[];ComparateurChaines.normalize(lStrRecherche).split(' ').forEach((aVal) =>{if(aVal&&aVal.trim&&aVal.trim()&&!lRecherche.includes(aVal)){lRecherche.push(aVal.trim());}});lRecherche.forEach((aSearch,aIndex) =>{const lRegex=new RegExp(aSearch,'i');lOffre=null;let lEstRechercheBonne=false;for(let k=0;k<lNbOffresStages;k++){lOffre=aEntreprise.listeOffresStages.GetElement(k);lEstRechercheBonne=lOffre.sujet&&lRegex.test(lOffre.sujet.GetLibelle());if(lEstRechercheBonne&&(aIndex===0||lFiltreSujet)){lFiltreSujet=true;break;}}
if(lFiltreSujet&&!lEstRechercheBonne){lFiltreSujet=false;}});}
let lFiltreNbSemaines=true;if(this.filtre.nbrSemaines>0){lFiltreNbSemaines=false;lOffre=null;for(let m=0;m<lNbOffresStages;m++){lOffre=aEntreprise.listeOffresStages.GetElement(m);if(lOffre.dureeEnJours&&lOffre.dureeEnJours>=(this.filtre.nbrSemaines*7)){lFiltreNbSemaines=true;break;}}}
let lFiltrePeriode=true;if(this.options.avecPeriode&&this.options.avecFiltrePeriode&&this.periode&&this.periode.dateDebut&&(this.periode.dateDebut.getTime()>0)&&this.periode.dateFin){lFiltrePeriode=false;lOffre=null;for(let n=0;n<lNbOffresStages;n++){lOffre=aEntreprise.listeOffresStages.GetElement(n);if(!lOffre.periode||(!lOffre.periode.dateDebut&&!lOffre.periode.dateFin)){lFiltrePeriode=true;break;} else if(lOffre.periode.dateDebut&&lOffre.periode.dateFin){if(lOffre.periode.dateDebut<=this.periode.dateDebut&&lOffre.periode.dateFin>=this.periode.dateFin){lFiltrePeriode=true;break;}}}}
aEntreprise.visible=lFiltreActivite&&lFiltreSeulementAvecOffres&&lFiltreSujet&&lFiltreNbSemaines&&lFiltrePeriode;if(this.entrepriseSelectionnee&&this.entrepriseSelectionnee===aEntreprise&&!aEntreprise.visible){this.entrepriseSelectionnee=null;this.GetInstance(this.identListeEntreprises).SelectionnerLigne({deselectionnerTout:true,ligne:-1});}}.bind(this));const lThis=this;this.GetInstance(this.identListeEntreprises).setOptionsListe({listeChipsFiltres:this.getEtatFiltre()?[{event(){_ouvrirFenetreFiltre.call(lThis);},eventBtn(){_setFiltre.call(lThis);_evnFiltre.call(lThis);}}]:[]});this.GetInstance(this.identListeEntreprises).Actualiser(true);}
function _trierListe(aListe){aListe.setTri([
ObjetTri.init('Position'),ObjetTri.init('Libelle')
]);aListe.trier();}
function _evntModeAffDetailOffreStage(aParam){if(aParam){this.GetInstance(this.identDetailOffreDeStage).setDonnees({entreprise:this.entrepriseSelectionnee},aParam.GetGenre());this.GetInstance(this.identDetailOffreDeStage).SetVisible(true);}}
module.exports=InterfaceListeEntreprisesCP;},fn:"interfacelisteentreprisescp.js"});;
IE.fModule({f:function(exports,require,module,global){const{ObjetRequeteConsultation}=require('ObjetRequeteJSON.js');const Requetes=require('CollectionRequetes.js');const ObjetListeElements=require('ObjetListeElements.js');class ObjetRequeteListeOffresStages extends ObjetRequeteConsultation{constructor(...aParams){super(...aParams);}
lancerRequete(){return this.appelAsynchrone();}
actionApresRequete(){const lParam={};lParam.listeEntreprises=this.JSONReponse.listeEntreprises?this.JSONReponse.listeEntreprises:new ObjetListeElements();this.callbackReussite.appel(lParam);}}
Requetes.inscrire('ListeOffresStages',ObjetRequeteListeOffresStages);module.exports=ObjetRequeteListeOffresStages;},fn:"objetrequetelisteoffresstages.js"});;
IE.fModule({f:function(exports,require,module,global){const InterfaceListeEntreprisesCP=require('InterfaceListeEntreprisesCP.js');const ObjetRequeteListeOffresStages=require('ObjetRequeteListeOffresStages.js');class InterfaceListeEntreprises extends InterfaceListeEntreprisesCP{constructor(...aParams){super(...aParams);this.options={avecPeriode:true,avecPeriodeUnique:false};}
RecupererDonnees(){new ObjetRequeteListeOffresStages(this,_actionSurRecupererListeOffres.bind(this)).lancerRequete();}}
function _actionSurRecupererListeOffres(aParam){this.listeEntreprises=aParam.listeEntreprises;this.traiterDonnees();}
module.exports=InterfaceListeEntreprises;},fn:"interfacelisteentreprise.js"});;
IE.fModule({f:function(exports,require,module,global){const{ObjetRequeteConsultation}=require('ObjetRequeteJSON.js');const GChaine=require('GChaine.js');const Requetes=require('CollectionRequetes.js');const EGenreCryptage=require('Enumere_Cryptage.js');const GCryptage=require('ObjetCryptage.js');class ObjetRequetePageMesEnfants extends ObjetRequeteConsultation{constructor(...aParams){super(...aParams);}
lancerRequete(){return this.appelAsynchrone();}
actionApresRequete(){if(!!this.JSONReponse.informationsCompte){const LAvecMotDePasseEnClair=!!this.JSONReponse.informationsCompte.MotDePasse;this.JSONReponse.informationsCompte.MotDePasse=LAvecMotDePasseEnClair?GChaine.ajouterEntites(GCryptage.decrypter({genreCryptage:EGenreCryptage.AES,chaine:this.JSONReponse.informationsCompte.MotDePasse,cle:GApplication.getCommunication().cleAES,iv:GApplication.getCommunication().ivAES})):'*****';this.JSONReponse.informationsCompte.Identifiant=GChaine.ajouterEntites(GCryptage.decrypter({genreCryptage:EGenreCryptage.AES,chaine:this.JSONReponse.informationsCompte.Identifiant,cle:GApplication.getCommunication().cleAES,iv:GApplication.getCommunication().ivAES}));this.JSONReponse.informationsCompte.MotDePasseEnClair=LAvecMotDePasseEnClair;}
this.callbackReussite.appel(this.JSONReponse);}}
Requetes.inscrire('PageMesEnfants',ObjetRequetePageMesEnfants);module.exports=ObjetRequetePageMesEnfants;},fn:"objetrequetepagemesenfants.js"});;
IE.fModule({f:function(exports,require,module,global){const{ObjetRequeteSaisie}=require('ObjetRequeteJSON.js');const Requetes=require('CollectionRequetes.js');class ObjetRequeteSaisieMotDePasseEleve extends ObjetRequeteSaisie{constructor(...aParams){super(...aParams);}
lancerRequete(aParams){this.JSON={motDePasse:GApplication.getCommunication().getChaineChiffreeAES(aParams.nouveauMDP)};return this.appelAsynchrone();}
traiterReponseSaisieMessageErreur(){}
actionApresRequete(){this.callbackReussite.appel({avecErreur:this.reponseEnErreur(),JSON:this.JSONReponse});}}
Requetes.inscrire('SaisieMotDePasseEleve',ObjetRequeteSaisieMotDePasseEleve);module.exports=ObjetRequeteSaisieMotDePasseEleve;},fn:"objetrequetesaisiemotdepasseeleve.js"});;
IE.fModule({f:function(exports,require,module,global){const ObjetIdentite_Mobile=require('ObjetIdentite_Mobile.js');const GTraductions=require('ObjetTraduction.js');const UtilitairePageDonneesPersonnelles=require('UtilitairePageDonneesPersonnelles.js');const EGenreTypeContenu=require('Enumere_DonneesPersonnelles.js').EGenreTypeContenu;const GHtml=require('GHtml.js');const EListeIds=require('Enumere_DonneesPersonnelles.js').EListeIds;const ObjetRequetePageMesEnfants=require('ObjetRequetePageMesEnfants.js');const ObjetFenetre_ModificationIdentifiantMDP=require('ObjetFenetre_ModificationIdentifiantMDP.js');const ObjetFenetre=require('ObjetFenetre.js');const{TypeDroits}=require('ObjetDroitsPN.js');class PageParametresEnfants extends ObjetIdentite_Mobile{constructor(...aParams){super(...aParams);this.parametres={maskMDP:'*********'};}
ConstruirePage(){const lParams={listeProjets:this.donnees.listeProjets};const lHtml=[];if(GApplication.droits.get(TypeDroits.compte.avecSaisieMotDePasseEleve)){lHtml.push(UtilitairePageDonneesPersonnelles.construireZoneGenerique(GTraductions.getValeur('PageCompte.Identifiant'),EGenreTypeContenu.Identifiant,{chaine:this.donnees.informationsCompte.Identifiant}));lHtml.push(UtilitairePageDonneesPersonnelles.construireZoneGenerique(GTraductions.getValeur('PageCompte.MotDePasse'),EGenreTypeContenu.MotDePasse,{maskMdp:this.parametres.maskMDP}));}
if(!!this.donnees.listeNaturesDocumentsAFournir&&this.donnees.listeNaturesDocumentsAFournir.GetNbrElements()>0){const lStrEnfant=GEtatUtilisateur.getMembre().GetLibelle();lHtml.push(UtilitairePageDonneesPersonnelles.construireZoneGenerique(GTraductions.getValeur('infosperso.DocumentAFournir',[lStrEnfant]),EGenreTypeContenu.DepotDocuments,{identListeDocumentsAFournir:this.Pere.GetNomInstance(this.Pere.identListeDocumentsAFournir)}));}
lHtml.push('<div class="border-bottom" id="',this.getInstancePageInformationsMedicales().GetNom(),'"></div>');if(!!this.donnees.listeProjets&&this.donnees.listeProjets.GetNbrElements()>0){lHtml.push(UtilitairePageDonneesPersonnelles.construireZoneGenerique(GTraductions.getValeur('PageCompte.ProjetsAccompagnement'),EGenreTypeContenu.ProjetsAccompagnement,lParams));}
lHtml.push(UtilitairePageDonneesPersonnelles.construireZoneGenerique(GTraductions.getValeur('PageCompte.autorisationsSortie'),EGenreTypeContenu.AutorisationSortie,{identiteAutorisations:this.getInstancePageAutorisationsSortie().GetNom()}));lHtml.push(UtilitairePageDonneesPersonnelles.construireZoneGenerique(GTraductions.getValeur('infosperso.droitImage'),EGenreTypeContenu.DroitImage,{}));lHtml.push(UtilitairePageDonneesPersonnelles.construireZoneGenerique(GTraductions.getValeur('PageCompte.NumeroINE'),EGenreTypeContenu.INE,{numeroINE:this.donnees.numeroINE}));return lHtml.join('');}
getControleur(aInstance){const lControleur=UtilitairePageDonneesPersonnelles.getControleur(aInstance);return $.extend(true,super.getControleur(aInstance),lControleur);}
getInstancePageInformationsMedicales(){return this.Pere.GetInstance(this.Pere.identInformationsMedicales);}
getInstancePageAutorisationsSortie(){return this.Pere.GetInstance(this.Pere.identAutorisationSortie);}
RecupererDonnees(){new ObjetRequetePageMesEnfants(this,_surReponseRequetePageInfosPerso).lancerRequete();}
getStructurePourValidation(aStructure){aStructure.informationsMedicales=this.getInstancePageInformationsMedicales().donnees.infosMedicales;aStructure.allergies=this.getInstancePageInformationsMedicales().donnees.allergies;aStructure.restrictionsAlimentaires=this.getInstancePageInformationsMedicales().donnees.listeRestrictionsAlimentaires;aStructure.autorisationSortie=this.getInstancePageAutorisationsSortie().getAutorisationSortieModifiee();if(this.donnees.droitImage){aStructure.autorisationImage=!this.donnees.droitImage.autoriser;}
aStructure.listeNaturesDocumentsAFournir=this.donnees.listeNaturesDocumentsAFournir;return true;}}
function _afficherPopUp(){const lFenetreModificationMdp=ObjetFenetre.creerInstance(ObjetFenetre_ModificationIdentifiantMDP,{pere:this,initialiser:function(aInstance){aInstance.changementMDP=true;aInstance.changementMDPEleve=true;aInstance.setOptionsFenetre({optionsMDP:{classRequeteSaisie:require('ObjetRequeteSaisieMotDePasseEleve.js')}});}});lFenetreModificationMdp.SetDonnees(GEtatUtilisateur.reglesSaisieMotDePasse);}
function _surReponseRequetePageInfosPerso(aDonnees){this.donnees=aDonnees;if(!!aDonnees.message){GHtml.setHtml(this.Nom,this.composeAucuneDonnee(aDonnees.message));} else{GHtml.setHtml(this.Nom,this.ConstruirePage(),{controleur:this.controleur});$('#'+EListeIds.mdp.escapeJQ()).on({mouseup:function(){_afficherPopUp.call(this);},keyup:function(){if(GNavigateur.IsToucheSelection()){_afficherPopUp.call(this);}}});const lParams={infosMedicales:this.donnees.infosMedicales,restrictionsAlimentaires:this.donnees.restrictionsAlimentaires,mangeALaCantine:this.donnees.mangeALaCantine,allergies:this.donnees.allergies,allergiesModifiables:this.donnees.allergiesModifiables,regimesAlimentairesModifiables:this.donnees.regimesAlimentairesModifiables};this.getInstancePageInformationsMedicales().SetDonnees(lParams);this.getInstancePageAutorisationsSortie().SetDonnees(this.donnees.autorisationSortie);const lIdentListeDocumentsAFournir=this.Pere.GetInstance(this.Pere.identListeDocumentsAFournir);lIdentListeDocumentsAFournir.SetDonnees({listeNaturesDocument:this.donnees.listeNaturesDocumentsAFournir});}}
module.exports=PageParametresEnfants;},fn:"mobile/script/pageparametresenfants.js"});;
IE.fModule({f:function(exports,require,module,global){const GHtml=require('GHtml.js');const GTraductions=require('ObjetTraduction.js');const ObjetInterfacePage=require('InterfacePage.js');class InterfaceAutorisationSortie extends ObjetInterfacePage{constructor(...aParams){super(...aParams);}
getControleur(aInstance){return $.extend(true,super.getControleur(aInstance),{rbAutorisationSortie:{getValue:function(aIndice){return aInstance.donnees.listeAutorisationsSortie.GetElement(aIndice).GetNumero()===aInstance.donnees.selectionEleve.GetNumero();},setValue:function(aIndice){if(aInstance.donnees.avecSaisie){aInstance.donnees.selectionEleve=aInstance.donnees.listeAutorisationsSortie.GetElement(aIndice);aInstance.callback.appel();}}}});}
ConstruireInstances(){}
ConstruireAffichage(){if(this.donneesRecues){return this.composePage();} else{return'';}}
composePage(){const H=[];H.push(this.composeContenuPage());return H.join('');}
composeContenuPage(){const H=[];if(this.donnees.avecSaisie){H.push(this.composeContenuPageEdit());} else{H.push(this.composeContenuPageFinal());}
return H.join('');}
composeContenuPageEdit(){const H=[];H.push('<div>');H.push(GTraductions.getValeur('AutorisationSortie.intro'));H.push('</div>');H.push('<div class="GrandEspaceHaut">');for(let i=0,lNbr=this.donnees.listeAutorisationsSortie.GetNbrElements();i<lNbr;i++){const lAutorisation=this.donnees.listeAutorisationsSortie.GetElement(i);let lDescriptif=lAutorisation.descriptif?lAutorisation.descriptif:lAutorisation.GetLibelle();if(lAutorisation.listeDetailHoraires.length>0){lDescriptif+='<br>'+lAutorisation.listeDetailHoraires.join(' / ');}
H.push('<div class="NoWrap" style="padding-bottom : 10px;">');H.push('<ie-radio id="',this.Nom,'_id_',i,'" ie-model="rbAutorisationSortie(',i,')" class="InlineBlock AlignementHaut" style="margin-top:1px" ></ie-radio>');H.push('<label for="',this.Nom,'_id_',i,'" class="InlineBlock AlignementHaut EspaceGauche">',lDescriptif,'</label>');H.push('</div>');}
H.push('</div>');return H.join('');}
composeContenuPageFinal(){const lAutorisation=this.donnees.listeAutorisationsSortie.GetElementParNumeroEtGenre(this.donnees.selectionEleve.GetNumero());let lDescriptif=lAutorisation.descriptif?lAutorisation.descriptif:lAutorisation.GetLibelle();if(lAutorisation.listeDetailHoraires.length>0){lDescriptif+='<br />'+lAutorisation.listeDetailHoraires.join(' / ');}
const H=[];H.push(`<p>${GTraductions.getValeur('AutorisationSortie.fixee')}</p>`);H.push(`<p>${lDescriptif}</p>`);return H.join('');}
SetDonnees(aDonnees){this.donneesRecues=true;this.donnees=aDonnees;GHtml.setHtml(this.Nom,this.ConstruireAffichage(),{controleur:this.controleur});}
getAutorisationSortieModifiee(){return!!this.donnees?this.donnees.selectionEleve:null;}}
module.exports=InterfaceAutorisationSortie;},fn:"interfaceautorisationsortie.js"});;
IE.fModule({f:function(exports,require,module,global){const ObjetPageParametresEnfants=require('mobile/script/PageParametresEnfants.js');const InterfacePage_Mobile=require('InterfacePage_Mobile.js');const EStructureAffichage=require('Enumere_StructureAffichage.js');const InterfaceDocumentsAFournir=require('InterfaceDocumentsAFournir.js');const ObjetInformationsMedicales=require('PageInformationsMedicales.js');const ObjetRequeteSaisieCompteEnfant=require('ObjetRequeteSaisieCompteEnfant.js');const InterfaceAutorisationSortie=require('InterfaceAutorisationSortie.js');require('produit/css/PageCompteCommune.css');class ObjetAffichagePageParametresEnfants_Mobile extends InterfacePage_Mobile{constructor(...aParams){super(...aParams);}
ConstruireInstances(){this.identPage=this.Add(ObjetPageParametresEnfants);this.identInformationsMedicales=this.Add(ObjetInformationsMedicales,this._evenementInformationsMedicales);this.identListeDocumentsAFournir=this.Add(InterfaceDocumentsAFournir);this.identAutorisationSortie=this.Add(InterfaceAutorisationSortie,_evenementAutorisationSortie);}
SetParametresGeneraux(){this.GenreStructure=EStructureAffichage.Autre;}
ConstruireStructureAffichageAutre(){var H=[];H.push('<div class="PageCompte">');H.push('<div class="compte-contain" id="',this.GetInstance(this.identPage).GetNom(),'"></div>');H.push('</div>');return H.join('');}
_evenementInformationsMedicales(){this.Valider();}
ActionSurValidation(){super.ActionSurValidation();this.GetInstance(this.identPage).RecupererDonnees();}
Valider(){const lStructure={};if(this.GetInstance(this.identPage).getStructurePourValidation(lStructure)){this.SetEtatSaisie(false);this.lListeActuellePJ=this.GetInstance(this.identListeDocumentsAFournir).getListeFichiersAUpload();new ObjetRequeteSaisieCompteEnfant(this,this.ActionSurValidation).addUpload({listeFichiers:this.lListeActuellePJ}).lancerRequete(lStructure);}}}
function _evenementAutorisationSortie(){this.Valider();}
module.exports=ObjetAffichagePageParametresEnfants_Mobile;},fn:"mobile/script/interfacepageparametresenfants.js"});;
IE.fModule({f:function(exports,require,module,global){const ObjetDonneesListeFlatDesign=require('ObjetDonneesListeFlatDesign.js');const{TypeEtatPub,TypeGenreModerationForum,TypeRoleIndividuSujet}=require('TypesForumPedagogique.js');const tag=require('tag.js');const GTraductions=require('ObjetTraduction.js');const ObjetTri=require('ObjetTri.js');class DonneesListe_Forum_ListeSujets extends ObjetDonneesListeFlatDesign{constructor(aDonnees){super(aDonnees);this.setOptions({avecEvnt_Selection:true,avecEvnt_ModificationSelection:true});}
getZoneGauche(aParams){return tag('div',{class:'couleur-matiere',style:aParams.article.matiere?`background-color:${aParams.article.matiere.couleur};`:false});}
getTitreZonePrincipale(aParams){return aParams.article.titre||GTraductions.getValeur('ForumPeda.SansTitre');}
getInfosSuppZonePrincipale(aParams){return`${aParams.article.strAuteur} - ${this.options.moteurForum.getStrNbParticipantsSujet(aParams.article)}`;}
getZoneComplementaire(aParams){const H=[];const lHIcones=[];if(aParams.article.nbNonLu>0){lHIcones.push(tag('span',{class:'compteur-nlu',title:GTraductions.getValeur('ForumPeda.HintNouveauxPosts')},aParams.article.nbNonLu));}
if(aParams.article.nbAModerer>0){lHIcones.push(tag('i',{class:'icon icon_warning_sign',title:GTraductions.getValeur('ForumPeda.AModerer')}));}
if(aParams.article.nbExclus>0){lHIcones.push(tag('i',{class:'icon icon_user mix-icon_ne_pas_deranger',title:GTraductions.getValeur('ForumPeda.HintBloque_D',[aParams.article.nbExclus])}));}
if(aParams.article.etatPub===TypeEtatPub.EP_Ferme){lHIcones.push(tag('i',{class:'icon icon_time',title:this.options.moteurForum.getStrMessageParticipationFermee(aParams.article)}));}
if(aParams.article.etatPub===TypeEtatPub.EP_Verrou){lHIcones.push(tag('i',{class:'icon icon_lock',title:GTraductions.getValeur('ForumPeda.ForumVerrouille')}));}
if(lHIcones.length>0){H.push(tag('div',{class:'icones-conteneur'},lHIcones.join('')));}
return H.join('');}
getZoneMessage(aParams){const H=[];if(aParams.article.etatPub===TypeEtatPub.EP_Suspendu){H.push(tag('p',GTraductions.getValeur('ForumPeda.SujetSuspendu')));}
if(aParams.article.roles.contains(TypeRoleIndividuSujet.RIS_Moderateur)){H.push(tag('p',{class:'color-theme-foncee'},aParams.article.genreModeration===TypeGenreModerationForum.GMF_APriori?GTraductions.getValeur('ForumPeda.ModerationAvantPub'):GTraductions.getValeur('ForumPeda.ModerationApresPub')));}
if(aParams.article.estExclu){H.push(tag('p',GTraductions.getValeur('ForumPeda.ParticipationBloque')));}
return H.join('');}
avecBoutonActionLigne(aParams){return this.options.moteurForum.getCommandesMenuContextuel_sujet(aParams.article).length>0;}
initialisationObjetContextuel(aParametres){if(!aParametres.menuContextuel){return;}
this.options.moteurForum.addCommandesMenuContextuel_sujet(aParametres);aParametres.menuContextuel.SetDonnees(aParametres.id);}
estLigneOff(aParams){return aParams.article.etatPub!==TypeEtatPub.EP_Ouvert||aParams.article.estExclu||(aParams.article.roles.count()===1&&aParams.article.roles.contains(TypeRoleIndividuSujet.RIS_Visiteur));}
getTri(){return[
ObjetTri.init('dateTri',ObjetTri.genreTri.Decroissant),ObjetTri.init('Libelle')
];}}
module.exports=DonneesListe_Forum_ListeSujets;},fn:"donneesliste_forum_listesujets.js"});;
IE.fModule({f:function(exports,require,module,global){require('espace/css/DonneesListe_RessourceMatiere.css');const ObjetDonneesListeFlatDesign=require('ObjetDonneesListeFlatDesign.js');const tag=require('tag.js');class DonneesListe_RessourceMatiere extends ObjetDonneesListeFlatDesign{constructor(aDonnees){super(aDonnees);this.setOptions({avecEvnt_Selection:true,avecTri:false,flatDesignMinimal:true,avecBoutonActionLigne:false,genreToutesMatieres:-1});}
getZoneGauche(aParams){return aParams.article.GetGenre()===this.options.genreToutesMatieres?tag('i',{class:'icon_th_large'}):tag('div',{class:'couleur',style:(aParams.article.couleurFond?`background-color:${aParams.article.couleurFond};`:false)});}
getZoneComplementaire(aParams){const H=[];if(aParams.article.GetGenre()!==this.options.genreToutesMatieres){if(!isNaN(aParams.article.count)||!isNaN(aParams.article.nbElementsConcernes)){H.push(tag('div',{class:'compteur'},!isNaN(aParams.article.count)?aParams.article.count:!isNaN(aParams.article.nbElementsConcernes)?aParams.article.nbElementsConcernes:''));}}
return H.join('');}
getClassCelluleConteneur(aParams){return aParams.article.GetGenre()!==this.options.genreToutesMatieres?'matiere-spe':'';}}
module.exports=DonneesListe_RessourceMatiere;},fn:"donneesliste_ressourcematiere.js"});;
IE.fModule({f:function(exports,require,module,global){const ObjetInterfacePageCP=require('ObjetInterfacePageCP.js');const ObjetListe=require('ObjetListe.js');const MoteurForumPedagogique=require('MoteurForumPedagogique.js');const DonneesListe_Forum_ListeSujets=require('DonneesListe_Forum_ListeSujets.js');const tag=require('tag.js');const EStructureAffichage=require('Enumere_StructureAffichage.js');const GTraductions=require('ObjetTraduction.js');const EGenreEvenementListe=require('Enumere_EvenementListe.js');const ObjetListeElements=require('ObjetListeElements.js');const ObjetElement=require('ObjetElement.js');const ObjetForumVisuPosts=require('ObjetForumVisuPosts.js');const{TypeDroits}=require('ObjetDroitsPN.js');const ObjetTri=require('ObjetTri.js');const ObjetFenetre=require('ObjetFenetre.js');const DonneesListe_RessourceMatiere=require('DonneesListe_RessourceMatiere.js');const{TypeRoleIndividuSujet}=require('TypesForumPedagogique.js');const EGenreRessource=require('Enumere_Ressource.js');class InterfaceForumPedagogique extends ObjetInterfacePageCP{constructor(...aParams){super(...aParams);this.GenreStructure=EStructureAffichage.Autre;this.moteurForum=new MoteurForumPedagogique({pere:this,callbackActualisationSujets:(aParams) =>{return _requeteSujets_promise.call(this,aParams);},ouvrirEditionSujet_promise:() =>{return Promise.reject('a implementer');}});this.donnees={};this.filtres={};}
RecupererDonnees(){_requeteSujets_promise.call(this);}
ConstruireInstances(){if(this.options.avecListeMatieres){this.identListeMatieres=this.Add(ObjetListe,(aParametres) =>{switch(aParametres.genreEvenement){case EGenreEvenementListe.Selection:{this.filtres.matiereSelec=aParametres.article;_actualiserSujets_promise.call(this);break;}}},(aListe) =>{aListe.setOptionsListe({skin:ObjetListe.skin.flatDesign});});}
this.identListeSujets=this.Add(ObjetListe,_surEvenementListeSujets,(aListe) =>{aListe.setOptionsListe({skin:ObjetListe.skin.flatDesign,nonEditableSurModeExclusif:true,avecOmbreDroite:true,avecLigneCreation:GApplication.droits.get(TypeDroits.forum.avecCreationSujetForum),titreCreation:GTraductions.getValeur('ForumPeda.NouveauSujet'),messageContenuVide:GTraductions.getValeur('ForumPeda.AucunForum')});});this.identPosts=this.Add(ObjetForumVisuPosts,null,(aInstance) =>{if(IE.estMobile){aInstance.Visible=false;}
aInstance.init(this.moteurForum);});}
ConstruireStructureAffichageAutre(){return tag('div',{class:'InterfaceForumPedagogique'},this.options.avecListeMatieres?tag('section',{class:'liste-matieres',id:this.GetInstance(this.identListeMatieres).Nom}):'',tag('section',{class:'liste-sujets',id:this.GetInstance(this.identListeSujets).Nom}),tag('aside',{class:['posts'],id:this.GetInstance(this.identPosts).Nom}));}}
const c_ident_filtre_tous= -100;const c_ident_filter_aucun=c_ident_filtre_tous+1;function _requeteSujets_promise(aParams){let lSujetSelection=null;if(aParams&&aParams.sujetSelection){lSujetSelection=aParams.sujetSelection;}
return this.moteurForum.requeteListeSujets().then((aListeSujets) =>{this.donnees.listeSujets=aListeSujets;return _actualiserSujets_promise.call(this,lSujetSelection,aParams);});}
function _surEvenementListeSujets(aParametres){const lInstanceListe=this.GetInstance(this.identListeSujets);const lInstancePosts=this.GetInstance(this.identPosts);switch(aParametres.genreEvenement){case EGenreEvenementListe.Creation:this.moteurForum.editerSujet(null);return;case EGenreEvenementListe.Selection:{lInstancePosts.setSujet(lInstanceListe.getElementSelection(),{forcerChangementSujet:true,avecBasculeEcran:true});return;}
case EGenreEvenementListe.ModificationSelection:{if(!lInstanceListe.getElementSelection()){lInstancePosts.setSujet(null);}
return;}}}
function _ouvrirFenetreFiltre(){const H=[];if(this.filtres.listeMatieresDisponibles&&this.filtres.listeMatieresDisponibles.GetNbrElements()>0){H.push(tag('div',{class:'field-contain'},tag('label',GTraductions.getValeur('Matiere')),tag('ie-combo',{'ie-model':'comboMatiere',class:'combo-selecteur'})));}
if(this.filtres.listeThemesDisponibles&&this.filtres.listeThemesDisponibles.GetNbrElements()>0){H.push(tag('div',{class:'field-contain'},tag('label',GTraductions.getValeur('ForumPeda.Theme')),tag('ie-combo',{'ie-model':'comboTheme',class:'combo-selecteur'})));}
if(this.filtres.listeModerationsDisponibles&&this.filtres.listeModerationsDisponibles.GetNbrElements()>0){H.push(tag('div',{class:'field-contain'},tag('label',GTraductions.getValeur('ForumPeda.TitreListeSujet')),tag('ie-combo',{'ie-model':'comboModeration',class:'combo-selecteur'})));}
let lMatiereSelec=this.filtres.matiereSelec;let lThemeSelec=this.filtres.themeSelec;let lModerationSelec=this.filtres.moderationSelec;const lOptionsCombo={longueur:'100%',getContenuCellule(aElement){return aElement.GetLibelle();},getContenuElement(aParams){return aParams.element.GetLibelle();}};ObjetFenetre.creerInstance(ObjetFenetre,{pere:this,initialiser(aFenetre){aFenetre.setOptionsFenetre({titre:GTraductions.getValeur('liste.Filtrer'),cssFenetre:'InterfaceForumPedagogique_fenetre_filtre',largeur:300,listeBoutons:[GTraductions.getValeur('Annuler'),{libelle:GTraductions.getValeur('Valider'),valider:true}],fermerFenetreSurClicHorsFenetre:IE.estMobile});const lFiltres=this.filtres;Object.assign(aFenetre.controleur,{comboMatiere:{init(aCombo){let lIndice=0;if(lMatiereSelec){lIndice=lFiltres.listeMatieresDisponibles.GetIndiceParNumeroEtGenre(lMatiereSelec.GetNumero())||0;}
aCombo.setOptions_ObjetSaisie(lOptionsCombo).SetDonnees(lFiltres.listeMatieresDisponibles,lIndice);},event(aParametres){if(aParametres.estSelectionManuelle){lMatiereSelec=aParametres.element;}}},comboTheme:{init(aCombo){let lIndice=0;if(lThemeSelec){lIndice=lFiltres.listeThemesDisponibles.GetIndiceParNumeroEtGenre(lThemeSelec.GetNumero())||0;}
aCombo.setOptions_ObjetSaisie(lOptionsCombo).SetDonnees(lFiltres.listeThemesDisponibles,lIndice);},event(aParametres){if(aParametres.estSelectionManuelle){lThemeSelec=aParametres.element;}}},comboModeration:{init(aCombo){let lIndice=0;if(lModerationSelec){lIndice=lFiltres.listeModerationsDisponibles.GetIndiceParNumeroEtGenre(lModerationSelec.GetNumero())||0;}
aCombo.setOptions_ObjetSaisie(lOptionsCombo).SetDonnees(lFiltres.listeModerationsDisponibles,lIndice);},event(aParametres){if(aParametres.estSelectionManuelle){lModerationSelec=aParametres.element;}}}});}}).Afficher(H.join('')).then((aParams) =>{if(aParams.bouton&&aParams.bouton.valider){Object.assign(this.filtres,{matiereSelec:lMatiereSelec,themeSelec:lThemeSelec,moderationSelec:lModerationSelec});_actualiserSujets_promise.call(this);}});}
function _constructionFiltres(){const lListeSujetsOrigine=this.donnees.listeSujets;let lAvecFiltreEnCours=false;let lAvecFiltresPossible=false;let lListeSujetsFiltre=new ObjetListeElements().add(lListeSujetsOrigine);const lListeMatieres=new ObjetListeElements();lListeMatieres.add(new ObjetElement({Libelle:GTraductions.getValeur('ToutesLesMatieres'),Numero:c_ident_filtre_tous,Genre:c_ident_filtre_tous,count:lListeSujetsOrigine.GetNbrElements()}));let lHorsMatiere=new ObjetElement({Libelle:GTraductions.getValeur('ForumPeda.HorsMatiere'),Numero:c_ident_filter_aucun,count:0});lListeMatieres.add(lHorsMatiere);lListeSujetsOrigine.parcourir((aSujet) =>{let lMatiereTrouve=null;if(!aSujet.matiere){lMatiereTrouve=lHorsMatiere;} else{lMatiereTrouve=lListeMatieres.GetElementParElement(aSujet.matiere);if(!lMatiereTrouve){lMatiereTrouve=new ObjetElement({Libelle:aSujet.matiere.Libelle,Numero:aSujet.matiere.Numero,couleurFond:aSujet.matiere.couleur,count:0});lListeMatieres.add(lMatiereTrouve);}}
lMatiereTrouve.count+=1;});lListeMatieres.setTri([
ObjetTri.init((D) => D.GetNumero()!==c_ident_filtre_tous),ObjetTri.init((D) => D.GetNumero()===c_ident_filter_aucun),ObjetTri.init('Libelle')
]).trier();if(this.filtres.matiereSelec&&!lListeMatieres.GetElementParElement(this.filtres.matiereSelec)){this.filtres.matiereSelec=null;}
if(this.options.avecListeMatieres){let lIndiceSelection=0;if(this.filtres.matiereSelec){lIndiceSelection=lListeMatieres.GetIndiceParNumeroEtGenre(this.filtres.matiereSelec.GetNumero());}
this.GetInstance(this.identListeMatieres).SetDonnees(new DonneesListe_RessourceMatiere(lListeMatieres).setOptions({genreToutesMatieres:c_ident_filtre_tous}));this.GetInstance(this.identListeMatieres).SelectionnerLigne({ligne:lIndiceSelection||0});this.filtres.listeMatieresDisponibles=null;} else{this.filtres.listeMatieresDisponibles=lListeMatieres;lAvecFiltresPossible=true;}
if(this.filtres.matiereSelec&&this.filtres.matiereSelec.GetNumero()!==c_ident_filtre_tous){lAvecFiltreEnCours=!this.options.avecListeMatieres;const lNumeroMatiereFiltre=this.filtres.matiereSelec.GetNumero();lListeSujetsFiltre=lListeSujetsFiltre.getListeElements((aSujet) =>{return(!aSujet.matiere&&lNumeroMatiereFiltre===c_ident_filter_aucun)||(aSujet.matiere&&aSujet.matiere.GetNumero()===lNumeroMatiereFiltre);});}
const lListeThemes=this.filtres.listeThemesDisponibles=new ObjetListeElements();if(this.moteurForum.avecGestionThemes()){lAvecFiltresPossible=true;lListeThemes.add(new ObjetElement({Libelle:GTraductions.getValeur('ForumPeda.TouslesThemes'),Numero:c_ident_filtre_tous,count:lListeSujetsOrigine.GetNbrElements()}));lListeSujetsOrigine.parcourir((aSujet) =>{let lThemeTrouve=null;if(aSujet.listeThemes){aSujet.listeThemes.parcourir((aTheme) =>{lThemeTrouve=lListeThemes.GetElementParElement(aTheme);if(!lThemeTrouve){lThemeTrouve=new ObjetElement({Libelle:aTheme.Libelle,Numero:aTheme.Numero,count:0});lListeThemes.add(lThemeTrouve);}
lThemeTrouve.count+=1;});}});lListeThemes.setTri([
ObjetTri.init((D) => D.GetNumero()!==c_ident_filtre_tous),ObjetTri.init('Libelle')
]).trier();if(this.filtres.themeSelec&&!lListeThemes.GetElementParElement(this.filtres.themeSelec)){this.filtres.themeSelec=null;}
if(this.filtres.themeSelec&&this.filtres.themeSelec.GetNumero()!==c_ident_filtre_tous){lAvecFiltreEnCours=true;lListeSujetsFiltre=lListeSujetsFiltre.getListeElements((aSujet) =>{return!!(aSujet.listeThemes&&aSujet.listeThemes.GetElementParElement(this.filtres.themeSelec));});}}
const lListeModerations=this.filtres.listeModerationsDisponibles=new ObjetListeElements();let lAvecChoixAuteur=GApplication.droits.get(TypeDroits.forum.avecCreationSujetForum);if(!lAvecChoixAuteur){lListeSujetsOrigine.parcourir((aSujet) =>{if(aSujet.roles.contains(TypeRoleIndividuSujet.RIS_Auteur)){lAvecChoixAuteur=true;return false;}});}
if(lAvecChoixAuteur){lListeModerations.add(new ObjetElement({Libelle:GTraductions.getValeur('ForumPeda.Auteur'),Numero:TypeRoleIndividuSujet.RIS_Auteur,count:0}));}
if([EGenreRessource.Enseignant,EGenreRessource.Personnel].includes(GEtatUtilisateur.getUtilisateur().GetGenre())){lListeModerations.add(new ObjetElement({Libelle:GTraductions.getValeur('ForumPeda.Moderateur'),Numero:TypeRoleIndividuSujet.RIS_Moderateur,count:0}));}
if([EGenreRessource.Enseignant,EGenreRessource.Personnel,EGenreRessource.Eleve].includes(GEtatUtilisateur.getUtilisateur().GetGenre())){lListeModerations.add(new ObjetElement({Libelle:GTraductions.getValeur('ForumPeda.Membre'),Numero:TypeRoleIndividuSujet.RIS_Membre,count:0}));}
if([EGenreRessource.Personnel].includes(GEtatUtilisateur.getUtilisateur().GetGenre())){lListeModerations.add(new ObjetElement({Libelle:GTraductions.getValeur('ForumPeda.Visiteur'),Numero:TypeRoleIndividuSujet.RIS_Visiteur,count:0}));}
const lFiltreRole=(aSujet,aRole) =>{switch(aRole){case TypeRoleIndividuSujet.RIS_Auteur:return aSujet.roles.contains(aRole);case TypeRoleIndividuSujet.RIS_Moderateur:return aSujet.roles.contains(TypeRoleIndividuSujet.RIS_Moderateur)&&!aSujet.roles.contains(TypeRoleIndividuSujet.RIS_Auteur);case TypeRoleIndividuSujet.RIS_Membre:return aSujet.roles.contains(TypeRoleIndividuSujet.RIS_Membre)&&!aSujet.roles.contains(TypeRoleIndividuSujet.RIS_Moderateur)&&!aSujet.roles.contains(TypeRoleIndividuSujet.RIS_Auteur);case TypeRoleIndividuSujet.RIS_Visiteur:return aSujet.roles.count()===1&&aSujet.roles.contains(aRole);}};if(lListeModerations.GetNbrElements()>1){lListeModerations.insererElement(new ObjetElement({Libelle:GTraductions.getValeur('ForumPeda.Filtre_TousLesForums'),Numero:c_ident_filtre_tous,count:lListeSujetsOrigine.GetNbrElements()}),0);lListeSujetsOrigine.parcourir((aSujet) =>{for(const lRole of aSujet.roles.items()){const lFiltre=lListeModerations.GetElementParNumeroEtGenre(lRole);if(lFiltre&&lFiltreRole(aSujet,lRole)){lFiltre.count+=1;}}});} else{this.filtres.listeModerationsDisponibles=null;this.filtres.moderationSelec=null;}
if(this.filtres.moderationSelec&&this.filtres.moderationSelec.GetNumero()!==c_ident_filtre_tous){lAvecFiltreEnCours=true;lAvecFiltresPossible=true;lListeSujetsFiltre=lListeSujetsFiltre.getListeElements((aSujet) =>{return lFiltreRole(aSujet,this.filtres.moderationSelec.GetNumero());});}
const lInstanceListe=this.GetInstance(this.identListeSujets);const lInstance=this;const lBoutons=[{genre:ObjetListe.typeBouton.rechercher}];if(lAvecFiltresPossible){lBoutons.push({genre:ObjetListe.typeBouton.filtrer,event:() =>{_ouvrirFenetreFiltre.call(this);},getDisabled:() =>{const lListeSujets=this.donnees.listeSujets;return!lListeSujets||lListeSujets.GetNbrElements()===0;}});}
const lListeFiltres=[];if(lAvecFiltreEnCours){lListeFiltres.push({event(){_ouvrirFenetreFiltre.call(lInstance);},eventBtn(){Object.assign(lInstance.filtres,{matiereSelec:lInstance.options.avecListeMatieres?lInstance.filtres.matiereSelec:null,themeSelec:null,moderationSelec:null});_actualiserSujets_promise.call(lInstance);}});}
lInstanceListe.setOptionsListe({boutons:lBoutons,listeChipsFiltres:lListeFiltres});return lListeSujetsFiltre;}
function _actualiserSujets_promise(aSujetSelection,aParamsRetour){const lInstanceListe=this.GetInstance(this.identListeSujets);let lSujetSelectionPrecedent=lInstanceListe.getElementSelection();let lSujetSelection=aSujetSelection||lSujetSelectionPrecedent;const lListeSujetsFiltre=_constructionFiltres.call(this);lInstanceListe.SetDonnees(new DonneesListe_Forum_ListeSujets(lListeSujetsFiltre).setOptions({moteurForum:this.moteurForum}));if(lSujetSelection){lInstanceListe.setListeElementsSelection(new ObjetListeElements().add(lSujetSelection),{avecScroll:true});lSujetSelection=lInstanceListe.getElementSelection();}
return this.GetInstance(this.identPosts).setSujet(lSujetSelection,Object.assign({forcerChangementSujet:false,avecBasculeEcran:false},aParamsRetour));}
module.exports=InterfaceForumPedagogique;},fn:"interfaceforumpedagogique.js"});;
IE.fModule({f:function(exports,require,module,global){const GStyle=require('GStyle.js');const ObjetTri=require('ObjetTri.js');const ObjetDonneesListeFlatDesign=require('ObjetDonneesListeFlatDesign.js');class DonneesListe_SelectionMatiere extends ObjetDonneesListeFlatDesign{constructor(aDonnees,aFiltreEnseignees){super(aDonnees);this.setOptions({avecBoutonActionLigne:false,avecEvnt_Selection:true,flatDesignMinimal:true});this.filtreUniquementEnseignees=aFiltreEnseignees===true?true:false;}
getTitreZonePrincipale(aParams){return aParams.article.GetLibelle();}
getZoneMessage(aParams){return aParams.article.code||'';}
getZoneGauche(aParams){return aParams.article.couleur?'<div style="'+GStyle.composeCouleurFond(aParams.article.couleur)+'height:2rem;padding:0.2rem;border-radius:0.4rem;"></div>':'<div style="margin-right:0.4rem"></div>';}
GetVisible(D){if(this.filtreUniquementEnseignees){return D.estEnseignee===true;}
return true;}
getTri(){const lTris=[];lTris.push(ObjetTri.init(function(D){return!!D.existeNumero();}));lTris.push(ObjetTri.init('Libelle'));return lTris;}}
module.exports=DonneesListe_SelectionMatiere;},fn:"donneesliste_selectionmatiere.js"});;
IE.fModule({f:function(exports,require,module,global){const DonneesListe_SelectionMatiere=require('DonneesListe_SelectionMatiere.js');const EGenreEvenementListe=require('Enumere_EvenementListe.js');const EGenreTriElement=require('Enumere_TriElement.js');const ObjetFenetre=require('ObjetFenetre.js');const ObjetListe=require('ObjetListe.js');const ObjetElement=require('ObjetElement.js');const ObjetListeElements=require('ObjetListeElements.js');const GTraductions=require('ObjetTraduction.js');const ObjetTri=require('ObjetTri.js');class ObjetFenetre_SelectionMatiere extends ObjetFenetre{constructor(...aParams){super(...aParams);this.setOptionsFenetre({titre:GTraductions.getValeur('Matieres'),largeur:300,hauteur:400,listeBoutons:[GTraductions.getValeur('Fermer')]});this.avecChoixFiltrageEnseignees=false;this.filtreEnseignees=false;this.libelleFiltreEnseignees='';}
ConstruireInstances(){this.identListe=this.Add(ObjetListe,this.evntSurListe);}
getControleur(aInstance){return $.extend(true,super.getControleur(this),{cbFiltreUniquementEnseignees:{getValue:function(){return!!aInstance.filtreEnseignees;},setValue:function(aValeur){aInstance.filtreEnseignees=aValeur;aInstance.GetInstance(aInstance.identListe).SetDonnees(new DonneesListe_SelectionMatiere(aInstance.listeMatieres,aInstance.filtreEnseignees));aInstance.indiceSelection= -1;},getLibelle:function(){return aInstance.libelleFiltreEnseignees||'';}}});}
ComposeContenu(){const T=[];T.push('<div id="'+this.GetNomInstance(this.identListe)+'" style="height: ',this.optionsFenetre.hauteur-65,'px"></div>');return T.join('');}
SetDonnees(aListeMatieres,aAvecFiltrage,aAvecLigneAucune,aFiltreEnseignees){this.avecChoixFiltrageEnseignees=aAvecFiltrage===true?true:false;this.avecLigneAucune=aAvecLigneAucune===true?true:false;if(aFiltreEnseignees!==undefined){this.filtreEnseignees=aFiltreEnseignees;} else{this.filtreEnseignees=this.avecChoixFiltrageEnseignees;}
this.Actualiser();this.Afficher();this.listeMatieres=new ObjetListeElements();this.listeMatieres.FusionnerListe(aListeMatieres);if(this.avecLigneAucune){const lElement=new ObjetElement(GTraductions.getValeur('fenetre.Aucune'),0,null,0);lElement.estEnseignee=true;lElement.code='';this.listeMatieres.AddElement(lElement);}
this.listeMatieres.setTri([ObjetTri.init('Position',EGenreTriElement.Decroissant),ObjetTri.init('Libelle')]);this.listeMatieres.trier();this.indiceSelection=null;const lFiltre=[];if(this.avecChoixFiltrageEnseignees){lFiltre.push({html:'<ie-checkbox ie-model="cbFiltreUniquementEnseignees"></ie-checkbox>',controleur:this.controleur});}
lFiltre.push({genre:ObjetListe.typeBouton.rechercher});this.GetInstance(this.identListe).setOptionsListe({colonnes:[{taille:'100%'}],avecListeNeutre:true,skin:ObjetListe.skin.flatDesign,boutons:lFiltre});this.GetInstance(this.identListe).SetDonnees(new DonneesListe_SelectionMatiere(this.listeMatieres,this.filtreEnseignees));}
SurValidation(aNumeroBouton){const lMatiereSelectionnee=this.listeMatieres.GetElement(this.indiceSelection);this.Fermer();this.callback.appel(aNumeroBouton,this.indiceSelection,lMatiereSelectionnee?lMatiereSelectionnee.GetNumero():null);}
evntSurListe(aParametres,aGenreEvenementListe,I,J){switch(aGenreEvenementListe){case EGenreEvenementListe.Selection:{this.indiceSelection=J;this.SurValidation(1);break;}}}}
module.exports=ObjetFenetre_SelectionMatiere;},fn:"objetfenetre_selectionmatiere.js"});;
IE.fModule({f:function(exports,require,module,global){const ObjetFenetre=require('ObjetFenetre.js');const ObjetElement=require('ObjetElement.js');const GTraductions=require('ObjetTraduction.js');const tag=require('tag.js');const GHtml=require('GHtml.js');const GUID=require('GUID.js');const EGenreEtat=require('Enumere_Etat.js');const EGenreBoiteMessage=require('Enumere_BoiteMessage.js');const TypeThemeBouton=require('Type_ThemeBouton.js');const EGenreAction=require('Enumere_Action.js');const ObjetFenetre_SelectionMatiere=require('ObjetFenetre_SelectionMatiere.js');const MethodesObjet=require('MethodesObjet.js');const MethodesTableau=require('MethodesTableau.js');const EGenreEspace=require('Enumere_Espace.js');class ObjetFenetre_EditionTheme extends ObjetFenetre{constructor(...aParams){super(...aParams);this.setOptionsFenetre({largeur:300,hauteur:null,avecTailleSelonContenu:true,avecComposeBasInFooter:true,titre:GTraductions.getValeur('Theme.titre.editionTheme'),listeBoutons:[GTraductions.getValeur('Fermer'),{theme:TypeThemeBouton.primaire,libelle:GTraductions.getValeur('Modifier')}]});this.ids={btnTrash:GUID.getId()};this.enCreation=false;}
getControleur(aInstance){return $.extend(true,super.getControleur(aInstance),{btnTrash:{event:function(){GApplication.getMessage().afficher({type:EGenreBoiteMessage.Confirmation,message:aInstance.theme.estUtiliseParAuteur?GTraductions.getValeur('Theme.msg.confSupprThemeUtiliseAuteur',aInstance.theme.GetLibelle()):GTraductions.getValeur('Theme.msg.confSupprTheme'),callback:function(aGenreAction){if(aGenreAction===EGenreAction.Valider){aInstance.theme.SetEtat(EGenreEtat.Suppression);aInstance.theme.cmsActif=false;aInstance.Fermer();aInstance.callback.appel(aInstance.theme);}}});},hint:function(){return GTraductions.getValeur('Supprimer');}},LibelleTheme:{getValue:function(){aInstance.SetBoutonActif(1,!!aInstance.theme&&!!aInstance.theme.GetLibelle()?true:false);return aInstance.theme?aInstance.theme.GetLibelle():'';},setValue:function(aValue){if(aInstance.theme){aValue=aValue.replaceAll('\n','');aInstance.theme.SetLibelle(aValue);aInstance.enModification=true;}}},Matiere:{getHtmlMatiere:function(){let lStrMatiere='';if(!!aInstance.theme&&!!aInstance.theme.matiere){lStrMatiere=aInstance.theme.matiere.GetLibelle();}
return lStrMatiere||'&nbsp;';},nodeInputTexte:function(){$(this.node).eventValidation(function(){aInstance.surBoutonChoixMatiere();});}}});}
ComposeContenu(){const T=[];T.push(`<div class="flex-contain cols">\n                    <div class="field-contain">\n                    <label class="ie-titre-petit">${GTraductions.getValeur('Theme.label.matiere')}</label>\n                    <div class="like-input AvecMain theme-picker" ie-html="Matiere.getHtmlMatiere" ie-node="Matiere.nodeInputTexte" tabindex="0"></div>\n                    </div>`);T.push(tag('div',{class:'field-contain'},tag('ie-textareamax',{'ie-autoresize':true,type:'text','ie-model':'LibelleTheme',class:'round-style',style:'width:100%;',title:GTraductions.getValeur('Theme.label.libelle'),'maxlength':this.tailleLibelleTheme,'placeholder':GTraductions.getValeur('Theme.label.libelle')})));T.push(`</div>`);return T.join('');}
SetDonnees(aParams,aParametres){this.theme=aParams.article?MethodesObjet.dupliquer(aParams.article):new ObjetElement();this.listeMatieres=aParametres.listeMatieres;this.tailleLibelleTheme=aParametres.tailleLibelleTheme;if(aParametres.enCreation){this.enCreation=true;GHtml.setDisplay(this.ids.btnTrash,false);this.theme.matiere=aParametres.matiereContexte;}
this.enModification=false;this.Afficher(this.ComposeContenu());this.positionnerFenetre();}
ComposeBas(){const lHTML=[];lHTML.push(`<div id="${this.ids.btnTrash}" class="compose-bas">\n                    <ie-btnicon ie-model="btnTrash" ie-hint="btnTrash.hint" class="icon_trash avecFond i-medium"></ie-btnicon>\n                </div>`);return lHTML.join('');}
SurValidation(aGenreBouton){if(aGenreBouton===1){if(this.theme.estMixte){const lThis=this;GApplication.getMessage().afficher({type:EGenreBoiteMessage.Confirmation,message:`<div>${GTraductions.getValeur('Theme.msg.modifThemeMixte')}</div><div class="EspaceHaut">${GTraductions.getValeur('Theme.msg.confModifTheme')}</div>`,callback:function(aGenreAction){if(aGenreAction===EGenreAction.Valider){lThis.Fermer();if(lThis.enCreation){lThis.theme.SetEtat(EGenreEtat.Creation);} else if(lThis.enModification){lThis.theme.SetEtat(EGenreEtat.Modification);}
lThis.callback.appel(lThis.theme);}}});} else{this.Fermer();if(this.enCreation){this.theme.SetEtat(EGenreEtat.Creation);} else if(this.enModification){this.theme.SetEtat(EGenreEtat.Modification);}
this.callback.appel(this.theme);}} else{this.Fermer();}}
surBoutonChoixMatiere(){const lThis=this;const lFenetreChoixMatiere=ObjetFenetre.creerInstance(ObjetFenetre_SelectionMatiere,{pere:lThis,evenement:function(aNumeroBouton,aIndiceSelection,aNumeroSelection){if(aNumeroBouton===1){const lMatiereSelectionnee=this.listeMatieres.GetElementParNumero(aNumeroSelection)||new ObjetElement();lThis.theme.matiere=lMatiereSelectionnee;lThis.enModification=true;}},initialiser:function(aInstanceFenetre){aInstanceFenetre.setOptionsFenetre({titre:GTraductions.getValeur('Theme.titre.matiere'),largeur:300,hauteur:400,listeBoutons:[GTraductions.getValeur('Fermer')]});}});const lInfosListMatieres={liste:this.listeMatieres,avecChoixFiltrageEnseignees:!MethodesTableau.existe(GEtatUtilisateur.GenreEspace,[EGenreEspace.Etablissement,EGenreEspace.Mobile_Etablissement]),avecSelectionAucune:false};lFenetreChoixMatiere.libelleFiltreEnseignees=GTraductions.getValeur('SaisieQCM.UniquementMatieresEnseignees');lFenetreChoixMatiere.SetDonnees(lInfosListMatieres.liste,lInfosListMatieres.avecChoixFiltrageEnseignees,lInfosListMatieres.avecSelectionAucune,lInfosListMatieres.filtreEnseignees);}}
module.exports=ObjetFenetre_EditionTheme;},fn:"objetfenetre_editiontheme.js"});;
IE.fModule({f:function(exports,require,module,global){const{ObjetRequeteSaisie}=require('ObjetRequeteJSON.js');const Requetes=require('CollectionRequetes.js');class ObjetRequeteSaisieListeThemes extends ObjetRequeteSaisie{constructor(...aParams){super(...aParams);}
lancerRequete(aParametres){$.extend(this.JSON,aParametres);if(this.JSON.ListeThemes){this.JSON.ListeThemes.setSerialisateurJSON({methodeSerialisation:function(aElement,aJSON){aJSON.matiere=aElement.matiere;}});}
return this.appelAsynchrone();}}
Requetes.inscrire('SaisieListeThemes',ObjetRequeteSaisieListeThemes);module.exports=ObjetRequeteSaisieListeThemes;},fn:"objetrequetesaisielistethemes.js"});;
IE.fModule({f:function(exports,require,module,global){const ObjetDonneesListeFlatDesign=require('ObjetDonneesListeFlatDesign.js');const GTraductions=require('ObjetTraduction.js');const EGenreEtat=require('Enumere_Etat.js');const ObjetFenetre=require('ObjetFenetre.js');const ObjetFenetre_EditionTheme=require('ObjetFenetre_EditionTheme.js');const EGenreAction=require('Enumere_Action.js');const EGenreBoiteMessage=require('Enumere_BoiteMessage.js');const ObjetListeElements=require('ObjetListeElements.js');const ObjetRequeteSaisieListeThemes=require('ObjetRequeteSaisieListeThemes.js');class DonneesListe_Themes extends ObjetDonneesListeFlatDesign{constructor(aDonnees,aListeMatieres,aTailleLibelleTheme){super(aDonnees);this.listeMatieres=aListeMatieres;this.tailleLibelleTheme=aTailleLibelleTheme;this.setOptions({avecEvnt_Creation:true,avecEvnt_Selection:true,avecEvnt_SelectionClick:true,avecCB:true,flatDesignMinimal:true});}
getTitreZonePrincipale(aParams){return aParams.article.GetLibelle();}
getInfosSuppZonePrincipale(aParams){return`${GTraductions.getValeur('Theme.auteur.creePar')} ${(!!aParams.article.auteur?aParams.article.auteur.GetLibelle():GTraductions.getValeur('Theme.auteur.moi'))+(!!aParams.article.matiere?', '+aParams.article.matiere.GetLibelle():'')}`;}
avecBoutonActionLigne(aParams){return!!aParams.article&&aParams.article.modificationAutorisee;}
AvecMenuContextuel(aParams){return!!aParams.article&&aParams.article.modificationAutorisee;}
initialisationObjetContextuel(aParametres){if(!aParametres.menuContextuel){return;}
aParametres.menuContextuel.add(GTraductions.getValeur('Modifier'),true,function(){_ouvrirFenetreEdition.call(this,aParametres);},{icon:'icon_pencil'});aParametres.menuContextuel.add(!aParametres.article.cmsActif?GTraductions.getValeur('Theme.btn.selectionner'):GTraductions.getValeur('Theme.btn.deselectionner'),true,function(){aParametres.article.cmsActif=!aParametres.article.cmsActif;this.Actualiser();},{icon:!aParametres.article.cmsActif?'icon_ok':'icon_fermeture_widget'});aParametres.menuContextuel.add(GTraductions.getValeur('Supprimer'),true,function(){GApplication.getMessage().afficher({type:EGenreBoiteMessage.Confirmation,message:aParametres.article.estUtiliseParAuteur?GTraductions.getValeur('Theme.msg.confSupprThemeUtiliseAuteur',aParametres.article.GetLibelle()):GTraductions.getValeur('Theme.msg.confSupprTheme'),callback:function(aGenreAction){if(aGenreAction===EGenreAction.Valider){aParametres.article.SetEtat(EGenreEtat.Suppression);aParametres.article.cmsActif=false;new ObjetRequeteSaisieListeThemes(this,function(){this.Actualiser();}.bind(this)).lancerRequete({ListeThemes:new ObjetListeElements().add(aParametres.article)});}}.bind(this)});},{icon:'icon_trash'});aParametres.menuContextuel.SetDonnees();}
getValueCB(aParams){return aParams.article?aParams.article.cmsActif:false;}
setValueCB(aParams,aValue){aParams.article.cmsActif=aValue;}}
function _ouvrirFenetreEdition(aParams){const lFenetre=ObjetFenetre.creerInstance(ObjetFenetre_EditionTheme,{pere:this,evenement:function(aTheme){const lTheme=aParams.article;lTheme.SetLibelle(aTheme.GetLibelle());lTheme.matiere=aTheme.matiere;lTheme.SetEtat(aTheme.Etat);lTheme.cmsActif=aTheme.cmsActif;new ObjetRequeteSaisieListeThemes(this,function(){this.Actualiser();}.bind(this)).lancerRequete({ListeThemes:new ObjetListeElements().add(aTheme)});}});lFenetre.SetDonnees(aParams,{listeMatieres:this.Donnees.listeMatieres,tailleLibelleTheme:this.Donnees.tailleLibelleTheme});}
module.exports=DonneesListe_Themes;},fn:"donneesliste_themes.js"});;
IE.fModule({f:function(exports,require,module,global){const GPosition=require('GPosition.js');const EGenreEvenementListe=require('Enumere_EvenementListe.js');const ObjetFenetre=require('ObjetFenetre.js');const ObjetListe=require('ObjetListe.js');const ObjetListeElements=require('ObjetListeElements.js');const GTraductions=require('ObjetTraduction.js');const DonneesListe_Themes=require('DonneesListe_Themes.js');const MethodesObjet=require('MethodesObjet.js');const TypeThemeBouton=require('Type_ThemeBouton.js');const ObjetFenetre_EditionTheme=require('ObjetFenetre_EditionTheme.js');const EGenreEtat=require('Enumere_Etat.js');const ObjetRequeteSaisieListeThemes=require('ObjetRequeteSaisieListeThemes.js');class ObjetFenetre_ListeThemes extends ObjetFenetre{constructor(...aParams){super(...aParams);this.setOptionsFenetre({titre:GTraductions.getValeur('Themes'),largeur:450,hauteur:500,heightMax_mobile:true,listeBoutons:[GTraductions.getValeur('Annuler'),GTraductions.getValeur('Valider')],avecCroixFermeture:false});this.avecThemeAssocieSelection=true;this.avecThemesMesMatieres=false;}
ConstruireInstances(){this.identListe=this.Add(ObjetListe,evenementSurListe.bind(this),_initialiserListe);}
getControleur(aInstance){return $.extend(true,super.getControleur(this),{cbThemeSelection:{getValue:function(){return aInstance.avecThemeAssocieSelection;},setValue:function(){aInstance.avecThemeAssocieSelection=!aInstance.avecThemeAssocieSelection;if(aInstance.avecThemeAssocieSelection){aInstance.avecThemesMesMatieres=false;}
_filtrageSelection.call(aInstance);}},cbThemeMesMatieres:{getValue:function(){return aInstance.avecThemesMesMatieres;},setValue:function(){aInstance.avecThemesMesMatieres=!aInstance.avecThemesMesMatieres;if(aInstance.avecThemesMesMatieres){aInstance.avecThemeAssocieSelection=false;}
_filtrageSelection.call(aInstance);}}});}
SetDonnees(aParams){this.donnees=MethodesObjet.dupliquer(aParams.listeThemes);this.matiereContexte=aParams.matiereContexte;this.listeMatieres=aParams.listeMatieres;this.tailleLibelleTheme=aParams.tailleLibelleTheme;this.libelleCB=aParams.libelleCB;this.matiereNonDesignee=aParams.matiereNonDesignee;if(!this.libelleCB){}
this.Afficher(this.ComposeContenu());this.surFixerTaille();_filtrageSelection.call(this);}
ComposeContenu(){const lHtml=[];lHtml.push('<div class="flex-contain cols" style="height:100%">','<div class="field-contain">','<ie-checkbox ie-model="cbThemeSelection">',this.libelleCB||GTraductions.getValeur('Theme.libelleCB.selection'),'</ie-checkbox>','</div>','<div class="field-contain">','<ie-checkbox ie-model="cbThemeMesMatieres">',GTraductions.getValeur('Theme.filtrePar.mesMatieres'),'</ie-checkbox>','</div>','<div class="field-contain"  style="flex: 1 1 auto;" id="'+this.GetNomInstance(this.identListe)+'"></div>','</div>');return lHtml.join('');}
_actualiserListe(aListeFiltrees){this.GetInstance(this.identListe).SetDonnees(new DonneesListe_Themes(aListeFiltrees,this.listeMatieres,this.tailleLibelleTheme));}
SurValidation(aNumeroBouton){this.Fermer();this.callback.appel(aNumeroBouton,this.donnees);}
surFixerTaille(){super.surFixerTaille();GPosition.declencherResize(this.GetNomInstance(this.identListe));}}
function _initialiserListe(aInstance){aInstance.setOptionsListe({colonnes:[{taille:'100%'}],avecLigneCreation:true,skin:ObjetListe.skin.flatDesign});}
function evenementSurListe(aParametres){switch(aParametres.genreEvenement){case EGenreEvenementListe.SelectionClick:aParametres.article.cmsActif=!aParametres.article.cmsActif;break;case EGenreEvenementListe.Creation:_ouvrirFenetreCreation.call(this,aParametres);break;}}
function _filtrageSelection(){let lListeFiltrees=new ObjetListeElements();if(!this.avecThemeAssocieSelection&&!this.avecThemesMesMatieres){lListeFiltrees=this.donnees;} else{if(this.avecThemeAssocieSelection||!GEtatUtilisateur.listeMatieres){const lListeThemesActifs=new ObjetListeElements();this.donnees.parcourir((aTheme) =>{if(aTheme.cmsActif){lListeThemesActifs.add(aTheme);}});const lListeMatieresSelectionnees={};if(this.matiereContexte){lListeMatieresSelectionnees[this.matiereContexte.GetNumero()]=this.matiereContexte;}
if(this.matiereNonDesignee){lListeMatieresSelectionnees[this.matiereNonDesignee.GetNumero()]=this.matiereNonDesignee;}
lListeThemesActifs.parcourir((aTheme) =>{if(!lListeMatieresSelectionnees[aTheme.matiere.GetNumero()]){lListeMatieresSelectionnees[aTheme.matiere.GetNumero()]=aTheme.matiere;}});this.donnees.parcourir((aTheme) =>{let lEstDejaDansLaListe=false;for(let i in lListeMatieresSelectionnees){if(!lEstDejaDansLaListe&&(!aTheme.matiere||aTheme.matiere.GetNumero()===lListeMatieresSelectionnees[i].GetNumero())){lListeFiltrees.add(aTheme);lEstDejaDansLaListe=true;}}});} else{const lListeMatieresEnseignees=new ObjetListeElements();GEtatUtilisateur.listeMatieres.parcourir((aMatiere) =>{if(aMatiere.estEnseignee){lListeMatieresEnseignees.add(aMatiere);}});if(this.matiereNonDesignee){lListeMatieresEnseignees.add(this.matiereNonDesignee);}
this.donnees.parcourir((aTheme) =>{let lEstDejaDansLaListe=false;lListeMatieresEnseignees.parcourir((aMatiere) =>{if(!lEstDejaDansLaListe&&(!aTheme.matiere||aTheme.matiere.GetNumero()===aMatiere.GetNumero())){lListeFiltrees.add(aTheme);lEstDejaDansLaListe=true;}});});}}
this._actualiserListe(lListeFiltrees);}
function _ouvrirFenetreCreation(aParams){const lFenetre=ObjetFenetre.creerInstance(ObjetFenetre_EditionTheme,{pere:this,evenement:function(aTheme){if(aTheme.Etat===EGenreEtat.Creation){aTheme.cmsActif=true;aTheme.modificationAutorisee=true;new ObjetRequeteSaisieListeThemes(this,function(aDonneesJSON){if(!!aDonneesJSON&&!!aDonneesJSON.JSONRapportSaisie){const lThemeCree=aDonneesJSON.JSONRapportSaisie.ThemeCree;if(!!lThemeCree){aTheme.SetNumero(lThemeCree.GetNumero());if(aTheme.Etat!==EGenreEtat.Suppression){aTheme.SetEtat(EGenreEtat.Aucun);}
this.donnees.AddElement(aTheme);_filtrageSelection.call(this);}}}.bind(this)).lancerRequete({ListeThemes:new ObjetListeElements().add(aTheme)});}},initialiser:function(aInstance){aInstance.setOptionsFenetre({titre:GTraductions.getValeur('Theme.titre.nouveauTheme'),listeBoutons:[GTraductions.getValeur('Fermer'),{theme:TypeThemeBouton.primaire,libelle:GTraductions.getValeur('Theme.btn.creer')}]});}});lFenetre.SetDonnees(aParams,{matiereContexte:this.matiereContexte,listeMatieres:this.listeMatieres,enCreation:true,tailleLibelleTheme:this.tailleLibelleTheme});}
module.exports=ObjetFenetre_ListeThemes;},fn:"objetfenetre_listethemes.js"});;
IE.fModule({f:function(exports,require,module,global){const MethodesObjet=require('MethodesObjet.js');const ControleSaisieEvenement=require('ControleSaisieEvenement.js');const EEvent=require('Enumere_Event.js');const ObjetCelluleBouton=require('ObjetCelluleBouton.js').ObjetCelluleBouton;const ObjetDonneesListe=require('ObjetDonneesListe.js');const ObjetFenetre=require('ObjetFenetre.js');const ObjetFenetre_Liste=require('ObjetFenetre_Liste.js');const Identite=require('ObjetIdentite.js');const GTraductions=require('ObjetTraduction.js');const EGenreBoutonCellule=require('ObjetCelluleBouton.js').EGenreBoutonCellule;const ToucheClavier=require('ToucheClavier.js');class ObjetCelluleMultiSelection extends Identite{constructor(...aParams){super(...aParams);this.initOptions();}
initOptions(){this._options={genreBouton:EGenreBoutonCellule.Points,classTexte:'',largeurBouton:150,hauteurBouton:18,titreFenetre:'',titresColonnes:null,taillesColonnes:null,listeBoutons:null,donneesListe:null,paramListe:null,avecLigneCreation:false,creations:null,callbckCreation:null,callbckEdition:null,colonnesCachees:null,largeurFenetre:300,hauteurFenetre:250,avecAuMoinsUnEltSelectionne:false};}
setOptions(aOptions){$.extend(this._options,aOptions);}
DetruireInstances(){this._fermerFenetre();}
Initialiser(){this.cellule=new ObjetCelluleBouton(this.Nom+'.cellule',null,this,this.surCellule);this.SetPremierElement(this.cellule.NomEdit);this.cellule.setOptions_ObjetCelluleBouton({estSaisissable:false,genreBouton:this._options.genreBouton,hauteur:this._options.hauteurBouton,largeur:this._options.largeurBouton,classTexte:this._options.classTexte,avecZoneSaisie:false,placeHolder:this._options.placeHolder});this.Afficher();this.cellule.Initialiser();this.cellule.SetActif(this.Actif);}
_initDonnees(aListeSelectionnee,aListeOrigin){const lResult=MethodesObjet.dupliquer(aListeOrigin);for(let i=0;i<aListeSelectionnee.GetNbrElements();i++){const lElm=lResult.GetElementParNumero(aListeSelectionnee.GetNumero(i));if(lElm){lElm.cmsActif=true;}}
return lResult;}
setDonnees(aListeComplet,aListeSelectionne){if(aListeComplet){if(aListeSelectionne){this.donnees=this._initDonnees(aListeSelectionne,aListeComplet);} else{this.donnees=MethodesObjet.dupliquer(aListeComplet);}
if(this.donnees){this._actualiserCellule();}}}
ConstruireAffichage(){const H=[];H.push('<div id="',this.cellule.GetNom(),'" class="input-wrapper" ie-class="getClassesDynamiques"></div>');return H.join('');}
getControleur(aInstance){return $.extend(true,super.getControleur(this),{getClassesDynamiques:function(){const lClasses=[];if(!aInstance.getActif()){lClasses.push('input-wrapper-disabled');}
return lClasses.join(' ');}});}
surCellule(aGenreEvent,aEvent){if(!this.getActif()){return;}
switch(aGenreEvent){case EEvent.SurClick:{this._ouvrirFenetre();break;}
case EEvent.SurKeyUp:{if(aEvent.which===ToucheClavier.RetourChariot||aEvent.which===ToucheClavier.FlecheBas){this._ouvrirFenetre();}}}}
_actualiserCellule(){const lListeSelectionne=this.donnees.getListeElements(function(aElement){return aElement.cmsActif;});this.cellule.setLibelle(lListeSelectionne.getTableauLibelles().join(', '));}
_ouvrirFenetre(){if(this.fenetre){this._fermerFenetre();}
this.fenetre=ObjetFenetre.creerInstance(ObjetFenetre_Liste,{pere:this,evenement:this.surFenetre,initialiser:false});const lSelf=this;this.fenetre.ajouterCallbackSurDestruction(function(){lSelf.fenetre=null;});const lParam={titres:this._options.titresColonnes?this._options.titresColonnes:[{estCoche:true},GTraductions.getValeur('Libelle')],tailles:this._options.taillesColonnes?this._options.taillesColonnes:[20,'100%'],avecLigneCreation:this._options.avecLigneCreation,creations:this._options.creations,callbckCreation:this._options.callbckCreation,callbckEdition:this._options.callbckEdition,colonnesCachees:this._options.colonnesCachees,optionsListe:this._options.optionsListe,editable:true};const lOptionsFenetre={titre:this._options.titreFenetre,largeur:this._options.largeurFenetre,hauteur:this._options.hauteurFenetre,listeBoutons:this._options.listeBoutons?this._options.listeBoutons:[GTraductions.getValeur('Fermer')]};if(this._options.avecAuMoinsUnEltSelectionne){lOptionsFenetre.modeActivationBtnValider=this.fenetre.modeActivationBtnValider.auMoinsUnEltSelectionne;}
this.fenetre.setOptionsFenetre(lOptionsFenetre);this.fenetre.paramsListe=lParam;this.fenetre.Initialiser();this.donneesListe=this._options.donneesListe?new this._options.donneesListe(this.donnees,this._options.paramListe):new DonneesListe_CelluleMultiSelection(this.donnees);this.fenetre.SetDonnees(this.donneesListe,false);this.fenetre.positionnerSousId(this.Nom);}
_nbrCochees(){let lNombre=0;for(let i=0,lNb=this.donnees.GetNbrElements();i<lNb;i++){if(this.donnees.GetElement(i).cmsActif){lNombre++;}}
return lNombre;}
_fermerFenetre(){if(!this.fenetre){return;}
this.fenetre.Fermer();}
surFenetre(aGenreBouton,aSelection,aAvecChangementListe){this.genreBouton=aGenreBouton;this._actualiserCellule();this._fermerFenetre();ControleSaisieEvenement(function(){const lListeActif=this.donnees.getListeElements(function(aElement){return aElement.cmsActif;});this.callback.appel(this.genreBouton,lListeActif,aAvecChangementListe?this.donnees:null);}.bind(this),!this.ControleNavigation);}
SetActif(AActif){super.SetActif(AActif);this.$refreshSelf();}}
class DonneesListe_CelluleMultiSelection extends ObjetDonneesListe{constructor(aDonnees){super(aDonnees);this.setOptions({avecSelection:false,avecSuppression:false,avecEtatSaisie:false,avecEvnt_ApresEdition:true,avecEvnt_Selection:true});}
AvecEdition(I){return I===0;}
GetTypeValeur(aParams){return aParams.colonne===0?ObjetDonneesListe.ETypeCellule.Coche:ObjetDonneesListe.ETypeCellule.Texte;}
GetValeur(I,D,aParams){switch(aParams.colonne){case 0:return D.cmsActif!==undefined?D.cmsActif:false;case 1:return D.GetLibelle();}
return'';}
SurEdition(aParams,I,D,V){if(aParams.colonne===0){D.cmsActif=V;}}
getColonneTransfertEdition(){return 0;}
GetCouleurCellule(){return ObjetDonneesListe.ECouleurCellule.Blanc;}}
module.exports={ObjetCelluleMultiSelection,DonneesListe_CelluleMultiSelection};},fn:"objetcellulemultiselection.js"});;
IE.fModule({f:function(exports,require,module,global){const{ObjetRequeteConsultation}=require('ObjetRequeteJSON.js');const Requetes=require('CollectionRequetes.js');class ObjetRequeteListeTousLesThemes extends ObjetRequeteConsultation{constructor(...aParams){super(...aParams);}
lancerRequete(){return this.appelAsynchrone();}
actionApresRequete(){this.callbackReussite.appel({listeTousLesThemes:this.JSONReponse.ListeTousLesThemes,listeMatieres:this.JSONReponse.listeMatieres,matiereNonDesignee:this.JSONReponse.matiereNonDesignee,tailleLibelleTheme:this.JSONReponse.tailleLibelleTheme});}}
Requetes.inscrire('ListeTousLesThemes',ObjetRequeteListeTousLesThemes);module.exports=ObjetRequeteListeTousLesThemes;},fn:"objetrequetelistetouslesthemes.js"});;
IE.fModule({f:function(exports,require,module,global){const ObjetFenetre=require('ObjetFenetre.js');const ObjetFenetre_ListeThemes=require('ObjetFenetre_ListeThemes.js');const ObjetCelluleMultiSelection=require('ObjetCelluleMultiSelection.js').ObjetCelluleMultiSelection;const ControleSaisieEvenement=require('ControleSaisieEvenement.js');const EEvent=require('Enumere_Event.js');const ObjetRequeteListeTousLesThemes=require('ObjetRequeteListeTousLesThemes.js');const ToucheClavier=require('ToucheClavier.js');class ObjetCelluleMultiSelectionThemes extends ObjetCelluleMultiSelection{constructor(...aParams){super(...aParams);this._options.largeurBouton=IE.estMobile?150:400;}
setOptions(aOptions){super.setOptions(aOptions);this._options.largeurBouton=this._options.fullWidth?'100%':this._options.largeurBouton;}
ConstruireAffichage(){const H=[];H.push('<div id="',this.cellule.GetNom(),'" class="input-wrapper" style="width:100%;" ie-class="getClassesDynamiques"></div>');return H.join('');}
setDonnees(aListeSelectionne,aMatiereContexte,aLibelleCB){this.matiereContexte=aMatiereContexte;this.donneesSelection=aListeSelectionne;this.libelleCB=aLibelleCB;if(this.donneesSelection){this._actualiserCellule();}}
surCellule(aGenreEvent,aEvent){if(!this.getActif()){return;}
switch(aGenreEvent){case EEvent.SurClick:{new ObjetRequeteListeTousLesThemes(this,this._ouvrirFenetre).lancerRequete();break;}
case EEvent.SurKeyUp:{if(aEvent.which===ToucheClavier.RetourChariot||aEvent.which===ToucheClavier.FlecheBas){new ObjetRequeteListeTousLesThemes(this,this._ouvrirFenetre).lancerRequete();}}}}
_actualiserCellule(){this.cellule.setLibelle(this.donneesSelection.getTableauLibelles().join(', '));}
_ouvrirFenetre(aJSON){if(this.fenetre){this._fermerFenetre();}
this.donnees=this._initDonnees(this.donneesSelection,aJSON.listeTousLesThemes);this.fenetre=ObjetFenetre.creerInstance(ObjetFenetre_ListeThemes,{pere:this,evenement:this.surFenetre});this.fenetre.SetDonnees({listeThemes:this.donnees,matiereContexte:this.matiereContexte||aJSON.matiereNonDesignee,listeMatieres:aJSON.listeMatieres,tailleLibelleTheme:aJSON.tailleLibelleTheme,libelleCB:this.libelleCB,matiereNonDesignee:aJSON.matiereNonDesignee});}
surFenetre(aGenreBouton,aChangementListe){this.genreBouton=aGenreBouton;this._actualiserCellule();this._fermerFenetre();if(this.genreBouton===1){const lListeActif=aChangementListe.getListeElements(function(aElement){return aElement.cmsActif;});ControleSaisieEvenement(function(){this.callback.appel(this.genreBouton,lListeActif);}.bind(this),!this.ControleNavigation);this.donneesSelection=lListeActif;this._actualiserCellule();}}}
module.exports=ObjetCelluleMultiSelectionThemes;},fn:"objetcellulemultiselectionthemes.js"});;
IE.fModule({f:function(exports,require,module,global){const Identite=require('ObjetIdentite.js');const ObjetCelluleDate=require('ObjetCelluleDate.js');const ObjetSelection=require('ObjetSelection.js').ObjetSelection;const{GObjetWAI,EGenreAttribut}=require('ObjetWAI.js');const GTraductions=require('ObjetTraduction.js');const GHtml=require('GHtml.js');const{ObjetFenetre_SelectionPublic,TypeGenreCumulSelectionPublic}=require('ObjetFenetre_SelectionPublic.js');const ObjetFenetre=require('ObjetFenetre.js');const{TypeDroits}=require('ObjetDroitsPN.js');const EGenreEtat=require('Enumere_Etat.js');const ObjetElement=require('ObjetElement.js');const ObjetCelluleMultiSelectionThemes=require('ObjetCelluleMultiSelectionThemes.js');const UtilitaireGestionCloudEtPDF=require('UtilitaireGestionCloudEtPDF.js');const{ObjetCelluleBouton}=require('ObjetCelluleBouton.js');const EGenreBoutonCellule=require('ObjetCelluleBouton.js').EGenreBoutonCellule;require('mobile/css/MoteurFormSaisie.css');const EGenreEvntForm={annuler:'annuler',valider:'valider',supprimer:'supprimer'};class ObjetMoteurFormSaisieMobile{constructor(){this.charObligatoire='champ-requis';}
composeFormContenuEditable(aParam){const H=[];H.push('<div class="field-contain">');H.push(_composeLabel.call(this,aParam));H.push('<div contenteditable="true" id="',aParam.id,'" ie-model="',aParam.model,'" class="contenteditable_index" ></div>');H.push('</div>');return H.join('');}
composeFormTextArea(aParam){const H=[];H.push('<div class="field-contain">');H.push(_composeLabel.call(this,aParam));H.push(`<ie-textareamax id="${aParam.id}" ie-model="${aParam.model}" ${(aParam.styleArea?`ie-style="${aParam.styleArea}"`:'')} class="round-style" ${(aParam.placeholder?`placeholder="${aParam.placeholder}"`:'')} ${(aParam.maxLength?`maxlength="${aParam.maxLength}"`:'')}></ie-textareamax>`);H.push('</div>');return H.join('');}
composeFormText(aParam){const H=[];H.push('<div class="field-contain">');H.push(_composeLabel.call(this,aParam));H.push('<input ie-ellipsis style="width: 100%;" type="text" id="',aParam.id,'" ie-model="',aParam.model,'" />');H.push('</div>');return H.join('');}
composeFormTexteSimple(aParam){const H=[];H.push('<div class="field-contain">');H.push(_composeLabel.call(this,aParam));H.push('<div id="',aParam.id,'">',aParam.texteSimple,'</div>');H.push('</div>');return H.join('');}
composeFormInputNote(aParam){const H=[];H.push('<div class="field-contain bareme-conteneur">','<label>',aParam.label,'</label>','<ie-inputnote class="input-note" ie-model="',aParam.model,'" id="',aParam.id,'" maxlength="',aParam.maxLength,'"></ie-inputnote>','</div>');return H.join('');}
composeDate(aParam){const H=[];H.push('<div class="field-contain dates-contain">');H.push(_composeLabel.call(this,aParam));H.push('<div class="date-wrapper" id="',aParam.id,'"></div>');H.push('</div>');return H.join('');}
instancierCalendrier(aEvnt,aPere,aOptions){const lInstance=Identite.creerInstance(ObjetCelluleDate,{pere:aPere,evenement:aEvnt.bind(aPere)});lInstance.setOptions_ObjetCelluleDate(aOptions);return lInstance;}
composeSelecteur(aParam){const H=[];H.push('<div class="field-contain">');H.push(_composeLabel.call(this,aParam));H.push('<div id="',aParam.id,'"></div>');H.push('</div>');return H.join('');}
instancierSelecteur(aEvnt,aPere,aParam){const lInstance=Identite.creerInstance(ObjetSelection,{pere:aPere,evenement:aEvnt.bind(aPere)});lInstance.SetParametres(aParam);return lInstance;}
updateSelecteur(aParam){if(aParam.liste){let lIndiceParDefaut=0;const lDonnee=aParam.donnee;if(lDonnee!==null&&lDonnee!==undefined){lIndiceParDefaut=aParam.liste.getIndiceElementParFiltre(function(aElt){if(aParam.comparerGenre===true){return aElt.GetGenre()===lDonnee.GetGenre();} else{return(aElt.GetNumero()===lDonnee.GetNumero());}}.bind(this));}
aParam.instanceSelect.SetDonnees(aParam.liste,lIndiceParDefaut);}}
composeSelecteurDuree(aParam){const H=[];H.push('<div class="field-contain duree">');H.push(_composeLabel.call(this,aParam));H.push('<div class="selectDuree" style=" ',(aParam.alignementDroit?' margin-left:auto; ':''),'" id="',aParam.id,'"></div>');H.push('</div>');return H.join('');}
updateSelecteurDuree(aParam){aParam.instanceSelect.SetDonnees({heure:aParam.duree.getHours(),minute:aParam.duree.getMinutes()});aParam.instanceSelect.setActif(aParam.inactif!==true);aParam.instanceSelect.Afficher();}
composeFormGestionRessources(aParam){const H=[];if(aParam.avecSaisie===true||((aParam.listeRessources!==null)&&(aParam.listeRessources!==undefined)&&(aParam.listeRessources.GetNbrElements()>0))){H.push(`<div class="pj-global-conteneur">`);if(aParam.avecSaisie){H.push(`<div class="select-file ${aParam.icon}" id="${aParam.id}" ie-node="${aParam.nodeGestion}()" role="button">${aParam.label}</div>`);} else{H.push(`<div class="select-file">${aParam.label}</div>`);}
H.push(`<div id="${aParam.idListeRessources}" class="docs-joints">${this.composeHtmlListeRessources(aParam)}</div>`);H.push(`</div>`);}
return H.join('');}
composeHtmlListeRessources(aParam){const H=[];if((aParam.listeRessources!==null)&&(aParam.listeRessources!==undefined)&&aParam.listeRessources.GetNbrElementsExistes()>0){aParam.listeRessources.parcourir(function(aRessource){if(aRessource.Existe()){H.push(`<ie-chips ${(aParam.avecSaisie&&aRessource.avecSaisie)?`ie-model="btnSupprChips(${aRessource.GetGenre()}, '${aRessource.GetNumero()}')" class="avec-event" `:''} tabindex=0 style="max-width:240px">${aRessource.GetLibelle()||aRessource.url}</ie-chips>`);}}.bind(this));}
return H.join('');}
updateHtmlListeRessources(aParam){const lHtml=this.composeHtmlListeRessources({listeRessources:aParam.listeRessources,avecSaisie:aParam.avecSaisie,strAucun:aParam.strAucun});GHtml.setHtml(aParam.id,lHtml,{controleur:aParam.controleur});}
openModaleSelectRessource(aParam){let lAvecSaisie=false;const lModaleSelect=ObjetFenetre.creerInstance(require('ObjetFenetre_PieceJointe.js'),{pere:aParam.instance,evenement:function(aNumeroBouton,aParamsFenetre){const lListeFichiers=aParamsFenetre.instance.ListeFichiers;aParam.listePiecesJointes.parcourir(function(aDocument){if(aDocument.Etat!==EGenreEtat.Aucun){lAvecSaisie=true;}
let lDocumentJoint=aParam.listePJContexte.GetElementParNumero(aDocument.GetNumero());const lActif=aDocument.Actif&&aDocument.Existe();if(lDocumentJoint){if(aDocument.Existe()&&(aDocument.Etat===EGenreEtat.Modification)){lDocumentJoint.SetLibelle(aDocument.GetLibelle());}
if(!lActif){lDocumentJoint.SetEtat(EGenreEtat.Suppression);aParam.element.SetEtat(EGenreEtat.Modification);lAvecSaisie=true;}} else{if(lActif){lDocumentJoint=new ObjetElement(aDocument.GetLibelle(),aDocument.GetNumero(),aDocument.GetGenre());lDocumentJoint.url=aDocument.url;lDocumentJoint.SetEtat(EGenreEtat.Creation);aParam.element.SetEtat(EGenreEtat.Modification);aParam.listePJContexte.AddElement(lDocumentJoint);lAvecSaisie=true;}}}.bind(this));aParam.listePiecesJointes.trier();aParam.validation(aParamsFenetre,lListeFichiers,lAvecSaisie);},initialiser:function(aInstance){aInstance.SetEtatSaisie=function(aEtatSaisie){if(aEtatSaisie){lAvecSaisie=true;}};aInstance.SetGenre(aParam.genre);}});lModaleSelect.afficherFenetrePJ({listePJTot:aParam.listePiecesJointes,listePJContexte:aParam.listePJContexte,genreFenetrePJ:aParam.genreFenetrePJ.CahierDeTextes,genrePJ:aParam.genre,genreRessourcePJ:aParam.genreRessourceDocJoint,avecFiltre:{date:true,classeMatiere:true},listePeriodes:aParam.listePeriodes,dateCours:aParam.dateCoursDeb,optionsSelecFile:{maxSize:GApplication.droits.get(TypeDroits.cahierDeTexte.tailleMaxPieceJointe)},modeLien:false,surValiderAvantFermer:null,validationAuto:null});}
composeSelecteurPublic(aParam){const H=[];H.push('<div id="',aParam.id,'" class="field-contain public-conteneur">');H.push(aParam.html);H.push('</div>');return H.join('');}
composeHtmlSelecteurPublic(aParam){const H=[];H.push(_composeLabel.call(this,aParam));if((aParam.tabChips!==null)&&(aParam.tabChips!==undefined)){const lNbr=aParam.tabChips.length;for(let i=0;i<lNbr;i++){const lChip=aParam.tabChips[i];H.push('<div class="chip" ',GHtml.composeAttr('ie-node',lChip.node,lChip.paramNode),'>'+lChip.label+'</div>');}}
return H.join('');}
openModaleSelectPublic(aParam){const lModaleSelect=ObjetFenetre.creerInstance(ObjetFenetre_SelectionPublic,{pere:aParam.instance,evenement:function(aGenre,aListe,aNumeroBouton){aParam.evntClbck({validerSelection:(aNumeroBouton===1),listeRessourcesSelectionnees:aListe});}},{titre:GTraductions.getValeur('CahierDeTexte.titreFenetreTAFEleves')});lModaleSelect.setGenreCumulActif(TypeGenreCumulSelectionPublic.classe);lModaleSelect.setOptions({avecCocheRessources:true,selectionObligatoire:true,avecBarreTitre:false,estDeploye:true});lModaleSelect.setDonnees({listeRessources:aParam.listeRessources,listeRessourcesSelectionnees:aParam.listeRessourcesSelectionnees,genreRessource:aParam.genreRessource,titre:aParam.titre});}
composeMultiSelecteurTheme(aParam){const H=[];H.push('<div class="field-contain">');H.push(_composeLabel.call(this,aParam));H.push('<div class="on-mobile" id="',aParam.id,'"></div>');H.push('</div>');return H.join('');}
instancierMultiSelecteurTheme(aEvnt,aPere){const lInstance=Identite.creerInstance(ObjetCelluleMultiSelectionThemes,{pere:aPere,evenement:aEvnt.bind(aPere),options:{fullWidth:true,placeHolder:GTraductions.getValeur('infosperso.ChoisirTheme')}});return lInstance;}
updateMultiSelectTheme(aParams){aParams.instanceSelect.setDonnees(aParams.liste,aParams.matiere,aParams.libelleCB);}
composeCategorie(aParam){const H=[];H.push('<div class="field-contain">');H.push(_composeLabel.call(this,aParam));H.push('<div class="on-mobile" id="',aParam.id,'"></div>');H.push('</div>');return H.join('');}
instancierSelecteurCategorie(aPere,aEvnt){const lInstance=Identite.creerInstance(ObjetCelluleBouton,{pere:aPere,evenement:aEvnt.bind(aPere),options:{}});lInstance.setOptions_ObjetCelluleBouton({genreBouton:EGenreBoutonCellule.Points,estSaisissable:false,avecZoneSaisie:false,fullWidth:true});return lInstance;}
composeFormPiedPanel(aParam){const H=[];if(aParam.avecSuppression){H.push(`<div class="compose-bas">\n                <ie-btnicon class="icon_trash avecFond i-medium" ie-model="nodePoubelle" ${GObjetWAI.composeAttribut({genre:EGenreAttribut.label,valeur:GTraductions.getValeur('Supprimer')})}></ie-btnicon>\n              </div>`);}
H.push('<ie-bouton class="repeat-bouton" ie-model="btnAnnuler">',GTraductions.getValeur('Annuler'),'</ie-bouton>');H.push('<ie-bouton class="repeat-bouton themeBoutonPrimaire" ie-model="btnValider">',GTraductions.getValeur('Valider'),'</ie-bouton>');return H.join('');}
composeFormEntetePanel(aParam){const H=[];H.push(`<div class="Fenetre_Titre" tabindex="-1">\n                <h3 class="ie-titre ${(aParam.icon?` iconic ${aParam.icon}`:'')}">${aParam.titre}</h3>\n              </div>\n              <ie-btnicon class="icon_fermeture_widget" ie-model="nodeFlecheRetour"  ${GObjetWAI.composeAttribut({genre:EGenreAttribut.label,valeur:GTraductions.getValeur('Annuler')})}></ie-btnicon>`);return H.join('');}
ouvrirFenetreChoixServiceCloud(){let lFuncEventFenetreChoixServiceCloud=(aLigne) =>{if(aLigne>=0){}};let lParams={callbaskEvenement:lFuncEventFenetreChoixServiceCloud,modeGestion:UtilitaireGestionCloudEtPDF.modeGestion.Cloud};UtilitaireGestionCloudEtPDF.creerFenetreGestion(lParams);}}
function _composeLabel(aParam){const H=[];H.push(`<label ${aParam.id?`for="${aParam.id}"`:''}
  ${aParam.classLabel?`ie-class="${aParam.classLabel}"`:`class="active ie-titre-petit ${aParam.estObligatoire===true?this.charObligatoire:''}"`}>${aParam.label}</label>`);return H.join('');}
module.exports={ObjetMoteurFormSaisieMobile,EGenreEvntForm};},fn:"objetmoteurformsaisiemobile.js"});;
IE.fModule({f:function(exports,require,module,global){require('produit/css/ObjetFenetre_SaisieSujetForumPedagogique.css');const ObjetFenetre=require('ObjetFenetre.js');const tag=require('tag.js');const GTraductions=require('ObjetTraduction.js');const ObjetListeElements=require('ObjetListeElements.js');const ObjetElement=require('ObjetElement.js');const ObjetCelluleMultiSelectionThemes=require('ObjetCelluleMultiSelectionThemes.js');const{TypeGenreModerationForum,TypeGenreVisiteurForum}=require('TypesForumPedagogique.js');const EGenreRessource=require('Enumere_Ressource.js');const ObjetRequeteListePublics=require('ObjetRequeteListePublics.js');const{TypeDroits}=require('ObjetDroitsPN.js');const{GDate}=require('ObjetDate.js');const ObjetSelecteurPJ=require('ObjetSelecteurPJ.js');const EGenreDocumentJoint=require('Enumere_DocumentJoint.js');const MethodesObjet=require('MethodesObjet.js');const{TypeHttpNotificationDonnes}=require('TypeHttpNotificationDonnes.js');const TUtilitaireUrl=require('UtilitaireUrl.js');const{ObjetMoteurFormSaisieMobile}=require('ObjetMoteurFormSaisieMobile.js');const{ObjetFenetre_SelectionPublic}=require('ObjetFenetre_SelectionPublic.js');const{getCumulPourFenetrePublic}=require('UtilitaireFenetreSelectionPublic.js');class ObjetFenetre_SaisieSujetForumPedagogique extends ObjetFenetre{constructor(...aParams){super(...aParams);this.setOptionsFenetre({titre:GTraductions.getValeur('ForumPeda.CreerSujet'),largeur:650,listeBoutons:[
GTraductions.getValeur('ForumPeda.Annuler'),{libelle:GTraductions.getValeur('ForumPeda.Valider'),estValider:true}
],addParametresValidation:(aParametres) =>{if(aParametres.bouton&&aParametres.bouton.estValider){aParametres.sujet=this.sujet;}},eventSaisieCloudCallbackParFichier:null,eventSaisieCloudCallbackFinal:null,estContenuSujetVide:null});this.moteurFormSaisie=new ObjetMoteurFormSaisieMobile();this.sujet={};this.listePJs=GEtatUtilisateur.listeDonnees?MethodesObjet.dupliquer(GEtatUtilisateur.listeDonnees[TypeHttpNotificationDonnes.THND_ListeDocJointEtablissement]):new ObjetListeElements();this.idLibellePJ=`${this.Nom}_pjs`;}
getControleur(aInstance){return $.extend(true,super.getControleur(this),{btnDest:{event(aPourMembre,aGenreRessource){_requetePublic.call(aInstance,aPourMembre,aGenreRessource);}},getHtmlBtnDest(aPourMembre,aGenreRessource){return _compteurRessources.call(aInstance,aPourMembre,aGenreRessource);},getHtmlNbDest(aPourMembre){return'('+_compteurRessources.call(aInstance,aPourMembre,null)+')';},nodeDestMobile(aPourMembre){$(this.node).eventValidation(function(){_ouvrirFenetreDest_Mobile.call(aInstance,aPourMembre);});},cbVisiteur:{getValue(aEstPourSPR){let lIncl=[TypeGenreVisiteurForum.GVF_SPR];if(!aEstPourSPR){lIncl=[TypeGenreVisiteurForum.GVF_Responsable,TypeGenreVisiteurForum.GVF_Accompagnant];}
return aInstance.sujet.visiteurs.contains(lIncl);},setValue(aEstPourSPR,aValue){let lIncl=[TypeGenreVisiteurForum.GVF_SPR];if(!aEstPourSPR){lIncl=[TypeGenreVisiteurForum.GVF_Responsable,TypeGenreVisiteurForum.GVF_Accompagnant];}
if(aValue){aInstance.sujet.visiteurs.add(lIncl);} else{aInstance.sujet.visiteurs.remove(lIncl);}},getDisabled(aEstPourSPR){return aEstPourSPR;}},inputTitre:{getValue(){return aInstance.sujet.titre;},setValue(aValue){aInstance.sujet.titre=aValue;}},comboMatiere:{init(aCombo){const lListeMatieres=new ObjetListeElements().add(new ObjetElement({Libelle:'',vide:true})).add(aInstance.sujet.listeMatieresDispo);const lMatiereSujet=aInstance.sujet.matiere;if(lMatiereSujet&&!lListeMatieres.GetElementParNumeroEtGenre(lMatiereSujet.GetNumero())){lListeMatieres.add(lMatiereSujet);}
lListeMatieres.trier();let lIndiceSelection=0;if(lMatiereSujet){lIndiceSelection=lListeMatieres.GetIndiceParNumeroEtGenre(lMatiereSujet.GetNumero());}
aCombo.setOptions_ObjetSaisie({longueur:'100%',placeHolder:GTraductions.getValeur('ForumPeda.ChoisirMatiere')}).setDonnees_ObjetSaisie({liste:lListeMatieres,selection:lIndiceSelection||0});},event(aParametres){if(aParametres.estSelectionManuelle&&aParametres.element){aInstance.sujet.matiere=aParametres.element.vide?null:aParametres.element;_actualiserSelectThemes.call(aInstance);}}},getHtmlChipsFichiers(){return TUtilitaireUrl.construireListeUrls(aInstance.sujet.listeFichiers||new ObjetListeElements(),{separateur:' ',IEModelChips:'chipsFichier',maxWidth:IE.estMobile?false:300});},chipsFichier:{eventBtn:function(aIndice){const lPJ=aInstance.sujet.listeFichiers.GetElement(aIndice);if(lPJ){aInstance.GetInstance(aInstance.identSelecteurPJ).supprimerPJ(lPJ);}}},identiteEditeurHTML(){return aInstance.optionsFenetre.getIdentiteEditeurHtml(aInstance);},modelEditeurNonTiny:{getValue:function(){return aInstance.sujet.htmlPost;},setValue:function(aEstHtml,aValue){let lValue=aValue;if(aEstHtml){const lJNodes=$(this.node).find('img');if(lJNodes.length>0){lJNodes.remove();lValue=this.node.innerHTML;GApplication.getMessage().afficher({message:GTraductions.getValeur('CahierDeTexte.MessageSuppressionImage')});}}
aInstance.sujet.htmlPost=lValue;}},rbModeration:{getValue(aGenreModeration){return aInstance.sujet.genreModeration===aGenreModeration;},setValue(aGenreModeration){aInstance.sujet.genreModeration=aGenreModeration;},getDisabled(){return!GApplication.droits.get(TypeDroits.forum.avecModificationForumAPosteriori);}},cbHoraires:{getValue(){return aInstance.sujet.avecHoraires;},setValue(aValue){aInstance.sujet.avecHoraires=aValue;},getDisabled(){return _compteurRessources.call(aInstance,true,EGenreRessource.Eleve)===0;}},inputTime:{getValueInit(aHoraireAvant){return GDate.FormatDate(aHoraireAvant?aInstance.sujet.heureAvant:aInstance.sujet.heureApres,'%hh:%mm');},exitChange(aHoraireAvant,aValue,aParamsSetter){const lDate=aHoraireAvant?aInstance.sujet.heureAvant:aInstance.sujet.heureApres;lDate.setHours(aParamsSetter.time.heure);lDate.setMinutes(aParamsSetter.time.minute);if(aInstance.sujet.heureAvant.getTime()<=aInstance.sujet.heureApres.getTime()){if(aHoraireAvant){if(aParamsSetter.time.heure<=1){aInstance.sujet.heureApres.setHours(0);aInstance.sujet.heureApres.setMinutes(1);} else{aInstance.sujet.heureApres.setHours(aParamsSetter.time.heure-1);aInstance.sujet.heureApres.setMinutes(aParamsSetter.time.minute);}} else{if(aParamsSetter.time.heure>=23){aInstance.sujet.heureAvant.setHours(23);aInstance.sujet.heureAvant.setMinutes(59);} else{aInstance.sujet.heureAvant.setHours(aParamsSetter.time.heure+1);aInstance.sujet.heureAvant.setMinutes(aParamsSetter.time.minute);}}}},getDisabled(){return!aInstance.sujet.avecHoraires;}}});}
ConstruireInstances(){const lThis=this;this.identSelecteurPJ=this.Add(ObjetSelecteurPJ,() =>{this.$refreshSelf();},(aInstance) =>{aInstance.setOptions({genrePJ:EGenreDocumentJoint.Fichier,listeChipsSansFiltre:true,title:GTraductions.getValeur('Messagerie.HintPJ'),maxFiles:0,multiple:true,maxSize:GApplication.droits.get(TypeDroits.tailleMaxDocJointEtablissement),ouvrirFenetreChoixTypesAjout:true,optionsCloud:{avecCloud:(lThis.optionsFenetre.eventSaisieCloudCallbackParFichier&&lThis.optionsFenetre.eventSaisieCloudCallbackFinal),callbackChoixFichierParFichier:lThis.optionsFenetre.eventSaisieCloudCallbackParFichier?lThis.optionsFenetre.eventSaisieCloudCallbackParFichier.bind(this):null,callbackChoixFichierFinal:lThis.optionsFenetre.eventSaisieCloudCallbackFinal?lThis.optionsFenetre.eventSaisieCloudCallbackFinal.bind(this):null},avecMenuContextuel:false,masquerListeChips:true,avecAjoutExistante:true,avecEtatSaisie:false,libelleSelecteur:IE.estMobile?GTraductions.getValeur('Messagerie.HintPJ'):''});});if(this.optionsFenetre.moteurForum.avecGestionThemes()){this.identSelecTheme=this.Add(ObjetCelluleMultiSelectionThemes,(aGenreBouton,aListeSelections) =>{if(aGenreBouton===1){this.sujet.listeThemes=aListeSelections;}},(aInstance) =>{aInstance.setOptions({fullWidth:true,placeHolder:GTraductions.getValeur('infosperso.ChoisirTheme')});});}}
setSujet(aSujet,aSurCreation){this.sujet=aSujet;if(!aSurCreation){this.setOptionsFenetre({titre:GTraductions.getValeur('ForumPeda.ModifierSujet')});}}
Afficher(){_actualiserSelectThemes.call(this);const lPromise=super.Afficher();_actualiserSelecteurPJ.call(this);return lPromise;}
ComposeContenu(){if(IE.estMobile){return _composeContenu_Mobile.call(this);} else{return _composeContenu_Desktop.call(this);}}
SurValidation(ANumeroBouton){const lParams=this.getParametresValidation(ANumeroBouton);if(lParams.bouton&&lParams.bouton.estValider){if(!this.sujet.titre){return GApplication.getMessage().afficher({message:GTraductions.getValeur('ForumPeda.SaisirUnTitre')});}
if((this.optionsFenetre.estContenuSujetVide&&this.optionsFenetre.estContenuSujetVide(this.sujet))||!this.sujet.htmlPost){return GApplication.getMessage().afficher({message:GTraductions.getValeur('ForumPeda.SaisirUnContenu')});}
if(this.sujet.listeMembres.GetNbrElements()===0){return GApplication.getMessage().afficher({message:GTraductions.getValeur('ForumPeda.SaisirUnMembre')});}}
super.SurValidation(ANumeroBouton);}}
function _actualiserSelectThemes(){if(this.GetInstance(this.identSelecTheme)){this.GetInstance(this.identSelecTheme).setDonnees(this.sujet.listeThemes,this.sujet.matiere,GTraductions.getValeur('Theme.libelleCB.forum'));}}
function _composeContenu_Desktop(){const T=[];T.push(tag('div',{class:'dest'},_construireDestinataires_Desktop.call(this)));T.push(tag('div',{class:'visiteurs'},tag('ie-checkbox',{'ie-model':tag.funcAttr('cbVisiteur',false)},GTraductions.getValeur('ForumPeda.VisiteurRespAcc')),tag('br'),tag('ie-checkbox',{'ie-model':tag.funcAttr('cbVisiteur',true)},GTraductions.getValeur('ForumPeda.VisiteurSPR'))));T.push(tag('div',{class:'titre-theme'},tag('label',GTraductions.getValeur('ForumPeda.Titre')),tag('input',{class:'round-style','ie-model':'inputTitre'}),tag('ie-combo',{'ie-model':'comboMatiere'}),(this.GetInstance(this.identSelecTheme)?tag('label',GTraductions.getValeur('ForumPeda.Theme'))+tag('div',{class:'selec-theme',id:this.GetInstance(this.identSelecTheme).Nom}):'')));T.push(tag('div',{'ie-html':'getHtmlChipsFichiers',class:'EspaceBas'}));T.push(tag('div',{class:'flex-contain'},tag('div',{class:'fix-bloc m-right-l flex-contain cols',style:'width:2.4rem;'},_composeChampPJ_Desktop.call(this)),tag('div',{class:'fluid-bloc'},tag('div',{class:'editeur','ie-identite':'identiteEditeurHTML'}))));T.push(tag('div',{class:'options'},tag('fieldset',{class:['fs-moderation',GApplication.droits.get(TypeDroits.forum.avecModificationForumAPosteriori)?'':'disabled']},tag('legend',GTraductions.getValeur('ForumPeda.Moderation')),tag('ie-radio',{'ie-model':tag.funcAttr('rbModeration',TypeGenreModerationForum.GMF_APriori)},GTraductions.getValeur('ForumPeda.AvantPublication')),tag('label',{class:'legendeCB'},GTraductions.getValeur('ForumPeda.AvantPublicationExplication')),tag('ie-radio',{'ie-model':tag.funcAttr('rbModeration',TypeGenreModerationForum.GMF_APosteriori)},GTraductions.getValeur('ForumPeda.ApresPublication')),tag('label',{class:'legendeCB last'},GTraductions.getValeur('ForumPeda.ApresPublicationExplication'))),tag('fieldset',tag('legend',GTraductions.getValeur('ForumPeda.Horaires')),tag('ie-checkbox',{'ie-model':'cbHoraires'},GTraductions.getValeur('ForumPeda.ActiverHoraires')),tag('div',{class:'horaires'},tag('label',GTraductions.getValeur('ForumPeda.HorairesApres'),tag('input',{type:'time',class:'round-style','ie-model':tag.funcAttr('inputTime',false)})),tag('label',GTraductions.getValeur('ForumPeda.HorairesAvant'),tag('input',{type:'time',class:'round-style','ie-model':tag.funcAttr('inputTime',true)}))))));return T.join('');}
function _getTitreDestDeGenre(aGenre){switch(aGenre){case EGenreRessource.Eleve:return GTraductions.getValeur('ForumPeda.Eleves');case EGenreRessource.Personnel:return GTraductions.getValeur('ForumPeda.Personnels');case EGenreRessource.Enseignant:return GTraductions.getValeur('ForumPeda.Professeurs');}
;return'';}
function _getTabRessourcesDest(aPourMembre){if(aPourMembre){return[EGenreRessource.Eleve,EGenreRessource.Enseignant,EGenreRessource.Personnel];} else{return[EGenreRessource.Enseignant,EGenreRessource.Personnel];}}
function _construireDestinataires_Desktop(){const H=[];H.push(tag('fieldset',tag('legend',GTraductions.getValeur('ForumPeda.Membres')),tag('div',(aHtml) =>{for(const lGenre of _getTabRessourcesDest(true)){aHtml.push(tag('label',_getTitreDestDeGenre(lGenre)),tag('ie-bouton',{'ie-model':tag.funcAttr('btnDest',[true,lGenre])},'...'),tag('div',{'ie-html':tag.funcAttr('getHtmlBtnDest',[true,lGenre])}));}})),tag('fieldset',tag('legend',GTraductions.getValeur('ForumPeda.Moderateurs')),tag('div',(aHtml) =>{for(const lGenre of _getTabRessourcesDest(false)){aHtml.push(tag('label',_getTitreDestDeGenre(lGenre)),tag('ie-bouton',{'ie-model':tag.funcAttr('btnDest',[false,lGenre])},'...'),tag('div',{'ie-html':tag.funcAttr('getHtmlBtnDest',[false,lGenre])}));}})));return H.join('');}
function _composeChampPJ_Desktop(){const T=[];T.push(`<div id="${this.GetNomInstance(this.identSelecteurPJ)}" style="height:2.4rem;"></div>`);return T.join('');}
function _composeContenu_Mobile(){const T=[];T.push(tag('div',{class:'field-contain'},tag('div',{class:'selec-dest membre','ie-node':tag.funcAttr('nodeDestMobile',true),tabindex:0,role:'button'},tag('span',GTraductions.getValeur('ForumPeda.Membres'),tag('span',{class:'compteur','ie-html':tag.funcAttr('getHtmlNbDest',[true])})),tag('i',{class:'icon_angle_right'})),tag('div',{class:'selec-dest moderateur','ie-node':tag.funcAttr('nodeDestMobile',false),tabindex:0,role:'button'},tag('span',GTraductions.getValeur('ForumPeda.Moderateurs'),tag('span',{class:'compteur','ie-html':tag.funcAttr('getHtmlNbDest',[false])})),tag('i',{class:'icon_angle_right'})),tag('ie-checkbox',{'ie-model':tag.funcAttr('cbVisiteur',false),class:'p-bottom'},GTraductions.getValeur('ForumPeda.VisiteurRespAcc')),tag('ie-checkbox',{'ie-model':tag.funcAttr('cbVisiteur',true)},GTraductions.getValeur('ForumPeda.VisiteurSPR'))));T.push(tag('div',{class:'field-contain'},tag('label',{class:'active ie-titre-petit'},GTraductions.getValeur('Matiere')),tag('ie-combo',{'ie-model':'comboMatiere',class:'combo-selecteur'})));if(this.GetInstance(this.identSelecTheme)){let lId=this.GetInstance(this.identSelecTheme).Nom;T.push(tag('div',{class:'field-contain'},tag('label',{class:'active ie-titre-petit',for:lId},GTraductions.getValeur('ForumPeda.Theme')),tag('div',{class:'selec-theme on-mobile',id:lId})));}
T.push(this.moteurFormSaisie.composeFormText({label:GTraductions.getValeur('ForumPeda.Titre'),model:'inputTitre'}));T.push(this.moteurFormSaisie.composeFormContenuEditable({label:GTraductions.getValeur('ForumPeda.Contenu'),model:tag.funcAttr('modelEditeurNonTiny',true)}));T.push(tag('div',{class:'field-contain'},tag('div',{class:'selecteur-pj',id:this.GetNomInstance(this.identSelecteurPJ)}),tag('div',{'ie-html':'getHtmlChipsFichiers',class:'visu-pj'})));T.push(tag('div',{class:'field-contain'},tag('label',{class:'active ie-titre-petit'},GTraductions.getValeur('ForumPeda.Moderation')),tag('ie-radio',{'ie-model':tag.funcAttr('rbModeration',TypeGenreModerationForum.GMF_APriori),class:'p-bottom'},GTraductions.getValeur('ForumPeda.AvantPublication')+tag('span',{class:'legendeCB'},` (${GTraductions.getValeur('ForumPeda.AvantPublicationExplication')})`)),tag('ie-radio',{'ie-model':tag.funcAttr('rbModeration',TypeGenreModerationForum.GMF_APosteriori)},GTraductions.getValeur('ForumPeda.ApresPublication')+tag('span',{class:'legendeCB'},` (${GTraductions.getValeur('ForumPeda.ApresPublicationExplication')})`))),tag('div',{class:'field-contain'},tag('label',{class:'active ie-titre-petit'},GTraductions.getValeur('ForumPeda.Horaires')),tag('ie-checkbox',{'ie-model':'cbHoraires'},GTraductions.getValeur('ForumPeda.ActiverHoraires')),tag('div',{class:'horaire'},tag('span',GTraductions.getValeur('ForumPeda.HorairesApres')),tag('input',{type:'time',class:'round-style','ie-model':tag.funcAttr('inputTime',false)})),tag('div',{class:'horaire'},tag('span',GTraductions.getValeur('ForumPeda.HorairesAvant')),tag('input',{type:'time',class:'round-style','ie-model':tag.funcAttr('inputTime',true)}))));return T.join('');}
function _requetePublic(aPourMembre,aGenreRessource){new ObjetRequeteListePublics(this).lancerRequete({genres:[aGenreRessource],sansFiltreSurEleve:GApplication.droits.get(TypeDroits.communication.toutesClasses),avecFonctionPersonnel:true}).then((aDonnees) =>{const lListeRessources=aDonnees.listePublic;const lNomPropListe=aPourMembre?'listeMembres':'listeModerateurs';const lListeRessourcesSelec=this.sujet[lNomPropListe].getListeElements((aRess) =>{return aRess.GetGenre()===aGenreRessource;});const lInstance=ObjetFenetre.creerInstance(ObjetFenetre_SelectionPublic,{pere:this,evenement:function(aGenre,aListe,aNumeroBouton){if(aNumeroBouton===1){this.sujet[lNomPropListe]=this.sujet[lNomPropListe].getListeElements((aRess) =>{return aRess.GetGenre()!==aGenreRessource;}).add(lListeRessourcesSelec);if(this.sujet.avecHoraires&&aPourMembre&&aGenreRessource===EGenreRessource.Eleve&&_compteurRessources.call(this,aPourMembre,aGenreRessource)===0){this.sujet.avecHoraires=false;}}}});lInstance.setOptions_Fenetre_SelectionRessource({avecCocheRessources:true});const lGenreCumul=getCumulPourFenetrePublic(aGenreRessource,false ,lListeRessources.GetNbrElements());if(lGenreCumul){lInstance.setGenreCumulActif(lGenreCumul);}
lInstance.setSelectionObligatoire(false);lInstance.setDonnees({listeRessources:lListeRessources,listeRessourcesSelectionnees:lListeRessourcesSelec,genreRessource:aGenreRessource,avecIndicationDiscussionInterdit:false,titre:EGenreRessource.getTitreFenetreSelectionRessource(aGenreRessource)});});}
function _ouvrirFenetreDest_Mobile(aPourMembre){const T=[];for(const lGenre of _getTabRessourcesDest(aPourMembre)){T.push(tag('div',{class:'field-contain'},tag('div',{class:'selec-dest','ie-node':tag.funcAttr('nodeDestGenre',lGenre),tabindex:0,role:'button'},tag('span',tag('span',_getTitreDestDeGenre(lGenre)),tag('span',{class:'compteur','ie-html':tag.funcAttr('getHtmlNbDest',[aPourMembre,lGenre])})),tag('i',{class:'icon_angle_right'}))));}
const lThis=this;ObjetFenetre.creerInstance(ObjetFenetre,{pere:this,initialiser(aFenetre){aFenetre.setOptionsFenetre({titre:aPourMembre?GTraductions.getValeur('ForumPeda.Membres'):GTraductions.getValeur('ForumPeda.Moderateurs'),listeBoutons:[GTraductions.getValeur('Fermer')],cssFenetre:'ObjetFenetre_SaisieSujetForumPedagogique_racine',empilerFenetre:false});Object.assign(aFenetre.controleur,{nodeDestGenre(aGenreRessource){$(this.node).eventValidation(function(){aFenetre.Fermer();_requetePublic.call(lThis,aPourMembre,aGenreRessource);});},getHtmlNbDest(aPourMembre,aGenreRessource){return'('+_compteurRessources.call(lThis,aPourMembre,aGenreRessource)+')';}});}}).Afficher(T.join(''));}
function _actualiserSelecteurPJ(){this.GetInstance(this.identSelecteurPJ).SetDonnees({listePJ:this.sujet.listeFichiers||new ObjetListeElements(),listeTotale:this.listePJs,idContextFocus:this.Nom});}
function _compteurRessources(aPourMembre,aGenreRessource){let lListe=aPourMembre?this.sujet.listeMembres:this.sujet.listeModerateurs;if(MethodesObjet.isNumber(aGenreRessource)){lListe=lListe.getListeElements((aRess) =>{return aRess.GetGenre()===aGenreRessource;});}
return lListe.GetNbrElements();}
module.exports=ObjetFenetre_SaisieSujetForumPedagogique;},fn:"objetfenetre_saisiesujetforumpedagogique.js"});;
IE.fModule({f:function(exports,require,module,global){const InterfaceForumPedagogique=require('InterfaceForumPedagogique.js');const ObjetFenetre_SaisieSujetForumPedagogique=require('ObjetFenetre_SaisieSujetForumPedagogique.js');const ObjetFenetre=require('ObjetFenetre.js');class InterfaceForumPedagogique_Mobile extends InterfaceForumPedagogique{constructor(...aParams){super(...aParams);this.moteurForum.setOptions({surBasculeEcran:(aSurPosts) =>{const lListeSujets=this.GetInstance(this.identListeSujets);lListeSujets.SetVisible(!aSurPosts);this.GetInstance(this.identPosts).SetVisible(!!aSurPosts);if(!aSurPosts){lListeSujets.SelectionnerLigne({deselectionnerTout:true});}},ouvrirEditionSujet_promise:(aSujet,aSurCreation) =>{return ObjetFenetre.creerInstance(ObjetFenetre_SaisieSujetForumPedagogique,{pere:this,initialiser(aFenetre){aFenetre.setOptionsFenetre({moteurForum:this.moteurForum}).setSujet(aSujet,aSurCreation);}}).Afficher();}});}}
module.exports=InterfaceForumPedagogique_Mobile;},fn:"interfaceforumpedagogique_mobile.js"});;
IE.fModule({f:function(exports,require,module,global){const EGenreEspace=require('Enumere_Espace.js');const EGenreOnglet=require('Enumere_Onglet.js');const DeclarationOngletsMobile={};DeclarationOngletsMobile.getClassOnglet=function(aGenreOnglet){switch(aGenreOnglet){case EGenreOnglet.Accueil:return require('mobile/script/InterfacePageAccueil.js');case EGenreOnglet.MenuOnglets:return require('InterfacePageMenuOnglets.js');case EGenreOnglet.EmploiDuTemps:case EGenreOnglet.EmploiDuTempsEleve:case EGenreOnglet.EmploiDuTempsClasse:return require('InterfacePageEmploiDuTemps_Mobile.js');case EGenreOnglet.CDT_TAF:return GEtatUtilisateur.GenreEspace===EGenreEspace.Mobile_PrimEleve||GEtatUtilisateur.GenreEspace===EGenreEspace.Mobile_PrimParent||GEtatUtilisateur.GenreEspace===EGenreEspace.Mobile_PrimAccompagnant?require('InterfacePageCahierDeTextePP_Mobile.js'):require('InterfacePageCahierDeTexte_Mobile.js');case EGenreOnglet.CDT_Contenu:return require('InterfacePageCahierDeTexte_Mobile.js');case EGenreOnglet.ManuelsNumeriques:return require('InterfaceManuelsNumeriques_Mobile.js');case EGenreOnglet.Bulletins:return require('InterfacePageBulletin.js');case EGenreOnglet.EquipePedagogique:return require('mobile/script/InterfacePageEquipePedagogique.js');case EGenreOnglet.Releve:return require('InterfacePageReleveDeNotes.js');case EGenreOnglet.Menus:return require('InterfacePageMenus_Mobile.js');case EGenreOnglet.SaisieAbsences_AppelEtSuivi:return require('InterfaceFeuilleAppel.js');case EGenreOnglet.QCM_Reponse:return require('InterfacePageQCM.js');case EGenreOnglet.Informations:return require('produit/script/InterfacePageInfoSondagePN.js');case EGenreOnglet.Messagerie:return require('mobile/script/InterfacePageMessagerie.js');case EGenreOnglet.ListeEleves:return require('mobile/script/InterfaceTrombi_Mobile.js');case EGenreOnglet.ParametresUtilisateur:return require('mobile/script/InterfacePageParametres.js');case EGenreOnglet.InfosEnfant_Prim:return require('mobile/script/InterfacePageCompteEnfants.js');case EGenreOnglet.InfosPerso:return require('mobile/script/InterfacePageCompte.js');case EGenreOnglet.Agenda:return require('mobile/script/InterfacePageAgenda.js');case EGenreOnglet.Vacances:return require('mobile/script/InterfacePageVacances.js');case EGenreOnglet.Rencontre:return require('mobile/script/InterfacePageRencontres.js');case EGenreOnglet.DernieresNotes:return require('mobile/script/InterfacePageDernieresNotes.js');case EGenreOnglet.DernieresEvaluations:return require('mobile/script/InterfacePageDernieresEvaluations_Mobile.js');case EGenreOnglet.VieScolaire_Recapitulatif:return require('mobile/script/InterfaceRecapitulatifVS_Mobile.js');case EGenreOnglet.ReleveDeCompetences:case EGenreOnglet.BulletinCompetences:return require('mobile/script/InterfacePageBulletinCompetences.js');case EGenreOnglet.BulletinAnneesPrec_Note:case EGenreOnglet.BulletinAnneesPrec_Competence:case EGenreOnglet.DocumentsATelecharger:return require('InterfaceDocumentsATelecharger_Mobile.js');case EGenreOnglet.Incidents:return require('mobile/script/InterfacePageIncidents_Mobile.js');case EGenreOnglet.TableauDeBord:return require('mobile/script/InterfaceTableauDeBordMobile.js');case EGenreOnglet.SaisieNotes:return require('mobile/script/InterfacePageNotes.js');case EGenreOnglet.SaisieOrientation:return require('mobile/script/InterfacePageOrientation.js');case EGenreOnglet.SaisieCahierDeTextes:return require('mobile/script/InterfacePageSaisieCahierDeTextes.js');case EGenreOnglet.Blog_FilActu:return require('produit/script/InterfaceBlogFilActu.js');case EGenreOnglet.Blog_Mediatheque:return require('InterfaceBlog_Mediatheque.js');case EGenreOnglet.Inscriptions:return require('InterfaceInscriptionsPeriscolaires.js');case EGenreOnglet.CarnetDeSuivi:return require('mobile/script/InterfaceCarnetDeSuivi_Mobile.js');case EGenreOnglet.SaisieAppreciationDeFinDeStage:return require('InterfaceFicheStage_Mobile.js');case EGenreOnglet.SaisieAppelPeriScolaire:return require('produit/script/InterfaceSaisieAppelPeriscolaire.js');case EGenreOnglet.OffresStage:return require('InterfaceListeEntreprise.js');case EGenreOnglet.CompteEleve:return require('mobile/script/InterfacePageParametresEnfants.js');case EGenreOnglet.ForumPedagogique:return require('InterfaceForumPedagogique_Mobile.js');default:;return null;}};module.exports=DeclarationOngletsMobile;},fn:"declarationongletsmobile.js"});;
IE.fModule({f:function(exports,require,module,global){const ObjetIdentite=require('ObjetIdentite.js');const GTraductions=require('ObjetTraduction.js');const IELocalStorage=require('LocalStorage.js');const ObjetFenetre=require('ObjetFenetre.js');const ObjetFenetre_MentionsLegales=require('ObjetFenetre_MentionsLegales.js');const ObjetRequeteMentionsLegales=require('ObjetRequeteMentionsLegales.js');require('espace/css/ObjetBandeauPied.css');const lCleLocalStorage="etatAffichageFooter";const lCookieLocalStorage="etatAffichageCookiesInfo";class _ObjetAffichageBandeauPied extends ObjetIdentite{constructor(...aParams){super(...aParams);this.hauteur=20;this.genreCommande={twitter:'twitter',aide:'aide',forum:'forum',videos:'videos',profil:'pageprofil'};this.options={mention:'',siteIndex:'https://www.index-education.com',urlInfosHebergement:'',logoProduitCss:'',logoDepartementImage:'',logoDepartementLien:'',estHebergeEnFrance:'',avecBoutonMasquer:true,urlDeclarationAccessibilite:''};}
avecAide(){}
getCommande(){}
composeBoutonAccesProfil(){}
ActionSurMentionsLegales(aParams){let lFenetreMentionsLegales=ObjetFenetre.creerInstance(ObjetFenetre_MentionsLegales,{pere:this,initialiser:function(){}});lFenetreMentionsLegales.setOptionsFenetre({titre:GTraductions.getValeur('PiedPage.mentionsLegales')});lFenetreMentionsLegales.SetDonnees(aParams);}
ActionSurPlanSite(){}
getControleur(aInstance){return $.extend(true,super.getControleur(this),{btnPied:{event:function(aGenre){this.instance.EvenementBouton({genreCmd:aGenre});}},btnFermer:function(){$(this.node).eventValidation(function(){let lGenreEspace=global.GEtatUtilisateur!==undefined?'_'+GEtatUtilisateur.GenreEspace:'';IELocalStorage.setItem(lCookieLocalStorage+lGenreEspace,false);$(this).parent().hide();});},btnMention:function(){$(this.node).eventValidation(function(){let lRequete=new ObjetRequeteMentionsLegales(aInstance,aInstance.ActionSurMentionsLegales);lRequete.lancerRequete();});},btnPlanSite:function(){$(this.node).eventValidation(function(){aInstance.ActionSurPlanSite();});},nodePied:function(aGenre){$(this.node).eventValidation(function(){aInstance.EvenementBouton({genreCmd:aGenre});});},showPied:function(){$(this.node).on({click:function(){if(aInstance.options.avecBoutonMasquer){aInstance.masquerFooter=!aInstance.masquerFooter;IELocalStorage.setItem(lCleLocalStorage+"_"+GEtatUtilisateur.GenreEspace,aInstance.masquerFooter);aInstance.showHideFooter.call(this,aInstance.masquerFooter);}}});}});}
avecTwitter(){return false;}
avecPlanSite(){return false;}
avecBoutonAideContextuelle(){return false;}
avecBoutonAccesProfil(){return false;}
avecBoutonPersonnaliseProduit(){return false;}
avecBoutonPageEtablissement(){return false;}
espacesISO27001(){return false;}
composeBoutonPersonnaliseProduit(){}
composeBoutonPageEtablissement(){}
composeCookiesInfo(){const H=[];H.push(`<div class="cookies-disclaimer">`);H.push(`<p>${GTraductions.getValeur('PiedPage.CookieInfo_Message_1')} ${GTraductions.getValeur('PiedPage.CookieInfo_Message_2')} <span role="button" tabindex="0" class="as-link" ie-node="btnMention" aria-haspopup="dialog">${GTraductions.getValeur('PiedPage.mentionsLegales')}.</span></p>`);H.push(`<ie-bouton tabindex="0" aria-label="${GTraductions.getValeur('Fermer')}" ie-hint="${GTraductions.getValeur('Fermer')}" ie-node="btnFermer">${GTraductions.getValeur('Fermer')}</ie-bouton>`);H.push(`</div>`);return H.join('');}
EvenementBouton(aParam,aGenreBouton){if(aGenreBouton!==1){this.callback.appel(aParam);}}
SetDonnees(aParam){if(!!aParam){this.setOptions(aParam);}
this.Afficher(this.ComposePage());}
ComposePage(){const lHtml=[];this.masquerFooter=this.MasquerBandeauPied();this.AfficherCookieInfo=this.AfficherCookieInfo();if(this.AfficherCookieInfo&&!GApplication.getDemo()){lHtml.push(this.composeCookiesInfo());}
lHtml.push(_composeAffichage.call(this));return lHtml.join('');}
showHideFooter(aMasquerPied){const lParentContainer=$(this).closest('.interface_affV');const lFooterWrapper=lParentContainer.find('.footer-wrapper');if(aMasquerPied){lFooterWrapper.toggleClass('opened closed');lParentContainer.removeClass('with-footer').addClass('no-footer');} else{lFooterWrapper.toggleClass('closed opened');lParentContainer.removeClass('no-footer').addClass('with-footer');}
$(window).resize();}
MasquerBandeauPied(){return this.options.avecBoutonMasquer?(IELocalStorage.getItem(lCleLocalStorage+"_"+GEtatUtilisateur.GenreEspace)==='true'):false;}
AfficherCookieInfo(){let lGenreEspace=global.GEtatUtilisateur!==undefined?'_'+GEtatUtilisateur.GenreEspace:'';IELocalStorage.getItem(lCookieLocalStorage+lGenreEspace)===null?IELocalStorage.setItem(lCookieLocalStorage+lGenreEspace,true):IELocalStorage.getItem(lCookieLocalStorage+lGenreEspace);return IELocalStorage.getItem(lCookieLocalStorage+lGenreEspace)==='true';}}
function _composeAffichage(){const H=[];H.push('<footer id="',this.Nom,'_footer" class="ObjetBandeauPied '+(this.avecBoutonPersonnaliseProduit()?' bpp-canope':'')+'">');if(this.options.avecBoutonMasquer){H.push('<div class="footer-toggler icon_angle_down" ie-node="showPied()"></div>');}
if(!!this.options.logoDepartementImage){H.push('<div aria-hidden="true" class="ibp-logo-conteneur">','<a ',(this.options.logoDepartementLien?'href="'+this.options.logoDepartementLien+'"':''),' target="_blank" tabindex="-1" class="ibp-logo" role="presentation">','<img src="',this.options.logoDepartementImage,'" alt="" onerror="$(this).parent().remove();" />','</a>','<hr />','</div>');}
const lAvecLibelleHeberge=this.options.siteIndex&&this.options.estHebergeEnFrance;H.push('<div class="ibp-bloc-left'+(!lAvecLibelleHeberge?' bloc-unique':'')+'">');if(this.avecTwitter()){H.push('<ie-btnimage ie-model="btnPied('+this.getCommande(this.genreCommande.twitter)+')" class="icon_twitter btnImageIcon ibp-command" title="'+GTraductions.getValeur('Commande.SuivrePronoteTwitter.Actif')+'">'+'</ie-btnimage>','<hr />');}
if(this.options.mention){H.push('<div role="button" tabindex="0" class="ibp-command legal-notice" ie-node="btnMention">',GTraductions.getValeur('PiedPage.mentionsLegales'),'</div>');H.push('<hr />');}
if(this.options.urlDeclarationAccessibilite){H.push(`<a class="accessibilite" href="${this.options.urlDeclarationAccessibilite}">${GTraductions.getValeur('PiedPage.declarationAccessibilite')}</a>`);H.push('<hr />');}
if(this.avecPlanSite()){H.push('<div role="button" tabindex="0" class="ibp-command site-map" ie-node="btnPlanSite">',GTraductions.getValeur('PiedPage.planSite'),'</div>');if(lAvecLibelleHeberge){H.push('<hr />');}}
H.push('</div>');if(lAvecLibelleHeberge){const lOnClic=GNavigateur.isIOS?'':`onclick="window.open ('${this.options.urlInfosHebergement}');" onkeyup="if(GNavigateur.IsToucheSelection())window.open ('${this.options.urlInfosHebergement}');"`;H.push(`<div role="button" tabindex="0" class="host-france-container ibp-command" ${lOnClic}>`,'<span class="host-text">',GTraductions.getValeur('PiedPage.hebergementDonneesFrance'),'</span>','<span class="logo-index-inverse" aria-hidden="true"></span>',(this.espacesISO27001()?'<span class="certif-27001">'+GTraductions.getValeur('PiedPage.certifISO27001')+'</span>':''),'</div>');}
H.push('<div class="knowledge-container">');if(this.avecBoutonPersonnaliseProduit()){H.push(this.composeBoutonPersonnaliseProduit());}
if(this.avecBoutonAccesProfil()){H.push(this.composeBoutonAccesProfil());}
if(this.avecBoutonAideContextuelle()){H.push('<div role="button" tabindex="0" class="ibp-pill icon_question" ie-node="nodePied('+this.getCommande(this.genreCommande.aide)+')"  ie-hint="',GTraductions.getValeur('Commande.Aide.Actif'),'"><p class="help-text">',GTraductions.getValeur('Commande.Aide.Actif'),'</p></div>');}
if(this.avecBoutonPageEtablissement()){H.push(this.composeBoutonPageEtablissement());}
H.push('</div>');H.push('</footer>');return H.join('');}
module.exports=_ObjetAffichageBandeauPied;},fn:"_interfacebandeaupied.js"});;
IE.fModule({f:function(exports,require,module,global){const EGenreCommande={ChangerRessource:0,Impression:1,Validation:2,Aide:4,Communication:5,ChangerOnglet:6,AccesMobile:7,Accueil:12,Tutoriel:14,Twitter:16,CompteEnfant:19,Forum:30,CloudIndex:31,Videos:32,Profil:33,ImpressionHTML:34};EGenreCommande.getLibelle=function(){return'';};module.exports=EGenreCommande;},fn:"enumere_commande.js"});;
IE.fModule({f:function(exports,require,module,global){const ObjetFenetre=require('ObjetFenetre.js');const GTraductions=require('ObjetTraduction.js');const GHtml=require('_ObjetHtml.js').GHtml;const ObjetListeElements=require('ObjetListeElements.js');const{ObjetInvocateur,Invocateur}=require('Invocateur.js');const MethodesObjet=require('MethodesObjet.js');class ObjetFenetre_PlanSite extends ObjetFenetre{constructor(...aParams){super(...aParams);this.idContenu=this.GetNom()+'_Contenu';this.parametres={};this.setOptionsFenetre({largeur:400,hauteur:320,hauteurMaxContenu:720,avecScroll:true,listeBoutons:[GTraductions.getValeur('Fermer')]});}
ConstruireInstances(){}
getControleur(){return $.extend(true,super.getControleur(this),{naviguerVers:function(aGenreOnglet){$(this.node).on('click',function(){Invocateur.evenement(ObjetInvocateur.events.navigationOnglet,aGenreOnglet);});}});}
SetDonnees(){this.Afficher();}
ComposeContenu(){const H=[];H.push('<div id="',this.idContenu,'" class="FenetrePlanSite">');const lTabOnglet=this.getTabOngletsVisibles();H.push('<ul class="">');lTabOnglet.parcourir(aOnglet =>{H.push(_ajouterLigne(aOnglet,(aOnglet.sousOnglets&&aOnglet.sousOnglets.GetNbrElements()===0)));if(aOnglet.sousOnglets&&aOnglet.sousOnglets.GetNbrElements()>0){H.push('<ul>');aOnglet.sousOnglets.parcourir(aSousOnglet =>{H.push(_ajouterLigne(aSousOnglet,!aSousOnglet.sousOnglets));if(aSousOnglet.sousOnglets){H.push('<ul>');aSousOnglet.sousOnglets.parcourir(aElement =>{H.push(_ajouterLigne(aElement,true));});H.push('</ul>');}});H.push('</ul>');}});H.push('</ul>');H.push('</div>');return H.join('');}
getTabOngletsVisibles(){const lListeOnglet=new ObjetListeElements();GEtatUtilisateur.listeOnglets.parcourir(aOnglet =>{const lOnglet=MethodesObjet.dupliquer(aOnglet);if(lOnglet.Actif&&(lOnglet.estUnOnglet||lOnglet.profondeur===0)){lOnglet.sousOnglets=new ObjetListeElements();lOnglet.sousOnglets=GEtatUtilisateur.listeOnglets.getListeElements(aElement =>{if(aElement.Actif&&aElement.onglet){return lOnglet.GetGenre()===aElement.onglet.GetGenre();}
return false;});lOnglet.sousOnglets.parcourir(aSousOnglet =>{if(aSousOnglet.avecSousOnglet){aSousOnglet.sousOnglets=new ObjetListeElements();aSousOnglet.sousOnglets=GEtatUtilisateur.listeOnglets.getListeElements(aSousElement =>{if(aSousElement.Actif&&aSousElement.onglet){return aSousOnglet.GetGenre()===aSousElement.onglet.GetGenre();}
return false;});}});lListeOnglet.add(lOnglet);}});return lListeOnglet;}
SurValidation(){this.Fermer();}}
function _ajouterLigne(aOnglet,aAvecLien){const H=[];if(aAvecLien){H.push(`<li class="AvecMain" ${GHtml.composeAttr('ie-node','naviguerVers',aOnglet.GetGenre())}"><a>${aOnglet.GetLibelle()}</a></li>`);} else{H.push(`<li>${aOnglet.GetLibelle().replace('<br />',' ')}</li>`);}
return H.join('');}
module.exports=ObjetFenetre_PlanSite;},fn:"objetfenetre_plansite.js"});;
IE.fModule({f:function(exports,require,module,global){const _ObjetAffichageBandeauPied=require('_InterfaceBandeauPied.js');const EGenreCommande=require('Enumere_Commande.js');const{TypeDroits}=require('ObjetDroitsPN.js');const EGenreEspace=require('Enumere_Espace.js');const GTraductions=require('ObjetTraduction.js');const MethodesTableau=require('MethodesTableau.js');const ObjetFenetre=require('ObjetFenetre.js');const ObjetFenetre_PlanSite=require('ObjetFenetre_PlanSite.js');const UtilitaireRedirection=require('UtilitaireRedirection.js');class ObjetAffichageBandeauPied extends _ObjetAffichageBandeauPied{constructor(...aParams){super(...aParams);this.options={mention:GParametres.publierMentions,siteIndex:GParametres.urlSiteIndexEducation||'https://www.index-education.com',urlInfosHebergement:GParametres.urlInfosHebergement,logoProduitCss:GParametres.logoProduitCss||'',logoDepartementImage:GParametres.logoDepartementImage,logoDepartementLien:GParametres.logoDepartementLien,estHebergeEnFrance:GParametres.estHebergeEnFrance,pageEtablissement:GParametres.PageEtablissement||'',avecBoutonMasquer:true,urlDeclarationAccessibilite:GParametres.urlDeclarationAccessibilite};}
getControleur(aInstance){return $.extend(true,super.getControleur(this),{nodeCanope:function(){$(this.node).eventValidation(function(){window.open(GParametres.urlCanope);});},nodePageEtab:function(){$(this.node).eventValidation(function(){let lUrl=window.location.href.split('/');lUrl.pop();lUrl=lUrl.join('/')+'/';window.open(lUrl+aInstance.options.pageEtablissement+new UtilitaireRedirection().getParametresUrl());});}});}
getCommande(aGenreCommande){switch(aGenreCommande){case this.genreCommande.aide:return EGenreCommande.Aide;case this.genreCommande.forum:return EGenreCommande.Forum;case this.genreCommande.twitter:return EGenreCommande.Twitter;case this.genreCommande.videos:return EGenreCommande.Videos;case this.genreCommande.profil:return EGenreCommande.Profil;case this.genreCommande.communication:return EGenreCommande.Communication;default:return false;}}
EvenementBouton(aParam,aGenreBouton){if(aParam.genreCmd===this.getCommande(this.genreCommande.twitter)){if(!!GParametres.urlAccesTwitter){window.open(GParametres.urlAccesTwitter);}
return;}
return super.EvenementBouton(aParam,aGenreBouton);}
avecTwitter(){return GApplication.droits.get(TypeDroits.fonctionnalites.gestionTwitter)&&!!GParametres.urlAccesTwitter;}
avecPlanSite(){return true;}
avecBoutonAideContextuelle(){return!IE.estMobile;}
avecBoutonAccesProfil(){return!GNavigateur.isIOS;}
composeBoutonAccesProfil(){const H=[];H.push('<div role="button" tabindex="0" class="ibp-pill icon_light_bulb" ie-node="nodePied('+this.getCommande(this.genreCommande.profil)+')" ie-hint="',GTraductions.getValeur('PiedPage.toutSavoirPronote'),' : ',GTraductions.getValeur('PiedPage.tutosForumQCM'),'">','<div class="kb-conteneur">','<p class="as-title">',GTraductions.getValeur('PiedPage.toutSavoirPronote'),'</p>','<p>',GTraductions.getValeur('PiedPage.tutosForumQCM'),'</p>','</div>','</div>');return H.join('');}
avecBoutonPersonnaliseProduit(){return!GNavigateur.isIOS&&(MethodesTableau.existe(GEtatUtilisateur.GenreEspace,[EGenreEspace.Professeur,EGenreEspace.Mobile_Professeur,EGenreEspace.PrimProfesseur,EGenreEspace.Mobile_PrimProfesseur]))&&GParametres.estHebergeEnFrance&&!!GParametres.urlCanope;}
composeBoutonPersonnaliseProduit(){const H=[];H.push('<div class="ibp-pill partenaire-canope" ie-node="nodeCanope" ie-hint="',GTraductions.getValeur('PiedPage.Canope'),'"><ie-btnimage class="btnImageIcon Image_Partenaire_Canope_2022" role="button" tabindex="0" aria-label="',GTraductions.getValeur('PiedPage.Canope'),'"></ie-btnimage></div>');return H.join('');}
avecBoutonPageEtablissement(){return!!this.options.pageEtablissement;}
composeBoutonPageEtablissement(){const H=[];H.push('<div tabindex="0" role="button" class="ibp-pill icon_ecole" aria-label="',GTraductions.getValeur('PiedPage.PageEtablissement'),'" ie-node="nodePageEtab" ie-hint="',GTraductions.getValeur('PiedPage.PageEtablissement'),'"><p class="help-text">',GTraductions.getValeur('PiedPage.PageEtablissement'),'</p></a></div>');return H.join('');}
ActionSurPlanSite(){let lFenetrePlanSite=ObjetFenetre.creerInstance(ObjetFenetre_PlanSite,{pere:this,initialiser:function(aInstance){aInstance.setOptionsFenetre({titre:GTraductions.getValeur('PiedPage.planSite')});}});lFenetrePlanSite.SetDonnees();}
espacesISO27001(){return!GEtatUtilisateur.pourPrimaire();}}
module.exports=ObjetAffichageBandeauPied;},fn:"interfacebandeaupied.js"});;
IE.fModule({f:function(exports,require,module,global){const{ObjetRequeteConsultation}=require('ObjetRequeteJSON.js');const Requetes=require('CollectionRequetes.js');class ObjetRequeteAccesSecurisePageProfil extends ObjetRequeteConsultation{constructor(...aParams){super(...aParams);}
lancerRequete(aParam){this.JSON=aParam;return this.appelAsynchrone();}
actionApresRequete(){this.callbackReussite.appel(this.JSONReponse.titre,this.JSONReponse.message,this.JSONReponse.url);}}
Requetes.inscrire('AccesSecurisePageProfil',ObjetRequeteAccesSecurisePageProfil);module.exports=ObjetRequeteAccesSecurisePageProfil;},fn:"objetrequeteaccessecurisepageprofil.js"});;
IE.fModule({f:function(exports,require,module,global){require('mobile/script/ObjetEntete.js');require('UtilitaireQCM_Mobile.js');require('IEHtml.SelecFile.js');require('IEHtml.Combo.js');const MethodesTableau=require('MethodesTableau.js');const GTraductions=require('ObjetTraduction.js');const _ObjetInterfaceMobile=require('_InterfaceMobile.js');const EGenreCommandeMobile=require('_ObjetEntete.js').EGenreCommandeMobile;const{GDate}=require('ObjetDate.js');const ObjetListeElements=require('ObjetListeElements.js');const EGenreEspace=require('Enumere_Espace.js');const EGenreOnglet=require('Enumere_Onglet.js');const UtilitaireContactVieScolaire_Mobile=require('UtilitaireContactVieScolaire_Mobile.js');const GThemesPrimaire=require('ThemesPrimaire.js').GThemesPrimaire;const ControleSaisieEvenement=require('ControleSaisieEvenement.js');const DeclarationOngletsMobile=require('DeclarationOngletsMobile.js');const TypeEtatExecutionQCMPourRepondant=require('TypeEtatExecutionQCMPourRepondant.js').TypeEtatExecutionQCMPourRepondant;const InterfaceBandeauPied=require('InterfaceBandeauPied.js');const EGenreCommande=require('Enumere_Commande.js');const EGenreBoiteMessage=require('Enumere_BoiteMessage.js');const TUtilitairePartenaire=require('UtilitairePartenaire.js');const InterfacePageMenuOnglets=require('InterfacePageMenuOnglets.js');const ObjetEnteteMobile=require('ObjetEntete.js');class ObjetInterfaceMobile extends _ObjetInterfaceMobile{constructor(...aParams){super(...aParams);this.GenreOnglet=EGenreOnglet.Accueil;this.genreOngletPrecedent=null;this.OngletsAvecRessourceParent=[EGenreOnglet.Accueil,EGenreOnglet.EmploiDuTemps,EGenreOnglet.ListeEleves,EGenreOnglet.CDT_Contenu,EGenreOnglet.CDT_TAF,EGenreOnglet.Releve,EGenreOnglet.Rencontre,EGenreOnglet.Messagerie,EGenreOnglet.Bulletins,EGenreOnglet.EquipePedagogique,EGenreOnglet.DernieresNotes,EGenreOnglet.VieScolaire_Recapitulatif,EGenreOnglet.DocumentsATelecharger,EGenreOnglet.BulletinCompetences,EGenreOnglet.ReleveDeCompetences,EGenreOnglet.BulletinAnneesPrec_Note,EGenreOnglet.BulletinAnneesPrec_Competence,EGenreOnglet.DernieresEvaluations,EGenreOnglet.SaisieOrientation
];this.OngletsAvecRessourceEtablissement=[EGenreOnglet.EmploiDuTempsClasse,EGenreOnglet.ListeEleves];this.setOptions({InterfacePageMenuOnglets:InterfacePageMenuOnglets,ObjetEnteteMobile:ObjetEnteteMobile});}
getGenrePremierOngletPublie(){const LTabGenresActifs=[];for(let i=0;i<GEtatUtilisateur.listeOnglets.GetNbrElements();i++){let lOngletTest=GEtatUtilisateur.listeOnglets.GetElement(i);if(!MethodesTableau.existe(lOngletTest.GetGenre(),GEtatUtilisateur.listeOngletsInvisibles)&&lOngletTest.GetGenre()!==EGenreOnglet.Accueil){LTabGenresActifs.push(lOngletTest.GetGenre());if(lOngletTest.onglet&&$.isNumeric(lOngletTest.onglet.GetGenre())&&$.inArray(lOngletTest.onglet.GetGenre(),LTabGenresActifs)> -1){LTabGenresActifs.splice($.inArray(lOngletTest.onglet.GetGenre(),LTabGenresActifs),1);}}}
let lPremierOngletPublie=null;for(let i=0;i<LTabGenresActifs.length;i++){if(!MethodesTableau.existe(LTabGenresActifs[i],GEtatUtilisateur.listeOngletsInvisibles)&&LTabGenresActifs[i]!==EGenreOnglet.Accueil){lPremierOngletPublie=GEtatUtilisateur.listeOnglets.GetElementParGenre(LTabGenresActifs[i]);break;}}
let lGenrePremierOngletPublie= -1;if((lPremierOngletPublie!==null&&lPremierOngletPublie!==undefined)){lGenrePremierOngletPublie=lPremierOngletPublie.GetGenre();}
return lGenrePremierOngletPublie;}
SetDonnees(){if(UtilitaireContactVieScolaire_Mobile){UtilitaireContactVieScolaire_Mobile.declarer();}
GApplication.donneesCentraleNotifications.initSurInterfaceDisponible();if(!!this.IdentBandeauPied){this.GetInstance(this.IdentBandeauPied).SetDonnees();}}
ConstruireInstances(){this._construireInstances();}
changementRessource(aIndex){var lElement=this.getListeRessources().GetElement(aIndex);if(GEtatUtilisateur.GenreEspace===EGenreEspace.Mobile_Etablissement){GEtatUtilisateur.setClasse(lElement);} else if(MethodesTableau.existe(GEtatUtilisateur.GenreEspace,[EGenreEspace.Mobile_Parent,EGenreEspace.Mobile_PrimParent,EGenreEspace.Mobile_Accompagnant,EGenreEspace.Mobile_PrimAccompagnant,EGenreEspace.Mobile_Tuteur])){GEtatUtilisateur.SetNumeroEleve(lElement.GetNumero());if(this.GetInstance(this.idMenuOnglets)){this.GetInstance(this.idMenuOnglets).Initialiser();}}
this.evenementSurOnglet(GEtatUtilisateur.getGenreOnglet(),true,false,GEtatUtilisateur.getGenreAffichage());}
avecChangementRessource(){return MethodesTableau.existe(GEtatUtilisateur.GenreEspace,[EGenreEspace.Mobile_Etablissement,EGenreEspace.Mobile_Parent,EGenreEspace.Mobile_PrimParent,EGenreEspace.Mobile_Accompagnant,EGenreEspace.Mobile_PrimAccompagnant,EGenreEspace.Mobile_Tuteur])&&GEtatUtilisateur.Identification.ListeRessources.GetNbrElements()>1;}
getListeRessources(){var result;if(GEtatUtilisateur.GenreEspace===EGenreEspace.Mobile_Etablissement){result=GEtatUtilisateur.getListeClasses({avecClasse:true,uniquementClasseEnseignee:true});} else if(GEtatUtilisateur.GenreEspace===EGenreEspace.Mobile_PrimProfesseur){result=GEtatUtilisateur.getListeClasses({avecClasse:true,avecGroupe:true,sansClasseDeRegroupement:true});} else if(MethodesTableau.existe(GEtatUtilisateur.GenreEspace,[EGenreEspace.Mobile_Parent,EGenreEspace.Mobile_PrimParent,EGenreEspace.Mobile_Accompagnant,EGenreEspace.Mobile_PrimAccompagnant,EGenreEspace.Mobile_Tuteur])){result=GEtatUtilisateur.Identification.ListeRessources;} else{result=new ObjetListeElements();}
return result;}
getGenreOnglet(){return EGenreOnglet;}
getGenreOngletAccueil(){return EGenreOnglet.Accueil;}
evenementPageMobile(aParam){var lQCMrevision;var lEspaceQCMConsult;switch(aParam.genreOnglet){case EGenreOnglet.Accueil:if(aParam.executionQCM){lQCMrevision=!aParam.executionQCM.estLieADevoir&&!aParam.executionQCM.estLieAEvaluation&&!aParam.executionQCM.estUnTAF;lEspaceQCMConsult=MethodesTableau.existe(GEtatUtilisateur.GenreEspace,[EGenreEspace.Mobile_Parent,EGenreEspace.Mobile_PrimParent,EGenreEspace.Mobile_Accompagnant,EGenreEspace.Mobile_PrimAccompagnant,EGenreEspace.Mobile_Tuteur]);if(lEspaceQCMConsult&&(aParam.executionQCM.etatCloture===undefined||aParam.executionQCM.etatCloture===TypeEtatExecutionQCMPourRepondant.EQR_EnCours)&&!lQCMrevision){GApplication.getMessage().afficher({message:GTraductions.getValeur('ExecutionQCM.DepuisEspaceEleve')});} else{this.evenementSurOnglet(EGenreOnglet.QCM_Reponse);this.Instances[this.identPageMobile].setDonnees(aParam,aParam.genreOnglet);}} else{this.evenementSurOnglet(aParam.genreOngletDest);}
break;case EGenreOnglet.CDT_TAF:case EGenreOnglet.CDT_Contenu:case EGenreOnglet.EmploiDuTemps:if(aParam.executionQCM){lQCMrevision=!aParam.executionQCM.estLieADevoir&&!aParam.executionQCM.estLieAEvaluation&&!aParam.executionQCM.estUnTAF;lEspaceQCMConsult=MethodesTableau.existe(GEtatUtilisateur.GenreEspace,[EGenreEspace.Mobile_Parent,EGenreEspace.Mobile_PrimParent,EGenreEspace.Mobile_Accompagnant,EGenreEspace.Mobile_PrimAccompagnant,EGenreEspace.Mobile_Tuteur]);if(lEspaceQCMConsult&&(aParam.executionQCM.etatCloture===undefined||aParam.executionQCM.etatCloture===TypeEtatExecutionQCMPourRepondant.EQR_EnCours)&&!lQCMrevision){GApplication.getMessage().afficher({message:GTraductions.getValeur('ExecutionQCM.DepuisEspaceEleve')});} else{this.evenementSurOnglet(EGenreOnglet.QCM_Reponse);this.Instances[this.identPageMobile].setDonnees(aParam,aParam.genreOnglet);}}
break;case EGenreOnglet.QCM_Reponse:this.evenementSurOnglet(aParam.genreOngletPrec,true,false);break;}}
evenementEnteteMobile(aGenreBoutonMobile){switch(aGenreBoutonMobile){case EGenreCommandeMobile.SeDeconnecter:{break;}
case EGenreCommandeMobile.Valider:{var lInstanceAffichage=this.GetInstance(this.identPageMobile)
;if(lInstanceAffichage&&lInstanceAffichage.Valider){lInstanceAffichage.Valider(true);}
break;}
case EGenreCommandeMobile.Retour:{ControleSaisieEvenement(this.traiterEvenementRetour.bind(this));break;}
case EGenreCommandeMobile.Accueil:if(GEtatUtilisateur.avecPageAccueil()){this.GetInstance(this.idMenuOnglets).surClickAccueil();}
break;case EGenreCommandeMobile.MenuOnglets:this.ouvrirMenuOnglet();break;default:break;}}
evenementAvantAffichageOnglet(aGenreOnglet){if(GEtatUtilisateur.pourThemePrimaire()){if(aGenreOnglet===EGenreOnglet.Accueil){$('#'+GApplication.getIdConteneur()).addClass(GThemesPrimaire.getTheme());} else{$('#'+GApplication.getIdConteneur()).removeClass(GThemesPrimaire.getTheme());}}}
traiterEvenementRetour(){if(!this.Instances[this.identPageMobile].retourSurAffichage||!this.Instances[this.identPageMobile].retourSurAffichage()){this.Instances[this.identEnteteMobile].actualiserTitre();this.Instances[this.idMenuOnglets].actualiserTitre();var lOnglet=this.genreOngletPrecedent===null||this.genreOngletPrecedent===undefined?GEtatUtilisateur.avecPageAccueil()?EGenreOnglet.Accueil:EGenreOnglet.MenuOnglets:this.genreOngletPrecedent;this._ajouterHistorique(lOnglet);if(lOnglet===EGenreOnglet.Accueil){this.GetInstance(this.idMenuOnglets).surClickAccueil();} else{this.evenementSurOnglet(lOnglet);}}}
rafraichirOnglet(){if(!this.getEtatSaisie()&&MethodesTableau.existe(this.GenreOnglet,[EGenreOnglet.Accueil])){this.actionSurEvenementOnglet();}}
actionSurRecupererDonnees(){if(!!this.GetInstance(this.idMenuOnglets)){$('#'+this.GetInstance(this.idMenuOnglets).GetNom().escapeJQ()).sidenav({edge:'right',draggable:true,onOpenEnd:(function(){this.GetInstance(this.idMenuOnglets).focusTitre();}).bind(this)});}
this.SetEtatSaisie(false);GEtatUtilisateur.setDerniereDate(GApplication.getDateDemo()?GApplication.getDateDemo():GDate.getDateCourante());this.GenreOnglet=GEtatUtilisateur.getGenreOnglet();if(this.GenreOnglet===null){if(GEtatUtilisateur.avecPageAccueil()){this.GenreOnglet=this.getGenreOngletAccueil();} else{this.GenreOnglet=this.getGenrePremierOngletPublie();}}
if(this.GenreOnglet===this.getGenreOngletAccueil()){this.GetInstance(this.idMenuOnglets).surClickAccueil();} else{this.evenementSurOnglet(this.GenreOnglet,true,true);}}
_getConstructeurOnglet(aGenreOnglet){return DeclarationOngletsMobile.getClassOnglet(aGenreOnglet);}
AjouterBandeauPied(){return this.Add(InterfaceBandeauPied,this.evenementCommande);}
evenementCommande(aParam){switch(aParam.genreCmd){case EGenreCommande.Profil:{this.EvenementSurAccesProfil();break;}}}
EvenementSurAccesProfil(){const ObjetRequeteAccesProfil=require('ObjetRequeteAccesSecurisePageProfil.js');TUtilitairePartenaire.ouvrirPatience();if(ObjetRequeteAccesProfil){new ObjetRequeteAccesProfil(this,this.actionSurRequetePageProfil).lancerRequete();}}
actionSurRequetePageProfil(aTitre,aMessage,aUrl){if(aMessage){TUtilitairePartenaire.fermerPatience();GApplication.getMessage().afficher({type:EGenreBoiteMessage.Information,titre:aTitre,message:aMessage});} else if(aUrl){TUtilitairePartenaire.ouvrirUrl(aUrl);} else{TUtilitairePartenaire.fermerPatience();}}}
module.exports=ObjetInterfaceMobile;},fn:"interfacemobile.js"});;
